[
    {
        "content": "<p>Posting this here in case it impacts others -- with the 1.91.0 update, we ran into link errors (and runtime errors with LTO enabled) due to what appears to be a regression in Rustc.</p>\n<p>I've written up an issue <a href=\"https://github.com/rust-lang/rust/issues/148347\">https://github.com/rust-lang/rust/issues/148347</a> and have a minimal repro with some additional notes here: <a href=\"https://github.com/posborne/rustc-1.91.0-wasm-linkage-bug-repro\">https://github.com/posborne/rustc-1.91.0-wasm-linkage-bug-repro</a></p>\n<p>The main case that seem to be impacted is usage of <code>#[link(wasm_import_module = \"test\")]</code> defs with link_names that match those exported by libc. </p>\n<p>This results in errors like this if LTO is disabled:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">rust</span><span class=\"o\">-</span><span class=\"n\">lld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">import</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">close</span>\n<span class=\"w\">          </span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">paul</span><span class=\"p\">.</span><span class=\"n\">osborne</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">OpenSource</span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">-</span><span class=\"n\">bug</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">mangling</span><span class=\"o\">-</span><span class=\"n\">minrepro</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span>\n<span class=\"n\">p1</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">standalone_repro</span><span class=\"p\">.</span><span class=\"n\">standalone_repro</span><span class=\"p\">.</span><span class=\"mi\">10</span><span class=\"n\">d18315a1d024f1</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">1.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>\n<span class=\"w\">          </span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">paul</span><span class=\"p\">.</span><span class=\"n\">osborne</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">OpenSource</span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">-</span><span class=\"n\">bug</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">mangling</span><span class=\"o\">-</span><span class=\"n\">minrepro</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">was</span>\n<span class=\"n\">ip1</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">standalone_repro</span><span class=\"p\">.</span><span class=\"n\">standalone_repro</span><span class=\"p\">.</span><span class=\"mi\">10</span><span class=\"n\">d18315a1d024f1</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">3.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>\n</code></pre></div>\n<p>With LTO enabled, linking \"succeeds\" but emits incorrect code that traps at runtime (for the cases we ran into, at signature validation checks).</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/rust-lang/rust/issues/148347\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/3dca635fb50ba97d8b8b0231e4893d0af5d09511/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343762336266633466653734366537396532666434633333303165373139313930363738393233346237393161666136626137353935313832396264386638332f727573742d6c616e672f727573742f6973737565732f313438333437&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/rust-lang/rust/issues/148347\" title=\"Wasm Linker &quot;module mismatch for symbol&quot; Regression in 1.91.0 路 Issue #148347 路 rust-lang/rust\">Wasm Linker \"module mismatch for symbol\" Regression in 1.91.0 路 Issue #148347 路 rust-lang/rust</a></div><div class=\"message_embed_description\">Additional notes and repro cases: https://github.com/posborne/rustc-1.91.0-wasm-linkage-bug-repro With the Rust 1.91.0 stable update, it appears that a regression has been introduced which causes l...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/posborne/rustc-1.91.0-wasm-linkage-bug-repro\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/944d5a3bd390ecb57da6d9e51a78bfca649cbd12/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343738393062346439323134313163333465623864383937613763613034343937326235646265643464633630396264656538386131623762633631376265652f706f73626f726e652f72757374632d312e39312e302d7761736d2d6c696e6b6167652d6275672d726570726f&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/posborne/rustc-1.91.0-wasm-linkage-bug-repro\" title=\"GitHub - posborne/rustc-1.91.0-wasm-linkage-bug-repro: Repro and notes for apparent rustc defect in 1.91.0\">GitHub - posborne/rustc-1.91.0-wasm-linkage-bug-repro: Repro and notes for apparent rustc defect in 1.91.0</a></div><div class=\"message_embed_description\">Repro and notes for apparent rustc defect in 1.91.0 - posborne/rustc-1.91.0-wasm-linkage-bug-repro</div></div></div>",
        "id": 548250169,
        "sender_full_name": "Paul Osborne",
        "timestamp": 1761947430
    },
    {
        "content": "<p>A new stable release 1.91.1 with a fix for this issue backported is available in 1.91.1.  Thank you <span class=\"user-mention\" data-user-id=\"264278\">@bjorn3</span> and <span class=\"user-mention\" data-user-id=\"253994\">@Alex Crichton</span> </p>\n<p><a href=\"https://blog.rust-lang.org/2025/11/10/Rust-1.91.1/\">https://blog.rust-lang.org/2025/11/10/Rust-1.91.1/</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://blog.rust-lang.org/2025/11/10/Rust-1.91.1/\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/147ecc3caab69e5abda8478c67ed1c5c29a30233/68747470733a2f2f7777772e727573742d6c616e672e6f72672f7374617469632f696d616765732f727573742d736f6369616c2d776964652e6a7067&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://blog.rust-lang.org/2025/11/10/Rust-1.91.1/\" title=\"Announcing Rust 1.91.1 | Rust Blog\">Announcing Rust 1.91.1 | Rust Blog</a></div><div class=\"message_embed_description\">Empowering everyone to build reliable and efficient software.</div></div></div>",
        "id": 554797063,
        "sender_full_name": "Paul Osborne",
        "timestamp": 1762810994
    }
]