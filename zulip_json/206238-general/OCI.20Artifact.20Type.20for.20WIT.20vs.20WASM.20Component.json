[
    {
        "content": "<p>Hi everyone. I'm wondering if there are specific/well-known/standard OCI artifact types that differ WIT interfaces from component implementations. Does anyone know?</p>",
        "id": 569057760,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1768922889
    },
    {
        "content": "<p>At present, AFAIK there is no distinction between an WIT-only component and a WIT + implementation component as far as OCI artifacts types are concerned. </p>\n<p>There is only the one media type so far:</p>\n<p><a href=\"https://tag-runtime.cncf.io/wgs/wasm/deliverables/wasm-oci-artifact/\">https://tag-runtime.cncf.io/wgs/wasm/deliverables/wasm-oci-artifact/</a></p>\n<p>IF you are trying to gather imports/exports AFAICT that information should be present in the metadata if you can retrieve it from the registry, but you need (for example <code>skopeo inspect</code> does not yet support the wasm media type)</p>\n<p>IIRC the OCI artifact came into being <em>before</em> we even had WIT-as-components, so I'm not sure that could have happened at the time without some faith and foresight. </p>\n<p>That said, sufficiently intelligent proxies or registries can differentiate between a interface-only component and components that contain implementations with a bit of extra work, though I'm not sure if that's a reasonable solution for your use case!</p>\n<p>Would you mind sharing a bit more about why you'd want this distinction/what you're trying to do with the distinction? Is knowing interfaces enough? Are you trying to avoid potential waste of bandwidth?</p>",
        "id": 569062361,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1768923784
    },
    {
        "content": "<p>it is entirely possible to extract and then attach the wit as a referrer to the component artifact as well, so as ONLY to pull that metadata without any artifact if it's necessary. but if you are <em>searching</em> for some component in OCI that api hasn't yet been agreed upon......</p>",
        "id": 569068610,
        "sender_full_name": "Ralph",
        "timestamp": 1768925161
    },
    {
        "content": "<p>do you KNOW the component wit you want, or do you NOT know but might examine many?</p>",
        "id": 569068683,
        "sender_full_name": "Ralph",
        "timestamp": 1768925176
    },
    {
        "content": "<p>Thanks Victor and Ralph! That helps a lot.</p>\n<p><span class=\"user-mention\" data-user-id=\"268586\">@Ralph</span> we are currently implementing the referrer approach I believe. So clients should be able to discover WIT via the referrers API without pulling the full component.</p>\n<p>For the artifact types, I'm planning to use:</p>\n<ul>\n<li>application/vnd.wasm.component.v1+wasm for the component implementation</li>\n<li>application/vnd.wasm.wit.v1+wasm for the WIT interface (attached as referrer)<br>\nSince there doesn't exist a convention for this currently. </li>\n</ul>\n<p>I suppose the main benefit of going with distinct types really is the referrers API filtering.</p>\n<p>I just hope it won't be a pain to use existing tooling with... <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 569143035,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1768950229
    },
    {
        "content": "<p>tagging <span class=\"user-mention\" data-user-id=\"371962\">@Josh Dolitsky</span> and <span class=\"user-mention\" data-user-id=\"344849\">@Yosh Wuyts</span> for viz</p>",
        "id": 569207046,
        "sender_full_name": "Ralph",
        "timestamp": 1768988177
    },
    {
        "content": "<p>we're working on existing tooling and more robust OCI search support in dist as well, but that takes some time. :-)</p>",
        "id": 569207391,
        "sender_full_name": "Ralph",
        "timestamp": 1768988219
    },
    {
        "content": "<p>Awesome! From what I've gathered so far, I think having a standard vnd type for WASM Components vs WIT may be a good thing long term...</p>",
        "id": 569208288,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1768988412
    },
    {
        "content": "<p>There's this: <a href=\"https://component-model.bytecodealliance.org/composing-and-distributing/distributing.html\">https://component-model.bytecodealliance.org/composing-and-distributing/distributing.html</a></p>",
        "id": 569208694,
        "sender_full_name": "Ralph",
        "timestamp": 1768988504
    },
    {
        "content": "<p>then this: <a href=\"https://opensource.microsoft.com/blog/2024/09/25/distributing-webassembly-components-using-oci-registries\">https://opensource.microsoft.com/blog/2024/09/25/distributing-webassembly-components-using-oci-registries</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://opensource.microsoft.com/blog/2024/09/25/distributing-webassembly-components-using-oci-registries\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/065cff48252d270d71a7c5d2b5bee4cfbe5a6198/68747470733a2f2f7777772e6d6963726f736f66742e636f6d2f656e2d75732f6f70656e736f757263652f626c6f672f323032342f30392f32352f6d656469615f31666539393332386536306365363661323966633638366131383362613363663065646432306165312e6a70673f77696474683d3132303026666f726d61743d706a7067266f7074696d697a653d6d656469756d&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://opensource.microsoft.com/blog/2024/09/25/distributing-webassembly-components-using-oci-registries\" title=\"Distributing WebAssembly components using OCI registries - Microsoft Open Source Blog\">Distributing WebAssembly components using OCI registries - Microsoft Open Source Blog</a></div><div class=\"message_embed_description\">Learn to integrate Wasm OCI Artifacts leveraging the power of OCI registries to simplify deployment of WebAssembly components across the cloud-native ecosystem. Learn more</div></div></div>",
        "id": 569209715,
        "sender_full_name": "Ralph",
        "timestamp": 1768988784
    },
    {
        "content": "<p>and that refers to the formal guidelines for now: <a href=\"https://tag-runtime.cncf.io/wgs/wasm/deliverables/wasm-oci-artifact/\">https://tag-runtime.cncf.io/wgs/wasm/deliverables/wasm-oci-artifact/</a></p>",
        "id": 569209891,
        "sender_full_name": "Ralph",
        "timestamp": 1768988835
    },
    {
        "content": "<p>note, however, that nothing refers to how you can USE or extend it -- for example, with referrers. That makes a lot of sense, as you can also embed SBOM information in a component, and extract that and push that as a referrer: <a href=\"https://vimeo.com/1068598093\">Vimeo - sboms</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://vimeo.com/1068598093\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/ae6179e1fa8c3da3e1a775208d80d27dd28a95c1/68747470733a2f2f692e76696d656f63646e2e636f6d2f766964656f2f313939363734363130312d396561663437643532633565616535373132666230616336313234373132636562393835316436316164326166356664333238386131313332373631343961662d643f663d7765627026726567696f6e3d7573&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://vimeo.com/1068598093\" title=\"sboms\">sboms</a></div><div class=\"message_embed_description\">This is &quot;sboms&quot; by Ralph Squillace on Vimeo, the home for high quality videos and the people who love them.</div></div></div>",
        "id": 569210229,
        "sender_full_name": "Ralph",
        "timestamp": 1768988940
    },
    {
        "content": "<p>Finally, also realize that though components have this format, it's not a complete \"spec\" yet though most runtimes and tools involving components use it. Therefore, if you think it should be modified, make a suggestion!</p>",
        "id": 569210411,
        "sender_full_name": "Ralph",
        "timestamp": 1768988996
    },
    {
        "content": "<p>app hosting platforms like spin or wasmcloud for example may use a different format as a wrapper, because they're also pushing and pulling an entire solution including config files, for example. But it's all currently based upon that guideline document, and your favorite OCI tool CAN interact right now (including docker).</p>",
        "id": 569210773,
        "sender_full_name": "Ralph",
        "timestamp": 1768989090
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"268586\">Ralph</span> <a href=\"#narrow/channel/206238-general/topic/OCI.20Artifact.20Type.20for.20WIT.20vs.20WASM.20Component/near/569207046\">said</a>:</p>\n<blockquote>\n<p>tagging <span class=\"user-mention silent\" data-user-id=\"371962\">Josh Dolitsky</span> and <span class=\"user-mention silent\" data-user-id=\"344849\">Yosh Wuyts</span> for viz</p>\n</blockquote>\n<p>cc/ <span class=\"user-mention\" data-user-id=\"691146\">@Josh Duffney</span> ?</p>",
        "id": 569248154,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1769000509
    },
    {
        "content": "<p>I haven't thought too much about this proposal, but yeah I can definitely see value in distinguishing in the metadata between a \"shared, reusable interface\" and \"actual runnable program\"</p>",
        "id": 569250352,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1769001077
    },
    {
        "content": "<p>One question though: how can we tell that distinction just from looking at a <code>.wasm</code> file?</p>",
        "id": 569250491,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1769001118
    },
    {
        "content": "<p>one approach would be to say that the .wit is just metadata on its own; which is true. as a result, it would best be a referrer pointing at the implementing component.</p>",
        "id": 569253602,
        "sender_full_name": "Ralph",
        "timestamp": 1769001961
    },
    {
        "content": "<p>however, a component with no implementation but containing the wit is simply the same thing, but with component wrapping</p>",
        "id": 569253685,
        "sender_full_name": "Ralph",
        "timestamp": 1769001983
    },
    {
        "content": "<p>the diff is that with a referrer you can download ONLY the wit  without any impl, but if left in the component, you MUST make two calls: one for the manifest, one for the artifact and THEN extract the wit.</p>",
        "id": 569253846,
        "sender_full_name": "Ralph",
        "timestamp": 1769002033
    },
    {
        "content": "<p>I think the question is whether wit should be delivered as a \"component\"</p>",
        "id": 569254293,
        "sender_full_name": "Ralph",
        "timestamp": 1769002159
    },
    {
        "content": "<p>past history: IDL for COM components was embedded in a typelib which was shipped as a .dll so that existing processes could load and read it. This is functionally equivalent of what we're doing at this point here.</p>",
        "id": 569254724,
        "sender_full_name": "Ralph",
        "timestamp": 1769002266
    },
    {
        "content": "<p>it was essentially a traveling SDK that could be read by existing tooling</p>",
        "id": 569254881,
        "sender_full_name": "Ralph",
        "timestamp": 1769002299
    },
    {
        "content": "<p>again, the same here</p>",
        "id": 569254897,
        "sender_full_name": "Ralph",
        "timestamp": 1769002303
    },
    {
        "content": "<p>is there a scenario for .wit information <em>outside</em> of the component wrapping?</p>",
        "id": 569255017,
        "sender_full_name": "Ralph",
        "timestamp": 1769002331
    },
    {
        "content": "<p>because the overhead of the component wrapping is quite minimal if there's no impl</p>",
        "id": 569255082,
        "sender_full_name": "Ralph",
        "timestamp": 1769002352
    },
    {
        "content": "<p>and the only question I can see is <em>how easy is it to find the WIT you're looking for</em>?</p>",
        "id": 569255160,
        "sender_full_name": "Ralph",
        "timestamp": 1769002379
    },
    {
        "content": "<p>OCI is not optimized for pure throughput or search, but it CAN work fine so long as you do not try to scan the entire registry for something</p>",
        "id": 569255261,
        "sender_full_name": "Ralph",
        "timestamp": 1769002405
    },
    {
        "content": "<p>but again, that's something we could change. All registries do have the ability to scan artifacts and create a db of their contents, but that's computationally expensive and of course also has compliance issues: not all regions of the world would consider that a reasonable thing to do!</p>",
        "id": 569255592,
        "sender_full_name": "Ralph",
        "timestamp": 1769002496
    },
    {
        "content": "<p>so my take is the following:<br>\n<span class=\"user-mention\" data-user-id=\"755747\">@Lorenzo Fontoura</span> is doing the right thing to <em>optimized</em> the consumption of WIT by stashing it in the referrer (but it would also be in the component in any case). This would enable current tooling to examine the WIT without looking for the artifact itself.</p>",
        "id": 569255895,
        "sender_full_name": "Ralph",
        "timestamp": 1769002582
    },
    {
        "content": "<p>nothing wrong with that, and it's merely and ADDITION to the registry retaining the component in any case.</p>",
        "id": 569256260,
        "sender_full_name": "Ralph",
        "timestamp": 1769002691
    },
    {
        "content": "<p>but I'd love to hear what others think</p>",
        "id": 569256284,
        "sender_full_name": "Ralph",
        "timestamp": 1769002700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"268586\">Ralph</span> <a href=\"#narrow/channel/206238-general/topic/OCI.20Artifact.20Type.20for.20WIT.20vs.20WASM.20Component/near/569254293\">said</a>:</p>\n<blockquote>\n<p>I think the question is whether wit should be delivered as a \"component\"</p>\n</blockquote>\n<p>Not sure if I understand it correctly, as I'm not familiar with the spec of the wasm binary itself, but is it the case then that there's no way to tell it is a WIT-only file? It makes a lot of sense to me for there to be a flag or something in the wasm binary to indicate that it is a WIT-only file and has no component implementation. But in my specific case I suppose this isn't really required, as the artifact type already specifies it. I'd agree that for practical purposes the overhead is negligible in this case, but I don't have much context so my opinion here is probably not very meaningful!</p>",
        "id": 569311686,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1769015936
    },
    {
        "content": "<p>well, no, it is important to design this experience as best we can. \"components\" are artifacts -- files -- that conform to the component specification-in-flight. what is <em>inside them</em> is left up to the discretion of the creator.</p>",
        "id": 569312086,
        "sender_full_name": "Ralph",
        "timestamp": 1769016042
    },
    {
        "content": "<p>it is assumed that a component containing a module could only have any functionality if it had exports, and WIT is used to define those exports, therefore wit must be exposed (or imported).</p>",
        "id": 569312302,
        "sender_full_name": "Ralph",
        "timestamp": 1769016098
    },
    {
        "content": "<p>but WIT isn't the component at least at first blush; it's a file (or some string representation thereof, like WAT)</p>",
        "id": 569312459,
        "sender_full_name": "Ralph",
        "timestamp": 1769016133
    },
    {
        "content": "<p>OCI just says, \"if you've got a mediaType I know, you can store it here.\" But that could quite literally be anything, so the guidance document is just a strong suggestion about that mediaType.</p>",
        "id": 569312667,
        "sender_full_name": "Ralph",
        "timestamp": 1769016183
    },
    {
        "content": "<p>currently, we know the wit is already IN the component, so we have a <code>wasm-tools</code> command that extracts the WIT for you from that artifact. Of course in OCI, to <strong>get</strong> that you must download the component. :-)</p>",
        "id": 569313122,
        "sender_full_name": "Ralph",
        "timestamp": 1769016304
    },
    {
        "content": "<p>now, nothing can change about that, but if you WANT to be able to download ONLY the wit directly from OCI, it can be:</p>\n<ol>\n<li>extracted from the component to a .wit file (and/or the json representation)</li>\n<li>push it back up to the repo as a referrer with its own mediaType (good idea!) and link it to the component</li>\n</ol>",
        "id": 569313808,
        "sender_full_name": "Ralph",
        "timestamp": 1769016493
    },
    {
        "content": "<p>which is what I believe you suggested you are doing, which is great</p>",
        "id": 569313853,
        "sender_full_name": "Ralph",
        "timestamp": 1769016505
    },
    {
        "content": "<p>because the component remains there, unmodified, and if you KNOW there's the wit, you can actually just grab that from the referrer</p>",
        "id": 569313919,
        "sender_full_name": "Ralph",
        "timestamp": 1769016531
    },
    {
        "content": "<p>our objective, ultimately, is to have the registry recognize components and expose their wit in the interface.</p>",
        "id": 569314117,
        "sender_full_name": "Ralph",
        "timestamp": 1769016564
    },
    {
        "content": "<p>Right... I see your point.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"268586\">Ralph</span> <a href=\"#narrow/channel/206238-general/topic/OCI.20Artifact.20Type.20for.20WIT.20vs.20WASM.20Component/near/569255017\">said</a>:</p>\n<blockquote>\n<p>is there a scenario for .wit information <em>outside</em> of the component wrapping?</p>\n</blockquote>\n<p>WIT read efficiency for OCI registries, at least <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> </p>\n<p><span class=\"user-mention silent\" data-user-id=\"268586\">Ralph</span> <a href=\"#narrow/channel/206238-general/topic/OCI.20Artifact.20Type.20for.20WIT.20vs.20WASM.20Component/near/569314117\">said</a>:</p>\n<blockquote>\n<p>our objective, ultimately, is to have the registry recognize components and expose their wit in the interface.</p>\n</blockquote>\n<p>Ah this makes sense. I suppose it's a question then of whether there are other scenarios where the wit by itself would be useful in the long term.</p>",
        "id": 569314784,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1769016730
    },
    {
        "content": "<p>the wit is just the formal statement of imports and exports, so it will ALWAYS be in any component impl. The question is what if you need something YOU want to implement? How do you ship JUST that .wit file?</p>",
        "id": 569314977,
        "sender_full_name": "Ralph",
        "timestamp": 1769016782
    },
    {
        "content": "<p>realistically, if all the tooling uses components with oci, just putting it in a component \"package\" is fine.</p>",
        "id": 569315122,
        "sender_full_name": "Ralph",
        "timestamp": 1769016827
    },
    {
        "content": "<p>as far as WIT read efficiency, OCI isn't good for outbound at scale, definitely -- but it works!!! look at all the containers out there. :-)</p>",
        "id": 569315374,
        "sender_full_name": "Ralph",
        "timestamp": 1769016899
    },
    {
        "content": "<p>the only scenario in which <em>optimizing</em> wit retrieval makes sense is in a scenario in which the WIT, relative to the componentizing of the WIT alone, has a massive difference. That's just not the case.</p>",
        "id": 569315553,
        "sender_full_name": "Ralph",
        "timestamp": 1769016943
    },
    {
        "content": "<p>but if you had a pattern for the referrers wit, that would in theory eliminate one call. i doubt it's really worth it, but it will work...</p>",
        "id": 569315916,
        "sender_full_name": "Ralph",
        "timestamp": 1769017040
    },
    {
        "content": "<p>Well my use case is a registry interface. So I'd like to render the WIT/imports/exports in a UI, and having to fetch all component implementation for that seems inefficient</p>\n<p>e.g. search all components, look at their interfaces and dependency graphs</p>",
        "id": 569316217,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1769017118
    },
    {
        "content": "<p>right! yeah, we'd like to get to that stage at some point, too.</p>",
        "id": 569316452,
        "sender_full_name": "Ralph",
        "timestamp": 1769017182
    },
    {
        "content": "<p>unless you OWN the uploading to the registry and all components, you're going to have to extract wit <em>somewhere</em>, either on push or on search or just go ahead and scan them all and build your dep tree</p>",
        "id": 569316675,
        "sender_full_name": "Ralph",
        "timestamp": 1769017243
    },
    {
        "content": "<p>how, precisely, would you expect a component FILE to indicate it was WIT only without parsing it anyway?</p>",
        "id": 569316899,
        "sender_full_name": "Ralph",
        "timestamp": 1769017307
    },
    {
        "content": "<p>but if you REQUIRE wit pushed as a referrer, yes, that would definitely help you</p>",
        "id": 569316979,
        "sender_full_name": "Ralph",
        "timestamp": 1769017331
    },
    {
        "content": "<p>you could have a task on push that did the same....</p>",
        "id": 569317033,
        "sender_full_name": "Ralph",
        "timestamp": 1769017348
    },
    {
        "content": "<p>Sorry, I accidentally hit that!</p>",
        "id": 569348252,
        "sender_full_name": "Leslie Carr",
        "timestamp": 1769026989
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"268586\">Ralph</span> <a href=\"#narrow/channel/206238-general/topic/OCI.20Artifact.20Type.20for.20WIT.20vs.20WASM.20Component/near/569316899\">said</a>:</p>\n<blockquote>\n<p>how, precisely, would you expect a component FILE to indicate it was WIT only without parsing it anyway?</p>\n</blockquote>\n<p>I agree, my suggestion there was more me not understanding how the component wrapping worked I think. But I follow your logic. I wouldn't need that in my case anyway I don't think, the only nice-to-have in my situation would be for there to be standard artifact types.</p>",
        "id": 569380942,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1769039713
    },
    {
        "content": "<p>if you wsanna propose a wit mediaType, nothing wrong with that</p>",
        "id": 569454665,
        "sender_full_name": "Ralph",
        "timestamp": 1769077897
    },
    {
        "content": "<p>The \"WIT\" in a component is mostly just the type of that component, and there are still some component types that are valid but inexpressible in WIT (although we work to reduce that gap), so I would suggest thinking about just having a smaller binary with the (still binary-encoded) type of the component, instead of trying to turn it back into textual WIT that may or may not exist for a given component.</p>",
        "id": 569474341,
        "sender_full_name": "Lucy Menon",
        "timestamp": 1769084200
    },
    {
        "content": "<p>Another important consideration here: WIT is not going to have the same backward-compatibility guarantees as the binary format, at least in the medium-term I think. We distribute interfaces as binary component types in part because it is a more stable format.</p>",
        "id": 569497901,
        "sender_full_name": "Lann Martin",
        "timestamp": 1769090676
    },
    {
        "content": "<p>that's a very good point.</p>",
        "id": 569499649,
        "sender_full_name": "Ralph",
        "timestamp": 1769091086
    }
]