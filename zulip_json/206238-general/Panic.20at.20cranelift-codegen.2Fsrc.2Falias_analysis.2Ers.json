[
    {
        "content": "<p>If I set <code>enable_verifier = false</code> to get a speedup (with <code>opt_level = \"speed\"</code>), I get a panic in alias analysis:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">epilys</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">1949</span><span class=\"n\">cf8c6b5b557f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.123.2</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">alias_analysis</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">232</span><span class=\"p\">:</span><span class=\"mi\">76</span><span class=\"p\">:</span>\n<span class=\"nc\">called</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Option</span><span class=\"p\">::</span><span class=\"n\">unwrap</span><span class=\"p\">()</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">None</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">value</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">__rustc</span><span class=\"p\">::</span><span class=\"n\">rust_begin_unwind</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">option</span><span class=\"p\">::</span><span class=\"n\">unwrap_failed</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">alias_analysis</span><span class=\"p\">::</span><span class=\"n\">AliasAnalysis</span><span class=\"p\">::</span><span class=\"n\">compute_block_input_states</span><span class=\"p\">::{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">alias_analysis</span><span class=\"p\">::</span><span class=\"n\">AliasAnalysis</span><span class=\"p\">::</span><span class=\"n\">new</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">context</span><span class=\"p\">::</span><span class=\"n\">Context</span><span class=\"p\">::</span><span class=\"n\">optimize</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">context</span><span class=\"p\">::</span><span class=\"n\">Context</span><span class=\"p\">::</span><span class=\"n\">compile_stencil</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">context</span><span class=\"p\">::</span><span class=\"n\">Context</span><span class=\"p\">::</span><span class=\"n\">compile</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cranelift_jit</span><span class=\"p\">::</span><span class=\"n\">backend</span><span class=\"p\">::</span><span class=\"n\">JITModule</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">cranelift_module</span><span class=\"p\">::</span><span class=\"n\">module</span><span class=\"p\">::</span><span class=\"n\">Module</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">define_function_with_control_plane</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>This must be a bug, but while trying to work around it I found something that might also be a bug: Setting <code>enable_alias_analysis = false</code> in the flags does not make a difference.</p>\n<p>In fact searching for \"alias_analysis\" string in the wasmtime repo does not yield any instances of the flag setting been read. Is it being ignored?</p>\n<p>I'm not sure if <code>enable_alias_analysis = false</code> should be a valid workaround. If it should be I can file two separate bugs.</p>",
        "id": 539548672,
        "sender_full_name": "Manos Pitsidianakis",
        "timestamp": 1757940691
    }
]