[
    {
        "content": "<p>How do I generate a instance type definition that includes a resource?</p>\n<p>I have a wit interface like:</p>\n<div class=\"codehilite\" data-code-language=\"wit\"><pre><span></span><code>    interface df-interface {\n        resource data-frame;\n        fromcsv: func(path: string) -&gt; data-frame;\n        show: func(frame: data-frame) -&gt; s64;\n    }\n</code></pre></div>\n<p>My compiler generates an instance type like:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span>\n<span class=\"w\">               </span><span class=\"p\">(</span><span class=\"n\">instance</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">rep</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"DataFrame\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">2</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"s\">\"path\"</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"fromcsv\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">3</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">rep</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">4</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"DataFrame\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">5</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"s\">\"frame\"</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">s64</span><span class=\"p\">)))</span>\n<span class=\"w\">                 </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"show\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">)))</span>\n<span class=\"w\">               </span><span class=\"p\">)</span>\n<span class=\"w\">             </span><span class=\"p\">)</span>\n</code></pre></div>\n<p>The idea is that I can then import an instance of that type. However the wasmparser validation reports that resources can only be defined in concrete components (i.e. not from within the instance type definition)</p>\n<p>I don't see another way to define the instance type while defining the resource outside of it. </p>\n<p>Do I need to define these functions as methods on the dataframe resource? I plan to have many _constructors_ of a data-frame resource i.e. fromjson etc. So I decided it best to define functions instead.</p>",
        "id": 562562857,
        "sender_full_name": "Nathaniel Cook",
        "timestamp": 1765229949
    },
    {
        "content": "<p>For this you can use <code>wasm-tools component wit -t</code> which encodes a <code>*.wit</code> package in wasm. For example with this input:</p>\n<div class=\"codehilite\" data-code-language=\"wit\"><pre><span></span><code>package a:b;\n\ninterface df-interface {\n  resource data-frame;\n  fromcsv: func(path: string) -&gt; data-frame;\n  show: func(frame: data-frame) -&gt; s64;\n}\n</code></pre></div>\n<p>it outputs:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">t</span>\n<span class=\"p\">(</span><span class=\"n\">component</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">component</span>\n<span class=\"w\">      </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"n\">instance</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"data-frame\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">sub</span><span class=\"w\"> </span><span class=\"n\">resource</span><span class=\"p\">)))</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">own</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">2</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"s\">\"path\"</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"fromcsv\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)))</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">3</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"s\">\"frame\"</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">s64</span><span class=\"p\">)))</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"show\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)))</span>\n<span class=\"w\">        </span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"a:b/df-interface\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">    </span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"s\">\"df-interface\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"o\">@</span><span class=\"n\">custom</span><span class=\"w\"> </span><span class=\"s\">\"package-docs\"</span><span class=\"w\"> </span><span class=\"s\">\"</span><span class=\"se\">\\0</span><span class=\"s\">1{}\"</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"o\">@</span><span class=\"n\">producers</span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">processed</span><span class=\"o\">-</span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"s\">\"wit-component\"</span><span class=\"w\"> </span><span class=\"s\">\"0.243.0\"</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">)</span>\n<span class=\"p\">)</span>\n</code></pre></div>",
        "id": 562563216,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765230100
    },
    {
        "content": "<p>This worked, thanks for the help and direction to answer similar questions in the future. <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span></p>",
        "id": 562579039,
        "sender_full_name": "Nathaniel Cook",
        "timestamp": 1765238815
    }
]