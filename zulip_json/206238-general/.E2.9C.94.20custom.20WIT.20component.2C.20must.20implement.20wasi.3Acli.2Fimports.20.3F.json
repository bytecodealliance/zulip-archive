[
    {
        "content": "<p>Cool, I answered my own question. So, if I include stuff like wasi:cli into my custom world, I need to copy <a href=\"https://docs.wasmtime.dev/api/src/wasmtime_wasi/p2/bindings.rs.html#385\">this line</a> so that my host implementation bindgen looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">        </span><span class=\"n\">with</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"c1\">// All interfaces in the wasi:io package should be aliased to</span>\n<span class=\"w\">            </span><span class=\"c1\">// the wasmtime-wasi-io generated code. Note that this will also</span>\n<span class=\"w\">            </span><span class=\"c1\">// map the resource types to those defined in that crate as well.</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:io/poll\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi_io</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">poll</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:io/streams\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi_io</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">streams</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:io/error\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi_io</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">error</span><span class=\"p\">,</span>\n\n<span class=\"w\">            </span><span class=\"c1\">// Configure all other resources to be concrete types defined in</span>\n<span class=\"w\">            </span><span class=\"c1\">// this crate</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:sockets/network/network\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">network</span><span class=\"p\">::</span><span class=\"n\">Network</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:sockets/tcp/tcp-socket\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">TcpSocket</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:sockets/udp/udp-socket\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">UdpSocket</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:sockets/udp/incoming-datagram-stream\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">udp</span><span class=\"p\">::</span><span class=\"n\">IncomingDatagramStream</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:sockets/udp/outgoing-datagram-stream\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">udp</span><span class=\"p\">::</span><span class=\"n\">OutgoingDatagramStream</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:sockets/ip-name-lookup/resolve-address-stream\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">ip_name_lookup</span><span class=\"p\">::</span><span class=\"n\">ResolveAddressStream</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:filesystem/types/directory-entry-stream\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">ReaddirIterator</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:filesystem/types/descriptor\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">Descriptor</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:cli/terminal-input/terminal-input\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">stdio</span><span class=\"p\">::</span><span class=\"n\">TerminalInput</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"s\">\"wasi:cli/terminal-output/terminal-output\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">crate</span><span class=\"p\">::</span><span class=\"n\">p2</span><span class=\"p\">::</span><span class=\"n\">stdio</span><span class=\"p\">::</span><span class=\"n\">TerminalOutput</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">});</span>\n</code></pre></div>\n<p>Then, I link with:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">myplugin</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"o\">&amp;</span><span class=\"n\">linkeropts</span><span class=\"p\">,</span><span class=\"o\">|</span><span class=\"n\">f</span><span class=\"o\">|</span><span class=\"n\">f</span><span class=\"p\">);</span>\n</code></pre></div>",
        "id": 540639993,
        "sender_full_name": "Joel",
        "timestamp": 1758441264
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"948912\">Joel</span> has marked this topic as resolved.</p>",
        "id": 540639996,
        "sender_full_name": "Notification Bot",
        "timestamp": 1758441276
    }
]