[
    {
        "content": "<p>I am defining and hosting a component, everything is in Rust, I use wit-bindgen for the boilerplate as described in the docs and everything works fine.</p>\n<p>The component has both imported and exported interfaces, and the host implements the imported ones.</p>\n<p>However, there is a thing I need to do that is blocking me: inside hosted functions, I need to manipulate the available fuel (using <code>get_fuel</code> and <code>set_fuel</code> on the store).</p>\n<p>The problem is that the \"hosted object\" (the <code>T</code> in the <code>Store&lt;T&gt;</code>) cannot access the store, and I did not find a way to expose it.</p>\n<p>If I did all the bindings by hand I think I could do what I need, using the <code>Caller</code> interface: the <code>Caller</code> would receive the call, and it could call the hosted function implementation passing the store to it.</p>\n<p>But with the traits implemented by wit-bindgen this looks impossible to me.<br>\nAnd doing all the bindings by hand would be extra-annoying.<br>\nAm I missing something?</p>",
        "id": 537302855,
        "sender_full_name": "Massimiliano Mantione",
        "timestamp": 1756824412
    },
    {
        "content": "<p>It's correct that you can't access the store with default bindings, yes. The eventual end goal, however, is to support the <code>store</code> flag to imports/exports when generating bindings on the Wasmtime side of things (similar to the <code>async</code>, <code>trappable</code>, <code>tracing</code>, etc flags). Right now if you use just <code>store</code> it'll probably panic as the implementation isn't filled out yet, but if you use <code>async | store</code> you'll have access to the store (but you'll have to use async too)</p>",
        "id": 537304915,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756824998
    },
    {
        "content": "<p>basically, this is on me to write up an issue about enabling this in Wasmtime. You're otherwise not missing anything, it's not possible to do this with generated bindings. What you can do, however, is don't use the generated bindings for functions that need access to fuel (it's a difficult option to use but theoretically possible, e.g. skip bindings for certain functions)</p>",
        "id": 537305054,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756825047
    },
    {
        "content": "<p>As a temporary workaround you could expand the <code>generate!</code> macro and copy the bits you need into a manual implementation.</p>",
        "id": 537320187,
        "sender_full_name": "Lann Martin",
        "timestamp": 1756829264
    },
    {
        "content": "<p>Thanks for the prompt reply!<br>\nUsing <code>async | store</code> and I <em>forced</em> to use async hosted functions, or can I just keep using regular ones?<br>\n(I'll try it out, but asking is faster...)</p>",
        "id": 537321913,
        "sender_full_name": "Massimiliano Mantione",
        "timestamp": 1756829847
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253994\">@Alex Crichton</span> <br>\nIs there an open issue about the <code>store</code> feature?</p>",
        "id": 537322090,
        "sender_full_name": "Massimiliano Mantione",
        "timestamp": 1756829908
    },
    {
        "content": "<p>Yes you're force to use async with <code>async | store</code>, and no I haven't opened an issue yet</p>",
        "id": 537322187,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756829942
    },
    {
        "content": "<blockquote>\n<p>As a temporary workaround you could expand the <code>generate!</code> macro and copy the bits you need into a manual implementation.</p>\n</blockquote>\n<p>I was considering editing the automatically generated bindings.<br>\nOnce I freeze the wit file this might be the best compromise for now.</p>\n<p>Is using the <code>bindgen</code> macro or the <code>wit-bindgen</code> CLI command the same thing?<br>\nRight now I am using the macro on the host side, but I could switch to the CLI command with an explicitly generated file, which then I would modify.<br>\nDoes this make sense?</p>",
        "id": 537322487,
        "sender_full_name": "Massimiliano Mantione",
        "timestamp": 1756830056
    },
    {
        "content": "<p>The <code>wit-bindgen</code> CLI tool currently only supports guests and has no integration with Wasmtime (despite the crate in Wasmtime having the same name). So on the host you can only use <code>bindgen!</code> and there's no other option</p>",
        "id": 537322622,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756830105
    },
    {
        "content": "<p>Ok, I have already used <code>cargo expand</code> to navigate my way in the generated code.<br>\nI could just use that, save the file, and start from there...<br>\nFor now, <em>thanks!</em> <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span></p>",
        "id": 537322891,
        "sender_full_name": "Massimiliano Mantione",
        "timestamp": 1756830186
    },
    {
        "content": "<p>Ok I wrote up an issue at <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11590\">https://github.com/bytecodealliance/wasmtime/issues/11590</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/11590\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/08892c5428030abc844f9f3989d831f24155cdb2/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646566323566343963366236393266643037333265356262383135343065303461383634323361363833353433646437353733396631653335346137343163652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131353930&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/11590\" title=\"Support accessing the store in `bindgen!` · Issue #11590 · bytecodealliance/wasmtime\">Support accessing the store in `bindgen!` · Issue #11590 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">The bindgen! macro was redesigned in #11328 to have a more flexible configuration of imports/exports/flags. One of the motivations for doing this was to expose the concept of store as a flag on imp...</div></div></div>",
        "id": 537338863,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756835939
    }
]