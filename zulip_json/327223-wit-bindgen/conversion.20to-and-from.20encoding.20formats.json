[
    {
        "content": "<p>Hey, I've got a code organization question: so <code>wit-bindgen</code> today is fine with taking in WIT and producing bindings to some other language. But what if we wanted to do the reverse as well? E.g. parse some data format and produce WIT from that?</p>\n<ul>\n<li>Would that fit the <code>wit-bindgen</code> repository model?</li>\n<li>If so, what would the right naming convention for that be?</li>\n<li>What if we didn't just want to generate WIT from that, but also a shim component that does the translation. Would that fit?</li>\n</ul>",
        "id": 562493447,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765207045
    },
    {
        "content": "<p>I'm asking because I think of wit-bindgen as a swiss army knife of format conversions. The ideal place for programming language bindings generations is probably with the languages themselves. But when we're working with data formats and markup languages instead of programming languages, it's less clear who should own that. And <code>wit-bindgen</code> seems a great place for that.</p>",
        "id": 562494183,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765207187
    },
    {
        "content": "<p>to the degree we have any precedent for this question, it'd point towards <code>wasm-tools</code> being the right place: the only WIT-generating functionality I'm aware of right now is going from a <code>.wasm</code> file to a <code>.wit</code> file using `wasm-tools component wit</p>",
        "id": 562503832,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1765209423
    },
    {
        "content": "<p>IIUC you're thinking of introducing sort of the inverse of wit-bindgen, which would take <em>something else</em> and emit WIT representing an interface expressed in that <em>something</em>? Where the <em>something</em> could presumably be some other IDL, or a source project to reflect on?</p>",
        "id": 562504153,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1765209507
    },
    {
        "content": "<p>I feel like today we already have component equivalents of the <a href=\"https://github.com/rust-lang/rust-bindgen\"><code>bindgen</code> crate</a> (Rust -&gt; C). What I'm wondering about is how to add crates that do the equivalent to the <a href=\"https://github.com/mozilla/cbindgen\"><code>cbindgen</code> crate</a> (C -&gt; Rust). So yes, inverse is correct!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/rust-lang/rust-bindgen\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/1116798c46aae8f400390e476e647086803ae4d4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f326639613965353336363639336561333962313362343438343430393638613332313165326263343831373433356363343338326330376138383965646162342f727573742d6c616e672f727573742d62696e6467656e&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/rust-lang/rust-bindgen\" title=\"GitHub - rust-lang/rust-bindgen: Automatically generates Rust FFI bindings to C (and some C++) libraries.\">GitHub - rust-lang/rust-bindgen: Automatically generates Rust FFI bindings to C (and some C++) libraries.</a></div><div class=\"message_embed_description\">Automatically generates Rust FFI bindings to C (and some C++) libraries. - rust-lang/rust-bindgen</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/mozilla/cbindgen\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/734e84724b3186ba0ff6b9d4dfbf76ed41c95fba/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f626261316133396431353136626364383632303234346238616663313165306466376363313163393737323164343065373836393337653534343637346330392f6d6f7a696c6c612f6362696e6467656e&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/mozilla/cbindgen\" title=\"GitHub - mozilla/cbindgen: A project for generating C bindings from Rust code\">GitHub - mozilla/cbindgen: A project for generating C bindings from Rust code</a></div><div class=\"message_embed_description\">A project for generating C bindings from Rust code - mozilla/cbindgen</div></div></div>",
        "id": 562505088,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765209763
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"234973\">Till Schneidereit</span> <a href=\"#narrow/channel/327223-wit-bindgen/topic/conversion.20to-and-from.20encoding.20formats/near/562503832\">said</a>:</p>\n<blockquote>\n<p>to the degree we have any precedent for this question, it'd point towards <code>wasm-tools</code> being the right place: the only WIT-generating functionality I'm aware of right now is going from a <code>.wasm</code> file to a <code>.wit</code> file using `wasm-tools component wit</p>\n</blockquote>\n<p>hmmm, that doesn't feel as intuitive to me. For me <code>wasm-tools</code> cares about Wasm-only things. Where <code>.wasm</code> to <code>.wit</code> feels like a Wasm-to-Wasm conversion.</p>",
        "id": 562505409,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765209862
    },
    {
        "content": "<p>Do you mean to swap the Rust&lt;-&gt;C directions of cbindgen/bindgen? Or put another way, are you wondering if we can have <code>#[wit_bindgen]</code> which looks like <code>#[wasm_bindgen]</code>?</p>",
        "id": 562505477,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765209884
    },
    {
        "content": "<p>haa, okay let me make it more concrete: right now the main thing I'm looking at is a JSON Schema -&gt; WIT conversion. But in the future that might be neat to extend to maybe generate the conversion code too, as a standalone components.</p>",
        "id": 562505748,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765209971
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253994\">Alex Crichton</span> <a href=\"#narrow/channel/327223-wit-bindgen/topic/conversion.20to-and-from.20encoding.20formats/near/562505477\">said</a>:</p>\n<blockquote>\n<p>Do you mean to swap the Rust&lt;-&gt;C directions of cbindgen/bindgen? Or put another way, are you wondering if we can have <code>#[wit_bindgen]</code> which looks like <code>#[wasm_bindgen]</code>?</p>\n</blockquote>\n<p>Though unrelated to what I'm looking at right now, I'd love this too. Just not something I have the bandwidth for right now.</p>",
        "id": 562505899,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765210020
    },
    {
        "content": "<p>Do you mean like converting openapi to wit?</p>",
        "id": 562506284,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765210138
    },
    {
        "content": "<p>yeah that's very similar</p>",
        "id": 562506334,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765210151
    },
    {
        "content": "<p>What do you mean by \"generate the conversion code\"? Do you mean generate the thing that converts openapi to wit?</p>",
        "id": 562506414,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765210172
    },
    {
        "content": "<p>In Wassette we have <a href=\"https://github.com/microsoft/wassette/tree/main/crates/component2json\">component2json</a> which matches the polarity of everything else in wit-bindgen. What I'm looking at building is the reverse</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/microsoft/wassette/tree/main/crates/component2json\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/79576967a76c2766b7630bfe9eb0f63af838ecfb/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323333663664373065386133643163373330383136623434323734366532313735333061643236326562323930373935626264616234643537333134383965372f6d6963726f736f66742f7761737365747465&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/microsoft/wassette/tree/main/crates/component2json\" title=\"wassette/crates/component2json at main 路 microsoft/wassette\">wassette/crates/component2json at main 路 microsoft/wassette</a></div><div class=\"message_embed_description\">Wassette: A security-oriented runtime that runs WebAssembly Components via MCP - microsoft/wassette</div></div></div>",
        "id": 562506532,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765210212
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253994\">Alex Crichton</span> <a href=\"#narrow/channel/327223-wit-bindgen/topic/conversion.20to-and-from.20encoding.20formats/near/562506414\">said</a>:</p>\n<blockquote>\n<p>What do you mean by \"generate the conversion code\"? Do you mean generate the thing that converts openapi to wit?</p>\n</blockquote>\n<p>the first pass would be to convert the schema. So you have a JSON Schema and convert it to a .wit. The second pass would be to generate a parser component, which can take in JSON Schema messages, deserialize them, and invoke methods in a linked component.</p>",
        "id": 562506824,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765210308
    },
    {
        "content": "<p>That second pass is entirely out of scope for me for now tho. I'm mainly interested in mechanically translating one schema definition to another so the interfaces line up.</p>",
        "id": 562507105,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765210398
    },
    {
        "content": "<p>Oh I guess that's similar to <a href=\"https://github.com/wasi-gfx/webidl2wit\">webidl2wit</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/wasi-gfx/webidl2wit\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/0b26ac40c5473532d4446c067e086e6c712538fc/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f393661343461393437646434303538373139363532306439343536343364393162366465353165643262353832626631316537626263393033376166343862662f776173692d6766782f77656269646c32776974&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/wasi-gfx/webidl2wit\" title=\"GitHub - wasi-gfx/webidl2wit\">GitHub - wasi-gfx/webidl2wit</a></div><div class=\"message_embed_description\">Contribute to wasi-gfx/webidl2wit development by creating an account on GitHub.</div></div></div>",
        "id": 562507210,
        "sender_full_name": "Yosh Wuyts",
        "timestamp": 1765210425
    },
    {
        "content": "<p>To the best I understand this it all feels roughly outside of wit-bindgen's wheelhouse. Conversion from thing-to-wit is sort of a wasm-tools level thing, and then generating actually full binaries isn't really what wit-bindgen does (which instead just generates source code). So at least to me this naively seems like a different tool which doesn't fit in necessarily with wit-bindgen</p>",
        "id": 562524559,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765215845
    },
    {
        "content": "<p>I hacked rust-bindgen to read C headers and output wit files. Since I didn't spend too much time it is incomplete (no function declarations, not all data types) but should be a good starting point for experiments: <a href=\"https://github.com/cpetig/rust-bindgen\">https://github.com/cpetig/rust-bindgen</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/cpetig/rust-bindgen\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/6bb393be955f34f8f81b5081c1795c22f6c04c42/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623539623030366564343965636165326239666231323862323436396331656633336531346338613235643162663366366664336365363262326431363436322f6370657469672f727573742d62696e6467656e&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/cpetig/rust-bindgen\" title=\"GitHub - cpetig/rust-bindgen: Automatically generates Rust FFI bindings to C (and some C++) libraries.\">GitHub - cpetig/rust-bindgen: Automatically generates Rust FFI bindings to C (and some C++) libraries.</a></div><div class=\"message_embed_description\">Automatically generates Rust FFI bindings to C (and some C++) libraries. - cpetig/rust-bindgen</div></div></div>",
        "id": 562671151,
        "sender_full_name": "Christof Petig",
        "timestamp": 1765283288
    },
    {
        "content": "<p>Not exactly what you are asking about, but I also did a hacky thing in this vein earlier this year (that I never got around to finishing). In the <a href=\"https://github.com/landonxjames/smithy-wasm/blob/50270de4a06f9e8ff92b7bef826500edccece532/generator/src/main.rs\">smithy-wasm</a> repo I generate wit files from the <a href=\"https://smithy.io/2.0/index.html\">Smithy IDL</a> (well really from the compiled Smithy JSON AST). </p>\n<p>I work on the AWS Rust SDK and all of our service APIs are defined in Smithy. My eventual goal is to also generate Rust code to implement WASM versions of the SDK clients for all of our services. Never got time to move beyond the WIT generation though.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/landonxjames/smithy-wasm/blob/50270de4a06f9e8ff92b7bef826500edccece532/generator/src/main.rs\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/0d0c9733ab4b77357970b63df434658da1a4df9a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653434316439333264376261326263336131373034313538303261383334316330643231613939316534623931373836643131383334313830383466303337342f6c616e646f6e786a616d65732f736d697468792d7761736d&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/landonxjames/smithy-wasm/blob/50270de4a06f9e8ff92b7bef826500edccece532/generator/src/main.rs\" title=\"smithy-wasm/generator/src/main.rs at 50270de4a06f9e8ff92b7bef826500edccece532 路 landonxjames/smithy-wasm\">smithy-wasm/generator/src/main.rs at 50270de4a06f9e8ff92b7bef826500edccece532 路 landonxjames/smithy-wasm</a></div><div class=\"message_embed_description\">Smithy WASM clients . Contribute to landonxjames/smithy-wasm development by creating an account on GitHub.</div></div></div>",
        "id": 562852285,
        "sender_full_name": "Landon James",
        "timestamp": 1765337821
    }
]