[
    {
        "content": "<p>Working through the test cases in wasip3-prototyping I think I <em>may</em> have found a bug/weird corner -- for a test component like <code>async_backpressure_caller.component.wasm</code>, the <code>[async]run</code> import does not seem to have a result, but is detected as an async function by the latest version of tooling. </p>\n<p>In WIT the signature for the interface is:</p>\n<div class=\"codehilite\" data-code-language=\"wit\"><pre><span></span><code>package local:local;\n\n// ...\n\ninterface run {\n  run: async func();\n}\n\n// ...\n````\n\nThe world:\n\n```wit\nworld backpressure-caller {\n  import backpressure;\n  import run;\n  export run;\n}\n</code></pre></div>\n<p>Of course <code>async</code> is just a hint in the <code>run</code> interface, but what I'm finding is that the <code>backpressure-caller</code>'s import is actually getting picked up as an async import properly (<code>CanonicalOptions</code> reports the import <code>[async]run</code> as <code>async</code>), but the type of the actual imported function is invalid -- it's missing the usual return <code>i32</code>.</p>\n<p><code>backpressure_callee</code>'s <a href=\"https://github.com/bytecodealliance/wasip3-prototyping/blob/main/crates/test-programs/src/bin/async_backpressure_callee.rs#L19\"><code>run()</code> is async</a>, the WAT confirms an async lift:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"err\">....</span>\n<span class=\"err\">;</span><span class=\"mi\">11</span><span class=\"err\">;</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type2</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$__imported_wasi_snapshot_preview1_proc_exit</span> <span class=\"cm\">(;12;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type1</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"nv\">$#table0</span> <span class=\"cm\">(;0;)</span> <span class=\"mi\">79</span> <span class=\"mi\">79</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"nv\">$#memory0</span> <span class=\"cm\">(;0;)</span> <span class=\"mi\">17</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"nv\">$__stack_pointer</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"nb\">i32.const</span> <span class=\"mf\">1048576</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"nv\">$GOT.data.internal.__memory_base</span> <span class=\"cm\">(;1;)</span> <span class=\"kt\">i32</span> <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"nv\">$#memory0</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$_start</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__main_void\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$__main_void</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"local:local/backpressure#set-backpressure\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$local:local/backpressure#set-backpressure</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"[async-lift]local:local/run#[async]run\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"err\">$</span><span class=\"s2\">\"[async-lift]local:local/run#[async]run\"</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"[callback][async-lift]local:local/run#[async]run\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"err\">$</span><span class=\"s2\">\"[callback][async-lift]local:local/run#[async]run\"</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"cabi_realloc\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$cabi_realloc</span><span class=\"p\">))</span>\n<span class=\"err\">...</span>\n</code></pre></div>\n<p><code>backpressure_caller</code> code <a href=\"https://github.com/bytecodealliance/wasip3-prototyping/blob/main/crates/test-programs/src/bin/async_backpressure_caller.rs#L30\">treats the import from <code>backpressure_callee</code> as async</a>, the WAT confirms an async lower:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"err\">...</span>\n    <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;15;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"$root\"</span> <span class=\"s2\">\"[subtask-cancel]\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$_ZN14wit_bindgen_rt13async_support7subtask6cancel17h6ca32b751664aab8E</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">5</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"local:local/run\"</span> <span class=\"s2\">\"[async-lower][async]run\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$_ZN168_$LT$async_backpressure_caller..bindings..local..local..run..run..$u7b$$u7b$closure$u7d$$u7d$.._MySubtask$u20$as$u20$wit_bindgen_rt..async_support..subtask..Subtask$GT$11call_import4call17h0c04e01391ac0d1fE</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">9</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"local:local/backpressure\"</span> <span class=\"s2\">\"set-backpressure\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$_ZN25async_backpressure_caller8bindings5local5local12backpressure16set_backpressure11wit_import017hc771b6ca3da04845E</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"[export]local:local/run\"</span> <span class=\"s2\">\"[task-return][async]run\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$_ZN25async_backpressure_caller8bindings7exports5local5local3run22_export_async_run_cabi28_$u7b$$u7b$closure$u7d$$u7d$11wit_import017hd3657f94392c9a00E</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">3</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"$root\"</span> <span class=\"s2\">\"[waitable-join]\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$_ZN14wit_bindgen_rt13async_support12waitable_set4join17h7a11b9e1b4a3bcbdE</span> <span class=\"cm\">(;4;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"err\">...</span>\n</code></pre></div>\n<p>BUT, in that very same WAT (the caller), at the top the import stub shows a function with <em>no return values</em> (which should be impossible for something coming in async):</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code>  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type1</span> <span class=\"cm\">(;1;)</span>\n    <span class=\"p\">(</span><span class=\"err\">instance</span>\n      <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type0</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"nv\">$#func0</span> <span class=\"cm\">(;0;)</span> <span class=\"s2\">\"[async]run\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type0</span><span class=\"p\">)))</span>\n    <span class=\"p\">)</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"local:local/run\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance1</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type1</span><span class=\"p\">)))</span>\n\n<span class=\"c1\">;; ....</span>\n\n<span class=\"c1\">;; stub to make the import work</span>\n  <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"err\">instance</span> <span class=\"nv\">$#instance2</span> <span class=\"cm\">(;2;)</span>\n    <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"[async-lower][async]run\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$#func7</span><span class=\"p\">))</span>\n  <span class=\"p\">)</span>\n\n<span class=\"err\">...</span>\n\n<span class=\"c1\">;; instantiation of caller</span>\n  <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"err\">instance</span> <span class=\"nv\">$#instance7</span> <span class=\"cm\">(;7;)</span> <span class=\"p\">(</span><span class=\"err\">instantiate</span> <span class=\"nv\">$#module0</span>\n      <span class=\"p\">(</span><span class=\"err\">with</span> <span class=\"s2\">\"$root\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance1</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"err\">with</span> <span class=\"s2\">\"local:local/run\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance2</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"err\">with</span> <span class=\"s2\">\"local:local/backpressure\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance3</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"err\">with</span> <span class=\"s2\">\"[export]local:local/run\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance4</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"err\">with</span> <span class=\"s2\">\"[export]$root\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance5</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"err\">with</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"p\">(</span><span class=\"err\">instance</span> <span class=\"nv\">$#instance6</span><span class=\"p\">))</span>\n    <span class=\"p\">)</span>\n  <span class=\"p\">)</span>\n\n<span class=\"err\">...</span>\n</code></pre></div>\n<p>When I chase down the #instance2 -&gt; #func7 types for the function I end up here:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code>    <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type5</span> <span class=\"cm\">(;5;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>This is <em>also</em> not the right signature it should have the usual i32 result param. </p>\n<p>I don't have a minimal repro just yet (I will make one that just takes the component(s) in question and loads them into a <code>Resolve</code> and looks up the functions in question, since that's the code I'm working on is doing)... </p>\n<p><strong>Switching gears a little bit, maybe I can restate this whole thing more concisely:</strong></p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code>  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type25</span> <span class=\"cm\">(;25;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"err\">alias</span> <span class=\"err\">core</span> <span class=\"k\">export</span> <span class=\"nv\">$#instance7</span> <span class=\"s2\">\"[async-lift]local:local/run#[async]run\"</span> <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"nv\">$#func57</span> <span class=\"cm\">(;57;)</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"err\">alias</span> <span class=\"err\">core</span> <span class=\"k\">export</span> <span class=\"nv\">$#instance7</span> <span class=\"s2\">\"[callback][async-lift]local:local/run#[async]run\"</span> <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"nv\">$#func58</span> <span class=\"cm\">(;58;)</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$#func18</span> <span class=\"cm\">(;18;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$#type25</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"err\">canon</span> <span class=\"err\">l</span><span class=\"nb\">if</span><span class=\"err\">t</span> <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"nv\">$#func57</span><span class=\"p\">)</span> <span class=\"err\">async</span> <span class=\"p\">(</span><span class=\"nb\">call</span><span class=\"err\">back</span> <span class=\"nv\">$#func58</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>The above chunk of  WAT is from the caller -- the async run export <br>\n<a href=\"/user_uploads/15107/SwxHJ3xBLH4SI9f-oxq8bAqJ/async_backpressure_caller.component.wasm\">async_backpressure_caller.component.wasm</a><br>\ncannot have type 25 right? The <code>run: async func()</code> cannot actually have a type <code>(func)</code>, it must be at least <code>(func (result i32))</code></p>\n<p>I've attached the wasm below just for ease, but you can also get it (or the callee wasm) from p3-prototyping</p>\n<p><a href=\"/user_uploads/15107/SwxHJ3xBLH4SI9f-oxq8bAqJ/async_backpressure_caller.component.wasm\">async_backpressure_caller.component.wasm</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasip3-prototyping/blob/main/crates/test-programs/src/bin/async_backpressure_callee.rs#L19\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/94681858ccc7afed92b1bf53af2d925d0f1a49da/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303035666235303863343066623362356465383366313337356332353137303331626634306634343334363739663634383233653966623666376366386563612f62797465636f6465616c6c69616e63652f7761736970332d70726f746f747970696e67&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasip3-prototyping/blob/main/crates/test-programs/src/bin/async_backpressure_callee.rs#L19\" title=\"wasip3-prototyping/crates/test-programs/src/bin/async_backpressure_callee.rs at main · bytecodealliance/wasip3-prototyping\">wasip3-prototyping/crates/test-programs/src/bin/async_backpressure_callee.rs at main · bytecodealliance/wasip3-prototyping</a></div><div class=\"message_embed_description\">Fork of wasmtime for protoyping WASIp3 work and coordination, not intended for any production use case, purely for development - bytecodealliance/wasip3-prototyping</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasip3-prototyping/blob/main/crates/test-programs/src/bin/async_backpressure_caller.rs#L30\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/94681858ccc7afed92b1bf53af2d925d0f1a49da/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303035666235303863343066623362356465383366313337356332353137303331626634306634343334363739663634383233653966623666376366386563612f62797465636f6465616c6c69616e63652f7761736970332d70726f746f747970696e67&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasip3-prototyping/blob/main/crates/test-programs/src/bin/async_backpressure_caller.rs#L30\" title=\"wasip3-prototyping/crates/test-programs/src/bin/async_backpressure_caller.rs at main · bytecodealliance/wasip3-prototyping\">wasip3-prototyping/crates/test-programs/src/bin/async_backpressure_caller.rs at main · bytecodealliance/wasip3-prototyping</a></div><div class=\"message_embed_description\">Fork of wasmtime for protoyping WASIp3 work and coordination, not intended for any production use case, purely for development - bytecodealliance/wasip3-prototyping</div></div></div>",
        "id": 534537488,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1755195771
    },
    {
        "content": "<p>Keep in mind that the ABIs for async lifts and lowers are different.  You're right that the core signature of an async lifted function should always have an <code>i32</code> result, but the core signature of an async <em>lowered</em> function will not have a result if the component signature doesn't.  Does that help explain what you're seeing, or do you actually see an async-lifted function with a core signature that's missing a result type?</p>",
        "id": 534538618,
        "sender_full_name": "Joel Dice",
        "timestamp": 1755196201
    },
    {
        "content": "<p>Ah interesting -- so maybe this is what I'm seeing, but <a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/Async.md#async-import-abi\">the spec</a> says:</p>\n<blockquote>\n<p>Comparing signatures, the differences are:<br>\n* Async-lowered functions always have a single <code>i32</code> \"status\" code.</p>\n</blockquote>\n<p>Am I misreading it here? What is the call path supposed to be for the async lowered fn without a status code? Is the caller supposed to treat it just like a sync function?</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/Async.md#async-import-abi\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/715f55b67477f83544fcddfea31f4bbf5521c991/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373032663861333734633431643036613833376565653761363365356438623661666536326261616637643732663731376232643835333331653861383937392f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/Async.md#async-import-abi\" title=\"component-model/design/mvp/Async.md at main · WebAssembly/component-model\">component-model/design/mvp/Async.md at main · WebAssembly/component-model</a></div><div class=\"message_embed_description\">Repository for design and specification of the Component Model - WebAssembly/component-model</div></div></div>",
        "id": 534581326,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1755219424
    },
    {
        "content": "<p>Oops, sorry, I was misremembering.  Yeah, async lowers do always have a <code>i32</code> return code for the status.  I'll take a closer look at what you posted above tomorrow.  Sorry for the misinformation (and I wish I could edit older Zulip posts).</p>",
        "id": 534584949,
        "sender_full_name": "Joel Dice",
        "timestamp": 1755222908
    },
    {
        "content": "<p>Absolutely no problem, thanks for giving it some thought! I was kind of hoping I was just misreading/missing something obvious <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> , because now I'm wondering if this goes all the way to bindgen.</p>\n<blockquote>\n<p>and I wish I could edit older Zulip posts</p>\n</blockquote>\n<p>The number of times this has bit me...</p>",
        "id": 534649182,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1755263021
    },
    {
        "content": "<p>Okay, so looking at the <code>.wasm</code> file you posted:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"cm\">(;@1b5a  ;)</span>    <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"err\">$</span><span class=\"s2\">\"[async-lift]local:local/run#[async]run\"</span> <span class=\"cm\">(;32;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">9</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Looks correct; the core signature returns an <code>i32</code> result, as expected.</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"cm\">(;@1c37  ;)</span>    <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"err\">$</span><span class=\"s2\">\"[callback][async-lift]local:local/run#[async]run\"</span> <span class=\"cm\">(;33;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">7</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">))</span>\n</code></pre></div>\n<p>Also looks correct; all callbacks should have that exact core signature.</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"cm\">(;@1b5d1 ;)</span>  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;25;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n<span class=\"cm\">(;@1b5d8 ;)</span>  <span class=\"p\">(</span><span class=\"err\">alias</span> <span class=\"err\">core</span> <span class=\"k\">export</span> <span class=\"mi\">7</span> <span class=\"s2\">\"[async-lift]local:local/run#[async]run\"</span> <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"cm\">(;57;)</span><span class=\"p\">))</span>\n<span class=\"cm\">(;@1b603 ;)</span>  <span class=\"p\">(</span><span class=\"err\">alias</span> <span class=\"err\">core</span> <span class=\"k\">export</span> <span class=\"mi\">7</span> <span class=\"s2\">\"[callback][async-lift]local:local/run#[async]run\"</span> <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"cm\">(;58;)</span><span class=\"p\">))</span>\n<span class=\"cm\">(;@1b63b ;)</span>  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;18;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">25</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"err\">canon</span> <span class=\"err\">l</span><span class=\"nb\">if</span><span class=\"err\">t</span> <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"mi\">57</span><span class=\"p\">)</span> <span class=\"err\">async</span> <span class=\"p\">(</span><span class=\"nb\">call</span><span class=\"err\">back</span> <span class=\"mi\">58</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Also looks correct; this time, type 25 is the <em>lifted</em> (i.e. component-level) signature, which takes no parameters and returns no result, just like the WIT file said.  So I think it's all as expected?</p>",
        "id": 534664895,
        "sender_full_name": "Joel Dice",
        "timestamp": 1755269026
    },
    {
        "content": "<p>OK, maybe the code in Jco right now is looking at the wrong signature, and we need to actually dig for the core func that was pointed to by the lifted signature, I'll try to make that update and/or extract out the logic into a repro that's easier to read.</p>\n<p>Will be out on monday but should have something by tuesday!</p>",
        "id": 534729297,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1755307940
    }
]