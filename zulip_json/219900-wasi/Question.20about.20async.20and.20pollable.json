[
    {
        "content": "<p>For a while I've been wondering, why is it that wasi is leaning towards polling-based async design? I presume there's a good reason but I've been scratching my head for a while and I can't really think of one. Why not something like:</p>\n<div class=\"codehilite\" data-code-language=\"wit\"><pre><span></span><code>resource future {\n    stream: ...\n    await: func(response-handler);\n}\nresource response-handler {\n    receive: func( ... );\n}\n</code></pre></div>\n<p>with a usage such as (pseudocode just to show the concept)</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">foo</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">some_future</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">do_something_async</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"cm\">/* potentially do some stuff */</span>\n<span class=\"w\">    </span><span class=\"n\">some_future</span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">Handler</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">());</span>\n<span class=\"p\">}</span>\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Handler</span><span class=\"w\"> </span><span class=\"p\">{};</span>\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">ResponseHandler</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Handler</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">receive</span><span class=\"p\">(</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"cm\">/* continue work here */</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>This way there is no need for polling, the async function simply calls into the original caller once it has the data. Sure, this causes a loop of A calls into B::something_async and then it's B that calls back into A, but when our B is the host (which when you're implementing wasi is almost deffinetelly the case) this is a non-issue.</p>\n<p>I can definitely see the disadvantages of this dividing the code having to put a part of the body into an impl block but I don't think that's entirely unreasonable, especially when we're using codegen for bindings anyways. I also see the issue of receive() having different signatures depending on what it is that you're doing but I don't think the response-handler resource has to necessary be reusable, the few extra resource types don't really look like that big of a deal.</p>\n<p>Maybe it's just too convoluted, dunno, just curious</p>",
        "id": 569523042,
        "sender_full_name": "Forder",
        "timestamp": 1769096232
    },
    {
        "content": "<p>If you're referring to WASIp2's <code>wasi:io</code> package and its <code>pollable</code> resource type, you're right that it's awkward to use and makes composition-with-concurrency impractical.  Fortunately, <code>wasi:io</code> has been removed in favor of <a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/Concurrency.md\">Component Model Concurrency</a> in WASIp3, allowing bindings generators to use the concurrency idioms of their target guest languages (e.g. async/await for Rust, JS, Python, and C#; goroutines for Go, etc.)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/Concurrency.md\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/15dc5fd099c9a352d7b5621288d36f81fba9a6f0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303235623064383937383366616664333763636661326336373630373931336535643632636161336561306562373162663566373035616561333836373363362f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/Concurrency.md\" title=\"component-model/design/mvp/Concurrency.md at main · WebAssembly/component-model\">component-model/design/mvp/Concurrency.md at main · WebAssembly/component-model</a></div><div class=\"message_embed_description\">Repository for design and specification of the Component Model - WebAssembly/component-model</div></div></div>",
        "id": 569536394,
        "sender_full_name": "Joel Dice",
        "timestamp": 1769099315
    }
]