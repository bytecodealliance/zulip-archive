[
    {
        "content": "<p>Hi! I just found an interesting project <a href=\"https://github.com/mmcloughlin/arrival/tree/arrival/cranelift/isle/veri\"><code>arrival</code></a> which seems like the next-gen of <code>crocus</code>.</p>\n<p><a href=\"https://dl.acm.org/doi/pdf/10.1145/3764383\">The paper</a> says it can verify stateful rules (traps, ...) and more, unlike <code>crocus</code>. So it can verify broader group of rules than <code>crocus</code>.</p>\n<p>I want to use this tool for mid-end rules.<br>\nBut it looks like there is only a demonstration for a codegen backend (aarch64, x64, ...).<br>\nAnd the paper states it verifies a instruction-selection backend.<br>\nIs this possible to use this tool only for mid-end ISLE rules?</p>\n<p>Plus, I want to hear a plan to integrate project this into the upstream wasmtime/cranelift, if any, just like <code>crocus</code>.</p>\n<p>Thanks!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/mmcloughlin/arrival/tree/arrival/cranelift/isle/veri\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/fb28ca29b4aca43fa65cf31c2c660325e8676283/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623532656265303864343964643834633734363434316632663161346233393365303439626335326536643233653334623639626635386266336332636135302f6d6d636c6f7567686c696e2f6172726976616c&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/mmcloughlin/arrival/tree/arrival/cranelift/isle/veri\" title=\"arrival/cranelift/isle/veri at arrival 路 mmcloughlin/arrival\">arrival/cranelift/isle/veri at arrival 路 mmcloughlin/arrival</a></div><div class=\"message_embed_description\">Instruction-selection verifier for the Cranelift compiler. - mmcloughlin/arrival</div></div></div>",
        "id": 566201161,
        "sender_full_name": "Bongjun Jang",
        "timestamp": 1767507025
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"452638\">@Alexa VanHattum</span> and <span class=\"user-mention\" data-user-id=\"648178\">@Michael McLoughlin</span> for upstreaming plans -- I know that they want to do this soon-ish</p>",
        "id": 566277784,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1767590320
    },
    {
        "content": "<p>Yes, <code>arrival</code> also can be used for mid-end rules, though some of that work happened after the paper and some of the details (mostly for floating point) are work-in-progress. </p>\n<p>We are working on upstreaming this spring! I will try and see if we can prioritize landing the non-floating point stuff first to have it available to you sooner. Feel free to DM me if you'd like to locally run it sooner and I can try and put together instructions beyond the artifact details</p>",
        "id": 566818562,
        "sender_full_name": "Alexa VanHattum",
        "timestamp": 1767818009
    },
    {
        "content": "<p>Thanks for the reply!</p>\n<p>Good to hear the upstreaming plan. I'd like to verify a single mid-end rule (i.e. one rule of <code>simplify</code>) and run it locally. I have a few questions:</p>\n<ol>\n<li><a href=\"https://github.com/mmcloughlin/arrival/blob/arrival/cranelift/isle/veri/README.md\">The doc</a> shows how to run the verifier (<code>./script/veri.sh</code>). But on my machine, it crashes:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Writing</span><span class=\"w\"> </span><span class=\"n\">generated</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"p\">.</span><span class=\"n\">LixEWtIdyN</span><span class=\"o\">/</span><span class=\"n\">clif_opt</span><span class=\"p\">.</span><span class=\"n\">isle</span>\n<span class=\"n\">Writing</span><span class=\"w\"> </span><span class=\"n\">generated</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"p\">.</span><span class=\"n\">LixEWtIdyN</span><span class=\"o\">/</span><span class=\"n\">clif_lower</span><span class=\"p\">.</span><span class=\"n\">isle</span>\n<span class=\"p\">#</span><span class=\"mi\">0</span><span class=\"w\">      </span><span class=\"n\">iconst</span>\n<span class=\"w\">        </span><span class=\"n\">iconst</span><span class=\"p\">({</span><span class=\"n\">bits</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">int</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"n\">bv</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bv</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"w\">        </span><span class=\"n\">iconst</span><span class=\"p\">({</span><span class=\"n\">bits</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">int</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"n\">bv</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bv</span><span class=\"w\"> </span><span class=\"mi\">16</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"w\">        </span><span class=\"n\">iconst</span><span class=\"p\">({</span><span class=\"n\">bits</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">int</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"n\">bv</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bv</span><span class=\"w\"> </span><span class=\"mi\">32</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"w\">        </span><span class=\"n\">iconst</span><span class=\"p\">({</span><span class=\"n\">bits</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">int</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"n\">bv</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bv</span><span class=\"w\"> </span><span class=\"mi\">64</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"p\">#</span><span class=\"mi\">1</span><span class=\"w\">      </span><span class=\"n\">operand_size_32</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">#</span><span class=\"mi\">59</span><span class=\"w\">     </span><span class=\"n\">f64const</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"p\">#</span><span class=\"mi\">60</span><span class=\"w\">     </span><span class=\"n\">f64const</span>\n<span class=\"w\">                </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">solution</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solved</span>\n<span class=\"w\">                </span><span class=\"n\">applicability</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">applicable</span>\n<span class=\"w\">                </span><span class=\"n\">verification</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">success</span>\n<span class=\"p\">#</span><span class=\"mi\">61</span><span class=\"w\">     </span><span class=\"n\">f64const</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">expanding</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">emit_u64_le_const</span><span class=\"o\">'</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">no</span><span class=\"w\"> </span><span class=\"n\">spec</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">emit_u64_le_const</span>\n</code></pre></div>\n<p>Is it normal to miss the spec for the term <code>emit_u64_le_const</code>?</p>\n<ol start=\"2\">\n<li>Is there a spec written for the mid-end rules?</li>\n<li>I think I can verify mid-end rules one-by-one by removing rules other than the rule I want to verify. But there should be a better way to do this. When verifying a set of rules with <code>arrival</code>, can I see which rules are verified and which rules are not?</li>\n</ol>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/mmcloughlin/arrival/blob/arrival/cranelift/isle/veri/README.md\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/fb28ca29b4aca43fa65cf31c2c660325e8676283/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623532656265303864343964643834633734363434316632663161346233393365303439626335326536643233653334623639626635386266336332636135302f6d6d636c6f7567686c696e2f6172726976616c&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/mmcloughlin/arrival/blob/arrival/cranelift/isle/veri/README.md\" title=\"arrival/cranelift/isle/veri/README.md at arrival 路 mmcloughlin/arrival\">arrival/cranelift/isle/veri/README.md at arrival 路 mmcloughlin/arrival</a></div><div class=\"message_embed_description\">Instruction-selection verifier for the Cranelift compiler. - mmcloughlin/arrival</div></div></div>",
        "id": 567450718,
        "sender_full_name": "Bongjun Jang",
        "timestamp": 1768200723
    }
]