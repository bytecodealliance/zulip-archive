[
    {
        "content": "<p>Hi, reading <a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md\">https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md</a>,</p>\n<p>I find it a little challenging to decide whether I should use <code>subsume</code> or not,<br>\nand I think it would be a good idea to clarify more on using <code>subsume</code>s.</p>\n<p>It only says to use <code>subsume</code> when the rule discards values on LHS, and not to use it when it only discards constants. However, there are rules contradictory to the principle:</p>\n<p>these rules only discard constants but use <code>subsume</code>:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16\">https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16</a></p>\n<p>these rules use <code>subsume</code> does not discard any value on LHS:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39\">https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39</a></p>\n<p>Thanks for reading!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/4176f6de7ac20f6e6830f90d3f2ad197998dafea/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376336643565376435343430623533363230343364353462346437313432623931616633393463623338336464316333373838636439303661346136643466322f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md\" title=\"wasmtime/cranelift/codegen/src/opts/README.md at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime\">wasmtime/cranelift/codegen/src/opts/README.md at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/4176f6de7ac20f6e6830f90d3f2ad197998dafea/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376336643565376435343430623533363230343364353462346437313432623931616633393463623338336464316333373838636439303661346136643466322f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16\" title=\"wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime\">wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/4176f6de7ac20f6e6830f90d3f2ad197998dafea/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376336643565376435343430623533363230343364353462346437313432623931616633393463623338336464316333373838636439303661346136643466322f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39\" title=\"wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime\">wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>",
        "id": 558886508,
        "sender_full_name": "Bongjun Jang",
        "timestamp": 1763895934
    },
    {
        "content": "<p>We have the \"available locations\" analysis now that makes rule 2 unnecessary there -- I should update that README, sorry!</p>",
        "id": 558917478,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1763926740
    },
    {
        "content": "<p>In general, subsume is quite important for compilation performance (I have some data showing this I'll present at some point) but use of it is not necessary semantically. You can think of it as \"I am so sure that this rewrite makes things better that you should always take it and discard the original\"</p>",
        "id": 558917536,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1763926790
    },
    {
        "content": "<p>so for example, with constant propagation we use it because it's always better to replace a dynamic ALU operation with a literal constant</p>",
        "id": 558917594,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1763926824
    },
    {
        "content": "<p>thanks!</p>",
        "id": 558960046,
        "sender_full_name": "Bongjun Jang",
        "timestamp": 1763965907
    }
]