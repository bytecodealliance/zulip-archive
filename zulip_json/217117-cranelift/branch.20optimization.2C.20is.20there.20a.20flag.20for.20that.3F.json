[
    {
        "content": "<p>Hello! I am compiling a Scheme and there are some cases like primitive ops like <code>#%heap-object?</code> which are emitted separately from branch during compilation and cranelift produces code like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"n\">d</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"w\"> </span><span class=\"n\">fa</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\">             </span><span class=\"n\">cmp</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x12</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r10b</span>\n<span class=\"w\"> </span><span class=\"mi\">481</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"w\"> </span><span class=\"n\">c1</span><span class=\"w\">                </span><span class=\"n\">sete</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">cl</span>\n<span class=\"w\"> </span><span class=\"mi\">484</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"n\">c9</span><span class=\"w\">                   </span><span class=\"n\">test</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">cl</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">cl</span>\n<span class=\"w\"> </span><span class=\"mi\">486</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">je</span><span class=\"w\">     </span><span class=\"mi\">510</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fn0</span><span class=\"p\">:</span><span class=\"nc\">false</span><span class=\"o\">+</span><span class=\"mh\">0x220</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n<p>Is there any way to actually avoid that and get something more decent as in <code>cmp</code> and then directly <code>je</code>? Or is my only option to make changes to my codegen?</p>",
        "id": 536880790,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756519009
    },
    {
        "content": "<p>Would it be possible to extract the CLIF that leads to this codegen? This might be a missing pattern in optimizations or a missing pattern in lowering, and the CLIF can help narrow it down as to which</p>",
        "id": 536881931,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756520819
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253994\">Alex Crichton</span> <a href=\"#narrow/channel/217117-cranelift/topic/branch.20optimization.2C.20is.20there.20a.20flag.20for.20that.3F/near/536881931\">said</a>:</p>\n<blockquote>\n<p>Would it be possible to extract the CLIF that leads to this codegen? This might be a missing pattern in optimizations or a missing pattern in lowering, and the CLIF can help narrow it down as to which</p>\n</blockquote>\n<p>I would not be able to extract it at the moment, but it looks like this during codegen:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">is_false</span><span class=\"p\">(</span><span class=\"n\">ssa</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">SSABuilder</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ir</span><span class=\"p\">::</span><span class=\"n\">Value</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">ir</span><span class=\"p\">::</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">     </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">is_false</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ssa</span><span class=\"p\">.</span><span class=\"n\">builder</span><span class=\"p\">.</span><span class=\"n\">ins</span><span class=\"p\">().</span><span class=\"n\">icmp_imm</span><span class=\"p\">(</span><span class=\"n\">IntCC</span><span class=\"p\">::</span><span class=\"n\">Equal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">::</span><span class=\"n\">VALUE_FALSE</span><span class=\"p\">);</span>\n<span class=\"w\">     </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ssa</span><span class=\"p\">.</span><span class=\"n\">builder</span><span class=\"p\">.</span><span class=\"n\">ins</span><span class=\"p\">().</span><span class=\"n\">iconst</span><span class=\"p\">(</span><span class=\"n\">types</span><span class=\"p\">::</span><span class=\"n\">I64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">::</span><span class=\"n\">VALUE_FALSE</span><span class=\"p\">);</span>\n<span class=\"w\">     </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ssa</span><span class=\"p\">.</span><span class=\"n\">builder</span><span class=\"p\">.</span><span class=\"n\">ins</span><span class=\"p\">().</span><span class=\"n\">iconst</span><span class=\"p\">(</span><span class=\"n\">types</span><span class=\"p\">::</span><span class=\"n\">I64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">::</span><span class=\"n\">VALUE_TRUE</span><span class=\"p\">);</span>\n<span class=\"w\">     </span><span class=\"n\">ssa</span><span class=\"p\">.</span><span class=\"n\">builder</span><span class=\"p\">.</span><span class=\"n\">ins</span><span class=\"p\">().</span><span class=\"n\">select</span><span class=\"p\">(</span><span class=\"n\">is_false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">emit_if</span><span class=\"p\">(</span><span class=\"n\">ssa</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">SSABuilder</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LVar</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kcons</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LVar</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kalt</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LVar</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">     </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">is_false</span><span class=\"p\">(</span><span class=\"n\">ssa</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ssa</span><span class=\"p\">.</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"n\">var</span><span class=\"p\">));</span>\n<span class=\"w\">     </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">is_false</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">builder</span><span class=\"p\">.</span><span class=\"n\">ins</span><span class=\"p\">().</span><span class=\"n\">icmp_imm</span><span class=\"p\">(</span><span class=\"n\">IntCC</span><span class=\"p\">::</span><span class=\"n\">Equal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">is_false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">::</span><span class=\"n\">VALUE_FALSE</span><span class=\"p\">);</span>\n<span class=\"w\">     </span><span class=\"n\">ssa</span><span class=\"p\">.</span><span class=\"n\">builder</span><span class=\"p\">.</span><span class=\"n\">ins</span><span class=\"p\">().</span><span class=\"n\">brif</span><span class=\"p\">(</span><span class=\"n\">is_false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.)</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 536882255,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756521252
    },
    {
        "content": "<p>so it seems there's no rewrite for <code>select</code> + <code>icmp</code> + <code>brif</code></p>",
        "id": 536882306,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756521327
    },
    {
        "content": "<p>I got a half working solution at the moment but I was expecting Cranelift being able to rewrite such combination of select + brif</p>",
        "id": 536882343,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756521368
    },
    {
        "content": "<p>A naive attempt:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">):</span>\n<span class=\"w\">  </span><span class=\"nc\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">select</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span>\n<span class=\"w\">  </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block2</span>\n\n<span class=\"n\">block1</span><span class=\"p\">:</span>\n<span class=\"w\">  </span><span class=\"nc\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v6</span>\n\n<span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">  </span><span class=\"nc\">v7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v7</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>shows what I would expect with <code>cargo run -p cranelift-tools compile foo.clif --target x86_64 -D --set opt_level=speed</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Disassembly</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"w\"> </span><span class=\"o\">&lt;%</span><span class=\"n\">a</span><span class=\"o\">&gt;</span><span class=\"p\">:</span>\n<span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">55</span><span class=\"w\">                      </span><span class=\"n\">pushq</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">e5</span><span class=\"w\">                </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\">                   </span><span class=\"n\">testl</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">edi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">edi</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">je</span><span class=\"w\">      </span><span class=\"mh\">0x16</span>\n<span class=\"w\">   </span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"nc\">b8</span><span class=\"w\"> </span><span class=\"mi\">02</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">movl</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\">                </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                      </span><span class=\"n\">popq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"nc\">c3</span><span class=\"w\">                      </span><span class=\"n\">retq</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"nc\">b8</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">movl</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"n\">b</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\">                </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"n\">e</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                      </span><span class=\"n\">popq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"n\">f</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"nc\">c3</span><span class=\"w\">                      </span><span class=\"n\">retq</span>\n</code></pre></div>\n<p>To confirm, are you enabling optimizations in Cranelift?</p>",
        "id": 536884459,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756524406
    },
    {
        "content": "<p>yes, I do. Let me actually replicate this behavior again</p>",
        "id": 536884486,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756524427
    },
    {
        "content": "<p>Okay so here's the IR:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">v21</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_pinned_reg</span><span class=\"p\">.</span><span class=\"kt\">i64</span>\n<span class=\"w\">    </span><span class=\"n\">v50</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">562949953421310</span>\n<span class=\"w\">    </span><span class=\"n\">v24</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">band</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">v9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v50</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v50</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">562949953421310</span>\n<span class=\"w\">    </span><span class=\"n\">v49</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">v25</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"w\"> </span><span class=\"n\">v24</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v49</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v49</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">v23</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v25</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block7</span><span class=\"p\">(</span><span class=\"n\">v23</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">block6</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v23</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>and corresponding assembly:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\"> </span><span class=\"mi\">844</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ee</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r13</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r14</span>\n<span class=\"w\"> </span><span class=\"mi\">847</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r15</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rdi</span>\n<span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"n\">a</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">45</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"w\"> </span><span class=\"n\">c9</span><span class=\"w\">                </span><span class=\"n\">xor</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r9d</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r9d</span>\n<span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"n\">d</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"> </span><span class=\"n\">d4</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">test</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"mh\">0xd4</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">)</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">928</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cont1</span><span class=\"p\">:</span><span class=\"nc\">after_call17</span><span class=\"o\">+</span><span class=\"mh\">0x110</span><span class=\"o\">&gt;</span>\n<span class=\"w\"> </span><span class=\"mi\">854</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">jne</span><span class=\"w\">    </span><span class=\"mi\">864</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cont1</span><span class=\"p\">:</span><span class=\"nc\">after_call17</span><span class=\"o\">+</span><span class=\"mh\">0x4c</span><span class=\"o\">&gt;</span>\n<span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"n\">a</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b6</span><span class=\"w\"> </span><span class=\"mi\">06</span><span class=\"w\">             </span><span class=\"n\">movzbq</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rsi</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">rax</span>\n<span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"n\">e</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">3</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\">                   </span><span class=\"n\">cmp</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x12</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">al</span>\n<span class=\"w\"> </span><span class=\"mi\">860</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"w\"> </span><span class=\"n\">c1</span><span class=\"w\">             </span><span class=\"n\">sete</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">r9b</span>\n<span class=\"w\"> </span><span class=\"mi\">864</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">45</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"n\">c9</span><span class=\"w\">                </span><span class=\"n\">test</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">r9b</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r9b</span>\n<span class=\"w\"> </span><span class=\"mi\">867</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">je</span><span class=\"w\">     </span><span class=\"mi\">8</span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cont1</span><span class=\"p\">:</span><span class=\"nc\">after_call17</span><span class=\"o\">+</span><span class=\"mh\">0xd9</span><span class=\"o\">&gt;</span>\n</code></pre></div>",
        "id": 536884691,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756524760
    },
    {
        "content": "<p>oh wait, I have trouble mapping the assembly to IR, let me simplify it further</p>",
        "id": 536884736,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756524837
    },
    {
        "content": "<p>Okay, I can't really reduce it, this is what I can get though:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">v21</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_pinned_reg</span><span class=\"p\">.</span><span class=\"kt\">i64</span>\n<span class=\"w\">    </span><span class=\"n\">v22</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn5</span><span class=\"p\">(</span><span class=\"n\">v21</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">v23</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">symbol_value</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">gv0</span>\n<span class=\"w\">    </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">v22</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v23</span>\n<span class=\"w\">    </span><span class=\"n\">v28</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_pinned_reg</span><span class=\"p\">.</span><span class=\"kt\">i64</span>\n<span class=\"w\">    </span><span class=\"n\">v27</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">func_addr</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">fn10</span>\n<span class=\"w\">    </span><span class=\"n\">v81</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">v20</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">v29</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn9</span><span class=\"p\">(</span><span class=\"n\">v28</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v27</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v81</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v20</span><span class=\"p\">)</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v81</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v20</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">v30</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">load</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">v29</span><span class=\"o\">+</span><span class=\"mi\">16</span>\n<span class=\"w\">    </span><span class=\"n\">v31</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">symbol_value</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">gv1</span>\n<span class=\"w\">    </span><span class=\"n\">v32</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">load</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">v31</span>\n<span class=\"w\">    </span><span class=\"n\">v33</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_pinned_reg</span><span class=\"p\">.</span><span class=\"kt\">i64</span>\n<span class=\"w\">    </span><span class=\"n\">v34</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn6</span><span class=\"p\">(</span><span class=\"n\">v33</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v29</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">v35</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">symbol_value</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">gv2</span>\n<span class=\"w\">    </span><span class=\"n\">v36</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">load</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">v35</span>\n<span class=\"w\">    </span><span class=\"n\">v79</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">562949953421310</span>\n<span class=\"w\">    </span><span class=\"n\">v37</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">band</span><span class=\"w\"> </span><span class=\"n\">v36</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v79</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v79</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">562949953421310</span>\n<span class=\"w\">    </span><span class=\"n\">v38</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v37</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v81</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v81</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">v40</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n<span class=\"w\">    </span><span class=\"n\">v39</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">v41</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">select</span><span class=\"w\"> </span><span class=\"n\">v38</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v40</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v39</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v40</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v39</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v41</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block7</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\"> </span><span class=\"mi\">371</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"mh\">0x2c50</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r11</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">fc8</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">capy_define</span><span class=\"o\">@</span><span class=\"n\">Base</span><span class=\"o\">&gt;</span>\n<span class=\"w\"> </span><span class=\"mi\">378</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">c2</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rdx</span>\n<span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"n\">b</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"n\">d3</span><span class=\"w\">                </span><span class=\"n\">call</span><span class=\"w\">   </span><span class=\"o\">*%</span><span class=\"n\">r11</span>\n<span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"n\">e</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">lea</span><span class=\"w\">    </span><span class=\"mh\">0x2c8b</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">rbx</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">3010</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cache_cell1</span><span class=\"o\">&gt;</span>\n<span class=\"w\"> </span><span class=\"mi\">385</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">b</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rbx</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r11</span>\n<span class=\"w\"> </span><span class=\"mi\">388</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">ba</span><span class=\"w\"> </span><span class=\"mi\">06</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x6</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r10d</span>\n<span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"n\">e</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">test</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">r11</span><span class=\"p\">,</span><span class=\"mh\">0x10b</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">)</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">a0</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fn0</span><span class=\"p\">:</span><span class=\"nc\">false</span><span class=\"o\">+</span><span class=\"mh\">0x1b0</span><span class=\"o\">&gt;</span>\n<span class=\"w\"> </span><span class=\"mi\">395</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">cmove</span><span class=\"w\">  </span><span class=\"mh\">0x10b</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r10</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">a8</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fn0</span><span class=\"p\">:</span><span class=\"nc\">false</span><span class=\"o\">+</span><span class=\"mh\">0x1b8</span><span class=\"o\">&gt;</span>\n<span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">00</span>\n<span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"n\">d</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\">                </span><span class=\"n\">test</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">r10</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r10</span>\n<span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">a0</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">jne</span><span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fn0</span><span class=\"p\">:</span><span class=\"nc\">false</span><span class=\"o\">+</span><span class=\"mh\">0x101</span><span class=\"o\">&gt;</span>\n</code></pre></div>",
        "id": 536884975,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756525126
    },
    {
        "content": "<p>Would you be able to further extract that to a standalone function?</p>",
        "id": 536885054,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756525256
    },
    {
        "content": "<p>yea, let me try that</p>",
        "id": 536885065,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756525270
    },
    {
        "content": "<p>how can I dump an assembly with cranelift-jit though? Or is my only option using cranelift-object?</p>",
        "id": 536885146,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756525399
    },
    {
        "content": "<p>ah that I'm not sure sorry</p>",
        "id": 536885322,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756525678
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span><span class=\"p\">:</span><span class=\"mi\">0</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"nc\">tail</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"nc\">tail</span>\n<span class=\"w\">    </span><span class=\"n\">sig1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"nc\">tail</span>\n\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"nc\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">band_imm</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">562949953421310</span>\n<span class=\"w\">    </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n<span class=\"w\">    </span><span class=\"n\">v7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">select</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">v8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span>\n\n<span class=\"n\">block1</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">return_call_indirect</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">)</span>\n\n<span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">return_call_indirect</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">sig1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">(</span><span class=\"n\">v2</span><span class=\"p\">)</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"mi\">0000000000000000</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"p\">.</span><span class=\"n\">Lfn0</span><span class=\"o\">&gt;</span><span class=\"p\">:</span>\n<span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">55</span><span class=\"w\">                      </span><span class=\"n\">push</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">e5</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">fa</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r10</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">b9</span><span class=\"w\"> </span><span class=\"mi\">06</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x6</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r9d</span>\n<span class=\"w\">   </span><span class=\"n\">d</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">test</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"mh\">0x2c</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">)</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"p\">.</span><span class=\"n\">Lfn0</span><span class=\"o\">+</span><span class=\"mh\">0x40</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">d3</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r11</span>\n<span class=\"w\">  </span><span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">cmove</span><span class=\"w\">  </span><span class=\"mh\">0x29</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r9</span><span class=\"w\">        </span><span class=\"p\">#</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"p\">.</span><span class=\"n\">Lfn0</span><span class=\"o\">+</span><span class=\"mh\">0x48</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"n\">e</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">00</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"n\">f</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">f9</span><span class=\"w\"> </span><span class=\"mi\">06</span><span class=\"w\">             </span><span class=\"n\">cmp</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x6</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r9</span>\n<span class=\"w\">  </span><span class=\"mi\">23</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">je</span><span class=\"w\">     </span><span class=\"mi\">36</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"p\">.</span><span class=\"n\">Lfn0</span><span class=\"o\">+</span><span class=\"mh\">0x36</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">29</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">f7</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rdi</span>\n<span class=\"w\">  </span><span class=\"mi\">2</span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r11</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsi</span>\n<span class=\"w\">  </span><span class=\"mi\">2</span><span class=\"n\">f</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">  </span><span class=\"mi\">32</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                      </span><span class=\"n\">pop</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">  </span><span class=\"mi\">33</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"n\">e2</span><span class=\"w\">                </span><span class=\"n\">jmp</span><span class=\"w\">    </span><span class=\"o\">*%</span><span class=\"n\">r10</span>\n<span class=\"w\">  </span><span class=\"mi\">36</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r11</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rdi</span>\n<span class=\"w\">  </span><span class=\"mi\">39</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                      </span><span class=\"n\">pop</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"n\">d</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"n\">e2</span><span class=\"w\">                </span><span class=\"n\">jmp</span><span class=\"w\">    </span><span class=\"o\">*%</span><span class=\"n\">r10</span>\n</code></pre></div>",
        "id": 536885468,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756525982
    },
    {
        "content": "<p>thanks! Simplified a tiny bit more to:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"nc\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">band_imm</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">562949953421310</span>\n<span class=\"w\">    </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n<span class=\"w\">    </span><span class=\"n\">v7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">select</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">v8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"n\">v7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">    </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span>\n\n<span class=\"n\">block1</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">100</span>\n<span class=\"w\">    </span><span class=\"n\">jump</span><span class=\"w\"> </span><span class=\"n\">block3</span><span class=\"p\">(</span><span class=\"n\">v9</span><span class=\"p\">)</span>\n\n<span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">v10</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">101</span>\n<span class=\"w\">    </span><span class=\"n\">jump</span><span class=\"w\"> </span><span class=\"n\">block3</span><span class=\"p\">(</span><span class=\"n\">v10</span><span class=\"p\">)</span>\n\n<span class=\"n\">block3</span><span class=\"p\">(</span><span class=\"n\">v11</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v11</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Looks like we don't have an optimization rule for this, no, but shouldn't be too hard to add! Mind filing an issue for this?</p>",
        "id": 536886149,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1756526835
    },
    {
        "content": "<p>sure, will do</p>",
        "id": 536886165,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756526852
    },
    {
        "content": "<p><a href=\"https://github.com/bytecodealliance/wasmtime/issues/11578\">https://github.com/bytecodealliance/wasmtime/issues/11578</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/11578\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/7444722e0e38e8c63a273cf940bf2d383677797f/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623633396139306535343764633530396664613535663366336566623236633231383765313338326637363333376639383966383433643764393436343662652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131353738&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/11578\" title=\"Cranelift: missing optimization on icmp + select + icmp + brif · Issue #11578 · bytecodealliance/wasmtime\">Cranelift: missing optimization on icmp + select + icmp + brif · Issue #11578 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Thanks for filing an issue! Please fill out the TODOs below. .clif Test Case function %a(i64) -&gt; i64 { block0(v2: i64): v3 = band_imm v2, -562949953421310 v4 = icmp_imm eq v3, 0 v5 = iconst.i64 6 v...</div></div></div>",
        "id": 536886412,
        "sender_full_name": "Adel Prokurov",
        "timestamp": 1756527151
    }
]