[
    {
        "content": "<p>I'm implementing the <a href=\"https://github.com/WebAssembly/compact-import-section\">custom import section proposal</a> in wasm-tools this week and just have a few questions about the implementation.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/compact-import-section\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/844992c9a7f3ed6a80c8fcc09062c521184dfac0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336264373530636638613739363230656138623036326130656234663133643937323364306664653430353365636432343565316635383665653337643430382f576562417373656d626c792f636f6d706163742d696d706f72742d73656374696f6e&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/compact-import-section\" title=\"GitHub - WebAssembly/compact-import-section: Proposal repository for compact import sections\">GitHub - WebAssembly/compact-import-section: Proposal repository for compact import sections</a></div><div class=\"message_embed_description\">Proposal repository for compact import sections. Contribute to WebAssembly/compact-import-section development by creating an account on GitHub.</div></div></div>",
        "id": 562517771,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765213607
    },
    {
        "content": "<p>The first and biggest question is: how should I update the binary parser to handle these groups of imports? Right now we have:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">ImportSectionReader</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">SectionLimited</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Import</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>But now the entries in the import section can contain multiple imports. So naively I would think I need to change <code>Import&lt;'a&gt;</code> to <code>Imports&lt;'a&gt;</code> (and declare that Imports type). But that would presumably cascade through the entire wasm-tools library in a pretty unpleasant way, no?</p>",
        "id": 562518062,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765213717
    },
    {
        "content": "<p>In the main spec (and SpiderMonkey) I was able to have the imports be a flat list in the module AST. Is that possible here? (Sorry for the noob question, I am not that familiar with the overall architecture of wasm-tools and how all the parts connect)</p>",
        "id": 562518185,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765213759
    },
    {
        "content": "<p>Or do we <em>want</em> to plumb that information all the way through so that text encodings like <code>(import \"foo\" (item \"bar\" type) (item \"baz\" type))</code> map to the new binary encoding and vice versa?</p>",
        "id": 562518437,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765213851
    },
    {
        "content": "<p>Also, this <code>skip</code> stuff from issue 188 really is a huge pain here, unless I'm missing something.</p>",
        "id": 562522988,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765215327
    },
    {
        "content": "<p>Yeah unfortunately wasm-tools is probably going to be more difficult than spidermonkey here because wasmparser tries to reflect (roughly) the AST of the module as opposed to specializing on just one embedding (e.g. \"just read all imports\" vs \"give me a parsed view of what all the imports look like\")</p>\n<p>Given that I think, yes, this'll result in <code>s/Import/Imports/</code>. We can add helper methods though to assist with \"just ignore the binary encoding and give me all the imports\", for example a method that auto-<code>flat_map</code>'s the result or something like that. Basically if you find yourself having to update a lot of code I'm happy to help out and come up with a way to reduce the boilerplate.</p>\n<p>For <code>skip</code>, yeah :(. At this point I feel that it's sort of just a fundamental design property (flaw?) of how <code>wasmparser</code> works and there'se not really any way around it unfortunately</p>",
        "id": 562525055,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765216043
    },
    {
        "content": "<p>Well, hopefully maybe I'm doing this right<br>\n<a href=\"/user_uploads/15107/eq9g1MmsqNte-hMVBJno3Imf/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/eq9g1MmsqNte-hMVBJno3Imf/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"799x488\" src=\"/user_uploads/thumbnail/15107/eq9g1MmsqNte-hMVBJno3Imf/image.png/840x560.webp\"></a></div>",
        "id": 562525168,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765216083
    },
    {
        "content": "<p>From a possibly naive point of view though I would agree and say that we do want to plumb the binary structure through <code>wasmparser</code> so, for example, <code>wasmprinter</code> could print the <code>(item ...)</code> form instead of the multi-<code>(import ...)</code> form</p>",
        "id": 562525192,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765216095
    },
    {
        "content": "<p>yeah that looks reasonable to me w.r.t. <code>skip</code></p>",
        "id": 562525290,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765216132
    },
    {
        "content": "<p>that one's definitely on us to fix that at some point</p>",
        "id": 562525316,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765216140
    },
    {
        "content": "<p>IIRC the only \"solution\" I could think of to <code>skip</code> was completely inverting control flow to instead of \"pull things from an iterator\" it's \"<code>wasmparser</code> pushes things into a trait you provide\"</p>",
        "id": 562525624,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765216253
    },
    {
        "content": "<p>Hopping back here for an open-ended question, I'm trying to figure out how to write the reencoder stuff to map from wasmparser::Imports to wasm_encoder::core::Imports</p>",
        "id": 562757548,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765302925
    },
    {
        "content": "<p>in a very copy-pastey sort of way, I have set up the types like so:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"sd\">/// TODO</span>\n<span class=\"cp\">#[derive(Clone, Debug)]</span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">ImportCompact</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"sd\">/// TODO</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">a</span><span class=\"w\"> </span><span class=\"kt\">str</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"sd\">/// TODO</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">EntityType</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"sd\">/// TODO</span>\n<span class=\"cp\">#[derive(Clone, Debug)]</span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">ImportGroupCompact1</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"sd\">/// TODO</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">a</span><span class=\"w\"> </span><span class=\"kt\">str</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"sd\">/// TODO</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">items</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Cow</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">ImportCompact</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">]</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 562757667,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765302951
    },
    {
        "content": "<p>But a) I have no idea what the <code>Cow</code> is doing for me, and b) I have no idea how to map over to that</p>",
        "id": 562757848,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765302992
    },
    {
        "content": "<p>ah, I see some other code in here just collects everything into a vec?</p>",
        "id": 562758404,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765303142
    },
    {
        "content": "<p>(in <a href=\"http://reencode.rs\">reencode.rs</a>)</p>",
        "id": 562758429,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765303150
    },
    {
        "content": "<p>maybe I'm getting it<br>\n<a href=\"/user_uploads/15107/_AhvsdyWdbUwYYIrfKkEH00W/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/_AhvsdyWdbUwYYIrfKkEH00W/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"549x288\" src=\"/user_uploads/thumbnail/15107/_AhvsdyWdbUwYYIrfKkEH00W/image.png/840x560.webp\"></a></div>",
        "id": 562759293,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765303356
    },
    {
        "content": "<p>that all looks reasonable to me yeah <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 562760519,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765303644
    },
    {
        "content": "<p>Ok, I think I really do need some broad guidance for the text parser. At the moment the accepted formats are:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"foo\"</span><span class=\"w\"> </span><span class=\"s\">\"bar\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">))</span>\n<span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"foo\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"s\">\"bar\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"s\">\"baz\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">))</span>\n<span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"foo\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"s\">\"bar\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"s\">\"baz\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">))</span>\n</code></pre></div>",
        "id": 562764885,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765304730
    },
    {
        "content": "<p>When it comes to <code>impl Parse for Imports</code>, I really hardly know where to begin. I have to first distinguish between the single-item format and the compact formats, but then also if I don't see a type in the first item, I need to start buffering up names until the very end where we expect to see a type before the closing parentheses.</p>",
        "id": 562765316,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765304831
    },
    {
        "content": "<p>Roughly that sounds about right to me, the results need to be buffered up no matter what as they're getting inserted into the AST. I can see how the parsing of the first item will be a bit wonky though, I think that you'll need to basically parse a full <code>item</code> before you go down one of the 3 parsing paths and then handle the first thing that was parsed a bit specially</p>",
        "id": 562766132,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305046
    },
    {
        "content": "<p>So for example in <code>Parse&lt;'a&gt; for Import&lt;'a&gt;</code> before parsing <code>field</code> you could peek to see if there's a string or a parenthesis, and that'll disambiguate \"single\" vs \"compact\", and if it's a paren you'd then parse <code>(item ...)</code> in a loop. That'd then get joined together into a similar enum that wasmparser has</p>",
        "id": 562766380,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305112
    },
    {
        "content": "<p>Sure, seems reasonable</p>",
        "id": 562766457,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305132
    },
    {
        "content": "<p>How do I peek for a paren? I assume <code>peek::&lt;something&gt;</code></p>",
        "id": 562766491,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305142
    },
    {
        "content": "<p><code>parser.peek::&lt;LParen&gt;()?</code></p>",
        "id": 562766557,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305158
    },
    {
        "content": "<p>And for parsing items, should I just make a type that has <code>Option&lt;ItemSig&gt;</code> or something?</p>",
        "id": 562767093,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305269
    },
    {
        "content": "<p>hm, so before I answer that, question for you, where does the <code>$foo</code> go in the <code>(item ...)</code> form?</p>",
        "id": 562767369,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305320
    },
    {
        "content": "<p>e.g. <code>(import \"foo\" \"bar\" (global $foo i32))</code> is the \"single\" form</p>",
        "id": 562767484,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305334
    },
    {
        "content": "<p>It doesn't</p>",
        "id": 562767501,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305338
    },
    {
        "content": "<p>I originally thought it could go in the (item) but Rossberg said no</p>",
        "id": 562767565,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305352
    },
    {
        "content": "<p>if you use this syntax you just don't get to use identifiers</p>",
        "id": 562767656,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305367
    },
    {
        "content": "<p><em>shrug</em></p>",
        "id": 562767689,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305376
    },
    {
        "content": "<p>I'm not thrilled about it but it might make for a good stage 4 bikeshed</p>",
        "id": 562767730,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305384
    },
    {
        "content": "<p>I think you'll skip <code>ItemSig</code> and use <code>ItemKind</code> directly in that case, since the sig is about containing an identifier</p>",
        "id": 562767908,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305417
    },
    {
        "content": "<p>so you'll want an enum of <code>Single(ItemSig), Compact1(Vec&lt;&amp;'a str, ItemKind&gt;), Compact2(ItemKind, Vec&lt;&amp;'a str&gt;)</code></p>",
        "id": 562768018,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305445
    },
    {
        "content": "<p>ish</p>",
        "id": 562768022,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305446
    },
    {
        "content": "<p><code>Single</code> would probably also have <code>&amp;'a str</code> for the field</p>",
        "id": 562768102,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305466
    },
    {
        "content": "<p>this'll cascade through the text resolver where you'll need to account for the compact forms introducing multiple items in the sense of adding to index spaces, but they'll all use <code>None</code> for their <code>$foo</code> name</p>",
        "id": 562768268,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305508
    },
    {
        "content": "<p>How do I conditionally parse either an (item \"foo\") or an ItemSig though?</p>",
        "id": 562769031,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765305706
    },
    {
        "content": "<p>Hm ok actually, let me revise. You probably want to reuse <code>ItemSig</code> since it has the nitty-gritty of parsing types. You'll want to verify after-the-fact though that <code>id</code> is <code>None</code>.</p>\n<p>Also, one change you'll need to make (or file an issue for) is that <code>wasmprinter</code> will need special logic to not print <code>$foo</code> names and instead print <code>(@name ...)</code> annotations</p>",
        "id": 562769167,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305737
    },
    {
        "content": "<p>For <code>(item ...)</code> vs <code>ItemSig</code>, you can use <code>parser.peek2::&lt;kw::item&gt;()?</code></p>",
        "id": 562769267,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305764
    },
    {
        "content": "<p>and if that's <code>false</code> you do an <code>ItemSig</code></p>",
        "id": 562769289,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765305770
    },
    {
        "content": "<blockquote>\n<p><code>wasmprinter</code> will need special logic to not print <code>$foo</code> names and instead print <code>(@name ...)</code> annotations</p>\n</blockquote>\n<p>I'm not following, what will the output need to look like?</p>",
        "id": 562770307,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765306026
    },
    {
        "content": "<p>to clarify, I'm imagining a <code>name</code> section in a binary which indeed has a name for a compact-imported-thing and ideally <code>wasmprinter</code> would still reflect that somehow so the <code>name</code> section could get faithfully represented. In lieu of <code>$foo</code> the other option is <code>(@name \"...\")</code> so what I'd naviely expect is <code>(item \"foo\" (@name \"bar\"))</code></p>\n<p>Although this could also be an open issue and for now names on the items could just get dropped</p>",
        "id": 562770785,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765306163
    },
    {
        "content": "<p>I see, I think I will have to open an issue about that</p>",
        "id": 562770879,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765306189
    },
    {
        "content": "<p>it's probably best to just drop names yeah and file an issue</p>",
        "id": 562770897,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765306195
    },
    {
        "content": "<p>What is this text \"resolver\" thing?</p>",
        "id": 562776097,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765307562
    },
    {
        "content": "<p>That'll be in <a href=\"https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wast/src/core/resolve\">this folder</a> (<code>crates/wast/src/core/resolve/*.rs</code>) which figures out indices for <code>$foo</code> and such</p>\n<p>You'll end up needing to modify <a href=\"https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/crates/wast/src/core/resolve/names.rs#L88-L96\">this for example</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wast/src/core/resolve\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/abc4bf081f2addc6a0b08cf31cc211aaefa0dae5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323533346538666536613037353965643865323462626564646564613537323738633732346536636661636639323161626231636566613833323734643465322f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wast/src/core/resolve\" title=\"wasm-tools/crates/wast/src/core/resolve at main · bytecodealliance/wasm-tools\">wasm-tools/crates/wast/src/core/resolve at main · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/crates/wast/src/core/resolve/names.rs#L88-L96\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/abc4bf081f2addc6a0b08cf31cc211aaefa0dae5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323533346538666536613037353965643865323462626564646564613537323738633732346536636661636639323161626231636566613833323734643465322f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/crates/wast/src/core/resolve/names.rs#L88-L96\" title=\"wasm-tools/crates/wast/src/core/resolve/names.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools\">wasm-tools/crates/wast/src/core/resolve/names.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div>",
        "id": 562779855,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765308604
    },
    {
        "content": "<p>Thanks for the continued help here...for the <code>iter_item_sigs_mut</code>, would you recommend implementing it similarly to how you did the iterator for the wasmparser types?</p>",
        "id": 562993522,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765382962
    },
    {
        "content": "<p>idiomatically, yeah that's what I'd recommend, but code-ease-wise it's probably easier to do something like <code>fn try_for_each_sig_mut(&amp;mut self, f: impl FnMut(&amp;mut ItemSig&lt;'a&gt;) -&gt; Result&lt;()&gt;) -&gt; Result&lt;()&gt; { ... }</code></p>",
        "id": 562994113,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383108
    },
    {
        "content": "<p>whichever you feel most comfortable with I think is reasonable</p>",
        "id": 562994171,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383122
    },
    {
        "content": "<p>To be honest I'm not really sure how to structure either one. Is this thing going to take mutable ownership of the <code>Imports</code> object? Or does it need to clone something? (Surely it can't do that if it needs to mutate things)</p>",
        "id": 562995102,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383332
    },
    {
        "content": "<p>yeah no cloning here, and the method would likely be <code>&amp;mut self</code> on <code>Imports</code> yeah</p>",
        "id": 562995765,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383491
    },
    {
        "content": "<p>I'm just wondering how that works if I need to return some kind of MutItemSigsIterator</p>",
        "id": 562995854,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383517
    },
    {
        "content": "<p>the easiest actually is probably <code>fn sigs_mut(&amp;mut self) -&gt; Vec&lt;&amp;mut ItemSig&lt;'a&gt;&gt;</code></p>",
        "id": 562995927,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383532
    },
    {
        "content": "<p>and if we want to speed it up we can deal with that later (and it might well never be necessary)</p>",
        "id": 562996003,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383552
    },
    {
        "content": "<p>hm that is appealing</p>",
        "id": 562996028,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383559
    },
    {
        "content": "<p>I'll give that a try</p>",
        "id": 562996039,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383562
    },
    {
        "content": "<p>one part about that to be aware of is that it's not suitable for \"iterate over all import items introduced\" because for the type-mentioned-once-names-mentioned-many-times compact form there's just one <code>ItemSig</code> and you can't push that onto a vector multiple times</p>",
        "id": 562996374,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383652
    },
    {
        "content": "<p>ah right</p>",
        "id": 562996489,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383683
    },
    {
        "content": "<p>well now I'm trying to think how that even works with the resolver or whatever</p>",
        "id": 562996536,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383694
    },
    {
        "content": "<p>when I implemented this in spidermonkey I didn't actually have all the imports share a type, I would just go back and parse the common type bytes over and over again</p>",
        "id": 562996686,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383730
    },
    {
        "content": "<p>seemingly that is not how it would work here</p>",
        "id": 562996730,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765383740
    },
    {
        "content": "<p>yeah for the text format at least I think we'll want to maintain the original AST to faithfully translate it to binary</p>",
        "id": 562996836,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383770
    },
    {
        "content": "<p>for the resolver I think you'll want a plain old <code>match</code> on the imports and handle each case differently</p>",
        "id": 562996893,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383780
    },
    {
        "content": "<p>but my hope is that many other locations, like \"expansion\" can be \"just gimme the sigs\" since they don't care about indices and it's more about AST structure there</p>",
        "id": 562996998,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765383805
    },
    {
        "content": "<p>More Rust noob questions: is it fundamentally wrong for me to iterate over &amp;Import when I am synthesizing these Import objects on the fly? <br>\n<a href=\"/user_uploads/15107/uypOzGX9oq9V7skjaDhwnLdz/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/uypOzGX9oq9V7skjaDhwnLdz/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"904x470\" src=\"/user_uploads/thumbnail/15107/uypOzGX9oq9V7skjaDhwnLdz/image.png/840x560.webp\"></a></div>",
        "id": 563002222,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765385195
    },
    {
        "content": "<p>if I change the iterator implementation back to this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">impl</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"nb\">IntoIterator</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Imports</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">Item</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Import</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">IntoIter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"nb\">Iterator</span><span class=\"o\">&lt;</span><span class=\"n\">Item</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">Self</span><span class=\"p\">::</span><span class=\"n\">Item</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>then that fixes the errors shown there, but then various uses of said iterator no longer seem to work well<br>\n<a href=\"/user_uploads/15107/bMoiq1IJ9b4Ve28fo8JaC7sG/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/bMoiq1IJ9b4Ve28fo8JaC7sG/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1108x305\" src=\"/user_uploads/thumbnail/15107/bMoiq1IJ9b4Ve28fo8JaC7sG/image.png/840x560.webp\"></a></div>",
        "id": 563002677,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765385309
    },
    {
        "content": "<p>Of course, even this doesn't work because that would mean returning <code>Vec&lt;Import&lt;'a&gt;&gt;</code>, not <code>Vec&lt;&amp;Import&lt;'a&gt;&gt;</code> <span aria-label=\"rolling eyes\" class=\"emoji emoji-1f644\" role=\"img\" title=\"rolling eyes\">:rolling_eyes:</span></p>",
        "id": 563003391,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765385483
    },
    {
        "content": "<p><a href=\"/user_uploads/15107/6Z4zTYz64QrEtx5csB80k8ja/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/6Z4zTYz64QrEtx5csB80k8ja/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"872x308\" src=\"/user_uploads/thumbnail/15107/6Z4zTYz64QrEtx5csB80k8ja/image.png/840x560.webp\"></a></div>",
        "id": 563003407,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765385486
    },
    {
        "content": "<p>ugh! and doing all that doesn't work because we push the names into other data structures<br>\n<a href=\"/user_uploads/15107/JLxP7FsIqiX6qqj5_k8v-IGs/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/JLxP7FsIqiX6qqj5_k8v-IGs/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"745x335\" src=\"/user_uploads/thumbnail/15107/JLxP7FsIqiX6qqj5_k8v-IGs/image.png/840x560.webp\"></a></div>",
        "id": 563004980,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765385875
    },
    {
        "content": "<p>I think I need to step back and figure out the right shape for all this</p>",
        "id": 563006914,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765386316
    },
    {
        "content": "<p>Like what types should we even have in the text AST? Should I even have a unified Import type any more when that literally doesn’t appear in many places?</p>",
        "id": 563007080,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765386364
    },
    {
        "content": "<p>Hm ok yeah I agree you probably don't want <code>&amp;Import</code> or <code>Import</code> here since that doesn't exist for the compact forms. Some options I can think of are:</p>\n<ul>\n<li>Work with <code>&amp;ItemSig</code> primarily which does exist in the compact forms</li>\n<li>\"Expand\", at parse time, the compact forms but retain metadata for during emission \"hey compress this range of imports this way\"</li>\n</ul>",
        "id": 563012402,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765387889
    },
    {
        "content": "<p>The former sounds better if I can swing it</p>",
        "id": 563012582,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765387947
    },
    {
        "content": "<p>I guess that's all I can think of heh</p>",
        "id": 563012591,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765387952
    },
    {
        "content": "<p>and sigs_mut does seem to be good in several places</p>",
        "id": 563012612,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765387957
    },
    {
        "content": "<p>nice yeah</p>",
        "id": 563012653,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765387970
    },
    {
        "content": "<p>things like wast/src/somponent/binary.rs though I dunno</p>",
        "id": 563012697,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765387982
    },
    {
        "content": "<p>that might be a case where I should just have a big match on the text AST</p>",
        "id": 563012839,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765388029
    },
    {
        "content": "<p>one option here, since this is semi-similar to resolve, is to have something like <code>fn ids(&amp;self) -&gt; Vec&lt;...&gt;</code></p>",
        "id": 563012952,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765388055
    },
    {
        "content": "<p>where that expands to a vec-the-length-of-items-introduced and that has the <code>m.id</code> and such, which would all be <code>None</code> for compact imports but <code>Some</code> for the single import case</p>",
        "id": 563013041,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765388079
    },
    {
        "content": "<p>that way the binary and resolve pass would do something like <code>for (id, name) in import.ids() { ... }</code></p>",
        "id": 563013094,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765388095
    },
    {
        "content": "<p>maybe something like:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">Imports</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">all</span><span class=\"o\">&lt;'</span><span class=\"na\">b</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"p\">(</span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">Id</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">NameAnnotationThing</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"n\">ItemSig</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 563013385,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765388194
    },
    {
        "content": "<p>just so I'm clear, the resolve pass resolves identifiers to indices, and the binary pass converts the text AST to binary?</p>",
        "id": 563013454,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765388216
    },
    {
        "content": "<p>right yeah, although the binary pass is also dealing with indices sort of -- it has to build up the <code>name</code> section and it additionally does a thing with dwarf where it needs to know the number of imported functions</p>",
        "id": 563013556,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765388250
    },
    {
        "content": "<p>I think I'll start with some matches and see where that takes me</p>",
        "id": 563013862,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765388351
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253994\">Alex Crichton</span> <a href=\"#narrow/channel/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation/near/563013385\">said</a>:</p>\n<blockquote>\n<p>maybe something like:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">Imports</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">all</span><span class=\"o\">&lt;'</span><span class=\"na\">b</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"p\">(</span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">Id</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">NameAnnotationThing</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;'</span><span class=\"na\">b</span><span class=\"w\"> </span><span class=\"n\">ItemSig</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>This could be reasonable but I just feel like it's surely going to need the name info in the mix somewhere and who even knows</p>",
        "id": 563013949,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765388372
    },
    {
        "content": "<p>sounds reasonable to me yeah</p>",
        "id": 563015540,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765388912
    },
    {
        "content": "<p>Surely this is not what you have to do just to check if you have a feature?</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">        </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"p\">(</span>\n<span class=\"w\">            </span><span class=\"n\">single_item_name</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"n\">discriminator</span><span class=\"p\">,</span>\n<span class=\"w\">            </span><span class=\"cp\">#[cfg(feature = </span><span class=\"s\">\"features\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">            </span><span class=\"n\">reader</span><span class=\"p\">.</span><span class=\"n\">features</span><span class=\"p\">().</span><span class=\"n\">compact_imports</span><span class=\"p\">(),</span>\n<span class=\"w\">            </span><span class=\"cp\">#[cfg(not(feature = </span><span class=\"s\">\"features\"</span><span class=\"cp\">))]</span>\n<span class=\"w\">            </span><span class=\"kc\">false</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</code></pre></div>",
        "id": 563025687,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765392262
    },
    {
        "content": "<p>But when I run <code>cargo check --no-default-features</code>, <code>reader.features()</code> doesn't exist</p>",
        "id": 563025747,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765392287
    },
    {
        "content": "<p>you'll want to use <code>reader.compact_imports()</code>, there's some subtle handling there but the per-feature-methods are reexported on the <code>BinaryReader</code> itself</p>",
        "id": 563032028,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765394251
    },
    {
        "content": "<p>ah I see</p>",
        "id": 563032142,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765394289
    },
    {
        "content": "<p>What is the strategy for features in the text parser? Is there one?</p>",
        "id": 563036635,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765395955
    },
    {
        "content": "<p>none, it just accepts everything and produces what it's given</p>",
        "id": 563037637,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765396379
    },
    {
        "content": "<p>how in the world do I see where this is coming from? it seems like the text parse actually worked, but now I have a mystery error with no backtrace, and <code>--verbose</code> does absolutely nothing</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wat</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">dev</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.06</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wat</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">unexpected</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"o\">-</span><span class=\"n\">of</span><span class=\"o\">-</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mh\">0x3f</span><span class=\"p\">)</span>\n</code></pre></div>",
        "id": 563038871,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765396906
    },
    {
        "content": "<p>huh that's odd!</p>",
        "id": 563039442,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765397123
    },
    {
        "content": "<p>the source for that command is <a href=\"https://github.com/bytecodealliance/wasm-tools/blob/main/src/bin/wasm-tools/parse.rs#L48-L49\">here</a> and you might need to add some printfs around there</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/blob/main/src/bin/wasm-tools/parse.rs#L48-L49\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/cd4f74c1855b2e7d087282d8609e2d0e38a4373d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366336383464363636356162306132633161346664396466386266333466393363353039303432346565396636363536366663623363383033376666613831662f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/blob/main/src/bin/wasm-tools/parse.rs#L48-L49\" title=\"wasm-tools/src/bin/wasm-tools/parse.rs at main · bytecodealliance/wasm-tools\">wasm-tools/src/bin/wasm-tools/parse.rs at main · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div>",
        "id": 563039592,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765397184
    },
    {
        "content": "<p>that looks like a wasmparser-style error but I'm not entirely sure where wasmparser would be activated in the text-to-binary transform...</p>",
        "id": 563039639,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765397205
    },
    {
        "content": "<p>there's no way I can, like, use a real debugger?</p>",
        "id": 563040044,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765397361
    },
    {
        "content": "<p>the surface area of wasm-tools is enormous</p>",
        "id": 563040061,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765397368
    },
    {
        "content": "<p>oh sure you can use gdb and set breakpoints and such too</p>",
        "id": 563040410,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765397509
    },
    {
        "content": "<p>the usual rust debugging instructions for vs code seemingly don't work at all, so that's nice</p>",
        "id": 563040472,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765397534
    },
    {
        "content": "<p>back to printfs for me</p>",
        "id": 563040476,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765397537
    },
    {
        "content": "<p>surely you are not just putting printfs everywhere whenever you see a bug like this? surely you have some kind of stack trace at least?</p>",
        "id": 563040875,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765397678
    },
    {
        "content": "<p>depends on the error, most errors I personally debug have a pretty clear source. I'm not sure where this is coming from so I'd resort to printfs for this since I don't know off the top of my head where it's coming from</p>",
        "id": 563041646,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765397985
    },
    {
        "content": "<p>oh...it's doing weird things because for some reason <code>wasm-tools parse</code> will run the resulting wasm through the binary parser without features enabled</p>",
        "id": 563041928,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398106
    },
    {
        "content": "<p>why in the world? can I <em>not</em> do that please?</p>",
        "id": 563041964,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398123
    },
    {
        "content": "<p>or can I turn features on somehow?</p>",
        "id": 563041997,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398137
    },
    {
        "content": "<p>the <code>parse</code> command doesn't seem to accept features in any way I can tell</p>",
        "id": 563042093,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398170
    },
    {
        "content": "<p>do you have the line the error is being generated from?</p>",
        "id": 563042711,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765398423
    },
    {
        "content": "<p>I think it's literally just that the new compact import encoding, produced by the new text format, is being parsed as if it was not the compact import encoding, and doing Mysterious Things (reading too far in the resulting binary)</p>",
        "id": 563042807,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398464
    },
    {
        "content": "<p>which seems baffling</p>",
        "id": 563042813,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398467
    },
    {
        "content": "<p>I just want it to produce the binary, not produce the binary and then explode because it produced a binary with new features</p>",
        "id": 563042851,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398485
    },
    {
        "content": "<p>this is why I was asking about features in the text format...it would be ok if the text parsing failed on the new syntax, or if the text parsing succeeded but it _didn't_ do this broken validation step, but it seems we have the worst of both worlds and I'm confused</p>",
        "id": 563042949,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398526
    },
    {
        "content": "<p>Do you have a branch/repro I can poke at? I can try to help hunt this down and see if this is uncovering a preexisting bug in wasm-tools or something that can be improved</p>",
        "id": 563043500,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765398745
    },
    {
        "content": "<p>I'll push what I have + a test file</p>",
        "id": 563043532,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765398761
    },
    {
        "content": "<p>looks like you want to comment out <a href=\"https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/src/lib.rs#L222\">this line</a> and running <code>dump</code> on the produced <code>*.wasm</code> yields:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"mh\">0x0</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Module</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span>\n<span class=\"w\">  </span><span class=\"mh\">0x8</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">09</span><span class=\"w\">       </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">section</span>\n<span class=\"w\">  </span><span class=\"mh\">0xa</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">02</span><span class=\"w\">          </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">count</span>\n<span class=\"o\">---</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">implicit</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">---</span>\n<span class=\"w\">  </span><span class=\"mh\">0xb</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">SubType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">is_final</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">supertype_idx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">composite_type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">CompositeType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Func</span><span class=\"p\">(</span><span class=\"n\">FuncType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"p\">}),</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">descriptor_idx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">describes_idx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"o\">---</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">implicit</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">---</span>\n<span class=\"w\">  </span><span class=\"mh\">0xf</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">SubType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">is_final</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">supertype_idx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">composite_type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">CompositeType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Func</span><span class=\"p\">(</span><span class=\"n\">FuncType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">I64</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"p\">}),</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">descriptor_idx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">describes_idx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\"> </span><span class=\"mh\">0x13</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">02</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">a</span><span class=\"w\">       </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">section</span>\n<span class=\"w\"> </span><span class=\"mh\">0x15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\">          </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"n\">count</span>\n<span class=\"w\"> </span><span class=\"mh\">0x16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">03</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">Import</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"foo\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"bar\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Func</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">03</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"w\"> </span><span class=\"mi\">72</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span>\n<span class=\"w\"> </span><span class=\"mh\">0x20</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">03</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">Import</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"foo\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"baz\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Func</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">03</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"n\">a</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span>\n<span class=\"o\">---</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">common</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">---</span>\n<span class=\"w\"> </span><span class=\"mh\">0x2a</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">03</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"foo\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">02</span>\n<span class=\"w\"> </span><span class=\"mh\">0x31</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">ImportItemCompact</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"beep\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Func</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">01</span>\n<span class=\"w\"> </span><span class=\"mh\">0x38</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">ImportItemCompact</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"boop\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Func</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">01</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">unexpected</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"o\">-</span><span class=\"n\">of</span><span class=\"o\">-</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mh\">0x3f</span><span class=\"p\">)</span>\n</code></pre></div>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/src/lib.rs#L222\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/cd4f74c1855b2e7d087282d8609e2d0e38a4373d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366336383464363636356162306132633161346664396466386266333466393363353039303432346565396636363536366663623363383033376666613831662f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/src/lib.rs#L222\" title=\"wasm-tools/src/lib.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools\">wasm-tools/src/lib.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div>",
        "id": 563046325,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1765399272
    },
    {
        "content": "<p>ah, it was actually an incorrect count in the import section <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 563051454,
        "sender_full_name": "Ben Visness",
        "timestamp": 1765400172
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253994\">@Alex Crichton</span> Is there a timeline for the next release? I'm hoping to present the proposal in CG next week and would like to have our SpiderMonkey implementation landed by then.</p>",
        "id": 566586440,
        "sender_full_name": "Ben Visness",
        "timestamp": 1767719238
    },
    {
        "content": "<p><a href=\"https://github.com/bytecodealliance/wasm-tools?tab=readme-ov-file#versioning-and-releases\">No release cadence</a>, just done on an as-needed basis</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools?tab=readme-ov-file#versioning-and-releases\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/982b2134c6db38343de9fa2d9b70273095c70a32/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613365373765373765353763366637326435353934653437323232333430613561346565643963346631326161363134396261353533623936323538656265632f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools?tab=readme-ov-file#versioning-and-releases\" title=\"GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules\">GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules</a></div><div class=\"message_embed_description\"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules</div></div></div>",
        "id": 566594552,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1767722177
    },
    {
        "content": "<p>I'll try to get around to pushing the buttons today</p>",
        "id": 566594584,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1767722187
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 566594598,
        "sender_full_name": "Ben Visness",
        "timestamp": 1767722191
    },
    {
        "content": "<p>ok a <a href=\"https://github.com/bytecodealliance/wasm-tools/releases/tag/v1.244.0\">new release has been made</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/releases/tag/v1.244.0\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/cee547e40375669b5b4c785c350df5e96a503c13/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343434643235626663623761306330313034623938306661616430353231333330396635316134633435366533613539376234363862303835623565623962322f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f72656c65617365732f7461672f76312e3234342e30&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/releases/tag/v1.244.0\" title=\"Release v1.244.0 · bytecodealliance/wasm-tools\">Release v1.244.0 · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\">What's Changed\n\nRemove backpressure.set by @alexcrichton in #2397\nImprove error message for missing wasi-sdk by @alexcrichton in #2400\nIncrease MSRV to 1.81.0 by @alexcrichton in #2402\nMake wasm-wa...</div></div></div>",
        "id": 566610893,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1767728729
    }
]