[
    {
        "content": "<p>Hi,</p>\n<p>I initially thought a CMake error I encountered was caused by <code>wasi-sdk</code>, so I opened an issue there <a href=\"https://github.com/WebAssembly/wasi-sdk/issues/529\">\"Compatibility with CMake &lt; 3.5 has been removed from CMake.\"</a>. </p>\n<p>After some digging, I realised the real source was that the <code>StarlingMonkey/cmake/wasi-sdk.cmake</code> file, which is currently pulling in <code>wasi-sdk</code> version 20, which includes an outdated toolchain file that uses <code>cmake_minimum_required(VERSION 3.4.0)</code>. </p>\n<p><a href=\"/user_uploads/15107/B3RwQWI2twN76D_PCrd5nFSJ/Screenshot-2025-05-09-at-23.14.42.png\">Screenshot 2025-05-09 at 23.14.42.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/B3RwQWI2twN76D_PCrd5nFSJ/Screenshot-2025-05-09-at-23.14.42.png\" title=\"Screenshot 2025-05-09 at 23.14.42.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1011x282\" src=\"/user_uploads/thumbnail/15107/B3RwQWI2twN76D_PCrd5nFSJ/Screenshot-2025-05-09-at-23.14.42.png/840x560.webp\"></a></div><p>This causes a hard failure with CMake 4.x, since support for versions &lt;3.5 has been dropped.</p>\n<p>The issue seems to be <a href=\"https://github.com/WebAssembly/wasi-sdk/pull/412\">resolved</a> in <code>wasi-sdk</code> v24 and later, where that <code>cmake_minimum_required</code> directive has been removed from the toolchain file. If StarlingMonkey can be updated to pull <code>wasi-sdk</code> v24 or newer, this would resolve the issue. </p>\n<p>I was going to open an issue in the StarlingMonkey repo to suggest this, but then saw that a newly created issue already exists <a href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/243\">\"Configuring fails with CMake &gt;=4.0 due to policy changes\"</a>.</p>\n<p>Would it be possible for StarlingMonkey to update to a newer <code>wasi-sdk</code> version, like 24 or 25?</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-sdk/issues/529\" style='background-image: url(\"https://uploads.zulipusercontent.net/225068f872669d23474dca97879ecb7eae0e8c70/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366430363636326238643661356339666663306561613730353238326531303535343432326533326635613831326562316539356533326563623535323731332f576562417373656d626c792f776173692d73646b2f6973737565732f353239\")'></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-sdk/issues/529\" title=\"Compatibility with CMake &lt; 3.5 has been removed from CMake. · Issue #529 · WebAssembly/wasi-sdk\">Compatibility with CMake &lt; 3.5 has been removed from CMake. · Issue #529 · WebAssembly/wasi-sdk</a></div><div class=\"message_embed_description\">Hi, I see that wasi-sdk has cmake_minimum_required(VERSION 3.22) set in wasi-sdktests/CMakeLists.txt and cmake_minimum_required(VERSION 3.26) set in wasi-sdk/CMakeLists.txt. Compatibility with vers...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-sdk/pull/412\" style='background-image: url(\"https://uploads.zulipusercontent.net/0ea86eb2e0fae4831f5a5376750a90e15babbf44/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373562326237363537623031613166323965626531623330353466346531386566323437313031633562303834626634393661373132633863613138636533622f576562417373656d626c792f776173692d73646b2f70756c6c2f343132\")'></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-sdk/pull/412\" title=\"Remove cmake_minimum_required from toolchain files by thewtex · Pull Request #412 · WebAssembly/wasi-sdk\">Remove cmake_minimum_required from toolchain files by thewtex · Pull Request #412 · WebAssembly/wasi-sdk</a></div><div class=\"message_embed_description\">This command is generally not included in toolchain files. It is used in\nproject configuration files that will consume the toolchain file. Also,\nsuch a low value triggers warnings, support for &lt;...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/243\" style='background-image: url(\"https://uploads.zulipusercontent.net/066b803c61cd718ff8d471e49c9de7b02fa50dfc/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636664613230663132633234393434356464363633336265663238363731663364623138333434643730323733646136636337393938393437613461656633322f62797465636f6465616c6c69616e63652f537461726c696e674d6f6e6b65792f6973737565732f323433\")'></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/243\" title=\"Configuring fails with CMake &gt;=4.0 due to policy changes · Issue #243 · bytecodealliance/StarlingMonkey\">Configuring fails with CMake &gt;=4.0 due to policy changes · Issue #243 · bytecodealliance/StarlingMonkey</a></div><div class=\"message_embed_description\">CMake 4.0 removes compatibility for CMake versions below 3.5. The version of WASI SDK that StarlingMonkey depends on erroneously declares a cmake_minimum_required of 3.4 in its toolchain file, whic...</div></div></div>",
        "id": 517201590,
        "sender_full_name": "Timothy McCallum",
        "timestamp": 1746833839
    },
    {
        "content": "<p>Hello! Thank you for all the details. Yes, I believe updating <code>wasi-sdk</code> is the way to move forward. Unfortunately, it's not as simple as just bumping the SDK version in CMake. </p>\n<p><span class=\"user-mention\" data-user-id=\"234973\">@Till Schneidereit</span>  gave some reasons for why that's the case in a different <a href=\"\">thread</a>:</p>\n<blockquote>\n<p>It's a bit unfortunate, as we currently can't update the version of wasi-sdk used by StarlingMonkey, because for that we'd have to rebuild the SpiderMonkey object files—which doesn't work with newer wasi-sdks at the current revision. </p>\n</blockquote>\n<p>Maybe we can patch <code>wasi-sdk</code> as a temporary solution as mentioned <a href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/243\">here</a> if the failure becomes too annoying.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/243\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/066b803c61cd718ff8d471e49c9de7b02fa50dfc/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636664613230663132633234393434356464363633336265663238363731663364623138333434643730323733646136636337393938393437613461656633322f62797465636f6465616c6c69616e63652f537461726c696e674d6f6e6b65792f6973737565732f323433&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/243\" title=\"Configuring fails with CMake &gt;=4.0 due to policy changes · Issue #243 · bytecodealliance/StarlingMonkey\">Configuring fails with CMake &gt;=4.0 due to policy changes · Issue #243 · bytecodealliance/StarlingMonkey</a></div><div class=\"message_embed_description\">CMake 4.0 removes compatibility for CMake versions below 3.5. The version of WASI SDK that StarlingMonkey depends on erroneously declares a cmake_minimum_required of 3.4 in its toolchain file, whic...</div></div></div>",
        "id": 517341733,
        "sender_full_name": "Tomasz Andrzejak",
        "timestamp": 1746954333
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"763150\">@Tomasz Andrzejak</span> <br>\nThanks for the response, the <a href=\"#narrow/channel/459697-StarlingMonkey/topic/Updating.20Gecko.20version/near/511702706\">reference to Till's conversation</a> is very useful in providing context to the larger issues and work required. I will take a peek at <a href=\"https://github.com/bytecodealliance/StarlingMonkey/pull/189\">deps: bump to WASI-SDK 25 #189</a> because that seems to be the path to getting StarlingMonkey to fetch and use the latest <code>wasi-sdk</code> (which would resolve the CMake version issue).</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/StarlingMonkey/pull/189\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/3c15af423829267ce7b1e2327d0da3e6f86332d9/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633066333164663934633638313665306236636163343735623138383431336637383039366135386631616137353538643563623461656335643066303332352f62797465636f6465616c6c69616e63652f537461726c696e674d6f6e6b65792f70756c6c2f313839&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/StarlingMonkey/pull/189\" title=\"deps: bump to WASI-SDK 25 by guybedford · Pull Request #189 · bytecodealliance/StarlingMonkey\">deps: bump to WASI-SDK 25 by guybedford · Pull Request #189 · bytecodealliance/StarlingMonkey</a></div><div class=\"message_embed_description\">Updates to the latest WASI SDK 25 just released today.</div></div></div>",
        "id": 517408352,
        "sender_full_name": "Timothy McCallum",
        "timestamp": 1747009441
    },
    {
        "content": "<p>thank you for looking into this, <span class=\"user-mention\" data-user-id=\"421662\">@Timothy McCallum</span>! I'll caution though that I tried doing the SDK bump a bit ago, and ran into very mysterious test failures that I'm completely stumped on how to debug</p>",
        "id": 519137368,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1747666428
    }
]