[
    {
        "content": "<p>Hi everyone :)<br>\nI have my own application that uses Wasmtime under the hood for running WASM components with custom WIT worlds that the application implements for additional functionality inside the isolate.</p>\n<p>I wanted the ability to debug the JS that runs in the isolate so I tried using the StarlingMonkey Debugger extension in vscode with proper configurations in <code>settings.json</code> and <code>launch.json</code> to use my custom binary for running the isolate.</p>\n<p>When I try to debug I get the following output:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">WASM</span><span class=\"w\"> </span><span class=\"n\">execution</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"n\">Coredump</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0xc1f5</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">environ_sizes_get</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x21135c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">5160</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x237c61</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">5291</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x1ad4db</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">4546</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x89f32f</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">run</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">unreachable</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">executed</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">debug</span><span class=\"o\">-</span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"n\">execution</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>Now this makes sense because from what I understand <code>environ_sizes_get</code> is a P1 function and in my binary I only implement P2 using Wasmtime due to the fact that P1 in Wasmtime doesn't support the component model <code>Linker</code> and only the module <code>Linker</code>.</p>\n<p>Is there a way for me to configure StarlingMonkey to use P2 and not P1 for environment variable loading?</p>\n<p>I'm using <code>componentize-js</code> to convert my JS into a WASM component so if it is possible further information on integration with <code>componenize-js</code> will also be very helpful <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span>  </p>\n<p>My end goal is to be able to debug the JS in the isolate using my custom binary, If configuring StarlingMonkey is not the way to achieve this what would be the way?</p>\n<p>I didn't find issues that relate to this problem but if there are any I'm happy to contribute to help get this feature implemented if it isn't already.</p>",
        "id": 562140755,
        "sender_full_name": "Shalev Goodman",
        "timestamp": 1764952107
    },
    {
        "content": "<h1><strong>Original Problem fixed :)</strong></h1>\n<p>I managed to fix the error by explicitly importing the <code>wasi:cli/environment</code> world to my own WIT world along with its dependencies.</p>\n<p>And now although I can run the WASM component, no breakpoints I add in VS Code are being triggered. Are there any steps I need to do except for what is outlined in the extension's README?</p>",
        "id": 562176441,
        "sender_full_name": "Shalev Goodman",
        "timestamp": 1764965791
    },
    {
        "content": "<p>OH! I'm glad you figured it out: I have a PR pending to update the documentation about how it works and what's required.... now I need to finish that off, and you've given me the motivation!!!</p>",
        "id": 562248684,
        "sender_full_name": "Ralph",
        "timestamp": 1765035233
    },
    {
        "content": "<p>Awesome! I'm looking forward to it, can you write here when its done with a link?</p>",
        "id": 563554566,
        "sender_full_name": "Shalev Goodman",
        "timestamp": 1765570652
    }
]