[
    {
        "content": "<p><a href=\"https://github.com/jaybarbhaiya\">jaybarbhaiya</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287\">Issue #10287</a>.</p>",
        "id": 501655101,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1740433774
    },
    {
        "content": "<p>jaybarbhaiya opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287\">issue #10287</a>:</p>\n<blockquote>\n<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>\n<p><strong>Note: if you want to report a security issue, please read our <a href=\"https://bytecodealliance.org/security\">security policy</a>!</strong></p>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/jaybarbhaiya/wasmtime-module-drop-test/blob/main/rust_wasm_module.wasm\">Wasm file</a></p>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone the repo</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://github.com/jaybarbhaiya/wasmtime-module-drop-test.git\n</code></pre></div>\n<ul>\n<li>Run bench command</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>cargo<span class=\"w\"> </span>bench\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>The time taken to drop a <code>wasmtime::Module</code> should be comparable across different operating systems.</p>\n<h3>Actual Results</h3>\n<p>The drop of a <code>wasmtime::Module</code> in MacOS is significantly higher than that of Linux and Windows.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 30.0.1</p>\n<p>Operating system: MacOS 15.3.1</p>\n<p>Architecture: arm64</p>\n<h3>Extra Info</h3>\n<p>1000 <code>wasmtime::Module</code> are created with the <code>wasm</code> binary attached above and then dropped. GitHub actions are set up in the repo, which runs the <code>cargo bench</code> command in <code>ubuntu-latest</code>, <code>windows-latest</code>, and <code>macos-latest</code> runners. The screenshot below shows the results:</p>\n<p>ubuntu-latest<br>\n![Image](<a href=\"https://github.com/user-attachments/assets/4fa2734d-0fbf-464e-b23c-434a59d53133\">https://github.com/user-attachments/assets/4fa2734d-0fbf-464e-b23c-434a59d53133</a>)</p>\n<p>windows-latest<br>\n![Image](<a href=\"https://github.com/user-attachments/assets/1787f67b-54a9-4fc9-8440-48a60f4dbd57\">https://github.com/user-attachments/assets/1787f67b-54a9-4fc9-8440-48a60f4dbd57</a>)</p>\n<p>macos-latest<br>\n![Image](<a href=\"https://github.com/user-attachments/assets/2a14bd20-b98a-4c45-a6de-3cd6ec332537\">https://github.com/user-attachments/assets/2a14bd20-b98a-4c45-a6de-3cd6ec332537</a>)</p>\n<p>The difference that was observed, in MacOS, the <code>wasmtime::CodeMemory</code> drop takes a significant amount of time which is not the case in Linux. It would be valuable to get some insights.</p>\n<p>Thank you.</p>\n</blockquote>",
        "id": 501655102,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1740433775
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287#issuecomment-2679743931\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287\">issue #10287</a>:</p>\n<blockquote>\n<p>Thanks for the report! This is likely the cause of <a href=\"https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.native_unwind_info\"><code>Config::native_unwind_info</code></a> being default-on. OSes have widely varying implementations of how information is unregistered, and IIRC I've also seen macOS be significantly slower than other platforms.</p>\n<p>If that option is disabled, though, does it improve the performance you're seeing?</p>\n</blockquote>",
        "id": 501656265,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1740434179
    },
    {
        "content": "<p>jaybarbhaiya closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287\">issue #10287</a>:</p>\n<blockquote>\n<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>\n<p><strong>Note: if you want to report a security issue, please read our <a href=\"https://bytecodealliance.org/security\">security policy</a>!</strong></p>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/jaybarbhaiya/wasmtime-module-drop-test/blob/main/rust_wasm_module.wasm\">Wasm file</a></p>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone the repo</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://github.com/jaybarbhaiya/wasmtime-module-drop-test.git\n</code></pre></div>\n<ul>\n<li>Run bench command</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>cargo<span class=\"w\"> </span>bench\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>The time taken to drop a <code>wasmtime::Module</code> should be comparable across different operating systems.</p>\n<h3>Actual Results</h3>\n<p>The drop of a <code>wasmtime::Module</code> in MacOS is significantly higher than that of Linux and Windows.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 30.0.1</p>\n<p>Operating system: MacOS 15.3.1</p>\n<p>Architecture: arm64</p>\n<h3>Extra Info</h3>\n<p>1000 <code>wasmtime::Module</code> are created with the <code>wasm</code> binary attached above and then dropped. GitHub actions are set up in the repo, which runs the <code>cargo bench</code> command in <code>ubuntu-latest</code>, <code>windows-latest</code>, and <code>macos-latest</code> runners. The screenshot below shows the results:</p>\n<p>ubuntu-latest<br>\n![Image](<a href=\"https://github.com/user-attachments/assets/4fa2734d-0fbf-464e-b23c-434a59d53133\">https://github.com/user-attachments/assets/4fa2734d-0fbf-464e-b23c-434a59d53133</a>)</p>\n<p>windows-latest<br>\n![Image](<a href=\"https://github.com/user-attachments/assets/1787f67b-54a9-4fc9-8440-48a60f4dbd57\">https://github.com/user-attachments/assets/1787f67b-54a9-4fc9-8440-48a60f4dbd57</a>)</p>\n<p>macos-latest<br>\n![Image](<a href=\"https://github.com/user-attachments/assets/2a14bd20-b98a-4c45-a6de-3cd6ec332537\">https://github.com/user-attachments/assets/2a14bd20-b98a-4c45-a6de-3cd6ec332537</a>)</p>\n<p>The difference that was observed, in MacOS, the <code>wasmtime::CodeMemory</code> drop takes a significant amount of time which is not the case in Linux. It would be valuable to get some insights.</p>\n<p>Thank you.</p>\n</blockquote>",
        "id": 501733223,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1740469898
    },
    {
        "content": "<p>jaybarbhaiya <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287#issuecomment-2680998078\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10287\">issue #10287</a>:</p>\n<blockquote>\n<p>Hi @alexcrichton <br>\nThank you for the quick response!<br>\nDisabling <code>Config::native_unwind_info</code> improved performance. Please see below the updated benchmark from the macOS GitHub runner.</p>\n<p>&lt;img width=\"578\" alt=\"Image\" src=\"<a href=\"https://github.com/user-attachments/assets/4b501ade-bb9e-4d70-8bf2-63b6b14e6ca9\">https://github.com/user-attachments/assets/4b501ade-bb9e-4d70-8bf2-63b6b14e6ca9</a>\" /&gt;</p>\n<p>Thank you again for the clarification <span aria-label=\"blush\" class=\"emoji emoji-1f60a\" role=\"img\" title=\"blush\">:blush:</span></p>\n</blockquote>",
        "id": 501733226,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1740469900
    }
]