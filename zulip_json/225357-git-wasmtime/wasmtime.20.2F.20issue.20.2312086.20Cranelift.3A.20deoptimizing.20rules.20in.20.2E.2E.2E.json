[
    {
        "content": "<p>bongjunj opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Hi, this is a follow up from <a href=\"#narrow/channel/217117-cranelift/topic/Deoptimizing.20ISLE.20rules.3F/with/560043751\">#cranelift &gt; Deoptimizing ISLE rules?</a>.</p>\n<p>As mentioned in the Zulip topic above,<br>\nI suspect <a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/bitops.isle#L44-L50\">these ISLE rules</a> can degrade performance, since it can increase the number of instructions and thus the overall computation cost.</p>\n<p>I evaluated the impact of the rule on the <a href=\"https://github.com/bytecodealliance/sightglass\">sightglass benchmark</a>.<br>\nFrom the main branch of cranelift, I removed the rule to instantiate <code>no-demorgan</code> version,<br>\nand compared the execution and compilation performance using <code>sightglass-cli</code> in CPU cycles.<br>\nThe average value for 10 repetitions are presented in the table below.</p>\n<p><strong>Removing the rules lowers the execution time by 22.82% and the compilation overhead by 13.34% for <code>shootout-keccak</code>, the impact of which being negligible for other cases.</strong></p>\n<ul>\n<li><code>speedup = (main - nodemorgan ) / nodemorgan </code></li>\n<li><code>overhead = (nodemorgan - main) / main</code></li>\n</ul>\n<p>The rules exist for normalization, pushing <code>bnot</code> instructions down the tree and further exploiting it via other simplification rules and GVN.<br>\nHowever, this data says the normalization is under-exploited and can degrade performance for <code>keccak</code>.</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark  </th>\n<th>Execution (main)</th>\n<th>Execution (no-demorgan)</th>\n<th>Speedup</th>\n<th>Compilation (main)</th>\n<th>Compilation (no-demorgan)</th>\n<th>Overhead</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>blake3-scalar</td>\n<td>821,287</td>\n<td>820,526</td>\n<td>0.09%</td>\n<td>334,025,595</td>\n<td>335,494,881</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>blake3-simd</td>\n<td>904,391</td>\n<td>902,968</td>\n<td>0.16%</td>\n<td>215,000,060</td>\n<td>216,887,637</td>\n<td>0.88%</td>\n</tr>\n<tr>\n<td>bz2</td>\n<td>123,375,319</td>\n<td>123,972,237</td>\n<td>-0.48%</td>\n<td>323,600,329</td>\n<td>325,059,640</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>pulldown-cmark</td>\n<td>7,527,276</td>\n<td>7,528,312</td>\n<td>-0.01%</td>\n<td>685,357,632</td>\n<td>687,241,047</td>\n<td>0.27%</td>\n</tr>\n<tr>\n<td>regex</td>\n<td>287,113,532</td>\n<td>287,013,209</td>\n<td>0.03%</td>\n<td>1,623,122,606</td>\n<td>1,628,150,390</td>\n<td>0.31%</td>\n</tr>\n<tr>\n<td>shootout-ackermann</td>\n<td>7,766,207</td>\n<td>7,769,915</td>\n<td>-0.05%</td>\n<td>98,442,831</td>\n<td>99,049,461</td>\n<td>0.62%</td>\n</tr>\n<tr>\n<td>shootout-base64</td>\n<td>377,876,186</td>\n<td>377,986,725</td>\n<td>-0.03%</td>\n<td>94,119,875</td>\n<td>94,616,896</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-ctype</td>\n<td>796,212,604</td>\n<td>796,195,661</td>\n<td>0.00%</td>\n<td>90,769,795</td>\n<td>90,728,785</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-ed25519</td>\n<td>11,062,252,786</td>\n<td>11,041,529,973</td>\n<td>0.19%</td>\n<td>505,160,708</td>\n<td>511,230,333</td>\n<td>1.20%</td>\n</tr>\n<tr>\n<td>shootout-fib2</td>\n<td>2,991,817,344</td>\n<td>2,991,783,776</td>\n<td>0.00%</td>\n<td>67,992,267</td>\n<td>68,207,110</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-gimli</td>\n<td>5,143,297</td>\n<td>5,153,384</td>\n<td>-0.20%</td>\n<td>5,846,157</td>\n<td>5,843,358</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-heapsort</td>\n<td>2,374,978,997</td>\n<td>2,375,615,158</td>\n<td>-0.03%</td>\n<td>29,560,353</td>\n<td>29,690,677</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>shootout-keccak</td>\n<td>48,797,823</td>\n<td>39,731,401</td>\n<td>22.82%</td>\n<td>292,241,108</td>\n<td>253,254,413</td>\n<td>-13.34%</td>\n</tr>\n<tr>\n<td>shootout-matrix</td>\n<td>697,653,531</td>\n<td>697,060,503</td>\n<td>0.09%</td>\n<td>93,389,415</td>\n<td>93,786,432</td>\n<td>0.43%</td>\n</tr>\n<tr>\n<td>shootout-memmove</td>\n<td>37,572,864</td>\n<td>37,679,507</td>\n<td>-0.28%</td>\n<td>95,438,341</td>\n<td>95,867,972</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>shootout-minicsv</td>\n<td>1,239,552,532</td>\n<td>1,241,534,405</td>\n<td>-0.16%</td>\n<td>15,630,009</td>\n<td>15,681,735</td>\n<td>0.33%</td>\n</tr>\n<tr>\n<td>shootout-nestedloop</td>\n<td>645</td>\n<td>621</td>\n<td>3.93%</td>\n<td>66,921,453</td>\n<td>67,062,411</td>\n<td>0.21%</td>\n</tr>\n<tr>\n<td>shootout-random</td>\n<td>439,552,157</td>\n<td>439,582,225</td>\n<td>-0.01%</td>\n<td>67,809,477</td>\n<td>68,091,002</td>\n<td>0.42%</td>\n</tr>\n<tr>\n<td>shootout-ratelimit</td>\n<td>50,251,247</td>\n<td>50,384,183</td>\n<td>-0.26%</td>\n<td>92,983,888</td>\n<td>92,922,059</td>\n<td>-0.07%</td>\n</tr>\n<tr>\n<td>shootout-seqhash</td>\n<td>15,249,759,981</td>\n<td>15,255,584,809</td>\n<td>-0.04%</td>\n<td>126,530,505</td>\n<td>127,360,907</td>\n<td>0.66%</td>\n</tr>\n<tr>\n<td>shootout-sieve</td>\n<td>844,263,240</td>\n<td>844,508,149</td>\n<td>-0.03%</td>\n<td>67,092,099</td>\n<td>67,628,053</td>\n<td>0.80%</td>\n</tr>\n<tr>\n<td>shootout-switch</td>\n<td>153,597,929</td>\n<td>153,627,912</td>\n<td>-0.02%</td>\n<td>144,493,947</td>\n<td>144,955,423</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-xblabla20</td>\n<td>4,924,967</td>\n<td>4,926,304</td>\n<td>-0.03%</td>\n<td>96,463,543</td>\n<td>96,976,115</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-xchacha20</td>\n<td>6,468,729</td>\n<td>6,467,746</td>\n<td>0.02%</td>\n<td>96,534,043</td>\n<td>96,825,264</td>\n<td>0.30%</td>\n</tr>\n<tr>\n<td>spidermonkey</td>\n<td>742,879,491</td>\n<td>744,941,257</td>\n<td>-0.28%</td>\n<td>23,687,766,691</td>\n<td>23,749,945,287</td>\n<td>0.26%</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</blockquote>",
        "id": 560086562,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764056981
    },
    {
        "content": "<p>bongjunj edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Hi, this is a follow up from <a href=\"#narrow/channel/217117-cranelift/topic/Deoptimizing.20ISLE.20rules.3F/with/560043751\">#cranelift &gt; Deoptimizing ISLE rules?</a>.</p>\n<p>As mentioned in the Zulip topic above,<br>\nI suspect <a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/bitops.isle#L44-L50\">these ISLE rules</a> can degrade performance, since it can increase the number of instructions and thus the overall computation cost.</p>\n<p>I evaluated the impact of the rule on the <a href=\"https://github.com/bytecodealliance/sightglass\">sightglass benchmark</a>.<br>\nFrom the main branch of cranelift, I removed the rule to instantiate <code>no-demorgan</code> version,<br>\nand compared the execution and compilation performance using <code>sightglass-cli</code> in CPU cycles.<br>\nThe average value for 10 repetitions are presented in the table below.<br>\nMy machine is x86-64, and runs with 64-Core and 512GB memory.</p>\n<p><strong>Removing the rules lowers the execution time by 22.82% and the compilation overhead by 13.34% for <code>shootout-keccak</code>, the impact of which being negligible for other cases.</strong></p>\n<ul>\n<li><code>speedup = (main - nodemorgan ) / nodemorgan </code></li>\n<li><code>overhead = (nodemorgan - main) / main</code></li>\n</ul>\n<p>The rules exist for normalization, pushing <code>bnot</code> instructions down the tree and further exploiting it via other simplification rules and GVN.<br>\nHowever, this data says the normalization is under-exploited and can degrade performance for <code>keccak</code>.</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark  </th>\n<th>Execution (main)</th>\n<th>Execution (no-demorgan)</th>\n<th>Speedup</th>\n<th>Compilation (main)</th>\n<th>Compilation (no-demorgan)</th>\n<th>Overhead</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>blake3-scalar</td>\n<td>821,287</td>\n<td>820,526</td>\n<td>0.09%</td>\n<td>334,025,595</td>\n<td>335,494,881</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>blake3-simd</td>\n<td>904,391</td>\n<td>902,968</td>\n<td>0.16%</td>\n<td>215,000,060</td>\n<td>216,887,637</td>\n<td>0.88%</td>\n</tr>\n<tr>\n<td>bz2</td>\n<td>123,375,319</td>\n<td>123,972,237</td>\n<td>-0.48%</td>\n<td>323,600,329</td>\n<td>325,059,640</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>pulldown-cmark</td>\n<td>7,527,276</td>\n<td>7,528,312</td>\n<td>-0.01%</td>\n<td>685,357,632</td>\n<td>687,241,047</td>\n<td>0.27%</td>\n</tr>\n<tr>\n<td>regex</td>\n<td>287,113,532</td>\n<td>287,013,209</td>\n<td>0.03%</td>\n<td>1,623,122,606</td>\n<td>1,628,150,390</td>\n<td>0.31%</td>\n</tr>\n<tr>\n<td>shootout-ackermann</td>\n<td>7,766,207</td>\n<td>7,769,915</td>\n<td>-0.05%</td>\n<td>98,442,831</td>\n<td>99,049,461</td>\n<td>0.62%</td>\n</tr>\n<tr>\n<td>shootout-base64</td>\n<td>377,876,186</td>\n<td>377,986,725</td>\n<td>-0.03%</td>\n<td>94,119,875</td>\n<td>94,616,896</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-ctype</td>\n<td>796,212,604</td>\n<td>796,195,661</td>\n<td>0.00%</td>\n<td>90,769,795</td>\n<td>90,728,785</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-ed25519</td>\n<td>11,062,252,786</td>\n<td>11,041,529,973</td>\n<td>0.19%</td>\n<td>505,160,708</td>\n<td>511,230,333</td>\n<td>1.20%</td>\n</tr>\n<tr>\n<td>shootout-fib2</td>\n<td>2,991,817,344</td>\n<td>2,991,783,776</td>\n<td>0.00%</td>\n<td>67,992,267</td>\n<td>68,207,110</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-gimli</td>\n<td>5,143,297</td>\n<td>5,153,384</td>\n<td>-0.20%</td>\n<td>5,846,157</td>\n<td>5,843,358</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-heapsort</td>\n<td>2,374,978,997</td>\n<td>2,375,615,158</td>\n<td>-0.03%</td>\n<td>29,560,353</td>\n<td>29,690,677</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>shootout-keccak</td>\n<td>48,797,823</td>\n<td>39,731,401</td>\n<td>22.82%</td>\n<td>292,241,108</td>\n<td>253,254,413</td>\n<td>-13.34%</td>\n</tr>\n<tr>\n<td>shootout-matrix</td>\n<td>697,653,531</td>\n<td>697,060,503</td>\n<td>0.09%</td>\n<td>93,389,415</td>\n<td>93,786,432</td>\n<td>0.43%</td>\n</tr>\n<tr>\n<td>shootout-memmove</td>\n<td>37,572,864</td>\n<td>37,679,507</td>\n<td>-0.28%</td>\n<td>95,438,341</td>\n<td>95,867,972</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>shootout-minicsv</td>\n<td>1,239,552,532</td>\n<td>1,241,534,405</td>\n<td>-0.16%</td>\n<td>15,630,009</td>\n<td>15,681,735</td>\n<td>0.33%</td>\n</tr>\n<tr>\n<td>shootout-nestedloop</td>\n<td>645</td>\n<td>621</td>\n<td>3.93%</td>\n<td>66,921,453</td>\n<td>67,062,411</td>\n<td>0.21%</td>\n</tr>\n<tr>\n<td>shootout-random</td>\n<td>439,552,157</td>\n<td>439,582,225</td>\n<td>-0.01%</td>\n<td>67,809,477</td>\n<td>68,091,002</td>\n<td>0.42%</td>\n</tr>\n<tr>\n<td>shootout-ratelimit</td>\n<td>50,251,247</td>\n<td>50,384,183</td>\n<td>-0.26%</td>\n<td>92,983,888</td>\n<td>92,922,059</td>\n<td>-0.07%</td>\n</tr>\n<tr>\n<td>shootout-seqhash</td>\n<td>15,249,759,981</td>\n<td>15,255,584,809</td>\n<td>-0.04%</td>\n<td>126,530,505</td>\n<td>127,360,907</td>\n<td>0.66%</td>\n</tr>\n<tr>\n<td>shootout-sieve</td>\n<td>844,263,240</td>\n<td>844,508,149</td>\n<td>-0.03%</td>\n<td>67,092,099</td>\n<td>67,628,053</td>\n<td>0.80%</td>\n</tr>\n<tr>\n<td>shootout-switch</td>\n<td>153,597,929</td>\n<td>153,627,912</td>\n<td>-0.02%</td>\n<td>144,493,947</td>\n<td>144,955,423</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-xblabla20</td>\n<td>4,924,967</td>\n<td>4,926,304</td>\n<td>-0.03%</td>\n<td>96,463,543</td>\n<td>96,976,115</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-xchacha20</td>\n<td>6,468,729</td>\n<td>6,467,746</td>\n<td>0.02%</td>\n<td>96,534,043</td>\n<td>96,825,264</td>\n<td>0.30%</td>\n</tr>\n<tr>\n<td>spidermonkey</td>\n<td>742,879,491</td>\n<td>744,941,257</td>\n<td>-0.28%</td>\n<td>23,687,766,691</td>\n<td>23,749,945,287</td>\n<td>0.26%</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</blockquote>",
        "id": 560087066,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764057185
    },
    {
        "content": "<p>bongjunj edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Hi, this is a follow up from <a href=\"#narrow/channel/217117-cranelift/topic/Deoptimizing.20ISLE.20rules.3F/with/560043751\">#cranelift &gt; Deoptimizing ISLE rules?</a>.</p>\n<p>As mentioned in the Zulip topic above,<br>\nI suspect <a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/bitops.isle#L44-L50\">these ISLE rules</a> can degrade performance, since it can increase the number of instructions and thus the overall computation cost.</p>\n<p>I evaluated the impact of the rule on the <a href=\"https://github.com/bytecodealliance/sightglass\">sightglass benchmark</a>.<br>\nFrom the main branch of cranelift, I removed the rule to instantiate <code>no-demorgan</code> version,<br>\nand compared the execution and compilation performance using <code>sightglass-cli</code> in CPU cycles.<br>\nThe average value for 10 repetitions are presented in the table below.<br>\nMy machine is x86-64 and runs with 64-Core and 512GB memory.</p>\n<p><strong>Removing the rules lowers the execution time by 22.82% and the compilation overhead by 13.34% for <code>shootout-keccak</code>, the impact of which being negligible for other cases.</strong></p>\n<ul>\n<li><code>speedup = (main - nodemorgan ) / nodemorgan </code></li>\n<li><code>overhead = (nodemorgan - main) / main</code></li>\n</ul>\n<p>The rules exist for normalization, pushing <code>bnot</code> instructions down the tree and further exploiting it via other simplification rules and GVN.<br>\nHowever, this data says the normalization is under-exploited and can degrade performance for <code>keccak</code>.</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark  </th>\n<th>Execution (main)</th>\n<th>Execution (no-demorgan)</th>\n<th>Speedup</th>\n<th>Compilation (main)</th>\n<th>Compilation (no-demorgan)</th>\n<th>Overhead</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>blake3-scalar</td>\n<td>821,287</td>\n<td>820,526</td>\n<td>0.09%</td>\n<td>334,025,595</td>\n<td>335,494,881</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>blake3-simd</td>\n<td>904,391</td>\n<td>902,968</td>\n<td>0.16%</td>\n<td>215,000,060</td>\n<td>216,887,637</td>\n<td>0.88%</td>\n</tr>\n<tr>\n<td>bz2</td>\n<td>123,375,319</td>\n<td>123,972,237</td>\n<td>-0.48%</td>\n<td>323,600,329</td>\n<td>325,059,640</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>pulldown-cmark</td>\n<td>7,527,276</td>\n<td>7,528,312</td>\n<td>-0.01%</td>\n<td>685,357,632</td>\n<td>687,241,047</td>\n<td>0.27%</td>\n</tr>\n<tr>\n<td>regex</td>\n<td>287,113,532</td>\n<td>287,013,209</td>\n<td>0.03%</td>\n<td>1,623,122,606</td>\n<td>1,628,150,390</td>\n<td>0.31%</td>\n</tr>\n<tr>\n<td>shootout-ackermann</td>\n<td>7,766,207</td>\n<td>7,769,915</td>\n<td>-0.05%</td>\n<td>98,442,831</td>\n<td>99,049,461</td>\n<td>0.62%</td>\n</tr>\n<tr>\n<td>shootout-base64</td>\n<td>377,876,186</td>\n<td>377,986,725</td>\n<td>-0.03%</td>\n<td>94,119,875</td>\n<td>94,616,896</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-ctype</td>\n<td>796,212,604</td>\n<td>796,195,661</td>\n<td>0.00%</td>\n<td>90,769,795</td>\n<td>90,728,785</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-ed25519</td>\n<td>11,062,252,786</td>\n<td>11,041,529,973</td>\n<td>0.19%</td>\n<td>505,160,708</td>\n<td>511,230,333</td>\n<td>1.20%</td>\n</tr>\n<tr>\n<td>shootout-fib2</td>\n<td>2,991,817,344</td>\n<td>2,991,783,776</td>\n<td>0.00%</td>\n<td>67,992,267</td>\n<td>68,207,110</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-gimli</td>\n<td>5,143,297</td>\n<td>5,153,384</td>\n<td>-0.20%</td>\n<td>5,846,157</td>\n<td>5,843,358</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-heapsort</td>\n<td>2,374,978,997</td>\n<td>2,375,615,158</td>\n<td>-0.03%</td>\n<td>29,560,353</td>\n<td>29,690,677</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>shootout-keccak</td>\n<td>48,797,823</td>\n<td>39,731,401</td>\n<td>22.82%</td>\n<td>292,241,108</td>\n<td>253,254,413</td>\n<td>-13.34%</td>\n</tr>\n<tr>\n<td>shootout-matrix</td>\n<td>697,653,531</td>\n<td>697,060,503</td>\n<td>0.09%</td>\n<td>93,389,415</td>\n<td>93,786,432</td>\n<td>0.43%</td>\n</tr>\n<tr>\n<td>shootout-memmove</td>\n<td>37,572,864</td>\n<td>37,679,507</td>\n<td>-0.28%</td>\n<td>95,438,341</td>\n<td>95,867,972</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>shootout-minicsv</td>\n<td>1,239,552,532</td>\n<td>1,241,534,405</td>\n<td>-0.16%</td>\n<td>15,630,009</td>\n<td>15,681,735</td>\n<td>0.33%</td>\n</tr>\n<tr>\n<td>shootout-nestedloop</td>\n<td>645</td>\n<td>621</td>\n<td>3.93%</td>\n<td>66,921,453</td>\n<td>67,062,411</td>\n<td>0.21%</td>\n</tr>\n<tr>\n<td>shootout-random</td>\n<td>439,552,157</td>\n<td>439,582,225</td>\n<td>-0.01%</td>\n<td>67,809,477</td>\n<td>68,091,002</td>\n<td>0.42%</td>\n</tr>\n<tr>\n<td>shootout-ratelimit</td>\n<td>50,251,247</td>\n<td>50,384,183</td>\n<td>-0.26%</td>\n<td>92,983,888</td>\n<td>92,922,059</td>\n<td>-0.07%</td>\n</tr>\n<tr>\n<td>shootout-seqhash</td>\n<td>15,249,759,981</td>\n<td>15,255,584,809</td>\n<td>-0.04%</td>\n<td>126,530,505</td>\n<td>127,360,907</td>\n<td>0.66%</td>\n</tr>\n<tr>\n<td>shootout-sieve</td>\n<td>844,263,240</td>\n<td>844,508,149</td>\n<td>-0.03%</td>\n<td>67,092,099</td>\n<td>67,628,053</td>\n<td>0.80%</td>\n</tr>\n<tr>\n<td>shootout-switch</td>\n<td>153,597,929</td>\n<td>153,627,912</td>\n<td>-0.02%</td>\n<td>144,493,947</td>\n<td>144,955,423</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-xblabla20</td>\n<td>4,924,967</td>\n<td>4,926,304</td>\n<td>-0.03%</td>\n<td>96,463,543</td>\n<td>96,976,115</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-xchacha20</td>\n<td>6,468,729</td>\n<td>6,467,746</td>\n<td>0.02%</td>\n<td>96,534,043</td>\n<td>96,825,264</td>\n<td>0.30%</td>\n</tr>\n<tr>\n<td>spidermonkey</td>\n<td>742,879,491</td>\n<td>744,941,257</td>\n<td>-0.28%</td>\n<td>23,687,766,691</td>\n<td>23,749,945,287</td>\n<td>0.26%</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</blockquote>",
        "id": 560087087,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764057192
    },
    {
        "content": "<p>bongjunj edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Hi, this is a follow up from <a href=\"#narrow/channel/217117-cranelift/topic/Deoptimizing.20ISLE.20rules.3F/with/560043751\">#cranelift &gt; Deoptimizing ISLE rules?</a>.</p>\n<p>As mentioned in the Zulip topic above,<br>\nI suspect <a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/bitops.isle#L44-L50\">these ISLE rules</a> can degrade performance, since it can increase the number of instructions and thus the overall computation cost.</p>\n<p>I evaluated the impact of the rule on the <a href=\"https://github.com/bytecodealliance/sightglass\">sightglass benchmark</a>.<br>\nFrom the main branch of cranelift, I removed the rule to instantiate <code>no-demorgan</code> version,<br>\nand compared the execution and compilation performance using <code>sightglass-cli</code> in CPU cycles.<br>\nThe average value for 10 repetitions are presented in the table below.<br>\nMy machine is x86-64 linux and runs with 64-Core and 512GB memory.</p>\n<p><strong>Removing the rules lowers the execution time by 22.82% and the compilation overhead by 13.34% for <code>shootout-keccak</code>, the impact of which being negligible for other cases.</strong></p>\n<ul>\n<li><code>speedup = (main - nodemorgan ) / nodemorgan </code></li>\n<li><code>overhead = (nodemorgan - main) / main</code></li>\n</ul>\n<p>The rules exist for normalization, pushing <code>bnot</code> instructions down the tree and further exploiting it via other simplification rules and GVN.<br>\nHowever, this data says the normalization is under-exploited and can degrade performance for <code>keccak</code>.</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark  </th>\n<th>Execution (main)</th>\n<th>Execution (no-demorgan)</th>\n<th>Speedup</th>\n<th>Compilation (main)</th>\n<th>Compilation (no-demorgan)</th>\n<th>Overhead</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>blake3-scalar</td>\n<td>821,287</td>\n<td>820,526</td>\n<td>0.09%</td>\n<td>334,025,595</td>\n<td>335,494,881</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>blake3-simd</td>\n<td>904,391</td>\n<td>902,968</td>\n<td>0.16%</td>\n<td>215,000,060</td>\n<td>216,887,637</td>\n<td>0.88%</td>\n</tr>\n<tr>\n<td>bz2</td>\n<td>123,375,319</td>\n<td>123,972,237</td>\n<td>-0.48%</td>\n<td>323,600,329</td>\n<td>325,059,640</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>pulldown-cmark</td>\n<td>7,527,276</td>\n<td>7,528,312</td>\n<td>-0.01%</td>\n<td>685,357,632</td>\n<td>687,241,047</td>\n<td>0.27%</td>\n</tr>\n<tr>\n<td>regex</td>\n<td>287,113,532</td>\n<td>287,013,209</td>\n<td>0.03%</td>\n<td>1,623,122,606</td>\n<td>1,628,150,390</td>\n<td>0.31%</td>\n</tr>\n<tr>\n<td>shootout-ackermann</td>\n<td>7,766,207</td>\n<td>7,769,915</td>\n<td>-0.05%</td>\n<td>98,442,831</td>\n<td>99,049,461</td>\n<td>0.62%</td>\n</tr>\n<tr>\n<td>shootout-base64</td>\n<td>377,876,186</td>\n<td>377,986,725</td>\n<td>-0.03%</td>\n<td>94,119,875</td>\n<td>94,616,896</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-ctype</td>\n<td>796,212,604</td>\n<td>796,195,661</td>\n<td>0.00%</td>\n<td>90,769,795</td>\n<td>90,728,785</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-ed25519</td>\n<td>11,062,252,786</td>\n<td>11,041,529,973</td>\n<td>0.19%</td>\n<td>505,160,708</td>\n<td>511,230,333</td>\n<td>1.20%</td>\n</tr>\n<tr>\n<td>shootout-fib2</td>\n<td>2,991,817,344</td>\n<td>2,991,783,776</td>\n<td>0.00%</td>\n<td>67,992,267</td>\n<td>68,207,110</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-gimli</td>\n<td>5,143,297</td>\n<td>5,153,384</td>\n<td>-0.20%</td>\n<td>5,846,157</td>\n<td>5,843,358</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-heapsort</td>\n<td>2,374,978,997</td>\n<td>2,375,615,158</td>\n<td>-0.03%</td>\n<td>29,560,353</td>\n<td>29,690,677</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>shootout-keccak</td>\n<td>48,797,823</td>\n<td>39,731,401</td>\n<td>22.82%</td>\n<td>292,241,108</td>\n<td>253,254,413</td>\n<td>-13.34%</td>\n</tr>\n<tr>\n<td>shootout-matrix</td>\n<td>697,653,531</td>\n<td>697,060,503</td>\n<td>0.09%</td>\n<td>93,389,415</td>\n<td>93,786,432</td>\n<td>0.43%</td>\n</tr>\n<tr>\n<td>shootout-memmove</td>\n<td>37,572,864</td>\n<td>37,679,507</td>\n<td>-0.28%</td>\n<td>95,438,341</td>\n<td>95,867,972</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>shootout-minicsv</td>\n<td>1,239,552,532</td>\n<td>1,241,534,405</td>\n<td>-0.16%</td>\n<td>15,630,009</td>\n<td>15,681,735</td>\n<td>0.33%</td>\n</tr>\n<tr>\n<td>shootout-nestedloop</td>\n<td>645</td>\n<td>621</td>\n<td>3.93%</td>\n<td>66,921,453</td>\n<td>67,062,411</td>\n<td>0.21%</td>\n</tr>\n<tr>\n<td>shootout-random</td>\n<td>439,552,157</td>\n<td>439,582,225</td>\n<td>-0.01%</td>\n<td>67,809,477</td>\n<td>68,091,002</td>\n<td>0.42%</td>\n</tr>\n<tr>\n<td>shootout-ratelimit</td>\n<td>50,251,247</td>\n<td>50,384,183</td>\n<td>-0.26%</td>\n<td>92,983,888</td>\n<td>92,922,059</td>\n<td>-0.07%</td>\n</tr>\n<tr>\n<td>shootout-seqhash</td>\n<td>15,249,759,981</td>\n<td>15,255,584,809</td>\n<td>-0.04%</td>\n<td>126,530,505</td>\n<td>127,360,907</td>\n<td>0.66%</td>\n</tr>\n<tr>\n<td>shootout-sieve</td>\n<td>844,263,240</td>\n<td>844,508,149</td>\n<td>-0.03%</td>\n<td>67,092,099</td>\n<td>67,628,053</td>\n<td>0.80%</td>\n</tr>\n<tr>\n<td>shootout-switch</td>\n<td>153,597,929</td>\n<td>153,627,912</td>\n<td>-0.02%</td>\n<td>144,493,947</td>\n<td>144,955,423</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-xblabla20</td>\n<td>4,924,967</td>\n<td>4,926,304</td>\n<td>-0.03%</td>\n<td>96,463,543</td>\n<td>96,976,115</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-xchacha20</td>\n<td>6,468,729</td>\n<td>6,467,746</td>\n<td>0.02%</td>\n<td>96,534,043</td>\n<td>96,825,264</td>\n<td>0.30%</td>\n</tr>\n<tr>\n<td>spidermonkey</td>\n<td>742,879,491</td>\n<td>744,941,257</td>\n<td>-0.28%</td>\n<td>23,687,766,691</td>\n<td>23,749,945,287</td>\n<td>0.26%</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</blockquote>",
        "id": 560087096,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764057197
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086#issuecomment-3574233807\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Thanks for this analysis!</p>\n<p>I am reading the data as: small but positive impact on most benchmarks; with one large negative outlier (<code>keccak</code>) as you mention. To me that suggests some adverse impact in an inner loop; perhaps we can fix it. Would you be able to dig a bit deeper on the benchmark (e.g. by profiling and comparing the hottest basic blocks before and after) to see if you can narrow down the cause?</p>\n</blockquote>",
        "id": 560088503,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764057685
    },
    {
        "content": "<p>bongjunj <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086#issuecomment-3575184010\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Thanks for the suggestion! Gonna run those analysis.</p>\n</blockquote>",
        "id": 560128570,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764070066
    },
    {
        "content": "<p>bongjunj closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p>Hi, this is a follow up from <a href=\"#narrow/channel/217117-cranelift/topic/Deoptimizing.20ISLE.20rules.3F/with/560043751\">#cranelift &gt; Deoptimizing ISLE rules?</a>.</p>\n<p>As mentioned in the Zulip topic above,<br>\nI suspect <a href=\"https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/bitops.isle#L44-L50\">these ISLE rules</a> can degrade performance, since it can increase the number of instructions and thus the overall computation cost.</p>\n<p>I evaluated the impact of the rule on the <a href=\"https://github.com/bytecodealliance/sightglass\">sightglass benchmark</a>.<br>\nFrom the main branch of cranelift, I removed the rule to instantiate <code>no-demorgan</code> version,<br>\nand compared the execution and compilation performance using <code>sightglass-cli</code> in CPU cycles.<br>\nThe average value for 10 repetitions are presented in the table below.<br>\nMy machine is x86-64 linux and runs with 64-Core and 512GB memory.</p>\n<p><strong>Removing the rules lowers the execution time by 22.82% and the compilation overhead by 13.34% for <code>shootout-keccak</code>, the impact of which being negligible for other cases.</strong></p>\n<ul>\n<li><code>speedup = (main - nodemorgan ) / nodemorgan </code></li>\n<li><code>overhead = (nodemorgan - main) / main</code></li>\n</ul>\n<p>The rules exist for normalization, pushing <code>bnot</code> instructions down the tree and further exploiting it via other simplification rules and GVN.<br>\nHowever, this data says the normalization is under-exploited and can degrade performance for <code>keccak</code>.</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark  </th>\n<th>Execution (main)</th>\n<th>Execution (no-demorgan)</th>\n<th>Speedup</th>\n<th>Compilation (main)</th>\n<th>Compilation (no-demorgan)</th>\n<th>Overhead</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>blake3-scalar</td>\n<td>821,287</td>\n<td>820,526</td>\n<td>0.09%</td>\n<td>334,025,595</td>\n<td>335,494,881</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>blake3-simd</td>\n<td>904,391</td>\n<td>902,968</td>\n<td>0.16%</td>\n<td>215,000,060</td>\n<td>216,887,637</td>\n<td>0.88%</td>\n</tr>\n<tr>\n<td>bz2</td>\n<td>123,375,319</td>\n<td>123,972,237</td>\n<td>-0.48%</td>\n<td>323,600,329</td>\n<td>325,059,640</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>pulldown-cmark</td>\n<td>7,527,276</td>\n<td>7,528,312</td>\n<td>-0.01%</td>\n<td>685,357,632</td>\n<td>687,241,047</td>\n<td>0.27%</td>\n</tr>\n<tr>\n<td>regex</td>\n<td>287,113,532</td>\n<td>287,013,209</td>\n<td>0.03%</td>\n<td>1,623,122,606</td>\n<td>1,628,150,390</td>\n<td>0.31%</td>\n</tr>\n<tr>\n<td>shootout-ackermann</td>\n<td>7,766,207</td>\n<td>7,769,915</td>\n<td>-0.05%</td>\n<td>98,442,831</td>\n<td>99,049,461</td>\n<td>0.62%</td>\n</tr>\n<tr>\n<td>shootout-base64</td>\n<td>377,876,186</td>\n<td>377,986,725</td>\n<td>-0.03%</td>\n<td>94,119,875</td>\n<td>94,616,896</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-ctype</td>\n<td>796,212,604</td>\n<td>796,195,661</td>\n<td>0.00%</td>\n<td>90,769,795</td>\n<td>90,728,785</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-ed25519</td>\n<td>11,062,252,786</td>\n<td>11,041,529,973</td>\n<td>0.19%</td>\n<td>505,160,708</td>\n<td>511,230,333</td>\n<td>1.20%</td>\n</tr>\n<tr>\n<td>shootout-fib2</td>\n<td>2,991,817,344</td>\n<td>2,991,783,776</td>\n<td>0.00%</td>\n<td>67,992,267</td>\n<td>68,207,110</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-gimli</td>\n<td>5,143,297</td>\n<td>5,153,384</td>\n<td>-0.20%</td>\n<td>5,846,157</td>\n<td>5,843,358</td>\n<td>-0.05%</td>\n</tr>\n<tr>\n<td>shootout-heapsort</td>\n<td>2,374,978,997</td>\n<td>2,375,615,158</td>\n<td>-0.03%</td>\n<td>29,560,353</td>\n<td>29,690,677</td>\n<td>0.44%</td>\n</tr>\n<tr>\n<td>shootout-keccak</td>\n<td>48,797,823</td>\n<td>39,731,401</td>\n<td>22.82%</td>\n<td>292,241,108</td>\n<td>253,254,413</td>\n<td>-13.34%</td>\n</tr>\n<tr>\n<td>shootout-matrix</td>\n<td>697,653,531</td>\n<td>697,060,503</td>\n<td>0.09%</td>\n<td>93,389,415</td>\n<td>93,786,432</td>\n<td>0.43%</td>\n</tr>\n<tr>\n<td>shootout-memmove</td>\n<td>37,572,864</td>\n<td>37,679,507</td>\n<td>-0.28%</td>\n<td>95,438,341</td>\n<td>95,867,972</td>\n<td>0.45%</td>\n</tr>\n<tr>\n<td>shootout-minicsv</td>\n<td>1,239,552,532</td>\n<td>1,241,534,405</td>\n<td>-0.16%</td>\n<td>15,630,009</td>\n<td>15,681,735</td>\n<td>0.33%</td>\n</tr>\n<tr>\n<td>shootout-nestedloop</td>\n<td>645</td>\n<td>621</td>\n<td>3.93%</td>\n<td>66,921,453</td>\n<td>67,062,411</td>\n<td>0.21%</td>\n</tr>\n<tr>\n<td>shootout-random</td>\n<td>439,552,157</td>\n<td>439,582,225</td>\n<td>-0.01%</td>\n<td>67,809,477</td>\n<td>68,091,002</td>\n<td>0.42%</td>\n</tr>\n<tr>\n<td>shootout-ratelimit</td>\n<td>50,251,247</td>\n<td>50,384,183</td>\n<td>-0.26%</td>\n<td>92,983,888</td>\n<td>92,922,059</td>\n<td>-0.07%</td>\n</tr>\n<tr>\n<td>shootout-seqhash</td>\n<td>15,249,759,981</td>\n<td>15,255,584,809</td>\n<td>-0.04%</td>\n<td>126,530,505</td>\n<td>127,360,907</td>\n<td>0.66%</td>\n</tr>\n<tr>\n<td>shootout-sieve</td>\n<td>844,263,240</td>\n<td>844,508,149</td>\n<td>-0.03%</td>\n<td>67,092,099</td>\n<td>67,628,053</td>\n<td>0.80%</td>\n</tr>\n<tr>\n<td>shootout-switch</td>\n<td>153,597,929</td>\n<td>153,627,912</td>\n<td>-0.02%</td>\n<td>144,493,947</td>\n<td>144,955,423</td>\n<td>0.32%</td>\n</tr>\n<tr>\n<td>shootout-xblabla20</td>\n<td>4,924,967</td>\n<td>4,926,304</td>\n<td>-0.03%</td>\n<td>96,463,543</td>\n<td>96,976,115</td>\n<td>0.53%</td>\n</tr>\n<tr>\n<td>shootout-xchacha20</td>\n<td>6,468,729</td>\n<td>6,467,746</td>\n<td>0.02%</td>\n<td>96,534,043</td>\n<td>96,825,264</td>\n<td>0.30%</td>\n</tr>\n<tr>\n<td>spidermonkey</td>\n<td>742,879,491</td>\n<td>744,941,257</td>\n<td>-0.28%</td>\n<td>23,687,766,691</td>\n<td>23,749,945,287</td>\n<td>0.26%</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</blockquote>",
        "id": 562388793,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1765171369
    },
    {
        "content": "<p>bongjunj <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086#issuecomment-3624980931\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12086\">issue #12086</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/pull/12127\">https://github.com/bytecodealliance/wasmtime/pull/12127</a></p>\n</blockquote>",
        "id": 562388795,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1765171370
    }
]