[
    {
        "content": "<p>wilfreddenton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>I created a repo that shows the basic setup that my much large/complex project has: <a href=\"https://github.com/wilfreddenton/wasm-tester\">https://github.com/wilfreddenton/wasm-tester</a></p>\n<p>The <code>main</code> branch shows how in v39 I am able to implement component imports with async methods and then call them synchronously in the guest code. Limiting complexity in the guest code i.e. avoiding async/await is desirable for this project. </p>\n<p>Is this just simply no longer possible in v40?  The repo has a branch <code>wasmtime-40</code> where the only change is updating the version number of the wasmtime dep. Everything compiles still but I get the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">component</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">contract</span><span class=\"p\">:</span><span class=\"nc\">built</span><span class=\"o\">-</span><span class=\"k\">in</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">matching</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linker</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">foo</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"k\">async</span>\n</code></pre></div>\n<p>In the branch <code>wasmtime-40-fix</code> I added the <code>async</code> keyword to all the functions in the wits, made the guest code async, and then enabled <code>wasm_component_model_async</code> as opposed to the <code>wasm_component_model</code> I had before on the engine. This fixes the runtime but now all my guest code has to be async.</p>\n<p>So I just want to be sure that this is the correct/only migration strategy?</p>\n</blockquote>",
        "id": 565598510,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766960888
    },
    {
        "content": "<p>wilfreddenton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>I created a repo that shows the basic setup that my much large/complex project has: <a href=\"https://github.com/wilfreddenton/wasm-tester\">https://github.com/wilfreddenton/wasm-tester</a></p>\n<p>The <code>main</code> branch shows how in v39 I am able to implement component imports with async methods and then call them synchronously in the guest code. Limiting complexity in the guest code i.e. avoiding async/await is desirable for this project. </p>\n<p>Is this just simply no longer possible in v40?  The repo has a branch <a href=\"https://github.com/wilfreddenton/wasm-tester/pull/1/changes\"><code>wasmtime-40</code></a> where the only change is updating the version number of the wasmtime dep. Everything compiles still but I get the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">component</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">contract</span><span class=\"p\">:</span><span class=\"nc\">built</span><span class=\"o\">-</span><span class=\"k\">in</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">matching</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linker</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">foo</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"k\">async</span>\n</code></pre></div>\n<p>In the branch <a href=\"https://github.com/wilfreddenton/wasm-tester/pull/2/changes\"><code>wasmtime-40-fix</code></a> I added the <code>async</code> keyword to all the functions in the wits, made the guest code async, and then enabled <code>wasm_component_model_async</code> as opposed to the <code>wasm_component_model</code> I had before on the engine. This fixes the runtime but now all my guest code has to be async.</p>\n<p>So I just want to be sure that this is the correct/only migration strategy?</p>\n</blockquote>",
        "id": 565598550,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766960975
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226#issuecomment-3710901968\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>Thanks for the report, and yeah this is an unfortunate interaction with the new component-model-async work. Specifically what is happening here is that a component model change means that <code>async</code> is now part of a function type in the component model. This means that Wasmtime, as a host, needs a way to define either an async function or a non-async function. Right now that's done in Wasmtime with <code>func_wrap_concurrent</code> for <code>async</code> and <code>func_wrap</code> or <code>func_wrap_async</code> for sync (yes, the irony isn't lost on us).</p>\n<p>The recent support for the <code>store</code> flag in <code>bindgen!</code> was also originally added for component-model-async functions. This was then sort of backported to prior support for host functions in such a way where by using <code>store | async</code> you're using <code>func_wrap_concurrent</code> under the hood. That's what changed, that's why things broke for you, and that's why using <code>async</code> in WIT \"fixes\" things.</p>\n<p>Routes forward for this I an think of are:</p>\n<ul>\n<li>One thing we historically talked about was the ability to dynamically specify the async-ness of a host function which would enable bindings generation to fix this automatically (e.g. support a non-<code>async</code> WIT function that's async on the host).</li>\n<li>Another solution, as you've found, is to use <code>async</code> in the WIT. You should be able to instruct guest bindings generators to generate non-<code>async</code> bindings for async functions, but that'll require generator-specific configuration.</li>\n</ul>\n</blockquote>",
        "id": 566380050,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1767626935
    },
    {
        "content": "<p>wilfreddenton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226#issuecomment-3711575976\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>Thanks for the response @alexcrichton.</p>\n<blockquote>\n<p>One thing we historically talked about was the ability to dynamically specify the async-ness of a host function which would enable bindings generation to fix this automatically (e.g. support a non-async WIT function that's async on the host).</p>\n</blockquote>\n<p>I believe this would be quite useful but I guess this is a long term solution.</p>\n<blockquote>\n<p>Another solution, as you've found, is to use async in the WIT. You should be able to instruct guest bindings generators to generate non-async bindings for async functions, but that'll require generator-specific configuration.</p>\n</blockquote>\n<p>I've been trying this strategy with <code>wit-bindgen</code> but haven't gotten it to work. Getting this runtime error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x1f4c43</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x13c5</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">contract</span><span class=\"p\">::</span><span class=\"n\">built_in</span><span class=\"p\">::</span><span class=\"n\">context</span><span class=\"p\">::</span><span class=\"n\">foo</span><span class=\"p\">::</span><span class=\"n\">h06099e4fc41fc8e8</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x735</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!&lt;</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">Contract</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">use_foo</span><span class=\"p\">::</span><span class=\"n\">h509cde4d218381fb</span>\n<span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x4a0</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">_export_use_foo_cabi</span><span class=\"p\">::</span><span class=\"n\">h36d590b3aab01f1e</span>\n<span class=\"w\">    </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x77c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"k\">use</span><span class=\"o\">-</span><span class=\"n\">foo</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">block</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">synchronous</span><span class=\"w\"> </span><span class=\"n\">task</span><span class=\"w\"> </span><span class=\"n\">before</span><span class=\"w\"> </span><span class=\"n\">returning</span>\n</code></pre></div>\n<p>I'm testing in this <a href=\"https://github.com/wilfreddenton/wasm-tester/pull/3/changes\">branch</a> of my <code>wasm-tester</code> repo. It uses the <code>async</code> keyword in the host (built-in) wit but does not use it in the guest export and then I'm using the <code>async</code> parameter of the <a href=\"https://docs.rs/wit-bindgen/latest/wit_bindgen/macro.generate.html#options-to-generate\"><code>wit_bindgen::generate!</code></a> macro to disable async for the <code>foo</code> import specifically. It also has the same error when I use <code>async: false</code> instead of directly targeting the function.</p>\n</blockquote>",
        "id": 566413604,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1767636923
    },
    {
        "content": "<p>wilfreddenton edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226#issuecomment-3711575976\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>Thanks for the response @alexcrichton.</p>\n<blockquote>\n<p>One thing we historically talked about was the ability to dynamically specify the async-ness of a host function which would enable bindings generation to fix this automatically (e.g. support a non-async WIT function that's async on the host).</p>\n</blockquote>\n<p>I believe this would be quite useful but I guess this is a long term solution.</p>\n<blockquote>\n<p>Another solution, as you've found, is to use async in the WIT. You should be able to instruct guest bindings generators to generate non-async bindings for async functions, but that'll require generator-specific configuration.</p>\n</blockquote>\n<p>I've been trying this strategy with <code>wit-bindgen</code> (rust) but haven't gotten it to work. Getting this runtime error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x1f4c43</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x13c5</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">contract</span><span class=\"p\">::</span><span class=\"n\">built_in</span><span class=\"p\">::</span><span class=\"n\">context</span><span class=\"p\">::</span><span class=\"n\">foo</span><span class=\"p\">::</span><span class=\"n\">h06099e4fc41fc8e8</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x735</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!&lt;</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">Contract</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">use_foo</span><span class=\"p\">::</span><span class=\"n\">h509cde4d218381fb</span>\n<span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x4a0</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">_export_use_foo_cabi</span><span class=\"p\">::</span><span class=\"n\">h36d590b3aab01f1e</span>\n<span class=\"w\">    </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x77c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"k\">use</span><span class=\"o\">-</span><span class=\"n\">foo</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">block</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">synchronous</span><span class=\"w\"> </span><span class=\"n\">task</span><span class=\"w\"> </span><span class=\"n\">before</span><span class=\"w\"> </span><span class=\"n\">returning</span>\n</code></pre></div>\n<p>I'm testing in this <a href=\"https://github.com/wilfreddenton/wasm-tester/pull/3/changes\">branch</a> of my <code>wasm-tester</code> repo. It uses the <code>async</code> keyword in the host (built-in) wit but does not use it in the guest export and then I'm using the <code>async</code> parameter of the <a href=\"https://docs.rs/wit-bindgen/latest/wit_bindgen/macro.generate.html#options-to-generate\"><code>wit_bindgen::generate!</code></a> macro to disable async for the <code>foo</code> import specifically. It also has the same error when I use <code>async: false</code> instead of directly targeting the function.</p>\n</blockquote>",
        "id": 566413686,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1767636952
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226#issuecomment-3720302809\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>Ah ok yeah that's expected insofar as it's a sync function (<code>use-foo</code>) calling an <code>async</code> function (the builtin function). To get this working you'll need to also model <code>use-foo</code> as itself an <code>async</code> function, for example:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/guest/src/lib.rs b/crates/guest/src/lib.rs</span>\n<span class=\"gh\">index 16f8d10..8aae10c 100644</span>\n<span class=\"gd\">--- a/crates/guest/src/lib.rs</span>\n<span class=\"gi\">+++ b/crates/guest/src/lib.rs</span>\n<span class=\"gu\">@@ -4,7 +4,8 @@ wit_bindgen::generate!({</span>\n<span class=\"w\"> </span>    generate_all,\n<span class=\"w\"> </span>    generate_unused_types: true,\n<span class=\"w\"> </span>    async: [\n<span class=\"gd\">-        \"-import:contract:built-in/context#foo\"</span>\n<span class=\"gi\">+        \"-import:contract:built-in/context#foo\",</span>\n<span class=\"gi\">+        \"-use-foo\",</span>\n<span class=\"w\"> </span>    ]\n<span class=\"w\"> </span>});\n\n<span class=\"gh\">diff --git a/crates/guest/wit/contract.wit b/crates/guest/wit/contract.wit</span>\n<span class=\"gh\">index cbef0b8..8c59be2 100644</span>\n<span class=\"gd\">--- a/crates/guest/wit/contract.wit</span>\n<span class=\"gi\">+++ b/crates/guest/wit/contract.wit</span>\n<span class=\"gu\">@@ -3,5 +3,5 @@ package root:component;</span>\n<span class=\"w\"> </span>world root {\n<span class=\"w\"> </span>    include contract:built-in/built-in;\n\n<span class=\"gd\">-    export use-foo: func() -&gt; string;</span>\n<span class=\"gi\">+    export use-foo: async func() -&gt; string;</span>\n<span class=\"w\"> </span>}\n</code></pre></div>\n<p>Using that it worked out for me locally</p>\n</blockquote>",
        "id": 566801571,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1767812065
    },
    {
        "content": "<p>wilfreddenton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226#issuecomment-3721221283\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>Now what you said here <a href=\"https://github.com/WebAssembly/component-model/pull/578#discussion_r2577894213\">https://github.com/WebAssembly/component-model/pull/578#discussion_r2577894213</a> makes sense to me. This is an example of coloring applying to the WITs but not to the guest implementation.</p>\n<p>With this strategy I was able to migrate the project to v40. Thank you!</p>\n<p>Afaic this issue can be closed but I'll leave that to you since it has been put under a project.</p>\n</blockquote>",
        "id": 566840313,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1767827478
    },
    {
        "content": "<p>pchickey closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12226\">issue #12226</a>:</p>\n<blockquote>\n<p>I created a repo that shows the basic setup that my much large/complex project has: <a href=\"https://github.com/wilfreddenton/wasm-tester\">https://github.com/wilfreddenton/wasm-tester</a></p>\n<p>The <code>main</code> branch shows how in v39 I am able to implement component imports with async methods and then call them synchronously in the guest code. Limiting complexity in the guest code i.e. avoiding async/await is desirable for this project. </p>\n<p>Is this just simply no longer possible in v40?  The repo has a branch <a href=\"https://github.com/wilfreddenton/wasm-tester/pull/1/changes\"><code>wasmtime-40</code></a> where the only change is updating the version number of the wasmtime dep. Everything compiles still but I get the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">component</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">contract</span><span class=\"p\">:</span><span class=\"nc\">built</span><span class=\"o\">-</span><span class=\"k\">in</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">matching</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linker</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">foo</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"k\">async</span>\n</code></pre></div>\n<p>In the branch <a href=\"https://github.com/wilfreddenton/wasm-tester/pull/2/changes\"><code>wasmtime-40-fix</code></a> I added the <code>async</code> keyword to all the functions in the wits, made the guest code async, and then enabled <code>wasm_component_model_async</code> as opposed to the <code>wasm_component_model</code> I had before on the engine. This fixes the runtime but now all my guest code has to be async.</p>\n<p>So I just want to be sure that this is the correct/only migration strategy?</p>\n</blockquote>",
        "id": 566840582,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1767827615
    }
]