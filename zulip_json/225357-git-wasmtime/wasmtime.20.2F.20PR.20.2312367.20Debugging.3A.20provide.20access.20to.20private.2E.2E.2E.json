[
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 568554051,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768620314
    },
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a> from <code>cfallin:debugging-access-private-entities</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>A debugger will need to access all entities (globals, tables, memories), even those that are not exported, in order to provide a full debugging experience: for example, a developer who has a developer attached to a Wasm component will expect to be able to see data in its memory.</p>\n<p>Historically we have been very careful in Wasmtime to provide access to Wasm instances' entities only as the Wasm type system allows -- that is, only if they are exported. However, debugging is privileged -- in the same way that a native host debugger has <code>ptrace</code> and can view everything about the debuggee, we need to provide APIs for seeing through the encapsulation boundary.</p>\n<p>To ensure that this \"violation of encapsulation\" is scoped only to the extent needed for the legitimate need (debugging), this API is dynamically available only when <code>guest_debug</code> is configured true for a given engine. Otherwise, the accessor returns <code>None</code>.</p>\n<p>I opted not to provide a full introspection API that enumerates all of the entities as the debugger should already have access to the debuggee module and be able to enumerate the entities. Thus, the API only provides a host-API handle when asking for an entity by index in a given instance's index space.</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 568554052,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768620315
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 568554053,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768620315
    },
    {
        "content": "<p>cfallin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>:</p>\n<blockquote>\n<p>A debugger will need to access all entities (globals, tables, memories), even those that are not exported, in order to provide a full debugging experience: for example, a developer who has a debugger attached to a Wasm component will expect to be able to see data in its memory.</p>\n<p>Historically we have been very careful in Wasmtime to provide access to Wasm instances' entities only as the Wasm type system allows -- that is, only if they are exported. However, debugging is privileged -- in the same way that a native host debugger has <code>ptrace</code> and can view everything about the debuggee, we need to provide APIs for seeing through the encapsulation boundary.</p>\n<p>To ensure that this \"violation of encapsulation\" is scoped only to the extent needed for the legitimate need (debugging), this API is dynamically available only when <code>guest_debug</code> is configured true for a given engine. Otherwise, the accessor returns <code>None</code>.</p>\n<p>I opted not to provide a full introspection API that enumerates all of the entities as the debugger should already have access to the debuggee module and be able to enumerate the entities. Thus, the API only provides a host-API handle when asking for an entity by index in a given instance's index space.</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 568554095,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768620376
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 568554101,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768620390
    },
    {
        "content": "<p>github-actions[bot] added the label <code>wasmtime:api</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 568558997,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768625400
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3679908308\">PR review</a>.</p>",
        "id": 568923088,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768868427
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2706364694\">PR review comment</a>:</p>\n<blockquote>\n<p>In the limit, this is something we'll want debuggers to do, right? And this in theory would be pretty easy for us to handle internally by using <code>tunables.debug_guest</code> as a flag to assume that all functions are exported?</p>\n</blockquote>",
        "id": 568923089,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768868427
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2706368497\">PR review comment</a>:</p>\n<blockquote>\n<p>Instead of duplicating the documentation, could one of the methods with documentation link to the other?</p>\n</blockquote>",
        "id": 568923090,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768868427
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2706368070\">PR review comment</a>:</p>\n<blockquote>\n<p>Could this function use <code>vm::Instance::get_export_by_index_mut</code> to avoid duplication? Plus some extra validation ahead of time that the index is valid for the instance-at-hand.</p>\n</blockquote>",
        "id": 568923091,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768868427
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2706365776\">PR review comment</a>:</p>\n<blockquote>\n<p>Despite being unable to do anything with them at the moment, is there a reason to specifically disallow this? I figure it'd be best to go ahead and fill things out while we can otherwise</p>\n</blockquote>",
        "id": 568923092,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768868427
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2706371222\">PR review comment</a>:</p>\n<blockquote>\n<p>Right now <code>FooIndex</code>-style types are all internal to Wasmtime and not present in Wasmtime's public API (or at least that's the intention). Given that it might be best to switch this to <code>debug_get_{global,func,table,memory,tag}</code> perhaps? </p>\n<p>Also, I might recommend putting the functionality on <code>Instance</code> since that seems like a natural place to put the methods. You can still do it in this file with <code>impl Instance { ... }</code> since this is still in the same crate defining <code>Instance</code>.</p>\n</blockquote>",
        "id": 568923093,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768868427
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684362526\">PR review</a>.</p>",
        "id": 569130763,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768944411
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710129382\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes and yes, IMO.</p>\n</blockquote>",
        "id": 569130768,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768944412
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684763467\">PR review</a>.</p>",
        "id": 569147048,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953041
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710465913\">PR review comment</a>:</p>\n<blockquote>\n<p>Unfortunately I want a panic-free interface here (we will expose this method to the debugger guest) so that whole function hierarchy is unusable -- it panics on out-of-bounds.</p>\n</blockquote>",
        "id": 569147049,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953041
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684764712\">PR review</a>.</p>",
        "id": 569147084,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953064
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710466841\">PR review comment</a>:</p>\n<blockquote>\n<p>I guess I just didn't want to think through the implications until needed but it seems tag exports are pretty harmless, so I'll add this!</p>\n</blockquote>",
        "id": 569147088,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953064
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710468739\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, I was following precedent here with the bits on <code>Store</code>/<code>StoreContextMut</code> but since this API will move to <code>Instance</code> this won't be an issue anymore.</p>\n</blockquote>",
        "id": 569147165,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953117
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684767472\">PR review</a>.</p>",
        "id": 569147166,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953117
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684771109\">PR review</a>.</p>",
        "id": 569147245,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953185
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710471257\">PR review comment</a>:</p>\n<blockquote>\n<p>Fair enough -- I saw the types were public via <code>wasmtime_environ</code> but I'm happy to stick with <code>u32</code>s!</p>\n<p>I'll move the API over to <code>Instance</code> -- was trying to keep the debug API small and localized to a few methods on the store but I agree it makes more sense alongside other accessors per-instance.</p>\n</blockquote>",
        "id": 569147247,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768953185
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 569152111,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956555
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684884373\">PR review</a>.</p>",
        "id": 569152275,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956656
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710570241\">PR review comment</a>:</p>\n<blockquote>\n<p>Err, reading again your \"extra validation ahead of time\" -- once that bit is done, the rest of the logic is pretty trivial (one result expression) and actually a bit simpler than rebuilding an <code>EntityIndex</code> so I think I'll leave as-is -- happy to tweak if desired though.</p>\n</blockquote>",
        "id": 569152278,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956656
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684884681\">PR review</a>.</p>",
        "id": 569152297,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956665
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710570570\">PR review comment</a>:</p>\n<blockquote>\n<p>Done!</p>\n</blockquote>",
        "id": 569152299,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956665
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3684886126\">PR review</a>.</p>",
        "id": 569152348,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956699
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2710571619\">PR review comment</a>:</p>\n<blockquote>\n<p>Done! Added the bit to flag all functions as escaping and test cases both for call to unexported module-defined func and unexported import.</p>\n</blockquote>",
        "id": 569152349,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956700
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#issuecomment-3775623177\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>:</p>\n<blockquote>\n<p>Reworked now -- a bit more verbose API but seems more in line with what is there already. Thanks!</p>\n</blockquote>",
        "id": 569152416,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768956741
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2713134467\">PR review comment</a>:</p>\n<blockquote>\n<p>In addition to <code>CodeSectionEntry</code>, I think this'll need to be done for function imports too</p>\n</blockquote>",
        "id": 569287838,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010114
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2713144714\">PR review comment</a>:</p>\n<blockquote>\n<p>Instead of making the field public could this use the <code>instance.id()</code> method?</p>\n</blockquote>",
        "id": 569287840,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010114
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3687910013\">PR review</a>:</p>\n<blockquote>\n<p>FWIW we more-or-less consider <code>wasmtime-environ</code> to be a private crate for now. It's \"more public\" than everything else we have that's not actually public given its history, but we haven't pulled the trigger on making it actually official or anything like that. I think it would need a lot of API cleanups to have the same quality as <code>wasmtime</code>-the-crate.</p>\n</blockquote>",
        "id": 569287846,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010115
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3688019072\">PR review</a>.</p>",
        "id": 569291527,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769011060
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2713226907\">PR review comment</a>:</p>\n<blockquote>\n<p>Unfortunately that returns an <code>InstanceId</code> and we need a <code>StoreInstanceId</code> to index into the store; it appears that <code>fn id()</code> isn't used anywhere else for this purpose and all other accessors that pull out the <code>vm::Instance</code> from the store live in <code>instance.rs</code> and use the field directly. Happy to refactor all this in followup if you want to push it in a different direction!</p>\n</blockquote>",
        "id": 569291528,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769011060
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#pullrequestreview-3688045110\">PR review</a>.</p>",
        "id": 569293033,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769011373
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367#discussion_r2713249650\">PR review comment</a>:</p>\n<blockquote>\n<p>Surprisingly this is already done <a href=\"https://github.com/bytecodealliance/wasmtime/blob/1af6251a99500f38b1a35bc807fd302c1f3e2db9/crates/environ/src/compile/module_environ.rs#L825-L827\">here</a>; and the tests added in this PR already exercise that path as well (I was unsure too!).</p>\n</blockquote>",
        "id": 569293035,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769011373
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367 Debugging: provide access to private (non-exported) entities.</a> to the merge queue</p>",
        "id": 569293108,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769011390
    },
    {
        "content": "<p>github-merge-queue[bot] removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367 Debugging: provide access to private (non-exported) entities.</a> from the merge queue</p>",
        "id": 569298601,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769012754
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 569304079,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769014091
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 569304164,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769014106
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367 Debugging: provide access to private (non-exported) entities.</a> to the merge queue</p>",
        "id": 569307467,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769014834
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367</a>.</p>",
        "id": 569312753,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769016203
    },
    {
        "content": "<p>cfallin removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12367\">PR #12367 Debugging: provide access to private (non-exported) entities.</a> from the merge queue</p>",
        "id": 569312758,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769016204
    }
]