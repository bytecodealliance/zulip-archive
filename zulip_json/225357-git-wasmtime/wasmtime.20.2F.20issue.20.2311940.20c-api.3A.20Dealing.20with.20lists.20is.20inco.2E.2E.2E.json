[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11940\">issue #11940</a>:</p>\n<blockquote>\n<p>I wanted to write down something that irks me when working with Wasmtime's C/C++ API that I've noticed recently. It boils down to basically the handling of lists throughout the API is pretty inconsistent and varies place-to-place in terms of ownership, semantics, representation, and performance. For example:</p>\n<ul>\n<li><code>wasm_module_imports</code> fills out <code>wasm_importtype_vec_t*</code> which the caller needs to deallocate.</li>\n<li><code>wasm_functype_params</code> returns <code>const wasm_valtype_vec_t*</code> owned by the callee.</li>\n<li><code>wasmtime_instance_export_nth</code> is an iterator-style API of walking over a list (as opposed to returning a list)</li>\n<li><code>wasm_module_new</code> takes a byte list parameter as <code>const wasm_byte_vec_t*</code></li>\n<li><code>wasmtime_module_new</code> takes a byte list parameter as a ptr/len combo</li>\n<li><code>wasm_func_callback_t</code> takes arguments as <code>const wasm_val_vec_t*</code> and fills out <code>wasm_val_vec_t*</code> as a return</li>\n<li><code>wasmtime_func_callback_t</code> takes arguments/results as ptr/len combos</li>\n</ul>\n<p>Much, if not most, of this is <code>wasm.h</code> idioms clashing with what's natural to implement in Wasmtime. Wasmtime internally has some inconsistencies too, however -- in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11937\">https://github.com/bytecodealliance/wasmtime/pull/11937</a> the <code>wasmtime</code> Rust API  for getting the types of a function's parameters means that the result looks quite different than other C APIs.</p>\n<p>On one hand this is <code>wasm.h</code>-vs-not, but the way we've designed the C API right now is that it's not possible to avoid using <code>wasm.h</code> so users are forced to deal with this no matter what. That's not great, in my opinion, so I wanted to file this issue.</p>\n</blockquote>",
        "id": 547009232,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1761346836
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the wasmtime:c-api label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11940\">Issue #11940</a>.</p>",
        "id": 547009233,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1761346837
    }
]