[
    {
        "content": "<p>gramseyer opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">issue #12423</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>This test, when compiled to webassembly, succeeds with cranelift and fails on winch.  (both succeed on x86).  The compiled wasm is attached.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#![no_std]</span>\n\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">sha2</span><span class=\"p\">::</span><span class=\"n\">Digest</span><span class=\"p\">;</span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">hex_literal</span><span class=\"p\">::</span><span class=\"n\">hex</span><span class=\"p\">;</span>\n\n<span class=\"cp\">#[unsafe(export_name = </span><span class=\"s\">\"FFFFFFFFFFFFFFFF\"</span><span class=\"cp\">)]</span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"s\">\"C\"</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_hello</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">hash</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sha2</span><span class=\"p\">::</span><span class=\"n\">Sha256</span><span class=\"p\">::</span><span class=\"n\">digest</span><span class=\"p\">(</span><span class=\"s\">b\"hello\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">expect</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"kt\">u8</span><span class=\"p\">;</span><span class=\"mi\">32</span><span class=\"p\">]</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">hex</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"fm\">assert_eq!</span><span class=\"p\">(</span><span class=\"n\">hash</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">expect</span><span class=\"p\">.</span><span class=\"n\">into</span><span class=\"p\">());</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<p><code>wasmtime run --codegen compiler=winch --invoke FFFFFFFFFFFFFFFF hash_bug.wasm</code><br>\n<code>wasmtime run --codegen compiler=cranelift --invoke FFFFFFFFFFFFFFFF hash_bug.wasm</code></p>\n<h3>Expected Results</h3>\n<p>Both commands should run the wasm function and exit 0.</p>\n<h3>Actual Results</h3>\n<p>Cranelift succeeds, winch fails.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">FFFFFFFFFFFFFFFF</span><span class=\"w\"> </span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">winch</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">FFFFFFFFFFFFFFFF</span><span class=\"w\"> </span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wat</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">FFFFFFFFFFFFFFFF</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x7a4</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">FFFFFFFFFFFFFFFF</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">unreachable</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">executed</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime: 41.0.0 (bug also present on 40.0.0.  I have not tested earlier versions)</p>\n<p>Operating system: MacOS Tahoe 26.2</p>\n<p>Architecture: Aarch64</p>\n<h3>Extra Info</h3>\n<p>I attach the compiled wasm module below (as a WAT, renamed to a .txt; github won't allow a .wat or .wasm upload).  </p>\n<p><a href=\"https://github.com/user-attachments/files/24833583/hash_bug.txt\">hash_bug.txt</a><br>\n</p>\n</blockquote>",
        "id": 569832282,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769225697
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the winch label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">Issue #12423</a>.</p>",
        "id": 569832665,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769226286
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">Issue #12423</a>.</p>",
        "id": 569832669,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769226293
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423#issuecomment-3793694418\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">issue #12423</a>:</p>\n<blockquote>\n<p>cc @saulecabrera @jeffcharles </p>\n</blockquote>",
        "id": 569832698,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769226318
    },
    {
        "content": "<p>saulecabrera <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423#issuecomment-3797163716\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">issue #12423</a>:</p>\n<blockquote>\n<p>Thanks for the report, taking a look. </p>\n</blockquote>",
        "id": 569978967,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769371526
    },
    {
        "content": "<p>primoly <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423#issuecomment-3797164710\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">issue #12423</a>:</p>\n<blockquote>\n<p>Looks like <code>i32.rotl</code> and <code>i64.rotl</code> are broken on AArch64 Winch.</p>\n<p>Shrunken demo based on @gramseyerâ€™s original module:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mf\">23520</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">26</span>\n    <span class=\"nb\">i32.rotl</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mf\">2147484015</span>\n    <span class=\"nb\">i32.ne</span>\n    <span class=\"k\">if</span>\n      <span class=\"nb\">unreachable</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"FFFFFFFFFFFFFFFF\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n<p>Simpler example:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n    <span class=\"nb\">i32.rotl</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.ne</span>\n    <span class=\"k\">if</span>\n      <span class=\"nb\">unreachable</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"a\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n</blockquote>",
        "id": 569979022,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769371576
    },
    {
        "content": "<p>saulecabrera <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423#issuecomment-3838349159\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">issue #12423</a>:</p>\n<blockquote>\n<p>I've got a fix here <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12501\">https://github.com/bytecodealliance/wasmtime/pull/12501</a></p>\n</blockquote>",
        "id": 571556699,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770082992
    },
    {
        "content": "<p>fitzgen closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12423\">issue #12423</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>This test, when compiled to webassembly, succeeds with cranelift and fails on winch.  (both succeed on x86).  The compiled wasm is attached.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#![no_std]</span>\n\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">sha2</span><span class=\"p\">::</span><span class=\"n\">Digest</span><span class=\"p\">;</span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">hex_literal</span><span class=\"p\">::</span><span class=\"n\">hex</span><span class=\"p\">;</span>\n\n<span class=\"cp\">#[unsafe(export_name = </span><span class=\"s\">\"FFFFFFFFFFFFFFFF\"</span><span class=\"cp\">)]</span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"s\">\"C\"</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_hello</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">hash</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sha2</span><span class=\"p\">::</span><span class=\"n\">Sha256</span><span class=\"p\">::</span><span class=\"n\">digest</span><span class=\"p\">(</span><span class=\"s\">b\"hello\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">expect</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"kt\">u8</span><span class=\"p\">;</span><span class=\"mi\">32</span><span class=\"p\">]</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">hex</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"fm\">assert_eq!</span><span class=\"p\">(</span><span class=\"n\">hash</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">expect</span><span class=\"p\">.</span><span class=\"n\">into</span><span class=\"p\">());</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<p><code>wasmtime run --codegen compiler=winch --invoke FFFFFFFFFFFFFFFF hash_bug.wasm</code><br>\n<code>wasmtime run --codegen compiler=cranelift --invoke FFFFFFFFFFFFFFFF hash_bug.wasm</code></p>\n<h3>Expected Results</h3>\n<p>Both commands should run the wasm function and exit 0.</p>\n<h3>Actual Results</h3>\n<p>Cranelift succeeds, winch fails.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">FFFFFFFFFFFFFFFF</span><span class=\"w\"> </span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">winch</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">FFFFFFFFFFFFFFFF</span><span class=\"w\"> </span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wat</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">FFFFFFFFFFFFFFFF</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\">    </span><span class=\"mh\">0x7a4</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">hash_bug</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">FFFFFFFFFFFFFFFF</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">unreachable</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">executed</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime: 41.0.0 (bug also present on 40.0.0.  I have not tested earlier versions)</p>\n<p>Operating system: MacOS Tahoe 26.2</p>\n<p>Architecture: Aarch64</p>\n<h3>Extra Info</h3>\n<p>I attach the compiled wasm module below (as a WAT, renamed to a .txt; github won't allow a .wat or .wasm upload).  </p>\n<p><a href=\"https://github.com/user-attachments/files/24833583/hash_bug.txt\">hash_bug.txt</a><br>\n</p>\n</blockquote>",
        "id": 571689058,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770131882
    }
]