[
    {
        "content": "<p><a href=\"https://github.com/robherley\">robherley</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">Issue #10119</a>.</p>",
        "id": 496023568,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1737943989
    },
    {
        "content": "<p>robherley opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I have a minimal repro in this repository: <a href=\"https://github.com/robherley/wasmtime-bindgen-repro\">https://github.com/robherley/wasmtime-bindgen-repro</a></p>\n<h3>Steps to Reproduce</h3>\n<ol>\n<li>\n<p>Follow the example from wasmtime-wasi crate: <br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41\">https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41</a></p>\n</li>\n<li>\n<p>Attempt to compile.</p>\n</li>\n<li>Error, need to <code>cargo expand</code> (see my <a href=\"https://github.com/robherley/wasmtime-bindgen-repro/blob/main/tmp/expanded.rs\"><code>expanded.rs</code></a>) or add <code>include_generated_code_from_file: true</code> to the macro.</li>\n</ol>\n<h3>Expected Results</h3>\n<p>The generated binding have the correction function signatures.</p>\n<h3>Actual Results</h3>\n<p>&lt;img width=\"1040\" alt=\"Image\" src=\"<a href=\"https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640\">https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640</a>\" /&gt;</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: <code>29.0.1</code></p>\n<p>Operating system: <code>macOS 15.1.1</code></p>\n<p>Architecture: <code>arm64</code></p>\n<h3>Extra Info</h3>\n<p>The only affected bindings are:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">__with_name0</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">exit</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n<span class=\"n\">__with_name0</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">network</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>Which are missing <code>&amp;wasmtime_wasi::bindings::cli::exit::LinkOptions</code> and <code>&amp;wasmtime_wasi::bindings::sockets::network::LinkOptions</code></p>\n</blockquote>",
        "id": 496023570,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1737943990
    },
    {
        "content": "<p>robherley <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2614734031\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<p>I'm guessing this is related to runtime feature-gated options:</p>\n<ul>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/pull/9381\">https://github.com/bytecodealliance/wasmtime/pull/9381</a></li>\n</ul>\n<blockquote>\n<p>Instead, the generated add_to_linker*** functions take an additional LinkOptions parameter if the world/interface has any unstable features.</p>\n</blockquote>\n</blockquote>",
        "id": 496023973,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1737944276
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616547988\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<p>Thanks for the report! I think the problem may lie in your original WIT files perhaps? Looking at <a href=\"https://github.com/robherley/wasmtime-bindgen-repro/blob/main/wit/deps/wasi-cli-0.2.3/package.wit\">https://github.com/robherley/wasmtime-bindgen-repro/blob/main/wit/deps/wasi-cli-0.2.3/package.wit</a> I don't see exit-with-code which is a feature-gated API, which means that the two bindgens are starting from different WITs?</p>\n</blockquote>",
        "id": 496184330,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738001436
    },
    {
        "content": "<p>robherley <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616907241\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> @alexcrichton Thanks for following up so fast! It does look like the wit does not match the bindings provided by <code>wasmtime_wasi</code> crate. </p>\n<p>But, I resolved my <code>.wit</code> files from <a href=\"https://github.com/bytecodealliance/wasm-pkg-tools\">wkg</a>:</p>\n<p>&lt;img width=\"576\" alt=\"Image\" src=\"<a href=\"https://github.com/user-attachments/assets/e1f5f678-d577-4da3-81bb-49be3f91ada0\">https://github.com/user-attachments/assets/e1f5f678-d577-4da3-81bb-49be3f91ada0</a>\" /&gt;</p>\n<p>Which is odd, since the resolved version of <code>wasi-cli-0.2.3</code> doesn't seem to have <code>exit-with-code</code>? </p>\n<p>Even if I run:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wkg</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">cli</span><span class=\"o\">@</span><span class=\"mf\">0.2.3</span>\n<span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">wasi_cli</span><span class=\"o\">@</span><span class=\"mf\">0.2.3.</span><span class=\"n\">wit</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"o\">-</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">code</span>\n</code></pre></div>\n<p>There is no reference to the <code>@unstable(feature = cli-exit-with-code)</code>.</p>\n<p>Is the version of <code>wasi:cli</code> on the registry incorrect? Or is there something else I'm misunderstanding</p>\n</blockquote>",
        "id": 496212799,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738012438
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616922146\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<p>I think the issue might like with <code>wkg</code> yeah, there's some subtelties around handling WIT and features which might need some patching. Mind opening an issue over there and cc'ing me?</p>\n</blockquote>",
        "id": 496213946,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738012933
    },
    {
        "content": "<p>robherley closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I have a minimal repro in this repository: <a href=\"https://github.com/robherley/wasmtime-bindgen-repro\">https://github.com/robherley/wasmtime-bindgen-repro</a></p>\n<h3>Steps to Reproduce</h3>\n<ol>\n<li>\n<p>Follow the example from wasmtime-wasi crate: <br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41\">https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41</a></p>\n</li>\n<li>\n<p>Attempt to compile.</p>\n</li>\n<li>Error, need to <code>cargo expand</code> (see my <a href=\"https://github.com/robherley/wasmtime-bindgen-repro/blob/main/tmp/expanded.rs\"><code>expanded.rs</code></a>) or add <code>include_generated_code_from_file: true</code> to the macro.</li>\n</ol>\n<h3>Expected Results</h3>\n<p>The generated binding have the correction function signatures.</p>\n<h3>Actual Results</h3>\n<p>&lt;img width=\"1040\" alt=\"Image\" src=\"<a href=\"https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640\">https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640</a>\" /&gt;</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: <code>29.0.1</code></p>\n<p>Operating system: <code>macOS 15.1.1</code></p>\n<p>Architecture: <code>arm64</code></p>\n<h3>Extra Info</h3>\n<p>The only affected bindings are:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">__with_name0</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">exit</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n<span class=\"n\">__with_name0</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">network</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>Which are missing <code>&amp;wasmtime_wasi::bindings::cli::exit::LinkOptions</code> and <code>&amp;wasmtime_wasi::bindings::sockets::network::LinkOptions</code></p>\n</blockquote>",
        "id": 496214625,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738013246
    },
    {
        "content": "<p>robherley <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616931463\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10119\">issue #10119</a>:</p>\n<blockquote>\n<p>Totally, I'll close this one out <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 496214629,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738013247
    }
]