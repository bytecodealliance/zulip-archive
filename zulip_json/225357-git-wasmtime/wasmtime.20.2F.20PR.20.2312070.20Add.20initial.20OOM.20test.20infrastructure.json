[
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a> from <code>fitzgen:oom-test</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>Baby steps towards <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12069\">https://github.com/bytecodealliance/wasmtime/issues/12069</a></p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 558761483,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763764402
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>.</p>",
        "id": 558761484,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763764403
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers\">wasmtime-fuzz-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>.</p>",
        "id": 558761486,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763764403
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>.</p>",
        "id": 558761487,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763764404
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3494605510\">PR review</a>.</p>",
        "id": 558762687,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763765232
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2551144853\">PR review comment</a>:</p>\n<blockquote>\n<p>Given how low-level allocation is and how high-level printing/backtraces are, I think it'd probably be best to remove this. I'd imagine that any error-related to OOM would already be aborting and/or something in a context where we could get a stack trace, so logging/printing a new one here seems ok to defer to that style of debugging. Basically I'd be worried that the <code>OutsideOomTest</code> is not sufficient to block any possible malloc anywhere to be able to print/backtrace on that call.</p>\n<p>Could also wait to see if it's a problem too, and it may not end up being a problem.</p>\n</blockquote>",
        "id": 558762688,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763765232
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2551147037\">PR review comment</a>:</p>\n<blockquote>\n<p>This feels onerous to me to require which is to say that after one allocation fails all other allocations must be avoided entirely. I could imagine it being pretty reasonable that allocations are still attempted on some paths which are then also handled if they fail.</p>\n<p>Would it make sense to hard-return null while <code>DidOom</code> is true to \"permanently OOM\"? Or maybe only force one OOM but let other allocations keep going?</p>\n</blockquote>",
        "id": 558762689,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763765232
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2551151076\">PR review comment</a>:</p>\n<blockquote>\n<p>This feels perhaps a bit over-ambitious to me where we might have various edge cases where allocation failure can be handled. For example we might have a test saying \"invoke a function twice\" which invokes it a second time even if the first time failed, ensuring that an OOM on one call doesn't prevent some other call from happening (and reading corrupted state/etc). In such a situation the test would still return success, despite handling the OOM.</p>\n<p>More generally given that the main goal here is \"didn't abort on OOM\" I'd think it'd be reasonable to transform this to \"well the test returned to that means success, yay!\"</p>\n</blockquote>",
        "id": 558762690,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763765232
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2551153657\">PR review comment</a>:</p>\n<blockquote>\n<p>This'll likely want to be in a <code>Drop</code> to avoid heavily crashing the process by accident in the case that <code>test_func</code> panics</p>\n</blockquote>",
        "id": 558762691,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763765232
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3494660689\">PR review</a>.</p>",
        "id": 558765109,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763766924
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2551189871\">PR review comment</a>:</p>\n<blockquote>\n<p>Currently oom failure aborts without backtrace, just a panic message containing the amount of bytes it attempted to allocate.</p>\n</blockquote>",
        "id": 558765110,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763766924
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3494694988\">PR review</a>.</p>",
        "id": 558766598,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763768110
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2551218855\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh sure yeah, but that's a pretty easy event to break on in a debugger to get a backtrace</p>\n</blockquote>",
        "id": 558766602,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763768110
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#issuecomment-3565329874\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"fuzzing\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>fitzgen: fuzzing</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 558776946,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1763777705
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3501571338\">PR review</a>.</p>",
        "id": 559114246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764006638
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2557208154\">PR review comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>Could also wait to see if it's a problem too, and it may not end up being a problem.</p>\n</blockquote>\n<p>I'd prefer to do this, just because, while it is always possible to attach a debugger to get the stack trace, it is an extra step and I'd prefer to just have the log immediately if possible. Of course, if it does become a problem, we can remove it.</p>\n</blockquote>",
        "id": 559114248,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764006638
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3501589508\">PR review</a>.</p>",
        "id": 559115376,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764006998
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2557223114\">PR review comment</a>:</p>\n<blockquote>\n<p>Agreed that this is pretty strict, but I think we should at least aim high and see if it is really too onerous before backing down. Especially as the effort begins, we are going to be testing smaller pieces of code where it probably is very reasonable to match this strict behavior. As we start testing larger and larger amounts of code at the same time, then we can loosen things up a bit, and when we do that, I'd like to do it via adding config knobs to <code>OomTest</code> rather than loosening the requirements for all existing tests.</p>\n<p>But yeah I'd imagined that when we are in the \"non-strict\" mode, we would treat <code>DidOom</code> as <code>AlwaysOomFromNowOn</code>, if we wanted to allow allocation to continue. If we want to allow subsequent allocations to potentially succeed instead, then I think we would want to enforce an available bytes limit, and let deallocations raise the available bytes again. Which is an interesting idea. Perhaps worth investigating in the future (but not in this PR obviously).</p>\n</blockquote>",
        "id": 559115377,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764006998
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3501746055\">PR review</a>.</p>",
        "id": 559124971,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764009774
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2557336895\">PR review comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>This feels perhaps a bit over-ambitious to me where we might have various edge cases where allocation failure can be handled.</p>\n</blockquote>\n<p>Again, I'd prefer to start ambitious, and have that be the default, and then add knobs to loosen things up and be less strict that tests opt into.</p>\n<blockquote>\n<p>For example we might have a test saying \"invoke a function twice\" which invokes it a second time even if the first time failed, ensuring that an OOM on one call doesn't prevent some other call from happening (and reading corrupted state/etc). In such a situation the test would still return success, despite handling the OOM.</p>\n</blockquote>\n<p>Right and this kind of test is one where we would definitely twist that knob.</p>\n<p>But, at least how I am imagining things now, most (all?) of these \"retry\" code paths will be in embedder code, not in the core Wasmtime APIs themselves. For example, instance allocation will just return an error on OOM, not try again N times or attempt to free anything before trying again; all of that logic really belongs in the embedder, IMO. So probably most of our tests can actually work in the stricter mode (but we should also test retrying to exercise things for when the embedder will do it).</p>\n</blockquote>",
        "id": 559124974,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764009775
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#pullrequestreview-3501750503\">PR review</a>.</p>",
        "id": 559125292,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764009875
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070#discussion_r2557340551\">PR review comment</a>:</p>\n<blockquote>\n<p>That's a great point, will do in a minute.</p>\n</blockquote>",
        "id": 559125297,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764009875
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>.</p>",
        "id": 559127928,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764010705
    },
    {
        "content": "<p>fitzgen has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>.</p>",
        "id": 559128041,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764010739
    },
    {
        "content": "<p>fitzgen merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12070\">PR #12070</a>.</p>",
        "id": 559138323,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1764013724
    }
]