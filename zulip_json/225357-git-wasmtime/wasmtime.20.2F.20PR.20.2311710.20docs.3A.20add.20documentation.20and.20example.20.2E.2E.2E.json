[
    {
        "content": "<p>maxnatamo opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a> from <code>maxnatamo:docs/add-additional-stackmap-documentation</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<ul>\n<li>Adds a documentation entry for how stack maps might be used to implement a garbage collector.</li>\n<li>Adds an example project which shows off how a simple garbage collector might actually be implemented. Currently only supports <code>x64</code> and <code>aarch64</code> (only tested on <code>aarch64</code> macOS). The code might be slightly overdone, but it was also copied from a side-project.</li>\n</ul>\n<p>This was originally <a href=\"#narrow/channel/217117-cranelift/topic/Guidelines.20on.20marking.20stack.20map.20entries/with/540049955\">discussed on Zulip</a>.<br>\n</p>\n</blockquote>",
        "id": 540311540,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758225846
    },
    {
        "content": "<p><strong>maxnatamo</strong> requested <a href=\"https://github.com/abrown\">abrown</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>.</p>",
        "id": 540311541,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758225846
    },
    {
        "content": "<p><strong>maxnatamo</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>.</p>",
        "id": 540311542,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758225846
    },
    {
        "content": "<p><strong>abrown</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>.</p>",
        "id": 540511063,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758305435
    },
    {
        "content": "<p>abrown <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313262245\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>cc: @fitzgen, you probably have more context here?</p>\n</blockquote>",
        "id": 540511116,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758305462
    },
    {
        "content": "<p>maxnatamo <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313523152\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>There seems to be an issue with getting the correct return addresses when walking the stack on x64 Linux.</p>\n<p>From what I gather, it's because Rust doesn't use frame pointers the same way on some targets. It can be fixed by forcing frame pointers using <code>-Cforce-frame-pointers</code>, but I hope there is a better solution.</p>\n</blockquote>",
        "id": 540521117,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758309684
    },
    {
        "content": "<p>maxnatamo edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313523152\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>There seems to be an issue with getting the correct return addresses when walking the stack on x64 Linux.</p>\n<p>From what I gather, it's because Rust and/or LLVM doesn't use frame pointers the same way on some targets. It can be fixed by forcing frame pointers using <code>-Cforce-frame-pointers</code>, but I hope there is a better solution.</p>\n</blockquote>",
        "id": 540521148,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758309702
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313658841\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<blockquote>\n<p>There seems to be an issue with getting the correct return addresses when walking the stack on x64 Linux.</p>\n<p>From what I gather, it's because Rust and/or LLVM doesn't use frame pointers the same way on some targets. It can be fixed by forcing frame pointers using <code>-Cforce-frame-pointers</code>, but I hope there is a better solution.</p>\n</blockquote>\n<p>I gather you're building your own runtime, but to offer parallel wisdom from Wasmtime, we know that we can only trust any invariants about the code that we ourselves generate with Cranelift; so we record entry and exit FPs for an \"activation\" of Wasm (call into Wasm from host, call from Wasm back out to host) and only walk the FP chain in that range. In general, when interacting with code produced by other compilers you need to follow their ABI (which in general on Linux means no frame pointers required, and using DWARF to interpret stack frames and unwind them).</p>\n</blockquote>",
        "id": 540526276,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758312211
    },
    {
        "content": "<p>maxnatamo <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313804460\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>Is there an \"easy\" solution which won't pollute the example with stack walking code? Could something like the <code>unwinder</code> crate in Wasmtime function here? I'll admit, this is outside of what I know about stack frames, unwinding, etc.</p>\n</blockquote>",
        "id": 540533619,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758316003
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313957919\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>No, Wasmtime's unwinder has nothing to do with native stack frames; it is specific to Wasmtime's metadata format.</p>\n<p>You'll probably want to do similar to Wasmtime (and Cranelift's <code>clif-util</code> test runner) and emit a trampoline that uses <code>get_frame_pointer</code> at both ends of your Cranelift frames (entry and exit), then delimit your walk by those -- this very reason is why we added that intrinsic.</p>\n</blockquote>",
        "id": 540537592,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758318853
    },
    {
        "content": "<p>maxnatamo updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>.</p>",
        "id": 540600143,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758389005
    },
    {
        "content": "<p>maxnatamo <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3315127045\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>I've tried implementing something similar to what Wasmtime does, but I'm a little in over my head with this. The new implementation walks frame entries which are pushed and popped from trampolines, but the stack pointer is way off. There might be a simple solution to this, but I might've stared at this code for too long.</p>\n</blockquote>",
        "id": 540600413,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758389330
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3324799564\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>Hi @maxnatamo, I don't have time to help debug this example program. In general, I'd suggest simplifying as much as possible, doing nothing else but saving the FP/SP that bookend each activation, make sure that works in isolation, and then slowly add more from there, checking that things look right along the way.</p>\n<p>In the meantime, adding the doc comment expansions <a href=\"https://github.com/bytecodealliance/wasmtime/blob/56dcd4ed0da432440c9b976e844f9e65d803f9ae/cranelift/frontend/src/frontend.rs#L537-L548\">here</a> that we talked about on Zulip might be the expeditious option.</p>\n</blockquote>",
        "id": 541058686,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758645710
    },
    {
        "content": "<p>maxnatamo <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3330626212\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11710\">PR #11710</a>:</p>\n<blockquote>\n<p>I can split the documentation entry and example into two separate PRs, if that helps. Then if I can't get the example working, the documentation can still be merged in. </p>\n</blockquote>",
        "id": 541326659,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1758746137
    }
]