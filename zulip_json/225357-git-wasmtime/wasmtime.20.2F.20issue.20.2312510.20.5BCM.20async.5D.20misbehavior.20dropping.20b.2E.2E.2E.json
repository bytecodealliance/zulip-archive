[
    {
        "content": "<p>lukewagner opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510\">issue #12510</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/WebAssembly/component-model/commit/8360a76d66b1cfe34d1908f19edabe9d8ed95b59\">This weird test</a> (currently on <code>main</code>) drops a borrowed handle when the current task is different from the task that initially received the borrowed handle.  To handle this case correctly, the runtime can't decrement the <em>current task</em>'s \"number of outstanding borrowed handles\" but must instead derive the task from the borrowed handle being dropped.</p>\n<p>In more detail: <a href=\"https://github.com/WebAssembly/component-model/commit/8360a76d66b1cfe34d1908f19edabe9d8ed95b59#diff-ca76efe473f85589feb091524d7bc78f51238418c62fb287fab5a0cb9a923e29R41-R49\">this is the function</a> that receives the borrowed handle and <a href=\"https://github.com/WebAssembly/component-model/commit/8360a76d66b1cfe34d1908f19edabe9d8ed95b59#diff-ca76efe473f85589feb091524d7bc78f51238418c62fb287fab5a0cb9a923e29R55-R61\">this is the function</a> that drops it.  When the latter function returns, it traps with \"borrow handles still remain at the end of the call\"; I'm guessing because it decremented its own task's counter which underflowed from <code>0</code> to non-<code>0</code>.</p>\n</blockquote>",
        "id": 571797011,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770166046
    },
    {
        "content": "<p><a href=\"https://github.com/lukewagner\">lukewagner</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510\">Issue #12510</a>.</p>",
        "id": 571797013,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770166047
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510#issuecomment-3844794007\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510\">issue #12510</a>:</p>\n<blockquote>\n<p>In debug mode I get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">dev</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.10</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span><span class=\"err\">`</span>\n\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">3151422</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">runtime</span><span class=\"o\">/</span><span class=\"n\">vm</span><span class=\"o\">/</span><span class=\"n\">component</span><span class=\"o\">/</span><span class=\"n\">resources</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">247</span><span class=\"p\">:</span><span class=\"mi\">17</span><span class=\"p\">:</span>\n<span class=\"nc\">attempt</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">subtract</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">overflow</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div>\n<p>so agreed this is an underflow of the wrong counter!</p>\n</blockquote>",
        "id": 571802211,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770169944
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the wasm-proposal:component-model-async label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510\">Issue #12510</a>.</p>",
        "id": 571802760,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770170374
    },
    {
        "content": "<p>alexcrichton assigned alexcrichton to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510\">issue #12510</a>.</p>",
        "id": 572875574,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770667519
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12510\">issue #12510</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/WebAssembly/component-model/commit/8360a76d66b1cfe34d1908f19edabe9d8ed95b59\">This weird test</a> (currently on <code>main</code>) drops a borrowed handle when the current task is different from the task that initially received the borrowed handle.  To handle this case correctly, the runtime can't decrement the <em>current task</em>'s \"number of outstanding borrowed handles\" but must instead derive the task from the borrowed handle being dropped.</p>\n<p>In more detail: <a href=\"https://github.com/WebAssembly/component-model/commit/8360a76d66b1cfe34d1908f19edabe9d8ed95b59#diff-ca76efe473f85589feb091524d7bc78f51238418c62fb287fab5a0cb9a923e29R41-R49\">this is the function</a> that receives the borrowed handle and <a href=\"https://github.com/WebAssembly/component-model/commit/8360a76d66b1cfe34d1908f19edabe9d8ed95b59#diff-ca76efe473f85589feb091524d7bc78f51238418c62fb287fab5a0cb9a923e29R55-R61\">this is the function</a> that drops it.  When the latter function returns, it traps with \"borrow handles still remain at the end of the call\"; I'm guessing because it decremented its own task's counter which underflowed from <code>0</code> to non-<code>0</code>.</p>\n</blockquote>",
        "id": 572936172,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770694915
    }
]