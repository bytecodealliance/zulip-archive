[
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537943714,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757104780
    },
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a> from <code>cfallin:oh-exception-handler-what-is-your-address</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This is designed to enable applications such as #11592 that use alternative unwinding mechanisms that may not necessarily want to walk a stack and look up exception tables. The idea is that whenever it would be valid to resume to an exception handler that is active on the stack, we can provide the same PC as a first-class runtime value that would be found in the exception table for the given handler edge. A \"custom\" resume step can then use this PC as a resume-point as long as it follows the relevant exception ABI (i.e.: restore SP, FP, any other saved registers that the exception ABI specifies, and provide appropriate payload value(s)).</p>\n<p>Handlers are associated with edges out of <code>try_call</code>s (or <code>try_call_indirect</code>s); and edges specifically, not blocks, because there could be multiple out-edges to one block. The instruction thus takes the block that contains the try-call and an immediate that indexes its exceptional edges.</p>\n<p>This CLIF instruction required a bit of infrastructure to (i) allow naming raw blocks, not just block calls, as instruction arguments, and (ii) allow getting the MachLabel for any other lowered block during lowering. But given that, the lowerings themselves are straightforward uses of MachBuffer labels to fix-up PC-relative address-loading instructions (e.g., <code>LEA</code> or <code>ADR</code> or <code>AUIPC</code>+<code>ADDI</code>).</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 537943715,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757104780
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537943716,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757104780
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537946512,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757105945
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537946631,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757106002
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#pullrequestreview-3190797669\">PR review</a>:</p>\n<blockquote>\n<p>LGTM, thanks for whipping this up!</p>\n</blockquote>",
        "id": 537947919,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757106607
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537948056,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757106682
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#pullrequestreview-3190821771\">PR review</a>:</p>\n<blockquote>\n<p>Thanks for this! This'll definitely help cleanup #11592. I think the main thing that I was missing was that the target in question is a <code>MachLabel</code> that the <code>MachBuffer</code> already has on its creation since it reserves for all blocks. That makes total sense in retrospect, but bypasses what I was worried about where new labels might need be created and bound to previously-added addresses.</p>\n<p>Otherwise I'm curious below about the lookup of the handler in vcode where it doesn't have an adjust-by-1 I'd otherwise expect. Also I'm curious about how this interacts with tables that have a mixture of blocks/defaults/contexts, specifically contexts, and clarifying that the index effectively skips all context arguments?</p>\n</blockquote>",
        "id": 537949816,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757107680
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326079125\">PR review comment</a>:</p>\n<blockquote>\n<p>Mind adding a few more tests here?</p>\n<ul>\n<li>Is it valid to have 0 handlers on a <code>try_call</code>? If so can this test that a 0 index is out-of-bounds?</li>\n<li>A valid test that selects a default handler.</li>\n<li>A valid test that selects a non-default handler.</li>\n<li>A valid test that selects a handler from a non-length-1 list of handlers.</li>\n<li>A valid test which selects the Nth handler when there's also context arguments interspersed throughout the list of handlers. (the index is a block index, so not an index in  the exception table data right?)</li>\n</ul>\n</blockquote>",
        "id": 537949817,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757107680
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326071011\">PR review comment</a>:</p>\n<blockquote>\n<p>Is the -1 here to skip the non-exceptional block at the front? If so mind leaving a comment to that effect? (and maybe model this as <code>if etd.all_branches[1..].get(index).is_none()</code>)</p>\n</blockquote>",
        "id": 537949818,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757107680
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326074787\">PR review comment</a>:</p>\n<blockquote>\n<p>As a mild bikeshed these can probably be named something like \"load the label address in this register\" since it's not really relate to exceptions. I'm a bit sad a new MInst was needed everywhere but on-the-whole this is a great change!</p>\n</blockquote>",
        "id": 537949819,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757107680
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326072326\">PR review comment</a>:</p>\n<blockquote>\n<p>In <code>verify_try_call_handler_index</code> below there's an offset-by-1 to skip what I presume is the default normal-return path, but this doesn't seem to also have a -1 or adjust-by-1 anywhere. Is that intentional?</p>\n</blockquote>",
        "id": 537949821,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757107680
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#pullrequestreview-3190923456\">PR review</a>.</p>",
        "id": 537953885,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110283
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326140386\">PR review comment</a>:</p>\n<blockquote>\n<p>Done!</p>\n</blockquote>",
        "id": 537953887,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110284
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537953888,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110285
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#pullrequestreview-3190923624\">PR review</a>.</p>",
        "id": 537953894,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110288
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326140513\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, this helper returns any successor, not limited to exceptional edges. Separately there is the invariant that exceptional edges come first out of a <code>try_call</code> block, so we can use the exceptional-edge index as the block successor index where we invoke this. (There's a comment in <code>block_exn_successor_label</code> in <code>machinst/isle.rs</code> where this helper is called noting this.)</p>\n</blockquote>",
        "id": 537953896,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110289
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#pullrequestreview-3190923791\">PR review</a>.</p>",
        "id": 537953903,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110294
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326140639\">PR review comment</a>:</p>\n<blockquote>\n<p>The non-exceptional block is actually stored last (I originally had it the other way but that came out of code-review discussion IIRC); but the <code>- 1</code> is just because for N out-edges there are N-1 handlers we can select. Will add a comment.</p>\n</blockquote>",
        "id": 537953904,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110294
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537954478,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110805
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#pullrequestreview-3190952743\">PR review</a>.</p>",
        "id": 537954567,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110895
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#discussion_r2326156633\">PR review comment</a>:</p>\n<blockquote>\n<p>Sure, added in 9db98f47b8622f35f73efc09c4d799094560119a (three tests to cover all those cases).</p>\n<p>To confirm: zero handlers is valid (first test); tagged and default can be selected (second and third tests); the index is among handlers, in the order they appear, skipping dynamic context table items.</p>\n</blockquote>",
        "id": 537954568,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110895
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#issuecomment-3259917744\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>:</p>\n<blockquote>\n<p>Updated, thanks @alexcrichton ! Will wait for your r+ as well before merging.</p>\n</blockquote>",
        "id": 537954611,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757110929
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537955065,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757111189
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629#issuecomment-3259927833\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>:</p>\n<blockquote>\n<p>Oh protocol-wise I'm fine having feedback handled in a follow-up PR myself, but thanks though! I'm kind of tired so I'm going to call it for today, but I'll once-over on Monday (I suspect everything is fine though)</p>\n</blockquote>",
        "id": 537955169,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757111240
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11629\">PR #11629</a>.</p>",
        "id": 537960321,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757115860
    }
]