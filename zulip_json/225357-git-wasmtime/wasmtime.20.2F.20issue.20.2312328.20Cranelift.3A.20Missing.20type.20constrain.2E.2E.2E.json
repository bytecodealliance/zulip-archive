[
    {
        "content": "<p>zzjas opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">optimize</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">opt_level</span><span class=\"o\">=</span><span class=\"n\">speed</span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">trigger_bug</span><span class=\"p\">(</span><span class=\"n\">i32x4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i32x4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">i32x4</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">i32x4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">i32x4</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">sgt</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n<span class=\"w\">    </span><span class=\"n\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">slt</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n<span class=\"w\">    </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">band</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v4</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">bin</span><span class=\"w\"> </span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>No crash</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">worker</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mi\">0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1654070</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">opts</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">191</span><span class=\"p\">:</span><span class=\"mi\">5</span><span class=\"p\">:</span>\n<span class=\"nc\">unimplemented</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"n\">bits</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: 54c1192eed26434359f3263e4fe95f3d8a2fa520</p>\n<p>Operating system: Ubuntu 22.04.5</p>\n<p>Architecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>The optimization rules at <code>cranelift/codegen/src/opts/icmp.isle</code> lines 316-351 produce <code>(iconst_u ty 0)</code> without constraining ty to scalar types. When <code>ty</code> is a 128-bit vector type (e.g., <code>i32x4</code>), <code>iconst_u calls ty_umax()</code> → <code>ty_mask()</code>, which computes <code>64_u64.checked_sub(ty_bits)</code>. For 128-bit types, this underflows and panics with \"unimplemented for &gt; 64 bits\". Fix would be smilar to #12179. </p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351\">https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351</a></p>\n<p>Thanks for looking into this and please let us know if we missed anything or if you have any feedback!<br>\n</p>\n</blockquote>",
        "id": 567662643,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768262009
    },
    {
        "content": "<p><a href=\"https://github.com/zzjas\">zzjas</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">Issue #12328</a>.</p>",
        "id": 567662644,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768262009
    },
    {
        "content": "<p><a href=\"https://github.com/zzjas\">zzjas</a> added the cranelift label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">Issue #12328</a>.</p>",
        "id": 567662645,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768262009
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3741094381\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<p>@zzjas would you be willing to try your hand at the fix?</p>\n<p>(No worries if not, but this is a standard question I like to ask new folks doing fuzzing: fuzzing to find the issues is relatively less work than actually fixing them, and so in the interest of avoiding a labor imbalance / DoS'ing our project, and since you point out what the likely fix is, I want to see if you're willing to take on the fixes themselves as well -- thanks!)</p>\n</blockquote>",
        "id": 567663835,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768262774
    },
    {
        "content": "<p>zzjas <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3741112258\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<p>Yes for sure I'd love to prepare a fix and some more test cases (probably later tomorrow). Thanks!</p>\n</blockquote>",
        "id": 567664302,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768263026
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the fuzz-bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">Issue #12328</a>.</p>",
        "id": 567664982,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768263549
    },
    {
        "content": "<p>lmtdit <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<p>Hi Chris,</p>\n<p>Thank you for the suggestion. I'd be happy to work on a fix for this issue<br>\nand will aim to submit a patch with additional test cases tomorrow. I'll<br>\nmake sure to follow the pattern from #12179 to properly constrain the type<br>\nin the ISLE icmp rules.</p>\n<p>I'll reach out if I have any questions during implementation.</p>\n<p>Best regards,<br>\nZijie Zhao</p>\n<p>Zijie Zhao <strong><em>@</em></strong>.***&gt; 于2026年1月13日周二 07:53写道：</p>\n<blockquote>\n<p><em>zzjas</em> created an issue (<a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">bytecodealliance/wasmtime#12328</a>)<br>\n&lt;<a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">https://github.com/bytecodealliance/wasmtime/issues/12328</a>&gt;<br>\n.clif Test Case</p>\n<p>test optimize<br>\nset opt_level=speed<br>\ntarget x86_64</p>\n<p>function %trigger_bug(i32x4, i32x4) -&gt; i32x4 {<br>\nblock0(v0: i32x4, v1: i32x4):<br>\n    v2 = icmp sgt v0, v1<br>\n    v3 = icmp slt v0, v1<br>\n    v4 = band v2, v3<br>\n    return v4<br>\n}</p>\n<p>Steps to Reproduce</p>\n<p>RUST_BACKTRACE=1 cargo run -p cranelift-tools --bin clif-util -- test test.clif</p>\n<p>Expected Results</p>\n<p>No crash<br>\nActual Results</p>\n<p>thread 'worker #0' (1654070) panicked at cranelift/codegen/src/opts.rs:191:5:<br>\nunimplemented for &gt; 64 bits</p>\n<p>Versions and Environment</p>\n<p>Cranelift version or commit: 54c1192<br>\n&lt;<a href=\"https://github.com/bytecodealliance/wasmtime/commit/54c1192eed26434359f3263e4fe95f3d8a2fa520\">https://github.com/bytecodealliance/wasmtime/commit/54c1192eed26434359f3263e4fe95f3d8a2fa520</a>&gt;</p>\n<p>Operating system: Ubuntu 22.04.5</p>\n<p>Architecture: x86_64<br>\nExtra Info</p>\n<p>The optimization rules at cranelift/codegen/src/opts/icmp.isle lines<br>\n316-351 produce (iconst_u ty 0) without constraining ty to scalar types.<br>\nWhen ty is a 128-bit vector type (e.g., i32x4), iconst_u calls ty_umax()<br>\n→ ty_mask(), which computes 64_u64.checked_sub(ty_bits). For 128-bit<br>\ntypes, this underflows and panics with \"unimplemented for &gt; 64 bits\". Fix<br>\nwould be smilar to #12179<br>\n&lt;<a href=\"https://github.com/bytecodealliance/wasmtime/pull/12179\">https://github.com/bytecodealliance/wasmtime/pull/12179</a>&gt;.</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351\">https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351</a></p>\n<p>Thanks for looking into this and please let us know if we missed anything<br>\nor if you have any feedback!</p>\n<p>—<br>\nReply to this email directly, view it on GitHub<br>\n&lt;<a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">https://github.com/bytecodealliance/wasmtime/issues/12328</a>&gt;, or<br>\nunsubscribe<br>\n&lt;<a href=\"https://github.com/notifications/unsubscribe-auth/ABBFIVKLLLSN5QR7MUQK3J34GQXZHAVCNFSM6AAAAACRPJV3B6VHI2DSMVQWIX3LMV43ASLTON2WKOZTHAYDMNBTGM3DSMQ\">https://github.com/notifications/unsubscribe-auth/ABBFIVKLLLSN5QR7MUQK3J34GQXZHAVCNFSM6AAAAACRPJV3B6VHI2DSMVQWIX3LMV43ASLTON2WKOZTHAYDMNBTGM3DSMQ</a>&gt;<br>\n.<br>\nYou are receiving this because you are subscribed to this thread.Message<br>\nID: <strong><em>@</em></strong>.***&gt;</p>\n</blockquote>\n</blockquote>",
        "id": 567693869,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768286823
    },
    {
        "content": "<p>zzjas <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3746224993\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<p>No idea who <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302\">https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302</a> is. It's not my account and not my message -- probably a spam...</p>\n</blockquote>",
        "id": 567847394,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768333716
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3746722626\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<blockquote>\n<p>No idea who <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302\">#12328 (comment)</a> is. It's not my account and not my message -- probably a spam...</p>\n</blockquote>\n<p>Thanks, I blocked them.</p>\n</blockquote>",
        "id": 567864419,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768340967
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12328\">issue #12328</a>:</p>\n<blockquote>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">optimize</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">opt_level</span><span class=\"o\">=</span><span class=\"n\">speed</span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">trigger_bug</span><span class=\"p\">(</span><span class=\"n\">i32x4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i32x4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">i32x4</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">i32x4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">i32x4</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">sgt</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n<span class=\"w\">    </span><span class=\"n\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">slt</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n<span class=\"w\">    </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">band</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v4</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">bin</span><span class=\"w\"> </span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>No crash</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">worker</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mi\">0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1654070</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">opts</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">191</span><span class=\"p\">:</span><span class=\"mi\">5</span><span class=\"p\">:</span>\n<span class=\"nc\">unimplemented</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"n\">bits</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: 54c1192eed26434359f3263e4fe95f3d8a2fa520</p>\n<p>Operating system: Ubuntu 22.04.5</p>\n<p>Architecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>The optimization rules at <code>cranelift/codegen/src/opts/icmp.isle</code> lines 316-351 produce <code>(iconst_u ty 0)</code> without constraining ty to scalar types. When <code>ty</code> is a 128-bit vector type (e.g., <code>i32x4</code>), <code>iconst_u calls ty_umax()</code> → <code>ty_mask()</code>, which computes <code>64_u64.checked_sub(ty_bits)</code>. For 128-bit types, this underflows and panics with \"unimplemented for &gt; 64 bits\". Fix would be smilar to #12179. </p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351\">https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351</a></p>\n<p>Thanks for looking into this and please let us know if we missed anything or if you have any feedback!<br>\n</p>\n</blockquote>",
        "id": 567877825,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768347365
    }
]