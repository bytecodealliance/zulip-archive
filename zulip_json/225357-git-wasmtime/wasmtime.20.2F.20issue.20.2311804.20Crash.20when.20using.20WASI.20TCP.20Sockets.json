[
    {
        "content": "<p>dan-bishopfox opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>I can reliably reproduce a crash in wasmtime wasi p2 sockets. </p>\n<p>The setup for it is a bit complex, so I made a minimal repo to reproduce it. Instructions are there in the readme.<br>\n<a href=\"https://github.com/dan-bishopfox/crash_wasi\">https://github.com/dan-bishopfox/crash_wasi</a></p>\n<p>Basically, we just use TCP sockets from within Wasm WASI p2 code and it crashes. Nothing special beyond that. The scaffolding in the repo is just there to setup some sample code that loads and runs the Wasm.</p>\n<p>Let me know if there's anything else you need or if you have any issue reproducing it. <br>\nThanks!</p>\n</blockquote>",
        "id": 543589118,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759858696
    },
    {
        "content": "<p><a href=\"https://github.com/dan-bishopfox\">dan-bishopfox</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">Issue #11804</a>.</p>",
        "id": 543589123,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759858696
    },
    {
        "content": "<p>tschneidereit <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3377960050\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>@dan-bishopfox thank you for reporting this. The Repo with the PoC isn't public it seems, PLEASE KEEP IT THAT WAY!</p>\n<p>Process crashes are <a href=\"https://docs.wasmtime.dev/security-what-is-considered-a-security-vulnerability.html\">denial-of-service attack vectors</a>, so we'd like to be able to <a href=\"https://bytecodealliance.org/security#disclosure-policy\">disclose them responsibly</a>.</p>\n<p>If you could give the @bytecodealliance/wasmtime-core team access to the repo or otherwise share it privately with us, that'd greatly appreciated!</p>\n</blockquote>",
        "id": 543591317,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759859487
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3377966609\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Sure thing! I didn't notice you considered that a security issue sorry. </p>\n</blockquote>",
        "id": 543591639,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759859601
    },
    {
        "content": "<p>tschneidereit <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3377978906\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Nothing to be sorry about: while that'd make our lives easier, we certainly don't have the expectation that everyone knows our exact definition of security issues :)</p>\n<p>And again, thank you for the report!</p>\n</blockquote>",
        "id": 543592224,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759859814
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3377984409\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>@tschneidereit I don't see the <code>@bytecodealliance/wasmtime-core</code> team in github...</p>\n<p>&lt;img width=\"869\" height=\"344\" alt=\"Image\" src=\"<a href=\"https://github.com/user-attachments/assets/e13b1ce0-8065-44bf-8d9d-d156b06ff072\">https://github.com/user-attachments/assets/e13b1ce0-8065-44bf-8d9d-d156b06ff072</a>\" /&gt;</p>\n</blockquote>",
        "id": 543592490,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759859920
    },
    {
        "content": "<p>tschneidereit <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3377994192\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>oh, apparently teams are only visible within an organization, my apologies. Maybe you can invite me, @alexcrichton, and @pchickey and we do anything else necessary?</p>\n</blockquote>",
        "id": 543593218,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759860119
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378002009\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Added the three of you</p>\n</blockquote>",
        "id": 543593744,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759860266
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378011309\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Thanks I will take a look today</p>\n</blockquote>",
        "id": 543594301,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759860458
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378018570\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>I took a look and this isn't a security issue, so @dan-bishopfox  feel free to go ahead and make the repo public. \"Crash\" for us typically means a panic in the host or similar, but the crash in this case is a trap in the guest, which while it may indicate a bug is not a security issue.</p>\n<p>At a cursory glance it looks like this is a bug in the guest, but we can dig in more later.</p>\n</blockquote>",
        "id": 543594625,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759860583
    },
    {
        "content": "<p>tschneidereit <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378342475\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Thank you for investigating, Alex! And again, even if this turns out not to be a bug in Wasmtime at all, we appreciate you taking the time to put together the report and reproducer, @dan-bishopfox!</p>\n</blockquote>",
        "id": 543604039,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759864176
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378345543\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Backtrace:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">guest</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x4a18</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!&lt;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">tcp</span><span class=\"p\">::</span><span class=\"n\">TcpSocket</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">_rt</span><span class=\"p\">::</span><span class=\"n\">WasmResource</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"nb\">drop</span><span class=\"p\">::</span><span class=\"n\">hbd600976671ef7ed</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x35e9</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!&lt;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">_rt</span><span class=\"p\">::</span><span class=\"n\">Resource</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"nb\">drop</span><span class=\"p\">::</span><span class=\"nb\">Drop</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"nb\">drop</span><span class=\"p\">::</span><span class=\"n\">hc26cd29c2e86015f</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x3564</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ptr</span><span class=\"p\">::</span><span class=\"n\">drop_in_place</span><span class=\"o\">&lt;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">_rt</span><span class=\"p\">::</span><span class=\"n\">Resource</span><span class=\"o\">&lt;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">tcp</span><span class=\"p\">::</span><span class=\"n\">TcpSocket</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">::</span><span class=\"n\">he71c56c6c7df9336</span>\n<span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x3b89</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ptr</span><span class=\"p\">::</span><span class=\"n\">drop_in_place</span><span class=\"o\">&lt;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">tcp</span><span class=\"p\">::</span><span class=\"n\">TcpSocket</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">hc04eeeba95d43492</span>\n<span class=\"w\">    </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x2542</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">hd31b4c5c8b2f2f83</span>\n<span class=\"w\">    </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x1e59</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">guest</span><span class=\"p\">::</span><span class=\"n\">main</span><span class=\"p\">::</span><span class=\"n\">hda5a2cfc9bf0b36d</span>\n<span class=\"w\">    </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x3463</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">function</span><span class=\"p\">::</span><span class=\"nb\">FnOnce</span><span class=\"p\">::</span><span class=\"n\">call_once</span><span class=\"p\">::</span><span class=\"n\">ha3371c02f905880a</span>\n<span class=\"w\">    </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x4308</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sys</span><span class=\"p\">::</span><span class=\"n\">backtrace</span><span class=\"p\">::</span><span class=\"n\">__rust_begin_short_backtrace</span><span class=\"p\">::</span><span class=\"n\">h9a0efd7171e138ad</span>\n<span class=\"w\">    </span><span class=\"mi\">8</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x40ca</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">rt</span><span class=\"p\">::</span><span class=\"n\">lang_start</span><span class=\"p\">::{{</span><span class=\"n\">closure</span><span class=\"p\">}}::</span><span class=\"n\">h850807c2aa8d5152</span>\n<span class=\"w\">    </span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"w\">  </span><span class=\"mh\">0x1069b</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">rt</span><span class=\"p\">::</span><span class=\"n\">lang_start_internal</span><span class=\"p\">::</span><span class=\"n\">hd8f43a585ee7e12a</span>\n<span class=\"w\">   </span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x407c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">rt</span><span class=\"p\">::</span><span class=\"n\">lang_start</span><span class=\"p\">::</span><span class=\"n\">hcc01919a26f87998</span>\n<span class=\"w\">   </span><span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x2fcb</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">__main_void</span>\n<span class=\"w\">   </span><span class=\"mi\">12</span><span class=\"p\">:</span><span class=\"w\">   </span><span class=\"mh\">0x1840</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"n\">a94999886812cfa</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">!</span><span class=\"n\">_start</span>\n<span class=\"w\">   </span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x306b42</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">cli</span><span class=\"o\">/</span><span class=\"n\">run</span><span class=\"o\">@</span><span class=\"mf\">0.2.3</span><span class=\"p\">#</span><span class=\"n\">run</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">resource</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">children</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Also, I updated the sample code to print the backtrace. (should have done that from the start)</p>\n</blockquote>",
        "id": 543604161,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759864232
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378737141\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Instead of creating your own host, this should be reproducible using wasmtime-cli, which would make things easier for us.</p>\n<p>I haven't tried to debug it, but based on the <code>resource has children</code> error my suspicion is that Rust's automatic dropping order of the <code>in_stream</code>, <code>out_stream</code>, and <code>socket</code> bindings are not in the order that wasi-sockets requires, which is for <code>in_stream</code> and <code>out_stream</code> to be dropped before the <code>socket</code> is dropped, so you could try to manually write <code>drop(in_stream); drop(out_stream); drop(socket);</code> at the end of this function to resolve that.</p>\n</blockquote>",
        "id": 543622469,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759871485
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378760975\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>You might be right. I added:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"nb\">drop</span><span class=\"p\">(</span><span class=\"n\">in_stream</span><span class=\"p\">);</span>\n<span class=\"nb\">drop</span><span class=\"p\">(</span><span class=\"n\">out_stream</span><span class=\"p\">);</span>\n<span class=\"nb\">drop</span><span class=\"p\">(</span><span class=\"n\">socket</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>And the crash doesn't seem to reproduce anymore. I hit the:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">never</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">printed</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">Because</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">crashes</span><span class=\"w\"> </span><span class=\"n\">before</span><span class=\"w\"> </span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">here</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>line.</p>\n<p>It's a good workaround for the time-being anyway</p>\n</blockquote>",
        "id": 543623613,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759872041
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378786975\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>That drop order restriction goes away in wasip3, but you'll have to live with it in wasip2 for now.</p>\n<p>I'd suggest that you use wstd, which papers over a lot of the not so great parts of the wasip2 bindings, but it doesn't actually have support for tcp connect right now. It could be added, but I'm in the middle of various other things on it currently.</p>\n</blockquote>",
        "id": 543624992,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759872670
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>I can reliably reproduce a crash in wasmtime wasi p2 sockets. </p>\n<p>The setup for it is a bit complex, so I made a minimal repo to reproduce it. Instructions are there in the readme.<br>\n<a href=\"https://github.com/dan-bishopfox/crash_wasi\">https://github.com/dan-bishopfox/crash_wasi</a></p>\n<p>Basically, we just use TCP sockets from within Wasm WASI p2 code and it crashes. Nothing special beyond that. The scaffolding in the repo is just there to setup some sample code that loads and runs the Wasm.</p>\n<p>Let me know if there's anything else you need or if you have any issue reproducing it. <br>\nThanks!</p>\n</blockquote>",
        "id": 543631012,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759875848
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378918196\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Ah ok, yes indeed! In that case I don't believe that this is a bug in Wasmtime, so I'm going to close this.</p>\n</blockquote>",
        "id": 543631014,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759875849
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378929430\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Where should I report this to then? For tracking until it's properly fixed? Or is the answer that it's likely to just not be fixed in wasi p2?</p>\n</blockquote>",
        "id": 543631627,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759876218
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378932015\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Yeah wasip2 won't be changing at this point so the bug is in the guest mostly, where it needs to interface with APIs differently.</p>\n</blockquote>",
        "id": 543631801,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759876313
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378937761\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Perhaps just a documentation change to <code>create_tcp_socket</code> to make it clear that the TcpSocket object has to be drop'ed last (after the in/out streams). Since otherwise that fact's not obvious. </p>\n</blockquote>",
        "id": 543632074,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759876499
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3378941558\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Sure yeah! For doc updates to WASI APIs you can send PRs to the repositories themselves, such as <a href=\"https://github.com/WebAssembly/wasi-sockets/\">https://github.com/WebAssembly/wasi-sockets/</a></p>\n</blockquote>",
        "id": 543632306,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759876635
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3392255730\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>Hey, sorry to bug you all again but I ran into another crash that looks related. I added the manual <code>drop</code> code in the order of <code>InputStream</code> -&gt; <code>OutputStream</code> -&gt; <code>TcpSocket</code>. But it's the <code>InputStream</code> this time that's complaining. </p>\n<div class=\"codehilite\" data-code-language=\"component\"><pre><span></span><code>    0:  0x4199e - guest-561fe04e002e2417.wasm!_ZN100_$LT$wasi..bindings..wasi..io..streams..InputStream$u20$as$u20$wasi..bindings.._rt..WasmResource$GT$4drop17ha956dcecfc0cbaa7E\n    1:  0x291ff - guest-561fe04e002e2417.wasm!_ZN80_$LT$wasi..bindings.._rt..Resource$LT$T$GT$$u20$as$u20$core..ops..drop..Drop$GT$4drop17he5627ea0b2554dd0E\n    2:  0x291ad - guest-561fe04e002e2417.wasm!_ZN4core3ptr104drop_in_place$LT$wasi..bindings.._rt..Resource$LT$wasi..bindings..wasi..io..streams..InputStream$GT$$GT$17h65226a4f2f498a40E\n    3:  0x2ab16 - guest-561fe04e002e2417.wasm!_ZN4core3ptr67drop_in_place$LT$wasi..bindings..wasi..io..streams..InputStream$GT$17hd1a71f0212bef4d7E\n    4:  0x2a5fe - guest-561fe04e002e2417.wasm!_ZN4core3ptr95drop_in_place$LT$core..option..Option$LT$wasi..bindings..wasi..io..streams..InputStream$GT$$GT$17hc491081ad7572c7fE\n    5:  0x2a572 - guest-561fe04e002e2417.wasm!_ZN4core3ptr63drop_in_place$LT$guest..commands..core..proxy..SocksProxy$GT$17ha2600ea8687860acE\n    6:  0x2b61c - guest-561fe04e002e2417.wasm!_ZN4core3ptr91drop_in_place$LT$core..option..Option$LT$guest..commands..core..proxy..SocksProxy$GT$$GT$17h3ce2633f2d544ea0E\n&gt; This is my business logic function here.    7:  0x14d3d - guest-561fe04e002e2417.wasm!_ZN7guest23handle_async_proxy_data17h35916648c6278204E\n    8:  0x17072 - guest-561fe04e002e2417.wasm!_ZN7guest3run17h035dd1919c4b29b8E\n    9:  0x17c35 - guest-561fe04e002e2417.wasm!_ZN7guest4main17h355a4d4b6be6a3aeE\n   10:  0x28f4c - guest-561fe04e002e2417.wasm!_ZN4core3ops8function6FnOnce9call_once17h665b2f14ac85f0eaE\n   11:  0x1ddee - guest-561fe04e002e2417.wasm!_ZN3std3sys9backtrace28__rust_begin_short_backtrace17h973638772f410a9eE\n   12:   0x7cdf - guest-561fe04e002e2417.wasm!_ZN3std2rt10lang_start28_$u7b$$u7b$closure$u7d$$u7d$17h8206f535aef5eeb8E\n   13: 0x262d03 - guest-561fe04e002e2417.wasm!_ZN3std2rt19lang_start_internal17h606819bf9b1f641dE\n   14:   0x7ca5 - guest-561fe04e002e2417.wasm!_ZN3std2rt10lang_start17hd5c9a870f35d74dcE\n   15:  0x17c5c - guest-561fe04e002e2417.wasm!__main_void\n   16:   0x7a12 - guest-561fe04e002e2417.wasm!_start\n   17: 0x20bd16d - wit-component:adapter:wasi_snapshot_preview1!wasi:cli/run@0.2.6#run\n</code></pre></div>\n<p>Is there something obvious in this that I might be doing wrong? Some other resource that needs to be cleaned up in a potentially undocumented way?</p>\n</blockquote>",
        "id": 544244063,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1760128838
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3392302351\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>The Pollable associated with the InputStream needs to be dropped before the InputStream</p>\n</blockquote>",
        "id": 544246896,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1760130174
    },
    {
        "content": "<p>pchickey edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3392302351\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>The Pollable associated with the InputStream (got from InputStream::subscribe) needs to be dropped before the InputStream</p>\n</blockquote>",
        "id": 544246945,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1760130198
    },
    {
        "content": "<p>dan-bishopfox <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804#issuecomment-3392348363\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11804\">issue #11804</a>:</p>\n<blockquote>\n<p>That did the trick! Thanks a lot!</p>\n</blockquote>",
        "id": 544250230,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1760131620
    }
]