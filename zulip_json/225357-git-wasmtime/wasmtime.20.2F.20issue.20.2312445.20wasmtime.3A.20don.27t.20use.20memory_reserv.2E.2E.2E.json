[
    {
        "content": "<p>tage64 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445\">issue #12445</a>:</p>\n<blockquote>\n<p>In the function <code>MallocMemory::new()</code> (in the file <code>/crates/wasmtime/src/runtime/vm/memory/malloc.rs</code>), we allocate <code>minimum + tunables.memory_reservation_for_growth</code> bytes. I was working in a bare metal context and therefore didn't have access to virtual memory. An error message kindly told me that \"malloc memory is only compatible with no ahead-of-time memory reservation\". This led me to set <code>config.memory_reservation(0)</code>. But then <code>memory_reservation_for_growth</code> still defaulted to 2 GiB causing the <code>MallocMemory</code> to allocate more than 2 GiB of memory. This time I didn't get a helpful error message but an allocation failure without further context.</p>\n<p>Is there a reason why we even use the <code>memory_reservation_for_growth</code> option in the <code>MallocMemory</code>? Otherwise I propose that we either ignore it or throw an error if it is greater than 0.</p>\n<p>Wasmtime version: 41.0.0</p>\n</blockquote>",
        "id": 570304769,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769516246
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445#issuecomment-3805649468\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445\">issue #12445</a>:</p>\n<blockquote>\n<p>This knob is used to amortize the cost of growth of a memory because without it all wasm growth would require reallocating the memory and moving it around. In that sense it's an intentional knob that is indeed used, but improving error messages for allocation failures is always reasonable.</p>\n<p>Are you unable to set this configuration option to 0? Or are you interested in having it default to 0 for your target so you don't have to configure it?</p>\n</blockquote>",
        "id": 570340144,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769525334
    },
    {
        "content": "<p>tage64 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445#issuecomment-3818590250\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445\">issue #12445</a>:</p>\n<blockquote>\n<p>I was indeed able to set <code>memory_reservation_for_growth</code> to 0. The problem was to find out that was the cause of my allocation failure. I am working on a risc-v 64-bit platform so it defaulted to 2 GiB which was a lot more than available. I don't know of the best solution. The problem is just the confusing error which doesn't direct the user to this configuration.</p>\n</blockquote>",
        "id": 570834076,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769702285
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445#issuecomment-3819641702\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445\">issue #12445</a>:</p>\n<blockquote>\n<p>I've expanded the error contexts in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12468\">https://github.com/bytecodealliance/wasmtime/pull/12468</a> to try to help make the error here more clear.</p>\n</blockquote>",
        "id": 570871951,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769712643
    },
    {
        "content": "<p>pchickey closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12445\">issue #12445</a>:</p>\n<blockquote>\n<p>In the function <code>MallocMemory::new()</code> (in the file <code>/crates/wasmtime/src/runtime/vm/memory/malloc.rs</code>), we allocate <code>minimum + tunables.memory_reservation_for_growth</code> bytes. I was working in a bare metal context and therefore didn't have access to virtual memory. An error message kindly told me that \"malloc memory is only compatible with no ahead-of-time memory reservation\". This led me to set <code>config.memory_reservation(0)</code>. But then <code>memory_reservation_for_growth</code> still defaulted to 2 GiB causing the <code>MallocMemory</code> to allocate more than 2 GiB of memory. This time I didn't get a helpful error message but an allocation failure without further context.</p>\n<p>Is there a reason why we even use the <code>memory_reservation_for_growth</code> option in the <code>MallocMemory</code>? Otherwise I propose that we either ignore it or throw an error if it is greater than 0.</p>\n<p>Wasmtime version: 41.0.0</p>\n</blockquote>",
        "id": 570880501,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769715435
    }
]