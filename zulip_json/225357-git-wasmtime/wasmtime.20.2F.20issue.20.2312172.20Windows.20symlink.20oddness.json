[
    {
        "content": "<p>wingo opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">issue #12172</a>:</p>\n<blockquote>\n<p>This simple test fails on Windows:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">process</span><span class=\"p\">;</span>\n<span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"w\"> </span><span class=\"n\">wit_bindgen</span><span class=\"p\">;</span>\n\n<span class=\"n\">wit_bindgen</span><span class=\"p\">::</span><span class=\"n\">generate</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">inline</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">r</span><span class=\"s\">\"</span>\n<span class=\"s\">  package test:test;</span>\n\n<span class=\"s\">  world test {</span>\n<span class=\"s\">      include wasi:filesystem/imports@0.3.0-rc-2025-09-16;</span>\n<span class=\"s\">      include wasi:cli/command@0.3.0-rc-2025-09-16;</span>\n<span class=\"s\">  }</span>\n<span class=\"s\">\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">additional_derives</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nb\">PartialEq</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Eq</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Hash</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Clone</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"c1\">// Work around https://github.com/bytecodealliance/wasm-tools/issues/2285.</span>\n<span class=\"w\">    </span><span class=\"n\">features</span><span class=\"p\">:[</span><span class=\"s\">\"clocks-timezone\"</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"n\">generate_all</span>\n<span class=\"p\">});</span>\n\n<span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_symlink</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">preopens</span><span class=\"p\">::</span><span class=\"n\">get_directories</span><span class=\"p\">()[</span><span class=\"o\">..</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"p\">[(</span><span class=\"n\">dir</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">symlink_at</span><span class=\"p\">(</span><span class=\"s\">\"..\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"s\">\"t\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">())</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"k\">await</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">            </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">unlink_file_at</span><span class=\"p\">(</span><span class=\"s\">\"t\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()).</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">[</span><span class=\"o\">..</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"fm\">eprintln!</span><span class=\"p\">(</span><span class=\"s\">\"usage: run with one open dir\"</span><span class=\"p\">);</span>\n<span class=\"w\">            </span><span class=\"n\">process</span><span class=\"p\">::</span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Component</span><span class=\"p\">;</span>\n<span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Component</span><span class=\"p\">);</span>\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">exports</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Component</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">test_symlink</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"fm\">unreachable!</span><span class=\"p\">(</span><span class=\"s\">\"main is a stub\"</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>The issue is that creating a symlink to <code>..</code> doesn't work and fails with <code>EPERM</code>, whereas on POSIX platforms any permission check is only made when dereferencing the symlink.</p>\n<p>Similarly, <code>ln_s(\"does-not-exist\".to_string(), \"whatever\".to_string).await.unwrap()</code> fails on Windows with <code>ENOENT</code>.  I can make a symlink to a file that does exist, however.  I only tested via CI, on <a href=\"https://github.com/WebAssembly/wasi-testsuite/pull/195\">https://github.com/WebAssembly/wasi-testsuite/pull/195</a>.</p>\n<p>What's going on?  Is this another area of WASI in which we have to relax the requirements?</p>\n</blockquote>",
        "id": 564051110,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1765894270
    },
    {
        "content": "<p><a href=\"https://github.com/wingo\">wingo</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">Issue #12172</a>.</p>",
        "id": 564051112,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1765894271
    },
    {
        "content": "<p>wingo <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172#issuecomment-3665566725\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">issue #12172</a>:</p>\n<blockquote>\n<p>More oddness:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">            </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">create_directory_at</span><span class=\"p\">(</span><span class=\"s\">\"child.cleanup\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">())</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"k\">await</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">            </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">symlink_at</span><span class=\"p\">(</span><span class=\"s\">\"../a.txt\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"s\">\"child.cleanup/b\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">())</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"k\">await</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</code></pre></div>\n<p>I.e. I can't symlink to a file from a parent directory?  Works on POSIX, whether making the symlink from the parent (as above) or from the child.</p>\n</blockquote>",
        "id": 564262603,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1765981053
    },
    {
        "content": "<p><a href=\"https://github.com/fitzgen\">fitzgen</a> added the wasi:impl label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">Issue #12172</a>.</p>",
        "id": 564515119,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766077658
    },
    {
        "content": "<p><a href=\"https://github.com/fitzgen\">fitzgen</a> added the wasi:tests label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">Issue #12172</a>.</p>",
        "id": 564515122,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766077658
    },
    {
        "content": "<p><a href=\"https://github.com/fitzgen\">fitzgen</a> added the wasi label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">Issue #12172</a>.</p>",
        "id": 564515123,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766077658
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172#issuecomment-3671685026\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12172\">issue #12172</a>:</p>\n<blockquote>\n<p>I know very little about Windows symlinks myself but I wouldn't be surprised if they're different from unix-style symlinks in subtle and surprising ways. Similar to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12178#issuecomment-3671670651\">this</a> I don't think we have much recourse other than acknolwedging the reality that symlinks are the same at 10k feet but implemented entirely differently under the hood.</p>\n</blockquote>",
        "id": 564534933,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766083342
    }
]