[
    {
        "content": "<p><a href=\"https://github.com/vouillon\">vouillon</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">Issue #10397</a>.</p>",
        "id": 505650488,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1741951887
    },
    {
        "content": "<p>vouillon opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/user-attachments/files/19246260/slab-mismatch.zip\">slab-mismatch.zip</a></p>\n<h3>Steps to Reproduce</h3>\n<p>Run the following command:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\">  </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"o\">=</span><span class=\"n\">all</span><span class=\"o\">-</span><span class=\"n\">proposals</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">slab</span><span class=\"o\">-</span><span class=\"n\">mismatch</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>It should not crash.</p>\n<h3>Actual Results</h3>\n<p>We get a panic:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">jerome</span><span class=\"o\">/</span><span class=\"n\">sources</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">slab</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">387</span><span class=\"p\">:</span><span class=\"mi\">14</span><span class=\"p\">:</span>\n<span class=\"nc\">id</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">slab</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime commit: a3381e48775912a3e1a68c05180932f3ce74c5b4</p>\n<p>Operating system: Linux</p>\n<p>Architecture: x64<br>\n</p>\n</blockquote>",
        "id": 505650489,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1741951888
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397#issuecomment-2730045195\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<p>Thanks for filing this bug!</p>\n</blockquote>",
        "id": 506194517,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1742226990
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397#issuecomment-2734170911\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<p>Minimized a bit further:</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$func</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$array</span> <span class=\"p\">(</span><span class=\"err\">array</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$struct</span> <span class=\"p\">(</span><span class=\"err\">sub</span> <span class=\"p\">(</span><span class=\"err\">struct</span> <span class=\"p\">(</span><span class=\"err\">field</span> <span class=\"nv\">$field</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$func</span><span class=\"p\">)))))</span>\n\n  <span class=\"p\">(</span><span class=\"k\">elem</span> <span class=\"k\">func</span> <span class=\"nv\">$nop</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$nop</span><span class=\"p\">)</span>\n\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"\"</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"nv\">$local_array</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$array</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"nv\">$local_struct</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$struct</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"nb\">local.set</span> <span class=\"nv\">$local_struct</span> <span class=\"p\">(</span><span class=\"err\">struct.new</span> <span class=\"nv\">$struct</span> <span class=\"p\">(</span><span class=\"err\">ref.</span><span class=\"k\">func</span> <span class=\"nv\">$nop</span><span class=\"p\">)))</span>\n    <span class=\"p\">(</span><span class=\"k\">loop</span> <span class=\"nv\">$outer</span>\n      <span class=\"p\">(</span><span class=\"nb\">local.set</span> <span class=\"nv\">$local_array</span> <span class=\"p\">(</span><span class=\"err\">array.new</span> <span class=\"nv\">$array</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n      <span class=\"p\">(</span><span class=\"k\">loop</span> <span class=\"nv\">$inner</span>\n        <span class=\"p\">(</span><span class=\"err\">array.set</span> <span class=\"nv\">$array</span> <span class=\"p\">(</span><span class=\"err\">ref.cast</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$array</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">local.get</span> <span class=\"nv\">$local_array</span><span class=\"p\">))</span>\n                          <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n                          <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mi\">1</span><span class=\"p\">))</span>\n        <span class=\"p\">(</span><span class=\"nb\">br_if</span> <span class=\"nv\">$inner</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n      <span class=\"p\">)</span>\n      <span class=\"p\">(</span><span class=\"nb\">call</span><span class=\"err\">_ref</span> <span class=\"nv\">$func</span> <span class=\"p\">(</span><span class=\"err\">struct.get</span> <span class=\"nv\">$struct</span> <span class=\"nv\">$field</span> <span class=\"p\">(</span><span class=\"nb\">local.get</span> <span class=\"nv\">$local_struct</span><span class=\"p\">)))</span>\n      <span class=\"p\">(</span><span class=\"nb\">br</span> <span class=\"nv\">$outer</span><span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n  <span class=\"p\">)</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n<p>There are a couple interesting things that can't be removed from the test case while preserving the crash:</p>\n<ul>\n<li>the <code>br_if</code> whose operand is a constant <code>0</code></li>\n<li>the <code>ref.cast</code> into the exact same type that it already is</li>\n</ul>\n</blockquote>",
        "id": 506542021,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1742319610
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397#issuecomment-2744487057\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<p>I have a fix for this over in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10456\">https://github.com/bytecodealliance/wasmtime/pull/10456</a></p>\n<p>Thanks again for the bug report!</p>\n</blockquote>",
        "id": 507371264,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1742592718
    },
    {
        "content": "<p>vouillon <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397#issuecomment-2744543503\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<p>Thanks a lot!<br>\nI'm not sure the fix is complete, though. I still get similar errors (<code>id from different slab</code> and <code>assertion failed: types.is_subtype(actual_ty, expected_ty)</code>). I'll try to find the time to produce a reduced test case.</p>\n</blockquote>",
        "id": 507374791,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1742594435
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397#issuecomment-2744568139\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<p>Yeah, we sandbox the GC heap, so when we have any kind of GC heap corruption bug, it tends to look like those panics rather than overwriting host memory or what have you. Occasionally it might look like a SIGILL at a <code>ud2</code> instruction because of an assertion check inside of JIT code tripping. But the important thing is that corruption in the GC heap should never result in memory unsafety in the rest of the runtime, just panics or whatever.</p>\n<p>Anyways, the point is, it is likely not the same bug if it still triggers after <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10456\">https://github.com/bytecodealliance/wasmtime/pull/10456</a>, but just that all kinds of GC heap corruption tend to show the same symptoms.</p>\n<p>But as always, reduced test cases are super helpful, thanks for taking the time to make reproducers and all that!</p>\n</blockquote>",
        "id": 507376426,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1742595212
    },
    {
        "content": "<p>cfallin closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10397\">issue #10397</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/user-attachments/files/19246260/slab-mismatch.zip\">slab-mismatch.zip</a></p>\n<h3>Steps to Reproduce</h3>\n<p>Run the following command:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\">  </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"o\">=</span><span class=\"n\">all</span><span class=\"o\">-</span><span class=\"n\">proposals</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">slab</span><span class=\"o\">-</span><span class=\"n\">mismatch</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>It should not crash.</p>\n<h3>Actual Results</h3>\n<p>We get a panic:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">jerome</span><span class=\"o\">/</span><span class=\"n\">sources</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">slab</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">387</span><span class=\"p\">:</span><span class=\"mi\">14</span><span class=\"p\">:</span>\n<span class=\"nc\">id</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">slab</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime commit: a3381e48775912a3e1a68c05180932f3ce74c5b4</p>\n<p>Operating system: Linux</p>\n<p>Architecture: x64<br>\n</p>\n</blockquote>",
        "id": 507850558,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1742841470
    }
]