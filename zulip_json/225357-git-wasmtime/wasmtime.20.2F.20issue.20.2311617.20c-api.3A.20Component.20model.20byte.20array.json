[
    {
        "content": "<p>GerardSmit opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11617\">issue #11617</a>:</p>\n<blockquote>\n<p>Currently <code>list&lt;..&gt;</code> is being passed through as <code>WASMTIME_COMPONENT_LIST</code> with <code>wasmtime_component_vallist_t</code> as union type.</p>\n<p>In <code>wasmtime_component_vallist_t</code> each item is a <a href=\"https://github.com/bytecodealliance/wasmtime/blob/db7b44d223d1d337894a3e0dd95b28f6c75874c1/crates/c-api/include/wasmtime/component/val.h#L104C48-L104C70\"><code>wasmtime_component_val</code></a>. This struct has a size of 32 bytes.</p>\n<p>In WASI, <code>list&lt;u8&gt;</code> is used as an byte array, for example in <a href=\"https://github.com/WebAssembly/WASI/blob/8a69f1ed6ce7bfd3cfe72270b787d4d4598b721d/wasip2/sockets/udp.wit#L14\"><code>wasi:sockets/udp</code></a>.<br>\nWith the implementation in C-API would this need way more memory than needed.</p>\n<p>For example, lets say you pass 512 bytes to the component.<br>\nInstead of 512 bytes you need to create a <code>wasmtime_component_vallist_t</code> of 512 items, that use 16384 bytes in total.</p>\n<h4>Suggestion</h4>\n<p>Create a new type, e.g. <code>WASMTIME_COMPONENT_LIST_U8</code> that uses the union type <code>wasm_byte_vec_t</code>. </p>\n<p>Whenever <code>list&lt;u8&gt;</code> is used, the new value type should be used: <code>WASMTIME_COMPONENT_LIST_U8</code> with <code>wasm_byte_vec_t</code><br>\nFor other types, the current type should be used: <code>WASMTIME_COMPONENT_LIST</code> with <code>wasmtime_component_vallist_t</code></p>\n<h4>Benefit</h4>\n<p>Less memory is being passed through C-API.</p>\n<h4>Implementation</h4>\n<p>N/A</p>\n<h4>Alternatives</h4>\n<p>Accept the fact that every byte is actually 32 bytes when using <code>list&lt;u8&gt;</code></p>\n<p>Or use <code>string</code> instead of <code>list&lt;u8&gt;</code> in WIT, since this uses <code>wasm_byte_vec_t</code> as union type, where the data is a simple <code>byte</code>.<br>\n</p>\n</blockquote>",
        "id": 537864739,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757077083
    },
    {
        "content": "<p>GerardSmit edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11617\">issue #11617</a>:</p>\n<blockquote>\n<p>Currently <code>list&lt;..&gt;</code> is being passed through as <code>WASMTIME_COMPONENT_LIST</code> with <code>wasmtime_component_vallist_t</code> as union type.</p>\n<p>In <code>wasmtime_component_vallist_t</code> each item is a <a href=\"https://github.com/bytecodealliance/wasmtime/blob/db7b44d223d1d337894a3e0dd95b28f6c75874c1/crates/c-api/include/wasmtime/component/val.h#L104C48-L104C70\"><code>wasmtime_component_val</code></a>. This struct has a size of 32 bytes.</p>\n<p>In WASI, <code>list&lt;u8&gt;</code> is used as an byte array, for example in <a href=\"https://github.com/WebAssembly/WASI/blob/8a69f1ed6ce7bfd3cfe72270b787d4d4598b721d/wasip2/sockets/udp.wit#L14\"><code>wasi:sockets/udp</code></a>.<br>\nWith the implementation in C-API would this need way more memory than needed.</p>\n<p>For example, lets say you pass 512 bytes to the component.<br>\nInstead of 512 bytes you need to create a <code>wasmtime_component_vallist_t</code> of 512 items, that use 16384 bytes in total.</p>\n<p>You also need to transform the bytes to <code>wasmtime_component_val</code> items, which is an additional step you need to do before passing the byte array.</p>\n<h4>Suggestion</h4>\n<p>Create a new type, e.g. <code>WASMTIME_COMPONENT_LIST_U8</code> that uses the union type <code>wasm_byte_vec_t</code>. </p>\n<p>Whenever <code>list&lt;u8&gt;</code> is used, the new value type should be used: <code>WASMTIME_COMPONENT_LIST_U8</code> with <code>wasm_byte_vec_t</code><br>\nFor other types, the current type should be used: <code>WASMTIME_COMPONENT_LIST</code> with <code>wasmtime_component_vallist_t</code></p>\n<h4>Benefit</h4>\n<p>Less memory is being passed through C-API.</p>\n<h4>Implementation</h4>\n<p>N/A</p>\n<h4>Alternatives</h4>\n<p>Accept the fact that every byte is actually 32 bytes when using <code>list&lt;u8&gt;</code></p>\n<p>Or use <code>string</code> instead of <code>list&lt;u8&gt;</code> in WIT, since this uses <code>wasm_byte_vec_t</code> as union type, where the data is a simple <code>byte</code>.<br>\n</p>\n</blockquote>",
        "id": 537865477,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757077266
    },
    {
        "content": "<p>GerardSmit edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11617\">issue #11617</a>:</p>\n<blockquote>\n<p>Currently <code>list&lt;..&gt;</code> is being passed through as <code>WASMTIME_COMPONENT_LIST</code> with <code>wasmtime_component_vallist_t</code> as union type.</p>\n<p>In <code>wasmtime_component_vallist_t</code> each item is a <a href=\"https://github.com/bytecodealliance/wasmtime/blob/db7b44d223d1d337894a3e0dd95b28f6c75874c1/crates/c-api/include/wasmtime/component/val.h#L104C48-L104C70\"><code>wasmtime_component_val</code></a>. This struct has a size of 32 bytes.</p>\n<p>In WASI, <code>list&lt;u8&gt;</code> is used as an byte array, for example in <a href=\"https://github.com/WebAssembly/WASI/blob/8a69f1ed6ce7bfd3cfe72270b787d4d4598b721d/wasip2/sockets/udp.wit#L14\"><code>wasi:sockets/udp</code></a>.<br>\nWith the implementation in C-API would this need way more memory than needed.</p>\n<p>For example, lets say you pass 512 bytes to the component.<br>\nInstead of 512 bytes you need to create a <code>wasmtime_component_vallist_t</code> of 512 items, that use 16384 bytes in total.</p>\n<p>You also need to transform the bytes to <code>wasmtime_component_val</code> items, which is an additional step you need to do before passing the byte array.</p>\n<h4>Suggestion</h4>\n<p>Create a new type, e.g. <code>WASMTIME_COMPONENT_LIST_U8</code> that uses the union type <code>wasm_byte_vec_t</code>. </p>\n<p>Whenever <code>list&lt;u8&gt;</code> is used, the new value type should be used: <code>WASMTIME_COMPONENT_LIST_U8</code> with <code>wasm_byte_vec_t</code><br>\nFor other types, the current type should be used: <code>WASMTIME_COMPONENT_LIST</code> with <code>wasmtime_component_vallist_t</code></p>\n<h4>Benefit</h4>\n<p>Less memory is being passed through C-API, and less overhead (by not transforming the bytes to <code>wasmtime_component_val</code>'s)</p>\n<h4>Implementation</h4>\n<p>N/A</p>\n<h4>Alternatives</h4>\n<p>Accept the fact that every byte is actually 32 bytes when using <code>list&lt;u8&gt;</code></p>\n<p>Or use <code>string</code> instead of <code>list&lt;u8&gt;</code> in WIT, since this uses <code>wasm_byte_vec_t</code> as union type, where the data is a simple <code>byte</code>.<br>\n</p>\n</blockquote>",
        "id": 537865749,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757077346
    }
]