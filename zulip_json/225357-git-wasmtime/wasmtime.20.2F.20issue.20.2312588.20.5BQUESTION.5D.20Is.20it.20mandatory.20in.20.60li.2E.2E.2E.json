[
    {
        "content": "<p>if0ne opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588\">issue #12588</a>:</p>\n<blockquote>\n<p>Hi there!</p>\n<p>I want to do something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">store</span><span class=\"p\">.</span><span class=\"n\">limiter_async</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">memory_limiter</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>The memory limiter is created and configured outside of the store creation.</p>\n<p>However, this is currently impossible:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>store.limiter_async<span class=\"o\">(</span>move<span class=\"w\"> </span><span class=\"p\">|</span>_<span class=\"p\">|</span><span class=\"w\"> </span><span class=\"p\">&amp;</span>mut<span class=\"w\"> </span>memory_limiter<span class=\"o\">)</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">|</span><span class=\"w\">                                     </span>--------<span class=\"w\"> </span>^^^^^^^^^^^^^^^^^^^<span class=\"w\"> </span>closure<span class=\"w\"> </span>was<span class=\"w\"> </span>supposed<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span>data<span class=\"w\"> </span>with<span class=\"w\"> </span>lifetime<span class=\"w\"> </span><span class=\"sb\">`</span><span class=\"s1\">'2` but it is returning data with lifetime `'</span><span class=\"m\">1</span><span class=\"sb\">`</span>\n<span class=\"w\">    </span><span class=\"p\">|</span><span class=\"w\">                                     </span><span class=\"p\">|</span><span class=\"w\">     </span><span class=\"p\">|</span>\n<span class=\"w\">    </span><span class=\"p\">|</span><span class=\"w\">                                     </span><span class=\"p\">|</span><span class=\"w\">     </span>has<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span><span class=\"sb\">`</span><span class=\"p\">&amp;</span><span class=\"s1\">'2 mut SharedCtx`</span>\n<span class=\"s1\">    |                                     lifetime `'</span><span class=\"m\">1</span><span class=\"sb\">`</span><span class=\"w\"> </span>represents<span class=\"w\"> </span>this<span class=\"w\"> </span>closure<span class=\"s1\">'s body</span>\n<span class=\"s1\">    |</span>\n<span class=\"s1\">    = note: closure implements `FnMut`, so references to captured variables can'</span>t<span class=\"w\"> </span>escape<span class=\"w\"> </span>the<span class=\"w\"> </span>closure\n</code></pre></div>\n<p>Should I move the limiter into the store’s data, or is this something that could be fixed in future releases?</p>\n</blockquote>",
        "id": 573704457,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770976610
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588#issuecomment-3897945354\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588\">issue #12588</a>:</p>\n<blockquote>\n<p>Yes for now you'll need to place the limiter in the store's data itself, as Rust's closures don't allow this style of borrowing where you return a borrow of the captured data itself. As for fixing this and/or supporting this, it's in theory possible yeah and would likely require adjusting bounds here. For now does moving into the store work for you?</p>\n</blockquote>",
        "id": 573775459,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770998049
    },
    {
        "content": "<p>if0ne <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588#issuecomment-3898745122\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588\">issue #12588</a>:</p>\n<blockquote>\n<p>Yes, moving the limiter into the Store works fine for me. Thanks you</p>\n</blockquote>",
        "id": 573808230,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771007965
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588\">issue #12588</a>:</p>\n<blockquote>\n<p>Hi there!</p>\n<p>I want to do something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">store</span><span class=\"p\">.</span><span class=\"n\">limiter_async</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">memory_limiter</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>The memory limiter is created and configured outside of the store creation.</p>\n<p>However, this is currently impossible:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>store.limiter_async<span class=\"o\">(</span>move<span class=\"w\"> </span><span class=\"p\">|</span>_<span class=\"p\">|</span><span class=\"w\"> </span><span class=\"p\">&amp;</span>mut<span class=\"w\"> </span>memory_limiter<span class=\"o\">)</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">|</span><span class=\"w\">                                     </span>--------<span class=\"w\"> </span>^^^^^^^^^^^^^^^^^^^<span class=\"w\"> </span>closure<span class=\"w\"> </span>was<span class=\"w\"> </span>supposed<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span>data<span class=\"w\"> </span>with<span class=\"w\"> </span>lifetime<span class=\"w\"> </span><span class=\"sb\">`</span><span class=\"s1\">'2` but it is returning data with lifetime `'</span><span class=\"m\">1</span><span class=\"sb\">`</span>\n<span class=\"w\">    </span><span class=\"p\">|</span><span class=\"w\">                                     </span><span class=\"p\">|</span><span class=\"w\">     </span><span class=\"p\">|</span>\n<span class=\"w\">    </span><span class=\"p\">|</span><span class=\"w\">                                     </span><span class=\"p\">|</span><span class=\"w\">     </span>has<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span><span class=\"sb\">`</span><span class=\"p\">&amp;</span><span class=\"s1\">'2 mut SharedCtx`</span>\n<span class=\"s1\">    |                                     lifetime `'</span><span class=\"m\">1</span><span class=\"sb\">`</span><span class=\"w\"> </span>represents<span class=\"w\"> </span>this<span class=\"w\"> </span>closure<span class=\"s1\">'s body</span>\n<span class=\"s1\">    |</span>\n<span class=\"s1\">    = note: closure implements `FnMut`, so references to captured variables can'</span>t<span class=\"w\"> </span>escape<span class=\"w\"> </span>the<span class=\"w\"> </span>closure\n</code></pre></div>\n<p>Should I move the limiter into the store’s data, or is this something that could be fixed in future releases?</p>\n</blockquote>",
        "id": 573927519,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771104222
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588#issuecomment-3902546010\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12588\">issue #12588</a>:</p>\n<blockquote>\n<p>Ok great! In that case I'll close this for now, but if that becomes problematic I can also reopen for a future feature to update the siganture of this function.</p>\n</blockquote>",
        "id": 573927521,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771104223
    }
]