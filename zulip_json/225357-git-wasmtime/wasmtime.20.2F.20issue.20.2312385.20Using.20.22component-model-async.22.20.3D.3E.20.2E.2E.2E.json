[
    {
        "content": "<p>ignatz opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12385\">issue #12385</a>:</p>\n<blockquote>\n<p>For context, I found <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12154\">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>\n<p>...anyway, I'm using wasmtime v41.0.0 enabling the  \"component-model-async\" feature, while still using WASIp2.</p>\n<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span>\n<span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">rust</span><span class=\"o\">-</span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"n\">testfixture</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">sebastian</span><span class=\"o\">/</span><span class=\"n\">projects</span><span class=\"o\">/</span><span class=\"n\">trailbase</span><span class=\"o\">/</span><span class=\"n\">client</span><span class=\"o\">/</span><span class=\"n\">testfixture</span><span class=\"o\">/</span><span class=\"n\">guests</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">linking</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"o\">-</span><span class=\"n\">ld</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\">  </span><span class=\"s\">\"wasm-component-ld\"</span><span class=\"w\"> </span><span class=\"s\">\"-flavor\"</span><span class=\"w\"> </span><span class=\"s\">\"wasm\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"trailbase:component/init-endpoint@0.1.0#init-http-handlers\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"trailbase:component/init-endpoint@0.1.0#init-job-handlers\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"wasi:http/incoming-handler@0.2.9#handle\"</span><span class=\"w\"> </span><span class=\"s\">\"--export\"</span><span class=\"w\"> </span><span class=\"s\">\"cabi_realloc\"</span><span class=\"w\"> </span><span class=\"s\">\"-z\"</span><span class=\"w\"> </span><span class=\"s\">\"stack-size=1048576\"</span><span class=\"w\"> </span><span class=\"s\">\"--stack-first\"</span><span class=\"w\"> </span><span class=\"s\">\"--allow-undefined\"</span><span class=\"w\"> </span><span class=\"s\">\"--no-demangle\"</span><span class=\"w\"> </span><span class=\"s\">\"&lt;431 object files omitted&gt;\"</span><span class=\"w\"> </span><span class=\"s\">\"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"-l\"</span><span class=\"w\"> </span><span class=\"s\">\"c\"</span><span class=\"w\"> </span><span class=\"s\">\"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained\"</span><span class=\"w\"> </span><span class=\"s\">\"-o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm\"</span><span class=\"w\"> </span><span class=\"s\">\"--gc-sections\"</span><span class=\"w\"> </span><span class=\"s\">\"--no-entry\"</span><span class=\"w\"> </span><span class=\"s\">\"-O3\"</span><span class=\"w\"> </span><span class=\"s\">\"--strip-debug\"</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">some</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">omitted</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">--</span><span class=\"n\">verbose</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">arguments</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">componentization</span>\n\n<span class=\"w\">          </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">              </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">decoding</span><span class=\"w\"> </span><span class=\"n\">custom</span><span class=\"w\"> </span><span class=\"n\">section</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"nc\">wit</span><span class=\"o\">-</span><span class=\"n\">bindgen</span><span class=\"p\">:</span><span class=\"mf\">0.51.0</span><span class=\"p\">:</span><span class=\"nc\">trailbase</span><span class=\"p\">:</span><span class=\"nc\">component</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">:</span><span class=\"nc\">interfaces</span><span class=\"o\">-</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">all</span><span class=\"o\">-</span><span class=\"n\">of</span><span class=\"o\">-</span><span class=\"n\">its</span><span class=\"o\">-</span><span class=\"n\">exports</span><span class=\"o\">-</span><span class=\"n\">removed</span><span class=\"p\">:</span><span class=\"nc\">encoded</span><span class=\"w\"> </span><span class=\"n\">world</span>\n<span class=\"w\">              </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">invalid</span><span class=\"w\"> </span><span class=\"n\">leading</span><span class=\"w\"> </span><span class=\"n\">byte</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mh\">0x43</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mh\">0x2a38</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the guest is not able to load it: \"Wasmtime: failed to parse WebAssembly module\".</p>\n<p>The wasm-wasip3 target seems to be retired? Anyway, which would be the right one? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>\n<p>Much appreciated <span aria-label=\"folded hands\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"folded hands\">:folded_hands:</span> </p>\n</blockquote>",
        "id": 569362378,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769031827
    }
]