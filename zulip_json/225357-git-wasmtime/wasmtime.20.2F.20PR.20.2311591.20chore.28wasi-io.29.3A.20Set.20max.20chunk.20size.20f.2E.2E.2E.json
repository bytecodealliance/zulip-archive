[
    {
        "content": "<p>ThorstenHans opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591\">PR #11591</a> from <code>ThorstenHans:chore/wasio-streaming-chunksize</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>While moving vast amounts of data using <code>wasi:io</code> streams, we found the existing max chunk size of 4KB adding a lot of overhead. To reduce the number of chunks that one must create, this PR changes the max chunk size from 4KB to 64KB for all blocking write operations.</p>\n<p>Here a simple table outlining how many chunks are required based on max chunk size being either 4KB or 64KB:</p>\n<table>\n<thead>\n<tr>\n<th>File Size</th>\n<th>No. of Chunks (4 KB)</th>\n<th>No. of Chunks (64 KB)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>16 KB</td>\n<td>4</td>\n<td>1</td>\n</tr>\n<tr>\n<td>100 KB</td>\n<td>25</td>\n<td>2</td>\n</tr>\n<tr>\n<td>1 MB</td>\n<td>256</td>\n<td>16</td>\n</tr>\n<tr>\n<td>10 MB</td>\n<td>2,560</td>\n<td>160</td>\n</tr>\n<tr>\n<td>100 MB</td>\n<td>25,600</td>\n<td>1,600</td>\n</tr>\n<tr>\n<td>1 GB</td>\n<td>262,144</td>\n<td>16,384</td>\n</tr>\n<tr>\n<td>10 GB</td>\n<td>2,621,440</td>\n<td>163,840</td>\n</tr>\n<tr>\n<td>100 GB</td>\n<td>26,214,400</td>\n<td>1,638,400</td>\n</tr>\n</tbody>\n</table>\n<p>I'll leave this in a draft state for now and will collect additional data on performance improvements<br>\n</p>\n</blockquote>",
        "id": 537347919,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756839645
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591#issuecomment-3246971617\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591\">PR #11591</a>:</p>\n<blockquote>\n<p>The <code>blocking-write-and-flush</code> chunk size is specified in the wasi-io spec, not in wasmtime, so we actually can't make this change without a breaking change to Wasi, which won't happen at this point because streams are completely redone as part of the component model as part of Wasi 0.3.</p>\n<p>Basically, <code>blocking-write-and-flush</code> is a convenience method that exists primarily to make sure its always possible to write a debug message without getting any sort of protocol right. Its not meant to be the fast path. Instead, you should use <code>check-write</code>, <code>write</code>, and polling on a <code>pollable</code> in order to get the maximum performance out of an <code>output-stream</code>. So, please check if you can start using a larger chunk size when switching to that part of the interface. We have a lot more flexibility with how those methods are implemented.</p>\n</blockquote>",
        "id": 537372444,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756851620
    },
    {
        "content": "<p>ThorstenHans <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591#issuecomment-3249124648\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591\">PR #11591</a>:</p>\n<blockquote>\n<p>@pchickey thanks for the feedback. </p>\n<p>the blocking apis are actually used in a 3rd party dependency on the guest side. I'll reach out to one of the maintainers to discuss and suggest the change you mentioned.</p>\n<p>Q: You mentioned the chunk size being \"specified\" in the wasi-io spec, I can only find <code>4096</code> being referenced in comments: <a href=\"https://github.com/WebAssembly/wasi-io/blob/73222408bd3de90c8a9144c9ece02bb606c834f6/wit/streams.wit#L154\">https://github.com/WebAssembly/wasi-io/blob/73222408bd3de90c8a9144c9ece02bb606c834f6/wit/streams.wit#L154</a> </p>\n<p>Any other places you can point me to? </p>\n</blockquote>",
        "id": 537469119,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756903892
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591#issuecomment-3249858858\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11591\">PR #11591</a>:</p>\n<blockquote>\n<p>The comments are the spec, yes.</p>\n</blockquote>",
        "id": 537508902,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756915274
    }
]