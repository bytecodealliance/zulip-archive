[
    {
        "content": "<p>mmcloughlin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570883747,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769716534
    },
    {
        "content": "<p>mmcloughlin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a> from <code>mmcloughlin:isle-recursion-check</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>Extends the ISLE compiler with a recursive terms check. Terms with rules that include a reference cycle are only allowed if the term explicitly opts in with the <code>rec</code> attribute.</p>\n<p>Recently, we have seen problems where recursive rules enable user-controlled recursion and therefore potential stack overflow enabling a compilation DoS. For example, see #12368, #12333, and #12369. With this additional compilation check, recursion is not disallowed but is more explicit, making audits easier and offering a path to eventually disallowing recursive rules altogether.<br>\n</p>\n</blockquote>",
        "id": 570883798,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769716550
    },
    {
        "content": "<p>mmcloughlin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570884638,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769716833
    },
    {
        "content": "<p>mmcloughlin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570891238,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769719326
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2743635495\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, after reading further, I see that actually all terms in the cycle must have <code>rec</code>, and all terms with <code>rec</code> must participate in a cycle; is that right?</p>\n</blockquote>",
        "id": 570898487,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769722167
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2743583343\">PR review comment</a>:</p>\n<blockquote>\n<p>s/is recursive/is permitted to be recursive/, right?</p>\n<p>If you wouldn't mind, it'd be great to update the langref at the same time (<code>cranelift/isle/docs/language-reference.md</code>). In particular the semantics could use a little bit of preciseness: is it that in any cycle in the callgraph, at least one term must have <code>rec</code>?</p>\n</blockquote>",
        "id": 570898489,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769722167
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2743606186\">PR review comment</a>:</p>\n<blockquote>\n<p>In each case where we have a <code>rec</code>, could we have a comment describing why it's bounded?</p>\n<p>In particular I'm thinking these should be modeled after something like Rust safety comments -- so e.g. <code>// Recursion: may recurse once to reuse implementation for F32 in the case of F16</code> or <code>// Recursion: bounded by explicit depth parameter 'depth'</code> or <code>// Recursion: each iteration of count_the_bits_in_isle removes one bit from value and completes when zero</code> or something like that.</p>\n</blockquote>",
        "id": 570898490,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769722167
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2743594539\">PR review comment</a>:</p>\n<blockquote>\n<p>I'm somewhat concerned about runtime here: for every term we're computing all reachable terms, which in the limit in an arbitrary graph has O(V^2) complexity, right?</p>\n<p>Could we instead do a DFS over the forest (i.e., DFS with a toplevel loop over all nodes that starts a new DFS from a not-yet-visited node) to detect cycles? That should have O(V + E) complexity.</p>\n</blockquote>",
        "id": 570898491,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769722167
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2743585934\">PR review comment</a>:</p>\n<blockquote>\n<p>\"or vice versa\" implies that if a term is marked <code>rec</code> then it <em>must</em> participate in a recursive cycle?</p>\n</blockquote>",
        "id": 570898492,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769722167
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#pullrequestreview-3725090374\">PR review</a>:</p>\n<blockquote>\n<p>Thanks for this! I think this will be a great improvement in our ability to reason about lowering complexity.</p>\n<p>My main question/concern is about the semantics. It appears (after reading through it all -- some comments below are written as I worked this out) that the semantics are: any term that participates in a <code>rec</code> cycle must have <code>rec</code>, and any term with <code>rec</code> must participate in a recursive cycle, is that right?</p>\n<p>Naively, at least coming from experience with other \"permissive superset\" features of languages, I would expect <code>rec</code> to permit recursion but not require it (e.g., <code>unsafe</code> in Rust, or <code>letrec</code> chains of bindings in a Lisp/Scheme, or ...). But maybe this is actually good if it means it forces us to rethink carefully (and keep justifications up-to-date) if we remove the recursion, too. Regardless, I'd like to see a description of the precise semantics and a distillation of the thinking behind it in the langref, so we can preserve that intent going forward.</p>\n<p>A few other minor nits but otherwise seems fine -- thanks!</p>\n</blockquote>",
        "id": 570898496,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769722168
    },
    {
        "content": "<p>github-actions[bot] added the label <code>cranelift:area:aarch64</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570910518,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769727058
    },
    {
        "content": "<p>github-actions[bot] added the label <code>cranelift</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570910519,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769727058
    },
    {
        "content": "<p>github-actions[bot] added the label <code>cranelift:area:x64</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570910520,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769727058
    },
    {
        "content": "<p>github-actions[bot] added the label <code>isle</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 570910521,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769727059
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#issuecomment-3820822728\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @cfallin, @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"cranelift\", \"cranelift:area:aarch64\", \"cranelift:area:x64\", \"isle\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>cfallin: isle</li>\n<li>fitzgen: isle</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 570910582,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769727086
    },
    {
        "content": "<p>mmcloughlin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 573430018,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770867972
    },
    {
        "content": "<p>mmcloughlin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 573430165,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770868148
    },
    {
        "content": "<p>mmcloughlin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#issuecomment-3888545429\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>:</p>\n<blockquote>\n<p>Updated in response to review comments. Main changes:</p>\n<ul>\n<li>\n<p>Cycle finding via plain DFS with back-edge detection. Ideally we might use something like Johnson's Algorithm or a variant of Tarjan's, but DFS will find a cycle if there is one, and <br>\nshould be good enough in practice for the term-reference graphs we have.</p>\n</li>\n<li>\n<p>Change <code>rec</code> attribute semantics to \"permit recursion\" rather than \"permit and require recursion\".</p>\n</li>\n<li>Add pass and fail test cases under <code>isle_examples</code>.</li>\n<li>Document the <code>rec</code> attribute in the language reference.</li>\n<li>Provide safety comments for all existing uses of <code>rec</code> in ISLE backends.</li>\n</ul>\n</blockquote>",
        "id": 573430909,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770868906
    },
    {
        "content": "<p>mmcloughlin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#pullrequestreview-3788621642\">PR review</a>.</p>",
        "id": 573431258,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770869135
    },
    {
        "content": "<p>mmcloughlin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2796665283\">PR review comment</a>:</p>\n<blockquote>\n<p>Updated to the \"permit recursion\" semantics. Added a section to the language reference.</p>\n</blockquote>",
        "id": 573431260,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770869135
    },
    {
        "content": "<p>mmcloughlin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2796660470\">PR review comment</a>:</p>\n<blockquote>\n<p>Added <code>; Recursion: ...</code> comments for all <code>(decl rec ...)</code> terms.</p>\n</blockquote>",
        "id": 573431261,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770869136
    },
    {
        "content": "<p>mmcloughlin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2796664026\">PR review comment</a>:</p>\n<blockquote>\n<p>Updated to use a DFS algorithm over the term-reference graph which should have <code>O(V+E)</code> complexity.</p>\n</blockquote>",
        "id": 573431262,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770869136
    },
    {
        "content": "<p>mmcloughlin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#discussion_r2796665947\">PR review comment</a>:</p>\n<blockquote>\n<p>No longer has the \"must participate\" semantics. Updated comment accordingly.</p>\n</blockquote>",
        "id": 573431263,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770869136
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474#pullrequestreview-3788709919\">PR review</a>:</p>\n<blockquote>\n<p>LGTM; thanks!</p>\n</blockquote>",
        "id": 573434357,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770871426
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474 Cranelift: ISLE recursion check</a> to the merge queue.</p>",
        "id": 573434361,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770871433
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474</a>.</p>",
        "id": 573436337,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872837
    },
    {
        "content": "<p>cfallin removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12474\">PR #12474 Cranelift: ISLE recursion check</a> from the merge queue.</p>",
        "id": 573436339,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872838
    }
]