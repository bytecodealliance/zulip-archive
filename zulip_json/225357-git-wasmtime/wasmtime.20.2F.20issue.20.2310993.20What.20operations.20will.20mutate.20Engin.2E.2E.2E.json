[
    {
        "content": "<p>sammyne opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993\">issue #10993</a>:</p>\n<blockquote>\n<p>Reading the docs <a href=\"https://docs.wasmtime.dev/contributing-architecture.html#trampolines\">https://docs.wasmtime.dev/contributing-architecture.html#trampolines</a> as </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"n\">compilation</span><span class=\"w\"> </span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"s\">\"root context\"</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">An</span><span class=\"w\"> </span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">typically</span><span class=\"w\"> </span><span class=\"n\">created</span><span class=\"w\"> </span><span class=\"n\">once</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">across</span><span class=\"w\"> </span><span class=\"n\">many</span><span class=\"w\"> </span><span class=\"n\">threads</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">internally</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"o\">'</span><span class=\"na\">s</span><span class=\"w\"> </span><span class=\"n\">atomically</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">counted</span><span class=\"p\">).</span><span class=\"w\"> </span><span class=\"n\">Each</span><span class=\"w\"> </span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"n\">stores</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">cross</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">interning</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">instances</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">thing</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">remember</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">mutation</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"n\">internals</span><span class=\"w\"> </span><span class=\"n\">typically</span><span class=\"w\"> </span><span class=\"n\">involves</span><span class=\"w\"> </span><span class=\"n\">acquiring</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">lock</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">whereas</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">below</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">locks</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">necessary</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>Just wondering which operations will mutate Engine's internals.</p>\n</blockquote>",
        "id": 523229565,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1749542438
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993#issuecomment-2959546773\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993\">issue #10993</a>:</p>\n<blockquote>\n<p>One example is compiling a <code>Module</code> which inserts information within an engine. Do you have a specific operation you're worried about though?</p>\n</blockquote>",
        "id": 523309562,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1749566766
    },
    {
        "content": "<p>sammyne <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993#issuecomment-2961020744\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993\">issue #10993</a>:</p>\n<blockquote>\n<blockquote>\n<p>One example is compiling a <code>Module</code> which inserts information within an engine. Do you have a specific operation you're worried about though?</p>\n</blockquote>\n<p>Just want to figure out scenarios where sharing an engine may cause its inner lock to hurt performance of calling funcs.</p>\n</blockquote>",
        "id": 523400747,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1749608021
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993\">issue #10993</a>:</p>\n<blockquote>\n<p>Reading the docs <a href=\"https://docs.wasmtime.dev/contributing-architecture.html#trampolines\">https://docs.wasmtime.dev/contributing-architecture.html#trampolines</a> as </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"n\">compilation</span><span class=\"w\"> </span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"s\">\"root context\"</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">An</span><span class=\"w\"> </span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">typically</span><span class=\"w\"> </span><span class=\"n\">created</span><span class=\"w\"> </span><span class=\"n\">once</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">across</span><span class=\"w\"> </span><span class=\"n\">many</span><span class=\"w\"> </span><span class=\"n\">threads</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">internally</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"o\">'</span><span class=\"na\">s</span><span class=\"w\"> </span><span class=\"n\">atomically</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">counted</span><span class=\"p\">).</span><span class=\"w\"> </span><span class=\"n\">Each</span><span class=\"w\"> </span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"n\">stores</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">cross</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">interning</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">instances</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">thing</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">remember</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Engine</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">mutation</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"n\">internals</span><span class=\"w\"> </span><span class=\"n\">typically</span><span class=\"w\"> </span><span class=\"n\">involves</span><span class=\"w\"> </span><span class=\"n\">acquiring</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">lock</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">whereas</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">below</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">locks</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">necessary</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>Just wondering which operations will mutate Engine's internals.</p>\n</blockquote>",
        "id": 523575999,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1749652501
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993#issuecomment-2963089173\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/10993\">issue #10993</a>:</p>\n<blockquote>\n<p>Ah for that you're fine, I believe it's just creating a new <code>Module</code> has locks internally, but nothing else needs it.</p>\n</blockquote>",
        "id": 523576000,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1749652501
    }
]