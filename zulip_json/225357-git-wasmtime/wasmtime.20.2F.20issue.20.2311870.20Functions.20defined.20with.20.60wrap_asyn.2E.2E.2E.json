[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11870\">issue #11870</a>:</p>\n<blockquote>\n<p>This issue is similar to #11869 but I've separated it out to specifically deal with usage of <code>block_on</code> with respect to <code>wrap_async</code> and its variants. The <code>wrap_async</code> function has been a pillar of Wasmtime's async support historically but it's effectively entirely incompatible with component-model-async semantics. Notably <code>wrap_async</code> \"locks\" a store across <code>await</code> points meaning that it's not possible to progress other tasks at the same time. While this sort of means that <code>wrap_async</code> is \"just another blocking call\" from the perspective of a component it has the notable consequence of making <code>run_concurrent</code> not actually properly run things concurrently. Effectively this suffers from the same problems as #11869.</p>\n<p>Fixing this issue is expected to be difficult. Ideally we'd \"just delete all calls and use <code>wrap_concurrent</code> instead\", but that's a pretty large change to make. That also doesn't clearly translate to core wasm where there's no equivalent of concurrent calls at this time. A more localized fix would be to remove all of Wasmtime's usage of <code>wrap_async</code>, document the pitfalls, and then move on. For example <code>wasmtime-wasi</code> would avoid using <code>wrap_async</code> and would use <code>wrap_concurrent</code> (or an equivalent thereof) instead. This wouldn't actually fix WASIp1 APIs since there's no <code>*_concurrent</code> available, though.</p>\n<p>Regardless I wanted to write down this issue to have a place to discuss this and notably link to in the source/documentation about how this is a major limitation of <code>run_concurrent</code> today.</p>\n</blockquote>",
        "id": 545132814,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1760565047
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the wasm-proposal:component-model-async label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11870\">Issue #11870</a>.</p>",
        "id": 545132815,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1760565048
    }
]