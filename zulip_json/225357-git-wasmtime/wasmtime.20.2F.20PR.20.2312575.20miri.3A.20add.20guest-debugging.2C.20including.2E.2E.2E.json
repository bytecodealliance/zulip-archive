[
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a> from <code>cfallin:debug-frames-miri</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>The fix to <code>vm_store_context</code> provenance in <code>record_unwind</code>/<code>unwind</code> is a little weird to me. I was seeing mut access to the <code>vm_store_context</code> via <code>store.vm_store_context_mut()</code> in <code>record_unwind</code> (before this diff) then access via the previously saved raw pointer in the <code>CallThreadState</code>, which was registered as invalid and I believe is indeed invalid. This was only manifesting when setting <code>Config::guest_debug</code>, even without the frame-handle accesses added here. I didn't dig into the exact diff in codegen or runtime behavior that caused this but in any case, accessing <code>vm_store_context</code> via these two different paths (with one mut) appears to be unsound in any case. The fix here is to set the unwind state via the raw pointer in <code>CallThreadState</code> since that's the only path that the subsequent <code>unwind</code> has access to.</p>\n<p>Unrelated but useful: <code>ci/miri-provenance.test.sh</code> now accepts <code>MIRI_RUST_VERSION=+nightly</code> or whatnot, which is nice for running locally (I keep <code>stable</code> as my default toolchain).</p>\n<p>Stacked on top of #12566 (only last commit is new).</p>\n</blockquote>",
        "id": 573407535,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770852839
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573407538,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770852839
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573407539,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770852840
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573407540,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770852840
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573407541,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770852840
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573411003,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770854858
    },
    {
        "content": "<p>cfallin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>The fix to <code>vm_store_context</code> provenance in <code>record_unwind</code>/<code>unwind</code> is a little weird to me. I was seeing mut access to the <code>vm_store_context</code> via <code>store.vm_store_context_mut()</code> in <code>record_unwind</code> (before this diff) then access via the previously saved raw pointer in the <code>CallThreadState</code>, which was registered as invalid and I believe is indeed invalid. This was only manifesting when setting <code>Config::guest_debug</code>, even without the frame-handle accesses added here. I didn't dig into the exact diff in codegen or runtime behavior that caused this but in any case, accessing <code>vm_store_context</code> via these two different paths (with one mut) appears to be unsound in any case. The fix here is to set the unwind state via the raw pointer in <code>CallThreadState</code> since that's the only path that the subsequent <code>unwind</code> has access to.</p>\n<p>Unrelated but useful: <code>ci/miri-provenance.test.sh</code> now accepts <code>MIRI_RUST_VERSION=+nightly</code> or whatnot, which is nice for running locally (I keep <code>stable</code> as my default toolchain).</p>\n</blockquote>",
        "id": 573411027,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770854870
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573411088,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770854915
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573411156,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770854962
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#pullrequestreview-3788310591\">PR review</a>:</p>\n<blockquote>\n<p>Thanks! Do you think it'd be worth running through anything else in the debug API as well? Or does getting a module more-or-less exercise everything?</p>\n</blockquote>",
        "id": 573419798,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770860406
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#discussion_r2796346340\">PR review comment</a>:</p>\n<blockquote>\n<p>Another way you can run this script is <code>rustup run nightly ./ci/miri-provenance.test.sh ...</code> although using <code>MIRI_RUST_VERSION=+nightly</code> works here too just as well</p>\n</blockquote>",
        "id": 573419799,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770860406
    },
    {
        "content": "<p>github-actions[bot] added the label <code>wasmtime:api</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573432947,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770870597
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573435790,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872535
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#pullrequestreview-3788746344\">PR review</a>.</p>",
        "id": 573435871,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872557
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#discussion_r2796784541\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, I had no idea -- thanks! Removed my ad-hoc env var and added a comment to this script instead noting this trick.</p>\n</blockquote>",
        "id": 573435873,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872557
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#issuecomment-3888703587\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>Getting the current module exercises almost everything (frame-walking, getting metadata, reading raw vmctx and converting back to proper borrow of instance, etc) but I added a few more reads for good measure. Thanks!</p>\n</blockquote>",
        "id": 573435962,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872615
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573435968,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770872620
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575 miri: add guest-debugging, including frame accesses.</a> to the merge queue</p>",
        "id": 573437016,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770873342
    },
    {
        "content": "<p>cfallin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>The fix to <code>vm_store_context</code> provenance in <code>record_unwind</code>/<code>unwind</code> is a little weird to me. I was seeing mut access to the <code>vm_store_context</code> via <code>store.vm_store_context_mut()</code> in <code>record_unwind</code> (before this diff) then access via the previously saved raw pointer in the <code>CallThreadState</code>, which was registered as invalid and I believe is indeed invalid. This was only manifesting when setting <code>Config::guest_debug</code>, even without the frame-handle accesses added here. I didn't dig into the exact diff in codegen or runtime behavior that caused this but in any case, accessing <code>vm_store_context</code> via these two different paths (with one mut) appears to be unsound in any case. The fix here is to set the unwind state via the raw pointer in <code>CallThreadState</code> since that's the only path that the subsequent <code>unwind</code> has access to.</p>\n</blockquote>",
        "id": 573437231,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770873520
    },
    {
        "content": "<p>github-merge-queue[bot] removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575 miri: add guest-debugging, including frame accesses.</a> from the merge queue</p>",
        "id": 573439000,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770874885
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573589916,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770920090
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#issuecomment-3892613615\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>@alexcrichton pinging for re-review here -- another miri test failure (not part of the Pulley provenance test) has pushed me back toward another approach that involves re-deriving the raw <code>VMStoreContext</code> pointer in <code>CallThreadState</code> when setting up unwind state, for provenance reasons; this avoids action-at-a-distance failures where any mutation on the store in some path can potentially invalidate provenance.</p>\n</blockquote>",
        "id": 573590185,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770920175
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573590233,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770920191
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573590634,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770920322
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#issuecomment-3892819637\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>(There's still a failure on s390x only that I suspect is an endianness issue when running Pulley + guest-debug instrumentation -- will take a look)</p>\n</blockquote>",
        "id": 573597186,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770922638
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#pullrequestreview-3793264287\">PR review</a>:</p>\n<blockquote>\n<p>Looks reasonable to me yeah <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 573605827,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770925477
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#issuecomment-3893042138\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>A little more detail: Pulley on s390x with guest-debug enabled (which hasn't been tested before -- only native s390x with guest-debug) is generating a big-endian vector store in the CLIF to compile to Pulley, which Cranelift's Pulley backend doesn't support. That's a nontrivial bit of implementation (lane swapping, etc). I'll instead refactor the instrumentation to work as e.g. object fields do, always little endian, in a separate PR.</p>\n</blockquote>",
        "id": 573606269,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770925638
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#issuecomment-3893581035\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>s390x fix in #12585; will rebase on that once merged.</p>\n</blockquote>",
        "id": 573623504,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770932947
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#pullrequestreview-3793264287\">PR review</a>:</p>\n<blockquote>\n<p>Looks reasonable to me yeah <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 573637421,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770939391
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573637422,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770939392
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573637643,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770939546
    },
    {
        "content": "<p>cfallin edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575#issuecomment-3893581035\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>:</p>\n<blockquote>\n<p>s390x fix in #12585; will <del>rebase on that</del> merge that in once merged.</p>\n</blockquote>",
        "id": 573639279,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770940592
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575 miri: add guest-debugging, including frame accesses.</a> to the merge queue</p>",
        "id": 573639533,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770940769
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575</a>.</p>",
        "id": 573641783,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770942159
    },
    {
        "content": "<p>cfallin removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12575\">PR #12575 miri: add guest-debugging, including frame accesses.</a> from the merge queue</p>",
        "id": 573641785,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770942160
    }
]