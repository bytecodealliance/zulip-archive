[
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 564607784,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766112977
    },
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a> from <code>cfallin:debugger-crate</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>The debug support in Wasmtime so far is structured around async callbacks that occur at certain kinds of events, like breakpoints. This is a suitable foundation but makes for an awkward implementation of a top-level debugger implementation, which likely has an event loop dealing with user commands (via a UI or a protocol connection) and expects to perform actions such as \"run until next breakpoint\".</p>\n<p>This PR introduces a new crate that wraps a <code>Store</code> in a <code>Debugger</code>. This wrapper embodies an inner async body that can perform whatever actions it likes on the <code>Store</code> that is passed back in. This inner body is spawned as an async task. The debugger wrapper registers its own <code>DebugHandler</code> callback that communicates with the outside world via bidirectional command/response queues.</p>\n<p>On the \"outside\", the <code>Debugger</code> presents an interface suitable for inserting into a debug protocol server or UI: an async method that runs until next event and returns that event, and a method that permits querying or modifying the store whenever the <code>run</code> method is not executing. The latter operates by sending a closure over the queue, because the <code>Store</code> must continue to be owned by the async task that is (still) running and suspended in async callbacks.</p>\n<p>Right now, this is exercised only via a few unit tests, but the intent is to next build up the \"top half\" of the debugger using this abstraction, e.g. by running a gdbstub protocol server (likely as a Wasm component in a \"debug-main WIT world\" -- RFC needed for this).</p>\n<p>Also, when we eventually move debugging over to native use of <code>run_concurrent</code>, this paradigm should remain mostly unchanged at this level of API: there can still be an object that has an async method that runs and yields the next event, and there can still be a method that takes a closure that can operate (within its scope only) on the <code>Store</code>.</p>\n<p>A few warts that I could use feedback on:</p>\n<ul>\n<li>\n<p>Cancelation safety is weird. Fibers panic when dropped before execution of their body completes, and this seems to mean that we can't allow a <code>Debugger</code> to drop early (or at least, the <code>tokio::test</code> unit test that owns the runtime that runs the async task to finish before the debugged body completes!). If there is a better way to handle cancelation safety here, I'm all ears.</p>\n</li>\n<li>\n<p>It's not clear to me if the boxed-closure-and-<code>Any</code> approach to providing access to the <code>Store</code> is the best we can do, but I suspect it is.</p>\n</li>\n</ul>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 564607786,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766112978
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 564607787,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766112978
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 564607788,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766112978
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 564627311,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766126086
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 564748495,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766166186
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3599582028\">PR review</a>:</p>\n<blockquote>\n<p>Have to context switch, but want to get my comments thus far posted.</p>\n</blockquote>",
        "id": 564764720,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766172936
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2635961023\">PR review comment</a>:</p>\n<blockquote>\n<p>Could be good to have an ascii diagram of the state machine here. Assuming we start in the <code>Paused</code> state, effectively always beginning at a breakpoint just before the program's first instantiation, I'm thinking something like</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>  |\n  |\n  V\nPaused &lt;---------&gt; Queried\n  ^\n  |\n  |\n  V\nRunning\n  |\n  |\n  V\nComplete\n</code></pre></div>\n<p>But now that I think about it some more, it seems like complete and paused are actually the same for \"reactor\" style programs? That is, those that are a bag of exported functions that can be called in any order, rather than those defining just a <code>main</code>. This is because you start out in the initial paused state, call into some exported function and do stuff and then that can complete but you can always call back in again and do more stuff and debug these subsequent entries into the program as well.</p>\n<p>This also makes me think of something that I don't think we've discussed thus far in our debugging conversations: debugging the start function and instantiation in general. For example, what if a data segment's initialization traps due to out-of-bounds memory access? We want to support debugging that, but I don't think we raise a debugging trap event for that yet, do we? (Obviously, we don't need to address all that in this PR, but I think this state machine should reflect the actual states we want to support in the fullness of time, IMO). So given that I think we actually want something like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"n\">V</span>\n<span class=\"n\">Uninstantiated</span><span class=\"w\"> </span><span class=\"o\">&lt;---</span><span class=\"p\">.</span>\n<span class=\"w\">   </span><span class=\"o\">^</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">               </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">debugger</span><span class=\"w\"> </span><span class=\"n\">says</span><span class=\"w\"> </span><span class=\"n\">terminate</span><span class=\"p\">)</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"n\">V</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"n\">Running</span><span class=\"w\">            </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">^</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"n\">V</span><span class=\"w\">               </span><span class=\"o\">|</span>\n<span class=\"n\">Paused</span><span class=\"o\">-------------'</span>\n<span class=\"w\">   </span><span class=\"o\">^</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"n\">V</span>\n<span class=\"n\">Queried</span>\n</code></pre></div>\n<p>where uninstantiated to running involves instantiation, and returning from <code>main</code> or any other export that we called into as the entry point puts us back at paused (since we can inspect memories and such in this state, but can't in the uninstantiated state)</p>\n</blockquote>",
        "id": 564764721,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766172936
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2635910884\">PR review comment</a>:</p>\n<blockquote>\n<p>Maybe name this <code>Paused</code>, because the name is a bit ambiguous with <code>Complete</code> otherwise (a program stops when it is finished, does it not?)</p>\n</blockquote>",
        "id": 564764722,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766172936
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3599858904\">PR review</a>.</p>",
        "id": 564766555,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766173815
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636121299\">PR review comment</a>:</p>\n<blockquote>\n<p>Happy to add a state diagram!</p>\n<p>One point of clarification regarding \"before instantiation\" or distinctions between different lifecycle states of a Wasm instance/component: this interface actually has no concept of instantiation. The \"inner body\" can be anything: it could create a bunch of instances, it could continue to call into an already-existing instance, etc. It inverts control so that the code on the outside gets events when the callback occurs, that's it; and the body doesn't run until the first <code>run()</code>.</p>\n<p>So, yes, we could add debug events for out-of-bounds accesses by data segments. Any breakpoints in the start function should already \"just work\" though in the sense that it'll be Wasm execution within the scope of the inner body.</p>\n</blockquote>",
        "id": 564766557,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766173815
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3600263666\">PR review</a>:</p>\n<blockquote>\n<blockquote>\n<p>this seems to mean that we can't allow a Debugger to drop early</p>\n</blockquote>\n<p>This is definitely a bug in Wasmtime that we need to fix. Can you add a failing test or gist one that I can help poke around?</p>\n</blockquote>",
        "id": 564781621,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766181986
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636414411\">PR review comment</a>:</p>\n<blockquote>\n<p>You can drop debug/std/async here since that'll come in through the normal dependency</p>\n</blockquote>",
        "id": 564781623,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766181986
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636413341\">PR review comment</a>:</p>\n<blockquote>\n<p>should this be omitted?</p>\n</blockquote>",
        "id": 564781625,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766181987
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636426603\">PR review comment</a>:</p>\n<blockquote>\n<p>This should be define-able with <code>async fn handle(...)</code> and you don't need to worry about <code>Send</code></p>\n</blockquote>",
        "id": 564781626,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766181987
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3676964136\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<blockquote>\n<p>This is definitely a bug in Wasmtime that we need to fix. Can you add a failing test or gist one that I can help poke around?</p>\n</blockquote>\n<p>Sure thing -- with <a href=\"https://github.com/cfallin/wasmtime/commit/2d22450579d820257317fe125b634ab360291e51\">this</a> commit and</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">debugger</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">basic_debugger</span>\n</code></pre></div>\n<p>I see</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">test</span><span class=\"p\">::</span><span class=\"n\">basic_debugger</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1129985</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">runtime</span><span class=\"o\">/</span><span class=\"n\">fiber</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">199</span><span class=\"p\">:</span><span class=\"mi\">70</span><span class=\"p\">:</span>\n<span class=\"nc\">called</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Option</span><span class=\"p\">::</span><span class=\"n\">unwrap</span><span class=\"p\">()</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">None</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">value</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 564786840,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766185784
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3676965200\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>(It's entirely possible that I'm holding some part of the async machinery wrong, either in this PR or in earlier work to add the async debugger hook -- happy to have your opinions on that if so!)</p>\n</blockquote>",
        "id": 564786885,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766185823
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3682843250\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>That'll get fixed by this:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/wasmtime/src/runtime/fiber.rs b/crates/wasmtime/src/runtime/fiber.rs</span>\n<span class=\"gh\">index 68dce6884f..1ab5120ef3 100644</span>\n<span class=\"gd\">--- a/crates/wasmtime/src/runtime/fiber.rs</span>\n<span class=\"gi\">+++ b/crates/wasmtime/src/runtime/fiber.rs</span>\n<span class=\"gu\">@@ -358,7 +358,7 @@ impl StoreOpaque {</span>\n<span class=\"w\"> </span>    }\n\n<span class=\"w\"> </span>    /// Returns whether `block_on` will succeed or panic.\n<span class=\"gd\">-    #[cfg(feature = \"call-hook\")]</span>\n<span class=\"gi\">+    #[cfg(any(feature = \"call-hook\", feature = \"debug\"))]</span>\n<span class=\"w\"> </span>    pub(crate) fn can_block(&amp;mut self) -&gt; bool {\n<span class=\"w\"> </span>        self.fiber_async_state_mut().current_future_cx.is_some()\n<span class=\"w\"> </span>    }\n<span class=\"gh\">diff --git a/crates/wasmtime/src/runtime/store.rs b/crates/wasmtime/src/runtime/store.rs</span>\n<span class=\"gh\">index 0ce69fc6c3..ac6929d376 100644</span>\n<span class=\"gd\">--- a/crates/wasmtime/src/runtime/store.rs</span>\n<span class=\"gi\">+++ b/crates/wasmtime/src/runtime/store.rs</span>\n<span class=\"gu\">@@ -2839,6 +2839,9 @@ unsafe impl&lt;T&gt; VMStore for StoreInner&lt;T&gt; {</span>\n<span class=\"w\"> </span>    #[cfg(feature = \"debug\")]\n<span class=\"w\"> </span>    fn block_on_debug_handler(&amp;mut self, event: crate::DebugEvent&lt;'_&gt;) -&gt; anyhow::Result&lt;()&gt; {\n<span class=\"w\"> </span>        if let Some(handler) = self.debug_handler.take() {\n<span class=\"gi\">+            if !self.can_block() {</span>\n<span class=\"gi\">+                bail!(\"couldn't grab async_cx for debug handler\")</span>\n<span class=\"gi\">+            }</span>\n<span class=\"w\"> </span>            log::trace!(\"about to raise debug event {event:?}\");\n<span class=\"w\"> </span>            StoreContextMut(self).with_blocking(|store, cx| {\n<span class=\"w\"> </span>                cx.block_on(Pin::from(handler.handle(store, event)).as_mut())\n</code></pre></div>\n<p>tl;dr; when a store is dropped all fibers are resumed with a trap that says \"please die immediately\" but there are some circumstances in internal code where during the process of returning an error from everything something async is attempted. The async attempt fails because the blocking context (rightfully) wasn't configured. </p>\n<p>This happened before with call hooks for example where we would try to invoke the call hook when the fiber is exiting saying \"hey a trap happened\". The fix here is to just skip debug events/call hooks/etc during this situation since if the store is being dropped that's no interesting anyway</p>\n</blockquote>",
        "id": 565037098,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766421284
    },
    {
        "content": "<p>alexcrichton edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3682843250\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>That'll get fixed by this:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/wasmtime/src/runtime/fiber.rs b/crates/wasmtime/src/runtime/fiber.rs</span>\n<span class=\"gh\">index 68dce6884f..1ab5120ef3 100644</span>\n<span class=\"gd\">--- a/crates/wasmtime/src/runtime/fiber.rs</span>\n<span class=\"gi\">+++ b/crates/wasmtime/src/runtime/fiber.rs</span>\n<span class=\"gu\">@@ -358,7 +358,7 @@ impl StoreOpaque {</span>\n<span class=\"w\"> </span>    }\n\n<span class=\"w\"> </span>    /// Returns whether `block_on` will succeed or panic.\n<span class=\"gd\">-    #[cfg(feature = \"call-hook\")]</span>\n<span class=\"gi\">+    #[cfg(any(feature = \"call-hook\", feature = \"debug\"))]</span>\n<span class=\"w\"> </span>    pub(crate) fn can_block(&amp;mut self) -&gt; bool {\n<span class=\"w\"> </span>        self.fiber_async_state_mut().current_future_cx.is_some()\n<span class=\"w\"> </span>    }\n<span class=\"gh\">diff --git a/crates/wasmtime/src/runtime/store.rs b/crates/wasmtime/src/runtime/store.rs</span>\n<span class=\"gh\">index 0ce69fc6c3..ac6929d376 100644</span>\n<span class=\"gd\">--- a/crates/wasmtime/src/runtime/store.rs</span>\n<span class=\"gi\">+++ b/crates/wasmtime/src/runtime/store.rs</span>\n<span class=\"gu\">@@ -2839,6 +2839,9 @@ unsafe impl&lt;T&gt; VMStore for StoreInner&lt;T&gt; {</span>\n<span class=\"w\"> </span>    #[cfg(feature = \"debug\")]\n<span class=\"w\"> </span>    fn block_on_debug_handler(&amp;mut self, event: crate::DebugEvent&lt;'_&gt;) -&gt; anyhow::Result&lt;()&gt; {\n<span class=\"w\"> </span>        if let Some(handler) = self.debug_handler.take() {\n<span class=\"gi\">+            if !self.can_block() {</span>\n<span class=\"gi\">+                bail!(\"couldn't grab async_cx for debug handler\")</span>\n<span class=\"gi\">+            }</span>\n<span class=\"w\"> </span>            log::trace!(\"about to raise debug event {event:?}\");\n<span class=\"w\"> </span>            StoreContextMut(self).with_blocking(|store, cx| {\n<span class=\"w\"> </span>                cx.block_on(Pin::from(handler.handle(store, event)).as_mut())\n</code></pre></div>\n<p>tl;dr; when a store is dropped all fibers are resumed with a trap that says \"please die immediately\" but there are some circumstances in internal code where during the process of returning an error from everything something async is attempted. The async attempt fails because the blocking context (rightfully) wasn't configured. </p>\n<p>This happened before with call hooks for example where we would try to invoke the call hook when the fiber is exiting saying \"hey a trap happened\". The fix here is to just skip debug events/call hooks/etc during this situation since if the store is being dropped that's no interesting anyway</p>\n<p>(if you wouldn't mind this'd be a good thing to add a test for too)</p>\n</blockquote>",
        "id": 565037124,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766421302
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565051514,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427626
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605218427\">PR review</a>.</p>",
        "id": 565051527,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427634
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640810573\">PR review comment</a>:</p>\n<blockquote>\n<p>Added in cce7e85d8c.</p>\n</blockquote>",
        "id": 565051529,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427634
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605219419\">PR review</a>.</p>",
        "id": 565051552,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427649
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640811460\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, good point -- fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>\n</blockquote>",
        "id": 565051554,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427649
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605220260\">PR review</a>.</p>",
        "id": 565051576,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427662
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640812166\">PR review comment</a>:</p>\n<blockquote>\n<p>Good point, thanks -- fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>\n</blockquote>",
        "id": 565051577,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427663
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605221143\">PR review</a>.</p>",
        "id": 565051607,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427677
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640812888\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, yes, that was a copy-paste leftover -- fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>\n</blockquote>",
        "id": 565051611,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427678
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605231934\">PR review</a>.</p>",
        "id": 565052003,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427870
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640821895\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, good point. Fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>\n</blockquote>",
        "id": 565052004,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766427870
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565067698,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766436271
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565068191,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766436569
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3684112072\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Awesome, thanks @alexcrichton for that fix! Updated and added a test with an early drop of debugger/store.</p>\n</blockquote>",
        "id": 565068289,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766436603
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605706420\">PR review</a>:</p>\n<blockquote>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> from me (I defer to you/Nick to possibly await his approval too)</p>\n</blockquote>",
        "id": 565069116,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766437055
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3684224163\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Thanks! I'll go ahead and merge and we can always tweak anything we need as we build on top of this.</p>\n</blockquote>",
        "id": 565071619,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766438508
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3685012187\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>CI failure on i686 (i.e., pulley32) is due to a problem with <code>PreserveAll</code> interacting poorly with Pulley's call1/2/3/4 optimization; #12213 fixes (tested locally). Will merge that here once that PR lands.</p>\n</blockquote>",
        "id": 565096020,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766462761
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605706420\">PR review</a>:</p>\n<blockquote>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> from me (I defer to you/Nick to possibly await his approval too)</p>\n</blockquote>",
        "id": 565203362,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766517783
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565203365,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766517783
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565203388,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766517791
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3687966604\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>The CI error there is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Running</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"s\">\"curl\"</span><span class=\"w\"> </span><span class=\"s\">\"--user-agent\"</span><span class=\"w\"> </span><span class=\"s\">\"bytecodealliance/wasmtime auto-publish script\"</span><span class=\"w\"> </span><span class=\"s\">\"https://crates.io/api/v1/crates/wasmtime-internal-debugger/owners\"</span><span class=\"err\">`</span>\n\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">2599</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">scripts</span><span class=\"o\">/</span><span class=\"n\">publish</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">623</span><span class=\"p\">:</span><span class=\"mi\">17</span><span class=\"p\">:</span>\n\n<span class=\"nc\">crate</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">debugger</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">owned</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">publish</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">please</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">:</span>\n\n<span class=\"w\">    </span><span class=\"nc\">cargo</span><span class=\"w\"> </span><span class=\"n\">owner</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">publish</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">debugger</span>\n\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div>\n<p>notably we verify that all crates are owned by <code>wasmtime-publish</code> and already published to <a href=\"http://crates.io\">crates.io</a> -- this ensures the auto-publish later succeeds. Can you publish a stub crate and invite the <code>wasmtime-publish</code> owner?</p>\n</blockquote>",
        "id": 565212458,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766524029
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688039342\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Yep, I've just published <a href=\"https://crates.io/crates/wasmtime-internal-debugger/\">the crate</a> and invited <code>wasmtime-publish</code> -- let me know when ready to re-attempt landing.</p>\n</blockquote>",
        "id": 565215641,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766526115
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688148897\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>I'm not sure I understand the failure now -- I added <code>wasmtime-publish</code> and it shows as an owner; I removed myself as an owner; it's still failing. @alexcrichton any ideas?</p>\n</blockquote>",
        "id": 565220509,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766529804
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688159771\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Oh that's wasmtime-publish-the-github-team not wasmtime-publish-the-github user. If you run <a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/20472786270/job/58831624617#step:6:2009\">the comment it printed out</a> it should be resolved</p>\n</blockquote>",
        "id": 565221594,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766530318
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688178417\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Hmm. Unfortunately I removed myself from the crate after <code>wasmtime-publish</code> accepted the invite. So I'm not able to make any more permissions changes.</p>\n<p>Do you have credentials for that user so you can log in and invite the team? Or have we lost the crate name forever?</p>\n<p>(FWIW, I want to reiterate my <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12163#issuecomment-3662737163\">suggestion from earlier</a> that we have a runbook for all of this now that we have such a complex publishing and permissions scheme, because this was all very ambiguous and undocumented to me)</p>\n</blockquote>",
        "id": 565223200,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766531171
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3690265923\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Yeah the BA has a 1password with credentials for wasmtime-publish (that's how I accepted the invite in the first place). I added the team. Agreed this can be documented better (like pretty much everything else infrastructure-related), and it's something I hope to handle in January with the move to trusted publishing.</p>\n</blockquote>",
        "id": 565302713,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766596383
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565309492,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766602066
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565309500,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766602078
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3690373690\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n</blockquote>",
        "id": 565309516,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766602090
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12183\">PR #12183</a>.</p>",
        "id": 565311742,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766604143
    }
]