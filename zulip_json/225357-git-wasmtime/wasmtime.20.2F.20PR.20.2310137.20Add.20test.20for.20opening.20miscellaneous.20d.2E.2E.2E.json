[
    {
        "content": "<p>erikrose opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137\">PR #10137</a> from <code>erikrose:dev-read-test</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>Fixes #514, but CI is grumpy and I have questions.</p>\n<p>Both the sync and async variants run by <code>cargo test -p wasi-common preview1_device_read</code> work and are valid.</p>\n<p>However, <code>foreach_preview1!(assert_test_exists)</code> fails its assertions when I run <code>ci/run-tests.sh</code> unless I repeat my tests in <code>wasi</code> (commented out here) as well as <code>wasi-common</code>. Is that the intent? I'm not sure what value such repetition has for this test. Perhaps I'm adding tests in the wrong place altogether. I welcome any illumination! (@alexcrichton?)</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0432</span><span class=\"p\">]:</span><span class=\"w\"> </span><span class=\"nc\">unresolved</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"bp\">self</span><span class=\"p\">::</span><span class=\"n\">preview1_device_read</span><span class=\"err\">`</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">86</span><span class=\"p\">:</span><span class=\"mi\">13</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">86</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">::</span><span class=\"cp\">$name</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">             </span><span class=\"o\">^^^^^^^^^^^^^^^^</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">preview1_device_read</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">async_</span><span class=\"err\">`</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"p\">:::</span><span class=\"w\"> </span><span class=\"nc\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">async_</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">30</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">foreach_preview1</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">assert_test_exists</span><span class=\"p\">);</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">-------------------------------------</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">a</span><span class=\"w\"> </span><span class=\"n\">similar</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">PREVIEW1_DEVICE_READ</span><span class=\"err\">`</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"n\">invocation</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">originates</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">assert_test_exists</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">comes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">expansion</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">foreach_preview1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Nightly</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"o\">-</span><span class=\"n\">backtrace</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"p\">)</span>\n\n<span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0432</span><span class=\"p\">]:</span><span class=\"w\"> </span><span class=\"nc\">unresolved</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"bp\">self</span><span class=\"p\">::</span><span class=\"n\">preview1_device_read</span><span class=\"err\">`</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">86</span><span class=\"p\">:</span><span class=\"mi\">13</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">86</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">::</span><span class=\"cp\">$name</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">             </span><span class=\"o\">^^^^^^^^^^^^^^^^</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">preview1_device_read</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">preview1</span><span class=\"err\">`</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"p\">:::</span><span class=\"w\"> </span><span class=\"nc\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">preview1</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">28</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">28</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">foreach_preview1</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">assert_test_exists</span><span class=\"p\">);</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">-------------------------------------</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">a</span><span class=\"w\"> </span><span class=\"n\">similar</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">PREVIEW1_DEVICE_READ</span><span class=\"err\">`</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"n\">invocation</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">originates</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">assert_test_exists</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">comes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">expansion</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">foreach_preview1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Nightly</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"o\">-</span><span class=\"n\">backtrace</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"p\">)</span>\n\n<span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0432</span><span class=\"p\">]:</span><span class=\"w\"> </span><span class=\"nc\">unresolved</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"bp\">self</span><span class=\"p\">::</span><span class=\"n\">preview1_device_read</span><span class=\"err\">`</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">86</span><span class=\"p\">:</span><span class=\"mi\">13</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">86</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">::</span><span class=\"cp\">$name</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">             </span><span class=\"o\">^^^^^^^^^^^^^^^^</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">preview1_device_read</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">sync</span><span class=\"err\">`</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"p\">:::</span><span class=\"w\"> </span><span class=\"nc\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">sync</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">32</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">foreach_preview1</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">assert_test_exists</span><span class=\"p\">);</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">-------------------------------------</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">a</span><span class=\"w\"> </span><span class=\"n\">similar</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">PREVIEW1_DEVICE_READ</span><span class=\"err\">`</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"n\">invocation</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">originates</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">assert_test_exists</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">comes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">expansion</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">foreach_preview1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Nightly</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"o\">-</span><span class=\"n\">backtrace</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Note that I've hard-coded a \"/dev\" preopen into the test harnesses temporarily. Once I'm sure I'm adding to the right set of tests, I'll refactor to pass it only for this new one.</p>\n</blockquote>",
        "id": 496378749,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738082740
    },
    {
        "content": "<p>erikrose updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137\">PR #10137</a>.</p>",
        "id": 496399131,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738088858
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137#issuecomment-2619956305\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137\">PR #10137</a>:</p>\n<blockquote>\n<p>Thanks! Yeah what you're seeing here is a bit of history + testing infrastructure, sorry for the confusion...</p>\n<p>The <code>wasi-common</code> crate that #514 refers to has been deprecated for some time now in favor of <code>wasmtime-wasi</code>, although currently all <code>preview1_*.rs</code> tests are run in both to ensure neither regresses. The infrastructure basically asserts (via a slightly roundabout method) that there's a test function for each test case which is hand-written. You've added the tests to wasi-common here but the <code>wasmtime-wasi</code> test suite asserts it's running all preview1 tests here but uncommenting the blocks there should be good to go.</p>\n<p>One thing you'll need to handle I think though is Windows-vs-Unix as these tests probably won't pass on Windows. Additionally it looks like you're changing how all tests are run by preopening <code>/dev</code> instead of the workspace? If possible that'd only be done for this one test as opposed to all of them, which might need a slightly fancier helper function to run the test than what exists right now </p>\n</blockquote>",
        "id": 496415723,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738094861
    },
    {
        "content": "<p>erikrose <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137#issuecomment-2620034580\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137\">PR #10137</a>:</p>\n<blockquote>\n<p>Thanks so much! That clears it right up. Redundancy that serves a purpose is no redundancy at all. :-)</p>\n<blockquote>\n<p>One thing you'll need to handle I think though is Windows-vs-Unix as these tests probably won't pass on Windows.</p>\n</blockquote>\n<p>AFAIK, Windows doesn't have file-like devices, so I don't believe the tests make sense there. Indeed, ports of utils like <code>dd</code> have had to implement <a href=\"http://www.chrysocome.net/dd\">fakes to work around the lack</a>. That's why I stuck<code>#[cfg_attr(not(unix), ignore)]</code> around the tests initially. Though please scream if I'm missing something.</p>\n<blockquote>\n<p>Additionally it looks like you're changing how all tests are run by preopening /dev instead of the workspace?</p>\n</blockquote>\n<p>Just some temporary violence. I had said this below the giant error message, but hiding it there made it easy to miss:</p>\n<blockquote>\n<p>Note that I've hard-coded a \"/dev\" preopen into the test harnesses temporarily. Once I'm sure I'm adding to the right set of tests, I'll refactor to pass it only for this new one.</p>\n</blockquote>\n<p>Thanks again! With that new information, I'll see if I can get things going.</p>\n</blockquote>",
        "id": 496422283,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738097604
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137#issuecomment-2620094737\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/10137\">PR #10137</a>:</p>\n<blockquote>\n<p>Oops sorry I completely missed the <code>#[cfg_attr(not(unix), ignore)]</code>, sounds like you've got it all in hand <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 496427540,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1738099803
    }
]