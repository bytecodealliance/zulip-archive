[
    {
        "content": "<p>max-dau opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a> from <code>COLORADIO-Project:fibers-on-riscv32imac</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This adds an implementation for <code>riscv32imac</code> (and other architectures with identical registers) to the internal fiber crate. This enables usage of the <code>async</code> feature of wasmtime on such platforms.</p>\n<p>This feature was first discussed here on Zulip: <a href=\"#narrow/channel/217126-wasmtime/topic/Wasmtime-fiber.20on.20RISCV32/with/569291758\">#wasmtime &gt; Wasmtime-fiber on RISCV32</a></p>\n<p>Our concrete implementation was also discussed here: <a href=\"#narrow/channel/217126-wasmtime/topic/Question.20about.2064-bit.20RISC-V.20fiber.20implementation/with/571728084\">#wasmtime &gt; Question about 64-bit RISC-V fiber implementation</a></p>\n</blockquote>",
        "id": 571743022,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770146322
    },
    {
        "content": "<p><strong>max-dau</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a>.</p>",
        "id": 571743024,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770146322
    },
    {
        "content": "<p><strong>max-dau</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a>.</p>",
        "id": 571743025,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770146322
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#pullrequestreview-3747214489\">PR review</a>:</p>\n<blockquote>\n<p>Thanks! This looks basically fine to me except for the alignment issue below and formatting nits.</p>\n</blockquote>",
        "id": 571748246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770147913
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2760696851\">PR review comment</a>:</p>\n<blockquote>\n<p>The spacing/formatting here and below is nonstandard. Could you ensure that there is no space before commas (see e.g. line 46 <code>addi sp , sp , -0x40</code>), and one space after commas (see e.g. this line <code>sw ra,-0x4(sp)</code>)?</p>\n</blockquote>",
        "id": 571748247,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770147913
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2760703865\">PR review comment</a>:</p>\n<blockquote>\n<p>If we want to be 16-byte-aligned, these two fields together are 8 bytes (two 32-bit pointers) so the whole struct is going to be off by 8 bytes, right?</p>\n<p>Do we need additional padding between <code>ra</code> and <code>last_sp</code>?</p>\n</blockquote>",
        "id": 571748248,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770147913
    },
    {
        "content": "<p>max-dau updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a>.</p>",
        "id": 571752780,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770149332
    },
    {
        "content": "<p>max-dau created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2760800952\">PR review comment</a>:</p>\n<blockquote>\n<p>I've adjusted the spacing around the commas in the newest commit. The spacing was also copied from the riscv64 implementation, so I've adjusted the spacing there too.</p>\n</blockquote>",
        "id": 571753132,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770149442
    },
    {
        "content": "<p>max-dau submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#pullrequestreview-3747340506\">PR review</a>.</p>",
        "id": 571753139,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770149444
    },
    {
        "content": "<p>max-dau submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#pullrequestreview-3747367773\">PR review</a>.</p>",
        "id": 571754406,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770149885
    },
    {
        "content": "<p>max-dau created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2760824727\">PR review comment</a>:</p>\n<blockquote>\n<p>I was confused about this as well. In <code>nostd.rs</code> (and <code>unix.rs</code>), only the spot between <code>ra</code> and <code>last_sp</code> is explicitly documented to be 16-byte aligned. We also only move the stack pointer to that address, not to the very end of the struct.</p>\n<p>I've tested both a version with and a version without 8 bytes of padding between <code>ra</code> and <code>last_sp</code>. Both work fine on my device. I'm honestly not sure whether padding is needed there. If you think we should add padding there, I am happy to add a commit introducing this padding.</p>\n</blockquote>",
        "id": 571754408,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770149885
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#pullrequestreview-3747903260\">PR review</a>.</p>",
        "id": 571777174,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770157600
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2761255465\">PR review comment</a>:</p>\n<blockquote>\n<p>So I think a few things are going on here:</p>\n<ul>\n<li>The 16-byte alignment is required by the RISC-V ISA. Nothing in hardware enforces it (unlike aarch64, where an unaligned <code>sp</code> will actually cause a trap), but other functions are free to rely on stack alignment; so, for example, if we call some function in the fiber that eventually stores something to the stack with an aligned store, lack of alignment could cause a hard-to-diagnose segfault somewhere else. So we do need to ensure the stack as seen by the entry function to the fiber is aligned.</li>\n<li>On our 64-bit architectures, taking the end of a page and aligning the end of this struct with it will naturally provide 16-byte alignment to the top of the fiber save-frame, because the two words at the end -- the <code>last_sp</code> and the <code>run_result</code> -- are both pointers, i.e. 64-bit (8-byte) values.</li>\n<li>This is the first time we have (i) a 32-bit ISA with (ii) a 16-byte alignment requirement. So we need to be mindful of alignment here.</li>\n</ul>\n<p>Given all that, I think if we put 8 bytes of padding before <code>last_sp</code>, we'll have satisfied the alignment requirements.</p>\n</blockquote>",
        "id": 571777175,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770157601
    },
    {
        "content": "<p>cfallin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2761255465\">PR review comment</a>.</p>",
        "id": 571777402,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770157681
    },
    {
        "content": "<p>max-dau updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a>.</p>",
        "id": 571779506,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770158378
    },
    {
        "content": "<p>max-dau submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#pullrequestreview-3747971317\">PR review</a>.</p>",
        "id": 571779756,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770158488
    },
    {
        "content": "<p>max-dau created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#discussion_r2761313672\">PR review comment</a>:</p>\n<blockquote>\n<p>I've added the padding in the newest commit, thanks for taking the time to look into this!</p>\n</blockquote>",
        "id": 571779757,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770158488
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506#pullrequestreview-3747994910\">PR review</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n</blockquote>",
        "id": 571780443,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770158749
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a>.</p>",
        "id": 571780459,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770158755
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506 Add fiber implementation for riscv32imac</a> to the merge queue.</p>",
        "id": 571781426,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770159136
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506</a>.</p>",
        "id": 571785176,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770160530
    },
    {
        "content": "<p>cfallin removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12506\">PR #12506 Add fiber implementation for riscv32imac</a> from the merge queue.</p>",
        "id": 571785177,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770160530
    }
]