[
    {
        "content": "<p>pchickey opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11776\">PR #11776</a> from <code>bytecodealliance:pch/resource_sanitizer</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 542627234,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759359778
    },
    {
        "content": "<p>pchickey edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11776\">PR #11776</a>:</p>\n<blockquote>\n<p>It would be nice to have a sanitizer that could tell guest program authors where, in the guest program, resources were constructed (or, at least, taken ownership of) and last used, for any resources that have not been dropped at the end of execution.</p>\n<p>This is a rapid prototype that I have decided is designed completely wrong. It gives a backtrace in the host, but not the guest.</p>\n<p>Additionally, because I knew this was bogus, the capture of backtraces at every single resource use site, as well as the reporting of leaks, is unconditional on every <code>wasmtime run</code> invocation, because I knew this was a throwaway and couldn't be bothered to plumb it through properly. (Additionally the wasip1 ctx stuff in Runner makes it artificially hard.)</p>\n<p>For this deliberately faulty guest program:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">;</span>\n\n<span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">command</span><span class=\"p\">::</span><span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Example</span><span class=\"p\">);</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Example</span><span class=\"p\">;</span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">exports</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">stdout</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">stdout</span><span class=\"p\">::</span><span class=\"n\">get_stdout</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"p\">.</span><span class=\"n\">write_all</span><span class=\"p\">(</span><span class=\"s\">b\"Hello, WASI!</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"p\">.</span><span class=\"n\">flush</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">mem</span><span class=\"p\">::</span><span class=\"n\">forget</span><span class=\"p\">(</span><span class=\"n\">stdout</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>this PR prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"o\">!</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">alloc</span><span class=\"p\">::</span><span class=\"n\">boxed</span><span class=\"p\">::</span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi_io</span><span class=\"p\">::</span><span class=\"n\">streams</span><span class=\"p\">::</span><span class=\"n\">OutputStream</span><span class=\"o\">&gt;</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">allocated</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Backtrace</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::libunwind::trace\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/libunwind.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::trace_unsynchronized\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/mod.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace::Backtrace::create\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/backtrace.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::push\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi::p2::stdio::&lt;impl wasmtime_wasi::p2::bindings::async_io::wasi::cli::stdout::Host for wasmtime_wasi::cli::WasiCliCtxView&gt;::get_stdout\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi/src/p2/stdio.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi::p2::bindings::async_io::wasi::cli::stdout::add_to_linker::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi/src/p2/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">336</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::from_closure::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">689</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic/unwind_safe.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind::do_call\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">589</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"___rust_try\"</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">552</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panic::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panic.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">359</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">252</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">686</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"p\">]</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span>\n<span class=\"w\">    </span><span class=\"n\">Backtrace</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::libunwind::trace\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/libunwind.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::trace_unsynchronized\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/mod.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace::Backtrace::create\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/backtrace.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::get_any_mut\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">369</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::get_mut\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">360</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi_io::impls::&lt;impl wasmtime_wasi_io::bindings::wasi::io::streams::HostOutputStream for wasmtime::runtime::component::resource_table::ResourceTable&gt;::flush\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/impls.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;&amp;mut _T as wasmtime_wasi_io::bindings::wasi::io::streams::HostOutputStream&gt;::flush\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi_io::bindings::wasi::io::streams::add_to_linker::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::from_closure::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">689</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic/unwind_safe.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind::do_call\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">589</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"___rust_try\"</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">552</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panic::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panic.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">359</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">252</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">686</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">],</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n<p>&lt;!--<br>\n[message truncated]</p>\n</blockquote>",
        "id": 542628199,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759360420
    },
    {
        "content": "<p>pchickey edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11776\">PR #11776</a>:</p>\n<blockquote>\n<p>It would be nice to have a sanitizer that could tell guest program authors where, in the guest program, resources were constructed (or, at least, taken ownership of) and last used, for any resources that have not been dropped at the end of execution.</p>\n<p>My current opinion is, I thought this would be pretty easy, and it turns out to be somewhat difficult, and I can't prioritize getting it done right now. <em>Please respond on this PR if you want to pick up working on this.</em></p>\n<p>This is a rapid prototype that I have decided is designed completely wrong. It gives a backtrace in the host, but not the guest.</p>\n<p>There are two design problems as currently written:</p>\n<ol>\n<li>it captures a host backtrace (i.e. <code>std::backtrace::Backtrace::force_capture()</code>), not a guest backtrace. This tells you nothing about where the guest program was in its execution. <a href=\"https://docs.rs/wasmtime/latest/wasmtime/struct.WasmBacktrace.html#method.force_capture\">Wasmtime's backtrace construction </a> requires an <code>impl AsContext</code> argument, and the site at which these backtraces are captured already has a mut borrow of the AsContextMut, so we can't create a lazy way to capture backtraces</li>\n<li>if we could solve the above, we'd have to plumb it through every single bindgen trait to every single use of the ResourceTable, which is a huge pain for just a little gain</li>\n</ol>\n<p>Instead, this sanitizer probably be implemented as part of a wasmtime::vm::component::HandleTable, and the plumbing can then all stay internal to wasmtime::component's internals. It would still be nessy.</p>\n<p>Additionally, because I knew this was bogus, the capture of backtraces at every single resource use site, as well as the reporting of leaks, is unconditional on every <code>wasmtime run</code> invocation, because I knew this was a throwaway and couldn't be bothered to plumb it through properly. (Additionally the wasip1 ctx stuff in Runner makes it artificially hard.)</p>\n<p>For this deliberately faulty guest program:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">;</span>\n\n<span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">command</span><span class=\"p\">::</span><span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Example</span><span class=\"p\">);</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Example</span><span class=\"p\">;</span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">exports</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">stdout</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">stdout</span><span class=\"p\">::</span><span class=\"n\">get_stdout</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"p\">.</span><span class=\"n\">write_all</span><span class=\"p\">(</span><span class=\"s\">b\"Hello, WASI!</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"p\">.</span><span class=\"n\">flush</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">mem</span><span class=\"p\">::</span><span class=\"n\">forget</span><span class=\"p\">(</span><span class=\"n\">stdout</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>this PR prints:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"o\">!</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">alloc</span><span class=\"p\">::</span><span class=\"n\">boxed</span><span class=\"p\">::</span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi_io</span><span class=\"p\">::</span><span class=\"n\">streams</span><span class=\"p\">::</span><span class=\"n\">OutputStream</span><span class=\"o\">&gt;</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">allocated</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Backtrace</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::libunwind::trace\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/libunwind.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::trace_unsynchronized\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/mod.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace::Backtrace::create\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/backtrace.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::push\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi::p2::stdio::&lt;impl wasmtime_wasi::p2::bindings::async_io::wasi::cli::stdout::Host for wasmtime_wasi::cli::WasiCliCtxView&gt;::get_stdout\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi/src/p2/stdio.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi::p2::bindings::async_io::wasi::cli::stdout::add_to_linker::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi/src/p2/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">336</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::from_closure::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">689</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic/unwind_safe.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind::do_call\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">589</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"___rust_try\"</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">552</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panic::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panic.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">359</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">252</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">686</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"p\">]</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span>\n<span class=\"w\">    </span><span class=\"n\">Backtrace</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::libunwind::trace\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/libunwind.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::trace_unsynchronized\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/mod.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace::Backtrace::create\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/backtrace.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::get_any_mut\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">369</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::get_mut\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">360</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi_io::impls::&lt;impl wasmtime_wasi_io::bindings::wasi::io::streams::HostOutputStream for wasmtime::runtime::component::resource_table::ResourceTable&gt;::flush\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/impls.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;&amp;mut _T as wasmtime_wasi_io::bindings::wasi::io::streams::HostOutputStream&gt;::flush\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi_io::bindings::wasi::io::streams::add_to_linker::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::from_closure::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">689</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic/unwind_safe.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind::do_call\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">589</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"___rust_try\"</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwi</span>\n<span class=\"s\">[message truncated]</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 542629203,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759361075
    },
    {
        "content": "<p>pchickey edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11776\">PR #11776</a>:</p>\n<blockquote>\n<p>It would be nice to have a sanitizer that could tell guest program authors where, in the guest program, resources were constructed (or, at least, taken ownership of) and last used, for any resources that have not been dropped at the end of execution.</p>\n<p>My current opinion is, I thought this would be pretty easy, and it turns out to be somewhat difficult, and I can't prioritize getting it done right now. <em>Please respond on this PR if you want to pick up working on this.</em></p>\n<p>This is a rapid prototype that I have decided is designed completely wrong. It gives a backtrace in the host, but not the guest.</p>\n<p>There are two design problems as currently written:</p>\n<ol>\n<li>it captures a host backtrace (i.e. <code>std::backtrace::Backtrace::force_capture()</code>), not a guest backtrace. This tells you nothing about where the guest program was in its execution. <a href=\"https://docs.rs/wasmtime/latest/wasmtime/struct.WasmBacktrace.html#method.force_capture\">Wasmtime's backtrace construction </a> requires an <code>impl AsContext</code> argument, and the site at which these backtraces are captured already has a mut borrow of the AsContextMut, so we can't create a lazy way to capture backtraces</li>\n<li>if we could solve the above, we'd have to plumb it through every single bindgen trait to every single use of the ResourceTable, which is a huge pain for just a little gain</li>\n</ol>\n<p>Instead, this sanitizer probably be implemented as part of a wasmtime::vm::component::HandleTable, and the plumbing can then all stay internal to wasmtime::component's internals. It would still be messy, but not quite as messy?</p>\n<p>Additionally, because I knew this was bogus, the capture of backtraces at every single resource use site, as well as the reporting of leaks, is unconditional on every <code>wasmtime run</code> invocation, because I knew this was a throwaway and couldn't be bothered to plumb it through properly. (Additionally the wasip1 ctx stuff in Runner makes it artificially hard.)</p>\n<p>For this deliberately faulty guest program:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">;</span>\n\n<span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">command</span><span class=\"p\">::</span><span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Example</span><span class=\"p\">);</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Example</span><span class=\"p\">;</span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">exports</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">stdout</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasip2</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">stdout</span><span class=\"p\">::</span><span class=\"n\">get_stdout</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"p\">.</span><span class=\"n\">write_all</span><span class=\"p\">(</span><span class=\"s\">b\"Hello, WASI!</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"p\">.</span><span class=\"n\">flush</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">mem</span><span class=\"p\">::</span><span class=\"n\">forget</span><span class=\"p\">(</span><span class=\"n\">stdout</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>this PR prints:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Hello</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"o\">!</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">alloc</span><span class=\"p\">::</span><span class=\"n\">boxed</span><span class=\"p\">::</span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi_io</span><span class=\"p\">::</span><span class=\"n\">streams</span><span class=\"p\">::</span><span class=\"n\">OutputStream</span><span class=\"o\">&gt;</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">allocated</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Backtrace</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::libunwind::trace\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/libunwind.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::trace_unsynchronized\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/mod.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace::Backtrace::create\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/backtrace.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::push\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi::p2::stdio::&lt;impl wasmtime_wasi::p2::bindings::async_io::wasi::cli::stdout::Host for wasmtime_wasi::cli::WasiCliCtxView&gt;::get_stdout\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi/src/p2/stdio.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi::p2::bindings::async_io::wasi::cli::stdout::add_to_linker::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi/src/p2/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">336</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::from_closure::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">689</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic/unwind_safe.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind::do_call\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">589</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"___rust_try\"</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">552</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panic::catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panic.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">359</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">252</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">686</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"p\">]</span>\n<span class=\"n\">LEAK</span><span class=\"w\"> </span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span>\n<span class=\"w\">    </span><span class=\"n\">Backtrace</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::libunwind::trace\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/libunwind.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace_rs::backtrace::trace_unsynchronized\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/../../backtrace/src/backtrace/mod.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::backtrace::Backtrace::create\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/rustc/1159e78c4747b02ef996e55082b704c09b970588/library/std/src/backtrace.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::get_any_mut\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">369</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::resource_table::ResourceTable::get_mut\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/resource_table.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">360</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi_io::impls::&lt;impl wasmtime_wasi_io::bindings::wasi::io::streams::HostOutputStream for wasmtime::runtime::component::resource_table::ResourceTable&gt;::flush\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/impls.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;&amp;mut _T as wasmtime_wasi_io::bindings::wasi::io::streams::HostOutputStream&gt;::flush\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime_wasi_io::bindings::wasi::io::streams::add_to_linker::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasi-io/src/bindings.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::from_closure::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::HostFunc::entrypoint::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::component::func::host::call_host_and_handle_result::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/component/func/host.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">689</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::component::ComponentInstance::enter_host_from_wasm::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/component.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wasmtime::runtime::vm::traphandlers::catch_unwind_and_record_trap::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::result::Result&lt;T,E&gt; as wasmtime::runtime::vm::traphandlers::HostResult&gt;::maybe_catch_unwind::{{closure}}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./crates/wasmtime/src/runtime/vm/traphandlers.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"&lt;core::panic::unwind_safe::AssertUnwindSafe&lt;F&gt; as core::ops::function::FnOnce&lt;()&gt;&gt;::call_once\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic/unwind_safe.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"std::panicking::catch_unwind::do_call\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"/Users/p.hickey/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">589</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"___rust_try\"</span><span class=\"w\"> </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"st</span>\n<span class=\"s\">[message truncated]</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 542629252,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759361113
    },
    {
        "content": "<p>pchickey closed without merge <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11776\">PR #11776</a>.</p>",
        "id": 546338212,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1761086377
    }
]