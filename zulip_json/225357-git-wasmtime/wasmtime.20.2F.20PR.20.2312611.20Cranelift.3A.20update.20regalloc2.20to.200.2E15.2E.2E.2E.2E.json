[
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a> from <code>cfallin:regalloc2-upgrade-vreg-bounds</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This pulls in <a href=\"https://github.com/bytecodealliance/regalloc2/issues/257\">bytecodealliance/regalloc2#257</a> to permit more VRegs to be used in a single function body, addressing #12229 and our followup discussions about supporting function body sizes up to the Wasm implementation limit standard.</p>\n<p>In addition to the RA2 upgrade, this also includes a bit more explicit limit-checking on the Cranelift side: note that we don't directly use <code>regalloc2::VReg</code> but instead we further bitpack it into <code>Reg</code>, which is logically a sum type of <code>VReg</code>, <code>PReg</code> and <code>SpillSlot</code> (the last one needed to represent stack allocation locations on defs, e.g. on callsites with many returns). <code>PReg</code>s are packed into the beginning of the <code>VReg</code> index space but <code>SpillSlot</code>s are distinguished by stealing the upper bit of a <code>u32</code>. This was previously not a problem given the smaller <code>VReg</code> index space but now we need to check explicitly; hence <code>Reg::from_virtual_reg_checked</code> and its use in the lowering vreg allocator. Because the <code>VReg</code> index packs the class into the bottom two bits, and index into the upper 30, but we steal one bit at the top, the true limit for VReg count is thus actually 2^29, or 512M.</p>\n<p>Fixes #12229.</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 574396965,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771367197
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574396966,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771367198
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574396968,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771367198
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574396969,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771367198
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611#pullrequestreview-3816635397\">PR review</a>.</p>",
        "id": 574397874,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771367622
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611#issuecomment-3917588371\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>:</p>\n<blockquote>\n<p>The failing test (<code>code_too_large</code>) fails as expected because we now support the generated function body size. A few thoughts though:</p>\n<ul>\n<li>In theory it should be impossible to write this test once we fully hit the goal of \"compile any valid Wasm function that <code>wasmparser</code>'s implementation-limit checks pass on\";</li>\n<li>But there's still the interesting question of whether there's a \"gap\" as we sweep the code size upward where we start to throw errors;</li>\n<li>In attempting to check this by increasing the test's <code>N</code>, I found that our <code>ValueDataPacked</code> encoding gives 24 bits to value numbers, so I'm working on reclaiming some bits there. In particular the <code>Type</code> encoding seems pretty inefficient so I'll try to steal some of those bits back.</li>\n</ul>\n</blockquote>",
        "id": 574403020,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771370564
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611#issuecomment-3917603318\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>:</p>\n<blockquote>\n<p>I think that test already takes forever to compile/run in debug mode on all platforms so jettisoning that test doesn't seem unreasonable to me, and agreed it in theory should not be possible to write. Maybe it's sufficient to have a local script to run or some online corpus of \"must compile big modules\" or something like that?</p>\n<p>Either that or we could create a dedicated test job for \"compile wasmtime in release on one fast platform and compile big modules\" to make sure everything succeeds.</p>\n</blockquote>",
        "id": 574403506,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771370847
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574407947,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771373422
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574407948,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771373422
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574407950,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771373422
    },
    {
        "content": "<p>cfallin unassigned fitzgen from <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611 Cranelift: update regalloc2 to 0.15.0 to permit more VRegs.</a>.</p>",
        "id": 574407976,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771373442
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611#issuecomment-3917737837\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>:</p>\n<blockquote>\n<p>Sure thing -- I'll push the \"corpus of big inputs to test\" as followup (after #12613 lands as well); removed the <code>code_too_large</code> test here.</p>\n</blockquote>",
        "id": 574408033,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771373476
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574408039,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771373481
    },
    {
        "content": "<p>cfallin added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611 Cranelift: update regalloc2 to 0.15.0 to permit more VRegs.</a> to the merge queue</p>",
        "id": 574409112,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771374225
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611</a>.</p>",
        "id": 574412451,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771376670
    },
    {
        "content": "<p>cfallin removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12611\">PR #12611 Cranelift: update regalloc2 to 0.15.0 to permit more VRegs.</a> from the merge queue</p>",
        "id": 574412455,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1771376671
    }
]