[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a> from <code>alexcrichton:remove-async-support</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This commit is an attempt to step towards reconciling \"old async\" and<br>\n\"new async\" in Wasmtime. The old async style is the original async<br>\nsupport in Wasmtime with <code>call_async</code>, <code>func_wrap_async</code>, etc, where the<br>\nmain property is that the store is \"locked\" during an async operation.<br>\nPut another way, a store can only execute at most one async operation at<br>\na time. This is in contrast to \"new async\" support in Wasmtime with the<br>\ncomponent-model-async (WASIp3) support, where stores can have more than<br>\none async operation in flight at once.</p>\n<p>This commit does not fully reconcile these differences, but it does<br>\nremove one hurdle along the way: <code>Config::async_support</code>. Since the<br>\nbeginning of Wasmtime this configuration knob has existed to explicitly<br>\ndemarcate a config/engine/store as \"this thing requires <code>async</code> stuff<br>\ninternally.\" This has started to make less and less sense over time<br>\nwhere the line between sync and async has become more murky with WASIp3<br>\nwhere the two worlds comingle. The goal of this commit is to deprecate<br>\n<code>Config::async_support</code> and make the function not actually do anything.</p>\n<p>In isolation this can't simply be done, however, because there are many<br>\nload-bearing aspects of Wasmtime that rely on this <code>async_support</code> knob.<br>\nFor example once epochs + yielding are enabled it's required that all<br>\nWasm is executed on a fiber lest it hit an epoch and not know how to<br>\nyield. That means that this commit is not a simple removal of<br>\n<code>async_support</code> but instead a refactoring/rearchitecting of how async is<br>\nused internally within Wasmtime. The high-level ideas within Wasmtime<br>\nnow are:</p>\n<ul>\n<li>A <code>Store</code> has a \"requires async\" boolean stored within it.</li>\n<li>\n<p>All configuration options which end up requiring async, such as<br>\n  yielding with epochs, turn this boolean on.</p>\n</li>\n<li>\n<p>Creation of host functions which use async<br>\n  (e.g. <code>func_wrap_{async,concurrent}</code>) will also turn this option on.</p>\n</li>\n<li>\n<p>Synchronous API entrypoints into Wasmtime ensure that this boolean is<br>\n  disabled.</p>\n</li>\n<li>\n<p>Asynchronous APIs are usable at any time.</p>\n</li>\n</ul>\n<p>This means that the concept of an async store vs a sync store is now<br>\ngone. All stores are equally capable of executing sync/async, and the<br>\nchange now is that dynamically some stores will require that async is<br>\nused with certain configuration. Additionally all panicking conditions<br>\naround <code>async_support</code> have been converted to errors instead. All<br>\nrelevant APIs already returned an error and things are murky enough now<br>\nthat it's not necessarily trivial to get this right at the embedder<br>\nlevel. In the interest of avoiding panics all detected async mismatches<br>\nare now first-class <code>wasmtime::Error</code> values.</p>\n<p>The end result of this commit is that <code>Config::async_support</code> is a<br>\ndeprecated <code>#[doc(hidden)]</code> function that does nothing. While many<br>\ninternal changes happened as well as having new tests for all this sort<br>\nof behavior this is not expected to have a great impact on external<br>\nconsumers. In general a deletion of <code>async_support(true)</code> is in theory<br>\nall that's required. This is intended to make it easier to think about<br>\nasync/sync/etc in the future with WASIp3 and eventually reconcile<br>\n<code>func_wrap_async</code> and <code>func_wrap_concurrent</code> for example. That's left<br>\nfor future refactorings however.</p>\n</blockquote>",
        "id": 568871853,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768851179
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#issuecomment-3769825200\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>:</p>\n<blockquote>\n<p>This is currently built on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12366\">https://github.com/bytecodealliance/wasmtime/pull/12366</a>, so draft for now.</p>\n<p>One other motivation for this I'm now remembering too -- I find it a bit odd that one of the more common ways of using Wasmtime, with async, requires explicit opt-in. This makes Wasmtime work \"by default\" in more situations and is a nice small win for that too.</p>\n</blockquote>",
        "id": 568872078,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768851240
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568873346,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768851583
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568874677,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768851959
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568877616,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768852793
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568887609,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768855409
    },
    {
        "content": "<p>github-actions[bot] added the label <code>fuzzing</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568901418,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768859168
    },
    {
        "content": "<p>github-actions[bot] added the label <code>wasmtime:c-api</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568901419,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768859169
    },
    {
        "content": "<p>github-actions[bot] added the label <code>wasi</code> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 568901420,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768859169
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#issuecomment-3770224529\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"fuzzing\", \"wasi\", \"wasmtime:c-api\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>fitzgen: fuzzing</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 568901545,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768859203
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569289101,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010433
    },
    {
        "content": "<p><strong>alexcrichton</strong> has marked <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a> as ready for review.</p>",
        "id": 569289109,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010434
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569289116,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010436
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers\">wasmtime-fuzz-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569289117,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010436
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569289118,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010436
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers\">wasmtime-wasi-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569289119,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010436
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569289121,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769010437
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#pullrequestreview-3688903277\">PR review</a>:</p>\n<blockquote>\n<p>Only looked at the second commit b/c I think the first is part of a different PR, right?</p>\n<p>LGTM, just a nitpick and a question below.</p>\n</blockquote>",
        "id": 569336514,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769023214
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#discussion_r2713960053\">PR review comment</a>:</p>\n<blockquote>\n<p>Other functions in this commit have <code>requires_async: bool</code> -- can they switch to using <code>Asyncness</code> as well?</p>\n</blockquote>",
        "id": 569336515,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769023214
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#discussion_r2713929906\">PR review comment</a>:</p>\n<blockquote>\n<p>Does this need to be an <code>unsafe</code> function now? What is the worst that can happen if a caller passes <code>requires_async = false</code> when <code>F</code> actually does need to be async? Will that result in safe panics on <code>block_on</code>/<code>with_blocking</code>?</p>\n</blockquote>",
        "id": 569336516,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769023214
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#pullrequestreview-3694150420\">PR review</a>.</p>",
        "id": 569571505,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769109603
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#discussion_r2718275257\">PR review comment</a>:</p>\n<blockquote>\n<p>Good point yeah, I'll document that. Should be safe panicking though, so no new <code>unsafe</code> needed</p>\n</blockquote>",
        "id": 569571508,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769109603
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#pullrequestreview-3694151471\">PR review</a>.</p>",
        "id": 569571538,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769109611
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371#discussion_r2718276096\">PR review comment</a>:</p>\n<blockquote>\n<p>Good point, I like that!</p>\n</blockquote>",
        "id": 569571541,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769109612
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569600643,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769121029
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569624153,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769135053
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569624185,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769135083
    },
    {
        "content": "<p>alexcrichton added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371 Remove need for explicit <code>Config::async_support</code> knob </a> to the merge queue.</p>",
        "id": 569625923,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769136407
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371</a>.</p>",
        "id": 569627633,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769137784
    },
    {
        "content": "<p>alexcrichton removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12371\">PR #12371 Remove need for explicit <code>Config::async_support</code> knob </a> from the merge queue.</p>",
        "id": 569627635,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769137786
    }
]