[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a> from <code>alexcrichton:remove-send-bound-from-async-stuff</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This commit removes the need for <code>Send</code> for all usages of fiber-related<br>\nbits. The goal is that the future returned from <code>async</code> functions is<br>\n<code>Send</code> if all the inputs are <code>Send</code>, but there's no actual need to<br>\nrequire that in the function signatures themselves. This property was<br>\nidentified in upcoming work to make more internals of Wasmtime <code>async</code><br>\nwhere <code>async</code> functions are going to be used to implement the<br>\nsynchronous path through Wasmtime where <code>Send</code> isn't a bound today, nor<br>\nideally do we want to have it there.</p>\n<p>The way this commit works is:</p>\n<ul>\n<li>\n<p>First <code>make_fiber</code> now has a <code>Send</code> bound which makes it sound. Before<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/pull/11444\">https://github.com/bytecodealliance/wasmtime/pull/11444</a> it took <code>&amp;mut dyn VMStore</code> which is never <code>Send</code> and the<br>\n  refactoring there missed adding this bound. This change required a few<br>\n<code>Send</code> bounds in <code>concurrent.rs</code> where it's expected to have no<br>\n  impact as everything there is basically already <code>Send</code>.</p>\n</li>\n<li>\n<p>Next <code>make_fiber_unchecked</code> is added which is the same as <code>make_fiber</code><br>\n  except without a <code>Send</code> bound. The <code>on_fiber</code> function is then updated<br>\n  to use this <code>*_unchecked</code> variant. This means that fibers can now be<br>\n  used with non-<code>Send</code> stores. Crucially though the structure of<br>\n  internals in play means that future produced is still only <code>Send</code> if<br>\n<code>T: Send</code> meaning that there is no loss in safety.</p>\n</li>\n<li>\n<p>Next some <code>Send</code> bounds were dropped throughout async functions in<br>\n  Wasmtime as a proof-of-concept to require these changes to <code>on_fiber</code>.<br>\n  This means that these entrypoints into Wasmtime no longer require<br>\n<code>Send</code>, but still naturally require <code>Send</code> if the result future is<br>\n  sent to various threads.</p>\n</li>\n<li>\n<p>Finally a new doctest is added to <code>Instance::new_async</code> with a<br>\n<code>compile_fail</code> example to ensure that this fails. This is<br>\n  unfortunately a very brittle test because all we can assert is that<br>\n  compilation failed, not why compilation failed. That means that this<br>\n  is likely to regress over time, but it's the best we can do at this<br>\n  time.</p>\n</li>\n</ul>\n<p>Note that the goal here is NOT to remove <code>Send</code> bounds throughout<br>\nWasmtime. Many of them are still required, for example all the ones<br>\nrelated to <code>Linker</code>. The realization is that we can remove some of the<br>\n\"edge\" bounds on entrypoints where the resulting future can be<br>\nconditionally <code>Send</code> depending on <code>T</code> meaning we don't actually have to<br>\nwrite down any bounds ourselves.</p>\n<p>This refactoring will enable future refactorings to have sync-and-async<br>\nfunctions use the same internals and neither entrypoint needs to have a<br>\n<code>Send</code> bound.</p>\n</blockquote>",
        "id": 535016347,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755548369
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/pchickey\">pchickey</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535016348,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755548369
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535016349,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755548369
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#issuecomment-3198300115\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>:</p>\n<blockquote>\n<p>Procedurally this is built on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11444\">https://github.com/bytecodealliance/wasmtime/pull/11444</a> and <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11453\">https://github.com/bytecodealliance/wasmtime/pull/11453</a>. The goal is to work towards <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11430\">https://github.com/bytecodealliance/wasmtime/pull/11430</a></p>\n</blockquote>",
        "id": 535016397,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755548404
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535016470,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755548443
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535023241,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755551972
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#issuecomment-3198460185\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>:</p>\n<blockquote>\n<p>I can review this once it is rebased, now that the things it was based on top of are approved (and presumably will land shortly)</p>\n</blockquote>",
        "id": 535023287,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755551998
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535030484,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755557217
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#issuecomment-3198643102\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>:</p>\n<blockquote>\n<p>I've rebased on the merge commit of <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11444\">https://github.com/bytecodealliance/wasmtime/pull/11444</a> since I need to head out soon, but if/when that PR merges github won't actually remove the commit from this PR, I think I'll have to open/close it or something like that (it's weird)</p>\n</blockquote>",
        "id": 535030529,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755557255
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#pullrequestreview-3130187470\">PR review</a>.</p>",
        "id": 535030923,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755557577
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#discussion_r2283662465\">PR review comment</a>:</p>\n<blockquote>\n<p>Maybe add a comment here that <code>Rc</code> is not <code>Send</code>, just to make it a little easier to follow the example. Alternatively, below say \"Store&lt;Rc&lt;()&gt;&gt; is not Send because Rc&lt;()&gt; is not Send\" or something.</p>\n</blockquote>",
        "id": 535030924,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755557578
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#discussion_r2283663753\">PR review comment</a>:</p>\n<blockquote>\n<p>?</p>\n</blockquote>",
        "id": 535030925,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755557578
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#pullrequestreview-3130223384\">PR review</a>.</p>",
        "id": 535033438,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755559267
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#discussion_r2283690599\">PR review comment</a>:</p>\n<blockquote>\n<p>what</p>\n<p>(Forgot to delete after testing)</p>\n</blockquote>",
        "id": 535033439,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755559267
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454#issuecomment-3198990991\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"wasmtime:api\", \"wasmtime:ref-types\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>fitzgen: wasmtime:ref-types</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 535045236,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755569944
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535056018,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755580135
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535056034,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755580150
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535056065,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755580182
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11454\">PR #11454</a>.</p>",
        "id": 535058218,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755582225
    }
]