[
    {
        "content": "<p>saulecabrera opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">issue #12475</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>With the latest Wasmtime <code>dev</code> version, the following test:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_wrong_address_family</span><span class=\"p\">(</span><span class=\"n\">family</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">IpAddressFamily</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">sock</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">UdpSocket</span><span class=\"p\">::</span><span class=\"n\">create</span><span class=\"p\">(</span><span class=\"n\">family</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">addr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">family</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv4</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">IpSocketAddress</span><span class=\"p\">::</span><span class=\"n\">localhost</span><span class=\"p\">(</span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n<span class=\"w\">        </span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv6</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">IpSocketAddress</span><span class=\"p\">::</span><span class=\"n\">localhost</span><span class=\"p\">(</span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n<span class=\"w\">    </span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sock</span><span class=\"p\">.</span><span class=\"n\">send</span><span class=\"p\">(</span><span class=\"fm\">vec!</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">)).</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"fm\">assert!</span><span class=\"p\">(</span><span class=\"fm\">matches!</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">ErrorCode</span><span class=\"p\">::</span><span class=\"n\">InvalidArgument</span><span class=\"p\">)));</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Passes on <a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324550988?pr=209#step:10:119\">macOS</a>, but fails on <a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551033?pr=209#step:10:115\">Ubuntu</a>/<a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551054?pr=209#step:10:1305\">Windows</a>. </p>\n<p>According to the spec: <code>invalid-argument</code> should be returned if the <code>remote-address</code> has the wrong address family. (EAFNOSUPPORT)<br>\n</p>\n</blockquote>",
        "id": 570906523,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769725188
    },
    {
        "content": "<p><a href=\"https://github.com/saulecabrera\">saulecabrera</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">Issue #12475</a>.</p>",
        "id": 570906524,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769725188
    },
    {
        "content": "<p><a href=\"https://github.com/saulecabrera\">saulecabrera</a> added the wasi label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">Issue #12475</a>.</p>",
        "id": 570906525,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769725188
    },
    {
        "content": "<p>saulecabrera edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">issue #12475</a>:</p>\n<blockquote>\n<p>With the latest Wasmtime <code>dev</code> version, the following test:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_wrong_address_family</span><span class=\"p\">(</span><span class=\"n\">family</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">IpAddressFamily</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">sock</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">UdpSocket</span><span class=\"p\">::</span><span class=\"n\">create</span><span class=\"p\">(</span><span class=\"n\">family</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">addr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">family</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv4</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">IpSocketAddress</span><span class=\"p\">::</span><span class=\"n\">localhost</span><span class=\"p\">(</span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n<span class=\"w\">        </span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv6</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">IpSocketAddress</span><span class=\"p\">::</span><span class=\"n\">localhost</span><span class=\"p\">(</span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n<span class=\"w\">    </span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sock</span><span class=\"p\">.</span><span class=\"n\">send</span><span class=\"p\">(</span><span class=\"fm\">vec!</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">)).</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"fm\">assert!</span><span class=\"p\">(</span><span class=\"fm\">matches!</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">ErrorCode</span><span class=\"p\">::</span><span class=\"n\">InvalidArgument</span><span class=\"p\">)));</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Passes on <a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324550988?pr=209#step:10:119\">macOS</a>, but fails on <a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551033?pr=209#step:10:115\">Ubuntu</a>/<a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551054?pr=209#step:10:1305\">Windows</a>. </p>\n<p>According to the spec: <code>invalid-argument</code> should be returned if the <code>remote-address</code> has the wrong address family. (EAFNOSUPPORT)<br>\n</p>\n</blockquote>",
        "id": 570906568,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769725202
    },
    {
        "content": "<p>saulecabrera <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475#issuecomment-3820785840\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">issue #12475</a>:</p>\n<blockquote>\n<p>For completeness, this is the error on Ubuntu:</p>\n<p><div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"o\">[</span>src/bin/sockets-udp-send.rs:21:5<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"p\">&amp;</span><span class=\"nv\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>Err<span class=\"o\">(</span>\n<span class=\"w\">    </span>ErrorCode<span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span>code:<span class=\"w\"> </span><span class=\"m\">2</span>,\n<span class=\"w\">        </span>name:<span class=\"w\"> </span><span class=\"s2\">\"not-supported\"</span>,\n<span class=\"w\">        </span>message:<span class=\"w\"> </span><span class=\"s2\">\"The operation is not supported.\\n\\n          POSIX equivalent: EOPNOTSUPP\"</span>,\n<span class=\"w\">    </span><span class=\"o\">}</span>,\n<span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 570908940,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769726303
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475#issuecomment-3825339761\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">issue #12475</a>:</p>\n<blockquote>\n<p>Should this perhaps be a case where the spec is changed to allow more error codes for this situation? I never quite know how to best thread the needle but translating a native <code>EAFNOSUPPORT</code> to <code>not-supported</code> here doesn't seem entirely unreasonable to me</p>\n</blockquote>",
        "id": 571107932,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769801085
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475#issuecomment-3825401198\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12475\">issue #12475</a>:</p>\n<blockquote>\n<p>I believe on macOS an ipv6 socket can actually connect to ipv4 addresses (and by default listening on an ipv6 socket will also listen on ipv4) The IPV6_V6ONLY option disables this behavior.</p>\n</blockquote>",
        "id": 571110226,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1769801897
    }
]