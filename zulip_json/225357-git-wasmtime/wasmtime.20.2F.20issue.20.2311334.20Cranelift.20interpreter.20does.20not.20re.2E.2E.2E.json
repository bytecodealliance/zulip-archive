[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11334\">issue #11334</a>:</p>\n<blockquote>\n<p>This test:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">interpret</span>\n<span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">enable_nan_canonicalization</span><span class=\"o\">=</span><span class=\"kc\">true</span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"kt\">f32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">f32</span><span class=\"w\"> </span><span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">f32</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"nc\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">floor</span><span class=\"w\"> </span><span class=\"n\">v0</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n<span class=\"p\">}</span>\n\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">sNaN</span><span class=\"p\">:</span><span class=\"mh\">0x2f20ff</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">sNaN</span><span class=\"p\">:</span><span class=\"mh\">0x2f20ff</span>\n</code></pre></div>\n<p>\"passes\" in the interpreter but \"fails\" on native. Native produces the result <code>+NaN</code> which is the correct result of this function due to the <code>enable_nan_canonicalization</code> flag being enabled.</p>\n<p>Currently the interpreter, neither with <code>test interpret</code> nor during fuzzing, does not respect NaN canonicalization meaning it's producing false positives in differential fuzzing.</p>\n</blockquote>",
        "id": 531429524,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1753726176
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the fuzz-bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11334\">Issue #11334</a>.</p>",
        "id": 531429525,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1753726177
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the cranelift:area:interpreter label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11334\">Issue #11334</a>.</p>",
        "id": 531429526,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1753726177
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11334#issuecomment-3128465842\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11334\">issue #11334</a>:</p>\n<blockquote>\n<p>Nan canonicalization is done by <code>Context::optimize</code>. The interpret clif-tools command doesn't run <code>Context::optimize</code> before interpreting the function: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/ae25a92f49154d4d1f4109d09db03b95d3fd778c/cranelift/src/interpret.rs#L117\">https://github.com/bytecodealliance/wasmtime/blob/ae25a92f49154d4d1f4109d09db03b95d3fd778c/cranelift/src/interpret.rs#L117</a> Legalizations won't run because of this either.</p>\n</blockquote>",
        "id": 531432646,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1753727292
    }
]