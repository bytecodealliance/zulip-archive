[
    {
        "content": "<p><strong>dicej</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568044865,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768412348
    },
    {
        "content": "<p><strong>dicej</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568044869,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768412350
    },
    {
        "content": "<p>dicej opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a> from <code>dicej:reentrance-refactor-part1</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This commit makes a few changes related to recursive reentrance checks, instance poisoning, etc.:</p>\n<ul>\n<li>Implements the more restrictive lift/lower rules described in <a href=\"https://github.com/WebAssembly/component-model/pull/589\">https://github.com/WebAssembly/component-model/pull/589</a> such that a component instance may not lower a function lifted by one of its ancestors, nor vice-versa.  Any such lower will result in a fused adapter which traps unconditionally, preventing guest-to-guest recursive reentrance without requiring data flow analysis.<br>\n    - Note that this required updating several WAST tests which were violating the new rule, including some in the <code>tests/component-model</code> Git submodule, which I've updated.<br>\n    - This is handled entirely in the <code>fact</code> module now; I've removed the <code>AlwaysTrap</code> case previously handled by <code>wasmtime-cranelift</code>.</li>\n<li>Removes <code>FLAG_MAY_ENTER</code> from <code>InstanceFlags</code>.  It is no longer needed for guest-to-guest calls due to the above, and for guest-to-host-to-guest calls we can rely on either <code>FLAG_NEEDS_POST_RETURN</code> for sync-lifted functions or the <code>GuestTask</code> call stack for async-lifted functions.</li>\n<li>Adds a <code>StoreOpaque::trapped</code> field which is set when _any_ instance belonging to that store traps, at which point the entire store is considered poisoned, meaning no instance belonging to it may be entered.  This prevents indeterminant concurrent task state left over from the trapping instance from leaking into other instances.</li>\n</ul>\n<p>Note that this does _not_ include code to push and pop <code>GuestTask</code> instances for guest-to-guest sync-to-sync calls, nor for host-to-guest calls using e.g. the synchronous <code>Func::call</code> API, so certain intrinsics which expect a <code>GuestTask</code> to be present such as <code>backpressure.inc</code> will still fail in such cases.  I'll address that in a later PR.</p>\n<p>Also note that I made a small change to <code>wasmtime-wit-bindgen</code>, adding a <code>Send</code> bound on the <code>T</code> type parameter for <code>store | async</code> functions.  This allowed me to recursively call <code>{Typed}Func::call_concurrent</code> from inside a host function, and it doesn't have any downsides AFAICT.</p>\n<p>Fixes #12128</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 568044872,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768412350
    },
    {
        "content": "<p><strong>dicej</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568044873,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768412350
    },
    {
        "content": "<p>dicej updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568052979,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768414929
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#pullrequestreview-3662282839\">PR review</a>:</p>\n<blockquote>\n<p>Minor comments here and there, but overall looks great, thanks!</p>\n</blockquote>",
        "id": 568060551,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417677
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691649481\">PR review comment</a>:</p>\n<blockquote>\n<p>stray refactoring leftover?</p>\n</blockquote>",
        "id": 568060553,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417677
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691663686\">PR review comment</a>:</p>\n<blockquote>\n<p>To confirm, this is a debugging/testing artifact and not a required part of this change?</p>\n</blockquote>",
        "id": 568060554,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417677
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691672976\">PR review comment</a>:</p>\n<blockquote>\n<p>You can avoid <code>StoreComponentInstanceId::new(...).get(...)</code> here by calling <code>self.component_instance(instance.instance)</code> directly I think</p>\n</blockquote>",
        "id": 568060555,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417678
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691689217\">PR review comment</a>:</p>\n<blockquote>\n<p>I'm surprised that existing trait implementations don't need to update with this, but I suspect that's because if the trait requires more things and then your impl requires less it's sort of a subtype relation and allowed.</p>\n</blockquote>",
        "id": 568060556,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417678
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691685747\">PR review comment</a>:</p>\n<blockquote>\n<p>Given the destructor-ish nature of <code>previous_runtime_state</code> and the mild confusion with a closure, could this be inverted as, after <code>catch_traps</code>, an <code>if result.is_err() { store.0.set_trapped(); }</code>?</p>\n</blockquote>",
        "id": 568060557,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417678
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691654925\">PR review comment</a>:</p>\n<blockquote>\n<p>To avoid <code>#[cfg]</code> here, how about putting this in <code>ComponentStoreData</code> and defining the methods in that file as well? Also helps to clarify that this is purely scoped to components, not applicable to core wasm.</p>\n</blockquote>",
        "id": 568060558,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768417678
    },
    {
        "content": "<p>dicej submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#pullrequestreview-3662381695\">PR review</a>.</p>",
        "id": 568062938,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418473
    },
    {
        "content": "<p>dicej created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691733166\">PR review comment</a>:</p>\n<blockquote>\n<p>It allows me to propagate the trap in the <code>async_round_trip_synchronous_recurse</code> tests.  I.e. it's a change needed by a tests added to cover certain host-to-guest-to-host scenarios addressed by this PR.</p>\n</blockquote>",
        "id": 568062940,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418474
    },
    {
        "content": "<p>dicej updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568062985,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418492
    },
    {
        "content": "<p>dicej created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691737163\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, that's my understanding.</p>\n</blockquote>",
        "id": 568063166,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418557
    },
    {
        "content": "<p>dicej submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#pullrequestreview-3662385983\">PR review</a>.</p>",
        "id": 568063167,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418557
    },
    {
        "content": "<p>dicej submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#pullrequestreview-3662392712\">PR review</a>.</p>",
        "id": 568063484,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418678
    },
    {
        "content": "<p>dicej created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691742923\">PR review comment</a>:</p>\n<blockquote>\n<p>This is a result of moving <code>RuntimeInstance</code> to a different module.</p>\n</blockquote>",
        "id": 568063485,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418678
    },
    {
        "content": "<p>dicej edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349#discussion_r2691742923\">PR review comment</a>.</p>",
        "id": 568063592,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768418725
    },
    {
        "content": "<p>dicej updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568073028,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768422110
    },
    {
        "content": "<p>dicej has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568073994,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768422427
    },
    {
        "content": "<p>dicej updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568074224,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768422504
    },
    {
        "content": "<p>dicej added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349 refactor recursive reentrance checks</a> to the merge queue.</p>",
        "id": 568076468,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768423340
    },
    {
        "content": "<p>github-merge-queue[bot] removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349 refactor recursive reentrance checks</a> from the merge queue.</p>",
        "id": 568080067,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768424685
    },
    {
        "content": "<p>dicej updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568087675,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768427968
    },
    {
        "content": "<p>dicej has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568087714,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768427992
    },
    {
        "content": "<p>dicej updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568089474,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768428721
    },
    {
        "content": "<p>dicej added <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349 refactor recursive reentrance checks</a> to the merge queue.</p>",
        "id": 568091743,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768429671
    },
    {
        "content": "<p>dicej merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349</a>.</p>",
        "id": 568094572,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768431112
    },
    {
        "content": "<p>dicej removed <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12349\">PR #12349 refactor recursive reentrance checks</a> from the merge queue.</p>",
        "id": 568094573,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768431112
    }
]