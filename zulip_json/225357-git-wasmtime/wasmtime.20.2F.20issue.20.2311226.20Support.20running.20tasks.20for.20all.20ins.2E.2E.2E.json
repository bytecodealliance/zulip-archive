[
    {
        "content": "<p>dicej opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>Currently, if you have a <code>Store</code> with multiple component instances, you can only run an event loop (via e.g. <code>Instance::run</code>) for one of those instances at a time.  We'd like to remove that restriction and allow all the instances to make progress concurrently.</p>\n<p>Note that this will require moving some or all of <code>ConcurrentState</code> out of <code>ComponentInstance</code> and into <code>Store</code>.  In fact, <code>ConcurrentState</code> originally _did_ live in <code>Store</code>; I moved it to <code>ComponentInstance</code> when I discovered that <code>wasmtime-wast</code> reuses the same store to run multiple instances, which caused issues when one of those instances trapped with unfinished tasks still pending and subsequent instances tried to resume those tasks.  If we move that state back into <code>Store</code>, we'll need to take care to avoid such cross-talk (whether due to serial or concurrent use of instances within a single store) by immediately purging any tasks and associated state belonging to a trapped instance.</p>\n</blockquote>",
        "id": 528405705,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1752267639
    },
    {
        "content": "<p><a href=\"https://github.com/dicej\">dicej</a> added the wasm-proposal:component-model-async label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">Issue #11226</a>.</p>",
        "id": 528405706,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1752267639
    },
    {
        "content": "<p>dicej edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>Currently, if you have a <code>Store</code> with multiple component instances, you can only run an event loop (via e.g. <code>Instance::run</code>) for one of those instances at a time.  We'd like to remove that restriction and allow all the instances to make progress concurrently.</p>\n<p>Note that this will require moving some or all of <code>ConcurrentState</code> out of <code>ComponentInstance</code> and into <code>Store</code>.  In fact, <code>ConcurrentState</code> originally _did_ live in <code>Store</code>; I moved it to <code>ComponentInstance</code> when I discovered that <code>wasmtime-wast</code> reuses the same store to run multiple instances, which caused issues when one of those instances trapped with unfinished tasks still pending and subsequent instances tried to resume those tasks.  If we move that state back into <code>Store</code>, we'll need to take care to avoid such cross-talk (whether due to serial or concurrent use of instances within a single store) by immediately purging any tasks and associated state belonging to a trapped instance.</p>\n<p>This change should additionally allow us to move methods like <code>Instance::{stream,future}</code> to <code>Store[ContextMut]</code> since streams and futures would no longer be instance-specific.  That, in turn, should allow us to remove the <code>Access[or]::instance</code> methods since e.g. host functions would no longer need access to the specific instance they're being called from.</p>\n</blockquote>",
        "id": 528406033,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1752267824
    },
    {
        "content": "<p>dicej edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>Currently, if you have a <code>Store</code> with multiple component instances, you can only run an event loop (via e.g. <code>Instance::run</code>) for one of those instances at a time.  We'd like to remove that restriction and allow all the instances to make progress concurrently.</p>\n<p>Note that this might require moving some or all of <code>ConcurrentState</code> out of <code>ComponentInstance</code> and into <code>Store</code>.  In fact, <code>ConcurrentState</code> originally _did_ live in <code>Store</code>; I moved it to <code>ComponentInstance</code> when I discovered that <code>wasmtime-wast</code> reuses the same store to run multiple instances, which caused issues when one of those instances trapped with unfinished tasks still pending and subsequent instances tried to resume those tasks.  If we move that state back into <code>Store</code>, we'll need to take care to avoid such cross-talk (whether due to serial or concurrent use of instances within a single store) by immediately purging any tasks and associated state belonging to a trapped instance.</p>\n<p>This change should additionally allow us to move methods like <code>Instance::{stream,future}</code> to <code>Store[ContextMut]</code> since streams and futures would no longer be instance-specific.  That, in turn, should allow us to remove the <code>Access[or]::instance</code> methods since e.g. host functions would no longer need access to the specific instance they're being called from.</p>\n</blockquote>",
        "id": 528408082,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1752269039
    },
    {
        "content": "<p>dicej edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>Currently, if you have a <code>Store</code> with multiple component instances, you can only run an event loop (via e.g. <code>Instance::run</code>) for one of those instances at a time.  We'd like to remove that restriction and allow all the instances to make progress concurrently.</p>\n<p>Note that this will require moving some or all of <code>ConcurrentState</code> out of <code>ComponentInstance</code> and into <code>Store</code>.  In fact, <code>ConcurrentState</code> originally _did_ live in <code>Store</code>; I moved it to <code>ComponentInstance</code> when I discovered that <code>wasmtime-wast</code> reuses the same store to run multiple instances, which caused issues when one of those instances trapped with unfinished tasks still pending and subsequent instances tried to resume those tasks.  If we move that state back into <code>Store</code>, we'll need to take care to avoid such cross-talk (whether due to serial or concurrent use of instances within a single store) by immediately purging any tasks and associated state belonging to a trapped instance.</p>\n<p>This change should additionally allow us to move methods like <code>Instance::{stream,future}</code> to <code>Store[ContextMut]</code> since streams and futures would no longer be instance-specific.  That, in turn, should allow us to remove the <code>Access[or]::instance</code> methods since e.g. host functions would no longer need access to the specific instance they're being called from.</p>\n</blockquote>",
        "id": 528408147,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1752269069
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226#issuecomment-3250200805\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>@dicej and I talked about this today and we mostly concluded this is a bit more nuanced than originally anticipated. Our current thinking is:</p>\n<ul>\n<li>We'll move everything to the <code>Store</code></li>\n<li>We'll update <code>wasmtime-wast</code> to make a store-per-component-instance.</li>\n</ul>\n<p>The basic conclusion we reached is that the main benefit of today's design is that we can conceptually throw away the entirety of all async state when a trap happens. While we don't proactively currently do that all embeddings morally do that and we could in theory start doing it within Wasmtime. Simply applying what this issue says makes this quite complicated because we'd have to either (a) keep concurrent state for all instances separate or (b) keep track of which parts of state in the store map to one instance. Our conclusion was that this probably isn't worth it and we probably want to elevate the \"throw the instance state away\" to \"throw the whole store away\". </p>\n<p>This requires updating <code>wasmtime-wast</code> though which reuses a store across trapping instances. And this also touches on more component-model level things which we want to discuss with others as well. More updates after meetings next week...</p>\n</blockquote>",
        "id": 537527608,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756921797
    },
    {
        "content": "<p>alexcrichton assigned alexcrichton to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>.</p>",
        "id": 538310969,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757363788
    },
    {
        "content": "<p>alexcrichton assigned dicej to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>.</p>",
        "id": 538310970,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757363788
    },
    {
        "content": "<p>dicej edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>Currently, if you have a <code>Store</code> with multiple component instances, you can only run an event loop (via e.g. <code>Instance::run_concurrent</code>) for one of those instances at a time.  We'd like to remove that restriction and allow all the instances to make progress concurrently.</p>\n<p>Note that this will require moving some or all of <code>ConcurrentState</code> out of <code>ComponentInstance</code> and into <code>Store</code>.  In fact, <code>ConcurrentState</code> originally _did_ live in <code>Store</code>; I moved it to <code>ComponentInstance</code> when I discovered that <code>wasmtime-wast</code> reuses the same store to run multiple instances, which caused issues when one of those instances trapped with unfinished tasks still pending and subsequent instances tried to resume those tasks.  If we move that state back into <code>Store</code>, we'll need to take care to avoid such cross-talk (whether due to serial or concurrent use of instances within a single store) by immediately purging any tasks and associated state belonging to a trapped instance.</p>\n<p>This change should additionally allow us to move methods like <code>Instance::{stream,future}</code> to <code>Store[ContextMut]</code> since streams and futures would no longer be instance-specific.  That, in turn, should allow us to remove the <code>Access[or]::instance</code> methods since e.g. host functions would no longer need access to the specific instance they're being called from.</p>\n</blockquote>",
        "id": 542313435,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759247769
    },
    {
        "content": "<p>dicej closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11226\">issue #11226</a>:</p>\n<blockquote>\n<p>Currently, if you have a <code>Store</code> with multiple component instances, you can only run an event loop (via e.g. <code>Instance::run_concurrent</code>) for one of those instances at a time.  We'd like to remove that restriction and allow all the instances to make progress concurrently.</p>\n<p>Note that this will require moving some or all of <code>ConcurrentState</code> out of <code>ComponentInstance</code> and into <code>Store</code>.  In fact, <code>ConcurrentState</code> originally _did_ live in <code>Store</code>; I moved it to <code>ComponentInstance</code> when I discovered that <code>wasmtime-wast</code> reuses the same store to run multiple instances, which caused issues when one of those instances trapped with unfinished tasks still pending and subsequent instances tried to resume those tasks.  If we move that state back into <code>Store</code>, we'll need to take care to avoid such cross-talk (whether due to serial or concurrent use of instances within a single store) by immediately purging any tasks and associated state belonging to a trapped instance.</p>\n<p>This change should additionally allow us to move methods like <code>Instance::{stream,future}</code> to <code>Store[ContextMut]</code> since streams and futures would no longer be instance-specific.  That, in turn, should allow us to remove the <code>Access[or]::instance</code> methods since e.g. host functions would no longer need access to the specific instance they're being called from.</p>\n</blockquote>",
        "id": 543400900,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759781770
    }
]