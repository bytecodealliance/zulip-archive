[
    {
        "content": "<p>MangoPeachGrape opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a> from <code>MangoPeachGrape:c-api/wasi/custom-callbacks</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>Fixes #11963</p>\n<p>I'm quite unsure on some things. I split the implementation out between the wasi and c-api crates, because I would've needed to add some dependencies into c-api crate to implement the required traits, not sure what's better?</p>\n<p>Also, I don't particularly like the <code>Arc&lt;Mutex&gt;</code>, but I guess it's required for the async version?</p>\n<p>Also also, <code>const void*</code> vs <code>const unsigned char*</code> for the buffer? (<a href=\"https://github.com/bytecodealliance/wasmtime/issues/11963#issuecomment-3476575567\">https://github.com/bytecodealliance/wasmtime/issues/11963#issuecomment-3476575567</a>)</p>\n</blockquote>",
        "id": 548335401,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762027926
    },
    {
        "content": "<p><strong>MangoPeachGrape</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers\">wasmtime-wasi-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 548335402,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762027926
    },
    {
        "content": "<p><strong>MangoPeachGrape</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 548335403,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762027926
    },
    {
        "content": "<p><strong>MangoPeachGrape</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 548335404,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762027926
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3407816977\">PR review</a>:</p>\n<blockquote>\n<p>Thanks! Mind adding a test for this too?</p>\n</blockquote>",
        "id": 553196819,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762037758
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2483985984\">PR review comment</a>:</p>\n<blockquote>\n<p>We've probably got 1-too-many traits already in the wasmtime-wasi crate, so mind moving this directly into the c-api crate? It should be fine to implement pollable/outputstream/asyncwrite directly on the c-api types and avoid the trait indirection here (should avoid arc/mutex as well I think)</p>\n</blockquote>",
        "id": 553196820,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762037758
    },
    {
        "content": "<p><strong>MangoPeachGrape</strong> requested <a href=\"https://github.com/pchickey\">pchickey</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553245609,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762090475
    },
    {
        "content": "<p><strong>MangoPeachGrape</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553245610,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762090475
    },
    {
        "content": "<p>MangoPeachGrape updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553245611,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762090475
    },
    {
        "content": "<p>MangoPeachGrape submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3408797194\">PR review</a>.</p>",
        "id": 553246098,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762090958
    },
    {
        "content": "<p>MangoPeachGrape created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2484820908\">PR review comment</a>:</p>\n<blockquote>\n<p>Moved everything into the c-api crate now. I was able to get rid of the mutex, but unless I'm mistaken, I think the arc is necessary for the clone in <code>StdoutStream::async_stream()</code>?</p>\n<p>Also for tests, I see that they are now C++, does that mean I would need to add a C++ API for it to be tested?</p>\n</blockquote>",
        "id": 553246100,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762090958
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3411702562\">PR review</a>.</p>",
        "id": 553418154,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762185318
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2486990116\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah true yeah, <code>Arc</code> is  still required. For tests it's ok to skip C++, but you'll probably be using a C++ wrapper mostly and then in the guts do someting C-like. Would that work ok?</p>\n</blockquote>",
        "id": 553418157,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762185319
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3411708355\">PR review</a>.</p>",
        "id": 553418882,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762185479
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2486998975\">PR review comment</a>:</p>\n<blockquote>\n<p>For WASIp2 I'd then also say that a partial write just gets turned into an error (generated in the bindings here) saying that partial writes aren't supported in WASIp2's C API at this time.</p>\n</blockquote>",
        "id": 553418883,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762185480
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2486994498\">PR review comment</a>:</p>\n<blockquote>\n<p>For this it's ok to remove the <code>Option</code> in the function signature to have this statically be non-null. That can't be reflected in C's type system but it can be reflected in the documentation.</p>\n</blockquote>",
        "id": 553418884,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762185480
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2486997018\">PR review comment</a>:</p>\n<blockquote>\n<p>For this, WDYT about using a <code>read</code>/<code>write</code>-syscall-style interface? Something where <code>ssize_t</code> is returned and negative numbers are system errno-like things while positive numbers are how many bytes were written?</p>\n</blockquote>",
        "id": 553418885,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762185480
    },
    {
        "content": "<p>MangoPeachGrape submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3413220321\">PR review</a>.</p>",
        "id": 553493544,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762209554
    },
    {
        "content": "<p>MangoPeachGrape created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2488063701\">PR review comment</a>:</p>\n<blockquote>\n<p>Seems like a good idea, but it seems like <code>ssize_t</code> is somehow not a standard type... is <code>ptrdiff_t</code> the correct choice then?</p>\n<p>What do you mean exactly by \"errno-like\" -- Should negative numbers be just be arbitrarily user specified error codes, as things like <code>io::Result::from_raw_os_error()</code> is OS specific? If so, how should I create the <code>io::Result</code>, maybe <code>io::ErrorKind::Other</code> with \"Write failed with error {code}\"?</p>\n</blockquote>",
        "id": 553493546,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762209554
    },
    {
        "content": "<p>MangoPeachGrape updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553495525,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762210629
    },
    {
        "content": "<p>MangoPeachGrape submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3413272555\">PR review</a>.</p>",
        "id": 553496072,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762210887
    },
    {
        "content": "<p>MangoPeachGrape created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2488101231\">PR review comment</a>:</p>\n<blockquote>\n<p><code>data</code> and <code>finalizer</code> arguments are specified as \"An optional ...\", I'm wondering if that is enough to indicate that the others are required, or should I add a note that a callback is required?</p>\n</blockquote>",
        "id": 553496073,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762210887
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3413607529\">PR review</a>.</p>",
        "id": 553510307,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762219913
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2488351858\">PR review comment</a>:</p>\n<blockquote>\n<p>Finalizer I'd leave as optional yeah, I'd only change the signature of <code>callback</code>. For docs it should be fine to say that <code>callback</code> is required to be non-null.</p>\n</blockquote>",
        "id": 553510308,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762219913
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3413638982\">PR review</a>.</p>",
        "id": 553511931,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762220777
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2488375829\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh? For me <code>man 2 write</code> shows the return being <code>ssize_t</code>...</p>\n<p>But yeah I'm imaginig that negative errors turn into <code>io::Error</code> things. You should be able to use <code>io::Error::raw_os_error</code> and then plumb that error around I think? (I may be missing something though)</p>\n</blockquote>",
        "id": 553511933,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762220778
    },
    {
        "content": "<p>MangoPeachGrape updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553666275,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762275291
    },
    {
        "content": "<p>MangoPeachGrape submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3417656175\">PR review</a>.</p>",
        "id": 553668423,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762275855
    },
    {
        "content": "<p>MangoPeachGrape created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2491344455\">PR review comment</a>:</p>\n<blockquote>\n<p>Unless I'm completely mistaken, <code>ssize_t</code> in only a POSIX thing, so it isn't defined on Windows for example?</p>\n<p>But is using <code>io::Error::from_raw_os_error(wrote.abs())</code> fine? I guess the embedder will return different codes on different platforms, but that function will map them correctly?</p>\n</blockquote>",
        "id": 553668425,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762275856
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3418361133\">PR review</a>.</p>",
        "id": 553699176,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762285224
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2491831275\">PR review comment</a>:</p>\n<blockquote>\n<p>This'll want to use <code>LastOperationFailed</code> rather than <code>Trap</code> to match the behavior of <code>AsyncWrite</code> below</p>\n</blockquote>",
        "id": 553699179,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762285224
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2491836376\">PR review comment</a>:</p>\n<blockquote>\n<p>Mind making these optional and having the <code>wasi</code> feature activate them?</p>\n</blockquote>",
        "id": 553699180,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762285224
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2491840828\">PR review comment</a>:</p>\n<blockquote>\n<p>This is fine to use <code>#[derive(Clone)]</code> for -- that's not used in the wasi crates as it would erroneously place a <code>Clone</code> bound on the generics where they were otherwise behind an <code>Arc</code> but that's not a concern here.</p>\n</blockquote>",
        "id": 553699181,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762285224
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2491842345\">PR review comment</a>:</p>\n<blockquote>\n<p>Mind deduplicating this with the above by having a helper <code>fn raw_write(&amp;self, bytes: &amp;[u8]) -&gt; io::Result&lt;usize&gt;</code> or similar?</p>\n</blockquote>",
        "id": 553699182,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762285224
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2491833505\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh oops I didn't realize Windows didn't have that... I think <code>ptrdiff_t</code> should match roughly what we're looking for yeah (although it's a bit funky alas...)</p>\n<p>And yeah <code>io::Error</code> should do the right platform-specific thing.</p>\n</blockquote>",
        "id": 553699185,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762285225
    },
    {
        "content": "<p>MangoPeachGrape updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553711915,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762289137
    },
    {
        "content": "<p>MangoPeachGrape submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3418578942\">PR review</a>.</p>",
        "id": 553712218,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762289194
    },
    {
        "content": "<p>MangoPeachGrape created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2492001938\">PR review comment</a>:</p>\n<blockquote>\n<p>What about the <code>wrote != bytes.len()</code> branch below, should that use <code>Trap</code> or <code>LastOperationFailed</code>?</p>\n</blockquote>",
        "id": 553712221,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762289194
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3418607357\">PR review</a>.</p>",
        "id": 553715275,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762289801
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#discussion_r2492025624\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh, sorry, yeah that should be <code>LastOperationFailed</code> as well</p>\n</blockquote>",
        "id": 553715278,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762289801
    },
    {
        "content": "<p>MangoPeachGrape updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553715821,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762290011
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#pullrequestreview-3418625393\">PR review</a>.</p>",
        "id": 553716387,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762290182
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553716407,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762290188
    },
    {
        "content": "<p>alexcrichton has disabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553718911,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762291172
    },
    {
        "content": "<p>MangoPeachGrape updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553718914,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762291173
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553722638,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762292780
    },
    {
        "content": "<p>alexcrichton has disabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553722654,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762292786
    },
    {
        "content": "<p>alexcrichton closed without merge <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553722661,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762292789
    },
    {
        "content": "<p>alexcrichton reopened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553722664,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762292792
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553722682,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762292799
    },
    {
        "content": "<p>MangoPeachGrape <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965#issuecomment-3488124723\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>:</p>\n<blockquote>\n<p>Did I break CI... <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> </p>\n</blockquote>",
        "id": 553722720,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762292815
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11965\">PR #11965</a>.</p>",
        "id": 553728775,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762295687
    }
]