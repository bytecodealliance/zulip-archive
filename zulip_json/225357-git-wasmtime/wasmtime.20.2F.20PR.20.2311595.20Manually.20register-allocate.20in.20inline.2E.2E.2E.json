[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595\">PR #11595</a> from <code>alexcrichton:update-inline-asm</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This commit fixes a mistake with our inline assembly for resumption of an exception on various platforms. This was detected during the development of #11592 for riscv64 but I believe this affects other platforms too. The basic issue is that our inline assembly blocks are all clobbering the frame pointer because that's what wasm uses but we have no constraint against preventing any input to these inline assembly blocks from being allocated into the frame pointer. This means that if the destination to jump to is allocated to the frame pointer register then we'll jump to wasm's old frame pointer, no the actual destination, because the frame pointer register is clobbered before jumping. An example of this for riscv64 is on [godbolt] where the <code>s0</code> register, the frame pointer on riscv64, is clobbered and then jumped to.</p>\n<p>The fix in this PR is to manually allocate all registers. All input operands are allocated to explicit registers rather than letting the compiler pick which register they're in. This ensures no overlap with the frame pointer and fixes the test in question. Note that s390x isn't updated here as it doesn't have a frame pointer.</p>\n<p>[godbolt]: <a href=\"https://godbolt.org/z/E9vWb9coq\">https://godbolt.org/z/E9vWb9coq</a></p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 537376100,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756854209
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595\">PR #11595</a>.</p>",
        "id": 537376102,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756854209
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595\">PR #11595</a>.</p>",
        "id": 537376103,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756854210
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595#pullrequestreview-3178488779\">PR review</a>:</p>\n<blockquote>\n<p>Yikes, sorry about that! For all of our caution around regalloc constraints in Cranelift I should have known better with <code>asm!</code>!</p>\n</blockquote>",
        "id": 537378615,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756856260
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595\">PR #11595</a>.</p>",
        "id": 537381213,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756858462
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595#issuecomment-3250123841\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11595\">PR #11595</a>:</p>\n<blockquote>\n<p>Oh no worries I also had no idea this was possible until riscv64 crashed on #11592... The main thing I found odd was that there was no regalloc constraint for \"don't put things in the frame pointer register\" or at least not that I could find</p>\n</blockquote>",
        "id": 537523351,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756920165
    }
]