[
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177\">PR #12177</a>.</p>",
        "id": 564343005,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766005765
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177\">PR #12177</a>.</p>",
        "id": 564343007,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766005766
    },
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177\">PR #12177</a> from <code>fitzgen:egraph-cost-function-topo-sort</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This lets us avoid a fixpoint loop. In practice, the fixpoint loop almost always converged after only one or two iterations (plus one more iteration to learn that we did in fact converge) but we do see as high as fourteen iterations in Sightglass's <code>pulldown-cmark</code> and 12 in <code>spidermonkey.wasm</code>.</p>\n<p>A topo sort is effectively one pass over the IR, after which we know that we converge after a single iteration of the loop that used to be inside the fixpoint. The fixpoint loop did two iterations at best (one to converge, and one to learn that it converged) so this is basically no worse in the best case for the fixpoint loop. However, the new approach's worst case is the same as its best case, which is definitely not true for the fixpoint loop (becomes quadratic at worse).</p>\n<p>This does not affect the best costs we compute for each value at all, and therefore does not affect our generated code at all (e.g. note that the filetests and disas tests are unmodified in this commit).</p>\n<p>Despite improving worst-case algorithmic complexity, it does not seem to have any statistically significant affect on compilation time for Sightglass's default benchmark suite either:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">compilation</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">pulldown</span><span class=\"o\">-</span><span class=\"n\">cmark</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">difference</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">performance</span><span class=\"p\">.</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">14272577</span><span class=\"w\"> </span><span class=\"mf\">14343801.70</span><span class=\"w\"> </span><span class=\"mi\">14428315</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">Cparallel</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">14332259</span><span class=\"w\"> </span><span class=\"mf\">14376054.10</span><span class=\"w\"> </span><span class=\"mi\">14452731</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">topo</span><span class=\"o\">-</span><span class=\"n\">sort</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">Cparallel</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"p\">)</span>\n\n<span class=\"n\">compilation</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">difference</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">performance</span><span class=\"p\">.</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">494880425</span><span class=\"w\"> </span><span class=\"mf\">497004543.50</span><span class=\"w\"> </span><span class=\"mi\">497423796</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">Cparallel</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">496100425</span><span class=\"w\"> </span><span class=\"mf\">496346205.40</span><span class=\"w\"> </span><span class=\"mi\">496691007</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">topo</span><span class=\"o\">-</span><span class=\"n\">sort</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">Cparallel</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"p\">)</span>\n\n<span class=\"n\">compilation</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">bz2</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">difference</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">performance</span><span class=\"p\">.</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">3499081</span><span class=\"w\"> </span><span class=\"mf\">3517541.70</span><span class=\"w\"> </span><span class=\"mi\">3552882</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">Cparallel</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">3498186</span><span class=\"w\"> </span><span class=\"mf\">3514863.90</span><span class=\"w\"> </span><span class=\"mi\">3531898</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">topo</span><span class=\"o\">-</span><span class=\"n\">sort</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"n\">Cparallel</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>cc <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12156\">https://github.com/bytecodealliance/wasmtime/issues/12156</a></p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 564343009,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766005767
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177\">PR #12177</a>.</p>",
        "id": 564344085,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766006282
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177#pullrequestreview-3589736861\">PR review</a>:</p>\n<blockquote>\n<p>Nice -- thanks for this improvement!</p>\n</blockquote>",
        "id": 564345025,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766006688
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177\">PR #12177</a>.</p>",
        "id": 564345068,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766006709
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12177\">PR #12177</a>.</p>",
        "id": 564349067,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1766008462
    }
]