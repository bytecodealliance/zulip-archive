[
    {
        "content": "<p>yomaytk edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534475890,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755175589
    },
    {
        "content": "<p>yomaytk <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3188390616\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thank you for the detailed analysis—I understand.<br>\nAs you suggested, exporting CARGO_TARGET_*_RUNNER resolves the issue, so I’ve updated the code in that way.</p>\n<blockquote>\n<p>but that's a bit of a bummer.</p>\n</blockquote>\n<p>Do you mean that it’s not ideal for .cargo/config.toml to depend on <code>CARGO_TARGET_*_RUNNER</code>?<br>\n<code>CARGO_TARGET_*_RUNNER</code> looks like a variable that’s intended to be used only in CI.</p>\n</blockquote>",
        "id": 534479728,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755176807
    },
    {
        "content": "<p>yomaytk edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3188390616\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thank you for the detailed analysis—I understand.<br>\nAs you suggested, exporting <code>CARGO_TARGET_*_RUNNER</code> resolves the issue, so I’ve updated the code in that way.</p>\n<blockquote>\n<p>but that's a bit of a bummer.</p>\n</blockquote>\n<p>Do you mean that it’s not ideal for .cargo/config.toml to depend on <code>CARGO_TARGET_*_RUNNER</code>?<br>\n<code>CARGO_TARGET_*_RUNNER</code> looks like a variable that’s intended to be used only in CI.</p>\n</blockquote>",
        "id": 534479813,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755176831
    },
    {
        "content": "<p>yomaytk edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3188390616\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thank you for the detailed analysis—I understand.<br>\nAs you suggested, exporting <code>CARGO_TARGET_*_RUNNER</code> resolves the issue, so I’ve updated the code in that way. Could your review again?</p>\n<blockquote>\n<p>but that's a bit of a bummer.</p>\n</blockquote>\n<p>Do you mean that it’s not ideal for .cargo/config.toml to depend on <code>CARGO_TARGET_*_RUNNER</code>?<br>\n<code>CARGO_TARGET_*_RUNNER</code> looks like a variable that’s intended to be used only in CI.</p>\n</blockquote>",
        "id": 534515731,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755188186
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3189926175\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Would you mind updating this to recommend setting the env vars directly instead of <code>.cargo/config.toml</code>? That way <code>test-util/src/lib.rs</code> wouldn't need modifications or need to encode system-specific paths like it's currently doing.</p>\n<p>Ah by \"bummer\" I mean that requiring env vars is not fun since they're not shared by shells by default (unlike <code>.cargo/config.toml</code>). What you've got here is a bit of a quine-like situation where you want to specify a runner that specifies env vars to specify the runner which would need to specify env vars which ... (so on and so forth). What this really just wants is the env var to be inherited, or some way for the test itself to learn the runner configuration from Cargo's config, but only the former is possible.</p>\n</blockquote>",
        "id": 534563353,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755207104
    },
    {
        "content": "<p>yomaytk <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3190755972\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, the current <a href=\"https://github.com/bytecodealliance/wasmtime/blob/f206a3ecc6f1245f94e8ce522f424f654e45fd87/crates/test-util/src/lib.rs#L13-L21\"><code>cargo_test_runner</code></a> is implemented to use the first runner in the iterator, so when we want to run tests against multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering two approaches:</p>\n<ol>\n<li>\n<p>Introduce an architecture-agnostic <code>CARGO_TARGET_RUNNER</code>, and set it each time we switch targets as follows.<br>\n<code>$ export CARGO_TARGET_RUNNER='qemu-aarch64 -L /usr/aarch64-linux-gnu -E LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1'</code>.</p>\n</li>\n<li>\n<p>Specify each <code>CARGO_*_RUNNER</code> in <code>.cargo/config.toml</code> under the <code>[env]</code> section. Introduce <code>CARGO_TARGET_ARCH</code>, and fix <code>cargo_test_runner</code> to filter by the environment variable (as below). Then run tests like:<br>\n<code>$ CARGO_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu</code>.</p>\n</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">cargo_test_runner</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">// Note that this technically should look for the current target as well</span>\n<span class=\"w\">    </span><span class=\"c1\">// instead of picking \"any runner\", but that's left for a future</span>\n<span class=\"w\">    </span><span class=\"c1\">// refactoring.</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">runner</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">vars</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_v</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">k</span><span class=\"p\">.</span><span class=\"n\">starts_with</span><span class=\"p\">(</span><span class=\"s\">\"CARGO_TARGET\"</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"p\">.</span><span class=\"n\">ends_with</span><span class=\"p\">(</span><span class=\"s\">\"RUNNER\"</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"p\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span>\n<span class=\"w\">                    </span><span class=\"o\">&amp;</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">\"CARGO_TARGET_ARCH\"</span><span class=\"p\">)</span>\n<span class=\"w\">                        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">target_arch</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">target_arch</span><span class=\"p\">.</span><span class=\"n\">to_uppercase</span><span class=\"p\">())</span>\n<span class=\"w\">                        </span><span class=\"p\">.</span><span class=\"n\">unwrap_or_else</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">runner</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Alternatively, there may be a better approach. I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534604664,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755239233
    },
    {
        "content": "<p>yomaytk deleted a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3190755972\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, the current <a href=\"https://github.com/bytecodealliance/wasmtime/blob/f206a3ecc6f1245f94e8ce522f424f654e45fd87/crates/test-util/src/lib.rs#L13-L21\"><code>cargo_test_runner</code></a> is implemented to use the first runner in the iterator, so when we want to run tests against multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering two approaches:</p>\n<ol>\n<li>\n<p>Introduce an architecture-agnostic <code>CARGO_TARGET_RUNNER</code>, and set it each time we switch targets as follows.<br>\n<code>$ export CARGO_TARGET_RUNNER='qemu-aarch64 -L /usr/aarch64-linux-gnu -E LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1'</code>.</p>\n</li>\n<li>\n<p>Specify each <code>CARGO_*_RUNNER</code> in <code>.cargo/config.toml</code> under the <code>[env]</code> section. Introduce <code>CARGO_TARGET_ARCH</code>, and fix <code>cargo_test_runner</code> to filter by the environment variable (as below). Then run tests like:<br>\n<code>$ CARGO_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu</code>.</p>\n</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">cargo_test_runner</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">// Note that this technically should look for the current target as well</span>\n<span class=\"w\">    </span><span class=\"c1\">// instead of picking \"any runner\", but that's left for a future</span>\n<span class=\"w\">    </span><span class=\"c1\">// refactoring.</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">runner</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">vars</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_v</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">k</span><span class=\"p\">.</span><span class=\"n\">starts_with</span><span class=\"p\">(</span><span class=\"s\">\"CARGO_TARGET\"</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"p\">.</span><span class=\"n\">ends_with</span><span class=\"p\">(</span><span class=\"s\">\"RUNNER\"</span><span class=\"p\">)</span>\n<span class=\"w\">                </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"p\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span>\n<span class=\"w\">                    </span><span class=\"o\">&amp;</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">\"CARGO_TARGET_ARCH\"</span><span class=\"p\">)</span>\n<span class=\"w\">                        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">target_arch</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">target_arch</span><span class=\"p\">.</span><span class=\"n\">to_uppercase</span><span class=\"p\">())</span>\n<span class=\"w\">                        </span><span class=\"p\">.</span><span class=\"n\">unwrap_or_else</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"s\">\"\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">runner</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Alternatively, there may be a better approach. I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534605947,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755240147
    },
    {
        "content": "<p>yomaytk updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534611628,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755243669
    },
    {
        "content": "<p>yomaytk updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534611844,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755243784
    },
    {
        "content": "<p>yomaytk <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3190888755\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, since the current <code>cargo_test_runner</code> is implemented to use the first runner in the iterator, when we want to run tests for multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering two approaches:</p>\n<ol>\n<li>\n<p>Introduce an architecture-agnostic <code>CARGO_TARGET_RUNNER</code> and set it each time we switch targets.:<br>\n<code>$ export CARGO_TARGET_RUNNER=‘qemu-aarch64 -L /usr/aarch64-linux-gnu -E LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1’</code>.</p>\n</li>\n<li>\n<p>Introduce <code>CARGO_TARGET_ARCH</code> representing the target, and fix <code>cargo_test_runner</code> to detect the appropriate runner based on this environment variable. Run tests like:<br>\n<code>$ CARGO_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu.</code></p>\n</li>\n</ol>\n<p>For reference, the latest changes in this PR implement the second approach.</p>\n<p>There may be a better method; I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534614127,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755244895
    },
    {
        "content": "<p>yomaytk edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3190888755\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, since the current <code>cargo_test_runner</code> is implemented to use the first runner in the iterator, when we want to run tests for multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering two approaches:</p>\n<ol>\n<li>\n<p>Introduce an architecture-agnostic <code>CARGO_TARGET_RUNNER</code> and set it each time we switch targets.:<br>\n<code>$ export CARGO_TARGET_RUNNER=‘qemu-aarch64 -L /usr/aarch64-linux-gnu -E LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1’</code>.</p>\n</li>\n<li>\n<p>Introduce <code>CARGO_TARGET_ARCH</code> representing the target, and fix <code>cargo_test_runner</code> to detect the appropriate runner based on this environment variable. Run tests like:<br>\n<code>$ CARGO_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu</code>.</p>\n</li>\n</ol>\n<p>For reference, the latest changes in this PR implement the second approach.</p>\n<p>There may be a better method; I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534614723,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755245184
    },
    {
        "content": "<p>yomaytk updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534620520,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755248042
    },
    {
        "content": "<p>yomaytk edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3190888755\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, since the current <code>cargo_test_runner</code> is implemented to use the first runner in the iterator, when we want to run tests for multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering two approaches:</p>\n<ol>\n<li>\n<p>Introduce an architecture-agnostic <code>CARGO_TARGET_RUNNER</code> and set it each time we switch targets.:<br>\n<code>$ export CARGO_TARGET_RUNNER=‘qemu-aarch64 -L /usr/aarch64-linux-gnu -E LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1’</code>.</p>\n</li>\n<li>\n<p>Introduce <code>CARGO_LOCAL_TARGET_ARCH</code> representing the target, and fix <code>cargo_test_runner</code> to detect the appropriate runner based on this environment variable. Run tests like:<br>\n<code>$ CARGO_LOCAL_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu</code>.</p>\n</li>\n</ol>\n<p>For reference, the latest changes in this PR implement the second approach.</p>\n<p>There may be a better method; I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534620586,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755248081
    },
    {
        "content": "<p>yomaytk deleted a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3190888755\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, since the current <code>cargo_test_runner</code> is implemented to use the first runner in the iterator, when we want to run tests for multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering two approaches:</p>\n<ol>\n<li>\n<p>Introduce an architecture-agnostic <code>CARGO_TARGET_RUNNER</code> and set it each time we switch targets.:<br>\n<code>$ export CARGO_TARGET_RUNNER=‘qemu-aarch64 -L /usr/aarch64-linux-gnu -E LD_LIBRARY_PATH=/usr/aarch64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1’</code>.</p>\n</li>\n<li>\n<p>Introduce <code>CARGO_LOCAL_TARGET_ARCH</code> representing the target, and fix <code>cargo_test_runner</code> to detect the appropriate runner based on this environment variable. Run tests like:<br>\n<code>$ CARGO_LOCAL_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu</code>.</p>\n</li>\n</ol>\n<p>For reference, the latest changes in this PR implement the second approach.</p>\n<p>There may be a better method; I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534635703,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755256057
    },
    {
        "content": "<p>yomaytk updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534656769,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755265906
    },
    {
        "content": "<p>yomaytk updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534657096,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755266015
    },
    {
        "content": "<p>yomaytk <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3191598320\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks! Exporting <code>CARGO_*_RUNNER</code> is simple and requires no code changes. However, since the current <code>cargo_test_runner</code> is implemented to use the first runner in the iterator, when we want to run tests for multiple targets, we have to unset all non-target <code>CARGO_*_RUNNER</code> variables each time. Then, I’m considering the following approaches:</p>\n<ul>\n<li>Introduce <code>CARGO_TARGET_ARCH</code> representing the target, allowing <code>cargo_test_runner</code> to detect the appropriate runner. The same variable will also be defined in CI. Run local tests like:<br>\n<code>$ CARGO_TARGET_ARCH=aarch64 cargo test --target aarch64-unknown-linux-gnu</code>.</li>\n</ul>\n<p>The latest changes in this PR implement this approach.</p>\n<p>There may be a better method; I’d appreciate your thoughts.</p>\n</blockquote>",
        "id": 534659959,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755267063
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3192383727\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Thanks for your work here, and I'm sorry if this is taking longer than expected. This is unfortunately a bit of a minefield where there's bugs that can't be fixed and I also have personal preferences about how we document and structure this. I also ideally want to have minimal impact on various bits of infrastructure since this is a relatively niche thing that shouldn't haev an outside impact. </p>\n<p>This PR as-is adds a new required environment variable that's required to be specified to run tests in QEMU. Additionally it specifies configuration which is redundant in <code>.cargo/config.toml</code> where there's non-obvious overlap and surprising behavior.</p>\n<p>If you're interested in seeing this PR all the way through, I'd recommend a possible change of removing the <code>.cargo/config.toml</code> configuration entirely and documenting only the <code>CARGO_*_RUNNER</code> env vars with an example of how to do one. Personally I think that would be sufficient for now and it's not super pressing to get the tests to a working state where you can set all the env vars for all the targets and run tests all at once for many targets.</p>\n<p>If you'd like to get the multi-target approach working I'd recommend using <code>cfg(target_arch = \"...\")</code> instead of a new environment variable to figure out which one to filter for and look for.</p>\n<p>Orthogonally to this PR, another option is to skip tests that use <code>Command</code> by default in cross-compiled situations. That way CI could opt-in to running these tests but others running <code>cargo test</code> could use the preexisting <code>.cargo/config.toml</code> configuration and it would work as expected.</p>\n<hr>\n<p>Basically I want to avoid redundant configuration, hardcoding system-specifics in the repo, or adding undue burden on infrastructure for running these tests. It's unfortunately not easy to balance all these concerns though.</p>\n</blockquote>",
        "id": 534695082,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755282559
    },
    {
        "content": "<p>yomaytk <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3193420390\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Ah, I see—thank you for the detailed explanation. I understand that the proposed feature is niche and that it wouldn’t be good to place a burden on the infrastructure. Then, I’ll update this PR to document how to set <code>CARGO_*_RUNNER</code>.</p>\n<blockquote>\n<p>documenting only the CARGO_*_RUNNER env vars</p>\n</blockquote>\n<p>Just to confirm, do we also need to document <code>CARGO_*_LINKER</code>?</p>\n</blockquote>",
        "id": 534741167,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755323766
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3197392889\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>The linker bits don't <em>need</em> to be in env vars, but they do need to be specified somewhere. If the runner is in an env var I think it'd make sense to follow suit and use that for the linker too (no need to document two similar-and-related configuration systems here)</p>\n</blockquote>",
        "id": 534974899,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755530763
    },
    {
        "content": "<p>yomaytk updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534992474,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755537639
    },
    {
        "content": "<p>yomaytk <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#issuecomment-3197818156\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>:</p>\n<blockquote>\n<p>Got it. I’ve updated the PR—could you review it again?</p>\n</blockquote>",
        "id": 534993661,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755538237
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418#pullrequestreview-3129291771\">PR review</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n</blockquote>",
        "id": 534993925,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755538369
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534993937,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755538374
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11418\">PR #11418</a>.</p>",
        "id": 534996766,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755539644
    }
]