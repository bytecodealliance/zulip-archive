[
    {
        "content": "<p>alexcrichton assigned alexcrichton to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12544\">issue #12544</a>.</p>",
        "id": 572865475,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770664316
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the wasm-proposal:component-model-async label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12544\">Issue #12544</a>.</p>",
        "id": 572865478,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770664317
    },
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12544\">issue #12544</a>:</p>\n<blockquote>\n<p>This input:</p>\n<div class=\"codehilite\" data-code-language=\"wasm\"><pre><span></span><code>(component\n\n  (component $a\n    (core module $m\n      (func (export \"a\") (result i32) i32.const 1) ;; CALLBACK_CODE_YIELD\n      (func (export \"cb\") (param i32 i32 i32) (result i32) i32.const 1) ;; CALLBACK_CODE_YIELD\n    )\n    (core instance $i (instantiate $m))\n    (func (export \"f\") async\n      (canon lift (core func $i \"a\") async (callback (func $i \"cb\"))))\n  )\n\n  (component $b\n    (import \"f\" (func $f async))\n    (core module $m\n      (import \"\" \"f\" (func $f (result i32)))\n      (import \"\" \"cancel\" (func $cancel (param i32) (result i32)))\n      (global $subtask (mut i32) (i32.const 0))\n      (func (export \"a\")\n        (global.set $subtask\n          (i32.shr_u\n            (call $f)\n            (i32.const 4))))\n      (func (export \"b\")\n        (drop (call $cancel (global.get $subtask))))\n    )\n    (core func $f (canon lower (func $f) async))\n    (core func $cancel (canon subtask.cancel))\n    (core instance $i (instantiate $m\n      (with \"\" (instance\n        (export \"f\" (func $f))\n        (export \"cancel\" (func $cancel))\n      ))\n    ))\n    (func (export \"a\") async (canon lift (core func $i \"a\")))\n    (func (export \"b\") async (canon lift (core func $i \"b\")))\n  )\n\n  (instance $a (instantiate $a))\n  (instance $b (instantiate $b (with \"f\" (func $a \"f\"))))\n  (export \"a\" (func $b \"a\"))\n  (export \"b\" (func $b \"b\"))\n)\n\n(assert_return (invoke \"a\"))\n(assert_return (invoke \"b\"))\n</code></pre></div>\n<p>fails with:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Wcomponent</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">dev</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.10</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wast</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Wcomponent</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span><span class=\"err\">`</span>\n\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">2592575</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">runtime</span><span class=\"o\">/</span><span class=\"n\">component</span><span class=\"o\">/</span><span class=\"n\">concurrent</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">3461</span><span class=\"p\">:</span><span class=\"mi\">17</span><span class=\"p\">:</span>\n<span class=\"nc\">internal</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">entered</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 572865479,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1770664317
    }
]