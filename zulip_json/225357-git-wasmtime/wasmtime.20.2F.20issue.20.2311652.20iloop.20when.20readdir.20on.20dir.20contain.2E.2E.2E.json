[
    {
        "content": "<p>wingo opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<h2>Test case</h2>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">process</span><span class=\"p\">;</span>\n<span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"w\"> </span><span class=\"n\">wit_bindgen</span><span class=\"p\">;</span>\n\n<span class=\"n\">wit_bindgen</span><span class=\"p\">::</span><span class=\"n\">generate</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">inline</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">r</span><span class=\"s\">\"</span>\n<span class=\"s\">  package test:test;</span>\n\n<span class=\"s\">  world test {</span>\n<span class=\"s\">      include wasi:filesystem/imports@0.3.0-rc-2025-08-15;</span>\n<span class=\"s\">      include wasi:cli/command@0.3.0-rc-2025-08-15;</span>\n<span class=\"s\">  }</span>\n<span class=\"s\">\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">additional_derives</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nb\">PartialEq</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Eq</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Hash</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Clone</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"c1\">// Work around https://github.com/bytecodealliance/wasm-tools/issues/2285.</span>\n<span class=\"w\">    </span><span class=\"n\">features</span><span class=\"p\">:[</span><span class=\"s\">\"clocks-timezone\"</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"k\">async</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:cli/run@0.3.0-rc-2025-08-15#run\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"n\">generate_all</span>\n<span class=\"p\">});</span>\n\n<span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_filesystem</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">preopens</span><span class=\"p\">::</span><span class=\"n\">get_directories</span><span class=\"p\">()[</span><span class=\"o\">..</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"p\">[(</span><span class=\"n\">dir</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">symlink_at</span><span class=\"p\">(</span><span class=\"s\">\"..\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()).</span><span class=\"k\">await</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{},</span>\n<span class=\"w\">                </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">types</span><span class=\"p\">::</span><span class=\"n\">ErrorCode</span><span class=\"p\">::</span><span class=\"n\">Exist</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{},</span>\n<span class=\"w\">                </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"fm\">panic!</span><span class=\"p\">(</span><span class=\"s\">\"{}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">stream</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">read_directory</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">            </span><span class=\"n\">stream</span><span class=\"p\">.</span><span class=\"n\">collect</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">            </span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">[</span><span class=\"o\">..</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"fm\">eprintln!</span><span class=\"p\">(</span><span class=\"s\">\"usage: run with one open dir\"</span><span class=\"p\">);</span>\n<span class=\"w\">            </span><span class=\"n\">process</span><span class=\"p\">::</span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Component</span><span class=\"p\">;</span>\n<span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Component</span><span class=\"p\">);</span>\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">exports</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Component</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">test_filesystem</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"fm\">unreachable!</span><span class=\"p\">(</span><span class=\"s\">\"main is a stub\"</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Run via <code>wasmtime --dir t -Wcomponent-model-async=y -Sp3=y test.wasm</code>.</p>\n<h2>Expected behavior</h2>\n<p>The <code>stream.collect()</code> completes.  But it doesn't: it iloops.  Here's a snippet from the strace:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 538460104,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757430241
    },
    {
        "content": "<p><a href=\"https://github.com/wingo\">wingo</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">Issue #11652</a>.</p>",
        "id": 538460109,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757430241
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3271272098\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<p>Could you clarify what version of Wasmtime you're using? On <code>main</code> if I apply this patch:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/test-programs/src/bin/p3_readdir_loop.rs b/crates/test-programs/src/bin/p3_readdir_loop.rs</span>\nnew file mode 100644\n<span class=\"gh\">index 0000000000..e188a022f3</span>\n<span class=\"gd\">--- /dev/null</span>\n<span class=\"gi\">+++ b/crates/test-programs/src/bin/p3_readdir_loop.rs</span>\n<span class=\"gu\">@@ -0,0 +1,31 @@</span>\n<span class=\"gi\">+use test_programs::p3::wasi;</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+struct Component;</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+test_programs::p3::export!(Component);</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+impl test_programs::p3::exports::wasi::cli::run::Guest for Component {</span>\n<span class=\"gi\">+    async fn run() -&gt; Result&lt;(), ()&gt; {</span>\n<span class=\"gi\">+        match &amp;wasi::filesystem::preopens::get_directories()[..] {</span>\n<span class=\"gi\">+            [(dir, _)] =&gt; {</span>\n<span class=\"gi\">+                match dir.symlink_at(\"..\".to_string(), \"parent\".to_string()).await {</span>\n<span class=\"gi\">+                    Ok(()) =&gt; {}</span>\n<span class=\"gi\">+                    Err(wasi::filesystem::types::ErrorCode::Exist) =&gt; {}</span>\n<span class=\"gi\">+                    Err(err) =&gt; {</span>\n<span class=\"gi\">+                        panic!(\"{}\", err);</span>\n<span class=\"gi\">+                    }</span>\n<span class=\"gi\">+                }</span>\n<span class=\"gi\">+                let (stream, result) = dir.read_directory().await;</span>\n<span class=\"gi\">+                stream.collect().await;</span>\n<span class=\"gi\">+                result.await.unwrap();</span>\n<span class=\"gi\">+                Ok(())</span>\n<span class=\"gi\">+            }</span>\n<span class=\"gi\">+            [..] =&gt; {</span>\n<span class=\"gi\">+                eprintln!(\"usage: run with one open dir\");</span>\n<span class=\"gi\">+                Err(())</span>\n<span class=\"gi\">+            }</span>\n<span class=\"gi\">+        }</span>\n<span class=\"gi\">+    }</span>\n<span class=\"gi\">+}</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+fn main() {}</span>\n<span class=\"gh\">diff --git a/crates/wasi/tests/all/p3/mod.rs b/crates/wasi/tests/all/p3/mod.rs</span>\n<span class=\"gh\">index 6533d9d3f0..a47702df6e 100644</span>\n<span class=\"gd\">--- a/crates/wasi/tests/all/p3/mod.rs</span>\n<span class=\"gi\">+++ b/crates/wasi/tests/all/p3/mod.rs</span>\n<span class=\"gu\">@@ -142,3 +142,8 @@ async fn p3_readdir() -&gt; anyhow::Result&lt;()&gt; {</span>\n<span class=\"w\"> </span>async fn p3_readdir_blocking() -&gt; anyhow::Result&lt;()&gt; {\n<span class=\"w\"> </span>    run_allow_blocking_current_thread(P3_READDIR_COMPONENT, true).await\n<span class=\"w\"> </span>}\n<span class=\"gi\">+</span>\n<span class=\"gi\">+#[test_log::test(tokio::test(flavor = \"multi_thread\"))]</span>\n<span class=\"gi\">+async fn p3_readdir_loop() -&gt; anyhow::Result&lt;()&gt; {</span>\n<span class=\"gi\">+    run(P3_READDIR_LOOP_COMPONENT).await</span>\n<span class=\"gi\">+}</span>\n</code></pre></div>\n<p>the test passes:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"n\">p3</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">p3_readdir_loop</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">test</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.08</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">all</span><span class=\"o\">-</span><span class=\"mi\">50</span><span class=\"n\">fb7a1e72c4f7c2</span><span class=\"p\">)</span>\n\n<span class=\"n\">running</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">p3</span><span class=\"p\">::</span><span class=\"n\">p3_readdir_loop</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">ok</span>\n\n<span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ok</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">passed</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">ignored</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">measured</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">215</span><span class=\"w\"> </span><span class=\"n\">filtered</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">finished</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">1.38</span><span class=\"n\">s</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 538467651,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757432283
    },
    {
        "content": "<p>wingo <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3273761005\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<p>I was using 10d2cbc59d35b14c3027a8542f636c591b2ec96b.  Testing with current main (447efbd330074928381df2c67d83cd84c810843b) gives me the same results (the iloop), for my test.  Puzzling~</p>\n</blockquote>",
        "id": 538587471,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757490713
    },
    {
        "content": "<p>wingo <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3274143720\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<p>Here's a tarball that exhibits the bug for me: <a href=\"https://github.com/user-attachments/files/22252013/test-readdir.tar.gz\">test-readdir.tar.gz</a></p>\n<p>Run via:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">strace</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Wcomponent</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Sp3</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"n\">readdir</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 538606608,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757497068
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3276176558\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<p>Hm ok I can definitely not reproduce this. In the interest of making this more reproducible here's a <code>Dockerfile</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Docker\"><pre><span></span><code><span class=\"k\">FROM</span><span class=\"w\"> </span><span class=\"s\">ubuntu:24.04</span>\n\n<span class=\"k\">RUN</span><span class=\"w\"> </span>apt-get<span class=\"w\"> </span>update<span class=\"w\"> </span>-y<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span>apt-get<span class=\"w\"> </span>install<span class=\"w\"> </span>-y<span class=\"w\"> </span>gcc<span class=\"w\"> </span>curl<span class=\"w\"> </span>xz-utils\n<span class=\"k\">RUN</span><span class=\"w\"> </span>curl<span class=\"w\"> </span>-LO<span class=\"w\"> </span>https://github.com/user-attachments/files/22252013/test-readdir.tar.gz\n<span class=\"k\">RUN</span><span class=\"w\"> </span>tar<span class=\"w\"> </span>xf<span class=\"w\"> </span>test-readdir.tar.gz\n<span class=\"k\">WORKDIR</span><span class=\"w\"> </span><span class=\"s\">/test-readdir</span>\n<span class=\"k\">RUN</span><span class=\"w\"> </span>curl<span class=\"w\"> </span>--proto<span class=\"w\"> </span><span class=\"s1\">'=https'</span><span class=\"w\"> </span>--tlsv1.2<span class=\"w\"> </span>-sSf<span class=\"w\"> </span>https://sh.rustup.rs<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>bash<span class=\"w\"> </span>-s<span class=\"w\"> </span>--<span class=\"w\"> </span>-y<span class=\"w\"> </span>--default-toolchain<span class=\"w\"> </span>nightly\n<span class=\"k\">ENV</span><span class=\"w\"> </span><span class=\"nv\">PATH</span><span class=\"o\">=</span><span class=\"nv\">$PATH</span>:/root/.cargo/bin\n<span class=\"k\">RUN</span><span class=\"w\"> </span>rustup<span class=\"w\"> </span>target<span class=\"w\"> </span>add<span class=\"w\"> </span>wasm32-wasip2\n<span class=\"k\">RUN</span><span class=\"w\"> </span>cargo<span class=\"w\"> </span>+nightly<span class=\"w\"> </span>build<span class=\"w\"> </span>--target<span class=\"o\">=</span>wasm32-wasip2<span class=\"w\"> </span>--release\n<span class=\"k\">RUN</span><span class=\"w\"> </span>curl<span class=\"w\"> </span>-LO<span class=\"w\"> </span>https://github.com/bytecodealliance/wasmtime/releases/download/dev/wasmtime-dev-x86_64-linux.tar.xz\n<span class=\"k\">RUN</span><span class=\"w\"> </span>tar<span class=\"w\"> </span>xf<span class=\"w\"> </span>wasmtime-dev-x86_64-linux.tar.xz\n<span class=\"k\">RUN</span><span class=\"w\"> </span>./wasmtime-dev-x86_64-linux/wasmtime<span class=\"w\"> </span>--dir<span class=\"w\"> </span>t<span class=\"w\"> </span>-Wcomponent-model-async<span class=\"o\">=</span>y<span class=\"w\"> </span>-Sp3<span class=\"o\">=</span>y<span class=\"w\"> </span>target/wasm32-wasip2/release/test-readdir.wasm\n</code></pre></div>\n<p>which if I put that in a folder as <code>Dockerfile</code> and run <code>docker build .</code> then the build passes and doesn't infinite loop. </p>\n<p>Is this perhaps filesystem-dependent behavior? I'm on a pretty much stock Ubuntu 24.04 machine with an ext4 filesystem and kernel <code>6.8.0-79-generic</code>. Are you able to reproduce with the docker script? Or are you on a different filesystem or a different kernel perhaps?</p>\n</blockquote>",
        "id": 538721113,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757530980
    },
    {
        "content": "<p>wingo <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3278931677\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<p>Well!  Managed to track it down.  It's fixed in 5764da5fd5afdebaeca926908565b875e0220884; could it be that I just fetched wasmtime instead of building, before?  Weird, but I'm not crazy at least; Dockerfile to repro:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">FROM</span><span class=\"w\"> </span><span class=\"n\">ubuntu</span><span class=\"p\">:</span><span class=\"mf\">24.04</span>\n\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">apt</span><span class=\"o\">-</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">apt</span><span class=\"o\">-</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"n\">xz</span><span class=\"o\">-</span><span class=\"n\">utils</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">LO</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"p\">:</span><span class=\"c1\">//github.com/user-attachments/files/22252013/test-readdir.tar.gz</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">tar</span><span class=\"w\"> </span><span class=\"n\">xf</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"n\">readdir</span><span class=\"p\">.</span><span class=\"n\">tar</span><span class=\"p\">.</span><span class=\"n\">gz</span>\n<span class=\"n\">WORKDIR</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"n\">readdir</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">proto</span><span class=\"w\"> </span><span class=\"o\">'=</span><span class=\"n\">https</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">tlsv1</span><span class=\"p\">.</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">sSf</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"p\">:</span><span class=\"c1\">//sh.rustup.rs | \\</span>\n<span class=\"w\">  </span><span class=\"n\">bash</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">default</span><span class=\"o\">-</span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">nightly</span>\n<span class=\"n\">ENV</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"cp\">$PATH</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">root</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">bin</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">rustup</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"p\">:</span><span class=\"c1\">//github.com/bytecodealliance/wasmtime</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">e3561d515f1c217c80c634a12c17d6797ce1332a</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">submodule</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">manifest</span><span class=\"o\">-</span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">Cargo</span><span class=\"p\">.</span><span class=\"n\">toml</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Wcomponent</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">-</span><span class=\"k\">async</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Sp3</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"n\">readdir</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 538790179,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757576474
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<h2>Test case</h2>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">process</span><span class=\"p\">;</span>\n<span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"w\"> </span><span class=\"n\">wit_bindgen</span><span class=\"p\">;</span>\n\n<span class=\"n\">wit_bindgen</span><span class=\"p\">::</span><span class=\"n\">generate</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">inline</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">r</span><span class=\"s\">\"</span>\n<span class=\"s\">  package test:test;</span>\n\n<span class=\"s\">  world test {</span>\n<span class=\"s\">      include wasi:filesystem/imports@0.3.0-rc-2025-08-15;</span>\n<span class=\"s\">      include wasi:cli/command@0.3.0-rc-2025-08-15;</span>\n<span class=\"s\">  }</span>\n<span class=\"s\">\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">additional_derives</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"nb\">PartialEq</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Eq</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Hash</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Clone</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"c1\">// Work around https://github.com/bytecodealliance/wasm-tools/issues/2285.</span>\n<span class=\"w\">    </span><span class=\"n\">features</span><span class=\"p\">:[</span><span class=\"s\">\"clocks-timezone\"</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"k\">async</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:cli/run@0.3.0-rc-2025-08-15#run\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"n\">generate_all</span>\n<span class=\"p\">});</span>\n\n<span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">test_filesystem</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">preopens</span><span class=\"p\">::</span><span class=\"n\">get_directories</span><span class=\"p\">()[</span><span class=\"o\">..</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"p\">[(</span><span class=\"n\">dir</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">symlink_at</span><span class=\"p\">(</span><span class=\"s\">\"..\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()).</span><span class=\"k\">await</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{},</span>\n<span class=\"w\">                </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">::</span><span class=\"n\">types</span><span class=\"p\">::</span><span class=\"n\">ErrorCode</span><span class=\"p\">::</span><span class=\"n\">Exist</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{},</span>\n<span class=\"w\">                </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"fm\">panic!</span><span class=\"p\">(</span><span class=\"s\">\"{}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">stream</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">read_directory</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">            </span><span class=\"n\">stream</span><span class=\"p\">.</span><span class=\"n\">collect</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">            </span><span class=\"n\">result</span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"p\">},</span>\n<span class=\"w\">        </span><span class=\"p\">[</span><span class=\"o\">..</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"fm\">eprintln!</span><span class=\"p\">(</span><span class=\"s\">\"usage: run with one open dir\"</span><span class=\"p\">);</span>\n<span class=\"w\">            </span><span class=\"n\">process</span><span class=\"p\">::</span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Component</span><span class=\"p\">;</span>\n<span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Component</span><span class=\"p\">);</span>\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">exports</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">cli</span><span class=\"p\">::</span><span class=\"n\">run</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Component</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">run</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">test_filesystem</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n<span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"fm\">unreachable!</span><span class=\"p\">(</span><span class=\"s\">\"main is a stub\"</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Run via <code>wasmtime --dir t -Wcomponent-model-async=y -Sp3=y test.wasm</code>.</p>\n<h2>Expected behavior</h2>\n<p>The <code>stream.collect()</code> completes.  But it doesn't: it iloops.  Here's a snippet from the strace:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"n\">fcntl</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">F_GETFL</span><span class=\"p\">)</span><span class=\"w\">                      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x38000</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">flags</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span>\n<span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a581150</span><span class=\"w\"> </span><span class=\"cm\">/* 3 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">768</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_SYMLINK_NOFOLLOW</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFLNK</span><span class=\"o\">|</span><span class=\"mi\">0777</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">getdents64</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x56340a5814e0</span><span class=\"w\"> </span><span class=\"cm\">/* 0 entries */</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1536</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">close</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">)</span><span class=\"w\">                               </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 538912221,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757611598
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3281991557\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11652\">issue #11652</a>:</p>\n<blockquote>\n<p>Aha that makes sense, thanks for tracking that down! That change was accompanied with its own tests/refactorings so I think it's ok to not test this specifically in the repo, so I'll close this as fixed by <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11515\">https://github.com/bytecodealliance/wasmtime/pull/11515</a></p>\n</blockquote>",
        "id": 538912223,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757611599
    }
]