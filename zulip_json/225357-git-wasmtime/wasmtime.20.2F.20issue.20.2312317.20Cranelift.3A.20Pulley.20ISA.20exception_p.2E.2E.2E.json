[
    {
        "content": "<p>zzjas opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12317\">issue #12317</a>:</p>\n<blockquote>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">compile</span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">pulley64</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">trigger_bug</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"nc\">winch</span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"nc\">winch</span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">try_call</span><span class=\"w\"> </span><span class=\"n\">triggers</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">bug</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"n\">invoking</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"w\"> </span><span class=\"n\">handling</span><span class=\"w\"> </span><span class=\"n\">codegen</span>\n<span class=\"w\">        </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">We</span><span class=\"w\"> </span><span class=\"n\">omit</span><span class=\"w\"> </span><span class=\"n\">exn0</span><span class=\"w\"> </span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">exception_payload_types</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">empty</span>\n<span class=\"w\">        </span><span class=\"n\">try_call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">ret0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">block2</span><span class=\"w\"> </span><span class=\"p\">]</span>\n\n<span class=\"w\">    </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n\n<span class=\"w\">    </span><span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"nc\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">bin</span><span class=\"w\"> </span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">pulley64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>No assertion failure</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">138509</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">2041</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"p\">:</span>\n<span class=\"nc\">assertion</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"w\">  </span><span class=\"n\">left</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\"> </span><span class=\"n\">right</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: 67ce1ef23b8a5fb8ab293828cd719402b83d5b5b</p>\n<p>Operating system: Ubuntu 22.04.5</p>\n<p>Architecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>Pulley <code>exception_payload_regs</code> unconditionally returns 2 registers:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/67ce1ef23b8a5fb8ab293828cd719402b83d5b5b/cranelift/codegen/src/isa/pulley_shared/abi.rs#L563-L569\">https://github.com/bytecodealliance/wasmtime/blob/67ce1ef23b8a5fb8ab293828cd719402b83d5b5b/cranelift/codegen/src/isa/pulley_shared/abi.rs#L563-L569</a></p>\n<p>Other ISAs (x64, aarch64, s390x, riscv64) match on call_conv and return <code>&amp;[]</code> for unsupported conventions like Winch. When <code>try_call</code> is compiled with Winch convention on Pulley, <code>exception_payload_types(Winch)</code> returns 0 elements while <code>exception_payload_regs()</code> returns 2, triggering the assertion at <code>abi.rs:2041</code>.</p>\n<p>Thanks for looking into this and please let us know if we missed anything or if you have any feedback!<br>\n</p>\n</blockquote>",
        "id": 567421534,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768172070
    },
    {
        "content": "<p><a href=\"https://github.com/zzjas\">zzjas</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12317\">Issue #12317</a>.</p>",
        "id": 567421536,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768172070
    },
    {
        "content": "<p><a href=\"https://github.com/zzjas\">zzjas</a> added the cranelift label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12317\">Issue #12317</a>.</p>",
        "id": 567421537,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768172070
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12317#issuecomment-3740686587\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12317\">issue #12317</a>:</p>\n<blockquote>\n<p>Thanks for the report! Fix in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12325\">https://github.com/bytecodealliance/wasmtime/pull/12325</a></p>\n</blockquote>",
        "id": 567650486,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768255006
    },
    {
        "content": "<p>fitzgen closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/12317\">issue #12317</a>:</p>\n<blockquote>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">compile</span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">pulley64</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">trigger_bug</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"nc\">winch</span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"nc\">winch</span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">try_call</span><span class=\"w\"> </span><span class=\"n\">triggers</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">bug</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"n\">invoking</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"w\"> </span><span class=\"n\">handling</span><span class=\"w\"> </span><span class=\"n\">codegen</span>\n<span class=\"w\">        </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">We</span><span class=\"w\"> </span><span class=\"n\">omit</span><span class=\"w\"> </span><span class=\"n\">exn0</span><span class=\"w\"> </span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">exception_payload_types</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">empty</span>\n<span class=\"w\">        </span><span class=\"n\">try_call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">ret0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">block2</span><span class=\"w\"> </span><span class=\"p\">]</span>\n\n<span class=\"w\">    </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n\n<span class=\"w\">    </span><span class=\"n\">block2</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"nc\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">bin</span><span class=\"w\"> </span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">pulley64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>No assertion failure</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">138509</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">2041</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"p\">:</span>\n<span class=\"nc\">assertion</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"w\">  </span><span class=\"n\">left</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\"> </span><span class=\"n\">right</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: 67ce1ef23b8a5fb8ab293828cd719402b83d5b5b</p>\n<p>Operating system: Ubuntu 22.04.5</p>\n<p>Architecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>Pulley <code>exception_payload_regs</code> unconditionally returns 2 registers:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/67ce1ef23b8a5fb8ab293828cd719402b83d5b5b/cranelift/codegen/src/isa/pulley_shared/abi.rs#L563-L569\">https://github.com/bytecodealliance/wasmtime/blob/67ce1ef23b8a5fb8ab293828cd719402b83d5b5b/cranelift/codegen/src/isa/pulley_shared/abi.rs#L563-L569</a></p>\n<p>Other ISAs (x64, aarch64, s390x, riscv64) match on call_conv and return <code>&amp;[]</code> for unsupported conventions like Winch. When <code>try_call</code> is compiled with Winch convention on Pulley, <code>exception_payload_types(Winch)</code> returns 0 elements while <code>exception_payload_regs()</code> returns 2, triggering the assertion at <code>abi.rs:2041</code>.</p>\n<p>Thanks for looking into this and please let us know if we missed anything or if you have any feedback!<br>\n</p>\n</blockquote>",
        "id": 567656105,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1768257822
    }
]