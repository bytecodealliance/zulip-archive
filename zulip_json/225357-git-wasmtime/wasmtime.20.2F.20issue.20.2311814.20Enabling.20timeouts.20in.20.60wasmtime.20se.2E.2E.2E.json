[
    {
        "content": "<p>lann edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11814\">issue #11814</a>:</p>\n<blockquote>\n<p>In doing some comparative performance testing we discovered that enabling timeouts via e.g. <code>-Wtimeout=1s</code> cuts throughput by 2-3 orders of magnitude. The likely cause is the management of the <code>EpochThread</code>, which appears to be spawned once per request:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796</a><br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641</a></p>\n</blockquote>",
        "id": 543758983,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759932767
    },
    {
        "content": "<p>lann edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11814\">issue #11814</a>:</p>\n<blockquote>\n<p>In doing some comparative performance testing we discovered that enabling timeouts via e.g. <code>wasmtime serve -Wtimeout=1s</code> cuts throughput by 2-3 orders of magnitude. The likely cause is the management of the <code>EpochThread</code>, which appears to be spawned once per request:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796</a><br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641</a></p>\n</blockquote>",
        "id": 543759025,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759932776
    },
    {
        "content": "<p>lann edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11814\">issue #11814</a>:</p>\n<blockquote>\n<p>In doing some comparative performance testing we discovered that enabling timeouts via e.g. <code>wasmtime serve -Wtimeout=1s</code> cuts throughput by 2-3 orders of magnitude. The likely cause is the management of the <code>EpochThread</code>, which appears to be spawned once per request (instead of the typical/expected once per <code>Engine</code>):</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796</a><br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641</a></p>\n</blockquote>",
        "id": 543759246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759932820
    },
    {
        "content": "<p>lann edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11814\">issue #11814</a>:</p>\n<blockquote>\n<p>In doing some comparative performance testing we discovered that enabling timeouts via e.g. <code>wasmtime serve -Wtimeout=1s</code> cuts throughput by 2-3 orders of magnitude. The likely cause is the management of the <code>EpochThread</code>, which appears to be spawned once per request (instead of the typical/expected once per <code>Engine</code>):</p>\n<p>In <code>handle_request</code>: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796</a></p>\n<p>Which always spawns a thread if timeouts are enabled: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641</a></p>\n<p>It looks like there is a similar hazard when enabling profiling: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L707\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L707</a></p>\n</blockquote>",
        "id": 543760245,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759933060
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11814\">issue #11814</a>:</p>\n<blockquote>\n<p>In doing some comparative performance testing we discovered that enabling timeouts via e.g. <code>wasmtime serve -Wtimeout=1s</code> cuts throughput by 2-3 orders of magnitude. The likely cause is the management of the <code>EpochThread</code>, which appears to be spawned once per request (instead of the typical/expected once per <code>Engine</code>):</p>\n<p>In <code>handle_request</code>: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L796</a></p>\n<p>Which always spawns a thread if timeouts are enabled: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L641</a></p>\n<p>It looks like there is a similar hazard when enabling profiling: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L707\">https://github.com/bytecodealliance/wasmtime/blob/a70809d0caa4959b5d991c2770de821ab3c63930/src/commands/serve.rs#L707</a></p>\n</blockquote>",
        "id": 543801331,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1759944742
    }
]