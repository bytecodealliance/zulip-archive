[
    {
        "content": "<p>khagankhan opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a> from <code>khagankhan:rec-empty</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This PR introduces initial support for empty <code>(rec ...)</code> groups:</p>\n<ul>\n<li>Adds generation of empty recursive groups within a configurable range (clamping is applied).</li>\n<li>Establishes foundational support for future GC work (e.g., struct definitions, related implementations).</li>\n<li>Updates existing tests and adds new unit tests.</li>\n<li>Introduce a new <code>Op</code> that attempts to instantiate a struct from a group. It is designed to be self-dropping due to type incompatibility.</li>\n</ul>\n<hr>\n<p>Note:</p>\n<p>The line:</p>\n<div class=\"codehilite\"><pre><span></span><code>StructNew(k: |ops| ops.total_struct_types() =&gt; u32) : 0 =&gt; 0,\n</code></pre></div>\n\n<p>should effectively prevent <code>struct.new</code> from being generated when no struct types exist. Depending on the configuration and macro logic, it will either:</p>\n<ul>\n<li>Not be generated at all,</li>\n<li>Trigger an assertion failure during macro expansion,</li>\n<li>Or work as expected by skipping generation.</li>\n</ul>\n<p>I will confirm and refine this behavior in a follow-up PR.<br>\n</p>\n</blockquote>",
        "id": 535430226,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755752645
    },
    {
        "content": "<p><strong>khagankhan</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers\">wasmtime-fuzz-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>.</p>",
        "id": 535430227,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755752646
    },
    {
        "content": "<p><strong>khagankhan</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>.</p>",
        "id": 535430228,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755752646
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#issuecomment-3209392052\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"fuzzing\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>fitzgen: fuzzing</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 535447565,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755762314
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#pullrequestreview-3141754051\">PR review</a>:</p>\n<blockquote>\n<p>Thanks! A few thoughts below.</p>\n</blockquote>",
        "id": 535586495,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755814455
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#discussion_r2292156184\">PR review comment</a>:</p>\n<blockquote>\n<p>Because this is going to be serialized and deserialized, and the fuzzer will occasionally mutate those raw bytes, that means that we will get arbitrary values for <code>next_group</code> and <code>rec_groups</code> and we can't rely on any relationship between the two fields (such as, <code>rec_groups</code> does not contain a group with <code>id == next_group</code>).</p>\n<p>It is probably better to get rid of the <code>next_group</code> field and just insert random values, resolving conflicts at insertion time as necessary (or even just ignoring conflicts and letting that \"merge\" rec groups).</p>\n</blockquote>",
        "id": 535586496,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755814456
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#discussion_r2291770931\">PR review comment</a>:</p>\n<blockquote>\n<p>Nitpick: even though we are starting with <code>struct</code> types we plan on defining all kinds of types here eventually, so lets future-proof this a little bit and name it simply <code>Types</code>.</p>\n</blockquote>",
        "id": 535586497,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755814456
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#discussion_r2292222536\">PR review comment</a>:</p>\n<blockquote>\n<p>I think we should delay emitting empty structs in rec groups, and just emit empty rec groups in this PR. Because longer-term, we aren't going to want to special-case empty structs in rec groups like this.</p>\n<p>Then, in the next PR, we can extend <code>Types</code> something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">// ...previous stuff from above...</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// The actual type definitions.</span>\n<span class=\"w\">    </span><span class=\"n\">type_defs</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">BTreeMap</span><span class=\"o\">&lt;</span><span class=\"n\">TypeId</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SubType</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">SubType</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">// Eventually, this will have finality and an optional super</span>\n<span class=\"w\">    </span><span class=\"c1\">// type; for now it will only have this stuff.</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// The rec group that this type should be defined within.</span>\n<span class=\"w\">    </span><span class=\"n\">rec_group</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">RecGroupId</span><span class=\"p\">,</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// The actual type definition.</span>\n<span class=\"w\">    </span><span class=\"n\">composite_type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">CompositeType</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">CompositeType</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">Struct</span><span class=\"p\">(</span><span class=\"n\">StructType</span><span class=\"p\">),</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// And eventually, this will have array types too.</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">StructType</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">// Empty for now, but eventually will have fields.</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>When doing fixups/emitting a Wasm binary, we will create a map from rec group id to set of type ids for the types that are defined within it, since we need that to encode the rec group and its members. And then further in the future, we will have to do an SCC-based thing[^0] to merge rec groups together if there are cycles, since references to types across rec groups need to be acyclic (that is, type references can only be cyclic within the same rec group).</p>\n<p>[^0]: FWIW, we have an <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c7308165c6d92d3cb6334e1980800a024ce2d889/crates/wasmtime/src/compile/scc.rs#L31\">existing implementation of Tarjan's SCC algorithm</a> in tree for our inliner. We could consider reusing that directly, or we could just copy and tweak some code. Will need to think more about this when we get to it.</p>\n<p>Anyways, all that should give us a really good skeleton to start filling out everything else on top of.</p>\n</blockquote>",
        "id": 535586498,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755814456
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#discussion_r2292238069\">PR review comment</a>:</p>\n<blockquote>\n<p>And then we can add this in that next PR as well.</p>\n</blockquote>",
        "id": 535586499,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755814456
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#discussion_r2292240369\">PR review comment</a>:</p>\n<blockquote>\n<p>Kinda unexpected to have the \"empty\" ops contain a non-zero number of rec groups?</p>\n</blockquote>",
        "id": 535586500,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755814456
    },
    {
        "content": "<p>khagankhan submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#pullrequestreview-3142495912\">PR review</a>.</p>",
        "id": 535589823,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755816860
    },
    {
        "content": "<p>khagankhan created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#discussion_r2292293344\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh... Copy-paste error</p>\n</blockquote>",
        "id": 535589824,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755816860
    },
    {
        "content": "<p>khagankhan updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>.</p>",
        "id": 535589914,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1755816936
    },
    {
        "content": "<p>khagankhan updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>.</p>",
        "id": 536524612,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756351481
    },
    {
        "content": "<p>khagankhan <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#issuecomment-3234620437\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>:</p>\n<blockquote>\n<p>@fitzgen I guess it is ready for another round of review</p>\n</blockquote>",
        "id": 536668160,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756407743
    },
    {
        "content": "<p>khagankhan edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#issuecomment-3234620437\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>:</p>\n<blockquote>\n<p>Thanks @fitzgen ! I guess it is ready for another round of review</p>\n</blockquote>",
        "id": 536668216,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756407768
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#pullrequestreview-3166172446\">PR review</a>:</p>\n<blockquote>\n<p>Looks great!</p>\n</blockquote>",
        "id": 536669151,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756408178
    },
    {
        "content": "<p>khagankhan <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487#issuecomment-3234642087\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>:</p>\n<blockquote>\n<p>Thank you! Time to make new ones!!!!</p>\n</blockquote>",
        "id": 536669333,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756408245
    },
    {
        "content": "<p>fitzgen merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11487\">PR #11487</a>.</p>",
        "id": 536674112,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1756410587
    }
]