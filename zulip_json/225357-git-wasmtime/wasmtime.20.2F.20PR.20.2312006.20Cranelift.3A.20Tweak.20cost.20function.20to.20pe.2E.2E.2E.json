[
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a> from <code>fitzgen:dont-select-select</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p><code>select</code>s cannot be speculated through on some of our targets (e.g. x64) so strongly prefer not choosing them.</p>\n<p>Using a target-specific cost function, so that we only pessimize <code>select</code> when it makes sense, is left for follow up work and is tracked in #12005.</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 554386595,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762538893
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>.</p>",
        "id": 554386598,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762538894
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>.</p>",
        "id": 554386600,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762538894
    },
    {
        "content": "<p>fitzgen edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>:</p>\n<blockquote>\n<p><code>select</code>s cannot be speculated through on some of our targets (e.g. x64) so strongly prefer not choosing them.</p>\n<p>Using a target-specific cost function, so that we only pessimize <code>select</code> when it makes sense for the target, is left for follow up work and is tracked in #12005. FWIW, no CPUs on the market do value speculation today, as far as I am aware, so this particular case is somewhat hypothetical (but the larger goal of target-specific cost functions would still be useful).</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 554387019,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762539028
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006#issuecomment-3504073494\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>:</p>\n<blockquote>\n<blockquote>\n<p>selects cannot be speculated through on some of our targets (e.g. x64) so strongly prefer not choosing them.</p>\n</blockquote>\n<p>FWIW, I think this is losing a little nuance and the reality doesn't merit a cost of 50 (!). In more detail, select (cmove) works like any other multi-input operator on modern out-of-order CPUs; the main difference is that it has three inputs (flags/condition, source for the CMOVcc, old register value for the CMOVcc). When all three inputs are ready, the instruction will execute.</p>\n<p>When folks say that \"select isn't speculated through\" what they mean is that the CPU doesn't have a condition predictor (like the branch predictor) that will allow the instruction to speculatively go without the condition input ready. It doesn't mean, however, that the instruction blocks all speculation or serves as a pipeline barrier/flush. That would be far worse!</p>\n<p>Supporting source: <a href=\"https://www.agner.org/optimize/instruction_tables.pdf\">Agner Fog's instruction latency tables</a> show on a reasonable x86-64 baseline (Skylake, circa 2015), CMOVcc reg/reg form is 1 uop and has a latency of 1 cycle and a reciprocal throughput of 0.5 (so two CMOVccs can complete per cycle).</p>\n</blockquote>",
        "id": 554387880,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762539304
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>.</p>",
        "id": 554388943,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762539608
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>.</p>",
        "id": 554394290,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762541336
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006#issuecomment-3504268951\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12006\">PR #12006</a>:</p>\n<blockquote>\n<p>@cfallin I was indeed not thinking in a nuanced way about this, thanks for the clarifications/reality check.</p>\n<p>I removed the <code>select</code> special case, so it will hit the default cost, which will be slightly greater than the cost of adds/etc.</p>\n<p>I left <code>imul</code> at cost 10 though.</p>\n</blockquote>",
        "id": 554394737,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1762541478
    }
]