[
    {
        "content": "<p>fuzing opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>I have the following file structure</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">fusing</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537928318,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757097745
    },
    {
        "content": "<p><a href=\"https://github.com/fuzing\">fuzing</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">Issue #11627</a>.</p>",
        "id": 537928319,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757097745
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">fusing</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537928716,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757097914
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">fusing</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537928971,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757098040
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">medium</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">zstd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deflate</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">fusing</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537929232,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757098144
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">medium</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">zstd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deflate</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">fusing</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537929334,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757098182
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">medium</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">zstd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deflate</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537929656,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757098308
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">medium</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">zstd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deflate</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537930005,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757098451
    },
    {
        "content": "<p>fuzing edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">medium</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">zstd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deflate</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, I'm using <code>bindgen!</code> inside each <code>Host</code> implementation source file.  For the <code>compression</code> host implementor, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537939754,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757102892
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627#issuecomment-3259668024\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>Can you try changing:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<p>to</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"abc:compression/imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<p>and does that fix your issue?</p>\n</blockquote>",
        "id": 537942053,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757104069
    },
    {
        "content": "<p>fuzing <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627#issuecomment-3259843501\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>It does indeed - thank you so much, and enjoy your weekend! </p>\n</blockquote>",
        "id": 537951853,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757108952
    },
    {
        "content": "<p>fuzing closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11627\">issue #11627</a>:</p>\n<blockquote>\n<p>I'm trying to share <code>types</code> across packages in WIT definitions.  The functionality defined in the WIT files is provided by an embedded wasmtime host (Rust).  There is also a wasm guest that consumes the functionality.</p>\n<p>I have 2 projects that consume the WIT definitions, namely:</p>\n<ul>\n<li>a rust project that provides the embedded wasmtime runtime (I'll refer to this as <code>host</code>)</li>\n<li>a project that generates wasm bytecode that will run inside the wasmtime host (I'll refer to this as <code>guest</code>)</li>\n</ul>\n<h3>I have the following file structure for my WIT files (WIT files are defined within the <code>host</code> project)</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n<span class=\"w\">  </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span>\n</code></pre></div>\n<h3>My shared types WIT files look like these:</h3>\n<p><code>wit/deps/types/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/types/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Note that it's the <code>bytes</code> type that I need to share with (in this case) the compression package</strong></p>\n<h3>The package attempting to access the above shared types look like these:</h3>\n<p><code>wit/deps/compression/compression.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">compress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">decompress</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bytes</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/world.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">compression</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>wit/deps/compression/types.wit</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">low</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">medium</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">ultra</span><span class=\"o\">-</span><span class=\"n\">high</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">@</span><span class=\"n\">since</span><span class=\"p\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">0.1.0</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">compression</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">zstd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deflate</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>On the <code>guest</code> side, the component builds fine using the following steps:</p>\n<ol>\n<li>cargo component bindings</li>\n<li>cargo component build --release --target wasm32-unknown-unknown</li>\n</ol>\n<p>Step <code>1</code> above seems to parse the WIT files as I'd anticipate, and the resulting <code>bindings.rs</code> contains the definition for <code>Bytes</code> (2 definitions, namely scoped to: <code>abc::types::types::Bytes</code> and <code>abc::compression::compression::Bytes</code>) that can be used by the local rust code.</p>\n<p>On the wasmtime embedded <code>host</code> side, the <code>bindgen!</code> macro seems unable to find/resolve the shared types across packages (in this case, between <code>package abc:compression@0.1.0</code> and <code>package abc:types@0.1.0</code>, where <code>abc:types@0.1.0</code> contains a type <code>bytes</code> that should be shared across other packages, including to the <code>abc:compression@0.1.0</code> package.</p>\n<h3>On the <code>host</code>, I'm using <code>bindgen!</code> inside each <code>Host</code> implementation source file.  For the <code>compression</code> host implementor, the <code>bindgen!</code> looks like:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<h3>The error coming from the compilation of the <code>host</code> is as follows:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">known</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"p\">:</span>\n<span class=\"w\">               </span><span class=\"nc\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span>\n\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">/</span><span class=\"n\">Projects</span><span class=\"o\">/</span><span class=\"n\">abc</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0.</span><span class=\"p\">{</span><span class=\"n\">bytes</span><span class=\"p\">};</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">^-----------</span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">bin</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">platform_implementations</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"wit/deps/compression\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"imports\"</span><span class=\"p\">,</span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">26</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n</code></pre></div>\n<h3>Notes:</h3>\n<p>On the <code>guest</code> wasm bytecode project side, the following had to be included in the <code>Cargo.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">package</span><span class=\"p\">.</span><span class=\"n\">metadata</span><span class=\"p\">.</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">dependencies</span><span class=\"p\">]</span>\n<span class=\"s\">\"abc:compression\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/compression\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"s\">\"abc:types\"</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"../../bin/wasmtime-test/wit/deps/types\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I've tried adding these to the Cargo.toml inside the <code>host</code> wasmtime embedding project but to no avail (I'm guessing that the bindgen! macro doesn't use these).</p>\n<h3>Also for the <code>guest</code>, a single <code>world.wit</code> WIT file, defined as:</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">wasm</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">compression</span><span class=\"o\">/</span><span class=\"n\">compression</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is there something I'm missing for the <code>bindgen!</code> macro options (or for the Cargo.toml on the <code>host</code> side)?</p>\n</blockquote>",
        "id": 537951858,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1757108954
    }
]