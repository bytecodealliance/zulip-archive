[
    {
        "content": "<p>So, I have written an experimental wasi interface and integrated it in wasmtime. I took wasi-keyvalue as an example and tried to replicate it.</p>\n<p>I have built a component that imports that interface. I copied the wit from the wasmtime crate that implements the host and am trying to run it the following way, and with the resulting error message:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">run</span><span class=\"o\">-</span><span class=\"n\">matrix</span><span class=\"o\">-</span><span class=\"n\">example</span><span class=\"p\">()</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">matrix_client</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip2</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">matrix_client</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">component</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">acc</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"o\">-</span><span class=\"n\">allocator</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">draft</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">matching</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linker</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">allocate</span><span class=\"o\">-</span><span class=\"n\">buffer</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">missing</span>\n</code></pre></div>\n<p>I need help in how to debug the linking of functions between the component and the host implementation in wasmtime.</p>",
        "id": 524530735,
        "sender_full_name": "Mats Brorsson",
        "timestamp": 1750186165
    },
    {
        "content": "<p>I think this may mean that <code>src/commands/run.rs </code> needs to be updated with an <code>add_to_linker</code> of the API you added?</p>",
        "id": 524581481,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1750188255
    },
    {
        "content": "<p>e.g. something <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c5fd5bbe7bd8a8ff18801b3d7b17d2ee9b748ed6/src/commands/run.rs#L888-L927\">like this</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/c5fd5bbe7bd8a8ff18801b3d7b17d2ee9b748ed6/src/commands/run.rs#L888-L927\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/94d8ce8ee5b9927d69fee199fe1bb2eab1acfea9/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383264353763643037643039313366663232643931346638333033393233373439363865346337343262353439656238643537356361306264373366636166632f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/c5fd5bbe7bd8a8ff18801b3d7b17d2ee9b748ed6/src/commands/run.rs#L888-L927\" title=\"wasmtime/src/commands/run.rs at c5fd5bbe7bd8a8ff18801b3d7b17d2ee9b748ed6 · bytecodealliance/wasmtime\">wasmtime/src/commands/run.rs at c5fd5bbe7bd8a8ff18801b3d7b17d2ee9b748ed6 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>",
        "id": 524581609,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1750188303
    }
]