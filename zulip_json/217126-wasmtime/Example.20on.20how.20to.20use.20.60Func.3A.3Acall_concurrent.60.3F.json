[
    {
        "content": "<p>Hi everyone. I've updated wasmtime from v27 to v40 aiming to call component functions concurrently (as part of the same Store instance, with dynamically linked components). e.g. say I have WASI CLI A and WASI CLI B and want to run both components concurrently that share the same store and can also communicate between each other.</p>\n<p>I'm trying to implement <a href=\"https://docs.rs/wasmtime/latest/wasmtime/component/struct.Func.html#method.call_concurrent\"><code>Func::call_concurrent</code></a> -- does anyone know if there are any examples for this? I'm not sure if it's possible to do what I'm thinking, perhaps I'd need multiple Stores and to manage the data replication from the host?</p>",
        "id": 566850482,
        "sender_full_name": "Lorenzo",
        "timestamp": 1767834404
    },
    {
        "content": "<p>Most examples at this time will be throughout Wasmtime's test suite, we don't have dedicated examples for this just yet.</p>\n<p>You'll be able to use one store and you'll be using <a href=\"https://docs.rs/wasmtime/latest/wasmtime/struct.StoreContextMut.html#method.run_concurrent\"><code>run_concurrent</code></a> to get an <code>Accessor</code> which from there you can call <code>call_concurrent</code></p>",
        "id": 566968487,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1767885660
    },
    {
        "content": "<p>I see. That sounds good, thanks!</p>",
        "id": 567049639,
        "sender_full_name": "Lorenzo",
        "timestamp": 1767914934
    },
    {
        "content": "<p>I've tried a few different things so far but I only see the components running serially rather than concurrently. It just picks one of 2 components and runs that indefinitely. </p>\n<p>Here's the example component. I'm running two instances of this to test concurrency.<br>\n<a href=\"/user_uploads/15107/b4NJL3XfDrZnzDtrW3qpFfTU/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/b4NJL3XfDrZnzDtrW3qpFfTU/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"814x673\" src=\"/user_uploads/thumbnail/15107/b4NJL3XfDrZnzDtrW3qpFfTU/image.png/840x560.webp\"></a></div><p>So I'd expect to see 2 different program numbers appearing in stdout every second. But only one component is running.</p>\n<p><a href=\"/user_uploads/15107/xYThBB2xSMU9th7lCzubswig/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/xYThBB2xSMU9th7lCzubswig/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"297x267\" src=\"/user_uploads/thumbnail/15107/xYThBB2xSMU9th7lCzubswig/image.png/840x560.webp\"></a></div><p>I've tried different ways to join the tasks, for example like below taken from wasmtime tests.</p>\n<p><a href=\"/user_uploads/15107/bKKfXq2M16erh3B36RcdNosI/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/bKKfXq2M16erh3B36RcdNosI/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1083x494\" src=\"/user_uploads/thumbnail/15107/bKKfXq2M16erh3B36RcdNosI/image.png/840x560.webp\"></a></div><p>Do I have the wrong idea here, Is it not possible to run 2 CLI programs in WASI concurrently? or am I just doing it wrong?</p>",
        "id": 567360344,
        "sender_full_name": "Lorenzo",
        "timestamp": 1768098221
    },
    {
        "content": "<p>You're running into <a href=\"https://docs.rs/wasmtime/latest/wasmtime/struct.StoreContextMut.html#store-blocking-behavior\">this clause of the documentation</a> which is that using <code>tokio</code> in the guest induces \"store blocking behavior\" which means concurrency doesn't work inside of <code>run_concurrent</code></p>",
        "id": 567420149,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1768170694
    },
    {
        "content": "<p>Unfortunately there's no great solution for that at this time, it's one that we need to work on within Wasmtime itself</p>",
        "id": 567420168,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1768170714
    },
    {
        "content": "<p>Oh ok. Thanks for letting me know! Looks like the fix is planned to be included with wasip3, is that right? I'd be happy to help with implementing this.</p>",
        "id": 567421286,
        "sender_full_name": "Lorenzo",
        "timestamp": 1768171786
    },
    {
        "content": "<p>Hey just wanted to note <span class=\"user-mention\" data-user-id=\"755747\">@Lorenzo</span> , a doc comment would probably be appreciated if you were willing to contribute one in the meantime! </p>\n<p>If you went to the rust docs and would have benefitted from seeing a guide to how to use <code>call_concurrent</code> maybe some docs near there would be useful?</p>",
        "id": 567589552,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1768236639
    },
    {
        "content": "<p>Opened here <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12330\">https://github.com/bytecodealliance/wasmtime/pull/12330</a> :)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/12330\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/082eb6d34f2a77893f6c7498622332a47b55ef3e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653834626539353130346334346333386330303831313433346263326635396239303137343933336563616134613064386330303132653261326635363034382f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3132333330&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/12330\" title=\"Update Func &amp; TypedFunc's doc comments to explain  Accessor and Store::run_concurrent by rellfy 路 Pull Request #12330 路 bytecodealliance/wasmtime\">Update Func &amp; TypedFunc's doc comments to explain  Accessor and Store::run_concurrent by rellfy 路 Pull Request #12330 路 bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">We read every piece of feedback, and take your input very seriously.</div></div></div>",
        "id": 567663803,
        "sender_full_name": "Lorenzo Fontoura",
        "timestamp": 1768262758
    },
    {
        "content": "<p>Amazing job <span class=\"user-mention\" data-user-id=\"755747\">@Lorenzo Fontoura</span>!</p>",
        "id": 567849051,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1768334376
    }
]