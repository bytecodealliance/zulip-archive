[
    {
        "content": "<p>Ran into a problem on the JS side of things and wanted to run a quick check by anyone that recognizes this issue.</p>\n<p>I am seemingly running into this excellently-commented condition:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blame/aec935f2e746d71934c8a131be15bbbb4392138c/crates/wasmtime/src/runtime/component/func/host.rs#L269\">https://github.com/bytecodealliance/wasmtime/blame/aec935f2e746d71934c8a131be15bbbb4392138c/crates/wasmtime/src/runtime/component/func/host.rs#L269</a></p>\n<p>Here's the stack (w/ debug) from the JS component in question:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">serve</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Scli</span><span class=\"w\"> </span><span class=\"n\">dist</span><span class=\"o\">/</span><span class=\"n\">fetch</span><span class=\"o\">-</span><span class=\"n\">server</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"n\">Serving</span><span class=\"w\"> </span><span class=\"n\">HTTP</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">http</span><span class=\"p\">:</span><span class=\"c1\">//0.0.0.0:8080/</span>\n<span class=\"mi\">2025</span><span class=\"o\">-</span><span class=\"mi\">07</span><span class=\"o\">-</span><span class=\"mi\">22</span><span class=\"n\">T08</span><span class=\"p\">:</span><span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mf\">40.664758</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">ERROR</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cli</span><span class=\"p\">::</span><span class=\"n\">commands</span><span class=\"p\">::</span><span class=\"n\">serve</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe6ee26</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">::</span><span class=\"n\">descriptors</span><span class=\"p\">::</span><span class=\"n\">Descriptors</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">::</span><span class=\"n\">h33060ed6fe1110fb</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe6e140</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">::</span><span class=\"n\">State</span><span class=\"p\">::</span><span class=\"n\">descriptors</span><span class=\"p\">::</span><span class=\"n\">hf646fa16f2768d61</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe6e453</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">fd_write</span>\n<span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe7153f</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">adapt</span><span class=\"o\">-</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"o\">-</span><span class=\"n\">fd_write</span>\n<span class=\"w\">    </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x86db89</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__wasi_fd_write</span>\n<span class=\"w\">    </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x872d8d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">writev</span>\n<span class=\"w\">    </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x872e0d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__stdio_write</span>\n<span class=\"w\">    </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x873f3e</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">vfprintf</span>\n<span class=\"w\">    </span><span class=\"mi\">8</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x87324f</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">fprintf</span>\n<span class=\"w\">    </span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x1d59a2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">cabi_realloc</span>\n<span class=\"w\">   </span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe713f3</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">indirect</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">http</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.2.3</span><span class=\"o\">-</span><span class=\"p\">[</span><span class=\"n\">method</span><span class=\"p\">]</span><span class=\"n\">incoming</span><span class=\"o\">-</span><span class=\"n\">request</span><span class=\"p\">.</span><span class=\"n\">authority</span>\n<span class=\"w\">   </span><span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x886f00</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">host_api</span><span class=\"p\">::</span><span class=\"n\">HttpRequestResponseBase</span><span class=\"p\">::</span><span class=\"n\">url</span><span class=\"p\">()</span>\n<span class=\"w\">   </span><span class=\"mi\">12</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x8d9a4c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">builtins</span><span class=\"p\">::</span><span class=\"n\">web</span><span class=\"p\">::</span><span class=\"n\">fetch</span><span class=\"p\">::</span><span class=\"n\">fetch_event</span><span class=\"p\">::</span><span class=\"n\">handle_incoming_request</span><span class=\"p\">(</span><span class=\"n\">host_api</span><span class=\"p\">::</span><span class=\"n\">HttpIncomingRequest</span><span class=\"o\">*</span><span class=\"p\">)</span>\n<span class=\"w\">   </span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x88a8ce</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__wasm_export_exports_wasi_http_incoming_handler_handle</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">leave</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">instance</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">guest</span><span class=\"w\"> </span><span class=\"n\">never</span><span class=\"w\"> </span><span class=\"n\">invoked</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">response</span><span class=\"o\">-</span><span class=\"n\">outparam</span><span class=\"p\">::</span><span class=\"n\">set</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">method</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe6ee26</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">::</span><span class=\"n\">descriptors</span><span class=\"p\">::</span><span class=\"n\">Descriptors</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">::</span><span class=\"n\">h33060ed6fe1110fb</span>\n<span class=\"w\">           </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe6e140</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">::</span><span class=\"n\">State</span><span class=\"p\">::</span><span class=\"n\">descriptors</span><span class=\"p\">::</span><span class=\"n\">hf646fa16f2768d61</span>\n<span class=\"w\">           </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe6e453</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">adapter</span><span class=\"p\">:</span><span class=\"nc\">wasi_snapshot_preview1</span><span class=\"o\">!</span><span class=\"n\">fd_write</span>\n<span class=\"w\">           </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe7153f</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">adapt</span><span class=\"o\">-</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"o\">-</span><span class=\"n\">fd_write</span>\n<span class=\"w\">           </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x86db89</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__wasi_fd_write</span>\n<span class=\"w\">           </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x872d8d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">writev</span>\n<span class=\"w\">           </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x872e0d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__stdio_write</span>\n<span class=\"w\">           </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x873f3e</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">vfprintf</span>\n<span class=\"w\">           </span><span class=\"mi\">8</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x87324f</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">fprintf</span>\n<span class=\"w\">           </span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x1d59a2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">cabi_realloc</span>\n<span class=\"w\">          </span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xe713f3</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"p\">:</span><span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">indirect</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">http</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.2.3</span><span class=\"o\">-</span><span class=\"p\">[</span><span class=\"n\">method</span><span class=\"p\">]</span><span class=\"n\">incoming</span><span class=\"o\">-</span><span class=\"n\">request</span><span class=\"p\">.</span><span class=\"n\">authority</span>\n<span class=\"w\">          </span><span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x886f00</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">host_api</span><span class=\"p\">::</span><span class=\"n\">HttpRequestResponseBase</span><span class=\"p\">::</span><span class=\"n\">url</span><span class=\"p\">()</span>\n<span class=\"w\">          </span><span class=\"mi\">12</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x8d9a4c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">builtins</span><span class=\"p\">::</span><span class=\"n\">web</span><span class=\"p\">::</span><span class=\"n\">fetch</span><span class=\"p\">::</span><span class=\"n\">fetch_event</span><span class=\"p\">::</span><span class=\"n\">handle_incoming_request</span><span class=\"p\">(</span><span class=\"n\">host_api</span><span class=\"p\">::</span><span class=\"n\">HttpIncomingRequest</span><span class=\"o\">*</span><span class=\"p\">)</span>\n<span class=\"w\">          </span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x88a8ce</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__wasm_export_exports_wasi_http_incoming_handler_handle</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">leave</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">instance</span>\n</code></pre></div>\n<p>The actual code in question is in componentize-js -- a <code>LOG</code> macro we use to take advantage of when wizer debugging is enabled.</p>\n<p><strong>Here's the real question:</strong></p>\n<p>The error above happens during a <code>wasi:http/incoming-handler#handle</code> call but <em>does not</em> happen during a simple interface call (ex. <code>export run: func() -&gt; string;</code>) call.</p>\n<p>So the \"simple\" interface essentially runs to completion properly despite as far as I can tell doing the same thing:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">➜</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Scli</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">run</span><span class=\"p\">()</span><span class=\"o\">'</span><span class=\"w\">  </span><span class=\"n\">dist</span><span class=\"o\">/</span><span class=\"n\">fetch</span><span class=\"o\">-</span><span class=\"n\">server</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"kt\">i32</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">setting</span><span class=\"w\"> </span><span class=\"n\">args</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">setting</span><span class=\"w\"> </span><span class=\"n\">retptr</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">JS</span><span class=\"w\"> </span><span class=\"n\">lowering</span><span class=\"w\"> </span><span class=\"n\">call</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">getting</span><span class=\"w\"> </span><span class=\"n\">promise</span><span class=\"w\"> </span><span class=\"k\">return</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"n\">promise</span><span class=\"w\"> </span><span class=\"n\">reactions</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">driving</span><span class=\"w\"> </span><span class=\"n\">event</span><span class=\"w\"> </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">promise</span><span class=\"w\"> </span><span class=\"n\">completion</span>\n<span class=\"p\">(</span><span class=\"n\">cabi_realloc</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"mi\">3140416</span>\n\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">then</span><span class=\"w\"> </span><span class=\"n\">handler</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">retrieving</span><span class=\"w\"> </span><span class=\"n\">promise</span><span class=\"w\"> </span><span class=\"n\">result</span>\n<span class=\"p\">(</span><span class=\"n\">call</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">end</span>\n<span class=\"s\">\"DONE!\"</span>\n</code></pre></div>\n<p>What am I missing here about the difference between a \"simple\" interface call (you can see the <a href=\"https://github.com/bytecodealliance/ComponentizeJS/blob/main/embedding/embedding.cpp#L143\"><code>cabi_realloc</code> log line in question</a> there in the output), and a more complex call like <code>wasi:http/incoming-handler.handle</code>.</p>\n<p>If I remove the log line in <code>cabi_realloc</code>, the problem is fixed -- the call works finishes as expected.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blame/aec935f2e746d71934c8a131be15bbbb4392138c/crates/wasmtime/src/runtime/component/func/host.rs#L269\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/99c0ef31d2b7a90d75cbc26ffc7974ea461d47bb/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353135343761383139653861373866356239303035623636663836396231383133623836343566303666636166343162663332643438356161343434643237662f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blame/aec935f2e746d71934c8a131be15bbbb4392138c/crates/wasmtime/src/runtime/component/func/host.rs#L269\" title=\"Blaming wasmtime/crates/wasmtime/src/runtime/component/func/host.rs at aec935f2e746d71934c8a131be15bbbb4392138c · bytecodealliance/wasmtime\">Blaming wasmtime/crates/wasmtime/src/runtime/component/func/host.rs at aec935f2e746d71934c8a131be15bbbb4392138c · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - Blaming wasmtime/crates/wasmtime/src/runtime/component/func/host.rs at aec935f2e746d71934c8a131be15bbbb4392138c · b...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/ComponentizeJS/blob/main/embedding/embedding.cpp#L143\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/2649a49e2cf8dd4bc7f496faf2c1ee4cbed3ee8d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633232363963303366366566383239313433383537663738636336303562633633393365636635303333323537346663646135316166326539303534303035312f62797465636f6465616c6c69616e63652f436f6d706f6e656e74697a654a53&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/ComponentizeJS/blob/main/embedding/embedding.cpp#L143\" title=\"ComponentizeJS/embedding/embedding.cpp at main · bytecodealliance/ComponentizeJS\">ComponentizeJS/embedding/embedding.cpp at main · bytecodealliance/ComponentizeJS</a></div><div class=\"message_embed_description\">JS -&gt; WebAssembly Component. Contribute to bytecodealliance/ComponentizeJS development by creating an account on GitHub.</div></div></div>",
        "id": 530094941,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1753173361
    },
    {
        "content": "<p>You might be running into different signatures having different runtime/allocation behavior? It's true though that at this time once you're in <code>cabi_realloc</code> it's not valid to call out to the host meaning (regrettably) even logging isn't allowed</p>",
        "id": 530155269,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1753193278
    }
]