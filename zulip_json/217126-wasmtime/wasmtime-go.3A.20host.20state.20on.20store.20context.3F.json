[
    {
        "content": "<p>In Rust, a Store&lt;T&gt; has a data method that returns T. When you create a store you can pass in arbitrary data, and then get a pointer to it later. This makes it suitable for storing store-specific state.</p>\n<p>Is there something similar in wasmtime-go? Based on the package docs, it doesn't <em>appear</em> to be available. To get something similar in Go one option is to recreate the linker for each store so you can link host functions as methods on a \"state\" struct, but it'd be nice to reuse the linker and then access the state in host calls via, eg, <code>caller.Data()</code>.</p>\n<p>Am I missing something?</p>",
        "id": 553701913,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762286265
    },
    {
        "content": "<p>Currently this isn't supported yeah. The C API provides a <code>void*</code> pointer storage in a <code>wasmtime_store_t</code> (which is what the Go <code>Store</code> uses) which would probably be suitable for mapping an <code>interface{}</code> into similar to how linker host functions work though</p>",
        "id": 553702896,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1762286644
    },
    {
        "content": "<p>Was just looking at the store.go implementation and noticed the <code>gStoreMap</code> and the slab and so on and it seemed reasonable to attach something like <code>extra interface{}</code> to the <code>storeData</code> type and make it available via <code>Storelike.Data()</code> which the caller can cast to their own type.</p>\n<p>Set it via <code>NewStoreData(engine *Engine, data any) *Store</code> maybe?</p>\n<p>I know little about wasmtime internals and even less about cgo, but it seems like there's room to do this.</p>",
        "id": 553703508,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762286886
    },
    {
        "content": "<p>oh true! It's been awhile so I forgot about this...</p>",
        "id": 553704741,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1762287316
    },
    {
        "content": "<p>but yeah adding a field to <code>storeData</code> seems reasonable!</p>",
        "id": 553704749,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1762287323
    },
    {
        "content": "<p>I'll give it a shot myself</p>",
        "id": 553704795,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762287341
    },
    {
        "content": "<p>Been awhile since I've worked on my wasmtime go project but had some recent interest to give it another shot, so now I'm looking at general refactorings</p>",
        "id": 553704871,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762287376
    },
    {
        "content": "<p>Currently I have a huge struct with a bunch of methods attached that I relink and have to remember to reset per instantiation, but if I can separate the struct from the functions it should be a bit cleaner..</p>",
        "id": 553705084,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762287475
    },
    {
        "content": "<p>That'd be much appreciated, thanks!</p>",
        "id": 553705860,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1762287745
    },
    {
        "content": "<p>Ok. Got a working version. Forgot I need to fork to send a pull request. Incoming....</p>",
        "id": 553718715,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762291091
    },
    {
        "content": "<p><a href=\"https://github.com/bytecodealliance/wasmtime-go/pull/260\">https://github.com/bytecodealliance/wasmtime-go/pull/260</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime-go/pull/260\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/2d5641e3d87ba4e34a5440d95913aa47bbf9089b/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323238663036653034613865363661396531613034346664363136366630383562663636366562393037343134333462663466336132343630326433396430392f62797465636f6465616c6c69616e63652f7761736d74696d652d676f2f70756c6c2f323630&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime-go/pull/260\" title=\"Support storing arbitrary data on Store by avidal 路 Pull Request #260 路 bytecodealliance/wasmtime-go\">Support storing arbitrary data on Store by avidal 路 Pull Request #260 路 bytecodealliance/wasmtime-go</a></div><div class=\"message_embed_description\">This patch introduces Storelike.Data and NewStoreWithData which can be used to attach arbitrary data to a *Store which is also accessible from *Caller.\nUsing this, embedders can use a shared linker...</div></div></div>",
        "id": 553719018,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762291220
    },
    {
        "content": "<p>And merged, amazing.</p>\n<p>Thanks for the quick review <span class=\"user-mention\" data-user-id=\"253994\">@Alex Crichton</span> !</p>",
        "id": 553728252,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762295469
    },
    {
        "content": "<p>I guess last step is release v38.0.1?</p>",
        "id": 553728335,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762295522
    },
    {
        "content": "<p>Mind filing an issue for that? That'll remind me to get to it tomorrow</p>",
        "id": 553728429,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1762295556
    },
    {
        "content": "<p>(winding down for the day on my end)</p>",
        "id": 553728447,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1762295560
    },
    {
        "content": "<p>Yup, of course. No rush.</p>",
        "id": 553728478,
        "sender_full_name": "Alex Vidal",
        "timestamp": 1762295568
    }
]