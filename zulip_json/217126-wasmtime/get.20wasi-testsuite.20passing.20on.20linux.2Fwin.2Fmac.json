[
    {
        "content": "<p>Hello dear wasmtime people :)</p>\n<p>So, <a href=\"https://github.com/WebAssembly/wasi-testsuite/\">wasi-testsuite</a> is of limited utility until its tests pass on all platforms.  If anyone has some spare spoons, I have some concrete things that need fixing in order to have fully green tests when running with Wasmtime.</p>\n<p>Highest priority things that would allow us to be green on Ubuntu:</p>\n<ul>\n<li>A fix needed for rmdir when argument has trailing slashes (affects all platforms, all wasi versions): <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11524\">https://github.com/bytecodealliance/wasmtime/issues/11524</a></li>\n<li>Need new wasmtime release, to have a release with <a href=\"https://github.com/bytecodealliance/wasmtime/issues/11736\">https://github.com/bytecodealliance/wasmtime/issues/11736</a>.</li>\n</ul>\n<p>Next highest that would allow us to be green on MacOS:</p>\n<ul>\n<li><code>fadvise</code> behaving differently on MacOS; weirdly Windows is fine, for once <a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/178\">https://github.com/WebAssembly/wasi-testsuite/issues/178</a>; I think that Wasmtime should shim this one.</li>\n</ul>\n<p>Next highest priority that would allow the WASIp3 test suite to be green on Windows:</p>\n<ul>\n<li>Oddity when opening a directory with <code>WRITE</code> flags: <a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/176\">https://github.com/WebAssembly/wasi-testsuite/issues/176</a>; ideally we make Windows behave as in the test, but if needed we can relax the spec.</li>\n<li>Different errno for a failure to hard-link: <a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/177\">https://github.com/WebAssembly/wasi-testsuite/issues/177</a>; same as above.</li>\n</ul>\n<p>You can get the Wasm files mentioned in the bug reports here: <a href=\"https://github.com/WebAssembly/wasi-testsuite/tree/prod/testsuite-base/tests/rust/testsuite\">https://github.com/WebAssembly/wasi-testsuite/tree/prod/testsuite-base/tests/rust/testsuite</a>.</p>\n<p>Finally there is an excruciating slog of around 30 failures for Rust WASIp1 tests in Windows: <a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/175\">https://github.com/WebAssembly/wasi-testsuite/issues/175</a>.  I think it's mostly \"expected an error but not that one\" failures; given that it's WASIp1, I suggest that we just relax those tests, as a first approach.  I.e. we don't assume they are wasmtime bugs.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/59cb9589c1b1119075ff375429fc96cad820f452/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613261316533323965613634666235343065346233653832336637326462656462666537303665353064653039303531343661343138616235356437316133312f576562417373656d626c792f776173692d746573747375697465&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/\" title=\"GitHub - WebAssembly/wasi-testsuite: WASI Testsuite\">GitHub - WebAssembly/wasi-testsuite: WASI Testsuite</a></div><div class=\"message_embed_description\">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/tree/prod/testsuite-base/tests/rust/testsuite\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/59cb9589c1b1119075ff375429fc96cad820f452/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613261316533323965613634666235343065346233653832336637326462656462666537303665353064653039303531343661343138616235356437316133312f576562417373656d626c792f776173692d746573747375697465&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/tree/prod/testsuite-base/tests/rust/testsuite\" title=\"wasi-testsuite/tests/rust/testsuite at prod/testsuite-base · WebAssembly/wasi-testsuite\">wasi-testsuite/tests/rust/testsuite at prod/testsuite-base · WebAssembly/wasi-testsuite</a></div><div class=\"message_embed_description\">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/issues/175\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/bb0da3c75b67861ea3c0d8d18ed56dd12dcdb527/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f313332356263353835343466646133343932373039616235386132343766323132333437373964623534653730656633336136643039646130393465623861382f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313735&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/175\" title=\"WASIp1 tests failing on Windows · Issue #175 · WebAssembly/wasi-testsuite\">WASIp1 tests failing on Windows · Issue #175 · WebAssembly/wasi-testsuite</a></div><div class=\"message_embed_description\">WASIp1 tests dangling_fd wasmtime --dir 'tests\\rust\\testsuite\\wasm32-wasip1\\fs-tests.dir::fs-tests.dir' 'tests\\rust\\testsuite\\wasm32-wasip1\\dangling_fd.wasm' fs-tests.dir Test dangling_fd failed [e...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/11524\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/7902cdd4f4a51cccfe5b81c2be028337e1923906/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f346136383739653765643935373264393837383536346133336361316230343830363634666337613331656438613961333939666134363338386334653566632f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131353234&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/11524\" title=\"wasip1 path_remove_directory fails with paths with trailing slashes · Issue #11524 · bytecodealliance/wasmtime\">wasip1 path_remove_directory fails with paths with trailing slashes · Issue #11524 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Test Case For the wasi-testsuite test remove_directory_trailing_slashes, we mkdir dir.cleanup, then try to rrmdir dir.cleanup/ (note trailing slash). This fails because it uses the \"get the parent ...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/11736\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/7459eda216c18909b941dd749a6d404c1e0845d4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636364383862623964306363613134373466326663376536326239643061393830616235396137636331346633373130353334663231363138626334393630352f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131373336&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/11736\" title=\"Add WASIp3 HTTP to `wasmtime run` · Issue #11736 · bytecodealliance/wasmtime\">Add WASIp3 HTTP to `wasmtime run` · Issue #11736 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Hello, Running wasmtime run on a component that uses wasi:http fails: [dev-env] wingo@beastie ~/src/wasip3/wasi-testsuite/tests/rust/wasm32-wasip3$ ~/src/wasip3/wasmtime/target/release/wasmtime -Wc...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/issues/178\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/b1bd85300e7d0551135b6eb5fd67b08f9c7e2947/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333136636364663937663734666534636639303365386463363066326531373466303231353265306239373339663830366234363231396261623539383765362f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313738&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/178\" title=\"wasip3: descriptor#advise for will-need behaves differently between macos and everything else · Issue #178 · WebAssembly/wasi-testsuite\">wasip3: descriptor#advise for will-need behaves differently between macos and everything else · Issue #178 · WebAssembly/wasi-testsuite</a></div><div class=\"message_embed_description\">On MacOS with wasmtime, filesystem-advice fails: Test filesystem-advise failed [exit_code] 0 == 1 STDOUT: STDERR: fadvise(7, 0, Advice::WillNeed) =&gt; file-too-large (error 7) This test passes on Win...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/issues/176\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/c8fa8fde1bdf14bace88dbbf522c37f56231893d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f643037613762353339636230643039333266383165316636656330323261343465646433316433616530326165343461663235303136666466613862373032622f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313736&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/176\" title=\"wasip3: descriptor#open-at(&quot;.&quot;) behavior when WRITE flag passed differs between Windows and Unix · Issue #176 · WebAssembly/wasi-testsuite\">wasip3: descriptor#open-at(\".\") behavior when WRITE flag passed differs between Windows and Unix · Issue #176 · WebAssembly/wasi-testsuite</a></div><div class=\"message_embed_description\">On Linux, with wasmtime, if you open a directory with the WRITE flag (but no read flag), it fails with EISDIR. On Windows, it succeeds. This occurs in the wasip3 filesystem-flags-and-type test. Is ...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/issues/177\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/b2897e4cd166facde7c2c1a5fef49ff0919f60a4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323638636630613564303439303538373865333733613530636534393665313766306562303732386634613933363932313863353238383765316638386663382f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313737&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/issues/177\" title=\"wasip3: Error when attempting to hard-link a directory differs between windows and unix · Issue #177 · WebAssembly/wasi-testsuite\">wasip3: Error when attempting to hard-link a directory differs between windows and unix · Issue #177 · WebAssembly/wasi-testsuite</a></div><div class=\"message_embed_description\">On Unix, if you attempt to hard-link a directory, you get not-permitted. On Windows, you get access. Can these be made the same or should they be documented to be different? Command line: wasmtime ...</div></div></div>",
        "id": 543548853,
        "sender_full_name": "Andy Wingo",
        "timestamp": 1759847783
    },
    {
        "content": "<blockquote>\n<p>Need new wasmtime release</p>\n</blockquote>\n<p>For this at least Wasmtime 38 will suffice which'll get released on Oct 20</p>",
        "id": 543552020,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1759848515
    },
    {
        "content": "<p>Thanks for writing this up though! I can try to poke at some of these things between builds this week</p>",
        "id": 543554173,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1759849020
    },
    {
        "content": "<p>Hm, actually, Andy would you be up for poking around in Wasmtime for this? Or would you prefer to stick to writing tests? I'm mostly fearful that this is going to create a very long backlog we don't have resources to apply at this time. The backlog is not itself the problem but having tests that don't pass anywhere isn't the best situation to be in either</p>",
        "id": 543573905,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1759854155
    },
    {
        "content": "<p>For example I just <a href=\"https://github.com/bytecodealliance/wasmtime/pull/11802\">updated wasi-testsuite in Wasmtime</a> and the <a href=\"http://http-response.rs\">http-response.rs</a> test is failing because Wasmtime thinks 600 is a valid response status code but the test asserts that it isn't. Wasmtime's behavior comes from <a href=\"https://docs.rs/http/latest/http/status/struct.StatusCode.html#method.from_u16\">here</a> and don't really have the energy myself to open up issues and figure out what the best course of action is here, but you probably have more knowledge about whether 600 should be invalid for example. It's trivial enough to add more validation to the implementation in Wasmtime, but basically I don't know what's the right thing to do here</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/11802\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/608139c3e1d29af1e10e1a20d5d2fb8ffe5d0e5c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376230366562616630613630643534613962383330613161343738346234313963386366306664356637393230656234653831333730346464366465346131352f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3131383032&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/11802\" title=\"Update wasi-testsuite submodule by alexcrichton · Pull Request #11802 · bytecodealliance/wasmtime\">Update wasi-testsuite submodule by alexcrichton · Pull Request #11802 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Bring in some infrastructure for running wasip3 tests. There's a few current test failures which are flagged here as well.\nprtest:full</div></div></div>",
        "id": 543574233,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1759854257
    },
    {
        "content": "<p>fwiw the test was passing on wasmtime built from git, at least a week ago; will check tomorrow.  i wouldn't have sent it on if it didn't pass <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 543617173,
        "sender_full_name": "Andy Wingo",
        "timestamp": 1759869302
    },
    {
        "content": "<p>i hit merge on what i thought was a trivial PR of alex's and then CI failed on main</p>",
        "id": 543625205,
        "sender_full_name": "Pat Hickey",
        "timestamp": 1759872751
    },
    {
        "content": "<p><a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/18326423979\">https://github.com/WebAssembly/wasi-testsuite/actions/runs/18326423979</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/18326423979\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/a2699abe92e563bbeedca2b761ac79245f0f94a4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336631303065396661363964343837336566383064313735616230373636643531646564393337326533643435356431353637653333616462636631316435392f576562417373656d626c792f776173692d746573747375697465&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-testsuite/actions/runs/18326423979\" title=\"Merge pull request #179 from alexcrichton/update-install-wasmtime · WebAssembly/wasi-testsuite@f046501\">Merge pull request #179 from alexcrichton/update-install-wasmtime · WebAssembly/wasi-testsuite@f046501</a></div><div class=\"message_embed_description\">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div>",
        "id": 543625256,
        "sender_full_name": "Pat Hickey",
        "timestamp": 1759872770
    },
    {
        "content": "<p>Ah no worries! I find github actions' UI isn't great for \"this job is allowed to fail\" myself... Not sure if that's what happened here though, but should be easy-ish to fix either way</p>",
        "id": 543629555,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1759874981
    },
    {
        "content": "<p>er, this was in response to Andy not you Pat, that I have no idea lol</p>",
        "id": 543629616,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1759875009
    },
    {
        "content": "<p>yaargh, sorry about that CI thing, will fix</p>",
        "id": 543736438,
        "sender_full_name": "Andy Wingo",
        "timestamp": 1759926906
    }
]