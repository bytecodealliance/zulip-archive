[
    {
        "content": "<p>In older versions of wasmtime, we could easily disable caching by setting <code>enabled = false</code> in the <code>config.toml</code> file. This was updated in v33.0.0.</p>\n<p>Now looking at the docs, it is not clear how to disable caching when using the wasmtime CLI. According to <a href=\"https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.cache\">https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.cache</a> it seems that newly created configs should have caching disabled by default? But our testing shows that it is still enabled even with an empty config file.</p>\n<p>Running a certain wasm module for the first time takes around 0.23 seconds, subsequent runs take about 0.07 seconds. The caching directory is also created after the first run.</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>ls<span class=\"w\"> </span>-la<span class=\"w\"> </span>~/.config/\n<span class=\"go\">total 12</span>\n<span class=\"go\">drwx------  3 ubuntu ubuntu 4096 Jul 10 18:42 .</span>\n<span class=\"go\">drwxr-x--- 13 ubuntu ubuntu 4096 Jul 10 18:30 ..</span>\n<span class=\"go\">drwx------  2 ubuntu ubuntu 4096 Jul  9 22:36 procps</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>ls<span class=\"w\"> </span>-la<span class=\"w\"> </span>~/.cache/\n<span class=\"go\">total 12</span>\n<span class=\"go\">drwx------  3 ubuntu ubuntu 4096 Jul 10 18:42 .</span>\n<span class=\"go\">drwxr-x--- 13 ubuntu ubuntu 4096 Jul 10 18:30 ..</span>\n<span class=\"go\">drwxrwxr-x 19 ubuntu ubuntu 4096 Jul  4 10:57 ccache</span>\n<span class=\"go\">-rw-r--r--  1 ubuntu ubuntu    0 Jul  4 10:22 motd.legal-displayed</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>wasmtime<span class=\"w\"> </span>config<span class=\"w\"> </span>new\n<span class=\"go\">Successfully created a new configuration file at '/home/ubuntu/.config/wasmtime/config.toml'.</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>cat<span class=\"w\"> </span>~/.config/wasmtime/config.toml\n<span class=\"gp\"># </span>Comment<span class=\"w\"> </span>out<span class=\"w\"> </span>certain<span class=\"w\"> </span>settings<span class=\"w\"> </span>to<span class=\"w\"> </span>use<span class=\"w\"> </span>default<span class=\"w\"> </span>values.\n<span class=\"gp\"># </span>For<span class=\"w\"> </span>more<span class=\"w\"> </span>settings,<span class=\"w\"> </span>please<span class=\"w\"> </span>refer<span class=\"w\"> </span>to<span class=\"w\"> </span>the<span class=\"w\"> </span>documentation:\n<span class=\"gp\"># </span>https://bytecodealliance.github.io/wasmtime/cli-cache.html\n\n<span class=\"go\">[cache]</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>/usr/bin/time<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>funky-kart.wasm\n<span class=\"go\">0.67user 0.06system 0:00.23elapsed 309%CPU (0avgtext+0avgdata 91180maxresident)k</span>\n<span class=\"go\">0inputs+4272outputs (0major+29045minor)pagefaults 0swaps</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>ls<span class=\"w\"> </span>-la<span class=\"w\"> </span>~/.cache/\n<span class=\"go\">total 16</span>\n<span class=\"go\">drwx------  4 ubuntu ubuntu 4096 Jul 10 18:43 .</span>\n<span class=\"go\">drwxr-x--- 13 ubuntu ubuntu 4096 Jul 10 18:30 ..</span>\n<span class=\"go\">drwxrwxr-x 19 ubuntu ubuntu 4096 Jul  4 10:57 ccache</span>\n<span class=\"go\">-rw-r--r--  1 ubuntu ubuntu    0 Jul  4 10:22 motd.legal-displayed</span>\n<span class=\"go\">drwxrwxr-x  3 ubuntu ubuntu 4096 Jul 10 18:43 wasmtime</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>/usr/bin/time<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>funky-kart.wasm\n<span class=\"go\">0.05user 0.02system 0:00.07elapsed 100%CPU (0avgtext+0avgdata 29668maxresident)k</span>\n<span class=\"go\">0inputs+8outputs (0major+6558minor)pagefaults 0swaps</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$ </span>/usr/bin/time<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>funky-kart.wasm\n<span class=\"go\">0.06user 0.01system 0:00.07elapsed 100%CPU (0avgtext+0avgdata 29672maxresident)k</span>\n<span class=\"go\">0inputs+8outputs (0major+6560minor)pagefaults 0swaps</span>\n<span class=\"gp\">ubuntu@benchmarkb:/tmp$</span>\n</code></pre></div>\n<p>What is (if possible?) the new way to disable caching entirely when using the CLI? We need this to effectively compare JIT vs. AOT.</p>",
        "id": 528123585,
        "sender_full_name": "Michiel Van Kenhove (imec-UGent)",
        "timestamp": 1752166090
    },
    {
        "content": "<p>Disabling via the cli can be done with <code>-Ccache=n</code> but it's true that 33 changed that you can't have a config file itself disable caching. If that's desired though we can add that back in.</p>\n<p>FWIW the documentation on <code>Config</code> is accurate, but the CLI switches some defaults such as for caching</p>",
        "id": 528123995,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1752166258
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"734590\">Michiel Van Kenhove (imec-UGent)</span> has marked this topic as resolved.</p>",
        "id": 528124941,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752166553
    }
]