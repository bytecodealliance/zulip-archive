[
    {
        "content": "<p>Currently in Wasmtime's API we have <code>Func::call{,_async}</code>. When calling these functions we additionally require embedders to call <code>Func::post_return{,_async}</code>. The intention here was to enable hosts to type guest return values with <code>WasmStr</code> and <code>WasmList&lt;T&gt;</code> to enable zero-copy usage of wasm return values.</p>\n<p>In practice, however, bindings generation never uses <code>WasmStr</code> nor <code>WasmList</code>. Additionally they're cumbersome and not super well documented. So my theory at this current time is no one is using this capability despite perhaps wanting such a capability in the future.</p>\n<p>The reason I ask is that <code>call_concurrent</code>, added with component-model-async, already acts quite differently. The <code>call_concurrent</code> function automatically calls post-return for async reasons. This split has been a source of bugs and headaches and in talking with <span class=\"user-mention\" data-user-id=\"509936\">@Joel Dice</span> we're concluding that the best route forward would be to (a) remove the embedder-level API of <code>Func::post_return</code> and (b) in the future add a method of calling a function where the results are communicated via a closure. This closure would be able to use <code>WasmStr</code>/<code>WasmList</code> and would work with <code>call_concurrent</code>.</p>\n<p>I wanted to ask, though, is anyone using this functionality? If so we can plan more on keeping it in the meantime and/or game out what this closure-based API would look like.</p>",
        "id": 570861394,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1769709265
    },
    {
        "content": "<p>This change is landing in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/12498\">https://github.com/bytecodealliance/wasmtime/pull/12498</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/12498\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/f104768c77465a68c8beae07921c0a06aa82a165/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356562363865353636313433313966343034613134373932373033643730363233386236656331373636653233626565343865633864393536376366316537392f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3132343938&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/12498\" title=\"deprecate `[Typed]Func::post_return[_async]` and make them no-ops by dicej 路 Pull Request #12498 路 bytecodealliance/wasmtime\">deprecate `[Typed]Func::post_return[_async]` and make them no-ops by dicej 路 Pull Request #12498 路 bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">With the advent of the Component Model concurrency ABI and it&#39;s task.return intrinsic, post-return functions have been informally deprecated and are expected to be removed for WASI 1.0 and the ...</div></div></div>",
        "id": 571744276,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1770146681
    }
]