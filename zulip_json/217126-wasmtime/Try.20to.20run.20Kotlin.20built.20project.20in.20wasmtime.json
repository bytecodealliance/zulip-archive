[
    {
        "content": "<p>Hi everyone! I'm trying run Kotlin built project in wasmtime (yes, I know it's not officially supported) with WASI HTTP components. When I try to start it in wasmtime with some custom components like in this branch:<br>\n<a href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/test\">https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/test</a> <br>\nit throws error with mentioning custom components</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>serve<span class=\"w\"> </span>-W<span class=\"w\"> </span><span class=\"k\">function</span>-references,gc,component-model<span class=\"w\"> </span>build/out/component/kco-wasm-wasi.uncomposed.wasm\nError:<span class=\"w\"> </span>component<span class=\"w\"> </span>imports<span class=\"w\"> </span>instance<span class=\"w\"> </span><span class=\"sb\">`</span>component-model:example/ui<span class=\"sb\">`</span>,<span class=\"w\"> </span>but<span class=\"w\"> </span>a<span class=\"w\"> </span>matching<span class=\"w\"> </span>implementation<span class=\"w\"> </span>was<span class=\"w\"> </span>not<span class=\"w\"> </span>found<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>the<span class=\"w\"> </span>linker\n\nCaused<span class=\"w\"> </span>by:\n<span class=\"w\">    </span><span class=\"m\">0</span>:<span class=\"w\"> </span>instance<span class=\"w\"> </span><span class=\"nb\">export</span><span class=\"w\"> </span><span class=\"sb\">`</span>create-button<span class=\"sb\">`</span><span class=\"w\"> </span>has<span class=\"w\"> </span>the<span class=\"w\"> </span>wrong<span class=\"w\"> </span><span class=\"nb\">type</span>\n<span class=\"w\">    </span><span class=\"m\">1</span>:<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span>implementation<span class=\"w\"> </span>is<span class=\"w\"> </span>missing\n</code></pre></div>\n<p>when I remove custom components and leave only wasi-http components like here:<br>\n<a href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/wasmtime\">https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/wasmtime</a><br>\nit throws error with incoming-handler mentioning:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">serve</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"o\">-</span><span class=\"n\">references</span><span class=\"p\">,</span><span class=\"n\">gc</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">component</span><span class=\"o\">/</span><span class=\"n\">kco</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">uncomposed</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">no</span><span class=\"w\"> </span><span class=\"n\">exported</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">named</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">http</span><span class=\"o\">/</span><span class=\"n\">incoming</span><span class=\"o\">-</span><span class=\"n\">handler</span><span class=\"o\">@</span><span class=\"mf\">0.2.3</span>\n</code></pre></div>\n<p>it confuses me because I set 0.2.0 version in WIT components, not 0.2.3<br>\n<a href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/blob/wasmtime/wit/deps/http/proxy.wit#L1\">https://github.com/dmchub/kotlin-wasm-cm-experiments/blob/wasmtime/wit/deps/http/proxy.wit#L1</a><br>\nHow can I fix <code>wasi:http/incoming-handler@0.2.3</code> issue? Or maybe it's possible to add custom components in the linker?</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/test\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/997efc04eb718e8c72a0579b563066d4e953107a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333362623263643963326631363332353762323039623634343864393831663564323931356138356162663532386439376335383565653932663139303066302f646d636875622f6b6f746c696e2d7761736d2d636d2d6578706572696d656e7473&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/test\" title=\"GitHub - dmchub/kotlin-wasm-cm-experiments at test\">GitHub - dmchub/kotlin-wasm-cm-experiments at test</a></div><div class=\"message_embed_description\">Experiments with running Kotlin/Wasm with Component Model - GitHub - dmchub/kotlin-wasm-cm-experiments at test</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/wasmtime\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/997efc04eb718e8c72a0579b563066d4e953107a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333362623263643963326631363332353762323039623634343864393831663564323931356138356162663532386439376335383565653932663139303066302f646d636875622f6b6f746c696e2d7761736d2d636d2d6578706572696d656e7473&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/tree/wasmtime\" title=\"GitHub - dmchub/kotlin-wasm-cm-experiments at wasmtime\">GitHub - dmchub/kotlin-wasm-cm-experiments at wasmtime</a></div><div class=\"message_embed_description\">Experiments with running Kotlin/Wasm with Component Model - GitHub - dmchub/kotlin-wasm-cm-experiments at wasmtime</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/blob/wasmtime/wit/deps/http/proxy.wit#L1\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/997efc04eb718e8c72a0579b563066d4e953107a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333362623263643963326631363332353762323039623634343864393831663564323931356138356162663532386439376335383565653932663139303066302f646d636875622f6b6f746c696e2d7761736d2d636d2d6578706572696d656e7473&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/dmchub/kotlin-wasm-cm-experiments/blob/wasmtime/wit/deps/http/proxy.wit#L1\" title=\"kotlin-wasm-cm-experiments/wit/deps/http/proxy.wit at wasmtime · dmchub/kotlin-wasm-cm-experiments\">kotlin-wasm-cm-experiments/wit/deps/http/proxy.wit at wasmtime · dmchub/kotlin-wasm-cm-experiments</a></div><div class=\"message_embed_description\">Experiments with running Kotlin/Wasm with Component Model - dmchub/kotlin-wasm-cm-experiments</div></div></div>",
        "id": 502745126,
        "sender_full_name": "Dmitry Chub",
        "timestamp": 1740834794
    },
    {
        "content": "<p>Here is list of commands I run to get the result:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span>\n<span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">dependencies</span>\n<span class=\"n\">cp</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">-</span><span class=\"n\">component</span><span class=\"o\">/</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip1</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">dependencies</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">adapt</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">.</span><span class=\"n\">reactor</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"o\">..</span>\n<span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">bindgen</span><span class=\"w\"> </span><span class=\"n\">kotlin</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">out</span><span class=\"o\">-</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">wasmWasiMain</span><span class=\"o\">/</span><span class=\"n\">kotlin</span><span class=\"o\">/</span><span class=\"n\">bindings</span>\n<span class=\"n\">java</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">jar</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">ktfmt</span><span class=\"o\">-</span><span class=\"mf\">0.47</span><span class=\"o\">-</span><span class=\"n\">jar</span><span class=\"o\">-</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">dependencies</span><span class=\"p\">.</span><span class=\"n\">jar</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">wasmWasiMain</span><span class=\"o\">/</span><span class=\"n\">kotlin</span><span class=\"o\">/</span><span class=\"n\">bindings</span>\n<span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">gradlew</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"nc\">compileProductionExecutableKotlinWasmWasi</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Pkotlin</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"p\">.</span><span class=\"n\">stability</span><span class=\"p\">.</span><span class=\"n\">nowarn</span><span class=\"o\">=</span><span class=\"kc\">true</span>\n<span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">wasm</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">embed</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">compileSync</span><span class=\"o\">/</span><span class=\"n\">wasmWasi</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"o\">/</span><span class=\"n\">productionExecutable</span><span class=\"o\">/</span><span class=\"n\">kotlin</span><span class=\"o\">/</span><span class=\"n\">kco</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">kco</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">embedded</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">component</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">kco</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">embedded</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">component</span><span class=\"o\">/</span><span class=\"n\">kco</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">uncomposed</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">adapt</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">.</span><span class=\"n\">reactor</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">realloc</span><span class=\"o\">-</span><span class=\"n\">via</span><span class=\"o\">-</span><span class=\"n\">memory</span><span class=\"o\">-</span><span class=\"n\">grow</span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">serve</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"o\">-</span><span class=\"n\">references</span><span class=\"p\">,</span><span class=\"n\">gc</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">component</span><span class=\"o\">/</span><span class=\"n\">kco</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">uncomposed</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>",
        "id": 502745365,
        "sender_full_name": "Dmitry Chub",
        "timestamp": 1740834974
    },
    {
        "content": "<p>Could you share some of the wasm components in question here? The first error looks like a bug in creating the component itself. The second error I'm not so sure about though</p>",
        "id": 503079903,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1741021635
    }
]