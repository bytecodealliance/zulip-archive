<html>
<head><meta charset="utf-8"><title>Continuous memory growth in jco component 路 StarlingMonkey 路 Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/index.html">StarlingMonkey</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html">Continuous memory growth in jco component</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="532187059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/532187059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ludvig Liljenberg <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#532187059">(Jul 31 2025 at 23:33)</a>:</h4>
<p>Hello I have a very simple question about jco components. I have a simple wasm component compiled from the following js</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">export</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">handlerInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">handleevent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">event</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>using <code>jco componentize handler.js --wit ../component.wit -d all -o handler.wasm</code><br>
with the following wit</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">test</span><span class="p">:</span><span class="nc">test</span><span class="p">;</span>

<span class="n">interface</span><span class="w"> </span><span class="n">handler</span><span class="o">-</span><span class="n">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">handleevent</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="nc">request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">request</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">world</span><span class="w"> </span><span class="n">handler</span><span class="o">-</span><span class="n">world</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">handler</span><span class="o">-</span><span class="n">interface</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I'm using wasmtime to call the <code>handleevent</code> guest function on the component in an infinite loop. It seems that RES memory of the process is constantly increasing over time. Is this expected with components compiled with <code>jco</code>? I don't see the same memory usage using cargo-component for example. Maybe it's expected with a javascript runtime and JIT or whatnot, but it would seem weird to me? Any help appreciated.</p>
<p>Small repro is here <a href="https://github.com/ludfjig/jco-vs-cargo-component-memory-usage">https://github.com/ludfjig/jco-vs-cargo-component-memory-usage</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/ludfjig/jco-vs-cargo-component-memory-usage" style="background-image: url(&quot;https://uploads.zulipusercontent.net/508b75e3206043e81775104674fac1f58aa0da2a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f666663613363313634306162363838333861613361373238386162633137316631653563343161366334383166333532623163386530323063316137373761392f6c7564666a69672f6a636f2d76732d636172676f2d636f6d706f6e656e742d6d656d6f72792d7573616765&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/ludfjig/jco-vs-cargo-component-memory-usage" title="GitHub - ludfjig/jco-vs-cargo-component-memory-usage: Compares memory usage of jco vs cargo-component">GitHub - ludfjig/jco-vs-cargo-component-memory-usage: Compares memory usage of jco vs cargo-component</a></div><div class="message_embed_description">Compares memory usage of jco vs cargo-component. Contribute to ludfjig/jco-vs-cargo-component-memory-usage development by creating an account on GitHub.</div></div></div>



<a name="532232442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/532232442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tomasz Andrzejak <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#532232442">(Aug 01 2025 at 06:11)</a>:</h4>
<p>Hey Ludvig, thank you for the repro. No, this is not expected behavior. Unfortunately, StarlingMonkey hasn't been thoroughly tested for long-running use cases, so it's entirely possible that we have a memory leak somewhere. I would start by ensuring you're using the latest <code>jco</code> version, as there were some memory-related fixes in the most recent StarlingMonkey release, and I will have a look at your example to see if I'm able to track the leak.</p>



<a name="532239780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/532239780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tomasz Andrzejak <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#532239780">(Aug 01 2025 at 07:03)</a>:</h4>
<p>To provide additional context: I would also say it's normal to see memory usage fluctuations in JS components due to garbage collection. The GC will allow memory to accumulate temporarily before triggering a collection that should eventually bring memory usage down, but FWIU what you're observing is linear increase until oom?</p>



<a name="532347874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/532347874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ludvig Liljenberg <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#532347874">(Aug 01 2025 at 17:17)</a>:</h4>
<p>Thanks for the reply. Indeed memory increases linearly with no signs of stabilizing. I tried most recent <code>jco</code> version as well, but unfortunately I'm still seeing it</p>



<a name="532687618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/532687618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#532687618">(Aug 04 2025 at 09:36)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="648901">@Ludvig Liljenberg</span> would you mind filing an issue about this? The most appropriate place might be either componentize-js or StarlingMonkey , but I'd love to track this so that we can be sure it's fixed long-term. </p>
<p>I mention this because I originally thought this might be a case of <a href="https://github.com/bytecodealliance/jco/issues/568">this bug from Jco</a>, but it doesn't seem to be, so I'm thinking we should make sure it's tracked.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/issues/568" style="background-image: url(&quot;https://uploads.zulipusercontent.net/882f6f3d47f8693b7f3813831a4c30289c76285f/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656131646365626139663863333631633839313037303231336263373330353066323063353066396461363261396633663266336434613137633332326235332f62797465636f6465616c6c69616e63652f6a636f2f6973737565732f353638&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/issues/568" title="jco componentize out of memory 路 Issue #568 路 bytecodealliance/jco">jco componentize out of memory 路 Issue #568 路 bytecodealliance/jco</a></div><div class="message_embed_description">Hey all, thanks for the cool project! I've been following various talks in the space for the last year and am really excited to be trying out some stuff! Background I'm working in a Rust codebase t...</div></div></div>



<a name="532983620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/532983620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#532983620">(Aug 05 2025 at 20:12)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="206238" href="/#narrow/channel/206238-general/topic/Continuous.20memory.20growth.20in.20jco.20component">#general &gt; Continuous memory growth in jco component</a> by <span class="user-mention silent" data-user-id="253990">fitzgen (he/him)</span>.</p>



<a name="533345267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/533345267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ludvig Liljenberg <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#533345267">(Aug 07 2025 at 18:39)</a>:</h4>
<p>Thanks, I filed <a href="https://github.com/bytecodealliance/ComponentizeJS/issues/279">https://github.com/bytecodealliance/ComponentizeJS/issues/279</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/ComponentizeJS/issues/279" style="background-image: url(&quot;https://uploads.zulipusercontent.net/9bec2c7e35abc56b56091d387a8d397b4f92fc2d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f313164396661653639393565363032376134663230646631323964326166653338656264663530623365356435393965343836646562656566613632363762332f62797465636f6465616c6c69616e63652f436f6d706f6e656e74697a654a532f6973737565732f323739&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/ComponentizeJS/issues/279" title="Continuous memory growth in jco component 路 Issue #279 路 bytecodealliance/ComponentizeJS">Continuous memory growth in jco component 路 Issue #279 路 bytecodealliance/ComponentizeJS</a></div><div class="message_embed_description">I have a simple wasm component compiled from the following js export const handlerInterface = { handleevent(event) { return event; } }; using jco componentize handler.js --wit ../component.wit -d a...</div></div></div>



<a name="539664241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/539664241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ludvig Liljenberg <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#539664241">(Sep 16 2025 at 00:10)</a>:</h4>
<p>I think I found the issue! I've made a PR here <a href="https://github.com/bytecodealliance/ComponentizeJS/pull/295">https://github.com/bytecodealliance/ComponentizeJS/pull/295</a> <span class="user-mention" data-user-id="598440">@Victor Adossi</span>  <span class="user-mention" data-user-id="763150">@Tomasz Andrzejak</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/ComponentizeJS/pull/295" style="background-image: url(&quot;https://uploads.zulipusercontent.net/3e96af96f1e9f7f578a47437c040a682d8f909e0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f393238316465376332373061363061393236623766656663656565383166393066663839313661663463333032333962373639386661613437613938323930642f62797465636f6465616c6c69616e63652f436f6d706f6e656e74697a654a532f70756c6c2f323935&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/ComponentizeJS/pull/295" title="Fix memory leak in call() retptr allocation by ludfjig 路 Pull Request #295 路 bytecodealliance/ComponentizeJS">Fix memory leak in call() retptr allocation by ludfjig 路 Pull Request #295 路 bytecodealliance/ComponentizeJS</a></div><div class="message_embed_description">JavaScript components leak memory when returning non-primitive types (strings, objects, arrays, etc.).
Cause
Return pointer allocation used JS_realloc which bypasses memory tracking, so allocations...</div></div></div>



<a name="539728536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/459697-StarlingMonkey/topic/Continuous%20memory%20growth%20in%20jco%20component/near/539728536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/459697-StarlingMonkey/topic/Continuous.20memory.20growth.20in.20jco.20component.html#539728536">(Sep 16 2025 at 10:02)</a>:</h4>
<p>Great job <span class="user-mention" data-user-id="648901">@Ludvig Liljenberg</span> !</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>