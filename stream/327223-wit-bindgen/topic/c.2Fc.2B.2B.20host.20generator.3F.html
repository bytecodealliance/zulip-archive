<html>
<head><meta charset="utf-8"><title>c/c++ host generator? · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html">c/c++ host generator?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="350691408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/350691408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#350691408">(Apr 18 2023 at 07:16)</a>:</h4>
<p>I am going through the steps here:  <a href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/export_native_api.md">https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/export_native_api.md</a> to create a c++ native host which exposes functions to the wasm.<br>
Is there a c/c++ generator similar to JCO?<br>
If not does anyone know if someone is already planning / discussing it?<br>
If not and someone was inclined to create one, is there an official antlr grammar?  <br>
Or would it be better to extend something like the JCO or the rust bindgen macro?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/export_native_api.md" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/655286d8dd0af78caf61501a83890cd1ab3acab1\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383134386333646330326661356130383562623336666366383136636133343763623834643436623533383963653161313930396230623135653961653633362f62797465636f6465616c6c69616e63652f7761736d2d6d6963726f2d72756e74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/export_native_api.md" title="wasm-micro-runtime/export_native_api.md at main · bytecodealliance/wasm-micro-runtime">wasm-micro-runtime/export_native_api.md at main · bytecodealliance/wasm-micro-runtime</a></div><div class="message_embed_description">WebAssembly Micro Runtime (WAMR). Contribute to bytecodealliance/wasm-micro-runtime development by creating an account on GitHub.</div></div></div>



<a name="355271249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355271249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355271249">(May 02 2023 at 21:47)</a>:</h4>
<p>I think that the engine independent C API <a href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md">https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md</a> would be a better target for a C/++ host code generator.<br>
Also as we plan to work with WIT on adaptive AUTOSAR, a higher-level C++ binding (leveraging expected, optional and variant) would be something I could cooperate on.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/d6d47d572f545cb7a23fb6faeba5677e9162deb7\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f643665316263363038613661333034316335386435313630336561373331393339373139316134626437353136343434626263626463353337306632353630302f62797465636f6465616c6c69616e63652f7761736d2d6d6963726f2d72756e74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md" title="wasm-micro-runtime/wasm_c_api.md at main · bytecodealliance/wasm-micro-runtime">wasm-micro-runtime/wasm_c_api.md at main · bytecodealliance/wasm-micro-runtime</a></div><div class="message_embed_description">WebAssembly Micro Runtime (WAMR). Contribute to bytecodealliance/wasm-micro-runtime development by creating an account on GitHub.</div></div></div>



<a name="355347690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355347690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355347690">(May 03 2023 at 07:44)</a>:</h4>
<p>We've unfortunately found the engine-independent C/C++ API not to be a good fit for many use cases of Wasmtime, and have decided to limit our support for it to somewhat basic functionality. That means that we'll not bring Components support to it (which would entail substantially expanding the API in any case.)</p>
<p>In addition to the severe limitations listed in the <a href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md#fyi">FYI</a> section of the document you linked to, you can read more about the reasons <a href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/new-api.md#the-new-wasmtime-c-api">here</a> and <a href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/new-api.md#motivation">here</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md#fyi" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/4b5a2c8a08cc501a8010ba8f56879eae0f2102a9\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303264353266643061333338663436396462643730626536306163306133626464393837623762396335653362613136646164393339393766643233643261612f62797465636f6465616c6c69616e63652f7761736d2d6d6963726f2d72756e74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-micro-runtime/blob/main/doc/wasm_c_api.md#fyi" title="wasm-micro-runtime/wasm_c_api.md at main · bytecodealliance/wasm-micro-runtime">wasm-micro-runtime/wasm_c_api.md at main · bytecodealliance/wasm-micro-runtime</a></div><div class="message_embed_description">WebAssembly Micro Runtime (WAMR). Contribute to bytecodealliance/wasm-micro-runtime development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/new-api.md#the-new-wasmtime-c-api" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/24447277c6bd21329127c529461993fd9f580cc2\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353036636638323765656433383764666234383438613838383866353037383866326662663539663537336536353834343831326563373431383064636535632f62797465636f6465616c6c69616e63652f72666373)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/new-api.md#the-new-wasmtime-c-api" title="rfcs/new-api.md at main · bytecodealliance/rfcs">rfcs/new-api.md at main · bytecodealliance/rfcs</a></div><div class="message_embed_description">RFC process for Bytecode Alliance projects. Contribute to bytecodealliance/rfcs development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/new-api.md#motivation" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/24447277c6bd21329127c529461993fd9f580cc2\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353036636638323765656433383764666234383438613838383866353037383866326662663539663537336536353834343831326563373431383064636535632f62797465636f6465616c6c69616e63652f72666373)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/new-api.md#motivation" title="rfcs/new-api.md at main · bytecodealliance/rfcs">rfcs/new-api.md at main · bytecodealliance/rfcs</a></div><div class="message_embed_description">RFC process for Bytecode Alliance projects. Contribute to bytecodealliance/rfcs development by creating an account on GitHub.</div></div></div>



<a name="355358200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355358200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355358200">(May 03 2023 at 08:30)</a>:</h4>
<p>Till - Thanks for this insight!  Should I be focusing on <a href="https://github.com/bytecodealliance/wasmtime-cpp">https://github.com/bytecodealliance/wasmtime-cpp</a>?  My other question still stands, does anyone know if there is any work being done on generating a c/c++ host bindings from WIT files?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime-cpp" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/6b2b364f9a4dbbf4a55d7ba3134c0475a6904c72\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363363323263666339336133666135343666636262323333343636646363343466643935356538323731303065613937393733313565343534616238653662392f62797465636f6465616c6c69616e63652f7761736d74696d652d637070)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime-cpp" title="GitHub - bytecodealliance/wasmtime-cpp">GitHub - bytecodealliance/wasmtime-cpp</a></div><div class="message_embed_description">Contribute to bytecodealliance/wasmtime-cpp development by creating an account on GitHub.</div></div></div>



<a name="355459866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355459866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355459866">(May 03 2023 at 14:24)</a>:</h4>
<p>I'm at least not personally aware of any C/C++ host generator for WIT at this time. Not because it can't be done, though, just because it's work and that takes some time. Whether or not the C API itself or the C++ is the right way to go is somewhat up to you. I would ideally recommend Rust as embeddings of WebAssembly probably aren't dealing with trusted code and having as much safety as you can probably helps, but otherwise I'd recommend going with C++ to handle most of the resource management, such as strings into components, for you.</p>



<a name="355578993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355578993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355578993">(May 03 2023 at 18:30)</a>:</h4>
<p>we're going to need one. That doesn't mean the team here needs to provide it.</p>



<a name="355707819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355707819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355707819">(May 04 2023 at 09:07)</a>:</h4>
<p>This is something which I wouldn't mind taking a stab at and have some experience with ANTLR, code generators and associated IDE support.  Has anyone done an ANTLR grammar yet?</p>



<a name="355739431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355739431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355739431">(May 04 2023 at 11:10)</a>:</h4>
<p>Oh. <span class="user-mention" data-user-id="234973">@Till Schneidereit</span> thank you for this interesting material. You can clearly see at <a href="https://github.com/bytecodealliance/wasm-micro-runtime/pull/2173">https://github.com/bytecodealliance/wasm-micro-runtime/pull/2173</a> that there are problems with wamr as well...</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-micro-runtime/pull/2173" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/b7aa151202a8b5af508927b92e9bd022dab393ec\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633538643565626661636437646166633433356337666464333261626533323931633439643031633037373165613139333466383434303362343634623862332f62797465636f6465616c6c69616e63652f7761736d2d6d6963726f2d72756e74696d652f70756c6c2f32313733)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-micro-runtime/pull/2173" title="Fix three threading+callback issues by cpetig · Pull Request #2173 · bytecodealliance/wasm-micro-runtime">Fix three threading+callback issues by cpetig · Pull Request #2173 · bytecodealliance/wasm-micro-runtime</a></div><div class="message_embed_description">Testcase is available at #2172 , fixes also #2149 and an unreported mistake in the original code I copied the fix from.</div></div></div>



<a name="355792731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355792731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355792731">(May 04 2023 at 14:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="268586">Ralph</span> <a href="#narrow/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F/near/355578993">said</a>:</p>
<blockquote>
<p>we're going to need one. That doesn't mean the team here needs to provide it.</p>
</blockquote>
<p>Oh of course! And contributions are of course always welcome, and I think it's natural and inevitable to have wit-bindgen-generated-bindings for many languages, including C/C++!</p>
<p><span class="user-mention silent" data-user-id="577690">Gordon Smith</span> <a href="#narrow/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F/near/355707819">said</a>:</p>
<blockquote>
<p>Has anyone done an ANTLR grammar yet?</p>
</blockquote>
<p>Not currently, no. I'll say though that parsing WIT is the easy part, the code generation part is much more involved (in my personal opinion at least). Many code generators are currently written in Rust because all the WIT tooling is written in Rust right now. For example the wasmtime-py host generator is written in Rust and then compiled to WebAssembly to get run in Python.</p>



<a name="355940671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/355940671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#355940671">(May 05 2023 at 05:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F/near/355792731">said</a>:</p>
<blockquote>
<p>Not currently, no. I'll say though that parsing WIT is the easy part, the code generation part is much more involved (in my personal opinion at least). Many code generators are currently written in Rust because all the WIT tooling is written in Rust right now. For example the wasmtime-py host generator is written in Rust and then compiled to WebAssembly to get run in Python.</p>
</blockquote>
<p>Shame ANTLR doesn't have target support for Rust, but it would be a nice single point of truth WRT the grammar.  Also it makes life a lot easier when creating support for things like VSCode extensions...</p>
<p>Unfortunately, I haven't had time learn Rust, but wonder if a practical approach would be to "simply" generate the Rust host bindings and then expose them to c via the techniques outlined here: <br>
<a href="https://docs.rust-embedded.org/book/interoperability/rust-with-c.html">https://docs.rust-embedded.org/book/interoperability/rust-with-c.html</a>?</p>



<a name="356125532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/356125532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#356125532">(May 05 2023 at 17:28)</a>:</h4>
<p>My hunch is that the "simply" would not be so simple there. The devil is in the details of memory management and understanding structures on the C/C++ side of things, so that would all still need to be taken care of</p>



<a name="356304954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/356304954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#356304954">(May 06 2023 at 13:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="577690">Gordon Smith</span> <a href="#narrow/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F/near/355940671">said</a>:</p>
<blockquote>
<p>Unfortunately, I haven't had time learn Rust, but wonder if a practical approach would be to "simply" generate the Rust host bindings and then expose them to c via the techniques outlined here: <br>
<a href="https://docs.rust-embedded.org/book/interoperability/rust-with-c.html">https://docs.rust-embedded.org/book/interoperability/rust-with-c.html</a>?</p>
</blockquote>
<p>Given that you started this thread with a link to the wamr specific host interface document, I feel that wrapping the Rust host binding for wasmtime in C++ won't help you that much. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> <br>
I started a fork to create unified C API host targeted bindings at <a href="https://github.com/cpetig/wit-bindgen">https://github.com/cpetig/wit-bindgen</a> and hope to get something simple ready during this weekend. This should work fine for host directed calls even with threads, but for calls into wasm some infrastructure argument will be necessary to use thread specific instances of the runtime. [We had our share of thread issues calling into wasmer on veloren, see #plugins for more details.]</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cpetig/wit-bindgen" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/c7e1d75211b5e5315707cde57362f8bd287a9f9e\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646532346561623239623130353533626462373539653063386133323538323961333530306464613137323437643232326363383833653530373038333636652f6370657469672f7769742d62696e6467656e)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cpetig/wit-bindgen" title="GitHub - cpetig/wit-bindgen: A language binding generator for WebAssembly interface types">GitHub - cpetig/wit-bindgen: A language binding generator for WebAssembly interface types</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - GitHub - cpetig/wit-bindgen: A language binding generator for WebAssembly interface types</div></div></div>



<a name="356555084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/356555084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#356555084">(May 07 2023 at 22:24)</a>:</h4>
<p>I ended up at the, probably expected, dead-end of trying to access the correct store from a callback in a portable way. <br>
While I was able to get wasm calls and memory access working with multiple threads on wamr, and I was able to access the store from wasmer (FunctionEnvMut), you can't portably create a mere trap inside the callback. I see that wasmtime has provided its own solution to work around this (wasmtime_trap_new).</p>



<a name="356794682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/356794682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#356794682">(May 08 2023 at 19:18)</a>:</h4>
<p>I now have a fully working prototype of a multi-threaded guest program which calls host functions, some of which allocate memory via cabi_realloc - using the wamr native API. The code has become much more readable compared to the C API and can work without global variables. I will now continue work on my wit-bindgen backend for <em>this</em> environment.</p>



<a name="503110578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/503110578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#503110578">(Mar 03 2025 at 19:48)</a>:</h4>
<p><span class="user-mention" data-user-id="590366">@Christof Petig</span> - after many iterations I have a C++ host ABI implementation for lowering and lifting of the data types. </p>
<p>The main highlight is that all the typing (including the calculation of the flat_types array) are calculated at compile time.</p>
<p>Example from <a href="https://github.com/GordonSmith/component-model-cpp/blob/trunk/test/main.cpp">https://github.com/GordonSmith/component-model-cpp/blob/trunk/test/main.cpp</a></p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">PersonStruct</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">string_t</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record_t</span><span class="o">&lt;</span><span class="n">PersonStruct</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">PersonEx3Struct</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">string_t</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
<span class="w">        </span><span class="n">string_t</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<span class="w">        </span><span class="n">list_t</span><span class="o">&lt;</span><span class="n">string_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">phones</span><span class="p">;</span>
<span class="w">        </span><span class="n">tuple_t</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vital_stats</span><span class="p">;</span>
<span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">PersonEx3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record_t</span><span class="o">&lt;</span><span class="n">PersonEx3Struct</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="n">PersonEx3</span><span class="w"> </span><span class="n">pex3_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">"John"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">"123 Main St."</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">"555-1212"</span><span class="p">,</span><span class="w"> </span><span class="s">"555-1234"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">"Jane"</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">}};</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower_flat</span><span class="p">(</span><span class="o">*</span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">pex3_in</span><span class="p">);</span>
<span class="w">    </span><span class="p">...</span><span class="n">call</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">etc</span><span class="p">.</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">pex3_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lift_flat</span><span class="o">&lt;</span><span class="n">PersonEx3</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
</code></pre></div>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/GordonSmith/component-model-cpp/blob/trunk/test/main.cpp" style="background-image: url(&quot;https://uploads.zulipusercontent.net/f16e400a914f0954bffbf626cec83a401db75c09/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373331346466303564633437326133393532626161356531366130383831663937393132653262653863313161376537616439336631353432343761626237392f476f72646f6e536d6974682f636f6d706f6e656e742d6d6f64656c2d637070&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/GordonSmith/component-model-cpp/blob/trunk/test/main.cpp" title="component-model-cpp/test/main.cpp at trunk · GordonSmith/component-model-cpp">component-model-cpp/test/main.cpp at trunk · GordonSmith/component-model-cpp</a></div><div class="message_embed_description">C++ ABI implementation of the WebAssembly Component Model - GordonSmith/component-model-cpp</div></div></div>



<a name="503376478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/503376478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mats Taraldsvik <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#503376478">(Mar 04 2025 at 22:23)</a>:</h4>
<p><span class="user-mention" data-user-id="577690">@Gordon Smith</span> I'm eagerly awaiting support for running/embedding wasm+component model in a c++ application/host. Is this it? :)</p>



<a name="503436807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/503436807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#503436807">(Mar 05 2025 at 07:00)</a>:</h4>
<p>Its only part of the picture, yes it could be used to simplifying a wit -&gt; c++ generator (IMO it should make that exercise easier).  This is very much a side project, so I wouldn't hold my breath waiting for a handsfree solution.</p>



<a name="503511491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/503511491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mats Taraldsvik <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#503511491">(Mar 05 2025 at 13:17)</a>:</h4>
<p><span class="user-mention" data-user-id="577690">@Gordon Smith</span> Ah, ok :) I guess it's still early days wrt host embedding (with host functions)+component model in C++.</p>
<p>Could you please elaborate on "the whole picture", i.e. which parts are needed to accomplish C++ host-embedding in wasmtime or any wasm-runtime?  (I assume this: <a href="https://github.com/bytecodealliance/wasmtime/issues/8036#issuecomment-2593846815">https://github.com/bytecodealliance/wasmtime/issues/8036#issuecomment-2593846815</a> is a crucial part, perhaps overlapping with your work?)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/8036#issuecomment-2593846815" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0260e7ca1e477719659d844b53831f31fc542138/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f666331333464653935653838633238366234383930363261303831306263353136353362316538303439366662613139656231616534393038663432666666632f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f38303336&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/8036#issuecomment-2593846815" title="c-api: component model · Issue #8036 · bytecodealliance/wasmtime">c-api: component model · Issue #8036 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Feature Expose the component model in the C API for other languages than Rust. Benefit Components in all the languages! (on the host side) Implementation I have a POC I created here with some feedb...</div></div></div>



<a name="503524607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/503524607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#503524607">(Mar 05 2025 at 14:04)</a>:</h4>
<p>Needed bits:</p>
<ul>
<li>More ABI support (calling functions + various semantics, streaming, async etc.).  FWIW I plan on going as far as function calling before investigating the other parts (this ABI support is agnostic to the wasm runtime being used).</li>
<li>WIT -&gt; Host C++.  Parsing the WIT and generating the C++ data structures and function declarations (my hope is that targeting the cmcpp ABI implementation should make this step simpler).</li>
<li>WebAssembly runtime adapters - this is probably just sample code, but would show how to embed a webassembly runtime and create an ABI compatible context.</li>
<li>Tooling helpers - ability to extract a components wit and merge components etc.  This exists already in many forms, but folks seem to expect a cli that provides all the above in one place, specific for their host language.</li>
</ul>



<a name="503897602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/503897602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mats Taraldsvik <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#503897602">(Mar 06 2025 at 21:50)</a>:</h4>
<p>Thanks for the explanation. It does look like a large or even massive undertaking. I'm just a regular C++-dev who want to enable wasm component-model plugins in a c++-application. <span class="user-mention" data-user-id="577690">@Gordon Smith</span> </p>
<p>I don't understand the relationship between (c-api) component model host support in wasmtime and your project.</p>
<p>I guess I'm trying to work out which project I should be waiting for, and perhaps even try to contribute to if I'm able.</p>



<a name="516502731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/c/c%2B%2B%20host%20generator%3F/near/516502731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gordon Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/c.2Fc.2B.2B.20host.20generator.3F.html#516502731">(May 06 2025 at 17:52)</a>:</h4>
<p>FYI I have now slimmed down the host code to the following pattern:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">call_and</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attach</span><span class="o">&lt;</span><span class="n">bool_t</span><span class="p">(</span><span class="n">bool_t</span><span class="p">,</span><span class="w"> </span><span class="n">bool_t</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">module_inst</span><span class="p">,</span><span class="w"> </span><span class="n">exec_env</span><span class="p">,</span><span class="w"> </span><span class="n">liftLowerContext</span><span class="p">,</span><span class="w"> </span><span class="s">"example:sample/booleans#and"</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_and(false, false): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_and</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_and(false, true): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_and</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_and(true, false): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_and</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_and(true, true): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_and</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">auto</span><span class="w"> </span><span class="n">call_add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attach</span><span class="o">&lt;</span><span class="n">float64_t</span><span class="p">(</span><span class="n">float64_t</span><span class="p">,</span><span class="w"> </span><span class="n">float64_t</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">module_inst</span><span class="p">,</span><span class="w"> </span><span class="n">exec_env</span><span class="p">,</span><span class="w"> </span><span class="n">liftLowerContext</span><span class="p">,</span><span class="w"> </span><span class="s">"example:sample/floats#add"</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_add(3.1, 0.2): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_add</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_add(1.5, 2.5): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_add</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">auto</span><span class="w"> </span><span class="n">call_reverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attach</span><span class="o">&lt;</span><span class="n">string_t</span><span class="p">(</span><span class="n">string_t</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">module_inst</span><span class="p">,</span><span class="w"> </span><span class="n">exec_env</span><span class="p">,</span><span class="w"> </span><span class="n">liftLowerContext</span><span class="p">,</span><span class="w"> </span><span class="s">"example:sample/strings#reverse"</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">call_reverse_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call_reverse</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_reverse(</span><span class="se">\"</span><span class="s">Hello World!</span><span class="se">\"</span><span class="s">): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_reverse_result</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_reverse(call_reverse(</span><span class="se">\"</span><span class="s">Hello World!</span><span class="se">\"</span><span class="s">)): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_reverse</span><span class="p">(</span><span class="n">call_reverse_result</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">auto</span><span class="w"> </span><span class="n">call_lots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attach</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="p">(</span>
<span class="w">    </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span>
<span class="w">    </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">module_inst</span><span class="p">,</span><span class="w"> </span><span class="n">exec_env</span><span class="p">,</span><span class="w"> </span><span class="n">liftLowerContext</span><span class="p">,</span><span class="w"> </span><span class="s">"example:sample/strings#lots"</span><span class="p">);</span>

<span class="c1">// Example call with 33 string_t arguments</span>
<span class="k">auto</span><span class="w"> </span><span class="n">call_lots_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call_lots</span><span class="p">(</span>
<span class="w">    </span><span class="s">"p1"</span><span class="p">,</span><span class="w"> </span><span class="s">"p2"</span><span class="p">,</span><span class="w"> </span><span class="s">"p3"</span><span class="p">,</span><span class="w"> </span><span class="s">"p4"</span><span class="p">,</span><span class="w"> </span><span class="s">"p5"</span><span class="p">,</span><span class="w"> </span><span class="s">"p6"</span><span class="p">,</span><span class="w"> </span><span class="s">"p7"</span><span class="p">,</span><span class="w"> </span><span class="s">"p8"</span><span class="p">,</span>
<span class="w">    </span><span class="s">"p9"</span><span class="p">,</span><span class="w"> </span><span class="s">"p10"</span><span class="p">,</span><span class="w"> </span><span class="s">"p11"</span><span class="p">,</span><span class="w"> </span><span class="s">"p12"</span><span class="p">,</span><span class="w"> </span><span class="s">"p13"</span><span class="p">,</span><span class="w"> </span><span class="s">"p14"</span><span class="p">,</span><span class="w"> </span><span class="s">"p15"</span><span class="p">,</span><span class="w"> </span><span class="s">"p16"</span><span class="p">,</span><span class="w"> </span><span class="s">"p17"</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_lots result: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_lots_result</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">using</span><span class="w"> </span><span class="n">reverse_tuple_func_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tuple_t</span><span class="o">&lt;</span><span class="n">string_t</span><span class="p">,</span><span class="w"> </span><span class="n">bool_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tuple_t</span><span class="o">&lt;</span><span class="n">bool_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="o">&gt;</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">call_reverse_tuple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attach</span><span class="o">&lt;</span><span class="n">reverse_tuple_func_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">module_inst</span><span class="p">,</span><span class="w"> </span><span class="n">exec_env</span><span class="p">,</span><span class="w"> </span><span class="n">liftLowerContext</span><span class="p">,</span><span class="w"> </span><span class="s">"example:sample/tuples#reverse"</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">call_reverse_tuple_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call_reverse_tuple</span><span class="p">({</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">"Hello World!"</span><span class="p">});</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_reverse_tuple({false, </span><span class="se">\"</span><span class="s">Hello World!</span><span class="se">\"</span><span class="s">}): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">call_reverse_tuple_result</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">call_reverse_tuple_result</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">auto</span><span class="w"> </span><span class="n">call_list_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attach</span><span class="o">&lt;</span><span class="n">list_t</span><span class="o">&lt;</span><span class="n">string_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">list_t</span><span class="o">&lt;</span><span class="n">variant_t</span><span class="o">&lt;</span><span class="n">bool_t</span><span class="p">,</span><span class="w"> </span><span class="n">string_t</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">module_inst</span><span class="p">,</span><span class="w"> </span><span class="n">exec_env</span><span class="p">,</span><span class="w"> </span><span class="n">liftLowerContext</span><span class="p">,</span><span class="w"> </span><span class="s">"example:sample/lists#filter-bool"</span><span class="p">);</span>

<span class="k">auto</span><span class="w"> </span><span class="n">call_list_filter_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call_list_filter</span><span class="p">({{</span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">"Hello World!"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">"Another String"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nb">true</span><span class="p">}});</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"call_list_filter result: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">call_list_filter_result</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<p>Full sample: <a href="https://github.com/GordonSmith/component-model-cpp/blob/trunk/samples/wamr/main.cpp#L191">https://github.com/GordonSmith/component-model-cpp/blob/trunk/samples/wamr/main.cpp#L191</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/GordonSmith/component-model-cpp/blob/trunk/samples/wamr/main.cpp#L191" style="background-image: url(&quot;https://uploads.zulipusercontent.net/d57c74eaeed29a28a08f6be4cd9e3cbfed8d0792/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363931663331633530373038326266333161626437626530363365326532323436353739323566363331633535663663336265623965313831613266386337372f476f72646f6e536d6974682f636f6d706f6e656e742d6d6f64656c2d637070&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/GordonSmith/component-model-cpp/blob/trunk/samples/wamr/main.cpp#L191" title="component-model-cpp/samples/wamr/main.cpp at trunk · GordonSmith/component-model-cpp">component-model-cpp/samples/wamr/main.cpp at trunk · GordonSmith/component-model-cpp</a></div><div class="message_embed_description">C++ ABI implementation of the WebAssembly Component Model - GordonSmith/component-model-cpp</div></div></div>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>