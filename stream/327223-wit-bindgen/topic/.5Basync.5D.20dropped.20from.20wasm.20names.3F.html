<html>
<head><meta charset="utf-8"><title>[async] dropped from wasm names? · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html">[async] dropped from wasm names?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="562261520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562261520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562261520">(Dec 06 2025 at 19:40)</a>:</h4>
<p>HI, has [async] been dropped from the wasm function names, if so, does that mean a new version of wasmtime is needed?</p>



<a name="562275455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562275455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562275455">(Dec 07 2025 at 01:04)</a>:</h4>
<p>Correct; it's due to <a href="https://github.com/WebAssembly/component-model/pull/578">https://github.com/WebAssembly/component-model/pull/578</a>.  If you're using the latest wasm-tools and wit-bindgen, you'll need to use Wasmtime's <code>main</code> branch until v40.0.0 is released.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/pull/578" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4f7eae3bba5145187fee22be1aa91f48e34016fd/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343433326535313233646438373062663336666163633637336666383534396461363163666135323938376331336130636236306632313961646430343833652f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c2f70756c6c2f353738&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/pull/578" title="Make 'async' part of the function type, not a hint by lukewagner · Pull Request #578 · WebAssembly/component-model">Make 'async' part of the function type, not a hint by lukewagner · Pull Request #578 · WebAssembly/component-model</a></div><div class="message_embed_description">This PR moves async from being a hint that is textually mangled into function names to an optional effect type that is part of a function type.  WIT is not changed; just how it&#39;s encoded as a c...</div></div></div>



<a name="562465049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562465049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562465049">(Dec 08 2025 at 13:22)</a>:</h4>
<p>Thanks!   Looking at this wit <a href="https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/test.wit#L18">https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/test.wit#L18</a><br>
It generates this c code</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">__export_name__</span><span class="p">(</span><span class="s">"run"</span><span class="p">)))</span>
<span class="n">void</span><span class="w"> </span><span class="n">__wasm_export_exports_runner_run</span><span class="p">(</span><span class="n">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">exports_runner_run</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>and nothing to indicate it is async.  Is that right?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/test.wit#L18" style="background-image: url(&quot;https://uploads.zulipusercontent.net/f65fa6008b9e96aa195060ca7f7c3e583f5fe0b5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623966383266613966313036373337363566366134346561366633303138336166613339313036373335393239356361636336616432393038373430376466652f62797465636f6465616c6c69616e63652f7769742d62696e6467656e&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/test.wit#L18" title="wit-bindgen/tests/runtime-async/async/simple-import-params-results/test.wit at 4284ea88f0b98e2e20e366298e95c9aa2ca4b488 · bytecodealliance/wit-bindgen">wit-bindgen/tests/runtime-async/async/simple-import-params-results/test.wit at 4284ea88f0b98e2e20e366298e95c9aa2ca4b488 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - bytecodealliance/wit-bindgen</div></div></div>



<a name="562467911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562467911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562467911">(Dec 08 2025 at 13:35)</a>:</h4>
<p>I suppose more specifically why isn't <code>[async-lift]</code> required here any more?</p>



<a name="562472364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562472364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562472364">(Dec 08 2025 at 13:54)</a>:</h4>
<p><code>async</code>-ness is now (Wasmtime <code>main</code> / the above PR) part of the function signature so the flag doesn't need to be part of the name any more.</p>



<a name="562472741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562472741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562472741">(Dec 08 2025 at 13:56)</a>:</h4>
<p>How is asyncness expressed in <code>c</code> in the signature?   I'm wondering how that would be  expressed in LLVM and c would give me a clue.</p>



<a name="562473554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562473554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562473554">(Dec 08 2025 at 13:59)</a>:</h4>
<p>I'm not sure if async support has even been added to the C bindings generator yet.</p>



<a name="562473631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562473631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562473631">(Dec 08 2025 at 14:00)</a>:</h4>
<p>ah ok, that might explain my confusion</p>



<a name="562473662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562473662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562473662">(Dec 08 2025 at 14:00)</a>:</h4>
<p>Semantically, <code>async</code> now means "may block before returning".</p>



<a name="562478915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562478915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562478915">(Dec 08 2025 at 14:22)</a>:</h4>
<p>Oh the C generator does have async support yeah. That specific test is <a href="https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/runner.c#L1">this one</a> which specifies that the <code>run</code> function does a sync lift into an async type, hence the lack of <code>[async-lift]</code></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/runner.c#L1" style="background-image: url(&quot;https://uploads.zulipusercontent.net/f65fa6008b9e96aa195060ca7f7c3e583f5fe0b5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623966383266613966313036373337363566366134346561366633303138336166613339313036373335393239356361636336616432393038373430376466652f62797465636f6465616c6c69616e63652f7769742d62696e6467656e&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/blob/4284ea88f0b98e2e20e366298e95c9aa2ca4b488/tests/runtime-async/async/simple-import-params-results/runner.c#L1" title="wit-bindgen/tests/runtime-async/async/simple-import-params-results/runner.c at 4284ea88f0b98e2e20e366298e95c9aa2ca4b488 · bytecodealliance/wit-bindgen">wit-bindgen/tests/runtime-async/async/simple-import-params-results/runner.c at 4284ea88f0b98e2e20e366298e95c9aa2ca4b488 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - bytecodealliance/wit-bindgen</div></div></div>



<a name="562479823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562479823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562479823">(Dec 08 2025 at 14:26)</a>:</h4>
<p>The C bindings generator definitely supports async, and yes, the export should include <code>[async-lift]</code> by default for <code>async</code>-typed functions.  This is what I see when I run <code>wit-bindgen</code> on <code>main</code>:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp"> $ </span>cargo<span class="w"> </span>run<span class="w"> </span>--<span class="w"> </span>c<span class="w"> </span>-w<span class="w"> </span>runner<span class="w"> </span>tests/runtime-async/async/simple-import-params-results/test.wit
<span class="go">    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s</span>
<span class="go">     Running `target/debug/wit-bindgen c -w runner tests/runtime-async/async/simple-import-params-results/test.wit`</span>
<span class="go">Generating "runner.c"</span>
<span class="go">Generating "runner.h"</span>
<span class="go">Generating "runner_component_type.o"</span>
<span class="gp"> $ </span>grep<span class="w"> </span>-B<span class="w"> </span><span class="m">5</span><span class="w"> </span>-A<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s1">'\[async-lift\]run'</span><span class="w"> </span>runner.c
<span class="go">  return ret;</span>
<span class="go">}</span>

<span class="go">// Helper Functions</span>

<span class="go">__attribute__((__export_name__("[callback][async-lift]run")))</span>
<span class="go">uint32_t __wasm_export_exports_runner_run_callback(uint32_t event_raw, uint32_t waitable, uint32_t code) {</span>
<span class="go">  runner_event_t event;</span>
<span class="go">  event.event = (runner_event_code_t) event_raw;</span>
<span class="go">  event.waitable = waitable;</span>
<span class="go">  event.code = code;</span>
<span class="go">--</span>

<span class="go">runner_subtask_status_t a_b_i_two_arguments_and_result(uint32_t x, uint32_t y, uint32_t *result) {</span>
<span class="go">  return __wasm_import_a_b_i_two_arguments_and_result((int32_t) (x), (int32_t) (y), (uint8_t*) result);</span>
<span class="go">}</span>

<span class="go">__attribute__((__export_name__("[async-lift]run")))</span>
<span class="go">int32_t __wasm_export_exports_runner_run(void) {</span>
<span class="go">  runner_callback_code_t ret = exports_runner_run();</span>
<span class="go">  return ret;</span>
<span class="go">}</span>
</code></pre></div>



<a name="562480019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562480019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562480019">(Dec 08 2025 at 14:27)</a>:</h4>
<p>with main wit-bindgen ?</p>



<a name="562480042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562480042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562480042">(Dec 08 2025 at 14:27)</a>:</h4>
<p>correct</p>



<a name="562481234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562481234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562481234">(Dec 08 2025 at 14:31)</a>:</h4>
<p>0.48/0.49 should work the same way too</p>



<a name="562481536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562481536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562481536">(Dec 08 2025 at 14:32)</a>:</h4>
<p>Interesting, when I run <code>target\debug\wit-bindgen.exe test --languages rust,c tests/runtime-async/async --artifacts target/artifacts --rust-wit-bindgen-path ./crates/guest-rust --runner "wasmtime -W component-model-async"</code> I don't get that c generated.  Let me debug to see where I've gone wrong</p>



<a name="562481920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562481920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562481920">(Dec 08 2025 at 14:34)</a>:</h4>
<p>Ah; I'll bet it's this directive in runner.c: <code>//@ args = '--rename a:b/i=test --async=-run'</code></p>



<a name="562482193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562482193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562482193">(Dec 08 2025 at 14:35)</a>:</h4>
<p>That tells the test crate to disable async lift for the run function.  When I run <code>wit-bindgen-cli</code>, it ignores that directive, hence the difference between my results and yours.</p>



<a name="562482347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Basync%5D%20dropped%20from%20wasm%20names%3F/near/562482347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Basync.5D.20dropped.20from.20wasm.20names.3F.html#562482347">(Dec 08 2025 at 14:35)</a>:</h4>
<p>The upshot is that <code>[async-lift]</code> is indeed the default, but can be overridden via <code>--async=-run</code></p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>