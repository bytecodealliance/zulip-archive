<html>
<head><meta charset="utf-8"><title>Accessing `Store` from hosted object · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html">Accessing `Store` from hosted object</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537302855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537302855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Massimiliano Mantione <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537302855">(Sep 02 2025 at 14:46)</a>:</h4>
<p>I am defining and hosting a component, everything is in Rust, I use wit-bindgen for the boilerplate as described in the docs and everything works fine.</p>
<p>The component has both imported and exported interfaces, and the host implements the imported ones.</p>
<p>However, there is a thing I need to do that is blocking me: inside hosted functions, I need to manipulate the available fuel (using <code>get_fuel</code> and <code>set_fuel</code> on the store).</p>
<p>The problem is that the "hosted object" (the <code>T</code> in the <code>Store&lt;T&gt;</code>) cannot access the store, and I did not find a way to expose it.</p>
<p>If I did all the bindings by hand I think I could do what I need, using the <code>Caller</code> interface: the <code>Caller</code> would receive the call, and it could call the hosted function implementation passing the store to it.</p>
<p>But with the traits implemented by wit-bindgen this looks impossible to me.<br>
And doing all the bindings by hand would be extra-annoying.<br>
Am I missing something?</p>



<a name="537304915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537304915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537304915">(Sep 02 2025 at 14:56)</a>:</h4>
<p>It's correct that you can't access the store with default bindings, yes. The eventual end goal, however, is to support the <code>store</code> flag to imports/exports when generating bindings on the Wasmtime side of things (similar to the <code>async</code>, <code>trappable</code>, <code>tracing</code>, etc flags). Right now if you use just <code>store</code> it'll probably panic as the implementation isn't filled out yet, but if you use <code>async | store</code> you'll have access to the store (but you'll have to use async too)</p>



<a name="537305054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537305054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537305054">(Sep 02 2025 at 14:57)</a>:</h4>
<p>basically, this is on me to write up an issue about enabling this in Wasmtime. You're otherwise not missing anything, it's not possible to do this with generated bindings. What you can do, however, is don't use the generated bindings for functions that need access to fuel (it's a difficult option to use but theoretically possible, e.g. skip bindings for certain functions)</p>



<a name="537320187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537320187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537320187">(Sep 02 2025 at 16:07)</a>:</h4>
<p>As a temporary workaround you could expand the <code>generate!</code> macro and copy the bits you need into a manual implementation.</p>



<a name="537321913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537321913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Massimiliano Mantione <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537321913">(Sep 02 2025 at 16:17)</a>:</h4>
<p>Thanks for the prompt reply!<br>
Using <code>async | store</code> and I <em>forced</em> to use async hosted functions, or can I just keep using regular ones?<br>
(I'll try it out, but asking is faster...)</p>



<a name="537322090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537322090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Massimiliano Mantione <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537322090">(Sep 02 2025 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> <br>
Is there an open issue about the <code>store</code> feature?</p>



<a name="537322187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537322187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537322187">(Sep 02 2025 at 16:19)</a>:</h4>
<p>Yes you're force to use async with <code>async | store</code>, and no I haven't opened an issue yet</p>



<a name="537322487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537322487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Massimiliano Mantione <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537322487">(Sep 02 2025 at 16:20)</a>:</h4>
<blockquote>
<p>As a temporary workaround you could expand the <code>generate!</code> macro and copy the bits you need into a manual implementation.</p>
</blockquote>
<p>I was considering editing the automatically generated bindings.<br>
Once I freeze the wit file this might be the best compromise for now.</p>
<p>Is using the <code>bindgen</code> macro or the <code>wit-bindgen</code> CLI command the same thing?<br>
Right now I am using the macro on the host side, but I could switch to the CLI command with an explicitly generated file, which then I would modify.<br>
Does this make sense?</p>



<a name="537322622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537322622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537322622">(Sep 02 2025 at 16:21)</a>:</h4>
<p>The <code>wit-bindgen</code> CLI tool currently only supports guests and has no integration with Wasmtime (despite the crate in Wasmtime having the same name). So on the host you can only use <code>bindgen!</code> and there's no other option</p>



<a name="537322891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537322891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Massimiliano Mantione <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537322891">(Sep 02 2025 at 16:23)</a>:</h4>
<p>Ok, I have already used <code>cargo expand</code> to navigate my way in the generated code.<br>
I could just use that, save the file, and start from there...<br>
For now, <em>thanks!</em> <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="537338863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Accessing%20%60Store%60%20from%20hosted%20object/near/537338863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Accessing.20.60Store.60.20from.20hosted.20object.html#537338863">(Sep 02 2025 at 17:58)</a>:</h4>
<p>Ok I wrote up an issue at <a href="https://github.com/bytecodealliance/wasmtime/issues/11590">https://github.com/bytecodealliance/wasmtime/issues/11590</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/11590" style="background-image: url(&quot;https://uploads.zulipusercontent.net/08892c5428030abc844f9f3989d831f24155cdb2/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646566323566343963366236393266643037333265356262383135343065303461383634323361363833353433646437353733396631653335346137343163652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131353930&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/11590" title="Support accessing the store in `bindgen!` · Issue #11590 · bytecodealliance/wasmtime">Support accessing the store in `bindgen!` · Issue #11590 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">The bindgen! macro was redesigned in #11328 to have a more flexible configuration of imports/exports/flags. One of the motivations for doing this was to expose the concept of store as a flag on imp...</div></div></div>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>