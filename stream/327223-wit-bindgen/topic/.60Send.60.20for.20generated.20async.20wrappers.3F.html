<html>
<head><meta charset="utf-8"><title>`Send` for generated async wrappers? · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.60Send.60.20for.20generated.20async.20wrappers.3F.html">`Send` for generated async wrappers?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="546774801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%60Send%60%20for%20generated%20async%20wrappers%3F/near/546774801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jelle van den Hooff <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.60Send.60.20for.20generated.20async.20wrappers.3F.html#546774801">(Oct 23 2025 at 21:59)</a>:</h4>
<p>Hi, I am trying to use some of the new async support to expose a sqlite interface to a rust wasm app. The async support is, overall, amazing! However, I am running into problems because the wit-bindgen generated wrappers are not Send, as their futures store some <code>*mut u8</code> internally. That is an issue because Axum, which I am using to do some HTTP routing, has a Handler trait which requires Send.</p>
<p>I can work around this by doing the call to the generated wrapper inside of a wit_bindgen::spawn and then sending the result back over a oneshot channel but that's yucky. I am sure I do not appreciate the subtleties of this, but I am currently thinking that since components are currently single-threaded, marking everything as Send might be okay, and that would require some wrapper type around the *mut u8 marked as Send.</p>
<p>Curious to hear thoughts and suggestions. Thanks</p>



<a name="546779086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%60Send%60%20for%20generated%20async%20wrappers%3F/near/546779086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.60Send.60.20for.20generated.20async.20wrappers.3F.html#546779086">(Oct 23 2025 at 22:42)</a>:</h4>
<p>Oh this is definitely a bug and we should be able to mark things as <code>Send</code>, if you're up for it I'm happy to review a PR to the generated bindings to ensure this</p>



<a name="546798465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%60Send%60%20for%20generated%20async%20wrappers%3F/near/546798465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jelle van den Hooff <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.60Send.60.20for.20generated.20async.20wrappers.3F.html#546798465">(Oct 24 2025 at 02:24)</a>:</h4>
<p>Great, thanks, I will see if I can get my head around the codegen :)</p>



<a name="546954433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%60Send%60%20for%20generated%20async%20wrappers%3F/near/546954433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jelle van den Hooff <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.60Send.60.20for.20generated.20async.20wrappers.3F.html#546954433">(Oct 24 2025 at 18:10)</a>:</h4>
<p>I submitted <a href="https://github.com/bytecodealliance/wit-bindgen/pull/1405">https://github.com/bytecodealliance/wit-bindgen/pull/1405</a>. Feedback on style and substance very welcome</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/pull/1405" style="background-image: url(&quot;https://uploads.zulipusercontent.net/275b7c18dd1c025a5f0347f3b79f08ef40014f6c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383333653536666534343235656131613437376537626335366363656666306133316363373462376134383636306331346530393433353035636233366537612f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f70756c6c2f31343035&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/pull/1405" title="Make generated rust async futures Send by jellevandenhooff · Pull Request #1405 · bytecodealliance/wit-bindgen">Make generated rust async futures Send by jellevandenhooff · Pull Request #1405 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">The futures for generated rust async bindings were not always Send, because the LoweredParams held a non-Send *mut u8. To fix this, explicitly implement Send for LoweredParams. This makes the futur...</div></div></div>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>