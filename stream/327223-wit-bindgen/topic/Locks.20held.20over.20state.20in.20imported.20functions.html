<html>
<head><meta charset="utf-8"><title>Locks held over state in imported functions · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Locks.20held.20over.20state.20in.20imported.20functions.html">Locks held over state in imported functions</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="501930683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Locks%20held%20over%20state%20in%20imported%20functions/near/501930683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl Smit <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Locks.20held.20over.20state.20in.20imported.20functions.html#501930683">(Feb 25 2025 at 23:40)</a>:</h4>
<p>Hello</p>
<p>I have a small <code>wit</code> world that imports two functions, <code>execute</code> and <code>query</code>.</p>
<p>I am setting my state to hold a struct that provides wgpu operations and binding those to the above imports.</p>
<p>When running the operations outside of the wasm environment it works, however when calling the imported versions wgpu panics telling me about attempting to recursively acquire snatch locks.</p>
<p>Im wondering if there is some detail about the way that setting imports for a world in the host environment is messing with the held locks.</p>
<p>I attempted to instead have my world state hold an Arc&lt;RwLock&lt;Kernel&gt;&gt; instead but I get the same thing.</p>
<p>Is there anything I should know about what gets passed into the world state?</p>
<p>Thank you</p>



<a name="502085976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Locks%20held%20over%20state%20in%20imported%20functions/near/502085976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Locks.20held.20over.20state.20in.20imported.20functions.html#502085976">(Feb 26 2025 at 16:09)</a>:</h4>
<p>In theory wit-bindgen/etc have nothing to do with locks and it should look pretty  standard, so I'm not sure where this might be coming from</p>



<a name="502086059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/Locks%20held%20over%20state%20in%20imported%20functions/near/502086059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/Locks.20held.20over.20state.20in.20imported.20functions.html#502086059">(Feb 26 2025 at 16:10)</a>:</h4>
<p>Not that there couldn't be a bad interaction with wgpu and components/etc, but nothing that jumps to mind at least</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>