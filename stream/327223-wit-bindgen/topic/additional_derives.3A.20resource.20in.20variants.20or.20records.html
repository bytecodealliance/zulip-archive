<html>
<head><meta charset="utf-8"><title>additional_derives: resource in variants or records · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/additional_derives.3A.20resource.20in.20variants.20or.20records.html">additional_derives: resource in variants or records</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="504174663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/additional_derives%3A%20resource%20in%20variants%20or%20records/near/504174663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin D Murphy <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/additional_derives.3A.20resource.20in.20variants.20or.20records.html#504174663">(Mar 07 2025 at 20:01)</a>:</h4>
<p>The worlds defined in my <a href="https://github.com/cdmurph32/c2pa-component/blob/v24/wit/cai.wit">wit file</a> contain uses  variants with resources which causes wit-bindgen to fail if I use <code>additional_derives: [serde::Deserialize]</code>.<br>
Would either of these ideas be acceptable? We allow the user to specify records/variants to ignore, or we could confine the additional_derives to specific interfaces.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="n">traits</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">serde</span><span class="p">::</span><span class="n">Serialize</span><span class="p">,</span><span class="w"> </span><span class="n">serde</span><span class="p">::</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">],</span>
<span class="n">ignore</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">input</span><span class="o">-</span><span class="n">stream</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="n">traits</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">serde</span><span class="p">::</span><span class="n">Serialize</span><span class="p">,</span><span class="w"> </span><span class="n">serde</span><span class="p">::</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">],</span>
<span class="n">interface</span><span class="p">:</span><span class="w"> </span><span class="s">"adobe:cai/types@0.1.0"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cdmurph32/c2pa-component/blob/v24/wit/cai.wit" style="background-image: url(&quot;https://uploads.zulipusercontent.net/3a39164dd2ea46372423c0ca46f285383270d222/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636263623264323539373531616363306233633566376331346561363566663666623938343239316661653634366337623266396263623239656337623032312f63646d7572706833322f633270612d636f6d706f6e656e74&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cdmurph32/c2pa-component/blob/v24/wit/cai.wit" title="c2pa-component/wit/cai.wit at v24 · cdmurph32/c2pa-component">c2pa-component/wit/cai.wit at v24 · cdmurph32/c2pa-component</a></div><div class="message_embed_description">WASI P2 component for C2PA. Contribute to cdmurph32/c2pa-component development by creating an account on GitHub.</div></div></div>



<a name="504180603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/additional_derives%3A%20resource%20in%20variants%20or%20records/near/504180603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/additional_derives.3A.20resource.20in.20variants.20or.20records.html#504180603">(Mar 07 2025 at 20:40)</a>:</h4>
<p>That seems like a reasonable extension to me yeah, I'm not sure how exactly to encode this in the macro configuration or CLI but regardless I thnk it's a reasonable feature to have one way or another</p>



<a name="504181579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/additional_derives%3A%20resource%20in%20variants%20or%20records/near/504181579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin D Murphy <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/additional_derives.3A.20resource.20in.20variants.20or.20records.html#504181579">(Mar 07 2025 at 20:47)</a>:</h4>
<p>I don't know how many people are using it, but the change could be backwards compatible:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">serde</span><span class="p">::</span><span class="n">Serialize</span><span class="p">,</span><span class="w"> </span><span class="n">serde</span><span class="p">::</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">],</span>
<span class="n">additional_derives_ignore</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">input</span><span class="o">-</span><span class="n">stream</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">serde</span><span class="p">::</span><span class="n">Serialize</span><span class="p">,</span><span class="w"> </span><span class="n">serde</span><span class="p">::</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">],</span>
<span class="n">additional_derives_interface</span><span class="p">:</span><span class="w"> </span><span class="s">"adobe:cai/types@0.1.0"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="504181982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/additional_derives%3A%20resource%20in%20variants%20or%20records/near/504181982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/additional_derives.3A.20resource.20in.20variants.20or.20records.html#504181982">(Mar 07 2025 at 20:50)</a>:</h4>
<p>both seem reasonable enough to me yeah</p>



<a name="504637367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/additional_derives%3A%20resource%20in%20variants%20or%20records/near/504637367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin D Murphy <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/additional_derives.3A.20resource.20in.20variants.20or.20records.html#504637367">(Mar 10 2025 at 16:37)</a>:</h4>
<p>PR opened: <a href="https://github.com/bytecodealliance/wit-bindgen/pull/1199/files#top">feat: Allow variants and records to be ignored by additional_derives</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/pull/1199/files#top" style="background-image: url(&quot;https://uploads.zulipusercontent.net/634312f38cf7b7f8759b21d522bcb1895601b61a/68747470733a2f2f617661746172732e67697468756275736572636f6e74656e742e636f6d2f752f333435393335333f733d34303026763d34&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/pull/1199/files#top" title="feat: Allow variants and records to be ignored by additional_derives by cdmurph32 · Pull Request #1199 · bytecodealliance/wit-bindgen">feat: Allow variants and records to be ignored by additional_derives by cdmurph32 · Pull Request #1199 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">This feature allows some variants and records to use types for which adding traits will cause compilation to fail, such as serde::Deserialize on wasi:io/streams.
Variants and records are specified ...</div></div></div>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>