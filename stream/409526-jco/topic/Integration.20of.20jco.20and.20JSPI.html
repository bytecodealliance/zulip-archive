<html>
<head><meta charset="utf-8"><title>Integration of jco and JSPI · jco · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/index.html">jco</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html">Integration of jco and JSPI</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="547761784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Integration%20of%20jco%20and%20JSPI/near/547761784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Catherine (whitequark) <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html#547761784">(Oct 29 2025 at 16:25)</a>:</h4>
<p>I would like to use jco together with JSPI. To be specific, I have many WASIp2 (which are currently wrapped WASIp1) applications, which are in turn wrapped with jco and ran from the web as well as other platforms. Since wasi-virt is incapable of providing a filesystem <em>overlay</em>, I have to implement the entire filesystem in JavaScript. </p>
<p>Right now, I have to download the entire filesystem upfront. I would like to download files on-demand whenever they're opened (or at least to provide the option to do so), to avoid massive waste of bandwidth when packages like Clang are involved (where sizes of 100..400 MB are not uncommon). To do this, I need jco to wrap the <code>wasi:cli/run</code> export in <code>WebAssembly.promising</code> (easy enough), and the <code>path_open</code> import (or its WASIp2 equivalent) in <code>WebAssembly.Suspending</code> (which <code>--async-import</code> seems to silently fail to do).</p>
<p>How do I do this with jco?</p>



<a name="547762863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Integration%20of%20jco%20and%20JSPI/near/547762863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html#547762863">(Oct 29 2025 at 16:29)</a>:</h4>
<p>Have you tried with the <code>asyncMode: 'jspi'</code> option just yet? Also, I'm assuming you already know about <code>--instantiation=async</code>?</p>



<a name="547763195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Integration%20of%20jco%20and%20JSPI/near/547763195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html#547763195">(Oct 29 2025 at 16:31)</a>:</h4>
<p>Here's an example from a test:</p>
<p><a href="https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L72">https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L72</a></p>
<p>Unfortunately we don't have a good example in the Jco book, but we do have the option documented:</p>
<p><a href="https://bytecodealliance.github.io/jco/transpiling.html?highlight=jspi#options">https://bytecodealliance.github.io/jco/transpiling.html?highlight=jspi#options</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L72" style="background-image: url(&quot;https://uploads.zulipusercontent.net/9de63283e00e68386926e114af382da5a4e218fa/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f643266363864306334363932373139333364353739336665383732396133376633623236373863393363346538396131633436336635313362383834393366382f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L72" title="jco/packages/jco/test/jspi.js at fd13566145b81611c7ad400cb115ae195f2c30f6 · bytecodealliance/jco">jco/packages/jco/test/jspi.js at fd13566145b81611c7ad400cb115ae195f2c30f6 · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="547763357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Integration%20of%20jco%20and%20JSPI/near/547763357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html#547763357">(Oct 29 2025 at 16:31)</a>:</h4>
<p>As you can see from the test you'll need to <a href="https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L88">specify your async imports as well</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L88" style="background-image: url(&quot;https://uploads.zulipusercontent.net/9de63283e00e68386926e114af382da5a4e218fa/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f643266363864306334363932373139333364353739336665383732396133376633623236373863393363346538396131633436336635313362383834393366382f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/blob/fd13566145b81611c7ad400cb115ae195f2c30f6/packages/jco/test/jspi.js#L88" title="jco/packages/jco/test/jspi.js at fd13566145b81611c7ad400cb115ae195f2c30f6 · bytecodealliance/jco">jco/packages/jco/test/jspi.js at fd13566145b81611c7ad400cb115ae195f2c30f6 · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="547763598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Integration%20of%20jco%20and%20JSPI/near/547763598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html#547763598">(Oct 29 2025 at 16:32)</a>:</h4>
<p>I'd love to know which documentation you took a quick glance at to see where we should include better docs on this, but the book is probably a good start (contributions welcome of course!).</p>
<p>If you'd like to create a ticket against jco that would help with tracking the improvement to the documentation</p>



<a name="547778714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Integration%20of%20jco%20and%20JSPI/near/547778714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Catherine (whitequark) <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Integration.20of.20jco.20and.20JSPI.html#547778714">(Oct 29 2025 at 17:48)</a>:</h4>
<p>Turns out I had a small and difficult to notice typo in my <code>jco</code> invocation. The following seems to do what I want:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">jco</span><span class="w"> </span><span class="p">[</span><span class="o">..</span><span class="p">.]</span><span class="w"> </span><span class="o">--</span><span class="k">async</span><span class="o">-</span><span class="n">mode</span><span class="w"> </span><span class="n">jspi</span><span class="w"> </span><span class="o">--</span><span class="k">async</span><span class="o">-</span><span class="n">exports</span><span class="w"> </span><span class="o">'</span><span class="na">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">run</span><span class="p">#</span><span class="n">run</span><span class="o">'</span><span class="w"> </span><span class="o">--</span><span class="k">async</span><span class="o">-</span><span class="n">imports</span><span class="w"> </span><span class="o">'</span><span class="na">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="cp">#[method]</span><span class="n">descriptor</span><span class="p">.</span><span class="n">open</span><span class="o">-</span><span class="n">at</span><span class="o">'</span>
</code></pre></div>
<p>Thanks!</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>