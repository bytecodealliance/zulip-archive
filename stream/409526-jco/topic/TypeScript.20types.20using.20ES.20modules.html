<html>
<head><meta charset="utf-8"><title>TypeScript types using ES modules · jco · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/index.html">jco</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html">TypeScript types using ES modules</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="500756913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500756913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500756913">(Feb 19 2025 at 22:40)</a>:</h4>
<p>Hi! While using <code>jco transpile</code>, I've had a few issues with the generated types. Here's an example WIT and the current <code>jco transpile</code> output: <a href="https://gist.github.com/encounter/41cf4793ac1ff6e5e62f3077830f5cbe">https://gist.github.com/encounter/41cf4793ac1ff6e5e62f3077830f5cbe</a></p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">diff</span><span class="p">,</span><span class="w"> </span><span class="nx">types</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'objdiff-wasm'</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">runDiff</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ERROR: DiffResult is not exported on namespace ObjdiffCoreTypes</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="kt">types.DiffResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diff</span><span class="p">.</span><span class="nx">runDiff</span><span class="p">(...);</span>
<span class="p">}</span>
</code></pre></div>
<p>Initially, I tried working around this by adding <code>export type { DiffResult };</code> in the generated TypeScript namespace. However, it still does not work: <code>export const types: typeof ObjdiffCoreTypes;</code> A variable can't have associated types, so the only things that get exported are the actual functions.</p>
<p>I tried using <code>guest-types</code>, but it leaves the root .d.ts broken. It tries to import the namespaces, despite them not existing anymore.</p>
<p>I settled on a new approach that builds on top of <code>guest-types</code> and turns it into a more fully-fledged solution. (Full output here: <a href="https://gist.github.com/encounter/d6d2c946e305b1949f0e3a6fe634e209">https://gist.github.com/encounter/d6d2c946e305b1949f0e3a6fe634e209</a>)</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">ObjdiffCoreDiff</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'./interfaces/objdiff-core-diff.js'</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ObjdiffCoreDiff</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">diff</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<p>Instead of using namespaces, we can <code>import *</code> the interface, and then export it from the root. This preserves everything: all functions and types are accessible.</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="kr">declare</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="s1">'objdiff:core/diff'</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">runDiff</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ObjectData</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">runDiff</span><span class="p">(</span><span class="nx">left</span><span class="o">:</span><span class="w"> </span><span class="kt">ObjectData</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="nx">right</span><span class="o">:</span><span class="w"> </span><span class="kt">ObjectData</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="kt">DiffConfig</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DiffResult</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ObjectData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'./objdiff-core-types.js'</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ObjectData</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<p>In the interface, we have the <code>declare module</code> from <code>guest-types</code>, but we've extended it even further. Functions are exported in both the interface itself and the declared module, so that the <code>import *</code> from the root contains them.<br>
Additionally, we <code>export type</code> any types in the module. Before, only functions and classes were exported.</p>
<p>This means that if you reference it via <code>objdiff:core/diff</code> or by <code>import { diff } from '...'</code>, you get <em>all</em> of the functions and associated types.</p>
<p>I'd like to gather feedback. Right now I have it implemented with an <code>--es-modules</code> flag, and internally it replaces <code>opts.guest</code> with <code>opts.es_modules</code>. However, I believe this approach fully fixes the ergonomics of using the generated types, and I'd like to consider making it the default. I'm also happy to submit a PR with what I have so far for further discussion.</p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/encounter/41cf4793ac1ff6e5e62f3077830f5cbe" style="background-image: url(&quot;https://uploads.zulipusercontent.net/91f9baed8f4fc08c462d1a4de5a8c23942d45e97/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f6173736574732f676973742d6f672d696d6167652d3534666437646330373133652e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/encounter/41cf4793ac1ff6e5e62f3077830f5cbe" title="Current output of jco transpile">Current output of jco transpile</a></div><div class="message_embed_description">Current output of jco transpile. GitHub Gist: instantly share code, notes, and snippets.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/encounter/d6d2c946e305b1949f0e3a6fe634e209" style="background-image: url(&quot;https://uploads.zulipusercontent.net/91f9baed8f4fc08c462d1a4de5a8c23942d45e97/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f6173736574732f676973742d6f672d696d6167652d3534666437646330373133652e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/encounter/d6d2c946e305b1949f0e3a6fe634e209" title="New output of jco transpile --es-modules">New output of jco transpile --es-modules</a></div><div class="message_embed_description">New output of jco transpile --es-modules. GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="500757210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500757210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500757210">(Feb 19 2025 at 22:42)</a>:</h4>
<p>Thanks for looking into this - a PR against guest-types would be amazing as that flag hasn't been fully developed yet. Are there any limitations to this approach for guest types?</p>



<a name="500757763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500757763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500757763">(Feb 19 2025 at 22:47)</a>:</h4>
<p>No limitations as far as I'm aware. You could consider this "fully developed" guest-types. But I developed it to fix my issues with the transpiled/non-guest types, so I think it could in theory replace both.</p>



<a name="500758835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500758835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500758835">(Feb 19 2025 at 22:55)</a>:</h4>
<p>guest types are under tested right now, but if it passes transpiled types that is great too</p>
<p>of course taking into account the difference between guest and host types (and specifically that guest types shouldn't type imports, but still does)</p>



<a name="500760018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500760018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500760018">(Feb 19 2025 at 23:05)</a>:</h4>
<p>Yeah, I guess I should clarify: I'm not sure the scope of what all guest-types needs to do. Currently, it only changes the TS namespaces to ES modules, and that's also what I wanted to do for the host types in this scenario, so it internally replaces the "guest" option with a more generic "es_modules" option.</p>
<p>I assume guest types will need other changes, like you describe, and therefore the guest option would have to be re-implemented separately from this.</p>
<p>So this is specifically targeting host types, but it fully overlaps with how guest types are <em>currently</em> implemented, making it necessary to refactor that. A bit confusing but hopefully that helps.</p>
<p>I'll submit a draft PR soon!</p>



<a name="500760082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500760082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500760082">(Feb 19 2025 at 23:05)</a>:</h4>
<p>can we not replace the TS namespaces with modules across both of host and guest without otherwise changing flags?</p>



<a name="500760492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500760492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500760492">(Feb 19 2025 at 23:08)</a>:</h4>
<p>Yes, and I personally think that's the best approach, since I'm not aware of any value in keeping the TS namespaces.</p>
<p>That would make the types and guest-types output exactly the same for now, and I assume guest-types would be further developed later.</p>



<a name="500761425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500761425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milan <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500761425">(Feb 19 2025 at 23:16)</a>:</h4>
<p>wasmcloud's getting started had a <a href="https://github.com/wasmCloud/wasmCloud/blob/6f8cfd9866f4f000e3d039c518fc845a10ab8ebf/examples/typescript/components/http-hello-world/generated/types/wasi-http-types.d.ts#L2">manual patch to generated types</a> to switch to module declarations. Better out of the box support would be great! FYI <span class="user-mention" data-user-id="598440">@Victor Adossi</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/wasmCloud/wasmCloud/blob/6f8cfd9866f4f000e3d039c518fc845a10ab8ebf/examples/typescript/components/http-hello-world/generated/types/wasi-http-types.d.ts#L2" style="background-image: url(&quot;https://uploads.zulipusercontent.net/16762fc1438fdc6db4a0ad2e5782897700aa9a1f/68747470733a2f2f7265706f7369746f72792d696d616765732e67697468756275736572636f6e74656e742e636f6d2f3330343430333639322f31643761333062662d366433642d346161312d386663322d333663623031303938346463&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/wasmCloud/wasmCloud/blob/6f8cfd9866f4f000e3d039c518fc845a10ab8ebf/examples/typescript/components/http-hello-world/generated/types/wasi-http-types.d.ts#L2" title="wasmCloud/examples/typescript/components/http-hello-world/generated/types/wasi-http-types.d.ts at 6f8cfd9866f4f000e3d039c518fc845a10ab8ebf · wasmCloud/wasmCloud">wasmCloud/examples/typescript/components/http-hello-world/generated/types/wasi-http-types.d.ts at 6f8cfd9866f4f000e3d039c518fc845a10ab8ebf · wasmCloud/wasmCloud</a></div><div class="message_embed_description">wasmCloud is an open source Cloud Native Computing Foundation (CNCF) project that enables teams to build, manage, and scale polyglot apps across any cloud, K8s, or edge. - wasmCloud/wasmCloud</div></div></div>



<a name="500762713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500762713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milan <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500762713">(Feb 19 2025 at 23:27)</a>:</h4>
<p>edit: sorry for the noise, was confusing host and guest types, but getting rid of namespaces all around sounds great <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="500762821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500762821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500762821">(Feb 19 2025 at 23:28)</a>:</h4>
<p>great to hear - would be fantastic to see a PR along these lines</p>



<a name="500770126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500770126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500770126">(Feb 20 2025 at 00:35)</a>:</h4>
<p>Submitted: <a href="https://github.com/bytecodealliance/jco/pull/571">https://github.com/bytecodealliance/jco/pull/571</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/pull/571" style="background-image: url(&quot;https://uploads.zulipusercontent.net/2b695bd1862c8002989b01a92993c04c99212029/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323338303939633336396637363364323765306533326237383038366336636338643135373039393633363462323536323265323562633466326666626130322f62797465636f6465616c6c69616e63652f6a636f2f70756c6c2f353731&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/pull/571" title="feat: generate ES modules instead of TS namespaces by encounter · Pull Request #571 · bytecodealliance/jco">feat: generate ES modules instead of TS namespaces by encounter · Pull Request #571 · bytecodealliance/jco</a></div><div class="message_embed_description">This PR does a few things:

ES modules are generated by default (declare module &#39;...&#39;), just like guest-types.
Root .d.ts imports now use import * as Interface from &#39;...&#39; rather tha...</div></div></div>



<a name="500770519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500770519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500770519">(Feb 20 2025 at 00:39)</a>:</h4>
<p>thank you! will review soon</p>



<a name="500812866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500812866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500812866">(Feb 20 2025 at 07:45)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="703325">@Luke Street</span> would you mind sharing how you're integrating with respect to <code>tsconfig.json</code> and your imports for the types? Curious to see what approach you're taking there given the multiple options.</p>
<p>One thing we've been trying to solve for is ambient TS modules, so that once people have the bindings folder <code>include</code>d (via <code>tsconfig.json</code>), they can go straight to code like this:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">runDiff</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"objdiff:core/diff"</span><span class="p">;</span>
</code></pre></div>
<p>To get this to work, we have to use <a href="https://www.typescriptlang.org/docs/handbook/modules/reference.html#ambient-modules">Ambient Modules</a> which <em>only</em> include the  <code>declare module "..."</code> in the file without any other external imports/exports. </p>
<p>This isn't something we have working today, but where we <em>want</em> to get to for code generated for guests.</p>
<p>I bring this up because if I trim the "module augmentations" (which is how TS will view any file with a top level <code>import</code>/<code>export</code> next to a <code>declare module ...</code>), I get code that is less usable than what the <code>guest-types</code> would output (<em>ignoring</em> of course the missing actual definitions.</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="kr">declare</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="s1">'objdiff:core/diff'</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">runDiff</span><span class="p">(</span><span class="nx">left</span><span class="o">:</span><span class="w"> </span><span class="kt">ObjectData</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="nx">right</span><span class="o">:</span><span class="w"> </span><span class="kt">ObjectData</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="kt">DiffConfig</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DiffResult</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// import type { ObjectData } from './objdiff-core-types.js';</span>
<span class="c1">// export { ObjectData };</span>
<span class="c1">// import type { ObjectDiff } from './objdiff-core-types.js';</span>
<span class="c1">// export { ObjectDiff };</span>
<span class="c1">// import type { DiffConfig } from './objdiff-core-types.js';</span>
<span class="c1">// export { DiffConfig };</span>
<span class="c1">// import type { DiffResult } from './objdiff-core-types.js';</span>
<span class="c1">// export { DiffResult };</span>
</code></pre></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>NEW</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>declare module 'objdiff:core/diff' {<br>
  export { runDiff };<br>
  export type { ObjectData };<br>
  export type { ObjectDiff };<br>
  export type { DiffConfig };<br>
  export type { DiffResult };<br>
}<br>
// export function runDiff(left: ObjectData | undefined, right: ObjectData | undefined, config: DiffConfig): DiffResult;<br>
// import type { ObjectData } from './objdiff-core-types.js';<br>
// export type { ObjectData };<br>
// import type { ObjectDiff } from './objdiff-core-types.js';<br>
// export type { ObjectDiff };<br>
// import type { DiffConfig } from './objdiff-core-types.js';<br>
// export type { DiffConfig };<br>
// import type { DiffResult } from './objdiff-core-types.js';<br>
// export type { DiffResult };</p>
</div></div>
<p>Obviously, there are lots of problems with just commenting out a bunch of relevant type imports/exports, but what I want to point out is that the new re-export methodology might not quite work as well as what we had before in the guest component case -- we get a little further away from the ideal state.</p>
<p>If I trim the declarations in a file like <code>objdiff-core-diff.d.ts</code> in the old <code>guest-types</code> code, w/ a top level </p>
<p>Separately, do you run into the following errors with your generated <code>.d.ts</code> files?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">typescript</span><span class="w"> </span><span class="p">[</span><span class="mi">2666</span><span class="p">]:</span><span class="w"> </span><span class="nc">Exports</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="n">assignments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">permitted</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">augmentations</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">typescript</span><span class="w"> </span><span class="p">[</span><span class="mi">2484</span><span class="p">]:</span><span class="w"> </span><span class="nc">Export</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exported</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="o">'</span><span class="na">runDiff</span><span class="o">'</span><span class="p">.</span>
</code></pre></div>
<p><code>tsc</code> certainly runs just fine, but it is odd that these pop up.</p>



<a name="500813197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500813197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500813197">(Feb 20 2025 at 07:47)</a>:</h4>
<p>I've made a reproduction repository so it's a bit easier to visualize/hack on these:</p>
<p><a href="https://github.com/vados-cosmonic/jco-typegen-repro">https://github.com/vados-cosmonic/jco-typegen-repro</a></p>
<p>(builds of <code>jco</code> are not included, sorry -- just the output of <code>jco types</code>/<code>jco guest-types</code>)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/vados-cosmonic/jco-typegen-repro" style="background-image: url(&quot;https://uploads.zulipusercontent.net/04e5f2b6158df5a3046b38cd29e32678f3e893e3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396637383964616435656131613965386663323539313537353638393861363365343363636232643636346533353239623133393530323161636466313237362f7661646f732d636f736d6f6e69632f6a636f2d7479706567656e2d726570726f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/vados-cosmonic/jco-typegen-repro" title="GitHub - vados-cosmonic/jco-typegen-repro">GitHub - vados-cosmonic/jco-typegen-repro</a></div><div class="message_embed_description">Contribute to vados-cosmonic/jco-typegen-repro development by creating an account on GitHub.</div></div></div>



<a name="500814579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500814579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500814579">(Feb 20 2025 at 07:57)</a>:</h4>
<p>oof ran out of time to edit, so weird formatting remained, but hopefully it's clear.</p>



<a name="500869968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500869968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500869968">(Feb 20 2025 at 12:50)</a>:</h4>
<p>Hey Victor, thanks for the detailed info. My use case is host types, so I’m importing everything from the root module directly, <em>not</em> using the ambient module imports.</p>
<p>I was under the impression that the ambient modules <em>already</em> worked with the guest-types output, and that my changes would not affect that, since I’m simply adding more exports. Sounds like that assumption was wrong, though <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<p>Thinking about it: maybe this is the distinction we need to make for host and guest types:</p>
<ul>
<li>Host types only have the imports/exports, omitting the TS namespace / <code>declare module</code> part entirely. These are non-ambient types for a JS module that we’re importing, so the <code>declare module</code> part is unnecessary (and confusing).</li>
<li>Guest types <em>only</em> have <code>declare module</code>, all exports are inside of there. The goal being to omit real ambient modules. Maybe the root .d.ts <code>/// &lt;reference</code>s the other interfaces.</li>
</ul>
<p>I just recently ran into an issue where I wanted type imports in an ambient .d.ts, and I was able to solve it using the <code>import()</code> syntax:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="kr">declare</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="s1">'foo'</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">'./bar'</span><span class="p">).</span><span class="nx">Bar</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>So maybe this is the solution for generating proper guest types with ambient modules.</p>
<p>I’m happy to experiment with this idea. Let me know if this sounds right to you.</p>



<a name="500904101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500904101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500904101">(Feb 20 2025 at 15:14)</a>:</h4>
<p>I think that distinction makes a lot of sense to me. The key reason to use TS namespaces in the first place IIRC was the ability to split declarations across files, something I'm not sure we ended up doing at all.</p>
<p>One wrinkle we've run into is that people have had problems with even the syntax of <code>declare module</code> that I'm suggestion (and you're suggesting), this came up in <a href="#narrow/channel/409526-jco/topic/Difficulties.20getting.20started.20with.20jco">another discussion</a> (I can't tell if this is a tooling mismatch somehow or something else -- the allowed syntaxes seem to somewhat differ with what plain <code>tsc</code> will allow)</p>
<p>I definitely support using that syntax to get to ambient imports, if it works well I'd love to adopt it -- it would massively improve ergonomics for <code>jco</code> type generation.</p>



<a name="500992104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/500992104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#500992104">(Feb 20 2025 at 23:49)</a>:</h4>
<p>I have fully functional ambient module generation now:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="c1">/// &lt;reference path="./objdiff-core-diff-types.d.ts" /&gt;</span>
<span class="kr">declare</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="s1">'objdiff:core/diff'</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">runDiff</span><span class="p">(</span><span class="nx">left</span><span class="o">:</span><span class="w"> </span><span class="kt">Object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="nx">right</span><span class="o">:</span><span class="w"> </span><span class="kt">Object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="kt">DiffConfig</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DiffResult</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nb">Object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">'objdiff:core/diff-types'</span><span class="p">).</span><span class="nb">Object</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">DiffConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">'objdiff:core/diff-types'</span><span class="p">).</span><span class="nx">DiffConfig</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">DiffResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">'objdiff:core/diff-types'</span><span class="p">).</span><span class="nx">DiffResult</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>It even works with the root .d.ts:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="c1">/// &lt;reference path="./interfaces/objdiff-core-diff-types.d.ts" /&gt;</span>
<span class="c1">/// &lt;reference path="./interfaces/objdiff-core-diff.d.ts" /&gt;</span>
<span class="c1">/// &lt;reference path="./interfaces/objdiff-core-display-types.d.ts" /&gt;</span>
<span class="c1">/// &lt;reference path="./interfaces/wasi-logging-logging.d.ts" /&gt;</span>
<span class="kr">declare</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="s1">'objdiff:core/api'</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">Level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">'wasi:logging/logging@0.1.0-draft'</span><span class="p">).</span><span class="nx">Level</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">diffTypes</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'objdiff:core/diff-types'</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">displayTypes</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'objdiff:core/display-types'</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">diff</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'objdiff:core/diff'</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">init</span><span class="p">(</span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">Level</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">version</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Though I realized we're missing another piece, we need to generate ambient modules for imports and concrete modules for exports (and invert that for guest-types), rather than having it all generate one way or the other. More to do <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="501021376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501021376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501021376">(Feb 21 2025 at 04:58)</a>:</h4>
<p>Wow fantastic, thanks for putting in the hard work here!</p>
<p>Yeah I think you're fully read in on the difference between host and guest types now :) it's subtle but I <em>think</em> there's enough there to keep the commands different but I'm not sure the average person can tell the difference w/ the current naming.</p>



<a name="501021449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501021449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501021449">(Feb 21 2025 at 04:59)</a>:</h4>
<p>I like that it's module native all the way down, this should transfer <em>really</em> well to the browser (w/ a competent bundler), you might end up fixing that other issue at the same time!</p>



<a name="501021899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501021899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501021899">(Feb 21 2025 at 05:02)</a>:</h4>
<p>Let me know if/when I should refresh your branch and I'll give it a test (I have your branch pulled locally of course) -- I don't know if my <code>tsc</code> setup is just generating more warnings. Given that the <code>import()</code> syntax is exactly what you have to use in <code>declare module</code> blocks (which I I didn't know before, thanks!) -- I get the feeling we're going to be warning free :)</p>



<a name="501030659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501030659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501030659">(Feb 21 2025 at 06:31)</a>:</h4>
<p>I thought I had a clever idea: always emit interfaces as ambient modules, and the only difference between host and guest types would be whether the root .d.ts is an ambient module or not. This would be quite elegant, all imports could use the <code>ns:pkg/iface</code> style.</p>
<p>It seems that causes issues when an interface is generated in multiple type files:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">flavorful</span><span class="o">/</span><span class="n">interfaces</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">streams</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">ts</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="n">TS2300</span><span class="p">:</span><span class="w"> </span><span class="nc">Duplicate</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">'</span><span class="na">OutputStream</span><span class="o">'</span><span class="p">.</span>
<span class="n">test</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">many</span><span class="o">-</span><span class="n">arguments</span><span class="o">/</span><span class="n">interfaces</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">streams</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">ts</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="n">TS2300</span><span class="p">:</span><span class="w"> </span><span class="nc">Duplicate</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">'</span><span class="na">OutputStream</span><span class="o">'</span><span class="p">.</span>
</code></pre></div>
<p>(Thanks tests!)</p>
<p>I could see this becoming an issue if you import multiple packages that use a common WASI interface, and both have a <code>wasi-io-streams.d.ts</code> with <code>declare module 'wasi:io/streams@0.2.0'</code>. Unless there's a workaround here, I think means we can't use ambient modules in host types at all, given that packages may ship the types and thus conflict with each other.</p>
<p>Would this affect guest types too? My initial thought is no, it'd be reasonable to assume there's only one "set" of guest types that'd exist in a project, given that the purpose of the project would be implementing those types.</p>
<p>I'll definitely update my branch when I have tests passing again.</p>



<a name="501033343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501033343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501033343">(Feb 21 2025 at 06:57)</a>:</h4>
<p>Tests are the real MVPs :)</p>
<p>And yeah -- the multiple packages using common WASI interfaces is as you might expect a <em>very</em> common case.</p>
<p>One thing that I've also thought about in the past is changing the generation methodology to produce folders that have de-duped names as well. Feel free to try that, we're not tied to file-per-interface, IMO, and while there isn't any way to semantically/intelligently compare right now, we can use names to dedup effort I think for now...</p>
<p>Let me know if I'm not understanding the problem you ran into properly!</p>



<a name="501033742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501033742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501033742">(Feb 21 2025 at 07:00)</a>:</h4>
<p>Ahh let me think about that some more... I'm fairly certain it's impossible/unintended to have two completely different modules with the same package, name, interface and version that are <em>both</em> implemented w/ different WIT contents... You should be fine to dedup and go one level up and allow for some cross-component reuse</p>



<a name="501133025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501133025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Street <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501133025">(Feb 21 2025 at 15:42)</a>:</h4>
<p>That’d be nice if we could assume we controlled all the types in the project, but I’m imagining a situation where you import an npm package that has its own wasi types, if it uses a wasm component internally. I’m not aware of any way to dedupe interface types across package boundaries, but if someone has ideas, I’m all ears.</p>
<p>It’s fine, though, the alternative is using the normal relative imports (<code>import … from './interfaces/wasi-io-streams.js'</code>) and not using <code>declare module</code> at all in host types. Just means we can’t unify host/guest types like I wanted to.</p>



<a name="501955889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501955889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claire Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501955889">(Feb 26 2025 at 03:53)</a>:</h4>
<p>hey hey, got <a href="https://github.com/yoshuawuyts/wstd/blob/main/examples/http_client.rs">this wstd Rust example</a> (sends a HTTP GET request to a URL and logs the result) compiled to WASM and JSified with <code>jco transpile</code>.</p>
<p>It gets about half way through the function before it hits this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="n">OK</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">content</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nc">text</span><span class="o">/</span><span class="n">html</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">etag</span><span class="p">:</span><span class="w"> </span><span class="s">"84238dfc8092e5d9c0dac8ef93371a07:1736799080.121134"</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">last</span><span class="o">-</span><span class="n">modified</span><span class="p">:</span><span class="w"> </span><span class="nc">Mon</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">Jan</span><span class="w"> </span><span class="mi">2025</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">20</span><span class="w"> </span><span class="n">GMT</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">cache</span><span class="o">-</span><span class="n">control</span><span class="p">:</span><span class="w"> </span><span class="nc">max</span><span class="o">-</span><span class="n">age</span><span class="o">=</span><span class="mi">1365</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="nc">Wed</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">2025</span><span class="w"> </span><span class="mi">03</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">15</span><span class="w"> </span><span class="n">GMT</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">alt</span><span class="o">-</span><span class="n">svc</span><span class="p">:</span><span class="w"> </span><span class="nc">h3</span><span class="o">=</span><span class="s">":443"</span><span class="p">;</span><span class="w"> </span><span class="n">ma</span><span class="o">=</span><span class="mi">93600</span><span class="p">,</span><span class="n">h3</span><span class="o">-</span><span class="mi">29</span><span class="o">=</span><span class="s">":443"</span><span class="p">;</span><span class="w"> </span><span class="n">ma</span><span class="o">=</span><span class="mi">93600</span><span class="p">,</span><span class="n">quic</span><span class="o">=</span><span class="s">":443"</span><span class="p">;</span><span class="w"> </span><span class="n">ma</span><span class="o">=</span><span class="mi">93600</span><span class="p">;</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="s">"43"</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">content</span><span class="o">-</span><span class="n">length</span><span class="p">:</span><span class="w"> </span><span class="mi">1256</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">connection</span><span class="p">:</span><span class="w"> </span><span class="nc">keep</span><span class="o">-</span><span class="n">alive</span>
<span class="n">file</span><span class="p">:</span><span class="sd">///mnt/c/Users/.../node_modules/@bytecodealliance/preview2-shim/lib/io/worker-io.js:323</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">src</span><span class="p">:</span><span class="w"> </span><span class="nc">src</span><span class="p">.#</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">}</span>
<span class="w">                 </span><span class="o">^</span>

<span class="n">TypeError</span><span class="p">:</span><span class="w"> </span><span class="nc">Cannot</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="p">#</span><span class="n">id</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">whose</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">it</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">OutputStream</span><span class="p">.</span><span class="n">splice</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="sd">///mnt/c/Users/.../node_modules/@bytecodealliance/preview2-shim/lib/io/worker-io.js:323:18)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">trampoline56</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="sd">///mnt/c/Users/.../comm/comm.js:2917:34)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">component</span><span class="p">:</span><span class="nc">shim</span><span class="p">.</span><span class="n">indirect</span><span class="o">-</span><span class="n">wasi</span><span class="p">:</span><span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.3</span><span class="o">-</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="n">output</span><span class="o">-</span><span class="n">stream</span><span class="p">.</span><span class="n">splice</span><span class="w"> </span><span class="p">(</span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/wit-component:shim-b13bbaba:wasm-function[16]:0x283)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[184]:0x7504</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[281]:0x16dc8</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[279]:0x103e0</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[96]:0x3286</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[329]:0x24c61</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[61]:0x148e</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">component</span><span class="p">:</span><span class="nc">adapter</span><span class="p">:</span><span class="nc">wasi_snapshot_preview1</span><span class="p">.</span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">run</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">#</span><span class="n">run</span><span class="w"> </span><span class="p">(</span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/wit-component:adapter:wasi_snapshot_preview1-2fd92fea:wasm-function[29]:0x701)</span>

<span class="n">Node</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="n">v22</span><span class="p">.</span><span class="mf">5.1</span>
</code></pre></div>
<p>just wondering if this is the right place to ask questions? <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/yoshuawuyts/wstd/blob/main/examples/http_client.rs" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4825b75f7c8b491e2340906f1dce7204c9695e4b/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353765626233313934316236333463353939393261616463663265616330333065383134643364643161393738333838333130303337383630626536663737612f796f7368756177757974732f77737464&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/yoshuawuyts/wstd/blob/main/examples/http_client.rs" title="wstd/examples/http_client.rs at main · yoshuawuyts/wstd">wstd/examples/http_client.rs at main · yoshuawuyts/wstd</a></div><div class="message_embed_description">A WebAssembly-native stdlib. Contribute to yoshuawuyts/wstd development by creating an account on GitHub.</div></div></div>



<a name="501956154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501956154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claire Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501956154">(Feb 26 2025 at 03:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="880914">Claire Smith</span> <a href="#narrow/channel/409526-jco/topic/TypeScript.20types.20using.20ES.20modules/near/501955889">said</a>:</p>
<blockquote>
<p>hey hey, got <a href="https://github.com/yoshuawuyts/wstd/blob/main/examples/http_client.rs">this wstd Rust example</a> (sends a HTTP GET request to a URL and logs the result) compiled to WASM and JSified with <code>jco transpile</code>.</p>
<p>It gets about half way through the function before it hits this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="n">OK</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">content</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nc">text</span><span class="o">/</span><span class="n">html</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">etag</span><span class="p">:</span><span class="w"> </span><span class="s">"84238dfc8092e5d9c0dac8ef93371a07:1736799080.121134"</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">last</span><span class="o">-</span><span class="n">modified</span><span class="p">:</span><span class="w"> </span><span class="nc">Mon</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">Jan</span><span class="w"> </span><span class="mi">2025</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">20</span><span class="w"> </span><span class="n">GMT</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">cache</span><span class="o">-</span><span class="n">control</span><span class="p">:</span><span class="w"> </span><span class="nc">max</span><span class="o">-</span><span class="n">age</span><span class="o">=</span><span class="mi">1365</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="nc">Wed</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">2025</span><span class="w"> </span><span class="mi">03</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">15</span><span class="w"> </span><span class="n">GMT</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">alt</span><span class="o">-</span><span class="n">svc</span><span class="p">:</span><span class="w"> </span><span class="nc">h3</span><span class="o">=</span><span class="s">":443"</span><span class="p">;</span><span class="w"> </span><span class="n">ma</span><span class="o">=</span><span class="mi">93600</span><span class="p">,</span><span class="n">h3</span><span class="o">-</span><span class="mi">29</span><span class="o">=</span><span class="s">":443"</span><span class="p">;</span><span class="w"> </span><span class="n">ma</span><span class="o">=</span><span class="mi">93600</span><span class="p">,</span><span class="n">quic</span><span class="o">=</span><span class="s">":443"</span><span class="p">;</span><span class="w"> </span><span class="n">ma</span><span class="o">=</span><span class="mi">93600</span><span class="p">;</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="s">"43"</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">content</span><span class="o">-</span><span class="n">length</span><span class="p">:</span><span class="w"> </span><span class="mi">1256</span>
<span class="o">&lt;</span><span class="w"> </span><span class="n">connection</span><span class="p">:</span><span class="w"> </span><span class="nc">keep</span><span class="o">-</span><span class="n">alive</span>
<span class="n">file</span><span class="p">:</span><span class="sd">///mnt/c/Users/.../node_modules/@bytecodealliance/preview2-shim/lib/io/worker-io.js:323</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">src</span><span class="p">:</span><span class="w"> </span><span class="nc">src</span><span class="p">.#</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">}</span>
<span class="w">                 </span><span class="o">^</span>

<span class="n">TypeError</span><span class="p">:</span><span class="w"> </span><span class="nc">Cannot</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="p">#</span><span class="n">id</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">whose</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">it</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">OutputStream</span><span class="p">.</span><span class="n">splice</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="sd">///mnt/c/Users/.../node_modules/@bytecodealliance/preview2-shim/lib/io/worker-io.js:323:18)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">trampoline56</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="sd">///mnt/c/Users/.../comm/comm.js:2917:34)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">component</span><span class="p">:</span><span class="nc">shim</span><span class="p">.</span><span class="n">indirect</span><span class="o">-</span><span class="n">wasi</span><span class="p">:</span><span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.3</span><span class="o">-</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="n">output</span><span class="o">-</span><span class="n">stream</span><span class="p">.</span><span class="n">splice</span><span class="w"> </span><span class="p">(</span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/wit-component:shim-b13bbaba:wasm-function[16]:0x283)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[184]:0x7504</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[281]:0x16dc8</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[279]:0x103e0</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[96]:0x3286</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[329]:0x24c61</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/001e552a:wasm-function[61]:0x148e</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">component</span><span class="p">:</span><span class="nc">adapter</span><span class="p">:</span><span class="nc">wasi_snapshot_preview1</span><span class="p">.</span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">run</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">#</span><span class="n">run</span><span class="w"> </span><span class="p">(</span><span class="n">wasm</span><span class="p">:</span><span class="c1">//wasm/wit-component:adapter:wasi_snapshot_preview1-2fd92fea:wasm-function[29]:0x701)</span>

<span class="n">Node</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="n">v22</span><span class="p">.</span><span class="mf">5.1</span>
</code></pre></div>
<p>just wondering if this is the right place to ask questions? <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
</blockquote>
<p>What topic should I go in .. I haven't used zulip before, sorry<br>
edit: figuring it out.</p>



<a name="501956317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501956317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501956317">(Feb 26 2025 at 03:58)</a>:</h4>
<p>Hey Claire it absolutely is! This IMO is worth making an issue for @ <a href="https://github.com/bytecodealliance/jco">https://github.com/bytecodealliance/jco</a> :)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco" style="background-image: url(&quot;https://uploads.zulipusercontent.net/6266a131761c63433378d5bd91b7e1c1da2020d4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656665386431333938613638633932326562333036323131623730313530633363626134333836656333313133616430333438376565363761356436623765352f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco" title="GitHub - bytecodealliance/jco: JavaScript toolchain for working with WebAssembly Components">GitHub - bytecodealliance/jco: JavaScript toolchain for working with WebAssembly Components</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="501956361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501956361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501956361">(Feb 26 2025 at 03:59)</a>:</h4>
<p>That said I think the fix is pretty simple, so I've added a PR for it that you could try:</p>
<p><a href="https://github.com/bytecodealliance/jco/pull/576">https://github.com/bytecodealliance/jco/pull/576</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/pull/576" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b6dfbe4ce05a0a1624c5a2894d32e5921f1e967d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f616533613730356231646131346639616265313866653764383531346235623833313037316235383036336661333134363134653663386565373562383038332f62797465636f6465616c6c69616e63652f6a636f2f70756c6c2f353736&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/pull/576" title="fix: usage of private member from output stream by vados-cosmonic · Pull Request #576 · bytecodealliance/jco">fix: usage of private member from output stream by vados-cosmonic · Pull Request #576 · bytecodealliance/jco</a></div><div class="message_embed_description">We read every piece of feedback, and take your input very seriously.</div></div></div>



<a name="501957632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501957632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claire Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501957632">(Feb 26 2025 at 04:13)</a>:</h4>
<p>Added that change, similar iss-a-ma-ue on line 340 same file</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">outputStream</span><span class="p">.#</span><span class="n">id</span><span class="p">;</span>
<span class="w">                        </span><span class="o">^</span>

<span class="n">TypeError</span><span class="p">:</span><span class="w"> </span><span class="nc">Cannot</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="p">#</span><span class="n">id</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">whose</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">it</span>
</code></pre></div>



<a name="501958682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501958682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claire Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501958682">(Feb 26 2025 at 04:19)</a>:</h4>
<p><a href="/user_uploads/15107/3OOnVfVR0fYLlQNZnO90E2tg/image.png">image.png</a><br>
<span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>
<div class="message_inline_image"><a href="/user_uploads/15107/3OOnVfVR0fYLlQNZnO90E2tg/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="1427x290" src="/user_uploads/thumbnail/15107/3OOnVfVR0fYLlQNZnO90E2tg/image.png/840x560.webp"></a></div>



<a name="501960836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501960836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501960836">(Feb 26 2025 at 04:41)</a>:</h4>
<p>Ah thanks for the update -- that's odd, let me dig in! </p>
<p>And thanks for filing the issue, I'll work against that :)</p>



<a name="501962742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501962742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501962742">(Feb 26 2025 at 05:00)</a>:</h4>
<p>Hey so good news, I got a fix in for the request, but some bad news, it looks like the <code>wstd</code> wasm is looking for a pollable that doesn't exist (and that it didn't create!)</p>



<a name="501962802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501962802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501962802">(Feb 26 2025 at 05:00)</a>:</h4>
<p>Looking into that, but I've pushed the fix for the member issues</p>



<a name="501962933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501962933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501962933">(Feb 26 2025 at 05:01)</a>:</h4>
<p>When you run with the latest code the HTTP request will happen but you will likely get a different error there</p>



<a name="501963879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501963879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501963879">(Feb 26 2025 at 05:09)</a>:</h4>
<p>Just a little peek at the madness:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">creating</span><span class="w"> </span><span class="n">poll</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="n">searching</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pollable</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">present</span><span class="o">?</span><span class="w"> </span><span class="kc">true</span>
<span class="n">creating</span><span class="w"> </span><span class="n">poll</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="n">searching</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pollable</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">present</span><span class="o">?</span><span class="w"> </span><span class="kc">true</span>
<span class="n">searching</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pollable</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">present</span><span class="o">?</span><span class="w"> </span><span class="kc">true</span>
<span class="n">searching</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pollable</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">present</span><span class="o">?</span><span class="w"> </span><span class="kc">true</span>
<span class="n">searching</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pollable</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">present</span><span class="o">?</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div>
<p>Of course that doesn't say much but the idea is that the <code>http_client</code> example makes some pollables, but then tries to check ready on pollable zero (which it never created)...</p>
<p>Debugging now, this might result in an upstream commit to <code>wstd</code> but otherwise I think the Jco side is working properly now :)</p>



<a name="501965252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501965252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claire Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501965252">(Feb 26 2025 at 05:24)</a>:</h4>
<p>I do still have issues, but if it's <code>wstd</code> rather than <code>jco</code> causing the issue, why would <code>wasmtime run -S http=y http_client.wasm https://example.com</code> work with the same wasm I used to create the JS-wasm module?</p>



<a name="501965903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501965903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501965903">(Feb 26 2025 at 05:30)</a>:</h4>
<p>That's a good question! I'm not sure, the current theory is a premature drop but still tracing to figure out!</p>



<a name="501965949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/501965949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claire Smith <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#501965949">(Feb 26 2025 at 05:31)</a>:</h4>
<p>I gotta run, best of luck, will check back in later so if there's any progress, keen to see :)</p>



<a name="502001678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/TypeScript%20types%20using%20ES%20modules/near/502001678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/TypeScript.20types.20using.20ES.20modules.html#502001678">(Feb 26 2025 at 09:44)</a>:</h4>
<p>5 messages were moved from this topic to <a class="stream-topic" data-stream-id="409526" href="/#narrow/channel/409526-jco/topic/Incomplete.20trailers.20support.20breaking.20wstd.20examples/with/501955889">#jco &gt; Incomplete trailers support breaking wstd examples</a> by <span class="user-mention silent" data-user-id="598440">Victor Adossi</span>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>