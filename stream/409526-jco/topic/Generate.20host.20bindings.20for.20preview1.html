<html>
<head><meta charset="utf-8"><title>Generate host bindings for preview1 · jco · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/index.html">jco</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html">Generate host bindings for preview1</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="514700237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514700237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bennett Hardwick <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514700237">(Apr 28 2025 at 00:45)</a>:</h4>
<p>Hello! I've got a WIT file I'm using to generate a guest for using wit-bindgen. I want to be able to run this on the web using a host generated by jco. Unfortunately I'm not able to transpile the wasm and since preview2 doesn't work natively in the browser I was hoping there was a way to generate a host using jco for preview1. Is this possible at all or will I need to hand-roll my host code? Thanks.</p>



<a name="514789985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514789985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514789985">(Apr 28 2025 at 11:36)</a>:</h4>
<p>Hey Bennett, right now jco does not have preview1 bindings, but there are a couple projects that might be of help here:</p>
<p><a href="https://github.com/bjorn3/browser_wasi_shim">https://github.com/bjorn3/browser_wasi_shim</a></p>
<p><a href="https://github.com/easywasm/wasi">https://github.com/easywasm/wasi</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bjorn3/browser_wasi_shim" style="background-image: url(&quot;https://uploads.zulipusercontent.net/10fab87bbaf1240e5f8d62babb69b7275b34ba0b/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613761333436353334313331323564306433383962366161653463623465313461613036326131393031343836343438393366383562663664373163643763372f626a6f726e332f62726f777365725f776173695f7368696d&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bjorn3/browser_wasi_shim" title="GitHub - bjorn3/browser_wasi_shim: A WASI shim for in the browser">GitHub - bjorn3/browser_wasi_shim: A WASI shim for in the browser</a></div><div class="message_embed_description">A WASI shim for in the browser. Contribute to bjorn3/browser_wasi_shim development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/easywasm/wasi" style="background-image: url(&quot;https://uploads.zulipusercontent.net/00e6b8d7a6acb4817beb9ce1c853c42d4ad53656/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373233646138346535653065663339623563623362333231663062333931616362643033373561626233313430346138306436303461613364343438306264612f656173797761736d2f77617369&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/easywasm/wasi" title="GitHub - easywasm/wasi: A working, zero-dependency implementation of WASI preview1, with lots of filesystem options.">GitHub - easywasm/wasi: A working, zero-dependency implementation of WASI preview1, with lots of filesystem options.</a></div><div class="message_embed_description">A working, zero-dependency implementation of WASI preview1, with lots of filesystem options. - easywasm/wasi</div></div></div>



<a name="514791382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514791382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bennett Hardwick <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514791382">(Apr 28 2025 at 11:43)</a>:</h4>
<p>Hi Victor thanks for the response! I've used the shim from bjorn3 a bit and it works great. However if I define a bunch of custom types using WIT there is a lot of glue code that I have to write. If I transpile a preview2 version of the same code with jco it produces all the required JS glue code (object serialization, deserialization, etc.) that would work with my preview1 binary, but it is trapped inside the "instantiate" closure. I've probably reached a dead end but is there any way with jco or with js-component-bindgen that I could just get the glue code? Thanks.</p>



<a name="514791708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514791708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514791708">(Apr 28 2025 at 11:45)</a>:</h4>
<p>Ah unfortunately, you'd need the preivew2 shims to be more developed for that :(</p>
<p>We had some work in the past that filled them out more, but they're still experimental and incomplete</p>



<a name="514791756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514791756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514791756">(Apr 28 2025 at 11:45)</a>:</h4>
<p>Could you list the bits that are missing from the current impl that you depend on?</p>



<a name="514791860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514791860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514791860">(Apr 28 2025 at 11:45)</a>:</h4>
<p>p2-shim usage on the browser is experimental but <em>some</em> of it is there -- maybe we can shift how we prioritize implementing to try to hit your usecases/maybe the work has already been done and just not committed yet</p>



<a name="514793434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514793434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bennett Hardwick <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514793434">(Apr 28 2025 at 11:53)</a>:</h4>
<p>I think the p2 shims have everything I need, it's just the "glue" that jco generates for custom records, etc. in wit.</p>
<p>For example the following in a .wit file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">record</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<span class="w">  </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="n">load</span><span class="o">-</span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">message</span>
</code></pre></div>
<p>Has code like so generated when transpiled with jco:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">exports</span><span class="p">.[</span><span class="s">"me:package/load-message"</span><span class="p">]();</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">namePtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DataView</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">exports</span><span class="p">.</span><span class="n">memory</span><span class="p">).</span><span class="n">getInt32</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">nameLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DataView</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">exports</span><span class="p">.</span><span class="n">memory</span><span class="p">).</span><span class="n">getInt32</span><span class="p">(</span><span class="n">ptr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">TextDecoder</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Uint8Array</span><span class="p">(</span><span class="o">..</span><span class="p">));</span>

<span class="w"> </span><span class="c1">// and so on ..</span>
<span class="p">}</span>
</code></pre></div>
<p>I would love to be able to just generate this glue code.</p>



<a name="514794098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514794098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514794098">(Apr 28 2025 at 11:56)</a>:</h4>
<p>OH, got you! OK in this case would you mind making an issue for this? This probably deserves some discussion, also there's the <a href="https://github.com/bytecodealliance/meetings/tree/main/SIG-Guest-Languages/JavaScript">JS guest languages meeting</a> where this might be worth discussion. </p>
<p>Unfortunately I can't make it this week, but being able to generate <em>just</em> the other bindings is an interesting feature request...</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/meetings/tree/main/SIG-Guest-Languages/JavaScript" style="background-image: url(&quot;https://uploads.zulipusercontent.net/50aa945de37a700429f1f4b0d93b55b280b912d3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613761646535393633623539313831333962303766386635363364343432356563636439303966383930353930643131333731663336663032386666363438342f62797465636f6465616c6c69616e63652f6d656574696e6773&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/meetings/tree/main/SIG-Guest-Languages/JavaScript" title="meetings/SIG-Guest-Languages/JavaScript at main · bytecodealliance/meetings">meetings/SIG-Guest-Languages/JavaScript at main · bytecodealliance/meetings</a></div><div class="message_embed_description">Contribute to bytecodealliance/meetings development by creating an account on GitHub.</div></div></div>



<a name="514794218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514794218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bennett Hardwick <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514794218">(Apr 28 2025 at 11:56)</a>:</h4>
<p>Will do, thanks Victor!</p>



<a name="514794229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514794229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514794229">(Apr 28 2025 at 11:56)</a>:</h4>
<p>Does monkey-patching not work as a solution for this?</p>
<p>If you could explain your ideal workflow here (and in the issue, if you file one!) that would probably help me and others get an idea of what you'd prefer <code>jco</code> to be able to do</p>



<a name="514794294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514794294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514794294">(Apr 28 2025 at 11:57)</a>:</h4>
<p>(I mean up to and including posting the commands as you might imagine them/what would be output!)</p>



<a name="514795205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/409526-jco/topic/Generate%20host%20bindings%20for%20preview1/near/514795205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bennett Hardwick <a href="https://bytecodealliance.github.io/zulip-archive/stream/409526-jco/topic/Generate.20host.20bindings.20for.20preview1.html#514795205">(Apr 28 2025 at 12:01)</a>:</h4>
<p>Yeah, I can definitely get stuff working by copy pasting just what I need so it's not too bad.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>