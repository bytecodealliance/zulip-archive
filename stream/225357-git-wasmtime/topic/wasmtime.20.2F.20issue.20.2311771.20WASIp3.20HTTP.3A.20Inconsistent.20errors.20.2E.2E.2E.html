<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11771 WASIp3 HTTP: Inconsistent errors ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html">wasmtime / issue #11771 WASIp3 HTTP: Inconsistent errors ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="542449756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311771%20WASIp3%20HTTP%3A%20Inconsistent%20errors%20.../near/542449756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html#542449756">(Oct 01 2025 at 09:35)</a>:</h4>
<p>wingo opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11771">issue #11771</a>:</p>
<blockquote>
<p>Consider this test for what the HTTP implementation does with invalid field names.  First it tries a field name with a space in it, then it tries <code>"</code>.  Both of these are <a href="https://www.rfc-editor.org/rfc/rfc9110.html#section-5.6.2">invalid</a>, but the first shows an error on <code>fields.delete</code> whereas the second does not:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:http/imports@0.3.0-rc-2025-09-16;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span>
<span class="w">    </span><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">],</span>
<span class="w">    </span><span class="n">features</span><span class="p">:[</span><span class="s">"clocks-timezone"</span><span class="p">],</span>
<span class="w">    </span><span class="n">generate_all</span>
<span class="p">});</span>

<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">Fields</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">HeaderError</span><span class="p">;</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">test_invalid_field_name</span><span class="p">(</span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"testing field: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fields</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="o">!</span><span class="n">fields</span><span class="p">.</span><span class="n">has</span><span class="p">(</span><span class="n">field</span><span class="p">));</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">field</span><span class="p">),</span>
<span class="w">               </span><span class="nb">Err</span><span class="p">(</span><span class="n">HeaderError</span><span class="p">::</span><span class="n">InvalidSyntax</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">test_valid_field_names</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">test_invalid_field_name</span><span class="p">(</span><span class="s">"field with space"</span><span class="p">);</span>
<span class="w">    </span><span class="n">test_invalid_field_name</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">test_valid_field_names</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Run it:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Wcomponent</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span><span class="w"> </span><span class="o">-</span><span class="n">Sp3</span><span class="p">,</span><span class="n">http</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">field</span><span class="o">-</span><span class="n">invalid</span><span class="p">.</span><span class="n">wasm</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wingo</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">testsuite</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="p">)</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.35</span><span class="n">s</span>
<span class="n">testing</span><span class="w"> </span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="nc">field</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">space</span>
<span class="n">testing</span><span class="w"> </span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="s">"</span>

<span class="s">thread 'main' (1) panicked at src/bin/field-invalid.rs:23:5:</span>
<span class="s">assertion `left == right` failed</span>
<span class="s">  left: Ok(())</span>
<span class="s"> right: Err(HeaderError::InvalidSyntax)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="542449758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311771%20WASIp3%20HTTP%3A%20Inconsistent%20errors%20.../near/542449758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html#542449758">(Oct 01 2025 at 09:35)</a>:</h4>
<p><a href="https://github.com/wingo">wingo</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11771">Issue #11771</a>.</p>



<a name="542450021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311771%20WASIp3%20HTTP%3A%20Inconsistent%20errors%20.../near/542450021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html#542450021">(Oct 01 2025 at 09:36)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/11771#issuecomment-3355516360">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11771">issue #11771</a>:</p>
<blockquote>
<p>Related to <a href="https://github.com/WebAssembly/wasi-http/issues/192">https://github.com/WebAssembly/wasi-http/issues/192</a>.</p>
</blockquote>



<a name="542450171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311771%20WASIp3%20HTTP%3A%20Inconsistent%20errors%20.../near/542450171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html#542450171">(Oct 01 2025 at 09:37)</a>:</h4>
<p>wingo edited <a href="https://github.com/bytecodealliance/wasmtime/issues/11771">issue #11771</a>:</p>
<blockquote>
<p>Consider this test for what the HTTP implementation does with invalid field names.  First it tries a field name with a space in it, then it tries <code>"</code>.  Both of these are <a href="https://www.rfc-editor.org/rfc/rfc9110.html#section-5.6.2">invalid</a>, but the first shows an error on <code>fields.delete</code> whereas the second does not:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:http/imports@0.3.0-rc-2025-09-16;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span>
<span class="w">    </span><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">],</span>
<span class="w">    </span><span class="n">features</span><span class="p">:[</span><span class="s">"clocks-timezone"</span><span class="p">],</span>
<span class="w">    </span><span class="n">generate_all</span>
<span class="p">});</span>

<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">Fields</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">HeaderError</span><span class="p">;</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">test_invalid_field_name</span><span class="p">(</span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"testing field: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fields</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="o">!</span><span class="n">fields</span><span class="p">.</span><span class="n">has</span><span class="p">(</span><span class="n">field</span><span class="p">));</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">field</span><span class="p">),</span>
<span class="w">               </span><span class="nb">Err</span><span class="p">(</span><span class="n">HeaderError</span><span class="p">::</span><span class="n">InvalidSyntax</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">test_invalid_field_names</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">test_invalid_field_name</span><span class="p">(</span><span class="s">"field with space"</span><span class="p">);</span>
<span class="w">    </span><span class="n">test_invalid_field_name</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">test_invalid_field_names</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Run it:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Wcomponent</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span><span class="w"> </span><span class="o">-</span><span class="n">Sp3</span><span class="p">,</span><span class="n">http</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">field</span><span class="o">-</span><span class="n">invalid</span><span class="p">.</span><span class="n">wasm</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wingo</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">testsuite</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="p">)</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.35</span><span class="n">s</span>
<span class="n">testing</span><span class="w"> </span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="nc">field</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">space</span>
<span class="n">testing</span><span class="w"> </span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="s">"</span>

<span class="s">thread 'main' (1) panicked at src/bin/field-invalid.rs:23:5:</span>
<span class="s">assertion `left == right` failed</span>
<span class="s">  left: Ok(())</span>
<span class="s"> right: Err(HeaderError::InvalidSyntax)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="542450729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311771%20WASIp3%20HTTP%3A%20Inconsistent%20errors%20.../near/542450729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html#542450729">(Oct 01 2025 at 09:40)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/11771#issuecomment-3355529068">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11771">issue #11771</a>:</p>
<blockquote>
<p>Also related to <a href="https://github.com/WebAssembly/wasi-http/issues/178">https://github.com/WebAssembly/wasi-http/issues/178</a>, could it be that Wasmtime is thinking that <code>"</code> is valid in a field name?</p>
</blockquote>



<a name="542507337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311771%20WASIp3%20HTTP%3A%20Inconsistent%20errors%20.../near/542507337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311771.20WASIp3.20HTTP.3A.20Inconsistent.20errors.20.2E.2E.2E.html#542507337">(Oct 01 2025 at 14:14)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasi:impl label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11771">Issue #11771</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>