<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12385 Using `component-model-async` =&gt; ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html">wasmtime / issue #12385 Using `component-model-async` =&gt; ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="569362428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569362428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569362428">(Jan 21 2026 at 21:44)</a>:</h4>
<p>ignatz edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>For context, I found <a href="https://github.com/bytecodealliance/wasmtime/issues/12154">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>
<p>...anyway, I'm using wasmtime v41.0.0 enabling the  "component-model-async" feature, while still using WASIp2.</p>
<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">rust</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">testfixture</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">trailbase</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">testfixture</span><span class="o">/</span><span class="n">guests</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"wasi:http/incoming-handler@0.2.9#handle"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;431 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"--no-entry"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">componentization</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">decoding</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="nc">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="p">:</span><span class="mf">0.51.0</span><span class="p">:</span><span class="nc">trailbase</span><span class="p">:</span><span class="nc">component</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">:</span><span class="nc">interfaces</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">its</span><span class="o">-</span><span class="n">exports</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span><span class="nc">encoded</span><span class="w"> </span><span class="n">world</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">invalid</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="p">(</span><span class="mh">0x43</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x2a38</span><span class="p">)</span>
</code></pre></div>
<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the guest is not able to load it: "Wasmtime: failed to parse WebAssembly module".</p>
<p>The wasm-wasip3 target seems to be retired? Anyway, which would be the right one? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>
<p>Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569362604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569362604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569362604">(Jan 21 2026 at 21:45)</a>:</h4>
<p>ignatz edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>For context, I found <a href="https://github.com/bytecodealliance/wasmtime/issues/12154">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>
<p>...anyway, I'm using wasmtime v41.0.0 enabling the  "component-model-async" feature, while still using WASIp2.</p>
<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">rust</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">testfixture</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">trailbase</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">testfixture</span><span class="o">/</span><span class="n">guests</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"wasi:http/incoming-handler@0.2.9#handle"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;431 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"--no-entry"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">componentization</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">decoding</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="nc">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="p">:</span><span class="mf">0.51.0</span><span class="p">:</span><span class="nc">trailbase</span><span class="p">:</span><span class="nc">component</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">:</span><span class="nc">interfaces</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">its</span><span class="o">-</span><span class="n">exports</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span><span class="nc">encoded</span><span class="w"> </span><span class="n">world</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">invalid</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="p">(</span><span class="mh">0x43</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x2a38</span><span class="p">)</span>
</code></pre></div>
<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the host is no longer able to load it: "Wasmtime: failed to parse WebAssembly module".</p>
<p>The wasm-wasip3 target seems to be retired? Anyway, which would be the right one? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>
<p>Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569362683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569362683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569362683">(Jan 21 2026 at 21:45)</a>:</h4>
<p>ignatz edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>For context, I found <a href="https://github.com/bytecodealliance/wasmtime/issues/12154">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>
<p>...anyway, I'm using wasmtime v41.0.0 enabling the  "component-model-async" feature, while still using WASIp2.</p>
<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">rust</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">testfixture</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">trailbase</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">testfixture</span><span class="o">/</span><span class="n">guests</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"wasi:http/incoming-handler@0.2.9#handle"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;431 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"--no-entry"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">componentization</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">decoding</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="nc">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="p">:</span><span class="mf">0.51.0</span><span class="p">:</span><span class="nc">trailbase</span><span class="p">:</span><span class="nc">component</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">:</span><span class="nc">interfaces</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">its</span><span class="o">-</span><span class="n">exports</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span><span class="nc">encoded</span><span class="w"> </span><span class="n">world</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">invalid</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="p">(</span><span class="mh">0x43</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x2a38</span><span class="p">)</span>
</code></pre></div>
<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the host is no longer able to load it: "Wasmtime: failed to parse WebAssembly module".</p>
<p>The wasm-wasip3 target seems to be retired? Anyway, which target is the right one yo use? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>
<p>Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569363208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569363208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569363208">(Jan 21 2026 at 21:48)</a>:</h4>
<p>ignatz edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>For context, I found <a href="https://github.com/bytecodealliance/wasmtime/issues/12154">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>
<p>...anyway, I'm using wasmtime v41.0.0 enabling the  "component-model-async" feature, while still using WASIp2.</p>
<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">rust</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">testfixture</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">trailbase</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">testfixture</span><span class="o">/</span><span class="n">guests</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"wasi:http/incoming-handler@0.2.9#handle"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;431 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"--no-entry"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">componentization</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">decoding</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="nc">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="p">:</span><span class="mf">0.51.0</span><span class="p">:</span><span class="nc">trailbase</span><span class="p">:</span><span class="nc">component</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">:</span><span class="nc">interfaces</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">its</span><span class="o">-</span><span class="n">exports</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span><span class="nc">encoded</span><span class="w"> </span><span class="n">world</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">invalid</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="p">(</span><span class="mh">0x43</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x2a38</span><span class="p">)</span>
</code></pre></div>
<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the host is no longer able to load it: "Wasmtime: failed to parse WebAssembly module".</p>
<p>The wasm-wasip3 target seems to be retired? Anyway, which target is the right one to use? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>
<p>Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569366206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569366206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569366206">(Jan 21 2026 at 22:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3781380027">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Thanks for the report! The issue here is that your <code>wasm-component-ld</code> is too old and doesn't understand the things that a modern <code>wit-bindgen</code> is inserting. You can fix that by using beta/nightly Rust for example and waiting for those changes to ride their way to stable.</p>
<blockquote>
<p>The wasm-wasip3 target seems to be retired?</p>
</blockquote>
<p>Oh not retired, just not created yet. The <code>wasm32-wasip3</code> target isn't shipped in rustup at this time.</p>
<blockquote>
<p>Anyway, which target is the right one to use?</p>
</blockquote>
<p><code>wasm32-wasip2</code> is suitable for now</p>
<blockquote>
<p>Am I holding something else wrong?</p>
</blockquote>
<p>Nope! Just a toolling versioning things. You can also update via downloading/compiling/installing <code>wasm-component-ld</code> directly and passing <code>-Clinker=/path/to/your/wasm-component-ld</code></p>
<blockquote>
<p>For example, does component-model-async require me to also switch to WASIp3 in lock-step?</p>
</blockquote>
<p>Note that <code>component-model-async</code> bits and bobs in in-development at this time. It's expected to not yet be a buttery-smooth experience, so hiccups are to be expected.</p>
</blockquote>



<a name="569366210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569366210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569366210">(Jan 21 2026 at 22:07)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>For context, I found <a href="https://github.com/bytecodealliance/wasmtime/issues/12154">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>
<p>...anyway, I'm using wasmtime v41.0.0 enabling the  "component-model-async" feature, while still using WASIp2.</p>
<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">rust</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">testfixture</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">trailbase</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">testfixture</span><span class="o">/</span><span class="n">guests</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"wasi:http/incoming-handler@0.2.9#handle"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;431 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"--no-entry"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">componentization</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">decoding</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="nc">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="p">:</span><span class="mf">0.51.0</span><span class="p">:</span><span class="nc">trailbase</span><span class="p">:</span><span class="nc">component</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">:</span><span class="nc">interfaces</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">its</span><span class="o">-</span><span class="n">exports</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span><span class="nc">encoded</span><span class="w"> </span><span class="n">world</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">invalid</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="p">(</span><span class="mh">0x43</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x2a38</span><span class="p">)</span>
</code></pre></div>
<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the host is no longer able to load it: "Wasmtime: failed to parse WebAssembly module".</p>
<p>The wasm-wasip3 target seems to be retired? Anyway, which target is the right one to use? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>
<p>Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569591486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569591486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569591486">(Jan 22 2026 at 21:26)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3786764711">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Thanks so much for thoughtfully answering all my questions - much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<blockquote>
<p>You can fix that by using beta/nightly Rust for example and waiting for those changes to ride their way to stable.</p>
</blockquote>
<p>I guess, I was 1-day too impatient. Today's release of Rust 1.93, seems to fix the build.</p>
<blockquote>
<p>Note that component-model-async bits and bobs in in-development at this time. It's expected to not yet be a buttery-smooth experience, so hiccups are to be expected.</p>
</blockquote>
<p>Understood and thanks for the heads-up.</p>
<p>After also enabling <code>config.wasm_component_model_async(true);</code>, it seems that winch isn't supported for now <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="569592418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569592418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569592418">(Jan 22 2026 at 21:32)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3786764711">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Thanks so much for thoughtfully answering all my questions - much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<blockquote>
<p>You can fix that by using beta/nightly Rust for example and waiting for those changes to ride their way to stable.</p>
</blockquote>
<p>I guess, I was 1-day too impatient. Today's release of Rust 1.93, seems to fix the build.</p>
<blockquote>
<p>Note that component-model-async bits and bobs in in-development at this time. It's expected to not yet be a buttery-smooth experience, so hiccups are to be expected.</p>
</blockquote>
<p>Understood and thanks for the heads-up.</p>
<p>After also enabling <code>config.wasm_component_model_async(true);</code>, it seems that winch isn't supported for now <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
<p>EDIT: Btw, is there an issue/roadmap I can track to follow the maturation of "component-model-async"?  <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569597038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569597038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569597038">(Jan 22 2026 at 22:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3786985608">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Heh how convenient! For the Winch-unsupported part, what was the error you saw there? I think that may just be a bug that Winch is flagged as not supported component-model-async.</p>
<p>For tracking it's unfortunately spread out over a lot of places given the sheer size and scale of the component-model-async project. The highest-level thing to track would be WASIp3's release, so watching releases on the WASI repository, and when 0.3.0 is released things are "ready for general consumption"</p>
</blockquote>



<a name="569658247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569658247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569658247">(Jan 23 2026 at 08:24)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3789016682">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<blockquote>
<p>For the Winch-unsupported part, what was the error you saw there? I think that may just be a bug that Winch is flagged as not supported component-model-async.</p>
</blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">the</span><span class="w"> </span><span class="n">wasm_cm_async</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">supported</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">configuration</span>

<span class="n">Stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">anyhow</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">::</span><span class="n">string</span><span class="p">::</span><span class="nb">String</span><span class="o">&gt;</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">anyhow</span><span class="o">-</span><span class="mf">1.0.100</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">14</span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">config</span><span class="p">::</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">::</span><span class="n">validate</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">41.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">2412</span><span class="p">:</span><span class="mi">17</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">engine</span><span class="p">::</span><span class="n">Engine</span><span class="o">&gt;</span><span class="p">::</span><span class="n">new</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">41.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">99</span><span class="p">:</span><span class="mi">47</span>
<span class="o">..</span><span class="p">.</span>
</code></pre></div>
<blockquote>
<p>The highest-level thing to track would be WASIp3's release, so watching releases on the WASI repository, and when 0.3.0 is released things are "ready for general consumption"</p>
</blockquote>
<p>Much appreciated and thanks for all the great work <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569731771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569731771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569731771">(Jan 23 2026 at 14:41)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3790554043">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Since I already got your attention <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> (and I'm not sure where else to ask, feel free to tell me off or point me the right way).</p>
<p>I'm now running into:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="n">task</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span>
</code></pre></div>
<p>which comes from here: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a></p>
<p>, which leads me to believe that I'm missing some guest-side setup ceremony? I'm also using <code>wstd</code> to implement async HTTP handlers with WASIp2 pre <code>component-model-async</code>. I couldn't find any info or issues in the <code>wstd</code> repo, which makes me wonder if I'm just holding it wrong or if this could be a sign of wstd not being ready yet for <code>component-model-async</code>?</p>
</blockquote>



<a name="569763980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569763980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569763980">(Jan 23 2026 at 17:02)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3791282027">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Ah right yes that reminded me about the Winch bits. I opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12404">https://github.com/bytecodealliance/wasmtime/issues/12404</a> to track that, but I remember now that it's expected that Winch doesn't support component-model-async.</p>
<p>Do you have a reproduction you can share for the <code>task.is_null()</code> assertion? That's likely from entering on a sync function and trying to block, but I want to confirm. The precise fix will depend on the details I think.</p>
</blockquote>



<a name="569798194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569798194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569798194">(Jan 23 2026 at 20:31)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3792273596">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<blockquote>
<p>Ah right yes that reminded me about the Winch bits. I opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12404">https://github.com/bytecodealliance/wasmtime/issues/12404</a> to track that, but I remember now that it's expected that Winch doesn't support component-model-async.</p>
</blockquote>
<p><span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<blockquote>
<p>Do you have a reproduction you can share for the task.is_null() assertion? That's likely from entering on a sync function and trying to block, but I want to confirm. The precise fix will depend on the details I think.</p>
</blockquote>
<p>I'd like to be mindful of your time, sadly I don't have a very minimal example. My current playground:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/trailbaseio/trailbase.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">trailbase</span>
<span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="k">async</span><span class="o">-</span><span class="n">wasm</span>
<span class="n">cd</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">host</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">capture</span>
</code></pre></div>
<p>What happens in a nutshell:</p>
<ol>
<li>The test calls two WASM incoming HTTP endpoints here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/lib.rs#L582-L596">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/lib.rs#L582-L596</a></li>
<li>They're implemented here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/client/testfixture/guests/rust/src/lib.rs#L62-L118">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/client/testfixture/guests/rust/src/lib.rs#L62-L118</a> via wstd.</li>
<li>The first call to <code>/transaction</code>, which succeeds, calls back into a a few synchronous sqlite host endpoint, e.g. here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L196">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L196</a></li>
<li>Whereas the call to <code>/addDeletePost</code>, which causes the failure, calls back into the host's async WASI outgoing HTTP endpoint implemented here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L121-L135">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L121-L135</a></li>
</ol>
<p>I left some good 'ol prints in the code to make the flow more clear:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">test</span>
<span class="n">calling</span><span class="w"> </span><span class="o">/</span><span class="n">transaction</span>
<span class="o">/</span><span class="n">transaction</span><span class="w"> </span><span class="n">called</span>

<span class="n">calling</span><span class="w"> </span><span class="o">/</span><span class="n">addDeletePost</span>
<span class="o">/</span><span class="n">addDeletePost</span><span class="w"> </span><span class="n">called</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="o">-</span><span class="mf">0.51.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">async_support</span><span class="o">/</span><span class="n">waitable</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">193</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="n">task</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="569798314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569798314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569798314">(Jan 23 2026 at 20:31)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3792273596">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<blockquote>
<p>Ah right yes that reminded me about the Winch bits. I opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12404">https://github.com/bytecodealliance/wasmtime/issues/12404</a> to track that, but I remember now that it's expected that Winch doesn't support component-model-async.</p>
</blockquote>
<p><span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<blockquote>
<p>Do you have a reproduction you can share for the task.is_null() assertion? That's likely from entering on a sync function and trying to block, but I want to confirm. The precise fix will depend on the details I think.</p>
</blockquote>
<p>I'd like to be mindful of your time, sadly I don't have a very minimal example. My current playground:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/trailbaseio/trailbase.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">trailbase</span>
<span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="k">async</span><span class="o">-</span><span class="n">wasm</span>
<span class="n">cd</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">host</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">capture</span>
</code></pre></div>
<p>What happens in a nutshell:</p>
<ol>
<li>The test calls two WASM incoming HTTP endpoints here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/lib.rs#L582-L596">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/lib.rs#L582-L596</a></li>
<li>They're implemented here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/client/testfixture/guests/rust/src/lib.rs#L62-L118">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/client/testfixture/guests/rust/src/lib.rs#L62-L118</a> via wstd.</li>
<li>The first call to <code>/transaction</code>, which succeeds, calls back into a a few synchronous sqlite host endpoint, e.g. here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L196">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L196</a></li>
<li>Whereas the call to <code>/addDeletePost</code>, which causes the failure, calls back into the host's async WASI outgoing HTTP endpoint implemented here: <a href="https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L121-L135">https://github.com/trailbaseio/trailbase/blob/31a568ee296376cf62c9d666556aaae40de0149e/crates/wasm-runtime-host/src/host.rs#L121-L135</a></li>
</ol>
<p>I left some good 'ol prints in the code to make the flow more clear:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">test</span>
<span class="n">calling</span><span class="w"> </span><span class="o">/</span><span class="n">transaction</span>
<span class="o">/</span><span class="n">transaction</span><span class="w"> </span><span class="n">called</span>

<span class="n">calling</span><span class="w"> </span><span class="o">/</span><span class="n">addDeletePost</span>
<span class="o">/</span><span class="n">addDeletePost</span><span class="w"> </span><span class="n">called</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="o">-</span><span class="mf">0.51.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">async_support</span><span class="o">/</span><span class="n">waitable</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">193</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="n">task</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>This arguably miles from a minimal example. If you don't have a hunch, I'm happy to break this down further. Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="569806003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569806003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569806003">(Jan 23 2026 at 21:30)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3792548249">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Ok thanks for the pointers. I think what's happening here is that you're using a sync-typed entrypoint (e.g. WASIp2-style) and then invoking some sort of blocking behavior within the guest (e.g. using <code>wstd</code> as an event loop) which is interacting with WASIp3-style-APIs. (correct me if that's wrong though)</p>
<p>If that's the case then the panic you're running into here is that the async bits of <code>wit-bindgen</code> weren't setup during the entrypoint (due to it being sync-style). Even if that were fixed, however, sync-typed functions cannot block, so Wasmtime-the-runtime would still prevent you from calling the blocking function with a trap. </p>
<p>If my description is accurate (enough) then the easiest fix will be to update the wasm entrypoints in WIT to be <code>async</code>-typed. That can be configured as either sync or async at the guest level, but that'll engage the mechanisms in the various places to get it working (I think at least)</p>
</blockquote>



<a name="569809843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569809843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569809843">(Jan 23 2026 at 22:05)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3792747530">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<blockquote>
<p>... then invoking some sort of blocking behavior within the guest (e.g. using <code>wstd</code> as an event loop) which is interacting with WASIp3-style-APIs. (correct me if that's wrong though)</p>
</blockquote>
<p>Yes, wstd is being used to drive the async event loop. It's interacting with WASIp2-style APIs. I think that's what you meant?</p>
<blockquote>
<p>If that's the case then the panic you're running into here is that the async bits of <code>wit-bindgen</code> weren't setup during the entrypoint (due to it being sync-style). Even if that were fixed, however, sync-typed functions cannot block, so Wasmtime-the-runtime would still prevent you from calling the blocking function with a trap.</p>
</blockquote>
<p>I'm not sure i got the sync-typed functions cannot block part right. Do you mean that they have to eventually return for the runtime to make progress... And in this case an event-loop is driven indefinitely because it's waiting for the completion of the outgoing http call, which itself cannot make progress because the og entry hasn't returned yet? </p>
<blockquote>
<p>If my description is accurate (enough) then the easiest fix will be to update the wasm entrypoints in WIT to be <code>async</code>-typed. That can be configured as either sync or async at the guest level, but that'll engage the mechanisms in the various places to get it working (I think at least)</p>
</blockquote>
<p>Since we're talking WASI, this basically means p2 =&gt; p3 and the respective changes to wstd (eg fork)?</p>
<p>Much appreciated</p>
</blockquote>



<a name="569809933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569809933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569809933">(Jan 23 2026 at 22:06)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3792747530">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<blockquote>
<p>... then invoking some sort of blocking behavior within the guest (e.g. using <code>wstd</code> as an event loop) which is interacting with WASIp3-style-APIs. (correct me if that's wrong though)</p>
</blockquote>
<p>Yes, wstd is being used to drive the async event loop. It's interacting with WASIp2-style APIs. I think that's what you meant?</p>
<blockquote>
<p>If that's the case then the panic you're running into here is that the async bits of <code>wit-bindgen</code> weren't setup during the entrypoint (due to it being sync-style). Even if that were fixed, however, sync-typed functions cannot block, so Wasmtime-the-runtime would still prevent you from calling the blocking function with a trap.</p>
</blockquote>
<p>I'm not sure i got the sync-typed functions cannot block part right. Do you mean that they have to eventually return for the runtime to make progress... And in this case an event-loop is driven indefinitely because it's waiting for the completion of the outgoing http call, which itself cannot make progress because the og entry hasn't returned yet? </p>
<blockquote>
<p>If my description is accurate (enough) then the easiest fix will be to update the wasm entrypoints in WIT to be <code>async</code>-typed. That can be configured as either sync or async at the guest level, but that'll engage the mechanisms in the various places to get it working (I think at least)</p>
</blockquote>
<p>Since we're talking WASI, this basically means p2 =&gt; p3 and the respective changes to wstd (ie fork)?</p>
<p>Much appreciated</p>
</blockquote>



<a name="569823621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/569823621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#569823621">(Jan 24 2026 at 00:40)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3793227995">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Hm ok I may be confusing myself then... My suspicion is that something component-model-async related is getting mixed in with WASIp2-looking things and that's what's causing the issue. What exactly the issue is though depends on further digging in on those details.</p>
<p>Perhaps opening an issue on wstd and going from there with discussion would be best?</p>
</blockquote>



<a name="570120727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570120727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570120727">(Jan 26 2026 at 15:22)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3800158427">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>That makes sense and thanks again for your help <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<p>The good or bad news (depending on one's perspective), thus far I've failed to reproduce the issue in a minimal example I was prepping for wstd: <a href="https://github.com/ignatz/wstd_poc">https://github.com/ignatz/wstd_poc</a> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> </p>
</blockquote>



<a name="570290916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570290916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570290916">(Jan 27 2026 at 11:05)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3804530930">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Ok, I was finally able to reproduce my issue and boil it down. I'll happily file an issue with wstd, though I somewhat expect the answer to be understandibly component-model-async is experimental :)</p>
<p>Let me still summarize my minimal example here, maybe you're interested and after all your effort, at very least I owe it to you <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<p>The example host is: <a href="https://github.com/ignatz/wstd_poc/blob/main/src/main.rs">https://github.com/ignatz/wstd_poc/blob/main/src/main.rs</a>, and the guest is: <a href="https://github.com/ignatz/wstd_poc/blob/main/src/main.rs">https://github.com/ignatz/wstd_poc/blob/main/src/main.rs</a></p>
<p>The Host implements <a href="https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/src/main.rs#L104">this very simple async function</a>:, which basically just calls <code>tokio::time::sleep</code>, and thus presumably yields execution back to the guest.</p>
<p>Calling this function from a custom async interface exported by the guest works as expected: <a href="https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/guest/0_6_5/src/lib.rs#L33">https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/guest/0_6_5/src/lib.rs#L33</a>.</p>
<p>Calling the very same function from an wstd/WASI http handler: <a href="https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs#L71">https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs#L71</a> produces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
<span class="n">Loaded</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">guest</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="k">in</span><span class="p">:</span><span class="w"> </span><span class="mf">865.548553</span><span class="n">ms</span><span class="p">.</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">Guest</span><span class="p">::</span><span class="n">test_async</span>
<span class="n">BEFORE</span>
<span class="n">AFTER</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="o">/</span><span class="n">call_host_test_async</span>
<span class="n">BEFORE</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="o">-</span><span class="mf">0.51.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">async_support</span><span class="o">/</span><span class="n">waitable</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">193</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="n">task</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="nc">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w">  </span><span class="mh">0x44898</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">abort</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w">  </span><span class="mh">0x36d4a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">sys</span><span class="p">::</span><span class="n">pal</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">helpers</span><span class="p">::</span><span class="n">abort_internal</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="mh">0x3416b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">process</span><span class="p">::</span><span class="n">abort</span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w">  </span><span class="mh">0x349c4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">__rust_abort</span>
<span class="w">    </span><span class="mi">4</span><span class="p">:</span><span class="w">  </span><span class="mh">0x32d93</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">__rust_start_panic</span>
<span class="w">    </span><span class="mi">5</span><span class="p">:</span><span class="w">  </span><span class="mh">0x347f1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">rust_panic</span>
<span class="w">    </span><span class="mi">6</span><span class="p">:</span><span class="w">  </span><span class="mh">0x339d6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_with_hook</span>
<span class="w">    </span><span class="mi">7</span><span class="p">:</span><span class="w">  </span><span class="mh">0x335a8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_handler</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span>
<span class="w">    </span><span class="mi">8</span><span class="p">:</span><span class="w">  </span><span class="mh">0x3353b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">__rust_end_short_backtrace</span><span class="p">::</span><span class="o">&lt;</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_handler</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="o">!&gt;</span>
<span class="w">    </span><span class="mi">9</span><span class="p">:</span><span class="w">  </span><span class="mh">0x34aa7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">rust_begin_unwind</span>
<span class="w">   </span><span class="mi">10</span><span class="p">:</span><span class="w">  </span><span class="mh">0x4659b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span>
<span class="w">   </span><span class="mi">11</span><span class="p">:</span><span class="w">  </span><span class="mh">0x463e8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic</span>
<span class="w">   </span><span class="mi">12</span><span class="p">:</span><span class="w">  </span><span class="mh">0x13957</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">waitable</span><span class="p">::</span><span class="n">WaitableOperation</span><span class="o">&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">subtask</span><span class="p">::</span><span class="n">SubtaskOps</span><span class="o">&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12b</span>
<span class="n">dea0a458ea</span><span class="p">]::</span><span class="n">wit</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="p">::</span><span class="n">import_endpoint</span><span class="p">::</span><span class="n">test_async</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}::</span><span class="n">_MySubtask</span><span class="o">&gt;&gt;&gt;</span><span class="p">::</span><span class="n">poll_complete_with_code</span>
<span class="w">   </span><span class="mi">13</span><span class="p">:</span><span class="w">  </span><span class="mh">0x13fbb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">waitable</span><span class="p">::</span><span class="n">WaitableOperation</span><span class="o">&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">subtask</span><span class="p">::</span><span class="n">SubtaskOps</span><span class="o">&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12b</span>
<span class="n">dea0a458ea</span><span class="p">]::</span><span class="n">wit</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="p">::</span><span class="n">import_endpoint</span><span class="p">::</span><span class="n">test_async</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}::</span><span class="n">_MySubtask</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">future</span><span class="p">::</span><span class="n">future</span><span class="p">::</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">::</span><span class="n">poll</span>
<span class="w">   </span><span class="mi">14</span><span class="p">:</span><span class="w">   </span><span class="mh">0x82c9</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">pin</span><span class="p">::</span><span class="n">Pin</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">[</span><span class="n">f027c216b6466811</span><span class="p">]::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span>
<span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">future</span><span class="p">::</span><span class="n">future</span><span class="p">::</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">::</span><span class="n">poll</span>
<span class="w">   </span><span class="mi">15</span><span class="p">:</span><span class="w">   </span><span class="mh">0x4e8e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">async_task</span><span class="p">[</span><span class="n">d918d7eff4be4786</span><span class="p">]::</span><span class="n">raw</span><span class="p">::</span><span class="n">RawTask</span><span class="o">&lt;</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">pin</span><span class="p">::</span><span class="n">Pin</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">[</span><span class="n">f027c216b6466811</span><span class="p">]::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mi">92</span>
<span class="n">e2552df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wstd</span><span class="p">[</span><span class="mi">785</span><span class="n">ced64e3c98805</span><span class="p">]::</span><span class="n">runtime</span><span class="p">::</span><span class="n">reactor</span><span class="p">::</span><span class="n">Reactor</span><span class="o">&gt;</span><span class="p">::</span><span class="n">spawn_unchecked</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]</span>
<span class="p">::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">run</span>
<span class="w">   </span><span class="mi">16</span><span class="p">:</span><span class="w">  </span><span class="mh">0x167f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span>
<span class="w">   </span><span class="mi">17</span><span class="p">:</span><span class="w">  </span><span class="mh">0x16af0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">incoming</span><span class="o">-</span><span class="n">handler</span><span class="o">@</span><span class="mf">0.2.9</span><span class="p">#</span><span class="n">handle</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Repro is simply:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/ignatz/wstd_poc.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">wstd_poc</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<p><span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570291079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570291079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570291079">(Jan 27 2026 at 11:06)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3804530930">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Ok, I was finally able to reproduce my issue and boil it down. I'll happily file an issue with wstd, though I somewhat expect the answer to be understandibly component-model-async is experimental :)</p>
<p>Let me still summarize my minimal example here, maybe you're interested and after all your effort, at very least I owe it to you <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<p>The example host is: <a href="https://github.com/ignatz/wstd_poc/blob/main/src/main.rs">https://github.com/ignatz/wstd_poc/blob/main/src/main.rs</a>, and the guest is: <a href="https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs">https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs</a></p>
<p>The Host implements <a href="https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/src/main.rs#L104">this very simple async function</a>:, which basically just calls <code>tokio::time::sleep</code>, and thus presumably yields execution back to the guest.</p>
<p>Calling this function from a custom async interface exported by the guest works as expected: <a href="https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/guest/0_6_5/src/lib.rs#L33">https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/guest/0_6_5/src/lib.rs#L33</a>.</p>
<p>Calling the very same function from an wstd/WASI http handler: <a href="https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs#L71">https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs#L71</a> produces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
<span class="n">Loaded</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">guest</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="k">in</span><span class="p">:</span><span class="w"> </span><span class="mf">865.548553</span><span class="n">ms</span><span class="p">.</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">Guest</span><span class="p">::</span><span class="n">test_async</span>
<span class="n">BEFORE</span>
<span class="n">AFTER</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="o">/</span><span class="n">call_host_test_async</span>
<span class="n">BEFORE</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="o">-</span><span class="mf">0.51.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">async_support</span><span class="o">/</span><span class="n">waitable</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">193</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="n">task</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="nc">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w">  </span><span class="mh">0x44898</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">abort</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w">  </span><span class="mh">0x36d4a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">sys</span><span class="p">::</span><span class="n">pal</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">helpers</span><span class="p">::</span><span class="n">abort_internal</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="mh">0x3416b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">process</span><span class="p">::</span><span class="n">abort</span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w">  </span><span class="mh">0x349c4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">__rust_abort</span>
<span class="w">    </span><span class="mi">4</span><span class="p">:</span><span class="w">  </span><span class="mh">0x32d93</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">__rust_start_panic</span>
<span class="w">    </span><span class="mi">5</span><span class="p">:</span><span class="w">  </span><span class="mh">0x347f1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">rust_panic</span>
<span class="w">    </span><span class="mi">6</span><span class="p">:</span><span class="w">  </span><span class="mh">0x339d6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_with_hook</span>
<span class="w">    </span><span class="mi">7</span><span class="p">:</span><span class="w">  </span><span class="mh">0x335a8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_handler</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span>
<span class="w">    </span><span class="mi">8</span><span class="p">:</span><span class="w">  </span><span class="mh">0x3353b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">__rust_end_short_backtrace</span><span class="p">::</span><span class="o">&lt;</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_handler</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="o">!&gt;</span>
<span class="w">    </span><span class="mi">9</span><span class="p">:</span><span class="w">  </span><span class="mh">0x34aa7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">rust_begin_unwind</span>
<span class="w">   </span><span class="mi">10</span><span class="p">:</span><span class="w">  </span><span class="mh">0x4659b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span>
<span class="w">   </span><span class="mi">11</span><span class="p">:</span><span class="w">  </span><span class="mh">0x463e8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic</span>
<span class="w">   </span><span class="mi">12</span><span class="p">:</span><span class="w">  </span><span class="mh">0x13957</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">waitable</span><span class="p">::</span><span class="n">WaitableOperation</span><span class="o">&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">subtask</span><span class="p">::</span><span class="n">SubtaskOps</span><span class="o">&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12b</span>
<span class="n">dea0a458ea</span><span class="p">]::</span><span class="n">wit</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="p">::</span><span class="n">import_endpoint</span><span class="p">::</span><span class="n">test_async</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}::</span><span class="n">_MySubtask</span><span class="o">&gt;&gt;&gt;</span><span class="p">::</span><span class="n">poll_complete_with_code</span>
<span class="w">   </span><span class="mi">13</span><span class="p">:</span><span class="w">  </span><span class="mh">0x13fbb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">waitable</span><span class="p">::</span><span class="n">WaitableOperation</span><span class="o">&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">subtask</span><span class="p">::</span><span class="n">SubtaskOps</span><span class="o">&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12b</span>
<span class="n">dea0a458ea</span><span class="p">]::</span><span class="n">wit</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="p">::</span><span class="n">import_endpoint</span><span class="p">::</span><span class="n">test_async</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}::</span><span class="n">_MySubtask</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">future</span><span class="p">::</span><span class="n">future</span><span class="p">::</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">::</span><span class="n">poll</span>
<span class="w">   </span><span class="mi">14</span><span class="p">:</span><span class="w">   </span><span class="mh">0x82c9</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">pin</span><span class="p">::</span><span class="n">Pin</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">[</span><span class="n">f027c216b6466811</span><span class="p">]::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span>
<span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">future</span><span class="p">::</span><span class="n">future</span><span class="p">::</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">::</span><span class="n">poll</span>
<span class="w">   </span><span class="mi">15</span><span class="p">:</span><span class="w">   </span><span class="mh">0x4e8e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">async_task</span><span class="p">[</span><span class="n">d918d7eff4be4786</span><span class="p">]::</span><span class="n">raw</span><span class="p">::</span><span class="n">RawTask</span><span class="o">&lt;</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">pin</span><span class="p">::</span><span class="n">Pin</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">[</span><span class="n">f027c216b6466811</span><span class="p">]::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mi">92</span>
<span class="n">e2552df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wstd</span><span class="p">[</span><span class="mi">785</span><span class="n">ced64e3c98805</span><span class="p">]::</span><span class="n">runtime</span><span class="p">::</span><span class="n">reactor</span><span class="p">::</span><span class="n">Reactor</span><span class="o">&gt;</span><span class="p">::</span><span class="n">spawn_unchecked</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]</span>
<span class="p">::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">run</span>
<span class="w">   </span><span class="mi">16</span><span class="p">:</span><span class="w">  </span><span class="mh">0x167f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span>
<span class="w">   </span><span class="mi">17</span><span class="p">:</span><span class="w">  </span><span class="mh">0x16af0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">incoming</span><span class="o">-</span><span class="n">handler</span><span class="o">@</span><span class="mf">0.2.9</span><span class="p">#</span><span class="n">handle</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Repro is simply:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/ignatz/wstd_poc.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">wstd_poc</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<p><span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570296807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570296807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570296807">(Jan 27 2026 at 11:36)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3804530930">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Ok, I was finally able to reproduce my issue and boil it down. I'll happily file an issue with wstd, though I somewhat expect the answer to be understandibly component-model-async is experimental :)</p>
<p>Let me still summarize my minimal example here, maybe you're interested and after all your effort, at very least I owe it to you <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
<p>The example host is: <a href="https://github.com/ignatz/wstd_poc/blob/main/src/main.rs">https://github.com/ignatz/wstd_poc/blob/main/src/main.rs</a>, and the guest is: <a href="https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs">https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs</a></p>
<p>The Host implements <a href="https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/src/main.rs#L104">this very simple async function</a>:, which basically just calls <code>tokio::time::sleep</code>, and thus presumably yields execution back to the guest.</p>
<p>Calling this function from a custom async interface exported by the guest works as expected: <a href="https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/guest/0_6_5/src/lib.rs#L33">https://github.com/ignatz/wstd_poc/blob/1affbcea3925f1e5ac34db137a4f5c71e6046dfc/guest/0_6_5/src/lib.rs#L33</a>.</p>
<p>Calling the very same function from an wstd/WASI http handler: <a href="https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs#L71">https://github.com/ignatz/wstd_poc/blob/main/guest/0_6_5/src/lib.rs#L71</a> produces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
<span class="n">Loaded</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">guest</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="k">in</span><span class="p">:</span><span class="w"> </span><span class="mf">865.548553</span><span class="n">ms</span><span class="p">.</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">Guest</span><span class="p">::</span><span class="n">test_async</span>
<span class="n">BEFORE</span>
<span class="n">AFTER</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="o">/</span><span class="n">call_host_test_async</span>
<span class="n">BEFORE</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="o">-</span><span class="mf">0.51.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">async_support</span><span class="o">/</span><span class="n">waitable</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">193</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="n">task</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="nc">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w">  </span><span class="mh">0x44898</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">abort</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w">  </span><span class="mh">0x36d4a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">sys</span><span class="p">::</span><span class="n">pal</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">helpers</span><span class="p">::</span><span class="n">abort_internal</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="mh">0x3416b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">process</span><span class="p">::</span><span class="n">abort</span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w">  </span><span class="mh">0x349c4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">__rust_abort</span>
<span class="w">    </span><span class="mi">4</span><span class="p">:</span><span class="w">  </span><span class="mh">0x32d93</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">__rust_start_panic</span>
<span class="w">    </span><span class="mi">5</span><span class="p">:</span><span class="w">  </span><span class="mh">0x347f1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">rust_panic</span>
<span class="w">    </span><span class="mi">6</span><span class="p">:</span><span class="w">  </span><span class="mh">0x339d6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_with_hook</span>
<span class="w">    </span><span class="mi">7</span><span class="p">:</span><span class="w">  </span><span class="mh">0x335a8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_handler</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span>
<span class="w">    </span><span class="mi">8</span><span class="p">:</span><span class="w">  </span><span class="mh">0x3353b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">__rust_end_short_backtrace</span><span class="p">::</span><span class="o">&lt;</span><span class="n">std</span><span class="p">[</span><span class="mi">6</span><span class="n">d04a7abd255923a</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_handler</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="o">!&gt;</span>
<span class="w">    </span><span class="mi">9</span><span class="p">:</span><span class="w">  </span><span class="mh">0x34aa7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rustc</span><span class="p">[</span><span class="mi">4</span><span class="n">aa0cf85fea6adf3</span><span class="p">]::</span><span class="n">rust_begin_unwind</span>
<span class="w">   </span><span class="mi">10</span><span class="p">:</span><span class="w">  </span><span class="mh">0x4659b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span>
<span class="w">   </span><span class="mi">11</span><span class="p">:</span><span class="w">  </span><span class="mh">0x463e8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic</span>
<span class="w">   </span><span class="mi">12</span><span class="p">:</span><span class="w">  </span><span class="mh">0x13957</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">waitable</span><span class="p">::</span><span class="n">WaitableOperation</span><span class="o">&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">subtask</span><span class="p">::</span><span class="n">SubtaskOps</span><span class="o">&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12b</span>
<span class="n">dea0a458ea</span><span class="p">]::</span><span class="n">wit</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="p">::</span><span class="n">import_endpoint</span><span class="p">::</span><span class="n">test_async</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}::</span><span class="n">_MySubtask</span><span class="o">&gt;&gt;&gt;</span><span class="p">::</span><span class="n">poll_complete_with_code</span>
<span class="w">   </span><span class="mi">13</span><span class="p">:</span><span class="w">  </span><span class="mh">0x13fbb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">waitable</span><span class="p">::</span><span class="n">WaitableOperation</span><span class="o">&lt;</span><span class="n">wit_bindgen</span><span class="p">[</span><span class="mi">6</span><span class="n">bf57be79aa08007</span><span class="p">]::</span><span class="n">rt</span><span class="p">::</span><span class="n">async_support</span><span class="p">::</span><span class="n">subtask</span><span class="p">::</span><span class="n">SubtaskOps</span><span class="o">&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12b</span>
<span class="n">dea0a458ea</span><span class="p">]::</span><span class="n">wit</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="p">::</span><span class="n">import_endpoint</span><span class="p">::</span><span class="n">test_async</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}::</span><span class="n">_MySubtask</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">future</span><span class="p">::</span><span class="n">future</span><span class="p">::</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">::</span><span class="n">poll</span>
<span class="w">   </span><span class="mi">14</span><span class="p">:</span><span class="w">   </span><span class="mh">0x82c9</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">pin</span><span class="p">::</span><span class="n">Pin</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">[</span><span class="n">f027c216b6466811</span><span class="p">]::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span>
<span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">future</span><span class="p">::</span><span class="n">future</span><span class="p">::</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">::</span><span class="n">poll</span>
<span class="w">   </span><span class="mi">15</span><span class="p">:</span><span class="w">   </span><span class="mh">0x4e8e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">async_task</span><span class="p">[</span><span class="n">d918d7eff4be4786</span><span class="p">]::</span><span class="n">raw</span><span class="p">::</span><span class="n">RawTask</span><span class="o">&lt;</span><span class="n">core</span><span class="p">[</span><span class="mi">3471</span><span class="n">d1c487ddc13e</span><span class="p">]::</span><span class="n">pin</span><span class="p">::</span><span class="n">Pin</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">[</span><span class="n">f027c216b6466811</span><span class="p">]::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mi">92</span>
<span class="n">e2552df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wstd</span><span class="p">[</span><span class="mi">785</span><span class="n">ced64e3c98805</span><span class="p">]::</span><span class="n">runtime</span><span class="p">::</span><span class="n">reactor</span><span class="p">::</span><span class="n">Reactor</span><span class="o">&gt;</span><span class="p">::</span><span class="n">spawn_unchecked</span><span class="o">&lt;&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]</span>
<span class="p">::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">run</span>
<span class="w">   </span><span class="mi">16</span><span class="p">:</span><span class="w">  </span><span class="mh">0x167f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">v0_6_5</span><span class="p">[</span><span class="mi">6</span><span class="n">ab12bdea0a458ea</span><span class="p">]::</span><span class="n">TheServer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasip2</span><span class="p">[</span><span class="mf">92e2552</span><span class="n">df41e27b4</span><span class="p">]::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span>
<span class="w">   </span><span class="mi">17</span><span class="p">:</span><span class="w">  </span><span class="mh">0x16af0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v0_6_5</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">incoming</span><span class="o">-</span><span class="n">handler</span><span class="o">@</span><span class="mf">0.2.9</span><span class="p">#</span><span class="n">handle</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Repro is simply:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/ignatz/wstd_poc.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">wstd_poc</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<p>HYPOTHESIS: I'm inclined to think, that this is related to how asynchronicity is handled with p2, where <code>incoming-handler::handle</code> synchronously returns a <code>response-outparam</code> resource, which then handles the asynchronicity independent from the original call.</p>
<p><span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570327528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570327528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570327528">(Jan 27 2026 at 13:59)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805369520">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>(wstd maintainer here) that's not going to be a wstd bug, thats mixing up the p2 way of doing Rust async on top of synchronous component model functions, and using the p3 way of doing async at the component model level with a different method to adapt that to work with Rust async. Unfortunately, you can't mix and match the two. When p3 stabilizes we will make wstd behave the correct way when used on the <code>wasm32-wasip3</code> target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>



<a name="570330747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570330747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570330747">(Jan 27 2026 at 14:11)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805448230">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>@pchickey thanks for chiming in. Apologies, I never wanted to argue that it's a bug, that's what I tried to say with</p>
<blockquote>
<p>I'll happily file an issue with wstd, though I somewhat expect the answer to be <strong>understandibly</strong> component-model-async is experimentalWhen p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>You're confirming my suspicion that WASIp2 and <code>component-model-async</code> don't play well together<span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>That makes sense. Off topic but naively I would have hoped that the async component model will make wstd somewhat easier (which clearly doesn't mean that the migration itself wouldn't be a ton of work in itself).</p>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make <code>component-model-async</code> work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span> </p>
<p>Anyway, thanks y'all <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570330842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570330842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570330842">(Jan 27 2026 at 14:12)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805448230">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>@pchickey thanks for chiming in. Apologies, I never wanted to argue that it's a bug, that's what I tried to say with</p>
<blockquote>
<p>I'll happily file an issue with wstd, though I somewhat expect the answer to be <strong>understandibly</strong> component-model-async is experimental</p>
</blockquote>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>You're confirming my suspicion that WASIp2 and <code>component-model-async</code> don't play well together<span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>That makes sense. Off topic but naively I would have hoped that the async component model will make wstd somewhat easier (which clearly doesn't mean that the migration itself wouldn't be a ton of work in itself).</p>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make <code>component-model-async</code> work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span> </p>
<p>Anyway, thanks y'all <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570330919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570330919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570330919">(Jan 27 2026 at 14:12)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805448230">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>@pchickey thanks for chiming in. Apologies, I never wanted to argue that it's a bug, that's what I tried to say with</p>
<blockquote>
<p>I'll happily file an issue with wstd, though I somewhat expect the answer to be <strong>understandibly</strong> component-model-async is experimental</p>
</blockquote>
<blockquote>
<p>...When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>You're confirming my suspicion that WASIp2 and <code>component-model-async</code> don't play well together<span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>That makes sense. Off topic but naively I would have hoped that the async component model will make wstd somewhat easier (which clearly doesn't mean that the migration itself wouldn't be a ton of work in itself).</p>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make <code>component-model-async</code> work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span> </p>
<p>Anyway, thanks y'all <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570331054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570331054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570331054">(Jan 27 2026 at 14:13)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805448230">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>@pchickey thanks for chiming in. Apologies, I never wanted to argue that it's a bug, that's what I tried to say with</p>
<blockquote>
<p>I'll happily file an issue with wstd, though I somewhat expect the answer to be <strong>understandibly</strong> component-model-async is experimental</p>
</blockquote>
<blockquote>
<p>...When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>You're confirming my suspicion that WASIp2 and <code>component-model-async</code> don't play well together<span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>That makes sense. Off topic and naively, I would have hoped that the async component model will make wstd somewhat easier (which clearly doesn't mean that the migration itself wouldn't be a ton of work in itself).</p>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make <code>component-model-async</code> work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span> </p>
<p>Anyway, thanks y'all <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570331393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570331393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570331393">(Jan 27 2026 at 14:14)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805448230">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>@pchickey thanks for chiming in. Apologies, I never wanted to argue that it's a bug, that's what I tried to say with</p>
<blockquote>
<p>I'll happily file an issue with wstd, though I somewhat expect the answer to be <strong>understandibly</strong> component-model-async is experimental</p>
</blockquote>
<blockquote>
<p>...When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>You're confirming my suspicion that WASIp2 and <code>component-model-async</code> don't play well together<span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>That makes sense. Off topic and naively, I would have hoped that the async component model will make wstd somewhat easier (which clearly doesn't mean that the migration itself wouldn't be a ton of work in itself).</p>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make <code>component-model-async</code> work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> . E.g. could it be kept alive for functions like <code>incoming-handler::handler</code>? <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span></p>
<p>Anyway, thanks y'all <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570331575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570331575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570331575">(Jan 27 2026 at 14:15)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3805448230">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>@pchickey thanks for chiming in. Apologies, I never wanted to argue that it's a bug, that's what I tried to say with</p>
<blockquote>
<p>I'll happily file an issue with wstd, though I somewhat expect the answer to be <strong>understandibly</strong> component-model-async is experimental</p>
</blockquote>
<blockquote>
<p>...When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>You're confirming my suspicion that WASIp2 and <code>component-model-async</code> don't play well together<span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span></p>
<blockquote>
<p>When p3 stabilizes we will make wstd behave the correct way when used on the wasm32-wasip3 target but in the meantime there is a ton of work on wstd itself needed to make it work on top of async component model.</p>
</blockquote>
<p>That makes sense. Off topic and naively, I would have hoped that the async component model will make wstd somewhat easier (which clearly doesn't mean that the migration itself wouldn't be a ton of work in itself).</p>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make <code>component-model-async</code> work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> . E.g. could the "task" be kept alive for functions like <code>incoming-handler::handler</code>? <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span></p>
<p>Anyway, thanks y'all <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570497094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570497094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570497094">(Jan 28 2026 at 08:34)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3809794384">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Just a last and final thought:</p>
<blockquote>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make component-model-async work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> . E.g. could the "task" be kept alive for functions like incoming-handler::handler? <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span></p>
</blockquote>
<p>Not sure how common practice it is, but if WASI users have followed the same pattern for asynchronicity pre <code>component-model-async</code>, there may be a desire enable this pattern in terms of forward-compatibility and migration story <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span> </p>
<p>Thanks again <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="570497186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/570497186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#570497186">(Jan 28 2026 at 08:35)</a>:</h4>
<p>ignatz edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3809794384">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Just a last and final thought:</p>
<blockquote>
<p>I'm not sure it's worth it, especially being interim, but I do wonder if there's something that could be done to make component-model-async work with WASIp2, e.g. how the "task sets" are handled: <a href="https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193">https://github.com/bytecodealliance/wit-bindgen/blob/350e8ad7abe8f65357c8984535d7bca5b9882c2c/crates/guest-rust/src/rt/async_support/waitable.rs#L193</a> . E.g. could the "task" be kept alive for functions like incoming-handler::handler? <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span></p>
</blockquote>
<p>Not sure how common practice it is, but if WASI users have followed the same pattern for asynchronicity for their own interfaces pre <code>component-model-async</code>, there may be a desire enable this pattern in terms of forward-compatibility and migration story <span aria-label="woman shrugging" class="emoji emoji-1f937-200d-2640" role="img" title="woman shrugging">:woman_shrugging:</span> </p>
<p>Thanks again <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<a name="571048754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/571048754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#571048754">(Jan 30 2026 at 14:48)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3824146057">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>There are some limited things that can be done to make the migration from wasip2 to wasip3 a bit smoother, but we'll more-or-less need to fully figure out those plans over time. These sorts of migrations tend to have lots of gotchas and corners that are really difficult to prepare for and predict ahead-of-time. For now I'd recommend being all-in on either wasip2 or wasip3, and then we'll be working on smoothing out the transition over time.</p>
</blockquote>



<a name="571226623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%60component-model-async%60%20%3D%3E%20.../near/571226623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.60component-model-async.60.20.3D.3E.20.2E.2E.2E.html#571226623">(Jan 31 2026 at 20:00)</a>:</h4>
<p>ignatz <a href="https://github.com/bytecodealliance/wasmtime/issues/12385#issuecomment-3829228808">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>Sure thing, makes sense. Depending on wstd, this means I'll have to stick with p2 for now (I was mostly just secretly hoping to already start adding new async APIs). I assume the bindings generates for other languages will have similar challenges.</p>
<p>Thanks again</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>