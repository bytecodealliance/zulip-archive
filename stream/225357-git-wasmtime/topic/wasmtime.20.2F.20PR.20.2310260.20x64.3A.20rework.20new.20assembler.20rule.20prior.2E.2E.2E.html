<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10260 x64: rework new assembler rule prior... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html">wasmtime / PR #10260 x64: rework new assembler rule prior...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="500951170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500951170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500951170">(Feb 20 2025 at 19:06)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a>.</p>



<a name="500951172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500951172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500951172">(Feb 20 2025 at 19:06)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a>.</p>



<a name="500951176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500951176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500951176">(Feb 20 2025 at 19:06)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a> from <code>abrown:assembler-priorities</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>See commit messages for details.</p>
</blockquote>



<a name="500953178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500953178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500953178">(Feb 20 2025 at 19:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2630917726">PR review</a>:</p>
<blockquote>
<p>Thanks! Some thoughts on ordering below but otherwise LGTM.</p>
</blockquote>



<a name="500953181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500953181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500953181">(Feb 20 2025 at 19:19)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964204723">PR review comment</a>:</p>
<blockquote>
<p>It may be a personal preference, but I find the rule-sets easier to read / double-check when they are sorted descending by priority, rather than organized by some other column (type, here). Would you mind regrouping that way so we can see the overall prioritization?</p>
</blockquote>



<a name="500955662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500955662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500955662">(Feb 20 2025 at 19:35)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2630953990">PR review</a>.</p>



<a name="500955664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500955664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500955664">(Feb 20 2025 at 19:35)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964226341">PR review comment</a>:</p>
<blockquote>
<p>I agree that we should do descending priority (<code>3 ... 2 ... 1</code>) but this type-based reorganization is @alexcrichton's doing. @alexcrichton, thoughts?</p>
</blockquote>



<a name="500955961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500955961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500955961">(Feb 20 2025 at 19:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2630958009">PR review</a>.</p>



<a name="500955962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500955962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500955962">(Feb 20 2025 at 19:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964228705">PR review comment</a>:</p>
<blockquote>
<p>(another question is what should the priorities be: shouldn't GPR-matching be highest priority since we expect that to be picked most often? Etc.)</p>
</blockquote>



<a name="500956064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500956064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500956064">(Feb 20 2025 at 19:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2630959449">PR review</a>.</p>



<a name="500956066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500956066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500956066">(Feb 20 2025 at 19:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964229492">PR review comment</a>:</p>
<blockquote>
<p>Here's reordered by @alexcrichton's priorities and I don't think the grouping is intuitive:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addb_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addw_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addq_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_simm8</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addl_mi_sxb</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_simm8</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addq_mi_sxb</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_imm8</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">    </span><span class="p">(</span><span class="n">x64_addb_mi</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_imm16</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addw_mi</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_imm32</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addl_mi</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_simm32</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">  </span><span class="p">(</span><span class="n">x64_addq_mi_sxl</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="500957477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500957477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500957477">(Feb 20 2025 at 19:47)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2630978128">PR review</a>.</p>



<a name="500957478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500957478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500957478">(Feb 20 2025 at 19:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964240529">PR review comment</a>:</p>
<blockquote>
<p>Hmm, yeah, that's pretty subtle too.</p>
<p>I guess I'm curious about the motivation to "compress" priorities and make more use of non-overlap: if we know for sure the order in which we want rules to match, I personally don't see a huge issue with linearizing priorities (i.e. encoding a more total order than strictly required to resolve overlaps), if it makes the code clearer.</p>
<p>Alternately if rules are grouped into "totally ordered subgroups", closer to what this PR had, it's not the worst thing if it's fully regular and if the groups are visually separated. I think I was partly reacting to the reverse ordering (lower prio rules first) and the bunched-up view that makes it harder to see the overall shape.</p>
</blockquote>



<a name="500981869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500981869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500981869">(Feb 20 2025 at 22:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2631304637">PR review</a>.</p>



<a name="500981871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500981871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500981871">(Feb 20 2025 at 22:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964428778">PR review comment</a>:</p>
<blockquote>
<p>Personally I prefer logical grouping by "thing" rather than priority per-se, an example is <a href="https://github.com/bytecodealliance/wasmtime/blob/acef4083d272ed5ae369a4a5dadc603fa79820a7/cranelift/codegen/src/isa/pulley_shared/lower.isle#L251-L300"><code>isub</code> in pulley</a>. IIRC I've written rules like this on x64 as well, but I may also be misremembering.</p>
<p>As for the original motivation: personally I  think we should try to avoid "just keep adding one to the priority until it compiles" because (a) it feels bad and (b) I'm led to believe the generated code is worse to be a sequence of matches rather than "one big <code>match</code>".</p>
<p>In the abstract there shouldn't be priorities in these rules at all, everything is disjoint. It should be one giant match and we should be able to do <code>(GprMemImm.Mem addr)</code> or something like that. That doesn't work because <code>GprMemImm</code> is a newtype wrapper around <code>RegMemImm</code> which can't be pattern-matched in ISLE.</p>
<p>In my mind I'm trying to nudge in the direction of removing the priorities here by reducing the number of priorities. Here I agree though that having an ascending/descending list of priorities helps see things. For example @abrown with  the list you <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964229492">pasted</a> it seems like we can clean this up a bit:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addb_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addw_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addq_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">;;</span><span class="w"> </span><span class="n">imm</span><span class="w"> </span><span class="n">things</span>
</code></pre></div>
<p>to instead be</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addb_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addw_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addq_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>

<span class="p">;;</span><span class="w"> </span><span class="n">imm</span><span class="w"> </span><span class="n">things</span>
</code></pre></div>
<p>I think that should have no loss of generality? (and we could probably remove the <code>is_mem</code> constructor since uses of that probably want to gbe <code>is_gpr_mem</code> instead).</p>
<hr>
<p>So altogether, how about this:</p>
<ul>
<li>Group by priority on the instructions, and within a priority sort-by-type.</li>
<li>One priority is <code>is_gpr_mem</code> which handles the <code>GprMem</code> of the <code>GprMemImm</code> argument</li>
<li>Another priority is the various imm extractors, e.g. <code>simm8</code> vs <code>imm32</code> in the <code>I32</code> case. </li>
</ul>
</blockquote>



<a name="500983532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500983532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500983532">(Feb 20 2025 at 22:43)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2631340728">PR review</a>.</p>



<a name="500983534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/500983534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#500983534">(Feb 20 2025 at 22:43)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1964450421">PR review comment</a>:</p>
<blockquote>
<p>That sounds good to me; all my opinions are weakly-held, I mostly just want to be able to easily decipher how the rules layer, and that seems like an improvement.</p>
</blockquote>



<a name="501163097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501163097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501163097">(Feb 21 2025 at 18:28)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2633908165">PR review</a>.</p>



<a name="501163099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501163099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501163099">(Feb 21 2025 at 18:28)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1965989828">PR review comment</a>:</p>
<blockquote>
<p>Nah, @alexcrichton, we can't just use <code>is_gpr_mem</code> everywhere. For those smaller widths, we are actually emitting two different instructions based whether <code>is_mem</code> or <code>is_gpr</code> fires.</p>
<p>I'm not sure I understand how to decipher the last paragraph there and I would say I don't really care too much either way except that we need to actually get the priorities correct and clear or we have to fix things again like in e6a97ad. What is weird here is that some priorities don't really matter but others do, like the imm extractors you point out.</p>
</blockquote>



<a name="501163128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501163128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501163128">(Feb 21 2025 at 18:29)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1965989828">PR review comment</a>.</p>



<a name="501169957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501169957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501169957">(Feb 21 2025 at 19:08)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2633992676">PR review</a>.</p>



<a name="501169959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501169959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501169959">(Feb 21 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1966037979">PR review comment</a>:</p>
<blockquote>
<p>Oh d'oh that's right, I keep forgetting about the subtelties here...</p>
<p>Ah yeah I also don't mean to say priorities don't matter, because you're right they do for immediates. How about:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">;;</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">smaller</span><span class="w"> </span><span class="n">immediates</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">smaller</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">encoding</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_simm8</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addl_mi_sxb</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_simm8</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addq_mi_sxb</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>

<span class="p">;;</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">immediates</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">corresponding</span><span class="w"> </span><span class="n">instruction</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_imm8</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">    </span><span class="p">(</span><span class="n">x64_addb_mi</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_imm16</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addw_mi</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_imm32</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">   </span><span class="p">(</span><span class="n">x64_addl_mi</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_simm32</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">  </span><span class="p">(</span><span class="n">x64_addq_mi_sxl</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>

<span class="p">;;</span><span class="w"> </span><span class="n">extend</span><span class="w"> </span><span class="mi">8</span><span class="o">/</span><span class="mi">16</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">register</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">register</span><span class="w"> </span><span class="n">addition</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="n">dependencies</span>
<span class="p">;;</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">instructions</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>

<span class="p">;;</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operand</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">instruction</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I8</span><span class="w">  </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addb_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I16</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w">     </span><span class="p">(</span><span class="n">x64_addw_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I32</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addl_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
<span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">x64_add</span><span class="w"> </span><span class="cp">$I64</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="p">(</span><span class="n">is_gpr_mem</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">x64_addq_rm</span><span class="w"> </span><span class="n">src1</span><span class="w"> </span><span class="n">src2</span><span class="p">))</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="501170037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501170037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501170037">(Feb 21 2025 at 19:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2633993890">PR review</a>.</p>



<a name="501170039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501170039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501170039">(Feb 21 2025 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1966038809">PR review comment</a>:</p>
<blockquote>
<p>Technically the 0-priority rules for 8/16-bit addition could also be <code>is_gpr_mem</code> I think? The 1-priority rules are just an optimization</p>
</blockquote>



<a name="501211644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501211644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501211644">(Feb 22 2025 at 01:06)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a>.</p>



<a name="501214005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501214005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501214005">(Feb 22 2025 at 01:37)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a>.</p>



<a name="501214083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501214083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501214083">(Feb 22 2025 at 01:38)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#pullrequestreview-2634581723">PR review</a>.</p>



<a name="501214084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501214084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501214084">(Feb 22 2025 at 01:38)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10260#discussion_r1966380047">PR review comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I'll remove <code>is_mem</code> for now... might need it again in the future.</p>
</blockquote>



<a name="501214093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501214093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501214093">(Feb 22 2025 at 01:38)</a>:</h4>
<p>abrown has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a>.</p>



<a name="501216821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310260%20x64%3A%20rework%20new%20assembler%20rule%20prior.../near/501216821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310260.20x64.3A.20rework.20new.20assembler.20rule.20prior.2E.2E.2E.html#501216821">(Feb 22 2025 at 02:15)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10260">PR #10260</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>