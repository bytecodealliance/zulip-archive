<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10154 pulley: Reimplement wasm loads/store... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html">wasmtime / PR #10154 pulley: Reimplement wasm loads/store...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="496666027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496666027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496666027">(Jan 29 2025 at 23:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="496666031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496666031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496666031">(Jan 29 2025 at 23:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="496666032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496666032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496666032">(Jan 29 2025 at 23:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="496666033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496666033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496666033">(Jan 29 2025 at 23:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="496666052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496666052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496666052">(Jan 29 2025 at 23:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="496666178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496666178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496666178">(Jan 29 2025 at 23:56)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#issuecomment-2623198339">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>:</p>
<blockquote>
<p>I'll note that one thing I'm having difficulty adding a <code>disas</code> test for is something which generates a "g32bne" lowering. I can see the instructions getting emitted in <code>spidermonkey.cwasm</code> but I am having a difficult time reducing things down to something that can be added as an example. Most loads aren't "sinkable" which is why it's not used super often at least.</p>
</blockquote>



<a name="496679815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/496679815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#496679815">(Jan 30 2025 at 02:06)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#issuecomment-2623358477">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:meta", "isle", "pulley", "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle, pulley</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="497718952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/497718952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#497718952">(Feb 04 2025 at 17:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1941589424">PR review comment</a>:</p>
<blockquote>
<p>All the instruction deltas in this file are equal or worse compared to before -- is that expected?</p>
</blockquote>



<a name="497718953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/497718953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#497718953">(Feb 04 2025 at 17:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1941580376">PR review comment</a>:</p>
<blockquote>
<p>Can we put this in the common prelude, rather than duplicating it in both the opt and lower preludes?</p>
</blockquote>



<a name="497718960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/497718960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#497718960">(Feb 04 2025 at 17:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#pullrequestreview-2593536076">PR review</a>:</p>
<blockquote>
<p>LGTM but some questions that should be resolved below.</p>
</blockquote>



<a name="497718962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/497718962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#497718962">(Feb 04 2025 at 17:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1941582414">PR review comment</a>:</p>
<blockquote>
<p>Might as well use the helper if you're gonna define it:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        self.is_pulley()
</code></pre></div><br>
</p>
</blockquote>



<a name="497719006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/497719006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#497719006">(Feb 04 2025 at 17:23)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#issuecomment-2634609932">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>:</p>
<blockquote>
<p>And sorry for the delay on this review, I forgot about it for a little bit</p>
</blockquote>



<a name="498131333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498131333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498131333">(Feb 06 2025 at 14:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#pullrequestreview-2598817845">PR review</a>.</p>



<a name="498131337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498131337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498131337">(Feb 06 2025 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1944806936">PR review comment</a>:</p>
<blockquote>
<p>It was originally, but the problem is that they're slightly different where the helpers for egraphs have a <code>ty</code> variable and the helpers for backends don't. I'm not sure how to otherwise unify those two myself</p>
</blockquote>



<a name="498131694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498131694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498131694">(Feb 06 2025 at 14:19)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="498144451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498144451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498144451">(Feb 06 2025 at 15:13)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="498148272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498148272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498148272">(Feb 06 2025 at 15:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1944934350">PR review comment</a>:</p>
<blockquote>
<p>That's a good point, and one where I mostly shrugged this off but shouldn't have! I focused a bit more on this and improved a few cases in <a href="https://github.com/bytecodealliance/wasmtime/pull/10154/commits/63e2c5a92a3a209b466a8e3a7627bcb9cd3ef159">https://github.com/bytecodealliance/wasmtime/pull/10154/commits/63e2c5a92a3a209b466a8e3a7627bcb9cd3ef159</a></p>
<p>The remaining ones that got worse are:</p>
<ul>
<li><code>offset_just_bad_v2</code> - looking into this it looks like optimizations shuffle constants around enough that the output CLIF is quite different from normal loads/stores, so I think this is something we'll basically just take a hit on for now and improve later if necessary</li>
<li><code>maybe_inbounds_v2</code> - this doesn't codegen well because egraphs can't optimize away the <code>uadd_overflow_trap</code>-with-<code>iconst</code>-inputs that the frontend generates. Another possible fix is to optimize the frontend to skip <code>uadd_overflow_trap</code> in this case (constant address).</li>
</ul>
</blockquote>



<a name="498148273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498148273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498148273">(Feb 06 2025 at 15:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#pullrequestreview-2599030165">PR review</a>.</p>



<a name="498148578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498148578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498148578">(Feb 06 2025 at 15:30)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<a name="498167614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498167614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498167614">(Feb 06 2025 at 16:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#pullrequestreview-2599333485">PR review</a>.</p>



<a name="498167615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498167615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498167615">(Feb 06 2025 at 16:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1945100836">PR review comment</a>:</p>
<blockquote>
<p>FWIW, we want to add the type parameters in the lowering prelude's versions of the bindings eventually, for exactly this reason -- the only reason they aren't there is that lowering rules were written first and we didn't realize we would need them on the constructor side. @mmcloughlin apparently has a private branch where this change has been made -- Michael, would you be willing to think about upstreaming this?</p>
</blockquote>



<a name="498202205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498202205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498202205">(Feb 06 2025 at 20:10)</a>:</h4>
<p>mmcloughlin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#pullrequestreview-2599794445">PR review</a>.</p>



<a name="498202208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498202208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498202208">(Feb 06 2025 at 20:10)</a>:</h4>
<p>mmcloughlin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1945359885">PR review comment</a>:</p>
<blockquote>
<p>Yes, I think I could upstream it. Our fork has diverged a bit so it's not a clean patch, but thankfully I did keep the Python script I used to do most of the fixups and hopefully that procedure would work again.</p>
<p>A couple of things to note about the change in our fork:</p>
<ul>
<li>The <code>ty</code> parameter is not always present on instruction extractors. In the CDSL code generator, a <code>ty</code> parameter added only when the instruction is statically known to always have at least one result. In that case, <code>ty</code> is the type of the first result value.</li>
<li>The existing code uses <code>has_type</code> extractor in cases that would now be more naturally be done with the provided <code>ty</code> argument. Replacing <code>has_type</code> uses with the <code>ty</code> argument is hard/impossible to do automatically. This is fine as long as you're okay with migrating away from <code>has_type</code> (where possible) more slowly over time.<br>
</li>
</ul>
</blockquote>



<a name="498206416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498206416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498206416">(Feb 06 2025 at 20:37)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#pullrequestreview-2599855233">PR review</a>.</p>



<a name="498206417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498206417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498206417">(Feb 06 2025 at 20:37)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10154#discussion_r1945394711">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>The ty parameter is not always present on instruction extractors. In the CDSL code generator, a ty parameter added only when the instruction is statically known to always have at least one result. In that case, ty is the type of the first result value.</p>
</blockquote>
<p>I suppose we could use <code>Types::INVALID</code> for no-result instructions on the extractor side. (On the constructor side we currently don't generate ctors for side-effecting insts, which includes all no-result insts; but when we do, we could require <code>Types::INVALID</code> to be passed in, asserting otherwise.)</p>
<blockquote>
<p>The existing code uses <code>has_type</code> extractor in cases that would now be more naturally be done with the provided <code>ty</code> argument. Replacing <code>has_type</code> uses with the <code>ty</code> argument is hard/impossible to do automatically. This is fine as long as you're okay with migrating away from <code>has_type</code> (where possible) more slowly over time.</p>
</blockquote>
<p>Yeah, a gradual migration seems totally fine here.</p>
</blockquote>



<a name="498832486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310154%20pulley%3A%20Reimplement%20wasm%20loads/store.../near/498832486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310154.20pulley.3A.20Reimplement.20wasm.20loads.2Fstore.2E.2E.2E.html#498832486">(Feb 10 2025 at 18:26)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10154">PR #10154</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>