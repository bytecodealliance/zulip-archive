<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11153 x64: EVEX Encoding for new assembler · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html">wasmtime / PR #11153 x64: EVEX Encoding for new assembler</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="526155511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/526155511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#526155511">(Jun 27 2025 at 21:46)</a>:</h4>
<p>rahulchaphalkar opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a> from <code>rahulchaphalkar:pr-evex-encoding</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Adds evex encoding for new assembler. <br>
Adds <code>vaddpd</code> evex instr.</p>
<p>Following items are not implemented in this PR / left out intentionally -</p>
<ul>
<li>Broadcast attribute (<code>bcst</code>). Will be implemented in future pr.</li>
<li>Features: Uses <code>avx512vl</code> feature right now, this will be changed to AND of <code>avx512vl</code> and <code>avx512f</code>, and at a later point to <code>avx10.1</code>, <code>avx10.2</code> etc.</li>
<li><code>vaddpd</code> is not lowered yet</li>
</ul>
<p>@abrown Ready for review. I'll add a few code comments for some discussion soon, apart from above list of omitted items.</p>
</blockquote>



<a name="526155512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/526155512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#526155512">(Jun 27 2025 at 21:46)</a>:</h4>
<p><strong>rahulchaphalkar</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="526155513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/526155513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#526155513">(Jun 27 2025 at 21:46)</a>:</h4>
<p><strong>rahulchaphalkar</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="526158500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/526158500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#526158500">(Jun 27 2025 at 22:28)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="526159694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/526159694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#526159694">(Jun 27 2025 at 22:48)</a>:</h4>
<p>rahulchaphalkar submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#pullrequestreview-2968133026">PR review</a>.</p>



<a name="526159695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/526159695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#526159695">(Jun 27 2025 at 22:48)</a>:</h4>
<p>rahulchaphalkar created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2172954407">PR review comment</a>:</p>
<blockquote>
<p><code>EvexLength</code> and <code>VexLength</code> enums have members with same names, causing me to specify which enum. I can either </p>
<ul>
<li>Make all vex/evex look the same form, like <code>VexLength::L128</code> and <code>EvexLength::L128</code> everywhere</li>
<li>Introduce constants like <code>V128</code>, <code>E128</code> etc.</li>
<li>Use <code>VexLength</code> for evex as well or add a common <code>VectorLength</code> enum for both vex/evex.<br>
Something else?</li>
</ul>
</blockquote>



<a name="527580638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580638">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#pullrequestreview-2995472000">PR review</a>.</p>



<a name="527580639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580639">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191158664">PR review comment</a>:</p>
<blockquote>
<p>As a further point on my comment above about <code>Operand::mask_reg</code>, I think we would also want <code>Operand::zeroing</code> to be a runtime decision. In other words, when a user of this assembler is encoding an instruction, they should have the ability to decide not only which opmask register to use (<code>k0</code>-<code>k7</code>) but also to select if they want the "merging-masking" or "zeroing-masking" behavior (section 2.7.4 in the manual). So this <code>bool</code> field would need to be present on the generated instruction <code>struct</code>, not here in the DSL.</p>
<p>This raises some questions, though, about how to handle these "options" on an instruction:</p>
<ul>
<li>for opmask registers, we probably want some way to use <code>k0</code> by default, which does no masking at all; other, than this, opmask registers act pretty much like other operands (no regalloc, though)</li>
<li>for masking behavior, we do not want them to act like other operands &mdash; this flag isn't an operand at all! I propose we encode the default behavior in <code>EVEX.z</code> and open an issue to figure out a good way to expose this kind of flag on instructions. Why? Because...</li>
<li>for vector lengths, we actually want the ability to select the length as one of these flags (<code>L128</code>, <code>L256</code>, <code>L512</code>). Right now we fix this in the DSL but, if we had a way to expose flags, we would want instruction lengths to parameterize the instruction.</li>
</ul>
<p>But all of that does not need to be figured out in this PR. I propose we just default to using <code>k0</code> and ignore the masking behavior here and open an issue to solve this later.</p>
</blockquote>



<a name="527580640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580640">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191140485">PR review comment</a>:</p>
<blockquote>
<p>This doesn't make sense because the opmask registers are true operands. The user can specify which register (<code>k0</code>-<code>k7</code>) to use when the assembler is used at runtime, so we can't predetermine which <code>mask_reg</code> the instruction should be using here when instructions are defined.</p>
</blockquote>



<a name="527580641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580641">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191172916">PR review comment</a>:</p>
<blockquote>
<p>I think we should just call it <code>Length</code> and have it contain all three: <code>L128</code>, <code>L256</code>, and <code>L512</code>. Then, in the validation for VEX instructions we should only allow <code>L128</code> and <code>L256</code>.</p>
</blockquote>



<a name="527580642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580642">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191161721">PR review comment</a>:</p>
<blockquote>
<p>I'm not sure that we want to copy-paste these yet from the VEX implementation. I suspect they all are the same but I'm not really sure, so we might want to start with only the formats we need and build from there. At some later point we could even deduplicate between VEX and EVEX.</p>
</blockquote>



<a name="527580643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580643">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191171813">PR review comment</a>:</p>
<blockquote>
<p>Guess the <code>r()</code> is missing from a bunch of VEX instructions which goes to show how little it changes!</p>
</blockquote>



<a name="527580644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580644">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191174926">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        mmm: u8,
</code></pre></div>
<p>The EVEX field is 3-bit: <code>EVEX.mmm</code>. Makes me think we should check that we're using this <code>u8</code> correctly elsewhere.</p>
</blockquote>



<a name="527580645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580645">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191175475">PR review comment</a>:</p>
<blockquote>
<p>E.g., this is true for now but there are two other decoding map IDs, 5 and 6, that would trip over this.</p>
</blockquote>



<a name="527580646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580646">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191168580">PR review comment</a>:</p>
<blockquote>
<p>If we ignore the opmask registers and masking behavior then we don't need this, right? Or I guess we still need to print <code>{k0}</code> or something like that to match Capstone? Maybe we should implement the "opmask registers as operands" logic after all...</p>
</blockquote>



<a name="527580647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580647">(Jul 07 2025 at 23:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2191169891">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        inst("addpd", fmt("A", [rw(xmm1), r(align(xmm_m128))]), rex([0x66, 0x0F, 0x58]).r(), _64b | compat | sse2).alt(avx, "vaddpd_b"),
        inst("vaddpd", fmt("B", [w(xmm1), r(xmm2), r(xmm_m128)]), vex(L128)._66()._0f().op(0x58).r(), _64b | compat | avx),
</code></pre></div>
<p>The order doesn't matter to the DSL but we should keep it consistent with the manual.</p>
</blockquote>



<a name="527580731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/527580731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#527580731">(Jul 07 2025 at 23:23)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#issuecomment-3046793363">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>:</p>
<blockquote>
<p>I'll probably take over this PR soon since @rahulchaphalkar is out for a bit.</p>
</blockquote>



<a name="529161835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529161835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529161835">(Jul 16 2025 at 20:25)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529165443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529165443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529165443">(Jul 16 2025 at 20:53)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529165908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529165908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529165908">(Jul 16 2025 at 20:56)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529166706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529166706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529166706">(Jul 16 2025 at 21:02)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#pullrequestreview-3026886606">PR review</a>.</p>



<a name="529166707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529166707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529166707">(Jul 16 2025 at 21:02)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2211600259">PR review comment</a>:</p>
<blockquote>
<p>I'll rename this to <code>WBit</code> or something like that...</p>
</blockquote>



<a name="529166708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529166708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529166708">(Jul 16 2025 at 21:02)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2211605389">PR review comment</a>:</p>
<blockquote>
<p>This logic should be <code>(AVX512VL AND
AVX512F)</code>. Additionally, since we need the ability to <code>AND</code> things together, we need to teach the whole expression to mean: <code>(_64b | compat) &amp; (...)</code> (maybe in another PR, since this affects many instructions beyond just this one).</p>
</blockquote>



<a name="529169660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529169660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529169660">(Jul 16 2025 at 21:26)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529170120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529170120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529170120">(Jul 16 2025 at 21:30)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529171578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529171578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529171578">(Jul 16 2025 at 21:44)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529171922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529171922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529171922">(Jul 16 2025 at 21:48)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529172656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529172656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529172656">(Jul 16 2025 at 21:56)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529174920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529174920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529174920">(Jul 16 2025 at 22:19)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#issuecomment-3081411612">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>:</p>
<blockquote>
<p>@cfallin or @alexcrichton: can one of you review this? I've changed this PR substantially since it was first opened so I think it needs a new reviewer that is not me.</p>
</blockquote>



<a name="529174950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529174950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529174950">(Jul 16 2025 at 22:19)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529174952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529174952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529174952">(Jul 16 2025 at 22:19)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<a name="529175053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529175053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529175053">(Jul 16 2025 at 22:20)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#issuecomment-3081419523">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>:</p>
<blockquote>
<p>Sure, taking a look!</p>
</blockquote>



<a name="529175645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529175645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529175645">(Jul 16 2025 at 22:26)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#pullrequestreview-3027080495">PR review</a>:</p>
<blockquote>
<p>LGTM. Taking your word (and the fuzzer's) on the actual prefix-encoding details!</p>
</blockquote>



<a name="529176611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529176611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529176611">(Jul 16 2025 at 22:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#pullrequestreview-3027103498">PR review</a>.</p>



<a name="529176612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529176612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529176612">(Jul 16 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11153#discussion_r2211741910">PR review comment</a>:</p>
<blockquote>
<p>I think this may actually work out? Not to say our current modeling of things is correct, but functionally with <code>| avx512f</code> here I think it has the net effect of requiring more features. Notably we <a href="https://github.com/bytecodealliance/wasmtime/blob/da2655157740c4ec85aa329376088c927781428d/cranelift/codegen/src/isa/x64/inst/mod.rs#L119-L142">take all the features the assembler says</a> and flag them all as requirements of each instruction, so by listing more features here it's interpreted as effectively requiring all of them. I don't know if that's an accurate reflection of <code>_64b</code> and <code>compat</code> though as we otherwise basically ignore those features right now.</p>
<p>Although rereading your comment now I suspect you're talking about the interactions of <code>_64b</code> and <code>compat</code> with feature flags, which is exactly the gray area for me that iunno much about, so probably just disregard me</p>
</blockquote>



<a name="529177793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311153%20x64%3A%20EVEX%20Encoding%20for%20new%20assembler/near/529177793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311153.20x64.3A.20EVEX.20Encoding.20for.20new.20assembler.html#529177793">(Jul 16 2025 at 22:51)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11153">PR #11153</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>