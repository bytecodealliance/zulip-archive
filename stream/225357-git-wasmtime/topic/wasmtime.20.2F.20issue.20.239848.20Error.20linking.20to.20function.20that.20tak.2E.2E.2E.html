<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9848 Error linking to function that tak... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html">wasmtime / issue #9848 Error linking to function that tak...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="489599843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/489599843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#489599843">(Dec 18 2024 at 01:08)</a>:</h4>
<p><a href="https://github.com/viridia">viridia</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">Issue #9848</a>.</p>



<a name="489599868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/489599868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#489599868">(Dec 18 2024 at 01:08)</a>:</h4>
<p>viridia opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>I'm getting this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">types</span><span class="w"> </span><span class="n">incompatible</span><span class="p">:</span><span class="w"> </span><span class="nc">expected</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">(</span><span class="n">engine</span><span class="w"> </span><span class="mi">5</span><span class="p">))))</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">array</span><span class="p">)))</span><span class="err">`</span>
</code></pre></div>
<p>The wasm looks like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$String</span><span class="w"> </span><span class="p">(;</span><span class="mi">3</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="kt">i8</span><span class="p">))</span>
<span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$debug</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">4</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$String</span><span class="p">))))</span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"host"</span><span class="w"> </span><span class="s">"debug"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$debug</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$debug</span><span class="p">.</span><span class="k">type</span><span class="p">)))</span>
</code></pre></div>
<p>And I'm registering the function like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Store</span><span class="p">::</span><span class="o">&lt;</span><span class="n">StoreData</span><span class="o">&gt;</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>
<span class="n">linker</span>
<span class="w">    </span><span class="p">.</span><span class="n">func_wrap</span><span class="p">(</span>
<span class="w">        </span><span class="s">"host"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"debug"</span><span class="p">,</span>
<span class="w">        </span><span class="o">|</span><span class="n">caller</span><span class="p">:</span><span class="w"> </span><span class="nc">Caller</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">StoreData</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">param</span><span class="p">:</span><span class="w"> </span><span class="nc">Rooted</span><span class="o">&lt;</span><span class="n">ArrayRef</span><span class="o">&gt;|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ...</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"> </span><span class="cp">$hello</span><span class="p">.</span><span class="n">saga</span>
<span class="w">  </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$hello</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$add</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$name</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">2</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$String</span><span class="w"> </span><span class="p">(;</span><span class="mi">3</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="kt">i8</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$debug</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">4</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$String</span><span class="p">))))</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"host"</span><span class="w"> </span><span class="s">"debug"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$debug</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$debug</span><span class="p">.</span><span class="k">type</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"hello"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$hello</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$hello</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$hello</span><span class="p">.</span><span class="k">type</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="cp">$add</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">    </span><span class="kt">f32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="mi">8</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">(;</span><span class="o">=</span><span class="mi">3</span><span class="p">;)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">trunc_f32_s</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">    </span><span class="k">return</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="w"> </span><span class="p">(;</span><span class="mi">2</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$add</span><span class="p">.</span><span class="k">type</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">local</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">    </span><span class="k">return</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$name</span><span class="w"> </span><span class="p">(;</span><span class="mi">3</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$name</span><span class="p">.</span><span class="k">type</span><span class="p">)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">15</span>
<span class="w">    </span><span class="n">array</span><span class="p">.</span><span class="n">new_data</span><span class="w"> </span><span class="cp">$String</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="cp">$debug</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="s">"Hello from SAGA"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<p>Create an Engine and Linker.<br>
Bind a function which accepts an ArrayRef as a parameter.<br>
Attempt to load the script.</p>
<h3>Expected Results</h3>
<p>Script should load without error (it loads if I delete the code that calls the host func).</p>
<h3>Actual Results</h3>
<p>Error when I attempt to instantiate the script.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <code>{ version = "27.0.0", features = ["gc", "gc-drc"] }</code></p>
<p>Operating system: OS X</p>
<p>Architecture: M2<br>
</p>
</blockquote>



<a name="489788678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/489788678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#489788678">(Dec 18 2024 at 15:54)</a>:</h4>
<p>alexcrichton assigned fitzgen to <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>.</p>



<a name="489805813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/489805813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#489805813">(Dec 18 2024 at 17:16)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2551874226">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>Thanks for filing an issue. I won't have time to look into this for a while, unfortunately, but I appreciate getting it on the record for posterity.</p>
</blockquote>



<a name="490019678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/490019678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#490019678">(Dec 19 2024 at 17:51)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasmtime:ref-types label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">Issue #9848</a>.</p>



<a name="490019679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/490019679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#490019679">(Dec 19 2024 at 17:51)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasm-proposal:gc label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">Issue #9848</a>.</p>



<a name="490019821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/490019821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#490019821">(Dec 19 2024 at 17:52)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2555400228">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:ref-types"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: wasmtime:ref-types</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="490019951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/490019951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#490019951">(Dec 19 2024 at 17:53)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2555407659">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>FWIW, this is probably related to the <code>WasmTy</code> implementation for <code>ArrayRef</code></p>
</blockquote>



<a name="495402196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/495402196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#495402196">(Jan 23 2025 at 01:04)</a>:</h4>
<p>fitzgen-f5 <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2608626061">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>Hm so I converted this into a test in <code>tests/all/arrays.rs</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">instantiate_with_func_that_takes_array</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gc_store</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">(),</span>
<span class="w">        </span><span class="s">r#"</span>
<span class="s">            (module</span>
<span class="s">                (type $String (;3;) (array i8))</span>
<span class="s">                (type $debug.type (;4;) (func (param (ref $String))))</span>
<span class="s">                (import "host" "debug" (func $debug (;0;) (type $debug.type)))</span>
<span class="s">            )</span>
<span class="s">        "#</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">());</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">func_wrap</span><span class="p">(</span><span class="s">"host"</span><span class="p">,</span><span class="w"> </span><span class="s">"debug"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="p">:</span><span class="w"> </span><span class="nc">Caller</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">:</span><span class="w"> </span><span class="nc">Rooted</span><span class="o">&lt;</span><span class="n">ArrayRef</span><span class="o">&gt;|</span><span class="w"> </span><span class="p">{})</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>And I am indeed reproducing the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">incompatible</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">for</span><span class="w"> </span><span class="err">`</span><span class="n">host</span><span class="p">::</span><span class="n">debug</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">types</span><span class="w"> </span><span class="n">incompatible</span><span class="p">:</span><span class="w"> </span><span class="nc">expected</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">(</span><span class="n">engine</span><span class="w"> </span><span class="mi">0</span><span class="p">))))</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">array</span><span class="p">)))</span><span class="err">`</span>
</code></pre></div>
<p>However, I'm not convinced that this is actually incorrect behavior. The type of the wrapped function is <code>(func (param (ref array)))</code> which indeed is <em>not</em> a subtype of <code>(func (param (ref array $String)))</code> and so the <code>MatchCx</code> used to typecheck instance linking is correctly yielding a type error.</p>
<p>If we make <code>$debug.type</code> non-<code>final</code> (which it implicitly was originally) and switch from using <code>linker.func_wrap</code> to <code>Func::new</code> and explicitly provide a function whose type is a subtype of <code>$debug.type</code>, then the test does indeed pass:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">instantiate_with_func_that_takes_array</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gc_store</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">(),</span>
<span class="w">        </span><span class="s">r#"</span>
<span class="s">            (module</span>
<span class="s">                (type $String (;3;) (array i8))</span>
<span class="s">                (type $debug.type (;4;) (sub (func (param (ref $String)))))</span>
<span class="s">                (import "host" "debug" (func $debug (;0;) (type $debug.type)))</span>
<span class="s">            )</span>
<span class="s">        "#</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">string_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArrayType</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">(),</span>
<span class="w">        </span><span class="n">FieldType</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutability</span><span class="p">::</span><span class="n">Const</span><span class="p">,</span><span class="w"> </span><span class="n">StorageType</span><span class="p">::</span><span class="n">I8</span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sup_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FuncType</span><span class="p">::</span><span class="n">with_finality_and_supertype</span><span class="p">(</span>
<span class="w">        </span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">(),</span>
<span class="w">        </span><span class="n">Finality</span><span class="p">::</span><span class="n">NonFinal</span><span class="p">,</span>
<span class="w">        </span><span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">ValType</span><span class="p">::</span><span class="n">Ref</span><span class="p">(</span><span class="n">RefType</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">            </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">HeapType</span><span class="p">::</span><span class="n">ConcreteArray</span><span class="p">(</span><span class="n">string_ty</span><span class="p">),</span>
<span class="w">        </span><span class="p">))],</span>
<span class="w">        </span><span class="nb">None</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sub_ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FuncType</span><span class="p">::</span><span class="n">with_finality_and_supertype</span><span class="p">(</span>
<span class="w">        </span><span class="n">store</span><span class="p">.</span><span class="n">engine</span><span class="p">(),</span>
<span class="w">        </span><span class="n">Finality</span><span class="p">::</span><span class="n">NonFinal</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sup_ty</span><span class="p">),</span>
<span class="w">        </span><span class="p">[</span><span class="n">ValType</span><span class="p">::</span><span class="n">Ref</span><span class="p">(</span><span class="n">RefType</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">HeapType</span><span class="p">::</span><span class="n">Array</span><span class="p">))],</span>
<span class="w">        </span><span class="nb">None</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">func_new</span><span class="p">(</span><span class="s">"host"</span><span class="p">,</span><span class="w"> </span><span class="s">"debug"</span><span class="p">,</span><span class="w"> </span><span class="n">sub_ty</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">_caller</span><span class="p">,</span><span class="w"> </span><span class="n">_args</span><span class="p">,</span><span class="w"> </span><span class="n">_rets</span><span class="o">|</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(()))</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">arrays</span><span class="p">::</span><span class="n">instantiate_with_func_that_takes_array</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">ok</span>
</code></pre></div>
<hr>
<p>That is all technically correct, but I'm not sure if it is what we ultimately want. It seems very reasonable to want to write code like in the OP, even if it technically doesn't match subtyping rules (but would if the types involved were non-<code>final</code> and declared to be subtypes; basically those that structurally match but are not actually declared subtypes).</p>
<p>One extra twist is that I think we actually used to allow this kind of thing, but I think I removed it when getting the GC wast tests passing, since (IIRC) there were some <code>assert_unlinkable</code> pragmas exercising this stuff. Makes sense to disallow in that context, but maybe not in the context of a <code>wasmtime::Linker</code> in the host? Not totally convinced either way.</p>
</blockquote>



<a name="495557049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/495557049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#495557049">(Jan 23 2025 at 17:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2610587314">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>I always forget the directionality of subtyping but I'm confused why this doesn't pass the subtyping check. If I ask for <code>(ref array)</code> and you give me <code>(ref $specific_array)</code> isn't that ok? Shouldn't the functions be subtypes here? (or is the "final" bit coming into play, I have less of a grasp on that)</p>
<p>Otherwise though I'd agree that we want something <code>Func::wrap</code>-related to work here. That's much more efficient, works better with bindings generators, and is generally more ergonomic. How best to thread that needle though I'm not sure either.</p>
</blockquote>



<a name="495559254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/495559254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#495559254">(Jan 23 2025 at 18:10)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2610613145">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>The issue is twofold:</p>
<p>First, that the wrapped function's type, when fully desugared, is</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">sub</span> <span class="err">final</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="p">(</span><span class="err">ref</span> <span class="err">array</span><span class="p">))))</span>
</code></pre></div>
<p>which does not declare itself to be a subtype of <code>$debug.type</code> and therefore is not a subtype of <code>$debug.type</code> even if the underlying parameter and result types match.</p>
<p>And second, that</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">type</span> <span class="nv">$debug.type</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$String</span><span class="p">)))</span>
</code></pre></div>
<p>desugars to a <code>final</code> type</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">type</span> <span class="nv">$debug.type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">final</span> <span class="p">(</span><span class="k">param</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$String</span><span class="p">))))</span>
</code></pre></div>
<p>so no other function type <em>can</em> be a subtype of <code>$debug.type</code> as written, even if it tried.</p>
<p>This all makes sense inside the world of pure Wasm, but from a host API and developer niceties point of view, it becomes pretty frustrating and leads to bad developer experience :-/</p>
</blockquote>



<a name="495559353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/495559353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#495559353">(Jan 23 2025 at 18:11)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2610613145">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>The issue is twofold:</p>
<p>First, that the wrapped function's type, when fully desugared, is</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">sub</span> <span class="err">final</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="p">(</span><span class="err">ref</span> <span class="err">array</span><span class="p">))))</span>
</code></pre></div>
<p>which does not declare itself to be a subtype of <code>$debug.type</code> and therefore is not a subtype of <code>$debug.type</code> even if the underlying parameter and result types match.</p>
<p>And second, that</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">type</span> <span class="nv">$debug.type</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$String</span><span class="p">)))</span>
</code></pre></div>
<p>desugars to a <code>final</code> type</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">type</span> <span class="nv">$debug.type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">final</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$String</span><span class="p">)))))</span>
</code></pre></div>
<p>so no other function type <em>can</em> be a subtype of <code>$debug.type</code> as written, even if it tried.</p>
<p>This all makes sense inside the world of pure Wasm, but from a host API and developer niceties point of view, it becomes pretty frustrating and leads to bad developer experience :-/</p>
</blockquote>



<a name="495579311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/495579311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#495579311">(Jan 23 2025 at 20:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2610942548">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>Ah I see, I was mistakenly thinking about the <code>(sub ...)</code> in the wrong place!</p>
<p>I thought we had something though which was testing that as long as the top type was the same then the host-level type-check passed? And then we optionally included a runtime type-check if the actual type was different from the top type? I'm probably misremembering here...</p>
<p>Another option perhaps is to do something different for wasm gc than we do for normal scalars. Some sort of argument passed to <code>Func::wrap_new_name</code> which is acquired via constructing the type or parsing it out somehow? Maybe that's just a slightly more ergonomic <code>Func::new</code> in that case ...</p>
<p>I suppose put another way one thing we could do is to change <code>Func::new</code> to take any closure, not just the signature today. The function type is then used to perform a runtime type-check against the closure's static type and for today's signature it'd be a noop but you could pass a more specialized signature like <code>Func::wrap</code>. That specialized signature would have a slightly different type-check than the subtyping checks we have today? </p>
<p>In any case I'm just musing here...</p>
</blockquote>



<a name="495808300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/495808300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#495808300">(Jan 24 2025 at 23:14)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2613572142">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<blockquote>
<p>I thought we had something though which was testing that as long as the top type was the same then the host-level type-check passed? And then we optionally included a runtime type-check if the actual type was different from the top type? I'm probably misremembering here...</p>
</blockquote>
<p>We do that for casting an untyped function to a typed function at the Rust/host level, and for matching the underlying Wasm types against the given Rust types, but not when comparing two Wasm function types, which is what linking bottoms out in.</p>
<blockquote>
<p>I suppose put another way one thing we could do is to change <code>Func::new</code> to take any closure, not just the signature today. The function type is then used to perform a runtime type-check against the closure's static type and for today's signature it'd be a noop but you could pass a more specialized signature like <code>Func::wrap</code>. That specialized signature would have a slightly different type-check than the subtyping checks we have today?</p>
</blockquote>
<p>I was also thinking along these lines. Something like <code>Func::wrap_with_func_type</code> that would take the desired function type as well as the closure, and then do the fuzzy-matching stuff to make sure that the closure is valid for the given function type.</p>
<p>The other other idea I was thinking was adding a flag to <code>MatchCx</code> that is like whether to do strict subtype checking or fuzzy, shallow-structural matching. For the component model, and statically linking two Wasm modules together, we would not set that flag to fuzzy mode. For dynamically linking to host functions, we would set the flag to fuzzy mode. But this also gets weird if you just dynamically link two Wasm modules together, which would "accidentally" set the fuzzy mode flag and allow linking two Wasm modules together that it technically shouldn't. So I guess in that case we could instead check if the function is a host function under the covers or not, but this is all getting into the weeds...</p>
</blockquote>



<a name="496182018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/496182018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#496182018">(Jan 27 2025 at 17:57)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2616518974">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<p>Ok that makes sense to me too yeah. I'm also hesitant to add too many flags to the linker type-matching since that's pretty critical for correctness and such, so maybe <code>wrap_with_func_type</code> is the way to go for now?</p>
</blockquote>



<a name="496411445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239848%20Error%20linking%20to%20function%20that%20tak.../near/496411445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239848.20Error.20linking.20to.20function.20that.20tak.2E.2E.2E.html#496411445">(Jan 28 2025 at 19:39)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9848#issuecomment-2619903344">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9848">issue #9848</a>:</p>
<blockquote>
<blockquote>
<p>so maybe <code>wrap_with_func_type</code> is the way to go for now?</p>
</blockquote>
<p>Sounds good to me <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>