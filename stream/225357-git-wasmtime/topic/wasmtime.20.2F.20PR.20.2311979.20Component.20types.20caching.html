<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11979 Component types caching · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html">wasmtime / PR #11979 Component types caching</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="553694614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553694614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553694614">(Nov 04 2025 at 19:14)</a>:</h4>
<p>EthanBlackburn opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a> from <code>EthanBlackburn:component-types-contention</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>PR to resolve performance issue discovered in <a href="https://github.com/bytecodealliance/wasmtime/issues/11974">https://github.com/bytecodealliance/wasmtime/issues/11974</a></p>
<p>This caches the component types to prevent inc/dec contention on <code>arc::clone</code><br>
</p>
</blockquote>



<a name="553694615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553694615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553694615">(Nov 04 2025 at 19:14)</a>:</h4>
<p><strong>EthanBlackburn</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>.</p>



<a name="553694619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553694619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553694619">(Nov 04 2025 at 19:14)</a>:</h4>
<p><strong>EthanBlackburn</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>.</p>



<a name="553694763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553694763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553694763">(Nov 04 2025 at 19:15)</a>:</h4>
<p>EthanBlackburn edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>:</p>
<blockquote>
<p>PR to resolve performance issue discovered in <a href="https://github.com/bytecodealliance/wasmtime/issues/11974">https://github.com/bytecodealliance/wasmtime/issues/11974</a></p>
<p>This caches the component types to prevent inc/dec contention on <code>arc::clone</code>.</p>
<p>Not sure how you'd want to do this, but happy to go through several iterations or let Alex handle it.<br>
</p>
</blockquote>



<a name="553699647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553699647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553699647">(Nov 04 2025 at 19:43)</a>:</h4>
<p>EthanBlackburn edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>:</p>
<blockquote>
<p>PR to resolve performance issue discovered in <a href="https://github.com/bytecodealliance/wasmtime/issues/11974">https://github.com/bytecodealliance/wasmtime/issues/11974</a></p>
<p>This caches the component types to prevent inc/dec contention on <code>arc::clone</code>.</p>
<p>From our own benchmarks:</p>
<p>Before change</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">producer</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="n">consumed</span><span class="p">):</span><span class="w"> </span><span class="mf">2798.62</span><span class="w"> </span><span class="n">MiB</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mf">93.28</span><span class="w"> </span><span class="n">MiB</span><span class="o">/</span><span class="n">s</span>
<span class="n">guest</span><span class="p">:</span><span class="w"> </span><span class="nc">bytes_in</span><span class="o">=</span><span class="mf">2794.94</span><span class="w"> </span><span class="n">MiB</span><span class="p">,</span><span class="w"> </span><span class="n">avg_latency</span><span class="o">=</span><span class="mf">19.490</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="p">(</span><span class="n">over</span><span class="w"> </span><span class="mi">12169</span><span class="w"> </span><span class="n">calls</span><span class="p">)</span>
</code></pre></div>
<p>After change</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">producer</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="n">consumed</span><span class="p">):</span><span class="w"> </span><span class="mf">3731.03</span><span class="w"> </span><span class="n">MiB</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mf">124.36</span><span class="w"> </span><span class="n">MiB</span><span class="o">/</span><span class="n">s</span>
<span class="n">guest</span><span class="p">:</span><span class="w"> </span><span class="nc">bytes_in</span><span class="o">=</span><span class="mf">3728.28</span><span class="w"> </span><span class="n">MiB</span><span class="p">,</span><span class="w"> </span><span class="n">avg_latency</span><span class="o">=</span><span class="mf">13.473</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="p">(</span><span class="n">over</span><span class="w"> </span><span class="mi">16252</span><span class="w"> </span><span class="n">calls</span><span class="p">)</span>
</code></pre></div>
<p>Not sure how you'd want to do this, but happy to go through several iterations or let Alex handle it.<br>
</p>
</blockquote>



<a name="553700804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553700804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553700804">(Nov 04 2025 at 19:50)</a>:</h4>
<p>EthanBlackburn edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>:</p>
<blockquote>
<p>PR to resolve performance issue discovered in <a href="https://github.com/bytecodealliance/wasmtime/issues/11974">https://github.com/bytecodealliance/wasmtime/issues/11974</a></p>
<p>This caches the component types to prevent inc/dec contention on <code>arc::clone</code>.</p>
<p>From our own benchmarks:</p>
<p>Before change</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">producer</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="n">consumed</span><span class="p">):</span><span class="w"> </span><span class="mf">2798.62</span><span class="w"> </span><span class="n">MiB</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mf">93.28</span><span class="w"> </span><span class="n">MiB</span><span class="o">/</span><span class="n">s</span>
<span class="n">guest</span><span class="p">:</span><span class="w"> </span><span class="nc">bytes_in</span><span class="o">=</span><span class="mf">2794.94</span><span class="w"> </span><span class="n">MiB</span><span class="p">,</span><span class="w"> </span><span class="n">avg_latency</span><span class="o">=</span><span class="mf">19.490</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="p">(</span><span class="n">over</span><span class="w"> </span><span class="mi">12169</span><span class="w"> </span><span class="n">calls</span><span class="p">)</span>
</code></pre></div>
<p>After change</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">producer</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="n">consumed</span><span class="p">):</span><span class="w"> </span><span class="mf">3731.03</span><span class="w"> </span><span class="n">MiB</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mf">124.36</span><span class="w"> </span><span class="n">MiB</span><span class="o">/</span><span class="n">s</span>
<span class="n">guest</span><span class="p">:</span><span class="w"> </span><span class="nc">bytes_in</span><span class="o">=</span><span class="mf">3728.28</span><span class="w"> </span><span class="n">MiB</span><span class="p">,</span><span class="w"> </span><span class="n">avg_latency</span><span class="o">=</span><span class="mf">13.473</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="p">(</span><span class="n">over</span><span class="w"> </span><span class="mi">16252</span><span class="w"> </span><span class="n">calls</span><span class="p">)</span>
</code></pre></div>
<p>I'm not sure if my approach is the right one, but happy to go through several iterations or let Alex handle it.<br>
</p>
</blockquote>



<a name="553703186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553703186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553703186">(Nov 04 2025 at 20:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11979#pullrequestreview-3418460099">PR review</a>:</p>
<blockquote>
<p>Thanks for the PR! This is something though where I'd prefer to not add extra unsafe abstractions if we can. I haven't studied this too too much yet but I'll try to spend some time in the near future looking at the call graphs here and see if I can't figure out a way to plumb a borrow around that'd help out</p>
</blockquote>



<a name="553718897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553718897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553718897">(Nov 04 2025 at 21:19)</a>:</h4>
<p>EthanBlackburn closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>.</p>



<a name="553718899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553718899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553718899">(Nov 04 2025 at 21:19)</a>:</h4>
<p>EthanBlackburn <a href="https://github.com/bytecodealliance/wasmtime/pull/11979#issuecomment-3488052202">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>:</p>
<blockquote>
<p>Makes sense. I took a look at plumbing a borrow, but seems like I'd have to change several layers in the callstack I'm not familiar with, and my change would require several review turnarounds. Will leave it to you</p>
<p>Thanks again</p>
</blockquote>



<a name="553718929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311979%20Component%20types%20caching/near/553718929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311979.20Component.20types.20caching.html#553718929">(Nov 04 2025 at 21:19)</a>:</h4>
<p>EthanBlackburn edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11979#issuecomment-3488052202">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11979">PR #11979</a>:</p>
<blockquote>
<p>Makes sense. I took a look at plumbing a borrow, but seems like I'd have to change several layers in the callstack I'm not familiar with, and my change would require several review turnarounds. Will leave it to you</p>
<p>Thanks again for taking a look!</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>