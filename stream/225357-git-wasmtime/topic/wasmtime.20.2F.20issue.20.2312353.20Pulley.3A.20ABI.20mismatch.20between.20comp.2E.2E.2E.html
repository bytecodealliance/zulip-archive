<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12353 Pulley: ABI mismatch between comp... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html">wasmtime / issue #12353 Pulley: ABI mismatch between comp...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="568105052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568105052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568105052">(Jan 15 2026 at 00:32)</a>:</h4>
<p>zzjas opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>While looking at Pulley, we found a potential ABI issues but it's not trivial to test with the exisitng testing infrastructure so I'm opening this issue to see if it should be fixed and/or tested. Happy to submit a PR! Thanks!</p>
<h1>Mismatch between compiler and interpreter</h1>
<p>Compiler doesn't use <code>x15</code> for argument,<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70</a></p>
<p>the <code>call_end</code> in interpreter was updated to correctly follow this<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178</a></p>
<p>but <code>call_start</code> is still using x15<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114</a></p>
<p>Probably this is just a subtle oversight that is very easy to fix, but I'm not sure how to properly test it (or if it needs a test at all).</p>
<p>For now I have a lengthy Rust test that compiles a piece of clif code to Pulley, invokes <code>VM::call</code>, and check the result.</p>
<hr>
<p>Another question about Pulley: we also noticed that the <code>compute_arg_locs</code> for Pulley will split a single i128 argument across a register and the stack when only one register is available. I didn't find any document about this so just want to ask if this is the intended behavior.</p>
<p>Thanks for looking into this!</p>
</blockquote>



<a name="568105053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568105053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568105053">(Jan 15 2026 at 00:32)</a>:</h4>
<p><a href="https://github.com/zzjas">zzjas</a> added the cranelift label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">Issue #12353</a>.</p>



<a name="568105054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568105054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568105054">(Jan 15 2026 at 00:32)</a>:</h4>
<p><a href="https://github.com/zzjas">zzjas</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">Issue #12353</a>.</p>



<a name="568105088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568105088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568105088">(Jan 15 2026 at 00:33)</a>:</h4>
<p>zzjas edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>While looking at Pulley, we found a potential ABI issue but it's not trivial to test with the exisitng testing infrastructure so I'm opening this issue to see if it should be fixed and/or tested. Happy to submit a PR! Thanks!</p>
<h1>Mismatch between compiler and interpreter</h1>
<p>Compiler doesn't use <code>x15</code> for argument,<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70</a></p>
<p>the <code>call_end</code> in interpreter was updated to correctly follow this<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178</a></p>
<p>but <code>call_start</code> is still using x15<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114</a></p>
<p>Probably this is just a subtle oversight that is very easy to fix, but I'm not sure how to properly test it (or if it needs a test at all).</p>
<p>For now I have a lengthy Rust test that compiles a piece of clif code to Pulley, invokes <code>VM::call</code>, and check the result.</p>
<hr>
<p>Another question about Pulley: we also noticed that the <code>compute_arg_locs</code> for Pulley will split a single i128 argument across a register and the stack when only one register is available. I didn't find any document about this so just want to ask if this is the intended behavior.</p>
<p>Thanks for looking into this!</p>
</blockquote>



<a name="568105119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568105119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568105119">(Jan 15 2026 at 00:33)</a>:</h4>
<p>zzjas edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>While looking at Pulley, we found a potential ABI issue but it's not trivial to test with the exisitng testing infrastructure so I'm opening this issue to see if it should be fixed and/or tested. Happy to submit a PR! Thanks!</p>
<h3>Mismatch between compiler and interpreter</h3>
<p>Compiler doesn't use <code>x15</code> for argument,<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70</a></p>
<p>the <code>call_end</code> in interpreter was updated to correctly follow this<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178</a></p>
<p>but <code>call_start</code> is still using x15<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114</a></p>
<p>Probably this is just a subtle oversight that is very easy to fix, but I'm not sure how to properly test it (or if it needs a test at all).</p>
<p>For now I have a lengthy Rust test that compiles a piece of clif code to Pulley, invokes <code>VM::call</code>, and check the result.</p>
<hr>
<p>Another question about Pulley: we also noticed that the <code>compute_arg_locs</code> for Pulley will split a single i128 argument across a register and the stack when only one register is available. I didn't find any document about this so just want to ask if this is the intended behavior.</p>
<p>Thanks for looking into this!</p>
</blockquote>



<a name="568124338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568124338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568124338">(Jan 15 2026 at 04:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12353#issuecomment-3752868807">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>Ah yeah this is a mistake that's fine to fix. I don't believe this is surfaceable via wasm itself because <code>call_{start,end}</code> is only used with a single type signature (our entry trampoline) which doesn't have 16+ arguments. Regardless though still good to fix for future use of pulley!</p>
<p>For i128 I think we're probably inheriting whatever native platforms do in that regard, but tweaking that to fix any issues arising is also totally ok as it's not used in the <code>call_{start,end}</code> path either</p>
</blockquote>



<a name="568276148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568276148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568276148">(Jan 15 2026 at 17:37)</a>:</h4>
<p>zzjas <a href="https://github.com/bytecodealliance/wasmtime/issues/12353#issuecomment-3756077407">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<blockquote>
<p>Ah yeah this is a mistake that's fine to fix.</p>
</blockquote>
<p>Created a PR for the first fix.</p>
<blockquote>
<p>For i128 I think we're probably inheriting whatever native platforms do in that regard, but tweaking that to fix any issues arising is also totally ok as it's not used in the call_{start,end} path either</p>
</blockquote>
<p>I think right now there's no issue to fix since it's self consistent. From my brief checking, X64 and aarch64 doesn't split i128 but RISC-V splits so either way is fine as long as it's well defined &amp; documented for Pulley (when args on stack is actually implemented for VM::call).</p>
</blockquote>



<a name="568276187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568276187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568276187">(Jan 15 2026 at 17:37)</a>:</h4>
<p>zzjas edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12353#issuecomment-3756077407">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>Thanks for looking into this!</p>
<blockquote>
<p>Ah yeah this is a mistake that's fine to fix.</p>
</blockquote>
<p>Created a PR for the first fix.</p>
<blockquote>
<p>For i128 I think we're probably inheriting whatever native platforms do in that regard, but tweaking that to fix any issues arising is also totally ok as it's not used in the call_{start,end} path either</p>
</blockquote>
<p>I think right now there's no issue to fix since it's self consistent. From my brief checking, X64 and aarch64 doesn't split i128 but RISC-V splits so either way is fine as long as it's well defined &amp; documented for Pulley (when args on stack is actually implemented for VM::call).</p>
</blockquote>



<a name="568319420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568319420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568319420">(Jan 15 2026 at 22:06)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>While looking at Pulley, we found a potential ABI issue but it's not trivial to test with the exisitng testing infrastructure so I'm opening this issue to see if it should be fixed and/or tested. Happy to submit a PR! Thanks!</p>
<h3>Mismatch between compiler and interpreter</h3>
<p>Compiler doesn't use <code>x15</code> for argument,<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/cranelift/codegen/src/isa/pulley_shared/abi.rs#L61-L70</a></p>
<p>the <code>call_end</code> in interpreter was updated to correctly follow this<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L169-L178</a></p>
<p>but <code>call_start</code> is still using x15<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114">https://github.com/bytecodealliance/wasmtime/blob/b856261dde3ea2624511fe4f48c3ed0790ddaa61/pulley/src/interp.rs#L110-L114</a></p>
<p>Probably this is just a subtle oversight that is very easy to fix, but I'm not sure how to properly test it (or if it needs a test at all).</p>
<p>For now I have a lengthy Rust test that compiles a piece of clif code to Pulley, invokes <code>VM::call</code>, and check the result.</p>
<hr>
<p>Another question about Pulley: we also noticed that the <code>compute_arg_locs</code> for Pulley will split a single i128 argument across a register and the stack when only one register is available. I didn't find any document about this so just want to ask if this is the intended behavior.</p>
<p>Thanks for looking into this!</p>
</blockquote>



<a name="568322239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312353%20Pulley%3A%20ABI%20mismatch%20between%20comp.../near/568322239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312353.20Pulley.3A.20ABI.20mismatch.20between.20comp.2E.2E.2E.html#568322239">(Jan 15 2026 at 22:26)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12353#issuecomment-3757192869">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12353">issue #12353</a>:</p>
<blockquote>
<p>I suspect that's a result of Pulley starting out by copying much of the riscv64 code, so makes sense in that regard at least. It should be fine to tweak as necesary though if needed</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>