<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10564 [DI] Wrong live range for a varia... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310564.20.5BDI.5D.20Wrong.20live.20range.20for.20a.20varia.2E.2E.2E.html">wasmtime / issue #10564 [DI] Wrong live range for a varia...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="511508304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310564%20%5BDI%5D%20Wrong%20live%20range%20for%20a%20varia.../near/511508304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310564.20.5BDI.5D.20Wrong.20live.20range.20for.20a.20varia.2E.2E.2E.html#511508304">(Apr 10 2025 at 21:08)</a>:</h4>
<p>SingleAccretion opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10564">issue #10564</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InvalidateRegisters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-4</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-5</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-6</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-7</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-8</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r8</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">InvalidateRegisters</span><span class="p">();</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">[(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="w">    </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">clang</span><span class="w"> </span><span class="o">-</span><span class="n">O2</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"b VariableLiveRangeStartIsCorrect"</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"r"</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">s</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
</code></pre></div>
<p>Expected result: <code>b = 42</code>.<br>
Actual result:</p>
<div class="codehilite" data-code-language="Scala"><pre><span></span><code><span class="nc">Process</span><span class="w"> </span><span class="mi">65804</span><span class="w"> </span><span class="n">stopped</span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">'mai</span><span class="n">n</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">in</span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="n">#</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="mh">0x000001b883d31113</span><span class="w"> </span><span class="nc">JIT</span><span class="p">(</span><span class="mh">0x1b883f01010</span><span class="p">)</span><span class="err">`</span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">b</span><span class="o">=-</span><span class="mi">2082057552</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">17</span><span class="w">   </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">   </span><span class="mi">18</span><span class="w">   </span><span class="p">{</span>
<span class="w">   </span><span class="mi">19</span><span class="w">       </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w">       </span><span class="nc">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">   </span><span class="mi">21</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="mi">22</span><span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="mi">23</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
<span class="p">(</span><span class="nc">WasmtimeVMContext</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">__vmctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000001b883e652b0</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2082057552</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">no</span><span class="w"> </span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">out</span><span class="o">&gt;</span>
</code></pre></div>
<p>Cause: confusion over what the live range endpoints represent. See more notes <a href="https://github.com/bytecodealliance/wasmtime/issues/9716">https://github.com/bytecodealliance/wasmtime/issues/9716</a>.</p>
</blockquote>



<a name="511508682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310564%20%5BDI%5D%20Wrong%20live%20range%20for%20a%20varia.../near/511508682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310564.20.5BDI.5D.20Wrong.20live.20range.20for.20a.20varia.2E.2E.2E.html#511508682">(Apr 10 2025 at 21:10)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10564">issue #10564</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InvalidateRegisters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-4</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-5</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-6</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-7</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-8</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r8</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">InvalidateRegisters</span><span class="p">();</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">[(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="w">    </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">clang</span><span class="w"> </span><span class="o">-</span><span class="n">O2</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"b VariableLiveRangeStartIsCorrect"</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"r"</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">s</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
</code></pre></div>
<p>Expected result: <code>b = 42</code>.<br>
Actual result:</p>
<div class="codehilite" data-code-language="Scala"><pre><span></span><code><span class="nc">Process</span><span class="w"> </span><span class="mi">65804</span><span class="w"> </span><span class="n">stopped</span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">'mai</span><span class="n">n</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">in</span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="n">#</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="mh">0x000001b883d31113</span><span class="w"> </span><span class="nc">JIT</span><span class="p">(</span><span class="mh">0x1b883f01010</span><span class="p">)</span><span class="err">`</span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">b</span><span class="o">=-</span><span class="mi">2082057552</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">17</span><span class="w">   </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">   </span><span class="mi">18</span><span class="w">   </span><span class="p">{</span>
<span class="w">   </span><span class="mi">19</span><span class="w">       </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w">       </span><span class="nc">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">   </span><span class="mi">21</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="mi">22</span><span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="mi">23</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
<span class="p">(</span><span class="nc">WasmtimeVMContext</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">__vmctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000001b883e652b0</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2082057552</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">no</span><span class="w"> </span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">out</span><span class="o">&gt;</span>
</code></pre></div>
<p>Cause: confusion over what the live range endpoints represent. See more notes <a href="https://github.com/bytecodealliance/wasmtime/issues/9716">https://github.com/bytecodealliance/wasmtime/issues/9716</a>.</p>
<p>Excerpt from the trace log:</p>
<p><div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="err">|</span><span class="nf">BB</span><span class="err">|</span><span class="no">Inst</span><span class="w">   </span><span class="err">|</span><span class="no">IP</span><span class="w"> </span><span class="err">|</span><span class="no">VL0</span><span class="w">     </span><span class="err">|</span><span class="no">VL4294967294</span><span class="err">|</span>
<span class="err">|--|-------|---|--------|------------|</span>
<span class="err">|</span><span class="nf">B0</span><span class="err">|</span><span class="no">Inst</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">|</span><span class="mi">33</span><span class="w"> </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">|</span><span class="mi">36</span><span class="w"> </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">|</span><span class="mi">51</span><span class="w"> </span><span class="err">|</span><span class="no">v194</span><span class="err">|</span><span class="no">p6i</span><span class="err">|</span><span class="no">v192</span><span class="err">|</span><span class="no">p7i</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="c1">; NoInlineSideEffect_1(t, b)</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">|</span><span class="mi">56</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="nf">B1</span><span class="err">|</span><span class="no">Inst</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">|</span><span class="mi">56</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">|</span><span class="mi">58</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="err">|</span><span class="mi">58</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>

<span class="nl">block0:</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="w"> </span><span class="nv">%rsi</span>
<span class="w">  </span><span class="nf">andl</span><span class="w"> </span><span class="no">$0x1af</span><span class="p">,</span><span class="w"> </span><span class="nv">%edx</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="w"> </span><span class="nv">%rcx</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rdi</span><span class="p">,</span><span class="w"> </span><span class="nv">%r13</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%r13</span><span class="p">,</span><span class="w"> </span><span class="nv">%rsi</span>
<span class="w">  </span><span class="nf">call</span><span class="w">    </span><span class="no">User</span><span class="p">(</span><span class="no">userextname0</span><span class="p">)</span><span class="w"> </span><span class="c1">; NoInlineSideEffect_1(t, b)</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w">     </span><span class="no">label1</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="511508753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310564%20%5BDI%5D%20Wrong%20live%20range%20for%20a%20varia.../near/511508753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310564.20.5BDI.5D.20Wrong.20live.20range.20for.20a.20varia.2E.2E.2E.html#511508753">(Apr 10 2025 at 21:11)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10564">issue #10564</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InvalidateRegisters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-4</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-5</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-6</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-7</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-8</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r8</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">InvalidateRegisters</span><span class="p">();</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">[(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="w">    </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">clang</span><span class="w"> </span><span class="o">-</span><span class="n">O2</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"b VariableLiveRangeStartIsCorrect"</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"r"</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">s</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
</code></pre></div>
<p>Expected result: <code>b = 42</code>.<br>
Actual result:</p>
<div class="codehilite" data-code-language="Scala"><pre><span></span><code><span class="nc">Process</span><span class="w"> </span><span class="mi">65804</span><span class="w"> </span><span class="n">stopped</span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">'mai</span><span class="n">n</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">in</span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="n">#</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="mh">0x000001b883d31113</span><span class="w"> </span><span class="nc">JIT</span><span class="p">(</span><span class="mh">0x1b883f01010</span><span class="p">)</span><span class="err">`</span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">b</span><span class="o">=-</span><span class="mi">2082057552</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">17</span><span class="w">   </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">   </span><span class="mi">18</span><span class="w">   </span><span class="p">{</span>
<span class="w">   </span><span class="mi">19</span><span class="w">       </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w">       </span><span class="nc">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">   </span><span class="mi">21</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="mi">22</span><span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="mi">23</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
<span class="p">(</span><span class="nc">WasmtimeVMContext</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">__vmctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000001b883e652b0</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2082057552</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">no</span><span class="w"> </span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">out</span><span class="o">&gt;</span>
</code></pre></div>
<p>Cause: confusion over what the live range endpoints represent. See more notes <a href="https://github.com/bytecodealliance/wasmtime/issues/9716">https://github.com/bytecodealliance/wasmtime/issues/9716</a>.</p>
<p>Excerpt from the trace log:</p>
<p><div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="err">|</span><span class="nf">BB</span><span class="err">|</span><span class="no">Inst</span><span class="w">   </span><span class="err">|</span><span class="no">IP</span><span class="w"> </span><span class="err">|</span><span class="no">VL0</span><span class="w">     </span><span class="err">|</span><span class="no">VL4294967294</span><span class="err">|</span>
<span class="err">|--|-------|---|--------|------------|</span>
<span class="err">|</span><span class="nf">B0</span><span class="err">|</span><span class="no">Inst</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">|</span><span class="mi">33</span><span class="w"> </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">|</span><span class="mi">36</span><span class="w"> </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">|</span><span class="mi">51</span><span class="w"> </span><span class="err">|</span><span class="no">v194</span><span class="err">|</span><span class="no">p6i</span><span class="err">|</span><span class="no">v192</span><span class="err">|</span><span class="no">p7i</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="c1">; NoInlineSideEffect_1(t, b)</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">|</span><span class="mi">56</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="nf">B1</span><span class="err">|</span><span class="no">Inst</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">|</span><span class="mi">56</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">|</span><span class="mi">58</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="err">|</span><span class="mi">58</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>

<span class="nl">block0:</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="w"> </span><span class="nv">%rsi</span>
<span class="w">  </span><span class="nf">andl</span><span class="w"> </span><span class="no">$0x1af</span><span class="p">,</span><span class="w"> </span><span class="nv">%edx</span><span class="w"> </span><span class="c1">; Invalidates the value of p6i</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="w"> </span><span class="nv">%rcx</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rdi</span><span class="p">,</span><span class="w"> </span><span class="nv">%r13</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%r13</span><span class="p">,</span><span class="w"> </span><span class="nv">%rsi</span>
<span class="w">  </span><span class="nf">call</span><span class="w">    </span><span class="no">User</span><span class="p">(</span><span class="no">userextname0</span><span class="p">)</span><span class="w"> </span><span class="c1">; NoInlineSideEffect_1(t, b)</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w">     </span><span class="no">label1</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="512414907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310564%20%5BDI%5D%20Wrong%20live%20range%20for%20a%20varia.../near/512414907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310564.20.5BDI.5D.20Wrong.20live.20range.20for.20a.20varia.2E.2E.2E.html#512414907">(Apr 15 2025 at 21:16)</a>:</h4>
<p>SingleAccretion closed <a href="https://github.com/bytecodealliance/wasmtime/issues/10564">issue #10564</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InvalidateRegisters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-4</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-5</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-6</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-7</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-8</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r8</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">InvalidateRegisters</span><span class="p">();</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">[(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="w">    </span><span class="n">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">clang</span><span class="w"> </span><span class="o">-</span><span class="n">O2</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"b VariableLiveRangeStartIsCorrect"</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="s">"r"</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">s</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
</code></pre></div>
<p>Expected result: <code>b = 42</code>.<br>
Actual result:</p>
<div class="codehilite" data-code-language="Scala"><pre><span></span><code><span class="nc">Process</span><span class="w"> </span><span class="mi">65804</span><span class="w"> </span><span class="n">stopped</span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">'mai</span><span class="n">n</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">in</span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="n">#</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="mh">0x000001b883d31113</span><span class="w"> </span><span class="nc">JIT</span><span class="p">(</span><span class="mh">0x1b883f01010</span><span class="p">)</span><span class="err">`</span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">b</span><span class="o">=-</span><span class="mi">2082057552</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">17</span><span class="w">   </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="nc">VariableLiveRangeStartIsCorrect</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">   </span><span class="mi">18</span><span class="w">   </span><span class="p">{</span>
<span class="w">   </span><span class="mi">19</span><span class="w">       </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">&amp;</span><span class="w"> </span><span class="mi">431</span><span class="p">;</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w">       </span><span class="nc">NoInlineSideEffect_1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">   </span><span class="mi">21</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="mi">22</span><span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="mi">23</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">v</span>
<span class="p">(</span><span class="nc">WasmtimeVMContext</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">__vmctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000001b883e652b0</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2082057552</span>
<span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">no</span><span class="w"> </span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">out</span><span class="o">&gt;</span>
</code></pre></div>
<p>Cause: confusion over what the live range endpoints represent. See more notes <a href="https://github.com/bytecodealliance/wasmtime/issues/9716">https://github.com/bytecodealliance/wasmtime/issues/9716</a>.</p>
<p>Excerpt from the trace log:</p>
<p><div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="err">|</span><span class="nf">BB</span><span class="err">|</span><span class="no">Inst</span><span class="w">   </span><span class="err">|</span><span class="no">IP</span><span class="w"> </span><span class="err">|</span><span class="no">VL0</span><span class="w">     </span><span class="err">|</span><span class="no">VL4294967294</span><span class="err">|</span>
<span class="err">|--|-------|---|--------|------------|</span>
<span class="err">|</span><span class="nf">B0</span><span class="err">|</span><span class="no">Inst</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">|</span><span class="mi">33</span><span class="w"> </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">|</span><span class="mi">36</span><span class="w"> </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="w">    </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">|</span><span class="mi">51</span><span class="w"> </span><span class="err">|</span><span class="no">v194</span><span class="err">|</span><span class="no">p6i</span><span class="err">|</span><span class="no">v192</span><span class="err">|</span><span class="no">p7i</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="c1">; NoInlineSideEffect_1(t, b)</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">|</span><span class="mi">56</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="nf">B1</span><span class="err">|</span><span class="no">Inst</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">|</span><span class="mi">56</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">|</span><span class="mi">58</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="no">p13i</span><span class="w">   </span><span class="err">|</span>
<span class="err">|</span><span class="w">  </span><span class="err">|</span><span class="nf">Inst</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="err">|</span><span class="mi">58</span><span class="w"> </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">   </span><span class="err">|</span><span class="p">*</span><span class="w">   </span><span class="err">|</span><span class="w">       </span><span class="err">|</span>

<span class="nl">block0:</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="w"> </span><span class="nv">%rsi</span>
<span class="w">  </span><span class="nf">andl</span><span class="w"> </span><span class="no">$0x1af</span><span class="p">,</span><span class="w"> </span><span class="nv">%edx</span><span class="w"> </span><span class="c1">; Invalidates the value of p6i</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="w"> </span><span class="nv">%rcx</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%rdi</span><span class="p">,</span><span class="w"> </span><span class="nv">%r13</span>
<span class="w">  </span><span class="nf">movq</span><span class="w">    </span><span class="nv">%r13</span><span class="p">,</span><span class="w"> </span><span class="nv">%rsi</span>
<span class="w">  </span><span class="nf">call</span><span class="w">    </span><span class="no">User</span><span class="p">(</span><span class="no">userextname0</span><span class="p">)</span><span class="w"> </span><span class="c1">; NoInlineSideEffect_1(t, b)</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w">     </span><span class="no">label1</span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>