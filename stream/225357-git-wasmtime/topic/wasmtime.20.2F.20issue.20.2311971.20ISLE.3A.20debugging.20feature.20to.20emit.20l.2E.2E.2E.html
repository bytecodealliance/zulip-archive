<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11971 ISLE: debugging feature to emit l... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html">wasmtime / issue #11971 ISLE: debugging feature to emit l...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="553435026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/553435026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#553435026">(Nov 03 2025 at 17:04)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<p>To assist with debugging ISLE (e.g. you expect a rule to match but it doesn't), the <code>isle</code> crate should have an option to emit <code>log</code> macro invocations in the generated code.</p>
<p>I'm imagining we would emit the following logs, or something similar:</p>
<ul>
<li>
<p><code>log::debug!(...)</code> at the start of a constructor, logging which constructor we are executing. (Ideally, we would also log the arguments given, but that would require that we know that the arguments implement <code>Debug</code>, which I don't think we do? Failing that, if we wanted to get real fancy, we could do the thing where you approximate specialization by making impls for <code>&amp;T</code>, <code>&amp;&amp;T</code>, etc...)</p>
</li>
<li>
<p>Each predicate we test as part of a term's rules' LHSes would have an associated <code>log::trace!(...)</code> that details which predicate is executing and then whether it matched or not.</p>
</li>
<li>
<p>In each rule's RHS we would <code>log::debug!(...)</code> which rule we end up executing.</p>
</li>
<li>
<p>Possibly, if none of a term's rules match, we log that fact as well. Not sure if we have erased this information by the time we emit code or not though, so it might not be possible.</p>
</li>
</ul>
<p>To make this even more readable when debugging, it would be nice if we kept a thread-local or something containing the ISLE stack depth and indented our logs by that amount, so that you could see which constructor invocations were nested within others.</p>
</blockquote>



<a name="553435028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/553435028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#553435028">(Nov 03 2025 at 17:04)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the isle label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">Issue #11971</a>.</p>



<a name="553435196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/553435196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#553435196">(Nov 03 2025 at 17:05)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/11971#issuecomment-3481592164">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="553435769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/553435769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#553435769">(Nov 03 2025 at 17:08)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/11971#issuecomment-3481605059">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<p>Thanks for writing this up! I agree we should do this; also it might be a good first issue (I'll add the tag). One particular thought on</p>
<blockquote>
<p>but that would require that we know that the arguments implement Debug, which I don't think we do?</p>
</blockquote>
<p>I don't see a problem with adding this requirement if we don't have it yet; we control the main/only user of ISLE, the set of types that flow across the Rust/ISLE boundary are fairly small, are mostly little newtype wrappers, and even the big ones (<code>BoxCallInfo</code> as a <code>Box</code> of <code>CallInfo</code> returned from a helper) should be printable.</p>
</blockquote>



<a name="553435813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/553435813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#553435813">(Nov 03 2025 at 17:08)</a>:</h4>
<p><a href="https://github.com/cfallin">cfallin</a> added the good first issue label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">Issue #11971</a>.</p>



<a name="553462330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/553462330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#553462330">(Nov 03 2025 at 19:13)</a>:</h4>
<p>fitzgen edited <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<p>To assist with debugging ISLE (e.g. you expect a rule to match but it doesn't), the <code>isle</code> crate should have an option to emit <code>log</code> macro invocations in the generated code.</p>
<p>I'm imagining we would emit the following logs, or something similar:</p>
<ul>
<li>
<p><code>log::debug!(...)</code> at the start of a constructor, logging which constructor we are executing. (Ideally, we would also log the arguments given, but that would require that we know that the arguments implement <code>Debug</code>, which I don't think we do? Failing that, if we wanted to get real fancy, we could do the thing where you approximate specialization by making impls for <code>&amp;T</code>, <code>&amp;&amp;T</code>, etc...)</p>
</li>
<li>
<p>Each predicate we test as part of a term's rules' LHSes would have an associated <code>log::trace!(...)</code> that details which predicate is executing and then whether it matched or not.</p>
</li>
<li>
<p>In each rule's RHS we would <code>log::debug!(...)</code> which rule we end up executing.</p>
</li>
<li>
<p>Possibly, if none of a term's rules match, we log that fact as well. Not sure if we have erased this information by the time we emit code or not though, so it might not be possible.</p>
</li>
</ul>
<p>To make this even more readable when debugging, it would be nice if we kept a thread-local or something containing the ISLE stack depth and indented our logs by that amount, so that you could see which constructor invocations were nested within others.</p>
<p>Anyways, once we had this knob in the ISLE compiler, we should add a cargo feature to <code>cranelift-codegen</code> which enables/disables it. (Or maybe we just reuse the existing <code>trace-log</code> feature?)</p>
</blockquote>



<a name="554150812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/554150812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#554150812">(Nov 06 2025 at 17:32)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the cranelift:E-compiler-easy label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">Issue #11971</a>.</p>



<a name="554475330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/554475330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#554475330">(Nov 08 2025 at 11:27)</a>:</h4>
<p>bahbah94 <a href="https://github.com/bytecodealliance/wasmtime/issues/11971#issuecomment-3506464914">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<p>I can have a crack at this issue, will be going through the source code, any particular source file that is of interest, i would be happy to look into( I'm new to cranelift or compilers in general).</p>
</blockquote>



<a name="555438300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/555438300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#555438300">(Nov 13 2025 at 19:14)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/11971#issuecomment-3529317673">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<p>@bahbah94 you'll want to look at the codegen from the ISLE-to-Rust compiler in <a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/isle/isle/src/codegen.rs">this</a> file. That generates Rust source code that is then compiled as part of the main Cranelift crate.</p>
</blockquote>



<a name="566702043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311971%20ISLE%3A%20debugging%20feature%20to%20emit%20l.../near/566702043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311971.20ISLE.3A.20debugging.20feature.20to.20emit.20l.2E.2E.2E.html#566702043">(Jan 07 2026 at 10:25)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11971">issue #11971</a>:</p>
<blockquote>
<p>To assist with debugging ISLE (e.g. you expect a rule to match but it doesn't), the <code>isle</code> crate should have an option to emit <code>log</code> macro invocations in the generated code.</p>
<p>I'm imagining we would emit the following logs, or something similar:</p>
<ul>
<li>
<p><code>log::debug!(...)</code> at the start of a constructor, logging which constructor we are executing. (Ideally, we would also log the arguments given, but that would require that we know that the arguments implement <code>Debug</code>, which I don't think we do? Failing that, if we wanted to get real fancy, we could do the thing where you approximate specialization by making impls for <code>&amp;T</code>, <code>&amp;&amp;T</code>, etc...)</p>
</li>
<li>
<p>Each predicate we test as part of a term's rules' LHSes would have an associated <code>log::trace!(...)</code> that details which predicate is executing and then whether it matched or not.</p>
</li>
<li>
<p>In each rule's RHS we would <code>log::debug!(...)</code> which rule we end up executing.</p>
</li>
<li>
<p>Possibly, if none of a term's rules match, we log that fact as well. Not sure if we have erased this information by the time we emit code or not though, so it might not be possible.</p>
</li>
</ul>
<p>To make this even more readable when debugging, it would be nice if we kept a thread-local or something containing the ISLE stack depth and indented our logs by that amount, so that you could see which constructor invocations were nested within others.</p>
<p>Anyways, once we had this knob in the ISLE compiler, we should add a cargo feature to <code>cranelift-codegen</code> which enables/disables it. (Or maybe we just reuse the existing <code>trace-log</code> feature?)</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>