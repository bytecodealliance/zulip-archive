<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11596 refactor(cranelift): merge Dominator... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html">wasmtime / PR #11596 refactor(cranelift): merge Dominator...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537506816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537506816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537506816">(Sep 03 2025 at 15:51)</a>:</h4>
<p>pnodet opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a> from <code>pnodet:pnodet-6</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR aims at merging <code>DominatorTreePreorder</code> functionality directly into <code>DominatorTree</code>, eliminating duplicate  computation and providing O(1) block dominance checks by default.</p>
<h4>Previously, Cranelift had two separate dominator tree interfaces:</h4>
<p>- <code>DominatorTree</code>: Basic dominance with O(depth) block dominance checks<br>
  - <code>DominatorTreePreorder</code>: Fast O(1) block dominance via preorder numbering</p>
<h4>Changes</h4>
<p>- Added preorder fields to <code>DominatorTreeNode</code> (child, sibling, dom_pre_number, dom_pre_max)<br>
  - Integrated preorder computation into main <code>compute()</code> method<br>
  - Replaced O(n) <code>block_dominates</code> with O(1) implementation using preorder numbers<br>
  - Added <code>children()</code> iterator for dominator tree traversal<br>
  - Removed <code>DominatorTreePreorder</code> struct entirely</p>
<p>Closes <a href="https://github.com/bytecodealliance/wasmtime/issues/7954">https://github.com/bytecodealliance/wasmtime/issues/7954</a></p>
</blockquote>



<a name="537506831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537506831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537506831">(Sep 03 2025 at 15:51)</a>:</h4>
<p><strong>pnodet</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>.</p>



<a name="537506850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537506850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537506850">(Sep 03 2025 at 15:51)</a>:</h4>
<p><strong>pnodet</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>.</p>



<a name="537523214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537523214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537523214">(Sep 03 2025 at 17:21)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>.</p>



<a name="537533015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537533015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537533015">(Sep 03 2025 at 18:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#pullrequestreview-3181902356">PR review</a>:</p>
<blockquote>
<p>Thanks very much for doing this cleanup!</p>
<p>A few comments below but nothing major...</p>
</blockquote>



<a name="537533016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537533016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537533016">(Sep 03 2025 at 18:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#discussion_r2319834061">PR review comment</a>:</p>
<blockquote>
<p>Why clone the postorder vec here? It looks like it's borrowed only while mutating other fields (<code>nodes</code>, <code>dfs_worklist</code>) below so the borrow checker should be able to understand the lack of borrow conflict...</p>
</blockquote>



<a name="537533017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537533017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537533017">(Sep 03 2025 at 18:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#discussion_r2319826602">PR review comment</a>:</p>
<blockquote>
<p>To avoid polluting the diff, could you keep this at the same point in the file? It looks like it's otherwise unmodified (modulo the type renaming).</p>
</blockquote>



<a name="537533018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537533018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537533018">(Sep 03 2025 at 18:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#discussion_r2319818950">PR review comment</a>:</p>
<blockquote>
<p>No need to use the <code>inst_block</code> method here -- <code>pred.block</code> is available (as shown a few lines below).</p>
<p>Likewise above around line 205.</p>
</blockquote>



<a name="537533019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537533019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537533019">(Sep 03 2025 at 18:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#discussion_r2319830140">PR review comment</a>:</p>
<blockquote>
<p>nit -- rustdoc format is usually a single summary line, then a blank <code>///</code> line, then the details.</p>
</blockquote>



<a name="537534471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537534471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537534471">(Sep 03 2025 at 18:38)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#pullrequestreview-3181967926">PR review</a>.</p>



<a name="537534472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537534472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537534472">(Sep 03 2025 at 18:38)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#discussion_r2319863926">PR review comment</a>:</p>
<blockquote>
<p>Indeed I may have been overly cautious there</p>
</blockquote>



<a name="537534967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537534967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537534967">(Sep 03 2025 at 18:42)</a>:</h4>
<p>pnodet updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>.</p>



<a name="537535393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537535393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537535393">(Sep 03 2025 at 18:45)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#pullrequestreview-3181988628">PR review</a>.</p>



<a name="537535394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537535394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537535394">(Sep 03 2025 at 18:45)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#discussion_r2319879014">PR review comment</a>:</p>
<blockquote>
<p>Thanks, changes are now at <a href="https://github.com/bytecodealliance/wasmtime/pull/11596/files#diff-b490f64fce5d44b4375aa866ddbb675869cb30c3044e818e6533271f409f5bc5L543">https://github.com/bytecodealliance/wasmtime/pull/11596/files#diff-b490f64fce5d44b4375aa866ddbb675869cb30c3044e818e6533271f409f5bc5L543</a> and way more readable</p>
</blockquote>



<a name="537535946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537535946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537535946">(Sep 03 2025 at 18:50)</a>:</h4>
<p>pnodet <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#issuecomment-3250378496">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>:</p>
<blockquote>
<p>@cfallin Thanks for the review, made a few changes for the things you pointed out</p>
</blockquote>



<a name="537536512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537536512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537536512">(Sep 03 2025 at 18:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11596#pullrequestreview-3182017867">PR review</a>.</p>



<a name="537536521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537536521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537536521">(Sep 03 2025 at 18:54)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>.</p>



<a name="537539935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311596%20refactor%28cranelift%29%3A%20merge%20Dominator.../near/537539935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311596.20refactor.28cranelift.29.3A.20merge.20Dominator.2E.2E.2E.html#537539935">(Sep 03 2025 at 19:18)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11596">PR #11596</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>