<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11752 `bindgen!` forgets to add `Send` ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311752.20.60bindgen.21.60.20forgets.20to.20add.20.60Send.60.20.2E.2E.2E.html">wasmtime / issue #11752 `bindgen!` forgets to add `Send` ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="541990104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311752%20%60bindgen%21%60%20forgets%20to%20add%20%60Send%60%20.../near/541990104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311752.20.60bindgen.21.60.20forgets.20to.20add.20.60Send.60.20.2E.2E.2E.html#541990104">(Sep 29 2025 at 09:50)</a>:</h4>
<p>anlavandier opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11752">issue #11752</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Wit file: </p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>package example:example;

interface api {
    foo: func();
}

world bar {
    import api;
    export baz: func();
}

world api-impl {
    import api;
}
</code></pre></div>
<p>rust code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">async_impl</span><span class="p">::</span><span class="n">MyHost</span><span class="p">;</span>

<span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"bar"</span><span class="p">,</span>
<span class="w">    </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit/example.wit"</span><span class="p">,</span>
<span class="w">    </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">"example:example/api"</span><span class="p">:</span><span class="w"> </span><span class="nc">async_impl</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">imports</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">default</span><span class="p">:</span><span class="w"> </span><span class="nc">async</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">async_impl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="p">;</span>
<span class="w">    </span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"api-impl"</span><span class="p">,</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit/example.wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">imports</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">default</span><span class="p">:</span><span class="w"> </span><span class="nc">async</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">MyHost</span><span class="p">;</span>


<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">example</span><span class="p">::</span><span class="n">example</span><span class="p">::</span><span class="n">api</span><span class="p">::{</span><span class="n">Host</span><span class="p">,</span><span class="w"> </span><span class="n">HostWithStore</span><span class="p">,</span><span class="w"> </span><span class="n">add_to_linker</span><span class="p">};</span>

<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyHost</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<h3>Expected results</h3>
<p>The above code should compile </p>
<h3>Observed results</h3>
<p>the following compile error: </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>error<span class="o">[</span>E0277<span class="o">]</span>:<span class="w"> </span><span class="sb">`</span>T<span class="sb">`</span><span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>sent<span class="w"> </span>between<span class="w"> </span>threads<span class="w"> </span>safely
<span class="w">  </span>--&gt;<span class="w"> </span>src/main.rs:3:1
<span class="w">   </span><span class="p">|</span>
<span class="m">3</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>/<span class="w"> </span>bindgen!<span class="o">({</span>
<span class="m">4</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>world:<span class="w"> </span><span class="s2">"bar"</span>,
<span class="m">5</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>path:<span class="w"> </span><span class="s2">"wit/example.wit"</span>,
<span class="m">6</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>with:<span class="w"> </span><span class="o">{</span>
...<span class="w">  </span><span class="p">|</span>
<span class="m">12</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">})</span><span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>__^<span class="w"> </span><span class="sb">`</span>T<span class="sb">`</span><span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>sent<span class="w"> </span>between<span class="w"> </span>threads<span class="w"> </span>safely
<span class="w">   </span><span class="p">|</span>
note:<span class="w"> </span>required<span class="w"> </span>by<span class="w"> </span>a<span class="w"> </span>bound<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>add_to_linker<span class="sb">`</span>
<span class="w">  </span>--&gt;<span class="w"> </span>src/main.rs:16:5
<span class="w">   </span><span class="p">|</span>
<span class="m">16</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>/<span class="w">     </span>bindgen!<span class="o">({</span>
<span class="m">17</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span>world:<span class="w"> </span><span class="s2">"api-impl"</span>,
<span class="m">18</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span>path:<span class="w"> </span><span class="s2">"wit/example.wit"</span>,
<span class="m">19</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span>imports:<span class="w"> </span><span class="o">{</span>
...<span class="w">  </span><span class="p">|</span>
<span class="m">22</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="o">})</span><span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>______^<span class="w"> </span>required<span class="w"> </span>by<span class="w"> </span>this<span class="w"> </span>bound<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>add_to_linker<span class="sb">`</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span>note:<span class="w"> </span>this<span class="w"> </span>error<span class="w"> </span>originates<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>macro<span class="w"> </span><span class="sb">`</span>bindgen<span class="sb">`</span><span class="w"> </span><span class="o">(</span><span class="k">in</span><span class="w"> </span>Nightly<span class="w"> </span>builds,<span class="w"> </span>run<span class="w"> </span>with<span class="w"> </span>-Z<span class="w"> </span>macro-backtrace<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>info<span class="o">)</span>
help:<span class="w"> </span>consider<span class="w"> </span>further<span class="w"> </span>restricting<span class="w"> </span><span class="nb">type</span><span class="w"> </span>parameter<span class="w"> </span><span class="sb">`</span>T<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>trait<span class="w"> </span><span class="sb">`</span>Send<span class="sb">`</span>
<span class="w">   </span><span class="p">|</span>
<span class="m">12</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">})</span>,<span class="w"> </span>T:<span class="w"> </span>std::marker::Send<span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w">   </span>++++++++++++++++++++++
</code></pre></div>
<p>Wasmtime version or commit: <br>
<code>wasmtime = { version ="37.0.1", default-features = false, features = ["runtime", "component-model", "async", "std"] }</code></p>
<p>Operating system: N/A</p>
<p>Architecture: N/A</p>
<h3>Extra info</h3>
<p>Adding <code>import foobar: func();</code> to the <code>bar</code> world and adding a corresponding implementation of <code>BarImports</code> for <code>MyHost</code> fixes this. </p>
<p>I believe that the bug is cause by the fact that <code>wit_bindgen::Generator::generate_add_to_linker</code> relies on the presence of an <code>async</code> <code>Host</code> trait for the target world (here <code>bar</code>). Because the world doesn't directly import anything and relies on interfaces implemented elsewhere, no <code>Host</code> trait is generated and the <code>FunctionFlags::ASYNC</code> can't be found. <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wit-bindgen/src/lib.rs#L2299-L2323">Here the relevant code</a></p>
<h3>Potential fix</h3>
<p>I imagine that a way to fix this would be to really on <code>imports: {default: async}</code> instead of the <code>Host</code> trait. This would introduce a (in my head) minor inconvenience which is that code that declares <code>imports: {default: async}</code> without actually needing it (because all of the interfaces that they import don't use <code>async</code> and they don't declare any "local" imports) will end up with an extraneous <code>Send</code> bounds but that feels like bad coding on the authors part and should not be supported imo. </p>
</blockquote>



<a name="541990105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311752%20%60bindgen%21%60%20forgets%20to%20add%20%60Send%60%20.../near/541990105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311752.20.60bindgen.21.60.20forgets.20to.20add.20.60Send.60.20.2E.2E.2E.html#541990105">(Sep 29 2025 at 09:50)</a>:</h4>
<p><a href="https://github.com/anlavandier">anlavandier</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11752">Issue #11752</a>.</p>



<a name="541996715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311752%20%60bindgen%21%60%20forgets%20to%20add%20%60Send%60%20.../near/541996715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311752.20.60bindgen.21.60.20forgets.20to.20add.20.60Send.60.20.2E.2E.2E.html#541996715">(Sep 29 2025 at 10:20)</a>:</h4>
<p>anlavandier edited <a href="https://github.com/bytecodealliance/wasmtime/issues/11752">issue #11752</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Wit file: </p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>package example:example;

interface api {
    foo: func();
}

world bar {
    import api;
    export baz: func();
}

world api-impl {
    import api;
}
</code></pre></div>
<p>rust code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">async_impl</span><span class="p">::</span><span class="n">MyHost</span><span class="p">;</span>

<span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"bar"</span><span class="p">,</span>
<span class="w">    </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit/example.wit"</span><span class="p">,</span>
<span class="w">    </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">"example:example/api"</span><span class="p">:</span><span class="w"> </span><span class="nc">async_impl</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">imports</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">default</span><span class="p">:</span><span class="w"> </span><span class="nc">async</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">async_impl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="p">;</span>
<span class="w">    </span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"api-impl"</span><span class="p">,</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit/example.wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">imports</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">default</span><span class="p">:</span><span class="w"> </span><span class="nc">async</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">MyHost</span><span class="p">;</span>


<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">example</span><span class="p">::</span><span class="n">example</span><span class="p">::</span><span class="n">api</span><span class="p">::{</span><span class="n">Host</span><span class="p">,</span><span class="w"> </span><span class="n">HostWithStore</span><span class="p">,</span><span class="w"> </span><span class="n">add_to_linker</span><span class="p">};</span>

<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyHost</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<h3>Expected results</h3>
<p>The above code should compile </p>
<h3>Observed results</h3>
<p>the following compile error: </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>error<span class="o">[</span>E0277<span class="o">]</span>:<span class="w"> </span><span class="sb">`</span>T<span class="sb">`</span><span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>sent<span class="w"> </span>between<span class="w"> </span>threads<span class="w"> </span>safely
<span class="w">  </span>--&gt;<span class="w"> </span>src/main.rs:3:1
<span class="w">   </span><span class="p">|</span>
<span class="m">3</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>/<span class="w"> </span>bindgen!<span class="o">({</span>
<span class="m">4</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>world:<span class="w"> </span><span class="s2">"bar"</span>,
<span class="m">5</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>path:<span class="w"> </span><span class="s2">"wit/example.wit"</span>,
<span class="m">6</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>with:<span class="w"> </span><span class="o">{</span>
...<span class="w">  </span><span class="p">|</span>
<span class="m">12</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">})</span><span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>__^<span class="w"> </span><span class="sb">`</span>T<span class="sb">`</span><span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>sent<span class="w"> </span>between<span class="w"> </span>threads<span class="w"> </span>safely
<span class="w">   </span><span class="p">|</span>
note:<span class="w"> </span>required<span class="w"> </span>by<span class="w"> </span>a<span class="w"> </span>bound<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>add_to_linker<span class="sb">`</span>
<span class="w">  </span>--&gt;<span class="w"> </span>src/main.rs:16:5
<span class="w">   </span><span class="p">|</span>
<span class="m">16</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>/<span class="w">     </span>bindgen!<span class="o">({</span>
<span class="m">17</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span>world:<span class="w"> </span><span class="s2">"api-impl"</span>,
<span class="m">18</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span>path:<span class="w"> </span><span class="s2">"wit/example.wit"</span>,
<span class="m">19</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span>imports:<span class="w"> </span><span class="o">{</span>
...<span class="w">  </span><span class="p">|</span>
<span class="m">22</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="o">})</span><span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>______^<span class="w"> </span>required<span class="w"> </span>by<span class="w"> </span>this<span class="w"> </span>bound<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>add_to_linker<span class="sb">`</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span>note:<span class="w"> </span>this<span class="w"> </span>error<span class="w"> </span>originates<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>macro<span class="w"> </span><span class="sb">`</span>bindgen<span class="sb">`</span><span class="w"> </span><span class="o">(</span><span class="k">in</span><span class="w"> </span>Nightly<span class="w"> </span>builds,<span class="w"> </span>run<span class="w"> </span>with<span class="w"> </span>-Z<span class="w"> </span>macro-backtrace<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>info<span class="o">)</span>
help:<span class="w"> </span>consider<span class="w"> </span>further<span class="w"> </span>restricting<span class="w"> </span><span class="nb">type</span><span class="w"> </span>parameter<span class="w"> </span><span class="sb">`</span>T<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>trait<span class="w"> </span><span class="sb">`</span>Send<span class="sb">`</span>
<span class="w">   </span><span class="p">|</span>
<span class="m">12</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">})</span>,<span class="w"> </span>T:<span class="w"> </span>std::marker::Send<span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w">   </span>++++++++++++++++++++++
</code></pre></div>
<p>Wasmtime version or commit: <br>
<code>wasmtime = { version ="37.0.1", default-features = false, features = ["runtime", "component-model", "async", "std"] }</code></p>
<p>Operating system: N/A</p>
<p>Architecture: N/A</p>
<h3>Extra info</h3>
<p>Adding <code>import foobar: func();</code> to the <code>bar</code> world and adding a corresponding implementation of <code>BarImports</code> for <code>MyHost</code> fixes this. </p>
<p><del>I believe that the bug is cause by the fact that <code>wit_bindgen::wasmtime::world_add_to_linker</code> relies on the presence of an <code>async</code> <code>Host</code> trait for the target world (here <code>bar</code>). Because the world doesn't directly import anything and relies on interfaces implemented elsewhere, no <code>Host</code> trait is generated and the <code>FunctionFlags::ASYNC</code> can't be found. <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wit-bindgen/src/lib.rs#L2299-L2323">Here the relevant code</a></del></p>
<p><strong>Edit: I should have tested my theories before writing them in the issue. I had misread the provenance of the code. I believe that my solution is still right so I'm keeping the section as is</strong></p>
<h3>Potential fix</h3>
<p>I imagine that a way to fix this would be to really on <code>imports: {default: async}</code> instead of the <code>Host</code> trait. This would introduce a (in my head) minor inconvenience which is that code that declares <code>imports: {default: async}</code> without actually needing it (because all of the interfaces that they import don't use <code>async</code> and they don't declare any "local" imports) will end up with an extraneous <code>Send</code> bounds but that feels like bad coding on the authors part and should not be supported imo.</p>
</blockquote>



<a name="542004887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311752%20%60bindgen%21%60%20forgets%20to%20add%20%60Send%60%20.../near/542004887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311752.20.60bindgen.21.60.20forgets.20to.20add.20.60Send.60.20.2E.2E.2E.html#542004887">(Sep 29 2025 at 10:59)</a>:</h4>
<p>anlavandier <a href="https://github.com/bytecodealliance/wasmtime/issues/11752#issuecomment-3346314142">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11752">issue #11752</a>:</p>
<blockquote>
<p>Interestingly, specifying the <code>async</code> import with <code>imports: { "example:example/api": async, }</code> leads to this error: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rror</span><span class="p">:</span><span class="w"> </span><span class="nc">unused</span><span class="w"> </span><span class="err">`</span><span class="n">imports</span><span class="err">`</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">found</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">"</span><span class="se">\"</span><span class="s">example:example/api</span><span class="se">\"</span><span class="s">: FunctionFlags(ASYNC)"</span><span class="p">]</span>
<span class="w">  </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">1</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">5</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="mi">6</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"bar"</span><span class="p">,</span>
<span class="mi">7</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit/example.wit"</span><span class="p">,</span>
<span class="mi">8</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="o">..</span><span class="p">.</span><span class="w">  </span><span class="o">|</span>
<span class="mi">14</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">});</span>
<span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">__</span><span class="o">^</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">bindgen</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>
</code></pre></div>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>