<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11615 wasip3: Refactor the readdir stream ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html">wasmtime / PR #11615 wasip3: Refactor the readdir stream ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537786521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537786521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537786521">(Sep 05 2025 at 03:11)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/rvolosatovs">rvolosatovs</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a>.</p>



<a name="537786523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537786523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537786523">(Sep 05 2025 at 03:11)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a> from <code>alexcrichton:wasip3-refactor-readdir-iterator</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Follow-up from <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">https://github.com/bytecodealliance/wasmtime/pull/11515</a>, part stylistic part tweaking behavior. Includes a test now too!</p>
</blockquote>



<a name="537786524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537786524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537786524">(Sep 05 2025 at 03:11)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a>.</p>



<a name="537786526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537786526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537786526">(Sep 05 2025 at 03:11)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a>.</p>



<a name="537786527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537786527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537786527">(Sep 05 2025 at 03:11)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a>.</p>



<a name="537802811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537802811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537802811">(Sep 05 2025 at 06:42)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2324239534">PR review comment</a>:</p>
<blockquote>
<p>In p2 this operation is performed in a separate thread (if runtime is configured to do so), so I assumed this may run for a while and avoided calling it from within <code>read_directory</code>. Since <code>read_directory</code> is <em>not</em> marked <code>async</code>, I think the expectation is that it should return as soon as possible, hence why IMO <code>entries()</code> should only be called <em>after</em> <code>stream.read</code>.</p>
<p>Of course, if cost of calling <code>entries</code> is negligible that does not matter. Are we sure this function will not block for long?</p>
</blockquote>



<a name="537802812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537802812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537802812">(Sep 05 2025 at 06:42)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#pullrequestreview-3188166197">PR review</a>.</p>



<a name="537802813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537802813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537802813">(Sep 05 2025 at 06:42)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2324240341">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        // Drain `self.iter`. Successful results go into `buf`. Any errors make
</code></pre></div>
</blockquote>



<a name="537802814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537802814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537802814">(Sep 05 2025 at 06:42)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2324229028">PR review comment</a>:</p>
<blockquote>
<p>Is this correct? I was under impression that a <em>stream.read</em> can be cancelled, but that does not cancel the underlying stream itself</p>
</blockquote>



<a name="537882678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537882678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537882678">(Sep 05 2025 at 14:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2325246669">PR review comment</a>:</p>
<blockquote>
<p>You're correct about the consequences, yeah, but this is within the <code>allow_blocking_current_thread</code> block, so the blocking is intentional. Given that I think this is the same as p2?</p>
</blockquote>



<a name="537882679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537882679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537882679">(Sep 05 2025 at 14:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#pullrequestreview-3189588476">PR review</a>.</p>



<a name="537882732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537882732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537882732">(Sep 05 2025 at 14:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#pullrequestreview-3189589378">PR review</a>.</p>



<a name="537882735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537882735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537882735">(Sep 05 2025 at 14:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2325247248">PR review comment</a>:</p>
<blockquote>
<p>You're right yeah, I keep confusing myself about how to handle <code>finish</code>.</p>
</blockquote>



<a name="537883191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537883191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537883191">(Sep 05 2025 at 14:25)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a>.</p>



<a name="537891428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537891428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537891428">(Sep 05 2025 at 15:06)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#pullrequestreview-3189741674">PR review</a>.</p>



<a name="537891430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537891430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537891430">(Sep 05 2025 at 15:06)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2325353129">PR review comment</a>:</p>
<blockquote>
<p>I've probably only noticed this, because I've done the exact same thing <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
</blockquote>



<a name="537891756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537891756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537891756">(Sep 05 2025 at 15:08)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#pullrequestreview-3189748524">PR review</a>.</p>



<a name="537891759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537891759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537891759">(Sep 05 2025 at 15:08)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#discussion_r2325357270">PR review comment</a>:</p>
<blockquote>
<p>Yes, you're right, looks good!</p>
</blockquote>



<a name="537891851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537891851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537891851">(Sep 05 2025 at 15:08)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11615#pullrequestreview-3189750961">PR review</a>.</p>



<a name="537896282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311615%20wasip3%3A%20Refactor%20the%20readdir%20stream%20.../near/537896282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311615.20wasip3.3A.20Refactor.20the.20readdir.20stream.20.2E.2E.2E.html#537896282">(Sep 05 2025 at 15:32)</a>:</h4>
<p>rvolosatovs merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11615">PR #11615</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>