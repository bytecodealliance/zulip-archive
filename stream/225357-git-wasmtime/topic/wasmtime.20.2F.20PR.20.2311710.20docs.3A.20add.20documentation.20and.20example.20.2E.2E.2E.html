<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11710 docs: add documentation and example ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html">wasmtime / PR #11710 docs: add documentation and example ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="540311540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540311540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540311540">(Sep 18 2025 at 20:04)</a>:</h4>
<p>maxnatamo opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a> from <code>maxnatamo:docs/add-additional-stackmap-documentation</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<ul>
<li>Adds a documentation entry for how stack maps might be used to implement a garbage collector.</li>
<li>Adds an example project which shows off how a simple garbage collector might actually be implemented. Currently only supports <code>x64</code> and <code>aarch64</code> (only tested on <code>aarch64</code> macOS). The code might be slightly overdone, but it was also copied from a side-project.</li>
</ul>
<p>This was originally <a href="#narrow/channel/217117-cranelift/topic/Guidelines.20on.20marking.20stack.20map.20entries/with/540049955">discussed on Zulip</a>.<br>
</p>
</blockquote>



<a name="540311541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540311541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540311541">(Sep 18 2025 at 20:04)</a>:</h4>
<p><strong>maxnatamo</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>.</p>



<a name="540311542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540311542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540311542">(Sep 18 2025 at 20:04)</a>:</h4>
<p><strong>maxnatamo</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>.</p>



<a name="540511063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540511063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540511063">(Sep 19 2025 at 18:10)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>.</p>



<a name="540511116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540511116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540511116">(Sep 19 2025 at 18:11)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313262245">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>cc: @fitzgen, you probably have more context here?</p>
</blockquote>



<a name="540521117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540521117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540521117">(Sep 19 2025 at 19:21)</a>:</h4>
<p>maxnatamo <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313523152">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>There seems to be an issue with getting the correct return addresses when walking the stack on x64 Linux.</p>
<p>From what I gather, it's because Rust doesn't use frame pointers the same way on some targets. It can be fixed by forcing frame pointers using <code>-Cforce-frame-pointers</code>, but I hope there is a better solution.</p>
</blockquote>



<a name="540521148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540521148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540521148">(Sep 19 2025 at 19:21)</a>:</h4>
<p>maxnatamo edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313523152">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>There seems to be an issue with getting the correct return addresses when walking the stack on x64 Linux.</p>
<p>From what I gather, it's because Rust and/or LLVM doesn't use frame pointers the same way on some targets. It can be fixed by forcing frame pointers using <code>-Cforce-frame-pointers</code>, but I hope there is a better solution.</p>
</blockquote>



<a name="540526276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540526276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540526276">(Sep 19 2025 at 20:03)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313658841">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<blockquote>
<p>There seems to be an issue with getting the correct return addresses when walking the stack on x64 Linux.</p>
<p>From what I gather, it's because Rust and/or LLVM doesn't use frame pointers the same way on some targets. It can be fixed by forcing frame pointers using <code>-Cforce-frame-pointers</code>, but I hope there is a better solution.</p>
</blockquote>
<p>I gather you're building your own runtime, but to offer parallel wisdom from Wasmtime, we know that we can only trust any invariants about the code that we ourselves generate with Cranelift; so we record entry and exit FPs for an "activation" of Wasm (call into Wasm from host, call from Wasm back out to host) and only walk the FP chain in that range. In general, when interacting with code produced by other compilers you need to follow their ABI (which in general on Linux means no frame pointers required, and using DWARF to interpret stack frames and unwind them).</p>
</blockquote>



<a name="540533619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540533619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540533619">(Sep 19 2025 at 21:06)</a>:</h4>
<p>maxnatamo <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313804460">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>Is there an "easy" solution which won't pollute the example with stack walking code? Could something like the <code>unwinder</code> crate in Wasmtime function here? I'll admit, this is outside of what I know about stack frames, unwinding, etc.</p>
</blockquote>



<a name="540537592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540537592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540537592">(Sep 19 2025 at 21:54)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3313957919">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>No, Wasmtime's unwinder has nothing to do with native stack frames; it is specific to Wasmtime's metadata format.</p>
<p>You'll probably want to do similar to Wasmtime (and Cranelift's <code>clif-util</code> test runner) and emit a trampoline that uses <code>get_frame_pointer</code> at both ends of your Cranelift frames (entry and exit), then delimit your walk by those -- this very reason is why we added that intrinsic.</p>
</blockquote>



<a name="540600143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540600143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540600143">(Sep 20 2025 at 17:23)</a>:</h4>
<p>maxnatamo updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>.</p>



<a name="540600413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/540600413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#540600413">(Sep 20 2025 at 17:28)</a>:</h4>
<p>maxnatamo <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3315127045">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>I've tried implementing something similar to what Wasmtime does, but I'm a little in over my head with this. The new implementation walks frame entries which are pushed and popped from trampolines, but the stack pointer is way off. There might be a simple solution to this, but I might've stared at this code for too long.</p>
</blockquote>



<a name="541058686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/541058686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#541058686">(Sep 23 2025 at 16:41)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3324799564">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>Hi @maxnatamo, I don't have time to help debug this example program. In general, I'd suggest simplifying as much as possible, doing nothing else but saving the FP/SP that bookend each activation, make sure that works in isolation, and then slowly add more from there, checking that things look right along the way.</p>
<p>In the meantime, adding the doc comment expansions <a href="https://github.com/bytecodealliance/wasmtime/blob/56dcd4ed0da432440c9b976e844f9e65d803f9ae/cranelift/frontend/src/frontend.rs#L537-L548">here</a> that we talked about on Zulip might be the expeditious option.</p>
</blockquote>



<a name="541326659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311710%20docs%3A%20add%20documentation%20and%20example%20.../near/541326659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311710.20docs.3A.20add.20documentation.20and.20example.20.2E.2E.2E.html#541326659">(Sep 24 2025 at 20:35)</a>:</h4>
<p>maxnatamo <a href="https://github.com/bytecodealliance/wasmtime/pull/11710#issuecomment-3330626212">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11710">PR #11710</a>:</p>
<blockquote>
<p>I can split the documentation entry and example into two separate PRs, if that helps. Then if I can't get the example working, the documentation can still be merged in. </p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>