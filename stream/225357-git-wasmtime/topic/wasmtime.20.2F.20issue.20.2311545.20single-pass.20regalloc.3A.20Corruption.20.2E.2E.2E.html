<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11545 single-pass regalloc: Corruption ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html">wasmtime / issue #11545 single-pass regalloc: Corruption ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="536301143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/536301143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#536301143">(Aug 26 2025 at 19:39)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>This currently fails on main:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Osignals</span><span class="o">-</span><span class="n">based</span><span class="o">-</span><span class="n">traps</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="o">'</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="p">:</span><span class="mi">49</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w">    </span><span class="mh">0x120</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">7</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Removing <code>-Osignals-based-traps=n</code> yields a panic:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">unwinder</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">exception_table</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">168</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span>
<span class="nc">Wasmtime</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">unwind</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">contexts</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="536301150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/536301150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#536301150">(Aug 26 2025 at 19:40)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11545#issuecomment-3225502740">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>cc <a href="https://github.com/bytecodealliance/wasmtime/pull/11533">https://github.com/bytecodealliance/wasmtime/pull/11533</a> and @d-sonuga</p>
</blockquote>



<a name="536301161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/536301161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#536301161">(Aug 26 2025 at 19:40)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">Issue #11545</a>.</p>



<a name="536301162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/536301162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#536301162">(Aug 26 2025 at 19:40)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the cranelift:area:regalloc label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">Issue #11545</a>.</p>



<a name="538033050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/538033050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#538033050">(Sep 06 2025 at 21:30)</a>:</h4>
<p>d-sonuga <a href="https://github.com/bytecodealliance/wasmtime/issues/11545#issuecomment-3263232558">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>I see that the issue happens because of the following scenario:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">branch</span><span class="w"> </span><span class="n">inst</span><span class="p">:</span><span class="w"> </span><span class="nc">def</span><span class="w"> </span><span class="n">v0</span><span class="w"> </span><span class="p">(</span><span class="n">fixed</span><span class="p">:</span><span class="w"> </span><span class="nc">p0</span><span class="p">).</span><span class="w"> </span><span class="n">succs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">block1</span><span class="p">(</span><span class="n">v0</span><span class="p">)]</span>
</code></pre></div>
<p>The single-pass relies on moving branch args (v0 in the case above) to expected spillslots of the successor blocks before branch instructions. That's not possible here because the vreg used as the branch arg is defined in the branch instruction.</p>
<p>Before I change that to account for this scenario, I need to know, can these vregs have any of the possible kinds of constraints?<br>
I mean, is it possible for v0 in the above scenario to also be an any-reg constraint, or stack-only or no constraint?<br>
</p>
</blockquote>



<a name="538259424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/538259424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#538259424">(Sep 08 2025 at 15:38)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/11545#issuecomment-3266885960">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>Ah, yes, indeed, the <code>try_call</code> defines its return values and is also a terminator. The retvals' constraints will either be fixed-reg or <code>any</code>; the latter hppens when there are more return values than the ABI puts in registers. In practice we shouldn't see <code>stack</code> or <code>reg</code>, so if it's much more work to support those on terminators too, then no need at the moment.</p>
</blockquote>



<a name="540312967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/540312967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#540312967">(Sep 18 2025 at 20:16)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>This currently fails on main:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Osignals</span><span class="o">-</span><span class="n">based</span><span class="o">-</span><span class="n">traps</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="o">'</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="p">:</span><span class="mi">49</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w">    </span><span class="mh">0x120</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">7</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Removing <code>-Osignals-based-traps=n</code> yields a panic:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">unwinder</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">exception_table</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">168</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span>
<span class="nc">Wasmtime</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">unwind</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">contexts</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="540313742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/540313742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#540313742">(Sep 18 2025 at 20:22)</a>:</h4>
<p>cfallin reopened <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>This currently fails on main:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Osignals</span><span class="o">-</span><span class="n">based</span><span class="o">-</span><span class="n">traps</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="o">'</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="p">:</span><span class="mi">49</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w">    </span><span class="mh">0x120</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">7</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Removing <code>-Osignals-based-traps=n</code> yields a panic:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">unwinder</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">exception_table</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">168</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span>
<span class="nc">Wasmtime</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">unwind</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">contexts</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="540313744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/540313744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#540313744">(Sep 18 2025 at 20:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/11545#issuecomment-3309567257">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>(I'll keep this issue open until we do a release in RA2 and pull the new version over, but thanks to Demilade for addressing the actual issue in the regalloc!)</p>
</blockquote>



<a name="540349228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311545%20single-pass%20regalloc%3A%20Corruption%20.../near/540349228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311545.20single-pass.20regalloc.3A.20Corruption.20.2E.2E.2E.html#540349228">(Sep 18 2025 at 23:42)</a>:</h4>
<p>abrown closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11545">issue #11545</a>:</p>
<blockquote>
<p>This currently fails on main:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Osignals</span><span class="o">-</span><span class="n">based</span><span class="o">-</span><span class="n">traps</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="o">'</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="p">:</span><span class="mi">49</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w">    </span><span class="mh">0x120</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">7</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>Removing <code>-Osignals-based-traps=n</code> yields a panic:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">spec_testsuite</span><span class="o">/</span><span class="n">proposals</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="n">throw</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">Oregalloc</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="n">single</span><span class="o">-</span><span class="n">pass</span><span class="w"> </span><span class="o">-</span><span class="n">Wexceptions</span><span class="o">=</span><span class="n">y</span>
<span class="o">..</span><span class="p">.</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">unwinder</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">exception_table</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">168</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span>
<span class="nc">Wasmtime</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">unwind</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">contexts</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>