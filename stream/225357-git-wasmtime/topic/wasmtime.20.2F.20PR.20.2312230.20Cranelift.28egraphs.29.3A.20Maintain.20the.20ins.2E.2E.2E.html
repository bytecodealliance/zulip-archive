<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12230 Cranelift(egraphs): Maintain the ins... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html">wasmtime / PR #12230 Cranelift(egraphs): Maintain the ins...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="565709275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/565709275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#565709275">(Dec 29 2025 at 18:39)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>.</p>



<a name="565709276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/565709276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#565709276">(Dec 29 2025 at 18:39)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a> from <code>fitzgen:inst-set-cost-function</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Fixes <a href="https://github.com/bytecodealliance/wasmtime/issues/12156">https://github.com/bytecodealliance/wasmtime/issues/12156</a></p>
</blockquote>



<a name="565709279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/565709279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#565709279">(Dec 29 2025 at 18:39)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>.</p>



<a name="565709280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/565709280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#565709280">(Dec 29 2025 at 18:39)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>.</p>



<a name="565709976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/565709976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#565709976">(Dec 29 2025 at 18:48)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>.</p>



<a name="565735799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/565735799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#565735799">(Dec 30 2025 at 01:38)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12230#issuecomment-3698010141">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>:</p>
<blockquote>
<p>Thanks for the PR! (Nick knows but for anyone else watching) I'm out on PTO then at a conference, so I'll be able to review this Mon, Jan 12 or later.</p>
</blockquote>



<a name="566113571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/566113571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#566113571">(Jan 03 2026 at 00:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12230#pullrequestreview-3624116282">PR review</a>:</p>
<blockquote>
<p>Got time today to review this actually so: LGTM and I'm really excited about this!</p>
<p>If you don't mind, could we post Sightglass results here before merging? Specifically I'd like to see <code>cycles</code> measured for compilation and execution time; hopefully we see no or few regressions (as I know you've already seen during some experimentation).</p>
</blockquote>



<a name="566429825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/566429825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#566429825">(Jan 05 2026 at 20:04)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12230#issuecomment-3711913646">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>:</p>
<blockquote>
<p>Hrm, yeah <code>cycles</code> is looking very different from <a href="https://github.com/bytecodealliance/wasmtime/issues/12156#issuecomment-3673006299">what I previously saw with <code>insts-retired</code></a>, unfortunately. Here is the default and spidermonkey suite's results, with statistically insignificant entries removed:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">38816006.88</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">4557789.09</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.22</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.28</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">173565996</span><span class="w"> </span><span class="mf">191159750.88</span><span class="w"> </span><span class="mi">226710599</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">134897941</span><span class="w"> </span><span class="mf">152343744.00</span><span class="w"> </span><span class="mi">181128243</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">pulldown</span><span class="o">-</span><span class="n">cmark</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30708277.27</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">5797934.73</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.11</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.16</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">227209069</span><span class="w"> </span><span class="mf">254002445.00</span><span class="w"> </span><span class="mi">308181456</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">194211038</span><span class="w"> </span><span class="mf">223294167.73</span><span class="w"> </span><span class="mi">282640832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">regex</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">632063507.40</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">84792443.24</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.09</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.11</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6551514230</span><span class="w"> </span><span class="mf">7032180956.90</span><span class="w"> </span><span class="mi">7890587513</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6198102237</span><span class="w"> </span><span class="mf">6400117449.50</span><span class="w"> </span><span class="mi">7008087519</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">markdown</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">628333545.93</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">98363544.32</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.08</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.11</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6494087498</span><span class="w"> </span><span class="mf">7067526581.28</span><span class="w"> </span><span class="mi">7805742475</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6158498649</span><span class="w"> </span><span class="mf">6439193035.35</span><span class="w"> </span><span class="mi">7315715259</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">json</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">562993166.38</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">115506969.41</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.07</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.10</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6486850237</span><span class="w"> </span><span class="mf">7033140774.35</span><span class="w"> </span><span class="mi">8340342367</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6044689306</span><span class="w"> </span><span class="mf">6470147607.97</span><span class="w"> </span><span class="mi">7743603904</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">json</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6534858.80</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">5891940.54</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">504126227</span><span class="w"> </span><span class="mf">528608965.58</span><span class="w"> </span><span class="mi">576654072</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">496952074</span><span class="w"> </span><span class="mf">522074106.78</span><span class="w"> </span><span class="mi">604679005</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>I guess instructions retired isn't a good proxy for wall time in this case because we are switching from pretty much an array-of-scalars representation of cost to an array-of-trees representation, which is going to involve more pointer chasing and memory latency that isn't reflected in instructions retired.</p>
<p>Pretty clear to me that this PR cannot land as-is. Might be worth some profiling to see if there is any low-hanging fruit, but if we can't just engineer our way out of this would-be regression, then it is probably best to stop pursuing the instruction-set cost function any further :-/</p>
</blockquote>



<a name="566429912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/566429912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#566429912">(Jan 05 2026 at 20:05)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/12230#issuecomment-3711913646">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>:</p>
<blockquote>
<p>Hrm, yeah <code>cycles</code> is looking very different from <a href="https://github.com/bytecodealliance/wasmtime/issues/12156#issuecomment-3673006299">what I previously saw with <code>insts-retired</code></a>, unfortunately. Here is the default and spidermonkey suites' results, with statistically insignificant entries removed:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">38816006.88</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">4557789.09</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.22</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.28</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">173565996</span><span class="w"> </span><span class="mf">191159750.88</span><span class="w"> </span><span class="mi">226710599</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">134897941</span><span class="w"> </span><span class="mf">152343744.00</span><span class="w"> </span><span class="mi">181128243</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">pulldown</span><span class="o">-</span><span class="n">cmark</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30708277.27</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">5797934.73</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.11</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.16</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">227209069</span><span class="w"> </span><span class="mf">254002445.00</span><span class="w"> </span><span class="mi">308181456</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">194211038</span><span class="w"> </span><span class="mf">223294167.73</span><span class="w"> </span><span class="mi">282640832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">regex</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">632063507.40</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">84792443.24</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.09</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.11</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6551514230</span><span class="w"> </span><span class="mf">7032180956.90</span><span class="w"> </span><span class="mi">7890587513</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6198102237</span><span class="w"> </span><span class="mf">6400117449.50</span><span class="w"> </span><span class="mi">7008087519</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">markdown</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">628333545.93</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">98363544.32</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.08</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.11</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6494087498</span><span class="w"> </span><span class="mf">7067526581.28</span><span class="w"> </span><span class="mi">7805742475</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6158498649</span><span class="w"> </span><span class="mf">6439193035.35</span><span class="w"> </span><span class="mi">7315715259</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">json</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">562993166.38</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">115506969.41</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.07</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.10</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6486850237</span><span class="w"> </span><span class="mf">7033140774.35</span><span class="w"> </span><span class="mi">8340342367</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6044689306</span><span class="w"> </span><span class="mf">6470147607.97</span><span class="w"> </span><span class="mi">7743603904</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">json</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6534858.80</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">5891940.54</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">504126227</span><span class="w"> </span><span class="mf">528608965.58</span><span class="w"> </span><span class="mi">576654072</span><span class="p">]</span><span class="w"> </span><span class="n">inst</span><span class="o">-</span><span class="n">set</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">496952074</span><span class="w"> </span><span class="mf">522074106.78</span><span class="w"> </span><span class="mi">604679005</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>I guess instructions retired isn't a good proxy for wall time in this case because we are switching from pretty much an array-of-scalars representation of cost to an array-of-trees representation, which is going to involve more pointer chasing and memory latency that isn't reflected in instructions retired.</p>
<p>Pretty clear to me that this PR cannot land as-is. Might be worth some profiling to see if there is any low-hanging fruit, but if we can't just engineer our way out of this would-be regression, then it is probably best to stop pursuing the instruction-set cost function any further :-/</p>
</blockquote>



<a name="566430044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/566430044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#566430044">(Jan 05 2026 at 20:06)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>.</p>



<a name="566539714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/566539714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#566539714">(Jan 06 2026 at 13:03)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12230#issuecomment-3714624637">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>:</p>
<blockquote>
<p>Ah, that's too bad! Very worthwhile exploration regardless...</p>
</blockquote>



<a name="566593206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/566593206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#566593206">(Jan 06 2026 at 17:48)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12230#issuecomment-3715679873">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>:</p>
<blockquote>
<p>Idea: We could potentially try to do the current scalar cost first, but bail out if we ever saturate to infinity, and only then use the instruction-set cost function. Kind of heavy-handed, but might avoid compile-time regressions.</p>
</blockquote>



<a name="569137600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312230%20Cranelift%28egraphs%29%3A%20Maintain%20the%20ins.../near/569137600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312230.20Cranelift.28egraphs.29.3A.20Maintain.20the.20ins.2E.2E.2E.html#569137600">(Jan 20 2026 at 22:16)</a>:</h4>
<p>fitzgen closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/12230">PR #12230</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>