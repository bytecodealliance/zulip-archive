<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12361 Introduce `wasmtime_environ::collect... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html">wasmtime / PR #12361 Introduce `wasmtime_environ::collect...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="568297137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568297137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568297137">(Jan 15 2026 at 19:38)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a> from <code>fitzgen:oom-arc-and-oom-box</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>These types mirror their <code>std</code>/<code>alloc</code> counterparts, but only provide fallible constructors and properly handle OOM by returning <code>Err(OutOfMemory)</code>.</p>
<p>Note that stable Rust doesn't actually give us any method to build fallible allocation for <code>Arc&lt;T&gt;</code>, and we do not wish to fork <code>Arc&lt;T&gt;</code> since it is full of very subtle unsafe code, so <code>OomArc::new</code> is only actually fallible in practice when using nightly Rust and setting <code>RUSTFLAGS="--cfg arc_try_new"</code> during the build. We use a custom <code>cfg</code>, rather than a cargo feature, so that <code>cargo test --all-features --workspace</code> (which is morally what CI does) continues to Just Work in the workspace, same as we do for e.g. Pulley's usage of the nightly Rust tail calls feature.</p>
<p>Part of <a href="https://github.com/bytecodealliance/wasmtime/issues/12069">https://github.com/bytecodealliance/wasmtime/issues/12069</a></p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="568297142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568297142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568297142">(Jan 15 2026 at 19:38)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="568297143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568297143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568297143">(Jan 15 2026 at 19:38)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="568297144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568297144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568297144">(Jan 15 2026 at 19:38)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="568297145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568297145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568297145">(Jan 15 2026 at 19:38)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="568308794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568308794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568308794">(Jan 15 2026 at 20:48)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="568316932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568316932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568316932">(Jan 15 2026 at 21:47)</a>:</h4>
<p>github-actions[bot] added the label <code>fuzzing</code> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="568316996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568316996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568316996">(Jan 15 2026 at 21:47)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#issuecomment-3757034950">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="568321492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568321492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568321492">(Jan 15 2026 at 22:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#pullrequestreview-3667874546">PR review</a>:</p>
<blockquote>
<p>WDYT abuot only having top-level functions for fallible <code>Box</code> and <code>Arc</code> allocation, maybe also with extension traits if we really want? Unlike the collections once a <code>Box</code> or <code>Arc</code> is created there's no need to have a custom wrapper to ensure that only oom-handling methods are called, so maintaining these wrappers may not be necessary if we accept that fuzzing will find <code>Box::new</code> and we know what to replace it with</p>
</blockquote>



<a name="568321665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568321665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568321665">(Jan 15 2026 at 22:22)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#pullrequestreview-3667879337">PR review</a>.</p>



<a name="568321667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568321667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568321667">(Jan 15 2026 at 22:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#discussion_r2696172998">PR review comment</a>:</p>
<blockquote>
<p>I think I'd like to push back a bit harder on this. Can you share some disassemblies or such you've been looking at to motivate this helper? I'm really worried about pessimizing the fast path due to the use of an un-inlinable-closure here</p>
</blockquote>



<a name="568511429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568511429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568511429">(Jan 16 2026 at 19:46)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#pullrequestreview-3672464553">PR review</a>.</p>



<a name="568511431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568511431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568511431">(Jan 16 2026 at 19:46)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#discussion_r2699764338">PR review comment</a>:</p>
<blockquote>
<p>IIRC, I was previously testing with <code>.context()</code> chaining.</p>
<p>I also just tested <a href="https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2024&amp;gist=cc14fbb3346135156a3443a514ea894b">this</a> which reflects the allocation case here, but I actually get identical disassemblies with and without the annotations on <code>fn out_of_line_slow_path</code>. So at minimum it seems like we can remove it here.</p>
<p>Going to revisit the context chaining in a minute.</p>
</blockquote>



<a name="568514360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568514360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568514360">(Jan 16 2026 at 20:04)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#pullrequestreview-3672521212">PR review</a>.</p>



<a name="568514400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/568514400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#568514400">(Jan 16 2026 at 20:04)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#discussion_r2699811888">PR review comment</a>:</p>
<blockquote>
<p>This program:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![crate_type = </span><span class="s">"cdylib"</span><span class="cp">]</span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">ptr</span><span class="p">::</span><span class="n">NonNull</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::{</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="nb">Result</span><span class="p">,</span><span class="w"> </span><span class="n">try_new_uninit_box</span><span class="p">};</span>

<span class="cp">#[unsafe(no_mangle)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">out_ptr</span><span class="p">:</span><span class="w"> </span><span class="nc">NonNull</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="p">:</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">uninit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">try_new_uninit_box</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">().</span><span class="n">context</span><span class="p">(</span><span class="s">"failed to allocate Box&lt;usize&gt;"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Box</span><span class="p">::</span><span class="n">write</span><span class="p">(</span><span class="n">uninit</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="w">    </span><span class="p">})();</span>
<span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">out_ptr</span><span class="p">.</span><span class="n">cast</span><span class="p">().</span><span class="n">write</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>With <code>out_of_line_slow_path</code></p>
<p>&lt;details&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="mi">0000000000007</span><span class="n">fe0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">&gt;</span><span class="p">:</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fe0</span><span class="p">:</span><span class="w">   </span><span class="mi">41</span><span class="w"> </span><span class="mi">56</span><span class="w">                   </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">r14</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fe2</span><span class="p">:</span><span class="w">   </span><span class="mi">53</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fe3</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x18</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fe7</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f3</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rbx</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fea</span><span class="p">:</span><span class="w">   </span><span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">fe</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">r14</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fed</span><span class="p">:</span><span class="w">   </span><span class="nc">bf</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="n">edi</span>
<span class="w">    </span><span class="mi">7</span><span class="n">ff2</span><span class="p">:</span><span class="w">   </span><span class="nc">ff</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">call</span><span class="w">   </span><span class="o">*</span><span class="mh">0x3df90</span><span class="p">(</span><span class="o">%</span><span class="n">rip</span><span class="p">)</span><span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="mi">45</span><span class="n">f88</span><span class="w"> </span><span class="o">&lt;</span><span class="n">malloc</span><span class="o">@</span><span class="n">GLIBC_2</span><span class="p">.</span><span class="mf">2.5</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">7</span><span class="n">ff8</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="n">c0</span><span class="w">                </span><span class="n">test</span><span class="w">   </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rax</span>
<span class="w">    </span><span class="mi">7</span><span class="n">ffb</span><span class="p">:</span><span class="w">   </span><span class="mi">74</span><span class="w"> </span><span class="mi">1</span><span class="n">b</span><span class="w">                   </span><span class="n">je</span><span class="w">     </span><span class="mi">8018</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">+</span><span class="mh">0x38</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">7</span><span class="n">ffd</span><span class="p">:</span><span class="w">   </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">    </span><span class="mi">7</span><span class="n">fff</span><span class="p">:</span><span class="w">   </span><span class="nc">f6</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">test</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">cl</span>
<span class="w">    </span><span class="mi">8002</span><span class="p">:</span><span class="w">   </span><span class="mi">75</span><span class="w"> </span><span class="mi">29</span><span class="w">                   </span><span class="n">jne</span><span class="w">    </span><span class="mi">802</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">+</span><span class="mh">0x4d</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">8004</span><span class="p">:</span><span class="w">   </span><span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">30</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r14</span><span class="p">,(</span><span class="o">%</span><span class="n">rax</span><span class="p">)</span>
<span class="w">    </span><span class="mi">8007</span><span class="p">:</span><span class="w">   </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">    </span><span class="mi">8009</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rcx</span><span class="p">,(</span><span class="o">%</span><span class="n">rbx</span><span class="p">)</span>
<span class="w">    </span><span class="mi">800</span><span class="n">c</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rbx</span><span class="p">)</span>
<span class="w">    </span><span class="mi">8010</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x18</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">    </span><span class="mi">8014</span><span class="p">:</span><span class="w">   </span><span class="mi">5</span><span class="n">b</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbx</span>
<span class="w">    </span><span class="mi">8015</span><span class="p">:</span><span class="w">   </span><span class="mi">41</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="w">                   </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">r14</span>
<span class="w">    </span><span class="mi">8017</span><span class="p">:</span><span class="w">   </span><span class="nc">c3</span><span class="w">                      </span><span class="n">ret</span>
<span class="w">    </span><span class="mi">8018</span><span class="p">:</span><span class="w">   </span><span class="nc">bf</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="n">edi</span>
<span class="w">    </span><span class="mi">801</span><span class="n">d</span><span class="p">:</span><span class="w">   </span><span class="nc">e8</span><span class="w"> </span><span class="n">ee</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">call</span><span class="w">   </span><span class="mi">7</span><span class="n">f10</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">boxed</span><span class="p">::</span><span class="n">try_alloc</span><span class="p">::</span><span class="n">out_of_line_slow_path</span><span class="p">::</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">ptr</span><span class="p">::</span><span class="n">non_null</span><span class="p">::</span><span class="n">NonNull</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">oom</span><span class="p">::</span><span class="n">OutOfMemory</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">boxed</span><span class="p">::</span><span class="n">try_alloc</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span>
<span class="w">    </span><span class="mi">8022</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">    </span><span class="mi">8025</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">d0</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdx</span><span class="p">,</span><span class="o">%</span><span class="n">rax</span>
<span class="w">    </span><span class="mi">8028</span><span class="p">:</span><span class="w">   </span><span class="nc">f6</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">test</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">cl</span>
<span class="w">    </span><span class="mi">802</span><span class="n">b</span><span class="p">:</span><span class="w">   </span><span class="mi">74</span><span class="w"> </span><span class="n">d7</span><span class="w">                   </span><span class="n">je</span><span class="w">     </span><span class="mi">8004</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">+</span><span class="mh">0x24</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">802</span><span class="n">d</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">    </span><span class="mi">8031</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">d</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="n">e0</span><span class="w"> </span><span class="mi">3</span><span class="n">a</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">lea</span><span class="w">    </span><span class="mh">0x33ae0</span><span class="p">(</span><span class="o">%</span><span class="n">rip</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span><span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="mi">3</span><span class="n">bb18</span><span class="w"> </span><span class="o">&lt;</span><span class="n">_fini</span><span class="o">+</span><span class="mh">0x23fc</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">8038</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">    </span><span class="mi">803</span><span class="n">d</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="n">c7</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">1</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">movq</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1d</span><span class="p">,</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">    </span><span class="mi">8044</span><span class="p">:</span><span class="w">   </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span>
<span class="w">    </span><span class="mi">8046</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e7</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rdi</span>
<span class="w">    </span><span class="mi">8049</span><span class="p">:</span><span class="w">   </span><span class="nc">e8</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">call</span><span class="w">   </span><span class="mi">3060</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">context</span><span class="p">::</span><span class="n">Context</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">context</span><span class="p">::</span><span class="n">out_of_line_slow_path</span><span class="p">::</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">mem</span><span class="p">::</span><span class="n">maybe_uninit</span><span class="p">::</span><span class="n">MaybeUninit</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">mem</span><span class="p">::</span><span class="n">maybe_uninit</span><span class="p">::</span><span class="n">MaybeUninit</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">oom</span><span class="p">::</span><span class="n">OutOfMemory</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">context</span><span class="p">::</span><span class="n">Context</span><span class="o">&lt;</span><span class="n">alloc</span><span class="p">::</span><span class="n">boxed</span><span class="p">::</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">mem</span><span class="p">::</span><span class="n">maybe_uninit</span><span class="p">::</span><span class="n">MaybeUninit</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_internal_error</span><span class="p">::</span><span class="n">oom</span><span class="p">::</span><span class="n">OutOfMemory</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">context</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="p">::{</span><span class="n">closure</span><span class="p">#</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;&gt;</span>
<span class="w">    </span><span class="mi">804</span><span class="n">e</span><span class="p">:</span><span class="w">   </span><span class="nc">b9</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">    </span><span class="mi">8053</span><span class="p">:</span><span class="w">   </span><span class="nc">eb</span><span class="w"> </span><span class="n">b4</span><span class="w">                   </span><span class="n">jmp</span><span class="w">    </span><span class="mi">8009</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">+</span><span class="mh">0x29</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">8055</span><span class="p">:</span><span class="w">   </span><span class="nc">e8</span><span class="w"> </span><span class="mi">09</span><span class="w"> </span><span class="n">b4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">call</span><span class="w">   </span><span class="mi">3463</span><span class="w"> </span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_cannot_unwind</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">805</span><span class="n">a</span><span class="p">:</span><span class="w">   </span><span class="mi">66</span><span class="w"> </span><span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">1</span><span class="n">f</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">nopw</span><span class="w">   </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>Without <code>out_of_line_slow_path</code>:</p>
<p>&lt;details&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="mi">0000000000001100</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">&gt;</span><span class="p">:</span>
<span class="w">    </span><span class="mi">1100</span><span class="p">:</span><span class="w">   </span><span class="mi">41</span><span class="w"> </span><span class="mi">56</span><span class="w">                   </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">r14</span>
<span class="w">    </span><span class="mi">1102</span><span class="p">:</span><span class="w">   </span><span class="mi">53</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span>
<span class="w">    </span><span class="mi">1103</span><span class="p">:</span><span class="w">   </span><span class="mi">50</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rax</span>
<span class="w">    </span><span class="mi">1104</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f3</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rbx</span>
<span class="w">    </span><span class="mi">1107</span><span class="p">:</span><span class="w">   </span><span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">fe</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">r14</span>
<span class="w">    </span><span class="mi">110</span><span class="n">a</span><span class="p">:</span><span class="w">   </span><span class="nc">bf</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="n">edi</span>
<span class="w">    </span><span class="mi">110</span><span class="n">f</span><span class="p">:</span><span class="w">   </span><span class="nc">ff</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">d3</span><span class="w"> </span><span class="mi">2</span><span class="n">e</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">call</span><span class="w">   </span><span class="o">*</span><span class="mh">0x2ed3</span><span class="p">(</span><span class="o">%</span><span class="n">rip</span><span class="p">)</span><span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="mi">3</span><span class="n">fe8</span><span class="w"> </span><span class="o">&lt;</span><span class="n">malloc</span><span class="o">@</span><span class="n">GLIBC_2</span><span class="p">.</span><span class="mf">2.5</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">1115</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="n">c0</span><span class="w">                </span><span class="n">test</span><span class="w">   </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rax</span>
<span class="w">    </span><span class="mi">1118</span><span class="p">:</span><span class="w">   </span><span class="mi">74</span><span class="w"> </span><span class="mi">07</span><span class="w">                   </span><span class="n">je</span><span class="w">     </span><span class="mi">1121</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">+</span><span class="mh">0x21</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">111</span><span class="n">a</span><span class="p">:</span><span class="w">   </span><span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">30</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r14</span><span class="p">,(</span><span class="o">%</span><span class="n">rax</span><span class="p">)</span>
<span class="w">    </span><span class="mi">111</span><span class="n">d</span><span class="p">:</span><span class="w">   </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">    </span><span class="mi">111</span><span class="n">f</span><span class="p">:</span><span class="w">   </span><span class="nc">eb</span><span class="w"> </span><span class="mi">0</span><span class="n">a</span><span class="w">                   </span><span class="n">jmp</span><span class="w">    </span><span class="mi">112</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="o">+</span><span class="mh">0x2b</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">1121</span><span class="p">:</span><span class="w">   </span><span class="nc">b9</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">    </span><span class="mi">1126</span><span class="p">:</span><span class="w">   </span><span class="nc">b8</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x11</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span>
<span class="w">    </span><span class="mi">112</span><span class="n">b</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rcx</span><span class="p">,(</span><span class="o">%</span><span class="n">rbx</span><span class="p">)</span>
<span class="w">    </span><span class="mi">112</span><span class="n">e</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rbx</span><span class="p">)</span>
<span class="w">    </span><span class="mi">1132</span><span class="p">:</span><span class="w">   </span><span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">    </span><span class="mi">1136</span><span class="p">:</span><span class="w">   </span><span class="mi">5</span><span class="n">b</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbx</span>
<span class="w">    </span><span class="mi">1137</span><span class="p">:</span><span class="w">   </span><span class="mi">41</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="w">                   </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">r14</span>
<span class="w">    </span><span class="mi">1139</span><span class="p">:</span><span class="w">   </span><span class="nc">c3</span><span class="w">                      </span><span class="n">ret</span>
<span class="w">    </span><span class="mi">113</span><span class="n">a</span><span class="p">:</span><span class="w">   </span><span class="mi">66</span><span class="w"> </span><span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">1</span><span class="n">f</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">nopw</span><span class="w">   </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>So yeah, looks like it isn't helpful here either, and if I can't consistently observes better codegen then we should definitely default to not constraining the compiler and removing this macro. I'll remove it from this PR and do another for the existing usage in <code>main</code>.</p>
</blockquote>



<a name="569119683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569119683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569119683">(Jan 20 2026 at 20:17)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#issuecomment-3774759927">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>:</p>
<blockquote>
<blockquote>
<p>WDYT abuot only having top-level functions for fallible <code>Box</code> and <code>Arc</code> allocation, maybe also with extension traits if we really want? Unlike the collections once a <code>Box</code> or <code>Arc</code> is created there's no need to have a custom wrapper to ensure that only oom-handling methods are called, so maintaining these wrappers may not be necessary if we accept that fuzzing will find <code>Box::new</code> and we know what to replace it with</p>
</blockquote>
<p>Seems fine by me. Will update in a bit.</p>
</blockquote>



<a name="569124744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569124744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569124744">(Jan 20 2026 at 20:47)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="569126100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569126100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569126100">(Jan 20 2026 at 20:56)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="569126830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569126830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569126830">(Jan 20 2026 at 21:01)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#issuecomment-3774932648">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>:</p>
<blockquote>
<p>@alexcrichton this should be ready for review again</p>
</blockquote>



<a name="569276331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569276331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569276331">(Jan 21 2026 at 14:56)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12361#pullrequestreview-3687687619">PR review</a>.</p>



<a name="569328882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569328882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569328882">(Jan 21 2026 at 18:40)</a>:</h4>
<p>fitzgen added <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361 Introduce <code>wasmtime_environ::collections::{OomArc, OomBox}</code></a> to the merge queue</p>



<a name="569333773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569333773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569333773">(Jan 21 2026 at 19:05)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361</a>.</p>



<a name="569333776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312361%20Introduce%20%60wasmtime_environ%3A%3Acollect.../near/569333776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312361.20Introduce.20.60wasmtime_environ.3A.3Acollect.2E.2E.2E.html#569333776">(Jan 21 2026 at 19:05)</a>:</h4>
<p>fitzgen removed <a href="https://github.com/bytecodealliance/wasmtime/pull/12361">PR #12361 Introduce <code>wasmtime_environ::collections::{OomArc, OomBox}</code></a> from the merge queue</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>