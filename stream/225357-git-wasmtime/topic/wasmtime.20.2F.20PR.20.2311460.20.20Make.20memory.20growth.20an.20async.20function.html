<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11460  Make memory growth an async function · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html">wasmtime / PR #11460  Make memory growth an async function</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="535189194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535189194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535189194">(Aug 19 2025 at 19:14)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/dicej">dicej</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<a name="535189195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535189195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535189195">(Aug 19 2025 at 19:14)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a> from <code>alexcrichton:memory-growth-async</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is an analog of <a href="https://github.com/bytecodealliance/wasmtime/pull/11442">https://github.com/bytecodealliance/wasmtime/pull/11442</a> but for memories. This had a little more<br>
impact due to memories being hooked into GC operations. Further<br>
refactoring of GC operations to make them safer/more-async is deferred<br>
to a future PR and for now it's "no worse than before". This is another<br>
step towards <a href="https://github.com/bytecodealliance/wasmtime/pull/11430">https://github.com/bytecodealliance/wasmtime/pull/11430</a> and enables removing a longstanding <code>unsafe</code> block<br>
in <code>runtime/memory.rs</code> which previously could not be removed.</p>
<p>One semantic change from this is that growth of a shared memory no<br>
longer uses an async limiter. This is done to keep growth of a shared<br>
memory consistent with creation of a shared memory where no limits are<br>
applied. This is due to the cross-store nature of shared memories which<br>
means that we can't tie growth to any one particular store. This<br>
additionally fixes an issue where an rwlock write guard was otherwise<br>
held across a <code>.await</code> point which creates a non-<code>Send</code> future, closing<br>
a possible soundness hole in Wasmtime.</p>
</blockquote>



<a name="535189196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535189196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535189196">(Aug 19 2025 at 19:14)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<a name="535189228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535189228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535189228">(Aug 19 2025 at 19:14)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11460#issuecomment-3201925847">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>:</p>
<blockquote>
<p>Note that the first commit here is from <a href="https://github.com/bytecodealliance/wasmtime/pull/11459">https://github.com/bytecodealliance/wasmtime/pull/11459</a></p>
</blockquote>



<a name="535189419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535189419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535189419">(Aug 19 2025 at 19:16)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<a name="535199899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535199899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535199899">(Aug 19 2025 at 20:36)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11460#issuecomment-3202147322">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>:</p>
<blockquote>
<blockquote>
<p>One semantic change from this is that growth of a shared memory no<br>
longer uses an async limiter. This is done to keep growth of a shared<br>
memory consistent with creation of a shared memory where no limits are<br>
applied. This is due to the cross-store nature of shared memories which<br>
means that we can't tie growth to any one particular store.</p>
</blockquote>
<p>Seems like we should call the async limiter of the store that is doing the growth, that way an embedder could still guarantee that all growth is limited from a holistic system point of view, even if one particular store's limiter doesn't handle all the grow calls.</p>
<p>Mind filing a follow up issue for this?</p>
</blockquote>



<a name="535200300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535200300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535200300">(Aug 19 2025 at 20:40)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11460#issuecomment-3202156569">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>:</p>
<blockquote>
<p>That's theoretically possible yeah but it's already preexisting that the resource limiter isn't used when a <code>SharedMemory</code> is created through the embedder API. There's also still the issue that the rwlock write guard can't be held across an await point which would be a much more invasive change.</p>
<p>I've added a note to <a href="https://github.com/bytecodealliance/wasmtime/issues/4245">https://github.com/bytecodealliance/wasmtime/issues/4245</a> to accompany similar issues in <a href="https://github.com/bytecodealliance/wasmtime/issues/4240">https://github.com/bytecodealliance/wasmtime/issues/4240</a> and <a href="https://github.com/bytecodealliance/wasmtime/issues/4244">https://github.com/bytecodealliance/wasmtime/issues/4244</a></p>
</blockquote>



<a name="535200606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535200606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535200606">(Aug 19 2025 at 20:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11460#pullrequestreview-3133766067">PR review</a>.</p>



<a name="535200607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535200607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535200607">(Aug 19 2025 at 20:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11460#discussion_r2286284999">PR review comment</a>:</p>
<blockquote>
<p>Mind adding a safety comment while you're here?</p>
</blockquote>



<a name="535201780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535201780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535201780">(Aug 19 2025 at 20:53)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<a name="535201791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535201791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535201791">(Aug 19 2025 at 20:53)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<a name="535204286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535204286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535204286">(Aug 19 2025 at 21:14)</a>:</h4>
<p>alexcrichton has disabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<a name="535205652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311460%20%20Make%20memory%20growth%20an%20async%20function/near/535205652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311460.20.20Make.20memory.20growth.20an.20async.20function.html#535205652">(Aug 19 2025 at 21:27)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11460">PR #11460</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>