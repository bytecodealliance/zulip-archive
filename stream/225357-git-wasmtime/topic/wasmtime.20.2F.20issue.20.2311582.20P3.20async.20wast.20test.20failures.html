<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11582 P3 async wast test failures · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html">wasmtime / issue #11582 P3 async wast test failures</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537185367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311582%20P3%20async%20wast%20test%20failures/near/537185367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html#537185367">(Sep 02 2025 at 00:00)</a>:</h4>
<p>lukewagner opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11582">issue #11582</a>:</p>
<blockquote>
<p>The following two component-model async tests fail on the current (Sept 28) <code>dev</code> release:</p>
<ol>
<li><a href="https://github.com/WebAssembly/component-model/blob/2c17516179f99accdafb01d8e4affcc0f58184cc/test/async/cancel-subtask.wast"><code>tests/async/cancel-subtask.wast</code></a></li>
</ol>
<p>The problem seems to be that the call to <code>waitable-set.wait</code> on line 51 which is defined without <code>cancellable</code> set (on line 64) returns the <code>TASK_CANCELLED</code> code (= 6) when <code>subtask.cancel</code> is called on line 144.  Instead, I believe that, since the subtask isn't cancellable, <code>subtask.cancel</code> should immediately return the <code>BLOCKED</code> code (= -1).</p>
<ol start="2">
<li><a href="https://github.com/WebAssembly/component-model/blob/2c17516179f99accdafb01d8e4affcc0f58184cc/test/async/zero-length.wast"><code>tests/async/zero-length.wast</code></a></li>
</ol>
<p>The problem seems to be that <code>$consume_cb</code> (defined on line 147) is called with <code>$event_code</code> = <code>STREAM_WRITE</code> (= 3) instead of the expected <code>STREAM_READ</code> (= 2) for the <code>stream.read</code> issued on line 139.  Additionally, the <code>$index</code> isn't <code>$insr</code> (= 2), which was passed to <code>stream.read</code>; it's <code>3</code>.  Maybe there's a mixup between the readable and writable ends here?</p>
</blockquote>



<a name="537185368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311582%20P3%20async%20wast%20test%20failures/near/537185368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html#537185368">(Sep 02 2025 at 00:00)</a>:</h4>
<p><a href="https://github.com/lukewagner">lukewagner</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11582">Issue #11582</a>.</p>



<a name="537189441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311582%20P3%20async%20wast%20test%20failures/near/537189441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html#537189441">(Sep 02 2025 at 00:47)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:component-model-async label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11582">Issue #11582</a>.</p>



<a name="537769311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311582%20P3%20async%20wast%20test%20failures/near/537769311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html#537769311">(Sep 04 2025 at 23:18)</a>:</h4>
<p>alexcrichton assigned dicej to <a href="https://github.com/bytecodealliance/wasmtime/issues/11582">issue #11582</a>.</p>



<a name="538741554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311582%20P3%20async%20wast%20test%20failures/near/538741554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html#538741554">(Sep 10 2025 at 21:32)</a>:</h4>
<p>dicej closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11582">issue #11582</a>:</p>
<blockquote>
<p>The following two component-model async tests fail on the current (Sept 28) <code>dev</code> release:</p>
<ol>
<li><a href="https://github.com/WebAssembly/component-model/blob/2c17516179f99accdafb01d8e4affcc0f58184cc/test/async/cancel-subtask.wast"><code>tests/async/cancel-subtask.wast</code></a></li>
</ol>
<p>The problem seems to be that the call to <code>waitable-set.wait</code> on line 51 which is defined without <code>cancellable</code> set (on line 64) returns the <code>TASK_CANCELLED</code> code (= 6) when <code>subtask.cancel</code> is called on line 144.  Instead, I believe that, since the subtask isn't cancellable, <code>subtask.cancel</code> should immediately return the <code>BLOCKED</code> code (= -1).</p>
<ol start="2">
<li><a href="https://github.com/WebAssembly/component-model/blob/2c17516179f99accdafb01d8e4affcc0f58184cc/test/async/zero-length.wast"><code>tests/async/zero-length.wast</code></a></li>
</ol>
<p>The problem seems to be that <code>$consume_cb</code> (defined on line 147) is called with <code>$event_code</code> = <code>STREAM_WRITE</code> (= 3) instead of the expected <code>STREAM_READ</code> (= 2) for the <code>stream.read</code> issued on line 139.  Additionally, the <code>$index</code> isn't <code>$insr</code> (= 2), which was passed to <code>stream.read</code>; it's <code>3</code>.  Maybe there's a mixup between the readable and writable ends here?</p>
</blockquote>



<a name="538741556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311582%20P3%20async%20wast%20test%20failures/near/538741556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311582.20P3.20async.20wast.20test.20failures.html#538741556">(Sep 10 2025 at 21:32)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/11582#issuecomment-3276623834">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11582">issue #11582</a>:</p>
<blockquote>
<p>The first failure is addressed by <a href="https://github.com/bytecodealliance/wasmtime/pull/11671">https://github.com/bytecodealliance/wasmtime/pull/11671</a> and the second one has apparently been fixed by some other change since this issue was opened <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>