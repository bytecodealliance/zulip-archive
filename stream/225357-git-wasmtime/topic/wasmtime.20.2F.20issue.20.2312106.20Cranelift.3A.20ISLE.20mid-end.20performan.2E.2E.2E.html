<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12106 Cranelift: ISLE mid-end performan... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html">wasmtime / issue #12106 Cranelift: ISLE mid-end performan...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="561313996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561313996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561313996">(Dec 02 2025 at 02:39)</a>:</h4>
<p>bongjunj opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I performance-tested a no-opt version of Cranelift without ISLE mid-end optimizations. (You can confirmed this at <a href="https://github.com/prosyslab/wasmtime/commit/c0df585025897098e83703cca343e139ed30a119">https://github.com/prosyslab/wasmtime/commit/c0df585025897098e83703cca343e139ed30a119</a>)</p>
<p>Compared to the latest version of upstream Cranelift, surprisingly, the no-opt version produced a significantly faster x86_64 code for blake3, keccak, xchacha20. This experiment is conducted using the sightglass-cli.</p>
<p>Given that only mid-end rules are removed, some codegen backend might causing problem interacting with the mid-end. I want to investigate this problem, but I'm completely lost which part to look at first. Any comments will be appreciated.</p>
<p>Here is the demonstration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">pin</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.08</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">sightglass</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">pin</span><span class="err">`</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">502562.18</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">4271.59</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.55</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.58</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">816778</span><span class="w"> </span><span class="mf">823363.48</span><span class="w"> </span><span class="mi">880808</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">315506</span><span class="w"> </span><span class="mf">320801.30</span><span class="w"> </span><span class="mi">460046</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">51372480.98</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">1109163.62</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.19</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.20</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">310860540</span><span class="w"> </span><span class="mf">313559414.86</span><span class="w"> </span><span class="mi">330384818</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">260245364</span><span class="w"> </span><span class="mf">262186933.88</span><span class="w"> </span><span class="mi">278160088</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">17444.42</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">10445.70</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.06</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.23</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">90902</span><span class="w"> </span><span class="mf">137381.98</span><span class="w"> </span><span class="mi">258206</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">87766</span><span class="w"> </span><span class="mf">119937.56</span><span class="w"> </span><span class="mi">198140</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>Plus, here are some data for other benchmarks.<br>
<code>--iterations-per-process 10 --benchmark-phase execution ----pin</code></p>
<table>
<thead>
<tr>
<th style="text-align: left;">bench</th>
<th style="text-align: right;">v-no-opts</th>
<th style="text-align: right;">base</th>
<th style="text-align: right;"> speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">blake3-scalar</td>
<td style="text-align: right;">320,225</td>
<td style="text-align: right;">868,750</td>
<td style="text-align: right;">-63.14%</td>
</tr>
<tr>
<td style="text-align: left;">blake3-simd</td>
<td style="text-align: right;">320,689</td>
<td style="text-align: right;">945,427</td>
<td style="text-align: right;">-66.08%</td>
</tr>
<tr>
<td style="text-align: left;">bz2</td>
<td style="text-align: right;">88,887,466</td>
<td style="text-align: right;">86,904,121</td>
<td style="text-align: right;">2.28%</td>
</tr>
<tr>
<td style="text-align: left;">pulldown-cmark</td>
<td style="text-align: right;">6,630,447</td>
<td style="text-align: right;">6,705,562</td>
<td style="text-align: right;">-1.12%</td>
</tr>
<tr>
<td style="text-align: left;">regex</td>
<td style="text-align: right;">209,902,394</td>
<td style="text-align: right;">211,477,705</td>
<td style="text-align: right;">-0.74%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-base64</td>
<td style="text-align: right;">383,700,851</td>
<td style="text-align: right;">352,817,318</td>
<td style="text-align: right;">8.75%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-keccak</td>
<td style="text-align: right;">25,589,899</td>
<td style="text-align: right;">49,540,506</td>
<td style="text-align: right;">-48.35%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-xchacha20</td>
<td style="text-align: right;">4,489,570</td>
<td style="text-align: right;">4,816,315</td>
<td style="text-align: right;">-6.78%</td>
</tr>
<tr>
<td style="text-align: left;">spidermonkey</td>
<td style="text-align: right;">644,434,235</td>
<td style="text-align: right;">627,374,660</td>
<td style="text-align: right;">2.72%</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="561314030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561314030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561314030">(Dec 02 2025 at 02:39)</a>:</h4>
<p>bongjunj edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I performance-tested a no-opt version of Cranelift without ISLE mid-end optimizations. (You can confirmed this at <a href="https://github.com/prosyslab/wasmtime/commit/c0df585025897098e83703cca343e139ed30a119">https://github.com/prosyslab/wasmtime/commit/c0df585025897098e83703cca343e139ed30a119</a>)</p>
<p>Compared to the latest version of upstream Cranelift, surprisingly, the no-opt version produced a significantly faster x86_64 code for blake3, keccak, xchacha20. This experiment is conducted using the sightglass-cli.</p>
<p>Given that only mid-end rules are removed, some codegen backend might causing problem interacting with the mid-end. I want to investigate this problem, but I'm completely lost which part to look at first. Any comments will be appreciated.</p>
<p>Here is the demonstration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">pin</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.08</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">sightglass</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">pin</span><span class="err">`</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">502562.18</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">4271.59</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.55</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.58</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">816778</span><span class="w"> </span><span class="mf">823363.48</span><span class="w"> </span><span class="mi">880808</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">315506</span><span class="w"> </span><span class="mf">320801.30</span><span class="w"> </span><span class="mi">460046</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">51372480.98</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">1109163.62</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.19</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.20</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">310860540</span><span class="w"> </span><span class="mf">313559414.86</span><span class="w"> </span><span class="mi">330384818</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">260245364</span><span class="w"> </span><span class="mf">262186933.88</span><span class="w"> </span><span class="mi">278160088</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">17444.42</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">10445.70</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.06</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.23</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">90902</span><span class="w"> </span><span class="mf">137381.98</span><span class="w"> </span><span class="mi">258206</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">87766</span><span class="w"> </span><span class="mf">119937.56</span><span class="w"> </span><span class="mi">198140</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>Plus, here are some data for other benchmarks.<br>
<code>--iterations-per-process 10 --benchmark-phase execution ----pin</code> is used.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">bench</th>
<th style="text-align: right;">v-no-opts</th>
<th style="text-align: right;">base</th>
<th style="text-align: right;"> speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">blake3-scalar</td>
<td style="text-align: right;">320,225</td>
<td style="text-align: right;">868,750</td>
<td style="text-align: right;">-63.14%</td>
</tr>
<tr>
<td style="text-align: left;">blake3-simd</td>
<td style="text-align: right;">320,689</td>
<td style="text-align: right;">945,427</td>
<td style="text-align: right;">-66.08%</td>
</tr>
<tr>
<td style="text-align: left;">bz2</td>
<td style="text-align: right;">88,887,466</td>
<td style="text-align: right;">86,904,121</td>
<td style="text-align: right;">2.28%</td>
</tr>
<tr>
<td style="text-align: left;">pulldown-cmark</td>
<td style="text-align: right;">6,630,447</td>
<td style="text-align: right;">6,705,562</td>
<td style="text-align: right;">-1.12%</td>
</tr>
<tr>
<td style="text-align: left;">regex</td>
<td style="text-align: right;">209,902,394</td>
<td style="text-align: right;">211,477,705</td>
<td style="text-align: right;">-0.74%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-base64</td>
<td style="text-align: right;">383,700,851</td>
<td style="text-align: right;">352,817,318</td>
<td style="text-align: right;">8.75%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-keccak</td>
<td style="text-align: right;">25,589,899</td>
<td style="text-align: right;">49,540,506</td>
<td style="text-align: right;">-48.35%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-xchacha20</td>
<td style="text-align: right;">4,489,570</td>
<td style="text-align: right;">4,816,315</td>
<td style="text-align: right;">-6.78%</td>
</tr>
<tr>
<td style="text-align: left;">spidermonkey</td>
<td style="text-align: right;">644,434,235</td>
<td style="text-align: right;">627,374,660</td>
<td style="text-align: right;">2.72%</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="561314688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561314688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561314688">(Dec 02 2025 at 02:48)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3599931204">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Hi @bongjunj -- thanks for reporting this! The place I would start is profiling to find the hottest inner loops, then comparing the disassembly of these loops before-and-after. That should help us triage the overall kind of problem -- whether it is code scheduling, or bad regalloc, or poor choice of instruction, or something else...</p>
</blockquote>



<a name="561337731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561337731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561337731">(Dec 02 2025 at 07:06)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3600507285">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@cfallin thanks! working on the triage.</p>
</blockquote>



<a name="561558959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561558959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561558959">(Dec 03 2025 at 03:57)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3604989035">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>I can pretty easily reproduce this myself cherry-picking the commit @bongjunj mentioned. Sightglass is producing surprising results for me though. One run yields</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">165008</span><span class="w"> </span><span class="mf">555680.24</span><span class="w"> </span><span class="mi">1110872</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">371539</span><span class="w"> </span><span class="mf">548436.46</span><span class="w"> </span><span class="mi">1682729</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>a few runs later is </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">147722.45</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">92286.49</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.13</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.55</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">167456</span><span class="w"> </span><span class="mf">580352.29</span><span class="w"> </span><span class="mi">1502815</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">363903</span><span class="w"> </span><span class="mf">432629.84</span><span class="w"> </span><span class="mi">590110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>passing <code>--pin</code> shows</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">311980.36</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2354.27</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.18</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.19</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">259525</span><span class="w"> </span><span class="mf">263320.66</span><span class="w"> </span><span class="mi">327692</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">569582</span><span class="w"> </span><span class="mf">575301.02</span><span class="w"> </span><span class="mi">595577</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>running with <code>taskset 0x1</code> shows</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200594.18</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2696.25</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.18</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.21</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">162200</span><span class="w"> </span><span class="mf">167555.71</span><span class="w"> </span><span class="mi">209294</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">363482</span><span class="w"> </span><span class="mf">368149.89</span><span class="w"> </span><span class="mi">400345</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>I don't really know what to make of this. My machine has P and E cores which seems like it might be factoring in. </p>
<p>I made custom builds with jitdump turned on and ran with <code>perf record -k mono</code> plus <code>--iterations-per-process</code> cranked way up. All I got though was that <code>wasm[0]::function[8]</code> was a hot function with ~45% in the <a href="http://less-isle.so">less-isle.so</a> profile and ~61% in the <a href="http://main.so">main.so</a> profile. It's a massive function with no apparent loops.</p>
<p>I don't know what's going on here myself. </p>
</blockquote>



<a name="561559030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561559030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561559030">(Dec 03 2025 at 03:58)</a>:</h4>
<p>alexcrichton edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3604989035">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>I can pretty easily reproduce this myself cherry-picking the commit @bongjunj mentioned. Sightglass is producing surprising results for me though. One run yields</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">165008</span><span class="w"> </span><span class="mf">555680.24</span><span class="w"> </span><span class="mi">1110872</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">371539</span><span class="w"> </span><span class="mf">548436.46</span><span class="w"> </span><span class="mi">1682729</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>a few runs later is </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">147722.45</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">92286.49</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.13</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.55</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">167456</span><span class="w"> </span><span class="mf">580352.29</span><span class="w"> </span><span class="mi">1502815</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">363903</span><span class="w"> </span><span class="mf">432629.84</span><span class="w"> </span><span class="mi">590110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>passing <code>--pin</code> shows</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">311980.36</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2354.27</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.18</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.19</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">259525</span><span class="w"> </span><span class="mf">263320.66</span><span class="w"> </span><span class="mi">327692</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">569582</span><span class="w"> </span><span class="mf">575301.02</span><span class="w"> </span><span class="mi">595577</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>running with <code>taskset 0x1</code> shows</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200594.18</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2696.25</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.18</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.21</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">162200</span><span class="w"> </span><span class="mf">167555.71</span><span class="w"> </span><span class="mi">209294</span><span class="p">]</span><span class="w"> </span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">363482</span><span class="w"> </span><span class="mf">368149.89</span><span class="w"> </span><span class="mi">400345</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>I don't really know what to make of this. My machine has P and E cores which seems like it might be factoring in. </p>
<p>I made custom builds with jitdump turned on and ran with <code>perf record -k mono</code> plus <code>--iterations-per-process</code> cranked way up. All I got though was that <code>wasm[0]::function[8]</code> was a hot function with ~41% in the <a href="http://less-isle.so">less-isle.so</a> profile and ~61% in the <a href="http://main.so">main.so</a> profile. It's a massive function with no apparent loops.</p>
<p>I don't know what's going on here myself. </p>
</blockquote>



<a name="561559214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561559214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561559214">(Dec 03 2025 at 04:00)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3604994304">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Hm well the hot function is <a href="https://gist.github.com/alexcrichton/6a17440bed7fed28e40af3da4a51548e#file-foo-wat-L547-L2649">this one</a> which is a massive function with zero control flow. That being said I could see egraphs deoptimizing this function in terms of instruction scheduling since we've seen pessimistic results in the past, so this might be an example of an overly-pessimistic case of instruction scheduling.</p>
</blockquote>



<a name="561560854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561560854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561560854">(Dec 03 2025 at 04:24)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605035617">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@alexcrichton Can you share the workflow of your using jitdump and perf? Any existing docs will be helpful.</p>
</blockquote>



<a name="561561861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561561861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561561861">(Dec 03 2025 at 04:36)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605035617">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@alexcrichton Can you share the workflow of your using jitdump and perf? Any existing docs will be helpful.</p>
<hr>
<p>I think I got this. thanks!</p>
</blockquote>



<a name="561562349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561562349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561562349">(Dec 03 2025 at 04:45)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605035617">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@alexcrichton Can you share the workflow of your using jitdump and perf? Any existing docs will be helpful.</p>
</blockquote>



<a name="561562685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561562685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561562685">(Dec 03 2025 at 04:50)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605035617">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@alexcrichton Can you share the workflow of your using jitdump and perf? Any existing docs will be helpful.</p>
<hr>
<p>Just running <code>perf</code> seems not working.</p>
<p><code>perf record -k mono target/release/sightglass-cli benchmark --engine=engines/wasmtime/libengine.so --engine-flags="
--profile=jitdump" --iterations-per-process=1 --measure=perf-counters benchmarks/blake3-scalar/benchmark.wasm</code></p>
</blockquote>



<a name="561569726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561569726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561569726">(Dec 03 2025 at 06:17)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605271735">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>I removed the sightglass_api dependency of the blake3-scalar benchmark, <br>
and measured jitdump/perf following <a href="https://docs.wasmtime.dev/examples-profiling-perf.html">https://docs.wasmtime.dev/examples-profiling-perf.html</a> running <code>wasmtime run</code> command for each.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">perf</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">-</span><span class="n">k</span><span class="w"> </span><span class="n">mono</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="o">=</span><span class="n">jitdump</span><span class="w"> </span><span class="n">rust</span><span class="o">-</span><span class="n">benchmark</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip1</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">perf</span><span class="w"> </span><span class="n">inject</span><span class="w"> </span><span class="o">--</span><span class="n">jit</span><span class="w"> </span><span class="o">--</span><span class="n">input</span><span class="w"> </span><span class="n">perf</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">--</span><span class="n">output</span><span class="w"> </span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span>
<span class="n">perf</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="o">--</span><span class="n">input</span><span class="w"> </span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span>
</code></pre></div>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">perf</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span><span class="w">  </span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">-</span><span class="n">noopts</span><span class="p">.</span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span>
<span class="p">#</span><span class="w"> </span><span class="n">Event</span><span class="w"> </span><span class="o">'</span><span class="na">cycles</span><span class="p">:</span><span class="nc">P</span><span class="o">'</span>
<span class="p">#</span>
<span class="p">#</span><span class="w"> </span><span class="n">Baseline</span><span class="w">  </span><span class="n">Delta</span><span class="w"> </span><span class="n">Abs</span><span class="w">  </span><span class="n">Shared</span><span class="w"> </span><span class="n">Object</span><span class="w">         </span><span class="n">Symbol</span>
<span class="p">#</span><span class="w"> </span><span class="o">........</span><span class="w">  </span><span class="o">........</span><span class="p">.</span><span class="w">  </span><span class="o">....................</span><span class="w">  </span><span class="o">............................................................................................</span>
<span class="p">#</span>
<span class="w">    </span><span class="mf">12.87</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">7.98</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">scheduler</span><span class="p">::</span><span class="n">multi_thread</span><span class="p">::</span><span class="n">worker</span><span class="p">::</span><span class="n">Context</span><span class="p">::</span><span class="n">run</span>
<span class="w">     </span><span class="mf">6.50</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">4.99</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_queued_spin_lock_slowpath</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">3.91</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">4.13</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">smp_call_function_many_cond</span>
<span class="w">     </span><span class="mf">1.13</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">2.82</span><span class="o">%</span><span class="w">  </span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mf">64.</span><span class="n">so</span><span class="p">.</span><span class="mi">2</span><span class="w">  </span><span class="p">[.]</span><span class="w"> </span><span class="mh">0x0000000000009f0c</span>
<span class="w">     </span><span class="mf">5.75</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">2.52</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="mh">0x000000000009c724</span>
<span class="w">     </span><span class="mf">0.57</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.74</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">next_uptodate_page</span>
<span class="w">     </span><span class="mf">3.66</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.73</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">mutex</span><span class="p">::</span><span class="n">futex</span><span class="p">::</span><span class="n">Mutex</span><span class="p">::</span><span class="n">lock_contended</span>
<span class="w">     </span><span class="mf">0.59</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.62</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__handle_mm_fault</span>
<span class="w">     </span><span class="mf">0.44</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.52</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_write_msr</span>
<span class="w">     </span><span class="mf">1.84</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">_find_next_bit</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.44</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__mod_lruvec_page_state</span>
<span class="w">     </span><span class="mf">1.47</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.39</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">zap_pte_range</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.21</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_curr</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.20</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__remove_hrtimer</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.17</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">osq_unlock</span>
<span class="w">     </span><span class="mf">1.27</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.16</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">futex_wait</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.13</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">unmap_page_range</span>
<span class="w">     </span><span class="mf">0.97</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">restore_fpregs_from_fpstate</span>
<span class="w">     </span><span class="mf">1.21</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.09</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">llist_reverse_order</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.08</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">do_user_addr_fault</span>
<span class="w">     </span><span class="mf">2.85</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">osq_lock</span>
<span class="w">     </span><span class="mf">0.03</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.96</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__x64_sys_futex</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.89</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">newidle_balance</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.89</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">rwsem_mark_wake</span>
<span class="w">     </span><span class="mf">0.40</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.89</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">delayacct_add_tsk</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.84</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">rb_first</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.74</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">memcg_slab_post_alloc_hook</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.73</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">sync_regs</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.72</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">change_protection_range</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.72</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__mem_cgroup_charge</span>
<span class="w">     </span><span class="mf">1.24</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.71</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_sg_wakeup_stats</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.69</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">psi_group_change</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.69</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">try_charge_memcg</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.69</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__memcg_kmem_charge_page</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.62</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">x64_sys_call</span>
<span class="w">     </span><span class="mf">0.07</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.60</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">find_vma</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.60</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">kfree</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.54</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">vm_area_dup</span>
<span class="w">     </span><span class="mf">0.19</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.53</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__vma_adjust</span>
<span class="w">     </span><span class="mf">0.59</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.53</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL_64_after_hwframe</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.52</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__srcu_read_unlock</span>
<span class="w">     </span><span class="mf">0.62</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.51</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">rwsem_down_write_slowpath</span>
<span class="w">     </span><span class="mf">0.95</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.50</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">malloc</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.49</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">blocking</span><span class="p">::</span><span class="n">pool</span><span class="p">::</span><span class="n">Spawner</span><span class="p">::</span><span class="n">spawn_task</span>
<span class="w">     </span><span class="mf">0.83</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.48</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">perf_event_alloc</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.47</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__alloc_pages</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">HUF_decompress4X2_usingDTable_internal_fast</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_blocked_averages</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">object</span><span class="p">::</span><span class="n">read</span><span class="p">::</span><span class="n">read_ref</span><span class="p">::</span><span class="n">ReadRef</span><span class="o">&gt;</span><span class="p">::</span><span class="n">read_bytes_at_until</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">cfree</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">refill_obj_stock</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">ext4_do_update_inode</span><span class="p">.</span><span class="n">isra</span><span class="p">.</span><span class="mi">0</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__ext4_get_inode_loc</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">kmem_cache_free</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">syscall_exit_to_user_mode</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="n">jitted</span><span class="o">-</span><span class="mi">438731</span><span class="o">-</span><span class="mf">20.</span><span class="n">so</span><span class="w">   </span><span class="p">[.]</span><span class="w"> </span><span class="n">blake3</span><span class="p">[</span><span class="n">e80d2cadb56cf0e0</span><span class="p">]::</span><span class="n">portable</span><span class="p">::</span><span class="n">compress_in_place</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">insert_work</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.43</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__intel_pmu_enable_all</span><span class="p">.</span><span class="n">constprop</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">1.33</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.41</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">llist_add_batch</span>
<span class="w">     </span><span class="mf">0.92</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.35</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_irq_return_iret</span>
<span class="w">     </span><span class="mf">0.62</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.31</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">ZSTD_decompressSequences_bmi2</span><span class="p">.</span><span class="n">constprop</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.39</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.29</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_sched_clock</span>
<span class="w">     </span><span class="mf">1.45</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.29</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">clear_page_erms</span>
<span class="w">     </span><span class="mf">0.95</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.24</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">handle_mm_fault</span>
<span class="w">     </span><span class="mf">0.47</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.22</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">blocking</span><span class="p">::</span><span class="n">pool</span><span class="p">::</span><span class="n">Inner</span><span class="p">::</span><span class="n">run</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.21</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_load_avg</span>
<span class="w">     </span><span class="mf">0.22</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.20</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">exit_to_user_mode_loop</span>
<span class="w">     </span><span class="mf">3.70</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.19</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_sg_lb_stats</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.19</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">find_vma_prev</span>
<span class="w">     </span><span class="mf">0.98</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.19</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">its_return_thunk</span>
<span class="w">     </span><span class="mf">0.53</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.18</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">nmi_restore</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.17</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__rseq_handle_notify_resume</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.16</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">condvar</span><span class="p">::</span><span class="n">futex</span><span class="p">::</span><span class="n">Condvar</span><span class="p">::</span><span class="n">wait</span>
<span class="w">     </span><span class="mf">0.20</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.15</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__get_user_8</span>
<span class="w">     </span><span class="mf">0.08</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.15</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__irqentry_text_end</span>
<span class="w">     </span><span class="mf">0.14</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.12</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">ghes_notify_nmi</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.12</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">vdso</span><span class="p">]</span><span class="w">                </span><span class="p">[.]</span><span class="w"> </span><span class="mh">0x00000000000006e5</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.12</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">flush_signal_handlers</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.11</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">scheduler</span><span class="p">::</span><span class="n">multi_thread</span><span class="p">::</span><span class="n">worker</span><span class="p">::</span><span class="n">Core</span><span class="p">::</span><span class="n">maintenance</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">_raw_spin_lock</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">do_madvise</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.02</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">futex_wait_queue_me</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.09</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">condvar</span><span class="p">::</span><span class="n">futex</span><span class="p">::</span><span class="n">Condvar</span><span class="p">::</span><span class="n">wait_timeout</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.09</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__update_load_avg_cfs_rq</span>
<span class="w">     </span><span class="mf">0.32</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.08</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">finish_task_switch</span><span class="p">.</span><span class="n">isra</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.19</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.08</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">exit_to_user_mode_prepare</span>
<span class="w">     </span><span class="mf">0.03</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">default_do_nmi</span>
<span class="w">     </span><span class="mf">0.08</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">switch_fpu_return</span>
<span class="w">     </span><span class="mf">0.08</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">syscall</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL_64_safe_stack</span>
<span class="w">     </span><span class="mf">0.64</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.06</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">mutex_unlock</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.06</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">hrtimer_try_to_cancel</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.06</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">sysvec_call_function</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">set_pte_vaddr_p4d</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">blkcg_maybe_throttle_current</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_set_fixmap</span>
<span class="w">     </span><span class="mf">0.02</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">nmi_handle</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.30</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_flush_tlb_one_user</span>
<span class="w">     </span><span class="mf">0.07</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_flush_tlb_local</span>
<span class="w">     </span><span class="mf">0.04</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_apic_msr_write</span>
<span class="w">     </span><span class="mf">0.11</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.03</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__perf_event_task_sched_in</span>
<span class="w">     </span><span class="mf">0.01</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.03</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">intel_pmu_handle_irq</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.02</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">do_futex</span>
<span class="w">     </span><span class="mf">0.01</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">sched_clock</span>
<span class="w">     </span><span class="mf">0.88</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">try_to_wake_up</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">perf_sample_event_took</span>
<span class="w">     </span><span class="mf">0.04</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">intel_bts_enable_local</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">end_repeat_nmi</span>
<span class="w">     </span><span class="mf">0.01</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.00</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">perf_event_nmi_handler</span>
<span class="w">     </span><span class="mf">0.04</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.00</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">acpi_os_read_memory</span>
<span class="w">     </span><span class="mf">2.38</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">idle_cpu</span>
<span class="w">     </span><span class="mf">1.40</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">kmem_cache_alloc</span>
<span class="w">     </span><span class="mf">1.33</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">copy_page</span>
<span class="w">     </span><span class="mf">1.23</span><span class="o">%</span><span class="w">             </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">function</span><span class="p">::</span><span class="nb">FnOnce</span><span class="p">::</span><span class="n">call_once</span><span class="cp">$u7b$$u7b$vtable</span><span class="p">.</span><span class="n">shim</span><span class="cp">$u7d$$u7d$</span><span class="p">::</span><span class="n">h2abf5669ee3b7a52</span>
<span class="w">     </span><span class="mf">1.23</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">page_mapping</span>
<span class="w">     </span><span class="mf">1.15</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">vma_link</span>
<span class="w">     </span><span class="mf">1.13</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">get_mem_cgroup_from_mm</span>
<span class="w">     </span><span class="mf">1.10</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_apic_msr_eoi_write</span>
<span class="w">     </span><span class="mf">1.09</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">clear_bhb_loop</span>
<span class="w">     </span><span class="mf">1.06</span><span class="o">%</span><span class="w">             </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="p">::</span><span class="n">spawnhook</span><span class="p">::</span><span class="n">SpawnHooks</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="nb">drop</span><span class="p">::</span><span class="nb">Drop</span><span class="o">&gt;</span><span class="p">::</span><span class="nb">drop</span>
<span class="w">     </span><span class="mf">1.00</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">load_balance</span>
<span class="w">     </span><span class="mf">0.89</span><span class="o">%</span><span class="w">             </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">__madvise</span>
<span class="w">     </span><span class="mf">0.88</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">alloc_thread_stack_node</span>
<span class="w">     </span><span class="mf">0.85</span><span class="o">%</span><span class="w">             </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">thread_local</span><span class="p">::</span><span class="n">guard</span><span class="p">::</span><span class="n">key</span><span class="p">::</span><span class="n">enable</span><span class="p">::</span><span class="n">run</span>
<span class="w">     </span><span class="mf">0.82</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">task_h_load</span>
<span class="w">     </span><span class="mf">0.79</span><span class="o">%</span>
<span class="p">[</span><span class="n">message</span><span class="w"> </span><span class="n">truncated</span><span class="p">]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="561570559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561570559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561570559">(Dec 03 2025 at 06:25)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605291102">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>There is definitely something going on with function 8: the stack frame (grep for <code>sub $N, %rsp</code> in disassembly) is 0x130 bytes if I disable all opt rewrites (remove the call to <code>constructor_simplify</code> in the egraph pass) and 0x6b0 bytes in the unmodified run. The result is that the function body has a whole bunch more spills/reloads. Something is causing a lot more register pressure; isel is a plausible hypothesis there. I'll dig a bit more...</p>
</blockquote>



<a name="561573010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561573010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561573010">(Dec 03 2025 at 06:51)</a>:</h4>
<p>bongjunj deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605271735">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>I removed the sightglass_api dependency of the blake3-scalar benchmark, <br>
and measured jitdump/perf following <a href="https://docs.wasmtime.dev/examples-profiling-perf.html">https://docs.wasmtime.dev/examples-profiling-perf.html</a> running <code>wasmtime run</code> command for each.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">perf</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">-</span><span class="n">k</span><span class="w"> </span><span class="n">mono</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="o">=</span><span class="n">jitdump</span><span class="w"> </span><span class="n">rust</span><span class="o">-</span><span class="n">benchmark</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip1</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">perf</span><span class="w"> </span><span class="n">inject</span><span class="w"> </span><span class="o">--</span><span class="n">jit</span><span class="w"> </span><span class="o">--</span><span class="n">input</span><span class="w"> </span><span class="n">perf</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">--</span><span class="n">output</span><span class="w"> </span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span>
<span class="n">perf</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="o">--</span><span class="n">input</span><span class="w"> </span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span>
</code></pre></div>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">perf</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span><span class="w">  </span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">-</span><span class="n">noopts</span><span class="p">.</span><span class="n">perf</span><span class="p">.</span><span class="n">jit</span><span class="p">.</span><span class="n">data</span>
<span class="p">#</span><span class="w"> </span><span class="n">Event</span><span class="w"> </span><span class="o">'</span><span class="na">cycles</span><span class="p">:</span><span class="nc">P</span><span class="o">'</span>
<span class="p">#</span>
<span class="p">#</span><span class="w"> </span><span class="n">Baseline</span><span class="w">  </span><span class="n">Delta</span><span class="w"> </span><span class="n">Abs</span><span class="w">  </span><span class="n">Shared</span><span class="w"> </span><span class="n">Object</span><span class="w">         </span><span class="n">Symbol</span>
<span class="p">#</span><span class="w"> </span><span class="o">........</span><span class="w">  </span><span class="o">........</span><span class="p">.</span><span class="w">  </span><span class="o">....................</span><span class="w">  </span><span class="o">............................................................................................</span>
<span class="p">#</span>
<span class="w">    </span><span class="mf">12.87</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">7.98</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">scheduler</span><span class="p">::</span><span class="n">multi_thread</span><span class="p">::</span><span class="n">worker</span><span class="p">::</span><span class="n">Context</span><span class="p">::</span><span class="n">run</span>
<span class="w">     </span><span class="mf">6.50</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">4.99</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_queued_spin_lock_slowpath</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">3.91</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">4.13</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">smp_call_function_many_cond</span>
<span class="w">     </span><span class="mf">1.13</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">2.82</span><span class="o">%</span><span class="w">  </span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mf">64.</span><span class="n">so</span><span class="p">.</span><span class="mi">2</span><span class="w">  </span><span class="p">[.]</span><span class="w"> </span><span class="mh">0x0000000000009f0c</span>
<span class="w">     </span><span class="mf">5.75</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">2.52</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="mh">0x000000000009c724</span>
<span class="w">     </span><span class="mf">0.57</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.74</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">next_uptodate_page</span>
<span class="w">     </span><span class="mf">3.66</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.73</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">mutex</span><span class="p">::</span><span class="n">futex</span><span class="p">::</span><span class="n">Mutex</span><span class="p">::</span><span class="n">lock_contended</span>
<span class="w">     </span><span class="mf">0.59</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.62</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__handle_mm_fault</span>
<span class="w">     </span><span class="mf">0.44</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.52</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_write_msr</span>
<span class="w">     </span><span class="mf">1.84</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">_find_next_bit</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.44</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__mod_lruvec_page_state</span>
<span class="w">     </span><span class="mf">1.47</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.39</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">zap_pte_range</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.21</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_curr</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.20</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__remove_hrtimer</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.17</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">osq_unlock</span>
<span class="w">     </span><span class="mf">1.27</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.16</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">futex_wait</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.13</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">unmap_page_range</span>
<span class="w">     </span><span class="mf">0.97</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">1.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">restore_fpregs_from_fpstate</span>
<span class="w">     </span><span class="mf">1.21</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.09</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">llist_reverse_order</span>
<span class="w">               </span><span class="o">+</span><span class="mf">1.08</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">do_user_addr_fault</span>
<span class="w">     </span><span class="mf">2.85</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">1.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">osq_lock</span>
<span class="w">     </span><span class="mf">0.03</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.96</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__x64_sys_futex</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.89</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">newidle_balance</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.89</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">rwsem_mark_wake</span>
<span class="w">     </span><span class="mf">0.40</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.89</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">delayacct_add_tsk</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.84</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">rb_first</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.74</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">memcg_slab_post_alloc_hook</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.73</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">sync_regs</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.72</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">change_protection_range</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.72</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__mem_cgroup_charge</span>
<span class="w">     </span><span class="mf">1.24</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.71</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_sg_wakeup_stats</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.69</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">psi_group_change</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.69</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">try_charge_memcg</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.69</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__memcg_kmem_charge_page</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.62</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">x64_sys_call</span>
<span class="w">     </span><span class="mf">0.07</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.60</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">find_vma</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.60</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">kfree</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.54</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">vm_area_dup</span>
<span class="w">     </span><span class="mf">0.19</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.53</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__vma_adjust</span>
<span class="w">     </span><span class="mf">0.59</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.53</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL_64_after_hwframe</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.52</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__srcu_read_unlock</span>
<span class="w">     </span><span class="mf">0.62</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.51</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">rwsem_down_write_slowpath</span>
<span class="w">     </span><span class="mf">0.95</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.50</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">malloc</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.49</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">blocking</span><span class="p">::</span><span class="n">pool</span><span class="p">::</span><span class="n">Spawner</span><span class="p">::</span><span class="n">spawn_task</span>
<span class="w">     </span><span class="mf">0.83</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.48</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">perf_event_alloc</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.47</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__alloc_pages</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">HUF_decompress4X2_usingDTable_internal_fast</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_blocked_averages</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">object</span><span class="p">::</span><span class="n">read</span><span class="p">::</span><span class="n">read_ref</span><span class="p">::</span><span class="n">ReadRef</span><span class="o">&gt;</span><span class="p">::</span><span class="n">read_bytes_at_until</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">cfree</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">refill_obj_stock</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">ext4_do_update_inode</span><span class="p">.</span><span class="n">isra</span><span class="p">.</span><span class="mi">0</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.46</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__ext4_get_inode_loc</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">kmem_cache_free</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">syscall_exit_to_user_mode</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="n">jitted</span><span class="o">-</span><span class="mi">438731</span><span class="o">-</span><span class="mf">20.</span><span class="n">so</span><span class="w">   </span><span class="p">[.]</span><span class="w"> </span><span class="n">blake3</span><span class="p">[</span><span class="n">e80d2cadb56cf0e0</span><span class="p">]::</span><span class="n">portable</span><span class="p">::</span><span class="n">compress_in_place</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.45</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">insert_work</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.43</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__intel_pmu_enable_all</span><span class="p">.</span><span class="n">constprop</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">1.33</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.41</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">llist_add_batch</span>
<span class="w">     </span><span class="mf">0.92</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.35</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_irq_return_iret</span>
<span class="w">     </span><span class="mf">0.62</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.31</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">ZSTD_decompressSequences_bmi2</span><span class="p">.</span><span class="n">constprop</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.39</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.29</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_sched_clock</span>
<span class="w">     </span><span class="mf">1.45</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.29</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">clear_page_erms</span>
<span class="w">     </span><span class="mf">0.95</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.24</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">handle_mm_fault</span>
<span class="w">     </span><span class="mf">0.47</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.22</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">blocking</span><span class="p">::</span><span class="n">pool</span><span class="p">::</span><span class="n">Inner</span><span class="p">::</span><span class="n">run</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.21</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_load_avg</span>
<span class="w">     </span><span class="mf">0.22</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.20</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">exit_to_user_mode_loop</span>
<span class="w">     </span><span class="mf">3.70</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.19</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">update_sg_lb_stats</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.19</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">find_vma_prev</span>
<span class="w">     </span><span class="mf">0.98</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.19</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">its_return_thunk</span>
<span class="w">     </span><span class="mf">0.53</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.18</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">nmi_restore</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.17</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__rseq_handle_notify_resume</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.16</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">condvar</span><span class="p">::</span><span class="n">futex</span><span class="p">::</span><span class="n">Condvar</span><span class="p">::</span><span class="n">wait</span>
<span class="w">     </span><span class="mf">0.20</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.15</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__get_user_8</span>
<span class="w">     </span><span class="mf">0.08</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.15</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__irqentry_text_end</span>
<span class="w">     </span><span class="mf">0.14</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.12</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">ghes_notify_nmi</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.12</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">vdso</span><span class="p">]</span><span class="w">                </span><span class="p">[.]</span><span class="w"> </span><span class="mh">0x00000000000006e5</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.12</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">flush_signal_handlers</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.11</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">scheduler</span><span class="p">::</span><span class="n">multi_thread</span><span class="p">::</span><span class="n">worker</span><span class="p">::</span><span class="n">Core</span><span class="p">::</span><span class="n">maintenance</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">_raw_spin_lock</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">do_madvise</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.02</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.10</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">futex_wait_queue_me</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.09</span><span class="o">%</span><span class="w">  </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">condvar</span><span class="p">::</span><span class="n">futex</span><span class="p">::</span><span class="n">Condvar</span><span class="p">::</span><span class="n">wait_timeout</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.09</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__update_load_avg_cfs_rq</span>
<span class="w">     </span><span class="mf">0.32</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.08</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">finish_task_switch</span><span class="p">.</span><span class="n">isra</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.19</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.08</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">exit_to_user_mode_prepare</span>
<span class="w">     </span><span class="mf">0.03</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">default_do_nmi</span>
<span class="w">     </span><span class="mf">0.08</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">switch_fpu_return</span>
<span class="w">     </span><span class="mf">0.08</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">syscall</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.07</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL_64_safe_stack</span>
<span class="w">     </span><span class="mf">0.64</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.06</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">mutex_unlock</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.06</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">hrtimer_try_to_cancel</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.06</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">sysvec_call_function</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">set_pte_vaddr_p4d</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">blkcg_maybe_throttle_current</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.05</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_set_fixmap</span>
<span class="w">     </span><span class="mf">0.02</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">nmi_handle</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="mi">0</span>
<span class="w">     </span><span class="mf">0.30</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_flush_tlb_one_user</span>
<span class="w">     </span><span class="mf">0.07</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_flush_tlb_local</span>
<span class="w">     </span><span class="mf">0.04</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.04</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_apic_msr_write</span>
<span class="w">     </span><span class="mf">0.11</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.03</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">__perf_event_task_sched_in</span>
<span class="w">     </span><span class="mf">0.01</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.03</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">intel_pmu_handle_irq</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.02</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">do_futex</span>
<span class="w">     </span><span class="mf">0.01</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">sched_clock</span>
<span class="w">     </span><span class="mf">0.88</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">try_to_wake_up</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">perf_sample_event_took</span>
<span class="w">     </span><span class="mf">0.04</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">intel_bts_enable_local</span>
<span class="w">               </span><span class="o">+</span><span class="mf">0.01</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">end_repeat_nmi</span>
<span class="w">     </span><span class="mf">0.01</span><span class="o">%</span><span class="w">     </span><span class="o">+</span><span class="mf">0.00</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">perf_event_nmi_handler</span>
<span class="w">     </span><span class="mf">0.04</span><span class="o">%</span><span class="w">     </span><span class="o">-</span><span class="mf">0.00</span><span class="o">%</span><span class="w">  </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">acpi_os_read_memory</span>
<span class="w">     </span><span class="mf">2.38</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">idle_cpu</span>
<span class="w">     </span><span class="mf">1.40</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">kmem_cache_alloc</span>
<span class="w">     </span><span class="mf">1.33</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">copy_page</span>
<span class="w">     </span><span class="mf">1.23</span><span class="o">%</span><span class="w">             </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">function</span><span class="p">::</span><span class="nb">FnOnce</span><span class="p">::</span><span class="n">call_once</span><span class="cp">$u7b$$u7b$vtable</span><span class="p">.</span><span class="n">shim</span><span class="cp">$u7d$$u7d$</span><span class="p">::</span><span class="n">h2abf5669ee3b7a52</span>
<span class="w">     </span><span class="mf">1.23</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">page_mapping</span>
<span class="w">     </span><span class="mf">1.15</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">vma_link</span>
<span class="w">     </span><span class="mf">1.13</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">get_mem_cgroup_from_mm</span>
<span class="w">     </span><span class="mf">1.10</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">native_apic_msr_eoi_write</span>
<span class="w">     </span><span class="mf">1.09</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">clear_bhb_loop</span>
<span class="w">     </span><span class="mf">1.06</span><span class="o">%</span><span class="w">             </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="p">::</span><span class="n">spawnhook</span><span class="p">::</span><span class="n">SpawnHooks</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="nb">drop</span><span class="p">::</span><span class="nb">Drop</span><span class="o">&gt;</span><span class="p">::</span><span class="nb">drop</span>
<span class="w">     </span><span class="mf">1.00</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">load_balance</span>
<span class="w">     </span><span class="mf">0.89</span><span class="o">%</span><span class="w">             </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="w">             </span><span class="p">[.]</span><span class="w"> </span><span class="n">__madvise</span>
<span class="w">     </span><span class="mf">0.88</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">alloc_thread_stack_node</span>
<span class="w">     </span><span class="mf">0.85</span><span class="o">%</span><span class="w">             </span><span class="n">wasmtime</span><span class="w">              </span><span class="p">[.]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">thread_local</span><span class="p">::</span><span class="n">guard</span><span class="p">::</span><span class="n">key</span><span class="p">::</span><span class="n">enable</span><span class="p">::</span><span class="n">run</span>
<span class="w">     </span><span class="mf">0.82</span><span class="o">%</span><span class="w">             </span><span class="p">[</span><span class="n">kernel</span><span class="p">.</span><span class="n">kallsyms</span><span class="p">]</span><span class="w">     </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="n">task_h_load</span>
<span class="w">     </span><span class="mf">0.7</span>
<span class="p">[</span><span class="n">message</span><span class="w"> </span><span class="n">truncated</span><span class="p">]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="561576728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561576728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561576728">(Dec 03 2025 at 07:23)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605443347">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Here are the <a href="https://gist.github.com/cfallin/6de5843811f92e4deab7b35efdca3251#file-base-clif">no opt rewrites (but still GVN/alias/LICM)</a> and <a href="https://gist.github.com/cfallin/6de5843811f92e4deab7b35efdca3251#file-opt-clif">full <code>main</code> branch opt</a> CLIF dumps for function 8 (<code>wasmtime compile --emit-clif dir foo.wat</code> then take <code>wasm[0]--function[8].clif</code> from the directory).</p>
<p>The "optimized" variant is about twice as long (!).</p>
<p>There's a repeating rewrite pattern that seems to be happening that is a sort of reassociation of a 3-input add sequence -- in the baseline we have</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">v34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v27</span><span class="p">,</span><span class="w"> </span><span class="n">v33</span>
<span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">lots</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="n">insts</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">..</span><span class="p">.</span>
<span class="n">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v34</span><span class="p">,</span><span class="w"> </span><span class="n">v42</span>
<span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">v43</span><span class="w"> </span><span class="o">..</span><span class="p">.</span>
</code></pre></div>
<p>and in opt we have</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">lots</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="n">insts</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">..</span><span class="p">.</span>
<span class="n">v1242</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v33</span><span class="p">,</span><span class="w"> </span><span class="n">v42</span>
<span class="n">v1243</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v27</span><span class="p">,</span><span class="w"> </span><span class="n">v1242</span>
<span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">v1243</span><span class="w"> </span><span class="o">..</span><span class="p">.</span>
</code></pre></div>
<p>So we've (i) needlessly reassociated <code>(v27 + v33) + v42</code> into <code>v27 + (v33 + v42)</code> (none of these are iconsts) and (ii) sunk one of the adds. The former is weird but "shrug". The latter is painful for register pressure: if means we have three live values over "lots of intermediate insts" rather than two.</p>
<p>Better inst scheduling integrated with regalloc would solve that (but, NP-hard problem about which at least one PhD thesis has been written); or alternately, we could "not fix what's not broken" and just avoid the rewrite.</p>
<p>The reassociation seems to go more haywire further down; looking at a diff (<code>diff -u base.clif opt.clif</code>) things are more-or-less 1-for-1 trades early on, but lots of extra <code>iadd</code>s later.</p>
<p>I'll dig into the reassociation rules we have and see if I can figure out what's happening!</p>
</blockquote>



<a name="561577942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561577942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561577942">(Dec 03 2025 at 07:31)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3605465329">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>OK, it seems that the reassociation rules added in #7466 are the issue. If I comment those out, I get <a href="https://gist.github.com/cfallin/6de5843811f92e4deab7b35efdca3251#file-fixed-clif">this</a> CLIF, and the compiled function body has a stack frame size of 0x130 bytes again.</p>
<p>cc @fitzgen -- it looks like there wasn't any data posted on that PR; did you have benchmarking results at the time? Mind benchmarking with/without those rules (and I guess the similar followups in #8518 as well)?</p>
</blockquote>



<a name="561688006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561688006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561688006">(Dec 03 2025 at 15:43)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3607481200">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<blockquote>
<p>Can you share the workflow of your using jitdump and perf?</p>
</blockquote>
<p>I applied this diff:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/crates/bench-api/src/lib.rs b/crates/bench-api/src/lib.rs</span>
<span class="gh">index 86c99c8c98..8a5180ca5e 100644</span>
<span class="gd">--- a/crates/bench-api/src/lib.rs</span>
<span class="gi">+++ b/crates/bench-api/src/lib.rs</span>
<span class="gu">@@ -423,6 +423,7 @@ impl BenchState {</span>
<span class="w"> </span>        let mut config = options.config(None)?;
<span class="w"> </span>        // NB: always disable the compilation cache.
<span class="w"> </span>        config.cache(None);
<span class="gi">+        config.profiler(wasmtime::ProfilingStrategy::JitDump);</span>
<span class="w"> </span>        let engine = Engine::new(&amp;config)?;
<span class="w"> </span>        let mut linker = Linker::&lt;HostState&gt;::new(&amp;engine);
</code></pre></div>
<p>and then I ran:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">taskset</span><span class="w"> </span><span class="mh">0x1</span><span class="w"> </span><span class="n">perf</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">-</span><span class="n">k</span><span class="w"> </span><span class="n">mono</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">sightglass</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">less</span><span class="o">-</span><span class="n">isle</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">benchmark</span><span class="o">-</span><span class="n">phase</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">100000</span>
</code></pre></div>
<p>after awhile I ctrl-c'd it and followed <a href="https://docs.wasmtime.dev/examples-profiling-perf.html#profiling-with-jitdump">these instructions</a> to process the profile</p>
</blockquote>



<a name="561763669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561763669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561763669">(Dec 03 2025 at 22:39)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3609146348">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Reverted the offending rewrite in <a href="https://github.com/bytecodealliance/wasmtime/pull/12116">https://github.com/bytecodealliance/wasmtime/pull/12116</a> -- could someone re-run these benchmarks on <code>main</code> and report whether everything is resolved or not now? Thanks!</p>
</blockquote>



<a name="561766043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561766043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561766043">(Dec 03 2025 at 23:01)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3609199230">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Here are the benchmarks that had the biggest drops no-rules to rules above:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">shootout</span><span class="o">/</span><span class="n">shootout</span><span class="o">-</span><span class="n">keccak</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4097364.22</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">837090.89</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">rules</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.14</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.21</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">26507651</span><span class="w"> </span><span class="mf">27605359.73</span><span class="w"> </span><span class="mi">36644170</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">22595511</span><span class="w"> </span><span class="mf">23507995.51</span><span class="w"> </span><span class="mi">29631085</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">rules</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">shootout</span><span class="o">/</span><span class="n">shootout</span><span class="o">-</span><span class="n">xchacha20</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">16237.66</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">10867.13</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.01</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">rules</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2634524</span><span class="w"> </span><span class="mf">2662033.25</span><span class="w"> </span><span class="mi">2766405</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2645145</span><span class="w"> </span><span class="mf">2678270.91</span><span class="w"> </span><span class="mi">2835592</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">rules</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">207174</span><span class="w"> </span><span class="mf">209371.73</span><span class="w"> </span><span class="mi">231598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">207346</span><span class="w"> </span><span class="mf">210394.27</span><span class="w"> </span><span class="mi">257140</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">rules</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">208507</span><span class="w"> </span><span class="mf">212511.59</span><span class="w"> </span><span class="mi">232974</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">208421</span><span class="w"> </span><span class="mf">212331.42</span><span class="w"> </span><span class="mi">290723</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">rules</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>So <code>keccak</code> is still weird, but "only" 14-21% slower rather than 48%. Giant drops in blake3-* went away entirely.</p>
</blockquote>



<a name="561767958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561767958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561767958">(Dec 03 2025 at 23:21)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3609244306">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>I also see (consistently) a 20% slowdown of shootout-keccak. That is, deleting all the ISLE bits makes shootout-keccak faster. Local profiling shows in both profiles 98% of the time is spent in the <a href="https://gist.github.com/alexcrichton/1a145ab20bfcbc355afb380605de4cbd#file-foo-wat-L79"><code>keccak_core</code> function</a> which looks similar to the blake3 one</p>
</blockquote>



<a name="561813439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561813439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561813439">(Dec 04 2025 at 07:59)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3610759481">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Performance evaluation (Execution) after removing the reassoc rules:</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th style="text-align: right;">No Opts</th>
<th style="text-align: right;">Base</th>
<th style="text-align: right;">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>shootout-keccak</td>
<td style="text-align: right;">25,157,389</td>
<td style="text-align: right;">29,537,793</td>
<td style="text-align: right;">-14.83%</td>
</tr>
<tr>
<td>shootout-switch</td>
<td style="text-align: right;">139,546,912</td>
<td style="text-align: right;">153,616,699</td>
<td style="text-align: right;">-9.16%</td>
</tr>
<tr>
<td>shootout-ratelimit</td>
<td style="text-align: right;">39,101,368</td>
<td style="text-align: right;">39,894,279</td>
<td style="text-align: right;">-1.99%</td>
</tr>
<tr>
<td>shootout-gimli</td>
<td style="text-align: right;">5,360,983</td>
<td style="text-align: right;">5,418,553</td>
<td style="text-align: right;">-1.06%</td>
</tr>
<tr>
<td>shootout-xchacha20</td>
<td style="text-align: right;">4,376,708</td>
<td style="text-align: right;">4,389,354</td>
<td style="text-align: right;">-0.29%</td>
</tr>
<tr>
<td>regex</td>
<td style="text-align: right;">209,934,736</td>
<td style="text-align: right;">210,346,186</td>
<td style="text-align: right;">-0.20%</td>
</tr>
<tr>
<td>shootout-memmove</td>
<td style="text-align: right;">36,313,845</td>
<td style="text-align: right;">36,325,481</td>
<td style="text-align: right;">-0.03%</td>
</tr>
<tr>
<td>shootout-fib2</td>
<td style="text-align: right;">3,009,938,907</td>
<td style="text-align: right;">3,010,271,487</td>
<td style="text-align: right;">-0.01%</td>
</tr>
<tr>
<td>shootout-matrix</td>
<td style="text-align: right;">540,314,088</td>
<td style="text-align: right;">540,332,499</td>
<td style="text-align: right;">0.00%</td>
</tr>
<tr>
<td>shootout-heapsort</td>
<td style="text-align: right;">2,378,752,173</td>
<td style="text-align: right;">2,374,493,320</td>
<td style="text-align: right;">0.18%</td>
</tr>
<tr>
<td>spidermonkey</td>
<td style="text-align: right;">635,879,627</td>
<td style="text-align: right;">634,094,137</td>
<td style="text-align: right;">0.28%</td>
</tr>
<tr>
<td>blake3-scalar</td>
<td style="text-align: right;">318,837</td>
<td style="text-align: right;">316,866</td>
<td style="text-align: right;">0.62%</td>
</tr>
<tr>
<td>bz2</td>
<td style="text-align: right;">87,275,956</td>
<td style="text-align: right;">86,405,779</td>
<td style="text-align: right;">1.01%</td>
</tr>
<tr>
<td>pulldown-cmark</td>
<td style="text-align: right;">6,729,037</td>
<td style="text-align: right;">6,629,027</td>
<td style="text-align: right;">1.51%</td>
</tr>
<tr>
<td>shootout-ed25519</td>
<td style="text-align: right;">9,583,751,426</td>
<td style="text-align: right;">9,412,570,875</td>
<td style="text-align: right;">1.82%</td>
</tr>
<tr>
<td>shootout-xblabla20</td>
<td style="text-align: right;">2,974,201</td>
<td style="text-align: right;">2,902,069</td>
<td style="text-align: right;">2.49%</td>
</tr>
<tr>
<td>blake3-simd</td>
<td style="text-align: right;">313,009</td>
<td style="text-align: right;">305,049</td>
<td style="text-align: right;">2.61%</td>
</tr>
<tr>
<td>shootout-seqhash</td>
<td style="text-align: right;">8,971,675,191</td>
<td style="text-align: right;">8,663,650,423</td>
<td style="text-align: right;">3.56%</td>
</tr>
<tr>
<td>shootout-nestedloop</td>
<td style="text-align: right;">468</td>
<td style="text-align: right;">451</td>
<td style="text-align: right;">3.89%</td>
</tr>
<tr>
<td>shootout-ctype</td>
<td style="text-align: right;">830,650,139</td>
<td style="text-align: right;">796,881,603</td>
<td style="text-align: right;">4.24%</td>
</tr>
<tr>
<td>shootout-sieve</td>
<td style="text-align: right;">905,646,691</td>
<td style="text-align: right;">841,504,133</td>
<td style="text-align: right;">7.62%</td>
</tr>
<tr>
<td>shootout-base64</td>
<td style="text-align: right;">381,752,475</td>
<td style="text-align: right;">352,928,420</td>
<td style="text-align: right;">8.17%</td>
</tr>
<tr>
<td>shootout-ackermann</td>
<td style="text-align: right;">8,647,754</td>
<td style="text-align: right;">7,767,390</td>
<td style="text-align: right;">11.33%</td>
</tr>
<tr>
<td>shootout-minicsv</td>
<td style="text-align: right;">1,475,692,343</td>
<td style="text-align: right;">1,306,403,978</td>
<td style="text-align: right;">12.96%</td>
</tr>
<tr>
<td>shootout-random</td>
<td style="text-align: right;">630,367,818</td>
<td style="text-align: right;">439,901,877</td>
<td style="text-align: right;">43.30%</td>
</tr>
<tr>
<td></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="561821426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561821426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561821426">(Dec 04 2025 at 08:45)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3610920223">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>In keccak, the following (de-) optimizing pattern is repeated from no-opt version to base (main branch):</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">-@</span><span class="mi">4</span><span class="n">cfc</span><span class="w">                               </span><span class="n">v6912</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v6792</span><span class="p">,</span><span class="w"> </span><span class="n">v158</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v158</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="o">-@</span><span class="mi">4</span><span class="n">cfd</span><span class="w">                               </span><span class="n">v6913</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v6775</span><span class="p">,</span><span class="w"> </span><span class="n">v6912</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10066</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v6787</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10067</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v6789</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10068</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v10066</span><span class="p">,</span><span class="w"> </span><span class="n">v10067</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10070</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bor</span><span class="w"> </span><span class="n">v10068</span><span class="p">,</span><span class="w"> </span><span class="n">v6991</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6991</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4294967296</span>
<span class="o">+@</span><span class="mi">4</span><span class="n">cfd</span><span class="w">                               </span><span class="n">v6913</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v6775</span><span class="p">,</span><span class="w"> </span><span class="n">v10070</span>
<span class="w"> </span><span class="o">@</span><span class="mi">4</span><span class="n">d00</span><span class="w">                               </span><span class="n">v6914</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v6913</span><span class="p">,</span><span class="w"> </span><span class="n">v6803</span>
<span class="w"> </span><span class="o">@</span><span class="mi">4</span><span class="n">d01</span><span class="w">                               </span><span class="n">store</span><span class="w"> </span><span class="n">little</span><span class="w"> </span><span class="n">heap</span><span class="w"> </span><span class="n">v6914</span><span class="p">,</span><span class="w"> </span><span class="n">v105</span>
<span class="o">-@</span><span class="mi">4</span><span class="n">d0c</span><span class="w">                               </span><span class="n">v6921</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v6823</span><span class="p">,</span><span class="w"> </span><span class="n">v158</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v158</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="o">-@</span><span class="mi">4</span><span class="n">d0d</span><span class="w">                               </span><span class="n">v6922</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v6656</span><span class="p">,</span><span class="w"> </span><span class="n">v6921</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10075</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v6818</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10076</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v6820</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10077</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v10075</span><span class="p">,</span><span class="w"> </span><span class="n">v10076</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10079</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bor</span><span class="w"> </span><span class="n">v10077</span><span class="p">,</span><span class="w"> </span><span class="n">v6991</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6991</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4294967296</span>
<span class="o">+@</span><span class="mi">4</span><span class="n">d0d</span><span class="w">                               </span><span class="n">v6922</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v6656</span><span class="p">,</span><span class="w"> </span><span class="n">v10079</span>
<span class="w"> </span><span class="o">@</span><span class="mi">4</span><span class="n">d10</span><span class="w">                               </span><span class="n">v6923</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v6922</span><span class="p">,</span><span class="w"> </span><span class="n">v6631</span>
<span class="w"> </span><span class="o">@</span><span class="mi">4</span><span class="n">d11</span><span class="w">                               </span><span class="n">store</span><span class="w"> </span><span class="n">little</span><span class="w"> </span><span class="n">heap</span><span class="w"> </span><span class="n">v6923</span><span class="p">,</span><span class="w"> </span><span class="n">v124</span>
<span class="o">-@</span><span class="mi">4</span><span class="n">d1c</span><span class="w">                               </span><span class="n">v6930</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v6841</span><span class="p">,</span><span class="w"> </span><span class="n">v158</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v158</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="o">-@</span><span class="mi">4</span><span class="n">d1d</span><span class="w">                               </span><span class="n">v6931</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v6830</span><span class="p">,</span><span class="w"> </span><span class="n">v6930</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10084</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v6836</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10085</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v6838</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10086</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v10084</span><span class="p">,</span><span class="w"> </span><span class="n">v10085</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v10088</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bor</span><span class="w"> </span><span class="n">v10086</span><span class="p">,</span><span class="w"> </span><span class="n">v6991</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6991</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4294967296</span>
<span class="o">+@</span><span class="mi">4</span><span class="n">d1d</span><span class="w">                               </span><span class="n">v6931</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v6830</span><span class="p">,</span><span class="w"> </span><span class="n">v10088</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="561825110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561825110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561825110">(Dec 04 2025 at 09:02)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3610920223">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>In keccak, the following (de-) optimizing pattern is repeated from no-opt version to base (main branch) in the keccak core function, when the instruction count exceeds 1,000.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">-@</span><span class="mi">11</span><span class="n">dd</span><span class="w">                               </span><span class="n">v1561</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v1220</span><span class="p">,</span><span class="w"> </span><span class="n">v158</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v158</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="o">-@</span><span class="mi">11</span><span class="n">de</span><span class="w">                               </span><span class="n">v1562</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v1430</span><span class="p">,</span><span class="w"> </span><span class="n">v1561</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7626</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v1215</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7627</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v1217</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7628</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v7626</span><span class="p">,</span><span class="w"> </span><span class="n">v7627</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7630</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bor</span><span class="w"> </span><span class="n">v7628</span><span class="p">,</span><span class="w"> </span><span class="n">v6991</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6991</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4294967296</span>
<span class="o">+@</span><span class="mi">11</span><span class="n">de</span><span class="w">                               </span><span class="n">v1562</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v1430</span><span class="p">,</span><span class="w"> </span><span class="n">v7630</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="561825801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561825801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561825801">(Dec 04 2025 at 09:05)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3610920223">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>In keccak, the following (de-) optimizing pattern is repeated from no-opt version to base (main branch) in the keccak core function, when the instruction count exceeds 1,000.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">-@</span><span class="mi">11</span><span class="n">dd</span><span class="w">                               </span><span class="n">v1561</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor</span><span class="w"> </span><span class="n">v1220</span><span class="p">,</span><span class="w"> </span><span class="n">v158</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v158</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="o">-@</span><span class="mi">11</span><span class="n">de</span><span class="w">                               </span><span class="n">v1562</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v1430</span><span class="p">,</span><span class="w"> </span><span class="n">v1561</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7626</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v1215</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7627</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v1217</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7628</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v7626</span><span class="p">,</span><span class="w"> </span><span class="n">v7627</span>
<span class="o">+</span><span class="w">                                    </span><span class="n">v7630</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bor</span><span class="w"> </span><span class="n">v7628</span><span class="p">,</span><span class="w"> </span><span class="n">v6991</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6991</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4294967296</span>
<span class="o">+@</span><span class="mi">11</span><span class="n">de</span><span class="w">                               </span><span class="n">v1562</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v1430</span><span class="p">,</span><span class="w"> </span><span class="n">v7630</span>
</code></pre></div>
<p>This transformation is defined at <a href="https://github.com/bytecodealliance/wasmtime/blob/058a9bc16bc204fec05993ce6a0b013cc3db55e6/cranelift/codegen/src/opts/bitops.isle#L44-L50">https://github.com/bytecodealliance/wasmtime/blob/058a9bc16bc204fec05993ce6a0b013cc3db55e6/cranelift/codegen/src/opts/bitops.isle#L44-L50</a></p>
</blockquote>



<a name="561842720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561842720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561842720">(Dec 04 2025 at 10:33)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3611396520">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>With the DeMorgan rules removed, the performance degrades are almost gone except for the "switch" case.</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>No Opts</th>
<th>Base</th>
<th>Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>shootout-switch</td>
<td>139,551,486.30</td>
<td>153696081.5</td>
<td>-9.20%</td>
</tr>
<tr>
<td>shootout-ratelimit</td>
<td>39,173,257.16</td>
<td>39952950.56</td>
<td>-1.95%</td>
</tr>
<tr>
<td>shootout-xchacha20</td>
<td>4,380,029.16</td>
<td>4444075.78</td>
<td>-1.44%</td>
</tr>
<tr>
<td>regex</td>
<td>210,231,630.92</td>
<td>212953957.4</td>
<td>-1.28%</td>
</tr>
<tr>
<td>shootout-gimli</td>
<td>5,345,271.14</td>
<td>5404313.96</td>
<td>-1.09%</td>
</tr>
<tr>
<td>shootout-fib2</td>
<td>3,010,356,555.06</td>
<td>3010366675</td>
<td>0.00%</td>
</tr>
<tr>
<td>shootout-matrix</td>
<td>539,106,883.22</td>
<td>538754055.2</td>
<td>0.07%</td>
</tr>
<tr>
<td>shootout-heapsort</td>
<td>2,378,812,047.98</td>
<td>2375114650</td>
<td>0.16%</td>
</tr>
<tr>
<td>spidermonkey</td>
<td>636,143,609.88</td>
<td>633256160.3</td>
<td>0.46%</td>
</tr>
<tr>
<td>bz2</td>
<td>87,099,312.82</td>
<td>86442047.12</td>
<td>0.76%</td>
</tr>
<tr>
<td>shootout-memmove</td>
<td>36,569,713.06</td>
<td>36246023.48</td>
<td>0.89%</td>
</tr>
<tr>
<td>blake3-scalar</td>
<td>319,175.94</td>
<td>316023.92</td>
<td>1.00%</td>
</tr>
<tr>
<td>pulldown-cmark</td>
<td>6,741,922.18</td>
<td>6632833.42</td>
<td>1.64%</td>
</tr>
<tr>
<td>shootout-ed25519</td>
<td>9,569,702,876.44</td>
<td>9402544055</td>
<td>1.78%</td>
</tr>
<tr>
<td>shootout-nestedloop</td>
<td>504.38</td>
<td>494.38</td>
<td>2.02%</td>
</tr>
<tr>
<td>blake3-simd</td>
<td>313,143.94</td>
<td>305664.92</td>
<td>2.45%</td>
</tr>
<tr>
<td>shootout-xblabla20</td>
<td>3,011,040.94</td>
<td>2926801.38</td>
<td>2.88%</td>
</tr>
<tr>
<td>shootout-seqhash</td>
<td>8,868,767,466.20</td>
<td>8580074421</td>
<td>3.36%</td>
</tr>
<tr>
<td>shootout-ctype</td>
<td>830,871,263.52</td>
<td>796659320</td>
<td>4.29%</td>
</tr>
<tr>
<td>shootout-sieve</td>
<td>906,201,119.02</td>
<td>841387362.9</td>
<td>7.70%</td>
</tr>
<tr>
<td>shootout-base64</td>
<td>381,928,675.18</td>
<td>352966325.4</td>
<td>8.21%</td>
</tr>
<tr>
<td>shootout-ackermann</td>
<td>8,657,031.60</td>
<td>7770921.4</td>
<td>11.40%</td>
</tr>
<tr>
<td>shootout-minicsv</td>
<td>1,478,013,885.20</td>
<td>1292314209</td>
<td>14.37%</td>
</tr>
<tr>
<td>shootout-keccak</td>
<td>25,147,664.38</td>
<td>21106966.72</td>
<td>19.14%</td>
</tr>
<tr>
<td>shootout-random</td>
<td>630,552,185.72</td>
<td>439772361.1</td>
<td>43.38%</td>
</tr>
</tbody>
</table>
</blockquote>



<a name="561842832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561842832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561842832">(Dec 04 2025 at 10:33)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3611396520">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>With the DeMorgan rules removed, the performance degrades are almost gone except for the "switch" case.</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th style="text-align: right;">No Opts</th>
<th style="text-align: right;">Base</th>
<th style="text-align: right;">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>shootout-switch</td>
<td style="text-align: right;">139,551,486</td>
<td style="text-align: right;">153,696,081</td>
<td style="text-align: right;">-9.20%</td>
</tr>
<tr>
<td>shootout-ratelimit</td>
<td style="text-align: right;">39,173,257</td>
<td style="text-align: right;">39,952,951</td>
<td style="text-align: right;">-1.95%</td>
</tr>
<tr>
<td>shootout-xchacha20</td>
<td style="text-align: right;">4,380,029</td>
<td style="text-align: right;">4,444,076</td>
<td style="text-align: right;">-1.44%</td>
</tr>
<tr>
<td>regex</td>
<td style="text-align: right;">210,231,631</td>
<td style="text-align: right;">212,953,957</td>
<td style="text-align: right;">-1.28%</td>
</tr>
<tr>
<td>shootout-gimli</td>
<td style="text-align: right;">5,345,271</td>
<td style="text-align: right;">5,404,314</td>
<td style="text-align: right;">-1.09%</td>
</tr>
<tr>
<td>shootout-fib2</td>
<td style="text-align: right;">3,010,356,555</td>
<td style="text-align: right;">3,010,366,675</td>
<td style="text-align: right;">0.00%</td>
</tr>
<tr>
<td>shootout-matrix</td>
<td style="text-align: right;">539,106,883</td>
<td style="text-align: right;">538,754,055</td>
<td style="text-align: right;">0.07%</td>
</tr>
<tr>
<td>shootout-heapsort</td>
<td style="text-align: right;">2,378,812,048</td>
<td style="text-align: right;">2,375,114,650</td>
<td style="text-align: right;">0.16%</td>
</tr>
<tr>
<td>spidermonkey</td>
<td style="text-align: right;">636,143,610</td>
<td style="text-align: right;">633,256,160</td>
<td style="text-align: right;">0.46%</td>
</tr>
<tr>
<td>bz2</td>
<td style="text-align: right;">87,099,313</td>
<td style="text-align: right;">86,442,047</td>
<td style="text-align: right;">0.76%</td>
</tr>
<tr>
<td>shootout-memmove</td>
<td style="text-align: right;">36,569,713</td>
<td style="text-align: right;">36,246,023</td>
<td style="text-align: right;">0.89%</td>
</tr>
<tr>
<td>blake3-scalar</td>
<td style="text-align: right;">319,176</td>
<td style="text-align: right;">316,024</td>
<td style="text-align: right;">1.00%</td>
</tr>
<tr>
<td>pulldown-cmark</td>
<td style="text-align: right;">6,741,922</td>
<td style="text-align: right;">6,632,833</td>
<td style="text-align: right;">1.64%</td>
</tr>
<tr>
<td>shootout-ed25519</td>
<td style="text-align: right;">9,569,702,876</td>
<td style="text-align: right;">9,402,544,055</td>
<td style="text-align: right;">1.78%</td>
</tr>
<tr>
<td>shootout-nestedloop</td>
<td style="text-align: right;">504</td>
<td style="text-align: right;">494</td>
<td style="text-align: right;">2.02%</td>
</tr>
<tr>
<td>blake3-simd</td>
<td style="text-align: right;">313,144</td>
<td style="text-align: right;">305,665</td>
<td style="text-align: right;">2.45%</td>
</tr>
<tr>
<td>shootout-xblabla20</td>
<td style="text-align: right;">3,011,041</td>
<td style="text-align: right;">2,926,801</td>
<td style="text-align: right;">2.88%</td>
</tr>
<tr>
<td>shootout-seqhash</td>
<td style="text-align: right;">8,868,767,466</td>
<td style="text-align: right;">8,580,074,421</td>
<td style="text-align: right;">3.36%</td>
</tr>
<tr>
<td>shootout-ctype</td>
<td style="text-align: right;">830,871,264</td>
<td style="text-align: right;">796,659,320</td>
<td style="text-align: right;">4.29%</td>
</tr>
<tr>
<td>shootout-sieve</td>
<td style="text-align: right;">906,201,119</td>
<td style="text-align: right;">841,387,363</td>
<td style="text-align: right;">7.70%</td>
</tr>
<tr>
<td>shootout-base64</td>
<td style="text-align: right;">381,928,675</td>
<td style="text-align: right;">352,966,325</td>
<td style="text-align: right;">8.21%</td>
</tr>
<tr>
<td>shootout-ackermann</td>
<td style="text-align: right;">8,657,032</td>
<td style="text-align: right;">7,770,921</td>
<td style="text-align: right;">11.40%</td>
</tr>
<tr>
<td>shootout-minicsv</td>
<td style="text-align: right;">1,478,013,885</td>
<td style="text-align: right;">1,292,314,209</td>
<td style="text-align: right;">14.37%</td>
</tr>
<tr>
<td>shootout-keccak</td>
<td style="text-align: right;">25,147,664</td>
<td style="text-align: right;">21,106,967</td>
<td style="text-align: right;">19.14%</td>
</tr>
<tr>
<td>shootout-random</td>
<td style="text-align: right;">630,552,186</td>
<td style="text-align: right;">439,772,361</td>
<td style="text-align: right;">43.38%</td>
</tr>
<tr>
<td></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="561842972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561842972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561842972">(Dec 04 2025 at 10:34)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3611396520">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>With the DeMorgan rules removed, the performance degrades are almost gone except for the "switch" case.<br>
keccak enjoys <strong>19.14% execution performance improvement</strong>.</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th style="text-align: right;">No Opts</th>
<th style="text-align: right;">Base</th>
<th style="text-align: right;">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>shootout-switch</td>
<td style="text-align: right;">139,551,486</td>
<td style="text-align: right;">153,696,081</td>
<td style="text-align: right;">-9.20%</td>
</tr>
<tr>
<td>shootout-ratelimit</td>
<td style="text-align: right;">39,173,257</td>
<td style="text-align: right;">39,952,951</td>
<td style="text-align: right;">-1.95%</td>
</tr>
<tr>
<td>shootout-xchacha20</td>
<td style="text-align: right;">4,380,029</td>
<td style="text-align: right;">4,444,076</td>
<td style="text-align: right;">-1.44%</td>
</tr>
<tr>
<td>regex</td>
<td style="text-align: right;">210,231,631</td>
<td style="text-align: right;">212,953,957</td>
<td style="text-align: right;">-1.28%</td>
</tr>
<tr>
<td>shootout-gimli</td>
<td style="text-align: right;">5,345,271</td>
<td style="text-align: right;">5,404,314</td>
<td style="text-align: right;">-1.09%</td>
</tr>
<tr>
<td>shootout-fib2</td>
<td style="text-align: right;">3,010,356,555</td>
<td style="text-align: right;">3,010,366,675</td>
<td style="text-align: right;">0.00%</td>
</tr>
<tr>
<td>shootout-matrix</td>
<td style="text-align: right;">539,106,883</td>
<td style="text-align: right;">538,754,055</td>
<td style="text-align: right;">0.07%</td>
</tr>
<tr>
<td>shootout-heapsort</td>
<td style="text-align: right;">2,378,812,048</td>
<td style="text-align: right;">2,375,114,650</td>
<td style="text-align: right;">0.16%</td>
</tr>
<tr>
<td>spidermonkey</td>
<td style="text-align: right;">636,143,610</td>
<td style="text-align: right;">633,256,160</td>
<td style="text-align: right;">0.46%</td>
</tr>
<tr>
<td>bz2</td>
<td style="text-align: right;">87,099,313</td>
<td style="text-align: right;">86,442,047</td>
<td style="text-align: right;">0.76%</td>
</tr>
<tr>
<td>shootout-memmove</td>
<td style="text-align: right;">36,569,713</td>
<td style="text-align: right;">36,246,023</td>
<td style="text-align: right;">0.89%</td>
</tr>
<tr>
<td>blake3-scalar</td>
<td style="text-align: right;">319,176</td>
<td style="text-align: right;">316,024</td>
<td style="text-align: right;">1.00%</td>
</tr>
<tr>
<td>pulldown-cmark</td>
<td style="text-align: right;">6,741,922</td>
<td style="text-align: right;">6,632,833</td>
<td style="text-align: right;">1.64%</td>
</tr>
<tr>
<td>shootout-ed25519</td>
<td style="text-align: right;">9,569,702,876</td>
<td style="text-align: right;">9,402,544,055</td>
<td style="text-align: right;">1.78%</td>
</tr>
<tr>
<td>shootout-nestedloop</td>
<td style="text-align: right;">504</td>
<td style="text-align: right;">494</td>
<td style="text-align: right;">2.02%</td>
</tr>
<tr>
<td>blake3-simd</td>
<td style="text-align: right;">313,144</td>
<td style="text-align: right;">305,665</td>
<td style="text-align: right;">2.45%</td>
</tr>
<tr>
<td>shootout-xblabla20</td>
<td style="text-align: right;">3,011,041</td>
<td style="text-align: right;">2,926,801</td>
<td style="text-align: right;">2.88%</td>
</tr>
<tr>
<td>shootout-seqhash</td>
<td style="text-align: right;">8,868,767,466</td>
<td style="text-align: right;">8,580,074,421</td>
<td style="text-align: right;">3.36%</td>
</tr>
<tr>
<td>shootout-ctype</td>
<td style="text-align: right;">830,871,264</td>
<td style="text-align: right;">796,659,320</td>
<td style="text-align: right;">4.29%</td>
</tr>
<tr>
<td>shootout-sieve</td>
<td style="text-align: right;">906,201,119</td>
<td style="text-align: right;">841,387,363</td>
<td style="text-align: right;">7.70%</td>
</tr>
<tr>
<td>shootout-base64</td>
<td style="text-align: right;">381,928,675</td>
<td style="text-align: right;">352,966,325</td>
<td style="text-align: right;">8.21%</td>
</tr>
<tr>
<td>shootout-ackermann</td>
<td style="text-align: right;">8,657,032</td>
<td style="text-align: right;">7,770,921</td>
<td style="text-align: right;">11.40%</td>
</tr>
<tr>
<td>shootout-minicsv</td>
<td style="text-align: right;">1,478,013,885</td>
<td style="text-align: right;">1,292,314,209</td>
<td style="text-align: right;">14.37%</td>
</tr>
<tr>
<td>shootout-keccak</td>
<td style="text-align: right;">25,147,664</td>
<td style="text-align: right;">21,106,967</td>
<td style="text-align: right;">19.14%</td>
</tr>
<tr>
<td>shootout-random</td>
<td style="text-align: right;">630,552,186</td>
<td style="text-align: right;">439,772,361</td>
<td style="text-align: right;">43.38%</td>
</tr>
<tr>
<td></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="561843572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561843572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561843572">(Dec 04 2025 at 10:37)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3611418089">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Unlike the addition-reassoc rule, the DeMorgan rule does not use <code>subsume</code> which destructively rewrites instructions.<br>
How, the DeMorgan form wins over the none-optimized form? I thought the most cost-efficient instruction sequence (or somehow with good performance heuristic) would be selected.</p>
</blockquote>



<a name="561927952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/561927952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#561927952">(Dec 04 2025 at 16:45)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3613181538">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<blockquote>
<p>I thought the most cost-efficient instruction sequence (or somehow with good performance heuristic) would be selected.</p>
</blockquote>
<p>That's a good next question to investigate! You could get the egraph with multiple value representations from the log and look at the cost of each form. Our cost function is still pretty basic right now, and there hasn't been, e.g., an effort to try to correlate to real machines; only a relative ranking of opcode classes. Remember also that we don't do any sort of reasoning about amortized/shared cost of computing values used multiple times, nor do we integrate with regalloc to reason about register pressure (both are, as noted above, NP-hard problems).</p>
</blockquote>



<a name="562009440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562009440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562009440">(Dec 05 2025 at 02:19)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3615043494">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>There is a strong evidence that the cost model has a bug when the input function is large.</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">--- keccak-no-opts.clif 2025-12-04 08:22:28.715675257 +0000</span>
<span class="gi">+++ keccak-main.clif    2025-12-04 08:18:25.654976355 +0000</span>
<span class="gu">@@ -116,10 +116,10 @@</span>
<span class="w"> </span>@0244                               v153 = bxor v152, v67
<span class="w"> </span>@0245                               v154 = iconst.i64 19
<span class="w"> </span>@0247                               v155 = ushr v153, v154  ; v154 = 19
<span class="gd">-@024e                               v157 = band v155, v40  ; v40 = 0xffff_ffff</span>
<span class="gd">-@0251                               v158 = iconst.i64 -1</span>
<span class="gd">-@0253                               v159 = bxor v157, v158  ; v158 = -1</span>
<span class="gd">-@0254                               v160 = band v87, v159</span>
<span class="gi">+                                    v6989 = bnot v155</span>
<span class="gi">+                                    v6991 = iconst.i64 -4294967296</span>
<span class="gi">+                                    v6992 = bor v6989, v6991  ; v6991 = -4294967296</span>
<span class="gi">+@0254                               v160 = band v87, v6992</span>
</code></pre></div>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-@11dd      v1561 = bxor v1220, v158  ; v158 = -1</span>
<span class="gd">-@11de      v1562 = band v1430, v1561</span>
<span class="gi">+                v7626 = bnot v1215</span>
<span class="gi">+                v7627 = bnot v1217</span>
<span class="gi">+                v7628 = band v7626, v7627</span>
<span class="gi">+                v7630 = bor v7628, v6991  ; v6991 = -4294967296</span>
<span class="gi">+@11de     v1562 = band v1430, v7630</span>
</code></pre></div>
<p>First, the deoptimizing code pattern only appears when the instruction count exceed a certain point. Such deoptimization does not occur near the beginning of the function.</p>
<p>Second, the cost model uses the optimizing pattern as intended near the beginning of the function. For example, it works well for v160. However, as cost "accumulates", all the costs are now "infinite". (See v1562 below) Thus, the cost model cannot choose the optimizing pattern ending up generating the undesired instruction sequence.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span>
<span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="n">T02</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">28</span><span class="n">Z</span><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">egraph</span><span class="p">::</span><span class="n">elaborate</span><span class="p">]</span><span class="w">  </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">cost</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">v160</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cost</span><span class="p">::</span><span class="n">Finite</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">op_cost</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">}</span>
<span class="o">..</span><span class="p">.</span>
<span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="n">T02</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">28</span><span class="n">Z</span><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">egraph</span><span class="p">::</span><span class="n">elaborate</span><span class="p">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">best</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">eclass</span><span class="w"> </span><span class="n">v1562</span><span class="p">:</span><span class="w"> </span><span class="nc">BestEntry</span><span class="p">(</span><span class="n">Cost</span><span class="p">::</span><span class="n">Infinite</span><span class="p">,</span><span class="w"> </span><span class="n">v1562</span><span class="p">)</span>
</code></pre></div>
</blockquote>



<a name="562010019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562010019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562010019">(Dec 05 2025 at 02:26)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3615054692">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/9dc6a7d01fb5f5573666bd9aa4788da05af4bb09/cranelift/codegen/src/egraph/elaborate.rs#L336-L351">https://github.com/bytecodealliance/wasmtime/blob/9dc6a7d01fb5f5573666bd9aa4788da05af4bb09/cranelift/codegen/src/egraph/elaborate.rs#L336-L351</a></p>
<p>Seems like this is the case.</p>
</blockquote>



<a name="562010275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562010275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562010275">(Dec 05 2025 at 02:29)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3615054692">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/9dc6a7d01fb5f5573666bd9aa4788da05af4bb09/cranelift/codegen/src/egraph/elaborate.rs#L336-L351">https://github.com/bytecodealliance/wasmtime/blob/9dc6a7d01fb5f5573666bd9aa4788da05af4bb09/cranelift/codegen/src/egraph/elaborate.rs#L336-L351</a></p>
<p>Seems like this is the case. The README.md mentioned in the comment says <em>Rules should not rewrite to worse code</em>, however the de morgan rules do generate worse codes.</p>
<p>Now, we have options as follows:</p>
<ol>
<li>We should update the cost model to take this possiblity into account, but this can make a large diff on the generated codes we are testing as of now, or</li>
<li>simply delete the rules to upholad the contract mentioned in README.md (+ enforce the rule with ISLE meta-compiler checking the cost "strictly" reduces) </li>
</ol>
</blockquote>



<a name="562019919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562019919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562019919">(Dec 05 2025 at 04:43)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3615043494">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>There is a strong evidence that the cost model has a bug when the input function is large.</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">--- keccak-no-opts.clif 2025-12-04 08:22:28.715675257 +0000</span>
<span class="gi">+++ keccak-main.clif    2025-12-04 08:18:25.654976355 +0000</span>
<span class="gu">@@ -116,10 +116,10 @@</span>
<span class="w"> </span>@0244                               v153 = bxor v152, v67
<span class="w"> </span>@0245                               v154 = iconst.i64 19
<span class="w"> </span>@0247                               v155 = ushr v153, v154  ; v154 = 19
<span class="gd">-@024e                               v157 = band v155, v40  ; v40 = 0xffff_ffff</span>
<span class="gd">-@0251                               v158 = iconst.i64 -1</span>
<span class="gd">-@0253                               v159 = bxor v157, v158  ; v158 = -1</span>
<span class="gd">-@0254                               v160 = band v87, v159</span>
<span class="gi">+                                    v6989 = bnot v155</span>
<span class="gi">+                                    v6991 = iconst.i64 -4294967296</span>
<span class="gi">+                                    v6992 = bor v6989, v6991  ; v6991 = -4294967296</span>
<span class="gi">+@0254                               v160 = band v87, v6992</span>
</code></pre></div>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-@11dd      v1561 = bxor v1220, v158  ; v158 = -1</span>
<span class="gd">-@11de      v1562 = band v1430, v1561</span>
<span class="gi">+                v7626 = bnot v1215</span>
<span class="gi">+                v7627 = bnot v1217</span>
<span class="gi">+                v7628 = band v7626, v7627</span>
<span class="gi">+                v7630 = bor v7628, v6991  ; v6991 = -4294967296</span>
<span class="gi">+@11de     v1562 = band v1430, v7630</span>
</code></pre></div>
<p>First, the deoptimizing code pattern only appears when the instruction counts exceed a certain point. For example, at the code point <code>@0254</code>, the optimized code is okay.  But at <code>@11de</code>, deoptimization happens.</p>
<p>Second, the cost model selects the optimized code as intended near the beginning of the function. For example, it works well for v160. However, as cost "accumulates", all the costs are now "infinite". (See v1562 below) Thus, the cost model cannot choose the optimizing pattern ending up generating the undesired instruction sequence.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span>
<span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="n">T02</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">28</span><span class="n">Z</span><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">egraph</span><span class="p">::</span><span class="n">elaborate</span><span class="p">]</span><span class="w">  </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">cost</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">v160</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cost</span><span class="p">::</span><span class="n">Finite</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">op_cost</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">}</span>
<span class="o">..</span><span class="p">.</span>
<span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="n">T02</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">28</span><span class="n">Z</span><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">egraph</span><span class="p">::</span><span class="n">elaborate</span><span class="p">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">best</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">eclass</span><span class="w"> </span><span class="n">v1562</span><span class="p">:</span><span class="w"> </span><span class="nc">BestEntry</span><span class="p">(</span><span class="n">Cost</span><span class="p">::</span><span class="n">Infinite</span><span class="p">,</span><span class="w"> </span><span class="n">v1562</span><span class="p">)</span>
</code></pre></div>
</blockquote>



<a name="562020045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562020045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562020045">(Dec 05 2025 at 04:44)</a>:</h4>
<p>bongjunj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3615054692">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/9dc6a7d01fb5f5573666bd9aa4788da05af4bb09/cranelift/codegen/src/egraph/elaborate.rs#L336-L351">https://github.com/bytecodealliance/wasmtime/blob/9dc6a7d01fb5f5573666bd9aa4788da05af4bb09/cranelift/codegen/src/egraph/elaborate.rs#L336-L351</a></p>
<p>It seems like the cost model is causing a problem with the canonicalizing rules when selecting instructions in large functions. The README.md mentioned in the comment says <em>Rules should not rewrite to worse code</em>, however the de morgan rules do generate worse codes.</p>
<p>Now, we have options as follows:</p>
<ol>
<li>We should update the cost model to take this possiblity into account, but this can make a large diff on the generated codes we are testing as of now, or</li>
<li>simply delete the rules to upholad the contract mentioned in README.md (+ enforce the rule with ISLE meta-compiler checking the cost "strictly" reduces) </li>
</ol>
</blockquote>



<a name="562028505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562028505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562028505">(Dec 05 2025 at 06:18)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3615471716">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Fascinating. In general cost will only accumulate if there are very long chains, unbroken by any blockparams. I guess we're seeing exactly that in some benchmarks.</p>
<p>If that's the case, I agree we should delete rules that don't have a clear directionality.</p>
<p>I don't see a pairwise comparison above of all-opts versus all-opts-minus-DeMorgan. I want to make sure that they don't show improvements on other benchmarks that we'd be discarding. Could you do that run as well? Thanks!</p>
</blockquote>



<a name="562147137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562147137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562147137">(Dec 05 2025 at 17:02)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3617737104">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>I wouldn't have expected that we would actually hit <code>Cost::Infinity</code> except in very rare cases. It makes me wonder if we should instead investigate widening <code>Cost</code>.</p>
</blockquote>



<a name="562147883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562147883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562147883">(Dec 05 2025 at 17:05)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3617746528">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Wait, we have 24 bits for the op cost, so we shouldn't be hitting infinity until we have on the order of millions deep chains of ops.</p>
<p>It seems like something else funky might be going on here.</p>
</blockquote>



<a name="562156030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562156030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562156030">(Dec 05 2025 at 17:52)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3617902545">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>In <code>keccak</code>, the largest value is <code>v43210</code>. Our largest individual op cost is 64.</p>
<blockquote>
<p>Wait, we have 24 bits for the op cost, so we shouldn't be hitting infinity until we have on the order of millions deep chains of ops.</p>
</blockquote>
<p>But I guess actually it isn't <em>chains</em> but the whole tree, which makes hitting infinite cost more understandable, but still not ideal because I suspect it does not accurately reflect the real costs here.</p>
<p>This is because <code>Cost</code> doesn't take into account shared structure. For example, <code>iadd v0, v0</code> should be <code>cost_of_opcode(iadd) + cost_of_operand(v0)</code>, but the current code will compute <code>cost_of_opcode(iadd) + cost_of_operand(v0) + cost_of_operand(v0)</code>. It shouldn't count the cost of <code>v0</code> twice but it will. Now fixing this particular case, where operands are repeated in the same operation, would be relatively straightforward to fix. But fixing this in the general case, where <code>v0</code> is never repeated within a single operation but is repeated at multiple levels of operations in the same expression, is a bit more difficult.</p>
<p>We <em>could</em> try to maintain the transitive set of all values that contributed to a cost in the cost, and only add new cost for new values (although this maybe doesn't accurately reflect register pressure and spills for very large expressions). That could be done in a perhaps not-horrendous manner via immutable persistent sets so that we aren't <em>completely</em> blowing up memory usage. But I suspect it would still be a large slow-down to our best-cost computation.</p>
</blockquote>



<a name="562156316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562156316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562156316">(Dec 05 2025 at 17:54)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3617908684">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>So yeah, this leads me back towards:</p>
<blockquote>
<p>It makes me wonder if we should instead investigate widening <code>Cost</code>.</p>
</blockquote>
<p>We could probably do this without growing the size of <code>Cost</code> by just using less bits for depth and more for the total opcode cost.</p>
</blockquote>



<a name="562157251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562157251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562157251">(Dec 05 2025 at 18:00)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3617929938">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>(Maybe we should even stop considering depth as part of <code>Cost</code>?)</p>
<p>Anyways, I'm doing a quick experiment to see the difference when we switch <code>Cost</code> from <code>{ op: u24, depth: u8 }</code> to <code>{ op: u28, depth: u4 }</code> to see if this frees up enough bits such that we don't hit infinite cost here.</p>
</blockquote>



<a name="562164468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562164468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562164468">(Dec 05 2025 at 18:49)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618124394">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>It seems like <code>keccak</code> has enough shared structure that moving more bits from depth to op actually makes more eclasses have infinite cost (that is, they saturate op cost before saturating depth, so lowering the depth bits just makes more things saturate both op and depth, i.e. be infinite).</p>
<table>
<thead>
<tr>
<th><code>Cost</code> layout</th>
<th>total # eclasses in <code>keccak</code></th>
<th># infinit-cost eclasses in <code>keccak</code></th>
<th>% infinite-cost eclasses in <code>keccak</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{ op: u32, depth: u0 }</code></td>
<td>43211</td>
<td>31474</td>
<td>1.37%</td>
</tr>
<tr>
<td><code>{ op: u28, depth: u4 }</code></td>
<td>43211</td>
<td>33057</td>
<td>1.31%</td>
</tr>
<tr>
<td><code>{ op: u24, depth: u8 }</code> (today's layout)</td>
<td>43211</td>
<td>34704</td>
<td>1.25%</td>
</tr>
</tbody>
</table>
<p>Increasing the number of <code>depth</code> bits would probably make fewer eclasses have infinite cost, but we would also be extracting a larger percentage of them purely based on depth (since more of them would saturate the op portion of cost) which doesn't seem desirable.</p>
<p>The other thing we could do is move <code>Cost</code> from bitpacking into a <code>u32</code> to bitpacking into a <code>u64</code> or even a <code>u128</code> but this would only add support for on the order of 32 and 96 respectively deeper expressions before hitting infinite cost again, which isn't very much. (Assuming we don't attempt to start representing shared structure in <code>Cost</code>).</p>
<p>So probably, at least in the short term, removing the demorgan rule (<a href="https://github.com/bytecodealliance/wasmtime/pull/12127">https://github.com/bytecodealliance/wasmtime/pull/12127</a>) actually is probably the best incremental/practical step forward, even though I was initially skeptical.</p>
<p>Perhaps we should also be breaking cost ties with a bias towards the original input, on the assumption that the producer knows better than us if we can't tell if our rewrites are actually improvements or not. But looking at <a href="https://github.com/bytecodealliance/wasmtime/blob/050d7794c5c72c2a6ee8ce60e6cd9f8eb2d0d02a/cranelift/codegen/src/egraph/elaborate.rs#L282">the code</a>, it does seem like we take the minimum <code>BestEntry</code>, which if <code>Cost</code> is tied means we will in fact break ties with lower-numbered values (i.e. biasing towards the originals). So we are already doing this.</p>
<p>Fundamentally improving things here will require a cost function that understands shared structure, which, unless someone has an idea I haven't thought up yet, is almost definitely too expensive for the niche that Cranelift sits in.</p>
</blockquote>



<a name="562165268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562165268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562165268">(Dec 05 2025 at 18:55)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618146034">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Yes, in particular because there seem to be no major regressions without the rules, I think the choice here is easy. It is unfortunate that we can't lean more heavily on cost optimization but (to write it down explicitly) doing cost optimization with shared structure is as hard as the <a href="https://en.wikipedia.org/wiki/Set_cover_problem">weighted set-cover problem</a> (that is, the latter can be reduced to a graph with shared structure on which we want to pick the lowest-cost implementations of terminals), so it's NP-hard. That doesn't mean there isn't a good approximation algorithm of course, but we won't solve that in this PR I don't think!</p>
</blockquote>



<a name="562168911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562168911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562168911">(Dec 05 2025 at 19:19)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618242872">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<blockquote>
<p>That doesn't mean there isn't a good approximation algorithm of course,</p>
</blockquote>
<p>Yeah, I suspect the trouble really begins when you want to make one expression in the current eclass have cheaper cost because we've already committed to computing some of its sub-expressions via choosing them as part of the best version of a different eclass.</p>
<p>If we limit ourselves to just the shared structure within a single expression in isolation from the best cost/expression we computed for different eclasses (i.e. only adding the cost of operand <code>v123</code> once when computing the cost of a particular expression, ignoring what was chosen as best for other eclassses) then things seem pretty tractable, although still too expensive for Cranelift.</p>
<blockquote>
<p>but we won't solve that in this PR I don't think!</p>
</blockquote>
<p>Right, which is why I'm commenting on the issue, not the PR :-p</p>
</blockquote>



<a name="562168952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562168952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562168952">(Dec 05 2025 at 19:19)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I performance-tested a no-opt version of Cranelift without ISLE mid-end optimizations. (You can confirmed this at <a href="https://github.com/prosyslab/wasmtime/commit/c0df585025897098e83703cca343e139ed30a119">https://github.com/prosyslab/wasmtime/commit/c0df585025897098e83703cca343e139ed30a119</a>)</p>
<p>Compared to the latest version of upstream Cranelift, surprisingly, the no-opt version produced a significantly faster x86_64 code for blake3, keccak, xchacha20. This experiment is conducted using the sightglass-cli.</p>
<p>Given that only mid-end rules are removed, some codegen backend might causing problem interacting with the mid-end. I want to investigate this problem, but I'm completely lost which part to look at first. Any comments will be appreciated.</p>
<p>Here is the demonstration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">pin</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.08</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">sightglass</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">engines</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">v</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">pin</span><span class="err">`</span>

<span class="n">execution</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">502562.18</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">4271.59</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">2.55</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">2.58</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">816778</span><span class="w"> </span><span class="mf">823363.48</span><span class="w"> </span><span class="mi">880808</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">315506</span><span class="w"> </span><span class="mf">320801.30</span><span class="w"> </span><span class="mi">460046</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">51372480.98</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">1109163.62</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.19</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.20</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">310860540</span><span class="w"> </span><span class="mf">313559414.86</span><span class="w"> </span><span class="mi">330384818</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">260245364</span><span class="w"> </span><span class="mf">262186933.88</span><span class="w"> </span><span class="mi">278160088</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">cycles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">17444.42</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">10445.70</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.06</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.23</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">90902</span><span class="w"> </span><span class="mf">137381.98</span><span class="w"> </span><span class="mi">258206</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">87766</span><span class="w"> </span><span class="mf">119937.56</span><span class="w"> </span><span class="mi">198140</span><span class="p">]</span><span class="w"> </span><span class="n">no</span><span class="o">-</span><span class="n">opts</span><span class="o">/</span><span class="n">libengine</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>Plus, here are some data for other benchmarks.<br>
<code>--iterations-per-process 10 --benchmark-phase execution ----pin</code> is used.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">bench</th>
<th style="text-align: right;">v-no-opts</th>
<th style="text-align: right;">base</th>
<th style="text-align: right;"> speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">blake3-scalar</td>
<td style="text-align: right;">320,225</td>
<td style="text-align: right;">868,750</td>
<td style="text-align: right;">-63.14%</td>
</tr>
<tr>
<td style="text-align: left;">blake3-simd</td>
<td style="text-align: right;">320,689</td>
<td style="text-align: right;">945,427</td>
<td style="text-align: right;">-66.08%</td>
</tr>
<tr>
<td style="text-align: left;">bz2</td>
<td style="text-align: right;">88,887,466</td>
<td style="text-align: right;">86,904,121</td>
<td style="text-align: right;">2.28%</td>
</tr>
<tr>
<td style="text-align: left;">pulldown-cmark</td>
<td style="text-align: right;">6,630,447</td>
<td style="text-align: right;">6,705,562</td>
<td style="text-align: right;">-1.12%</td>
</tr>
<tr>
<td style="text-align: left;">regex</td>
<td style="text-align: right;">209,902,394</td>
<td style="text-align: right;">211,477,705</td>
<td style="text-align: right;">-0.74%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-base64</td>
<td style="text-align: right;">383,700,851</td>
<td style="text-align: right;">352,817,318</td>
<td style="text-align: right;">8.75%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-keccak</td>
<td style="text-align: right;">25,589,899</td>
<td style="text-align: right;">49,540,506</td>
<td style="text-align: right;">-48.35%</td>
</tr>
<tr>
<td style="text-align: left;">shootout-xchacha20</td>
<td style="text-align: right;">4,489,570</td>
<td style="text-align: right;">4,816,315</td>
<td style="text-align: right;">-6.78%</td>
</tr>
<tr>
<td style="text-align: left;">spidermonkey</td>
<td style="text-align: right;">644,434,235</td>
<td style="text-align: right;">627,374,660</td>
<td style="text-align: right;">2.72%</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="562171189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562171189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562171189">(Dec 05 2025 at 19:35)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618298815">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>(D'oh, sorry, too many tabs open -- yes, this is indeed the issue and not the PR :-) )</p>
<p>It seems there are at least two possible directions for approximations to true cost minimization:</p>
<ul>
<li>We could divide/amortize the cost by the number of users of any given value. This would require a little care with the union nodes -- we would want to "see through" the union-spin to the whole eclass and consider it as one. But e.g. if 100 users are asking for a value of cost 100, or alternately each uses its own input of cost 2, this would do the right thing.<ul>
<li>This maintains the phased aspect (all costs computable before we pick winners) but feels "more approximate"</li>
</ul>
</li>
<li>We could dynamically update costs as min-cost values are picked for classes -- so e.g. if I've already decided to use a value, then all subsequent uses get to use it for (additional/marginal) cost 0. This one is tricky because it requires mixing together the cost computation and min-cost choices.</li>
</ul>
<p>@bongjunj if you're looking for interesting concrete research problems, this one might be a good one to play with!</p>
</blockquote>



<a name="562171232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562171232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562171232">(Dec 05 2025 at 19:35)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618298815">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>(D'oh, sorry, too many tabs open -- yes, this is indeed the issue and not the PR :-) )</p>
<p>It seems there are at least two possible directions for approximations to true cost minimization:</p>
<ul>
<li>We could divide/amortize the cost by the number of users of any given value. This would require a little care with the union nodes -- we would want to "see through" the union-spine to the whole eclass and consider it as one. But e.g. if 100 users are asking for a value of cost 100, or alternately each uses its own input of cost 2, this would do the right thing.<ul>
<li>This maintains the phased aspect (all costs computable before we pick winners) but feels "more approximate"</li>
</ul>
</li>
<li>We could dynamically update costs as min-cost values are picked for classes -- so e.g. if I've already decided to use a value, then all subsequent uses get to use it for (additional/marginal) cost 0. This one is tricky because it requires mixing together the cost computation and min-cost choices.</li>
</ul>
<p>@bongjunj if you're looking for interesting concrete research problems, this one might be a good one to play with!</p>
</blockquote>



<a name="562173851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562173851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562173851">(Dec 05 2025 at 19:55)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618384553">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<blockquote>
<p>Now fixing this particular case, where operands are repeated in the same operation, would be relatively straightforward to fix.</p>
</blockquote>
<p>FWIW, I hacked this trivial-case fix together to get numbers, and it did not change the infinite-cost-eclass count in <code>keccak</code> at all.</p>
</blockquote>



<a name="562176334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562176334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562176334">(Dec 05 2025 at 20:15)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3618446995">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<blockquote>
<ul>
<li>We could divide/amortize the cost by the number of users of any given value.</li>
</ul>
</blockquote>
<p>The tricky bit here is that if these are "uncommitted" uses (i.e. incoming edges for each enode) rather than "committed" uses (i.e. uses from enodes that we chose as the best in their eclass) then the use count is kind of useless. There might be a bunch of uses inside the egraph, making the enode's cost cheap, but then if we don't actually extract those uses then it was all just a lie. How bad this will be in practice depends on the size of the saturated vs initial egraph.</p>
<p>On the other hand, if these are "committed" uses, then we <em>wouldn't</em> maintain the phasing, which leads to things getting <em>really</em> tricky, as you noted.</p>
<hr>
<p>If we aren't maintaining phasing, then we could, for example, do something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">inst</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">skeleton</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">compute_best_costs</span><span class="p">();</span>
<span class="w">    </span><span class="n">elaborate_inst</span><span class="p">(</span><span class="n">inst</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Update costs for values we committed to computing so that the next iteration</span>
<span class="w">    </span><span class="c1">// of the loop can recompute best costs to bias towards reusing already-computed</span>
<span class="w">    </span><span class="c1">// values.</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">inst</span><span class="p">.</span><span class="n">operands</span><span class="p">().</span><span class="n">flat_map</span><span class="p">(</span><span class="o">|</span><span class="n">op</span><span class="o">|</span><span class="w"> </span><span class="n">transitive_values</span><span class="p">(</span><span class="n">op</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">set_cost</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>which is "only" <code>O(n^3)</code> (because <code>compute_best_costs</code> is an <code>O(n^2)</code> fixed point loop).</p>
<p>I guess we wouldn't need to complete the fixed point every time though. In practice I bet you would reach it with one or two iterations, but it also shouldn't ever be incorrect to stop and not choose the actual min cost but an approximation, so maybe doing just one more iteration of the fixed point loop is Good Enough after elaborating each instruction. This would keep things <code>O(n^2)</code> like they are today.</p>
<p>Anyways, yeah this is definitely an interesting research problem from my point of view, but I have no intentions of diving into this further so I'll stop commenting and try not to let myself be nerd-sniped any worse than I already have been this morning.</p>
</blockquote>



<a name="562388745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/562388745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#562388745">(Dec 08 2025 at 05:22)</a>:</h4>
<p>bongjunj <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3624975263">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@cfallin Thanks for the comment. I will look into those <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="563000872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312106%20Cranelift%3A%20ISLE%20mid-end%20performan.../near/563000872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312106.20Cranelift.3A.20ISLE.20mid-end.20performan.2E.2E.2E.html#563000872">(Dec 10 2025 at 16:40)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12106#issuecomment-3637987451">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12106">issue #12106</a>:</p>
<blockquote>
<p>@bongjunj btw, you might also take a look to <a href="https://github.com/egraphs-good/extraction-gym/">https://github.com/egraphs-good/extraction-gym/</a> for some inspiration as well. Good luck!</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>