<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10511 Invoke wave enhancements · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html">wasmtime / PR #10511 Invoke wave enhancements</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="509619073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509619073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509619073">(Apr 02 2025 at 07:19)</a>:</h4>
<p>tpmccallum opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a> from <code>tpmccallum:invoke_wave_enhancements</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR is in relation to the Zulip conversation at <a href="#narrow/channel/217126-wasmtime/topic/wasmtime-cli.3A.20support.20run.20--invoke.20for.20components.20using.20wave">#wasmtime &gt; wasmtime-cli: support run --invoke for components using wave</a>.</p>
<p>This PR includes @pchickey's <a href="https://github.com/bytecodealliance/wasmtime/pull/10054">existing PR 10054</a>.</p>
<p>There is an <a href="https://github.com/bytecodealliance/wasmtime/issues/10291">open issue</a> relating to this work.</p>
<p>Along with the changes, the documentation has also been updated accordingly (the changes in the<code>docs/cli-options.md</code> file of this PR).<br>
</p>
</blockquote>



<a name="509619077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509619077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509619077">(Apr 02 2025 at 07:19)</a>:</h4>
<p><strong>tpmccallum</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509619078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509619078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509619078">(Apr 02 2025 at 07:19)</a>:</h4>
<p><strong>tpmccallum</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509619079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509619079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509619079">(Apr 02 2025 at 07:19)</a>:</h4>
<p><strong>tpmccallum</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509621177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509621177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509621177">(Apr 02 2025 at 07:31)</a>:</h4>
<p>tpmccallum edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>This PR is in relation to the Zulip conversation at <a href="#narrow/channel/217126-wasmtime/topic/wasmtime-cli.3A.20support.20run.20--invoke.20for.20components.20using.20wave">#wasmtime &gt; wasmtime-cli: support run --invoke for components using wave</a>.</p>
<p>This PR includes @pchickey's <a href="https://github.com/bytecodealliance/wasmtime/pull/10054">existing PR 10054</a>. (Apologies @pchickey I could not see the <code>pch/invoke_wave</code> in the dropdown when trying to create a PR that would target your <code>pch/invoke_wave</code> branch; I'm not sure why <code>pch/invoke_wave</code> does not show up. When I pushed it generated this new 10511 PR and included all of your previous changes, so I hope we are still on the right path to getting this <code>--invoke</code> feature implemented.</p>
<p>There is an <a href="https://github.com/bytecodealliance/wasmtime/issues/10291">open issue</a> relating to this work.</p>
<p>Along with the changes, the documentation has also been updated accordingly (the changes in the<code>docs/cli-options.md</code> file of this PR).<br>
</p>
</blockquote>



<a name="509634868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509634868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509634868">(Apr 02 2025 at 08:38)</a>:</h4>
<p>tpmccallum edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>This PR is in relation to the Zulip conversation at <a href="#narrow/channel/217126-wasmtime/topic/wasmtime-cli.3A.20support.20run.20--invoke.20for.20components.20using.20wave">#wasmtime &gt; wasmtime-cli: support run --invoke for components using wave</a>.</p>
<p>This PR includes @pchickey's <a href="https://github.com/bytecodealliance/wasmtime/pull/10054">existing PR 10054</a>. (Apologies @pchickey I could not see the <code>pch/invoke_wave</code> in the dropdown when trying to create a PR that would target your <code>pch/invoke_wave</code> branch). I'm not sure why <code>pch/invoke_wave</code> does not show up. When I pushed it generated this new 10511 PR and included all of your previous changes, so I hope we are still on the right path to getting this <code>--invoke</code> feature implemented.</p>
<p>There is an <a href="https://github.com/bytecodealliance/wasmtime/issues/10291">open issue</a> relating to this work.</p>
<p>Along with the changes, the documentation has also been updated accordingly (the changes in the<code>docs/cli-options.md</code> file of this PR).<br>
</p>
</blockquote>



<a name="509635557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509635557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509635557">(Apr 02 2025 at 08:41)</a>:</h4>
<p>tpmccallum edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>This PR is in relation to the Zulip conversation at <a href="#narrow/channel/217126-wasmtime/topic/wasmtime-cli.3A.20support.20run.20--invoke.20for.20components.20using.20wave">#wasmtime &gt; wasmtime-cli: support run --invoke for components using wave</a>.</p>
<p>This PR includes @pchickey's <a href="https://github.com/bytecodealliance/wasmtime/pull/10054">existing PR 10054</a>. (Apologies @pchickey I could not see the <code>pch/invoke_wave</code> in the dropdown when trying to create a PR that would target your <code>pch/invoke_wave</code> branch). I'm not sure why <code>pch/invoke_wave</code> does not show up. When I pushed it generated this new 10511 PR and included all of your previous changes, so I hope we are still on the right path to getting this <code>--invoke</code> feature implemented.</p>
<p>There is an <a href="https://github.com/bytecodealliance/wasmtime/issues/10291">open issue</a> relating to this work.</p>
<p>Along with the changes, the documentation has also been updated accordingly (the changes in the<code>docs/cli-options.md</code> file of this PR).</p>
<p><strong>Functionality</strong></p>
<p>The invoke function works great:</p>
<p>Compress WIT:</p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>package example:component;

world compress {
    export compress: func(input: string) -&gt; list&lt;u8&gt;;
}
</code></pre></div>
<p><a href="http://lib.rs">lib.rs</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[allow(warnings)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">bindings</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="n">bindings</span><span class="p">::</span><span class="n">Guest</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">zstd</span><span class="p">::</span><span class="n">stream</span><span class="p">::</span><span class="n">encode_all</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Cursor</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Component</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">encode_all</span><span class="p">(</span><span class="n">Cursor</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()),</span><span class="w"> </span><span class="mi">5</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">bindings</span><span class="p">::</span><span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Component</span><span class="w"> </span><span class="n">with_types_in</span><span class="w"> </span><span class="n">bindings</span><span class="p">);</span>
</code></pre></div>
<p>Cargo.toml:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[package]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"compress"</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.1.0"</span>
<span class="n">edition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2021"</span>

<span class="k">[dependencies]</span>
<span class="n">zstd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.13"</span>
<span class="n">wit-bindgen-rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"0.39.0"</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"bitflags"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>

<span class="k">[lib]</span>
<span class="n">crate-type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"cdylib"</span><span class="p">]</span>

<span class="k">[package.metadata.component]</span>
<span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"wit/compress.wit"</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>CLI:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>/Users/tpmccallum/wasmtime/target/release/wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress(\"hello\")"</span><span class="w"> </span>/Users/tpmccallum/testing_components/compress/target/wasm32-wasip1/debug/compress.wasm
<span class="o">[</span><span class="m">40</span>,<span class="w"> </span><span class="m">181</span>,<span class="w"> </span><span class="m">47</span>,<span class="w"> </span><span class="m">253</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">88</span>,<span class="w"> </span><span class="m">41</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">104</span>,<span class="w"> </span><span class="m">101</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">111</span><span class="o">]</span>
</code></pre></div>
</blockquote>



<a name="509715969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509715969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509715969">(Apr 02 2025 at 14:37)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509715970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509715970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509715970">(Apr 02 2025 at 14:37)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509715972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509715972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509715972">(Apr 02 2025 at 14:37)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509715974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509715974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509715974">(Apr 02 2025 at 14:37)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509717615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509717615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509717615">(Apr 02 2025 at 14:44)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#pullrequestreview-2736531672">PR review</a>:</p>
<blockquote>
<p>Thanks for working on this.</p>
<p>I rebased my branch on main, and changed the base branch for this PR to be my branch.</p>
<p>I think if you drop the change to wave core i128, we can merge this to my branch, and then I'll have alex review my PR.</p>
</blockquote>



<a name="509717616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509717616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509717616">(Apr 02 2025 at 14:44)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2024978237">PR review comment</a>:</p>
<blockquote>
<p>The original code is correct here - this is making a pair of i64 out of the bits in a i128, so we want those operations to discard the extra bits and not panic when they are present</p>
</blockquote>



<a name="509802090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509802090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509802090">(Apr 02 2025 at 22:06)</a>:</h4>
<p>tpmccallum submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#pullrequestreview-2737700842">PR review</a>.</p>



<a name="509802091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509802091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509802091">(Apr 02 2025 at 22:06)</a>:</h4>
<p>tpmccallum created <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2025666508">PR review comment</a>:</p>
<blockquote>
<p>Thanks, Pat.<br>
Sure thing. The reason I updated this code is that there was <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/14222433195/job/39853589268">a value truncation error in the cargo clippy CI</a>, which read:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">casting</span><span class="w"> </span><span class="err">`</span><span class="kt">u128</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="kt">i64</span><span class="err">`</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">truncate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span>
<span class="n">help</span><span class="p">:</span><span class="w"> </span><span class="nc">if</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">intentional</span><span class="p">,</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lint</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="cp">#[allow(clippy::cast_possible_truncation)]</span><span class="err">`</span>
<span class="n">or</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">try_from</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">accordingly</span>
<span class="kd">let</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i64</span><span class="p">::</span><span class="n">try_from</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</code></pre></div>
<p>I will change it back and run clippy locally to ensure it truncates silently and suppresses the warning/error.<br>
Will report back here soon.</p>
</blockquote>



<a name="509805275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509805275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509805275">(Apr 02 2025 at 22:32)</a>:</h4>
<p>tpmccallum submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#pullrequestreview-2737743668">PR review</a>.</p>



<a name="509805278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509805278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509805278">(Apr 02 2025 at 22:32)</a>:</h4>
<p>tpmccallum created <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2025690921">PR review comment</a>:</p>
<blockquote>
<p>Ok, I did a <code>cargo clean</code> and <code>cargo build --release</code> and then also performed the CI locally i.e.:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CARGO_INCREMENTAL</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CARGO_PROFILE_DEV_DEBUG</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CARGO_PROFILE_TEST_DEBUG</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RUSTFLAGS</span><span class="o">=</span><span class="s2">"-D warnings"</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WIT_REQUIRE_SEMICOLONS</span><span class="o">=</span><span class="m">1</span>
cargo<span class="w"> </span>clippy<span class="w"> </span>--workspace<span class="w"> </span>--all-targets
</code></pre></div>
<p>The following error occurred:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="w">    </span>Checking<span class="w"> </span>wiggle<span class="w"> </span>v32.0.0<span class="w"> </span><span class="o">(</span>/Users/tpmccallum/wasmtime/crates/wiggle<span class="o">)</span>
error:<span class="w"> </span>casting<span class="w"> </span><span class="sb">`</span>u128<span class="sb">`</span><span class="w"> </span>to<span class="w"> </span><span class="sb">`</span>i64<span class="sb">`</span><span class="w"> </span>may<span class="w"> </span>truncate<span class="w"> </span>the<span class="w"> </span>value
<span class="w">   </span>--&gt;<span class="w"> </span>crates/wasmtime/src/runtime/wave/core.rs:103:19
<span class="w">    </span><span class="p">|</span>
<span class="m">103</span><span class="w"> </span><span class="p">|</span><span class="w">         </span><span class="nb">let</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>v<span class="w"> </span>as<span class="w"> </span>i64<span class="p">;</span>
<span class="w">    </span><span class="p">|</span><span class="w">                   </span>^^^^^^^^
<span class="w">    </span><span class="p">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span>help:<span class="w"> </span><span class="k">if</span><span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span>intentional<span class="w"> </span>allow<span class="w"> </span>the<span class="w"> </span>lint<span class="w"> </span>with<span class="w"> </span><span class="sb">`</span><span class="c1">#[allow(clippy::cast_possible_truncation)]` ...</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span>help:<span class="w"> </span><span class="k">for</span><span class="w"> </span>further<span class="w"> </span>information<span class="w"> </span>visit<span class="w"> </span>https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
<span class="w">    </span><span class="o">=</span><span class="w"> </span>note:<span class="w"> </span><span class="sb">`</span>-D<span class="w"> </span>clippy::cast-possible-truncation<span class="sb">`</span><span class="w"> </span>implied<span class="w"> </span>by<span class="w"> </span><span class="sb">`</span>-D<span class="w"> </span>warnings<span class="sb">`</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span>help:<span class="w"> </span>to<span class="w"> </span>override<span class="w"> </span><span class="sb">`</span>-D<span class="w"> </span>warnings<span class="sb">`</span><span class="w"> </span>add<span class="w"> </span><span class="sb">`</span><span class="c1">#[allow(clippy::cast_possible_truncation)]`</span>
help:<span class="w"> </span>...<span class="w"> </span>or<span class="w"> </span>use<span class="w"> </span><span class="sb">`</span>try_from<span class="sb">`</span><span class="w"> </span>and<span class="w"> </span>handle<span class="w"> </span>the<span class="w"> </span>error<span class="w"> </span>accordingly
<span class="w">    </span><span class="p">|</span>
<span class="m">103</span><span class="w"> </span>-<span class="w">         </span><span class="nb">let</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>v<span class="w"> </span>as<span class="w"> </span>i64<span class="p">;</span>
<span class="m">103</span><span class="w"> </span>+<span class="w">         </span><span class="nb">let</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>i64::try_from<span class="o">(</span>v<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="p">|</span>

error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>compile<span class="w"> </span><span class="sb">`</span>wasmtime<span class="sb">`</span><span class="w"> </span><span class="o">(</span>lib<span class="o">)</span><span class="w"> </span>due<span class="w"> </span>to<span class="w"> </span><span class="m">1</span><span class="w"> </span>previous<span class="w"> </span>error
warning:<span class="w"> </span>build<span class="w"> </span>failed,<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>other<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>finish...
</code></pre></div>
<p>I will try that same original code again, but this time with the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![allow(clippy::cast_possible_truncation)]</span>
</code></pre></div>
<p>Report back soon ... :) </p>
</blockquote>



<a name="509812413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509812413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509812413">(Apr 02 2025 at 23:39)</a>:</h4>
<p>tpmccallum edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2025690921">PR review comment</a>.</p>



<a name="509812739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509812739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509812739">(Apr 02 2025 at 23:43)</a>:</h4>
<p>tpmccallum edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2025690921">PR review comment</a>.</p>



<a name="509813262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509813262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509813262">(Apr 02 2025 at 23:49)</a>:</h4>
<p>tpmccallum edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2025690921">PR review comment</a>.</p>



<a name="509819488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509819488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509819488">(Apr 03 2025 at 00:55)</a>:</h4>
<p>tpmccallum submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#pullrequestreview-2738005956">PR review</a>.</p>



<a name="509819490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509819490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509819490">(Apr 03 2025 at 00:55)</a>:</h4>
<p>tpmccallum created <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#discussion_r2025832097">PR review comment</a>:</p>
<blockquote>
<p>Ok, so that attribute (<code>#[allow(clippy::cast_possible_truncation)]</code> at the function level) seemed to do the trick.</p>
<p>Build:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>cargo<span class="w"> </span>build<span class="w"> </span>--release
<span class="w">   </span>Compiling<span class="w"> </span>proc-macro2<span class="w"> </span>v1.0.92
<span class="w">   </span>Compiling<span class="w"> </span>unicode-ident<span class="w"> </span>v1.0.8
<span class="w">  </span>--<span class="w"> </span>snip<span class="w"> </span>--
<span class="w">   </span>Compiling<span class="w"> </span>wasmtime-wasi-tls<span class="w"> </span>v32.0.0<span class="w"> </span><span class="o">(</span>/Users/tpmccallum/wasmtime/crates/wasi-tls<span class="o">)</span>
<span class="w">    </span>Finished<span class="w"> </span><span class="sb">`</span>release<span class="sb">`</span><span class="w"> </span>profile<span class="w"> </span><span class="o">[</span>optimized<span class="o">]</span><span class="w"> </span>target<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>10m<span class="w"> </span>59s
</code></pre></div>
<p>Clippy:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">CARGO_INCREMENTAL</span><span class="o">=</span><span class="m">0</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">CARGO_PROFILE_DEV_DEBUG</span><span class="o">=</span><span class="m">0</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">CARGO_PROFILE_TEST_DEBUG</span><span class="o">=</span><span class="m">0</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">RUSTFLAGS</span><span class="o">=</span><span class="s2">"-D warnings"</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">WIT_REQUIRE_SEMICOLONS</span><span class="o">=</span><span class="m">1</span>
$<span class="w"> </span>cargo<span class="w"> </span>clippy<span class="w"> </span>--workspace<span class="w"> </span>--all-targets
<span class="w">   </span>Compiling<span class="w"> </span>proc-macro2<span class="w"> </span>v1.0.92
<span class="w">   </span>Compiling<span class="w"> </span>unicode-ident<span class="w"> </span>v1.0.8
<span class="w">   </span>Compiling<span class="w"> </span>serde<span class="w"> </span>v1.0.215
<span class="w">  </span>--snip--
<span class="w">    </span>Checking<span class="w"> </span>wasmtime-c-api<span class="w"> </span>v32.0.0<span class="w"> </span><span class="o">(</span>/Users/tpmccallum/wasmtime/crates/c-api/artifact<span class="o">)</span>
<span class="w">    </span>Finished<span class="w"> </span><span class="sb">`</span>dev<span class="sb">`</span><span class="w"> </span>profile<span class="w"> </span><span class="o">[</span>unoptimized<span class="o">]</span><span class="w"> </span>target<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>4m<span class="w"> </span>34s
</code></pre></div>
<p>I will commit the changes now.</p>
</blockquote>



<a name="509820341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509820341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509820341">(Apr 03 2025 at 01:03)</a>:</h4>
<p>tpmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509820729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509820729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509820729">(Apr 03 2025 at 01:07)</a>:</h4>
<p>tpmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509839020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509839020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509839020">(Apr 03 2025 at 04:07)</a>:</h4>
<p>tpmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509843332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509843332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509843332">(Apr 03 2025 at 04:50)</a>:</h4>
<p>tpmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509848726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509848726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509848726">(Apr 03 2025 at 05:42)</a>:</h4>
<p>tpmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509848733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509848733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509848733">(Apr 03 2025 at 05:42)</a>:</h4>
<p>tpmccallum <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<p>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a good enough validator of whether the exported function being invoked by <code>--invoke</code> is surrounded in double quotes. I did try (and succeeded) to see the outer double quotes when they existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is ... if a user does not surround the exported function in double quotes it fails in the shell log before the Rust even sees it. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<p>I am stumped in finding a way to enforce outer double quotes in the <code>wasmtime run</code> CLI. For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a>:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## `run`</span>

This is the <span class="sb">`wasmtime`</span> CLI's main subcommand, and it's also the default if no
other subcommand is provided. The <span class="sb">`run`</span> command will execute a WebAssembly
module. This means that the module will be compiled to native code,
instantiated, and then optionally have an export executed.

The <span class="sb">`wasmtime`</span> CLI will automatically hook up any WASI-related imported
functionality, but at this time, if your module imports anything else, it will
fail instantiation.

The <span class="sb">`run`</span> command takes one positional argument, which is the name of the module to run:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wasm
<span class="sb">```</span>

Note that the <span class="sb">`wasmtime`</span> CLI can take both a binary WebAssembly file (<span class="sb">`*.wasm`</span>)
as well as the text format for WebAssembly (<span class="sb">`*.wat`</span>):

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wat
<span class="sb">```</span>

The <span class="sb">`run`</span> command accepts an optional <span class="sb">`--invoke`</span> argument, which is the name of
an exported function of the module to run.

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize()"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

The exported function's name and exported function's parentheses must both be enclosed in one set of double quotes, i.e. <span class="sb">`"initialize()"`</span>.
This treats the exported function as a single argument and prevents issues with shell interpretation.
The presence of the parenthesis <span class="sb">`()`</span> signifies function invocation, as apposed to the function name just being referenced.
This convention helps to distinguish function calls from other kinds of string arguments.

<span class="gs">**Note:**</span> If your function takes a string argument, ensure that you use escaped double quotes inside the parentheses. For example:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"hello\")"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

Each individual argument within the parentheses must be separated by a comma:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"Pi\", 3.14)"</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"add(1, 2)"</span>
<span class="sb">```</span>
</code></pre></div>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="509848844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509848844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509848844">(Apr 03 2025 at 05:44)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<p>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a good enough validator of whether the exported function being invoked by <code>--invoke</code> is surrounded in double quotes. I did try (and succeeded) to see the outer double quotes when they existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is ... if a user does not surround the exported function in double quotes it fails in the shell long before the Rust even sees it. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<p>I am stumped in finding a way to enforce outer double quotes in the <code>wasmtime run</code> CLI. For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a>:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## `run`</span>

This is the <span class="sb">`wasmtime`</span> CLI's main subcommand, and it's also the default if no
other subcommand is provided. The <span class="sb">`run`</span> command will execute a WebAssembly
module. This means that the module will be compiled to native code,
instantiated, and then optionally have an export executed.

The <span class="sb">`wasmtime`</span> CLI will automatically hook up any WASI-related imported
functionality, but at this time, if your module imports anything else, it will
fail instantiation.

The <span class="sb">`run`</span> command takes one positional argument, which is the name of the module to run:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wasm
<span class="sb">```</span>

Note that the <span class="sb">`wasmtime`</span> CLI can take both a binary WebAssembly file (<span class="sb">`*.wasm`</span>)
as well as the text format for WebAssembly (<span class="sb">`*.wat`</span>):

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wat
<span class="sb">```</span>

The <span class="sb">`run`</span> command accepts an optional <span class="sb">`--invoke`</span> argument, which is the name of
an exported function of the module to run.

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize()"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

The exported function's name and exported function's parentheses must both be enclosed in one set of double quotes, i.e. <span class="sb">`"initialize()"`</span>.
This treats the exported function as a single argument and prevents issues with shell interpretation.
The presence of the parenthesis <span class="sb">`()`</span> signifies function invocation, as apposed to the function name just being referenced.
This convention helps to distinguish function calls from other kinds of string arguments.

<span class="gs">**Note:**</span> If your function takes a string argument, ensure that you use escaped double quotes inside the parentheses. For example:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"hello\")"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

Each individual argument within the parentheses must be separated by a comma:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"Pi\", 3.14)"</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"add(1, 2)"</span>
<span class="sb">```</span>
</code></pre></div>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="509849017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509849017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509849017">(Apr 03 2025 at 05:45)</a>:</h4>
<p>tpmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="509849035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509849035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509849035">(Apr 03 2025 at 05:45)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<p>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a good enough validator of whether the exported function being invoked by <code>--invoke</code> is surrounded in double quotes. I did try (and succeeded) to see the outer double quotes when they existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is ... if a user does not surround the exported function in double quotes it fails in the shell long before the Rust even sees it. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<p>I am stumped in finding a way to enforce outer double quotes in the <code>wasmtime run</code> CLI. For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a>:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## `run`</span>

This is the <span class="sb">`wasmtime`</span> CLI's main subcommand, and it's also the default if no
other subcommand is provided. The <span class="sb">`run`</span> command will execute a WebAssembly
module. This means that the module will be compiled to native code,
instantiated, and then optionally have an export executed.

The <span class="sb">`wasmtime`</span> CLI will automatically hook up any WASI-related imported
functionality, but at this time, if your module imports anything else, it will
fail instantiation.

The <span class="sb">`run`</span> command takes one positional argument, which is the name of the module to run:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wasm
<span class="sb">```</span>

Note that the <span class="sb">`wasmtime`</span> CLI can take both a binary WebAssembly file (<span class="sb">`*.wasm`</span>)
as well as the text format for WebAssembly (<span class="sb">`*.wat`</span>):

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wat
<span class="sb">```</span>

The <span class="sb">`run`</span> command accepts an optional <span class="sb">`--invoke`</span> argument, which is the name of
an exported function of the module to run.

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize()"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

The exported function's name and exported function's parentheses must both be enclosed in one set of double quotes, i.e. <span class="sb">`"initialize()"`</span>.
This treats the exported function as a single argument and prevents issues with shell interpretation.
The presence of the parenthesis <span class="sb">`()`</span> signifies function invocation, as apposed to the function name just being referenced.
This convention helps to distinguish function calls from other kinds of string arguments.

<span class="gs">**Note:**</span> If your function takes a string argument, ensure that you use escaped double quotes inside the parentheses. For example:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"hello\")"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

Each individual argument within the parentheses must be separated by a comma:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"Pi\", 3.14)"</span><span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"add(1, 2)"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>
</code></pre></div>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="509849180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509849180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509849180">(Apr 03 2025 at 05:47)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<p>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a good enough validator of whether the exported function being invoked by <code>--invoke</code> is surrounded in double quotes. I did try (and succeeded) to see the outer double quotes when they existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is ... if a user does not surround the exported function in double quotes it fails in the shell long before the Rust even sees it. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<p>I am stumped in finding a way to enforce outer double quotes in the <code>wasmtime run</code> CLI. </p>
<p>(I am convinced that even something built into wasm-wave would not catch the missing outer double quotes in time anyway.)</p>
<p>For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a>:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## `run`</span>

This is the <span class="sb">`wasmtime`</span> CLI's main subcommand, and it's also the default if no
other subcommand is provided. The <span class="sb">`run`</span> command will execute a WebAssembly
module. This means that the module will be compiled to native code,
instantiated, and then optionally have an export executed.

The <span class="sb">`wasmtime`</span> CLI will automatically hook up any WASI-related imported
functionality, but at this time, if your module imports anything else, it will
fail instantiation.

The <span class="sb">`run`</span> command takes one positional argument, which is the name of the module to run:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wasm
<span class="sb">```</span>

Note that the <span class="sb">`wasmtime`</span> CLI can take both a binary WebAssembly file (<span class="sb">`*.wasm`</span>)
as well as the text format for WebAssembly (<span class="sb">`*.wat`</span>):

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wat
<span class="sb">```</span>

The <span class="sb">`run`</span> command accepts an optional <span class="sb">`--invoke`</span> argument, which is the name of
an exported function of the module to run.

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize()"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

The exported function's name and exported function's parentheses must both be enclosed in one set of double quotes, i.e. <span class="sb">`"initialize()"`</span>.
This treats the exported function as a single argument and prevents issues with shell interpretation.
The presence of the parenthesis <span class="sb">`()`</span> signifies function invocation, as apposed to the function name just being referenced.
This convention helps to distinguish function calls from other kinds of string arguments.

<span class="gs">**Note:**</span> If your function takes a string argument, ensure that you use escaped double quotes inside the parentheses. For example:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"hello\")"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

Each individual argument within the parentheses must be separated by a comma:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"Pi\", 3.14)"</span><span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"add(1, 2)"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>
</code></pre></div>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="509902731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/509902731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#509902731">(Apr 03 2025 at 10:45)</a>:</h4>
<p><strong>tpmccallum</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="510237706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/510237706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#510237706">(Apr 04 2025 at 15:58)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>.</p>



<a name="510313414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/510313414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#510313414">(Apr 05 2025 at 00:46)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<h1>Detecting Quotes In Rust</h1>
<p><strong>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p><strong>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a validator that is good enough to know whether the exported function being invoked by <code>--invoke</code> is surrounded by double quotes. I did try (and succeeded) to see the outer double quotes when they actually do existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is that <strong>if a user does not surround the exported function in quotes, it fails in the shell long before the Rust even sees it</strong>. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<p>I am stumped in finding a way to enforce outer double quotes in the <code>wasmtime run</code> CLI. </p>
<p>(I am convinced that even something built into wasm-wave would not catch the missing outer double quotes in time anyway.)</p>
<p>For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a>:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## `run`</span>

This is the <span class="sb">`wasmtime`</span> CLI's main subcommand, and it's also the default if no
other subcommand is provided. The <span class="sb">`run`</span> command will execute a WebAssembly
module. This means that the module will be compiled to native code,
instantiated, and then optionally have an export executed.

The <span class="sb">`wasmtime`</span> CLI will automatically hook up any WASI-related imported
functionality, but at this time, if your module imports anything else, it will
fail instantiation.

The <span class="sb">`run`</span> command takes one positional argument, which is the name of the module to run:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wasm
<span class="sb">```</span>

Note that the <span class="sb">`wasmtime`</span> CLI can take both a binary WebAssembly file (<span class="sb">`*.wasm`</span>)
as well as the text format for WebAssembly (<span class="sb">`*.wat`</span>):

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wat
<span class="sb">```</span>

The <span class="sb">`run`</span> command accepts an optional <span class="sb">`--invoke`</span> argument, which is the name of
an exported function of the module to run.

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize()"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

The exported function's name and exported function's parentheses must both be enclosed in one set of double quotes, i.e. <span class="sb">`"initialize()"`</span>.
This treats the exported function as a single argument and prevents issues with shell interpretation.
The presence of the parenthesis <span class="sb">`()`</span> signifies function invocation, as apposed to the function name just being referenced.
This convention helps to distinguish function calls from other kinds of string arguments.

<span class="gs">**Note:**</span> If your function takes a string argument, ensure that you use escaped double quotes inside the parentheses. For example:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"hello\")"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

Each individual argument within the parentheses must be separated by a comma:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"Pi\", 3.14)"</span><span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"add(1, 2)"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>
</code></pre></div>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="510318495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/510318495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#510318495">(Apr 05 2025 at 01:51)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<h1>Detecting Quotes In Rust</h1>
<p><strong>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p><strong>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a validator that is good enough to know whether the exported function being invoked by <code>--invoke</code> is surrounded by double quotes. <strong>I did try (and succeeded using the <code>format!</code> macro)</strong> to see the outer double quotes when they actually do existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is that <strong>if a user does not surround the exported function in quotes, it fails in the shell long before the Rust even sees it</strong>. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<p>I am stumped in finding a way to enforce outer double quotes in the <code>wasmtime run</code> CLI. </p>
<p>(I am convinced that even something built into wasm-wave would not catch the missing outer double quotes in time anyway.)</p>
<p>For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a>:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## `run`</span>

This is the <span class="sb">`wasmtime`</span> CLI's main subcommand, and it's also the default if no
other subcommand is provided. The <span class="sb">`run`</span> command will execute a WebAssembly
module. This means that the module will be compiled to native code,
instantiated, and then optionally have an export executed.

The <span class="sb">`wasmtime`</span> CLI will automatically hook up any WASI-related imported
functionality, but at this time, if your module imports anything else, it will
fail instantiation.

The <span class="sb">`run`</span> command takes one positional argument, which is the name of the module to run:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wasm
<span class="sb">```</span>

Note that the <span class="sb">`wasmtime`</span> CLI can take both a binary WebAssembly file (<span class="sb">`*.wasm`</span>)
as well as the text format for WebAssembly (<span class="sb">`*.wat`</span>):

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>foo.wat
<span class="sb">```</span>

The <span class="sb">`run`</span> command accepts an optional <span class="sb">`--invoke`</span> argument, which is the name of
an exported function of the module to run.

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize()"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

The exported function's name and exported function's parentheses must both be enclosed in one set of double quotes, i.e. <span class="sb">`"initialize()"`</span>.
This treats the exported function as a single argument and prevents issues with shell interpretation.
The presence of the parenthesis <span class="sb">`()`</span> signifies function invocation, as apposed to the function name just being referenced.
This convention helps to distinguish function calls from other kinds of string arguments.

<span class="gs">**Note:**</span> If your function takes a string argument, ensure that you use escaped double quotes inside the parentheses. For example:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"hello\")"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>

Each individual argument within the parentheses must be separated by a comma:

<span class="sb">```sh</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"initialize(\"Pi\", 3.14)"</span><span class="w"> </span>foo.wasm
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"add(1, 2)"</span><span class="w"> </span>foo.wasm
<span class="sb">```</span>
</code></pre></div>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="510320120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/510320120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#510320120">(Apr 05 2025 at 02:08)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<h1>Detecting Quotes In Rust</h1>
<p><strong>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p><strong>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a validator that is good enough to know whether the exported function being invoked by <code>--invoke</code> is surrounded by double quotes. <strong>I did try (and succeeded using the <code>format!</code> macro)</strong> to see the outer double quotes when they actually do existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is that <strong>if a user does not surround the exported function in quotes, it fails in the shell long before the Rust even sees it</strong>. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm

zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="s2">"hello"</span><span class="o">)</span><span class="w"> </span>compress.wasm

zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span>h
</code></pre></div>
<hr>
<p>The following quoting examples do work, which is great.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress(\"hello\")"</span><span class="w"> </span>compress.wasm

<span class="o">[</span><span class="m">40</span>,<span class="w"> </span><span class="m">181</span>,<span class="w"> </span><span class="m">47</span>,<span class="w"> </span><span class="m">253</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">88</span>,<span class="w"> </span><span class="m">41</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">104</span>,<span class="w"> </span><span class="m">101</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">111</span><span class="o">]</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s1">'compress("hello")'</span><span class="w"> </span>compress.wasm

<span class="o">[</span><span class="m">40</span>,<span class="w"> </span><span class="m">181</span>,<span class="w"> </span><span class="m">47</span>,<span class="w"> </span><span class="m">253</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">88</span>,<span class="w"> </span><span class="m">41</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">104</span>,<span class="w"> </span><span class="m">101</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">111</span><span class="o">]</span>
</code></pre></div>
<h2>Assist</h2>
<p>I am stumped in finding a way to enforce outer double or single quotes in the <code>wasmtime run</code> CLI. </p>
<p>(I am convinced that even something built into wasm-wave would not catch the missing outer double quotes in time either. The errors with no outer quotes are stopped in their tracks in the CLI)</p>
<p>For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511/">the documentation on this PR</a></p>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<a name="510320291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310511%20Invoke%20wave%20enhancements/near/510320291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310511.20Invoke.20wave.20enhancements.html#510320291">(Apr 05 2025 at 02:10)</a>:</h4>
<p>tpmccallum edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10511#issuecomment-2774552109">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10511">PR #10511</a>:</p>
<blockquote>
<p>Ok, signing off for the day.<br>
<code>cargo build --release</code> and <code>cargo clippy</code> are <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span> </p>
<p>The absence of parentheses will give a helpful result:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress"</span><span class="w"> </span>compress.wasm
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">compress</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">'</span><span class="na">compress</span><span class="o">'</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress()"</span><span class="p">).</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">enveloped</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">escaped</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">).</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">8</span><span class="o">..</span><span class="mi">8</span>
</code></pre></div>
<h1>Detecting Quotes In Rust</h1>
<p><strong>Interestingly, the absence of outer double quotes is a little trickier. The Rust code I added attempts to test for double quotes via <code>starts_with</code> and <code>ends_with</code>, but this does not work. For example:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"compress(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span>
<span class="w">  </span><span class="fm">println!</span><span class="p">(</span><span class="s">"starts_with: {}, ends_with: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">));</span>
</code></pre></div>
<p><strong>One would assume the result to be <code>starts_with: true, ends_with: true</code> but in reality the result is actually:</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">starts_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span>
</code></pre></div>
<p>Alas, this is not a validator that is good enough to know whether the exported function being invoked by <code>--invoke</code> is surrounded by double quotes. <strong>I did try (and succeeded using the <code>format!</code> macro)</strong> to see the outer double quotes when they actually do existed. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// This `invoke` that Rust sees here does not show the outer double quotes. Only the following `func()` or `func(42)`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">invoke</span><span class="p">.</span><span class="n">as_ref</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// However, I can get the raw data and see double quotes if/when they exist. For example `"func()"` or `"func(42)"`.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">raw_invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">invoke</span><span class="p">);</span>
</code></pre></div>
<p>The overarching issue is that <strong>if a user does not surround the exported function in quotes, it fails in the shell long before the Rust even sees it</strong>. And the result is something along these lines:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="se">\"</span>hello<span class="se">\"</span><span class="o">)</span><span class="w"> </span>compress.wasm

zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span><span class="s2">"</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span>compress<span class="o">(</span><span class="s2">"hello"</span><span class="o">)</span><span class="w"> </span>compress.wasm

zsh:<span class="w"> </span>unknown<span class="w"> </span>file<span class="w"> </span>attribute:<span class="w"> </span>h
</code></pre></div>
<hr>
<p>The following quoting examples do work, which is great.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s2">"compress(\"hello\")"</span><span class="w"> </span>compress.wasm

<span class="o">[</span><span class="m">40</span>,<span class="w"> </span><span class="m">181</span>,<span class="w"> </span><span class="m">47</span>,<span class="w"> </span><span class="m">253</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">88</span>,<span class="w"> </span><span class="m">41</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">104</span>,<span class="w"> </span><span class="m">101</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">111</span><span class="o">]</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--invoke<span class="w"> </span><span class="s1">'compress("hello")'</span><span class="w"> </span>compress.wasm

<span class="o">[</span><span class="m">40</span>,<span class="w"> </span><span class="m">181</span>,<span class="w"> </span><span class="m">47</span>,<span class="w"> </span><span class="m">253</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">88</span>,<span class="w"> </span><span class="m">41</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">104</span>,<span class="w"> </span><span class="m">101</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">108</span>,<span class="w"> </span><span class="m">111</span><span class="o">]</span>
</code></pre></div>
<h2>Assist</h2>
<p>I am stumped in finding a way to enforce outer double or single quotes in the <code>wasmtime run</code> CLI. </p>
<p>(I am convinced that even something built into wasm-wave would not catch the missing outer double quotes in time either. The errors with no outer quotes are stopped in their tracks in the CLI)</p>
<p>For this reason, I ended up being a bit verbose on <a href="https://github.com/bytecodealliance/wasmtime/pull/10054/files#diff-0363d17382eb8132dd4d579c9a666828fbea069adaa1de08f5ba5b548a854eb6">the documentation on this PR</a></p>
<p>Hope all of that makes sense. Happy to do more - happy reviewing.</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>