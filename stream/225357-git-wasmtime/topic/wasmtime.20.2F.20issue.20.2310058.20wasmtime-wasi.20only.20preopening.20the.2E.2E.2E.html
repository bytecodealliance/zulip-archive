<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10058 wasmtime-wasi only preopening the... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html">wasmtime / issue #10058 wasmtime-wasi only preopening the...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="494992864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/494992864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#494992864">(Jan 21 2025 at 08:29)</a>:</h4>
<p><a href="https://github.com/justingaffney">justingaffney</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">Issue #10058</a>.</p>



<a name="494992866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/494992866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#494992866">(Jan 21 2025 at 08:29)</a>:</h4>
<p>justingaffney opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">issue #10058</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Clone example repo here: <a href="https://github.com/justingaffney/wasmtime-preopen-bug">https://github.com/justingaffney/wasmtime-preopen-bug</a></p>
<h3>Steps to Reproduce</h3>
<ul>
<li>Build component<br>
    * <code>cd component</code> <br>
    * <code>cargo component build --release</code></li>
<li>Run host<br>
    * <code>cd ..</code><br>
    * <code>cargo run</code></li>
</ul>
<h3>Expected Results</h3>
<p>The following output:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">c</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
</code></pre></div>
<h3>Actual Results</h3>
<p>The following output:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Custom</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">Uncategorized</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s">"failed to find a pre-opened file descriptor through which </span><span class="se">\"</span><span class="s">/b</span><span class="se">\"</span><span class="s"> could be opened"</span><span class="w"> </span><span class="p">})</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">c</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Custom</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">Uncategorized</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s">"failed to find a pre-opened file descriptor through which </span><span class="se">\"</span><span class="s">/c</span><span class="se">\"</span><span class="s"> could be opened"</span><span class="w"> </span><span class="p">})</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Custom</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">Uncategorized</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s">"failed to find a pre-opened file descriptor through which </span><span class="se">\"</span><span class="s">/d</span><span class="se">\"</span><span class="s"> could be opened"</span><span class="w"> </span><span class="p">})</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 28.0.1, 29.0.0</p>
<p>Operating system: Windows 11</p>
<p>Architecture: x86_64<br>
</p>
</blockquote>



<a name="494998496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/494998496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#494998496">(Jan 21 2025 at 09:01)</a>:</h4>
<p>justingaffney <a href="https://github.com/bytecodealliance/wasmtime/issues/10058#issuecomment-2604059545">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">issue #10058</a>:</p>
<blockquote>
<p>I just tried it on Ubuntu 24.04.1 and have the same issue</p>
</blockquote>



<a name="495111449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/495111449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#495111449">(Jan 21 2025 at 17:40)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10058#issuecomment-2605365676">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">issue #10058</a>:</p>
<blockquote>
<p>Thanks for the report! This should be fixed in <a href="https://github.com/bytecodealliance/wasmtime/pull/10064">https://github.com/bytecodealliance/wasmtime/pull/10064</a>. I'll note though that this is a bug in the "adapter" which will take a bit of time to propagate to toolchains. In the meantime working around this will be difficult as the adapter is pretty deep inside tooling and difficult to update-on-a-dime.</p>
</blockquote>



<a name="495120186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/495120186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#495120186">(Jan 21 2025 at 18:30)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">issue #10058</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Clone example repo here: <a href="https://github.com/justingaffney/wasmtime-preopen-bug">https://github.com/justingaffney/wasmtime-preopen-bug</a></p>
<h3>Steps to Reproduce</h3>
<ul>
<li>Build component<br>
    * <code>cd component</code> <br>
    * <code>cargo component build --release</code></li>
<li>Run host<br>
    * <code>cd ..</code><br>
    * <code>cargo run</code></li>
</ul>
<h3>Expected Results</h3>
<p>The following output:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">c</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
</code></pre></div>
<h3>Actual Results</h3>
<p>The following output:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Custom</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">Uncategorized</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s">"failed to find a pre-opened file descriptor through which </span><span class="se">\"</span><span class="s">/b</span><span class="se">\"</span><span class="s"> could be opened"</span><span class="w"> </span><span class="p">})</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">c</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Custom</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">Uncategorized</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s">"failed to find a pre-opened file descriptor through which </span><span class="se">\"</span><span class="s">/c</span><span class="se">\"</span><span class="s"> could be opened"</span><span class="w"> </span><span class="p">})</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="p">:</span><span class="w"> </span><span class="nc">Failed</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Custom</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">Uncategorized</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s">"failed to find a pre-opened file descriptor through which </span><span class="se">\"</span><span class="s">/d</span><span class="se">\"</span><span class="s"> could be opened"</span><span class="w"> </span><span class="p">})</span>
<span class="n">Reading</span><span class="w"> </span><span class="o">/</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Success</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 28.0.1, 29.0.0</p>
<p>Operating system: Windows 11</p>
<p>Architecture: x86_64<br>
</p>
</blockquote>



<a name="495222488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/495222488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#495222488">(Jan 22 2025 at 08:20)</a>:</h4>
<p>justingaffney <a href="https://github.com/bytecodealliance/wasmtime/issues/10058#issuecomment-2606569123">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">issue #10058</a>:</p>
<blockquote>
<p>Thanks for the fast response!</p>
<p>It looks like the adapter is used in quite a few places, and I'm not sure how it all fits together yet. In the case of my example repo would I just need the next release of cargo-component, that contains your merged PR updating <code>wasi-preview1-component-adapter-provider</code>? Then I'd just need to run <code>cargo component build</code> again to include the new adapter version in the produced .wasm file?</p>
</blockquote>



<a name="495330975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310058%20wasmtime-wasi%20only%20preopening%20the.../near/495330975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310058.20wasmtime-wasi.20only.20preopening.20the.2E.2E.2E.html#495330975">(Jan 22 2025 at 17:04)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10058#issuecomment-2607792792">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10058">issue #10058</a>:</p>
<blockquote>
<p>I believe that should work yeah!</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>