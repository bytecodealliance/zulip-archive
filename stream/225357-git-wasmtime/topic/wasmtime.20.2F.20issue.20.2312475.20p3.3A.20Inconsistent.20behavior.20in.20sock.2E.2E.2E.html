<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12475 p3: Inconsistent behavior in sock... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html">wasmtime / issue #12475 p3: Inconsistent behavior in sock...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="570906523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/570906523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#570906523">(Jan 29 2026 at 22:19)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">issue #12475</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>With the latest Wasmtime <code>dev</code> version, the following test:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_wrong_address_family</span><span class="p">(</span><span class="n">family</span><span class="p">:</span><span class="w"> </span><span class="nc">IpAddressFamily</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UdpSocket</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="n">family</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv4</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">IpSocketAddress</span><span class="p">::</span><span class="n">localhost</span><span class="p">(</span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv6</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">IpSocketAddress</span><span class="p">::</span><span class="n">localhost</span><span class="p">(</span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">addr</span><span class="p">)).</span><span class="k">await</span><span class="p">;</span>
<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="fm">matches!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">ErrorCode</span><span class="p">::</span><span class="n">InvalidArgument</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div>
<p>Passes on <a href="https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324550988?pr=209#step:10:119">macOS</a>, but fails on <a href="https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551033?pr=209#step:10:115">Ubuntu</a>/<a href="https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551054?pr=209#step:10:1305">Windows</a>. </p>
<p>According to the spec: <code>invalid-argument</code> should be returned if the <code>remote-address</code> has the wrong address family. (EAFNOSUPPORT)<br>
</p>
</blockquote>



<a name="570906524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/570906524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#570906524">(Jan 29 2026 at 22:19)</a>:</h4>
<p><a href="https://github.com/saulecabrera">saulecabrera</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">Issue #12475</a>.</p>



<a name="570906525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/570906525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#570906525">(Jan 29 2026 at 22:19)</a>:</h4>
<p><a href="https://github.com/saulecabrera">saulecabrera</a> added the wasi label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">Issue #12475</a>.</p>



<a name="570906568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/570906568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#570906568">(Jan 29 2026 at 22:20)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">issue #12475</a>:</p>
<blockquote>
<p>With the latest Wasmtime <code>dev</code> version, the following test:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_wrong_address_family</span><span class="p">(</span><span class="n">family</span><span class="p">:</span><span class="w"> </span><span class="nc">IpAddressFamily</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UdpSocket</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="n">family</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv4</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">IpSocketAddress</span><span class="p">::</span><span class="n">localhost</span><span class="p">(</span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv6</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">IpSocketAddress</span><span class="p">::</span><span class="n">localhost</span><span class="p">(</span><span class="n">IpAddressFamily</span><span class="p">::</span><span class="n">Ipv4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sock</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">addr</span><span class="p">)).</span><span class="k">await</span><span class="p">;</span>
<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="fm">matches!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">ErrorCode</span><span class="p">::</span><span class="n">InvalidArgument</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div>
<p>Passes on <a href="https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324550988?pr=209#step:10:119">macOS</a>, but fails on <a href="https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551033?pr=209#step:10:115">Ubuntu</a>/<a href="https://github.com/WebAssembly/wasi-testsuite/actions/runs/21302638267/job/61324551054?pr=209#step:10:1305">Windows</a>. </p>
<p>According to the spec: <code>invalid-argument</code> should be returned if the <code>remote-address</code> has the wrong address family. (EAFNOSUPPORT)<br>
</p>
</blockquote>



<a name="570908940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/570908940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#570908940">(Jan 29 2026 at 22:38)</a>:</h4>
<p>saulecabrera <a href="https://github.com/bytecodealliance/wasmtime/issues/12475#issuecomment-3820785840">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">issue #12475</a>:</p>
<blockquote>
<p>For completeness, this is the error on Ubuntu:</p>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>src/bin/sockets-udp-send.rs:21:5<span class="o">]</span><span class="w"> </span><span class="p">&amp;</span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Err<span class="o">(</span>
<span class="w">    </span>ErrorCode<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>code:<span class="w"> </span><span class="m">2</span>,
<span class="w">        </span>name:<span class="w"> </span><span class="s2">"not-supported"</span>,
<span class="w">        </span>message:<span class="w"> </span><span class="s2">"The operation is not supported.\n\n          POSIX equivalent: EOPNOTSUPP"</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="o">)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="571107932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/571107932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#571107932">(Jan 30 2026 at 19:24)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12475#issuecomment-3825339761">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">issue #12475</a>:</p>
<blockquote>
<p>Should this perhaps be a case where the spec is changed to allow more error codes for this situation? I never quite know how to best thread the needle but translating a native <code>EAFNOSUPPORT</code> to <code>not-supported</code> here doesn't seem entirely unreasonable to me</p>
</blockquote>



<a name="571110226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312475%20p3%3A%20Inconsistent%20behavior%20in%20sock.../near/571110226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312475.20p3.3A.20Inconsistent.20behavior.20in.20sock.2E.2E.2E.html#571110226">(Jan 30 2026 at 19:38)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/12475#issuecomment-3825401198">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12475">issue #12475</a>:</p>
<blockquote>
<p>I believe on macOS an ipv6 socket can actually connect to ipv4 addresses (and by default listening on an ipv6 socket will also listen on ipv4) The IPV6_V6ONLY option disables this behavior.</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>