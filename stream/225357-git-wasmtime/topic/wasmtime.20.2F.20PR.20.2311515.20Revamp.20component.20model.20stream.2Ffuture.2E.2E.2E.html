<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11515 Revamp component model stream/future... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html">wasmtime / PR #11515 Revamp component model stream/future...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="535764822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/535764822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#535764822">(Aug 22 2025 at 22:42)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a> from <code>dicej:stream-future-api-revamp</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This changes the host APIs for dealing with futures and streams from a "rendezvous"-style API to a callback-oriented one.</p>
<p>Previously you would create e.g. a <code>StreamReader</code>/<code>StreamWriter</code> pair and call their <code>read</code> and <code>write</code> methods, respectively, and those methods would return <code>Future</code>s that resolved when the operation was matched with a corresponding <code>write</code> or <code>read</code> operation on the other end.</p>
<p>With the new API, you instead provide a <code>StreamProducer</code> trait implementation whe creating the stream, whose <code>produce</code> method will be called as soon as a read happens, giving the implementation a chance to respond immediately without making the reader wait for a rendezvous.  Likewise, you can match the read end of a stream to a <code>StreamConsumer</code> to respond immediately to writes.  This model should reduce scheduling overhead and make it easier to e.g. pipe items to/from <code>AsyncWrite</code>/<code>AsyncRead</code> or <code>Sink</code>/<code>Stream</code> implementations without needing to explicitly spawn background tasks.  In addition, the new API provides direct access to guest read and write buffers for <code>stream&lt;u8&gt;</code> operations, enabling zero-copy operations.</p>
<p>Other changes:</p>
<ul>
<li>
<p>I've removed the <code>HostTaskOutput</code>; we were using it to run extra code with access to the store after a host task completes, but we can do that more elegantly inside the future using <code>tls::get</code>.  This also allowed me to simplify <code>Instance::poll_until</code> a bit.</p>
</li>
<li>
<p>I've removed the <code>watch_{reader,writer}</code> functionality; it's not needed now given that the runtime will automatically dispose of the producer or consumer when the other end of the stream or future is closed -- no need for embedder code to manage that.</p>
</li>
<li>
<p>In order to make <code>UntypedWriteBuffer</code> <code>Send</code>, I had to wrap its raw pointer <code>buf</code> field in a <code>SendSyncPtr</code>.</p>
</li>
<li>
<p>I've removed <code>{Future,Stream}Writer</code> entirely and moved <code>Instance::{future,stream}</code> to <code>{Future,Stream}Reader::new</code>, respectively.</p>
</li>
<li>
<p>I've added a bounds check to the beginnings of <code>Instance::guest_read</code> and <code>Instance::guest_write</code> so that we need not do it later in <code>Guest{Source,Destination}::remaining</code>, meaning those functions can be infallible.</p>
</li>
</ul>
<p>Note that I haven't updated <code>wasmtime-wasi</code> yet to match; that will happen in one or more follow-up commits.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="535772427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/535772427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#535772427">(Aug 23 2025 at 00:58)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="535772513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/535772513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#535772513">(Aug 23 2025 at 00:59)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536049529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536049529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536049529">(Aug 25 2025 at 15:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298414254">PR review comment</a>:</p>
<blockquote>
<p>Technically this should use <a href="https://docs.rs/futures/latest/futures/channel/mpsc/struct.Sender.html#method.poll_ready"><code>poll_ready</code></a>, right?</p>
</blockquote>



<a name="536049531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536049531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536049531">(Aug 25 2025 at 15:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3151967843">PR review</a>:</p>
<blockquote>
<p>Is it worth it to resolve the zero-length read/write TODOs in the code before landing? We don't have many users of that right now so it also seems ok to defer that too.</p>
<p>Otherwise though this all seems reasonable to me, although I'm mostly relying on tests. The interfaces we've talked about historically and I think are ok to land. I'm also happy to help out with the porting of wasmtime-wasi later this afternoon</p>
</blockquote>



<a name="536049533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536049533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536049533">(Aug 25 2025 at 15:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298413072">PR review comment</a>:</p>
<blockquote>
<p>Technically this should call <code>.next()</code> and buffer up the result if one comes in, right?</p>
</blockquote>



<a name="536061881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536061881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536061881">(Aug 25 2025 at 16:24)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3220920794">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<blockquote>
<p>Is it worth it to resolve the zero-length read/write TODOs in the code before landing? We don't have many users of that right now so it also seems ok to defer that too.</p>
</blockquote>
<p>Yup, I'll do that.  Testing it will be mildly tedious, but might as well bite the bullet.</p>
<blockquote>
<p>Otherwise though this all seems reasonable to me, although I'm mostly relying on tests. The interfaces we've talked about historically and I think are ok to land. I'm also happy to help out with the porting of wasmtime-wasi later this afternoon</p>
</blockquote>
<p>@rvolosatovs is planning to take a crack at updating <code>wasmtime-wasi</code> starting tomorrow, FYI.</p>
</blockquote>



<a name="536074805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536074805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536074805">(Aug 25 2025 at 17:38)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3152436168">PR review</a>.</p>



<a name="536074806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536074806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536074806">(Aug 25 2025 at 17:38)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298711992">PR review comment</a>:</p>
<blockquote>
<p>It appears that we'll need to expose the second type parameter to <code>Accessor</code> in order to be able to use this API from <em>within</em> e.g. <code>wasmtime_wasi</code>.<br>
Binding implementations get an opaque <code>T</code> passed in, e.g. <a href="https://github.com/bytecodealliance/wasmtime/blob/3aa392399e785df414ad6ee6ee7f034989b75301/crates/wasi/src/p3/sockets/host/types/tcp.rs#L252-L253">https://github.com/bytecodealliance/wasmtime/blob/3aa392399e785df414ad6ee6ee7f034989b75301/crates/wasi/src/p3/sockets/host/types/tcp.rs#L252-L253</a></p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>pub trait FutureProducer&lt;T, U, V&gt;: Send + 'static {
    /// Handle a host- or guest-initiated read by producing a value.
    fn produce(self, accessor: &amp;Accessor&lt;T, U&gt;) -&gt; impl Future&lt;Output = Result&lt;V&gt;&gt; + Send;
}
</code></pre></div><br>
</p>
</blockquote>



<a name="536075273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536075273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536075273">(Aug 25 2025 at 17:41)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3152444875">PR review</a>.</p>



<a name="536075275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536075275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536075275">(Aug 25 2025 at 17:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298717501">PR review comment</a>:</p>
<blockquote>
<p>Oh for that @dicej and I talked about this a bit ago, I'd prefer to avoid the type parameter explosion but I have an alternative solution that should work. Let me sketch that out and push it up here too</p>
</blockquote>



<a name="536076572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536076572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536076572">(Aug 25 2025 at 17:49)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536076607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536076607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536076607">(Aug 25 2025 at 17:49)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3152464673">PR review</a>.</p>



<a name="536076610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536076610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536076610">(Aug 25 2025 at 17:49)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298732123">PR review comment</a>:</p>
<blockquote>
<p>Awesome, thanks @alexcrichton .<br>
I actually just ran into a very similar issue earlier today in <code>wasi:http</code>, trying to reuse the same task implementation both from outside and from within the <code>wasi:http</code> crate, which I worked around the following way:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">Fut</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AccessorTask</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">GuestBodyTask</span><span class="o">&lt;</span><span class="n">Fut</span><span class="o">&gt;</span>
<span class="k">where</span>
<span class="w">    </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiHttpView</span><span class="p">,</span>
<span class="w">    </span><span class="n">U</span><span class="p">:</span><span class="w"> </span><span class="nc">HasData</span><span class="p">,</span>
<span class="w">    </span><span class="n">Fut</span><span class="p">:</span><span class="w"> </span><span class="nc">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="nb">static</span><span class="p">,</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Accessor</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">trailers</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">store</span>
<span class="w">                </span><span class="p">.</span><span class="n">data_mut</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">http</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">table</span>
<span class="w">                </span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">trailers</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="s">"failed to delete trailers"</span><span class="p">)</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="k">await</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="sd">/// This is a duplicate of [GuestBodyTask], which can be used from within this crate</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">GuestBodyTaskInternal</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GuestBodyTask</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">Fut</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AccessorTask</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">GuestBodyTaskInternal</span><span class="o">&lt;</span><span class="n">Fut</span><span class="o">&gt;</span>
<span class="k">where</span>
<span class="w">    </span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">U</span><span class="p">:</span><span class="w"> </span><span class="nc">HasData</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiHttpCtxView</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">Fut</span><span class="p">:</span><span class="w"> </span><span class="nc">Future</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="nb">static</span><span class="p">,</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Accessor</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span>
<span class="w">            </span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">trailers</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">store</span>
<span class="w">                    </span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">table</span>
<span class="w">                    </span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">trailers</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="s">"failed to delete trailers"</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="k">await</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Perhaps this serves as a good data point for the fix</p>
</blockquote>



<a name="536076701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536076701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536076701">(Aug 25 2025 at 17:50)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3152466345">PR review</a>.</p>



<a name="536076702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536076702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536076702">(Aug 25 2025 at 17:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298733346">PR review comment</a>:</p>
<blockquote>
<p>Ok I pushed an extra commit up with what I was thinking, the rough idea is that the WASI implementations will close over the "getter", the <code>fn(&amp;mut T) -&gt; D::Data&lt;'_&gt;</code> projection, themselves. If that's onerous though to schlep with WASI we can look to bake it in.</p>
</blockquote>



<a name="536077709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536077709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536077709">(Aug 25 2025 at 17:56)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298746170">PR review comment</a>:</p>
<blockquote>
<p>Testing it now, looks like bindgen still needs to be updated for the rename</p>
</blockquote>



<a name="536077710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536077710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536077710">(Aug 25 2025 at 17:56)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3152483780">PR review</a>.</p>



<a name="536077831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536077831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536077831">(Aug 25 2025 at 17:57)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2298746170">PR review comment</a>.</p>



<a name="536078383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536078383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536078383">(Aug 25 2025 at 18:00)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536112781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536112781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536112781">(Aug 25 2025 at 21:33)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536220897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536220897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536220897">(Aug 26 2025 at 12:03)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3155327496">PR review</a>.</p>



<a name="536220898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536220898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536220898">(Aug 26 2025 at 12:03)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2300778452">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately, I don't think that the refactor fixes the underlying issue, which is that the host interface implementations do not have access to the getter provided by the the call to <code>add_to_linker</code>. The getter provided by <code>Access&lt;T&gt;::getter</code> will always produce <code>&amp;mut T</code>, because the second type parameter defaults to <code>HasSelf&lt;T&gt;</code>.</p>
<p>What this means is that for this to work, the getter would have to be passed to the implementation through <code>WasiSocketsCtxView&lt;'a&gt;</code>, for example.</p>
<ul>
<li><code>Accessor::new</code> creates a getter, which is an identity function <a href="https://github.com/bytecodealliance/wasmtime/pull/11515/files#diff-714ba43342be98eb093bc17d4ad955a3f3056f4c424635ac399da76349a3a8d7R422">https://github.com/bytecodealliance/wasmtime/pull/11515/files#diff-714ba43342be98eb093bc17d4ad955a3f3056f4c424635ac399da76349a3a8d7R422</a>, that's the only getter visible to <code>produce</code> implementations</li>
<li>The actual getter implementations need though is only visible to the generated bindings <a href="https://github.com/bytecodealliance/wasmtime/pull/11515/files#diff-b365a0c26d559b75058e519f7e01c9e0b201da9f8a16df2b96cf6693f6b38ce6R1458">https://github.com/bytecodealliance/wasmtime/pull/11515/files#diff-b365a0c26d559b75058e519f7e01c9e0b201da9f8a16df2b96cf6693f6b38ce6R1458</a> and it's later used via <code>with_getter</code> to map the 2nd type parameter to a different type <a href="https://github.com/bytecodealliance/wasmtime/pull/11515/files#diff-b365a0c26d559b75058e519f7e01c9e0b201da9f8a16df2b96cf6693f6b38ce6R2493-R2520">https://github.com/bytecodealliance/wasmtime/pull/11515/files#diff-b365a0c26d559b75058e519f7e01c9e0b201da9f8a16df2b96cf6693f6b38ce6R2493-R2520</a></li>
</ul>
<p>I'm happy to jump on a quick call to talk through this today to give more details.</p>
</blockquote>



<a name="536221967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536221967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536221967">(Aug 26 2025 at 12:09)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2300778452">PR review comment</a>.</p>



<a name="536237647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536237647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536237647">(Aug 26 2025 at 13:31)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3155596367">PR review</a>.</p>



<a name="536237649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536237649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536237649">(Aug 26 2025 at 13:31)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2301010719">PR review comment</a>:</p>
<blockquote>
<p>Once a <code>FutureReader</code> is returned by a host implementation, is it guaranteed that the runtime will call <code>close</code> if the guest does not use it? (or e.g. traps)</p>
</blockquote>



<a name="536237651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536237651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536237651">(Aug 26 2025 at 13:31)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2300994444">PR review comment</a>:</p>
<blockquote>
<p>Since we're dealing with byte buffers only here, could we reuse <a href="https://docs.rs/tokio/latest/tokio/io/struct.ReadBuf.html">https://docs.rs/tokio/latest/tokio/io/struct.ReadBuf.html</a> directly in some way?</p>
</blockquote>



<a name="536237652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536237652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536237652">(Aug 26 2025 at 13:31)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2300971395">PR review comment</a>:</p>
<blockquote>
<p>I would have expected this function to not be <code>async</code>, in fact, shouldn't this function to <em>move</em> <code>Destination</code>, such that it could only be called once with at most the number of elements that reader asked for?</p>
</blockquote>



<a name="536237753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536237753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536237753">(Aug 26 2025 at 13:32)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2300971395">PR review comment</a>.</p>



<a name="536241596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536241596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536241596">(Aug 26 2025 at 13:48)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3155731160">PR review</a>.</p>



<a name="536241599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536241599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536241599">(Aug 26 2025 at 13:48)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2301063826">PR review comment</a>:</p>
<blockquote>
<p>nvm, we have figured it out together with @dicej , thanks!</p>
</blockquote>



<a name="536246071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536246071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536246071">(Aug 26 2025 at 14:08)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3155829255">PR review</a>.</p>



<a name="536246073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536246073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536246073">(Aug 26 2025 at 14:09)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2301128523">PR review comment</a>:</p>
<blockquote>
<p>Resolved offline. Once returned to the guest the handle will be properly disposed off with a <em>well-behaving</em> guest. We probably want to introduce some limit on the amount of open future/stream handles that the guest can have</p>
<p>cc @dicej </p>
</blockquote>



<a name="536246249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536246249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536246249">(Aug 26 2025 at 14:09)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2301130932">PR review comment</a>:</p>
<blockquote>
<p>Resolved offline, we may need to wait for realloc, which is why this needs to be <code>async</code>.<br>
@dicej will add a <code>remaining</code> function to this struct</p>
</blockquote>



<a name="536246250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536246250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536246250">(Aug 26 2025 at 14:09)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3155833801">PR review</a>.</p>



<a name="536257263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536257263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536257263">(Aug 26 2025 at 15:01)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536422248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536422248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536422248">(Aug 27 2025 at 13:36)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536424369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536424369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536424369">(Aug 27 2025 at 13:46)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3159873411">PR review</a>.</p>



<a name="536424371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536424371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536424371">(Aug 27 2025 at 13:46)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2303990831">PR review comment</a>:</p>
<blockquote>
<p>I think this is an important detail of the implementation to call out - in the absence of task, the stream handle returned in <code>tuple&lt;stream&lt;T&gt;, future&lt;result&lt;_, E&gt;&gt;&gt;</code> pattern has to be dropped/closed before a value can arrive on the <code>future</code>, I suspect that is because in case of a task, the host could independently track the status of the socket and be notified of the socket shutdown by the OS as part of it's own event loop. Without a task, the guest must effectively "signal" the host to "do work", in success case triggering the <code>Drop</code> of the producer, I suppose.</p>
<p>I wonder if that's the expected behavior here and whether that would play well with GC languages.</p>
</blockquote>



<a name="536427416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536427416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536427416">(Aug 27 2025 at 14:00)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3159933966">PR review</a>.</p>



<a name="536427417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536427417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536427417">(Aug 27 2025 at 14:00)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304031848">PR review comment</a>:</p>
<blockquote>
<p>One solution could be giving both stream and future producers access to the underlying socket and check for shutdown in the future producer as well. It seems that such an approach would require the future producer to also perform reads from the socket and communicate those to stream producer.</p>
</blockquote>



<a name="536429861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536429861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536429861">(Aug 27 2025 at 14:11)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3159978979">PR review</a>.</p>



<a name="536429864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536429864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536429864">(Aug 27 2025 at 14:11)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304063415">PR review comment</a>:</p>
<blockquote>
<p>Giving it a bit more thought, the guest is getting <code>StreamResult::Complete</code> on L46, shouldn't the host eagerly drop the producer before returning this to the guest?</p>
</blockquote>



<a name="536429941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536429941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536429941">(Aug 27 2025 at 14:11)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304063415">PR review comment</a>.</p>



<a name="536429994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536429994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536429994">(Aug 27 2025 at 14:12)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304063415">PR review comment</a>.</p>



<a name="536430786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536430786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536430786">(Aug 27 2025 at 14:15)</a>:</h4>
<p>rvolosatovs deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304063415">PR review comment</a>.</p>



<a name="536431334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536431334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536431334">(Aug 27 2025 at 14:18)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3160006110">PR review</a>.</p>



<a name="536431340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536431340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536431340">(Aug 27 2025 at 14:18)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304082156">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>Giving it a bit more thought, the guest is getting <code>StreamResult::Complete</code> on L46, shouldn't the host eagerly drop the producer _before_ letting the guest know that the stream is done?</p>
</blockquote>
<p>Yes, it should; if it's not, I'd consider that a bug.  I'll take a look.</p>
</blockquote>



<a name="536433977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536433977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536433977">(Aug 27 2025 at 14:30)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3160055161">PR review</a>.</p>



<a name="536433979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536433979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536433979">(Aug 27 2025 at 14:30)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304115834">PR review comment</a>:</p>
<blockquote>
<p>I've originally mistaken <code>Complete</code> for <code>Dropped</code>, but realized that was wrong <a href="https://github.com/bytecodealliance/wit-bindgen/blob/f61634fd7905595ba7b83bb8cda42a4f3ee3ac29/crates/guest-rust/src/rt/async_support/stream_support.rs#L225-L235">https://github.com/bytecodealliance/wit-bindgen/blob/f61634fd7905595ba7b83bb8cda42a4f3ee3ac29/crates/guest-rust/src/rt/async_support/stream_support.rs#L225-L235</a> and deleted the comment.</p>
<p>I think the test was simply incorrect, see <a href="#narrow/channel/217126-wasmtime/topic/async.20API.20revamp.20implications">#wasmtime &gt; async API revamp implications</a></p>
</blockquote>



<a name="536447369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536447369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536447369">(Aug 27 2025 at 15:33)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3160404991">PR review</a>.</p>



<a name="536447372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536447372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536447372">(Aug 27 2025 at 15:33)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304372041">PR review comment</a>:</p>
<blockquote>
<p>I just opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11552">https://github.com/bytecodealliance/wasmtime/issues/11552</a> to track that.</p>
</blockquote>



<a name="536448110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536448110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536448110">(Aug 27 2025 at 15:36)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2304386411">PR review comment</a>:</p>
<blockquote>
<p>Wasmtime doesn't currently depend on <code>tokio</code> except for testing; I'm not sure <code>ReadBuf</code> adds enough value to justify pulling it in.</p>
</blockquote>



<a name="536448111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536448111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536448111">(Aug 27 2025 at 15:36)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3160423175">PR review</a>.</p>



<a name="536569787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536569787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536569787">(Aug 28 2025 at 09:44)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536572502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536572502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536572502">(Aug 28 2025 at 10:02)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3164163172">PR review</a>.</p>



<a name="536572503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536572503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536572503">(Aug 28 2025 at 10:02)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2306910081">PR review comment</a>:</p>
<blockquote>
<p>It seems that the consumer MUST loop here to ensure that all of the data already read from the guest has been written - otherwise, if the consumer were to buffer, how would the guest know that a partial write occurred?</p>
<p>It seems that what we really want is to have a way for the consumer to report back the amount of elements actually read, replicating something like <a href="https://doc.rust-lang.org/nightly/std/io/trait.Read.html#tymethod.read">https://doc.rust-lang.org/nightly/std/io/trait.Read.html#tymethod.read</a></p>
<p>Given the existing API, it looks like the consumer should be able to <em>return</em> the buffer, just like the <code>Destination::write</code> would currently do.</p>
<p>This is, of course, already addressed for byte-buffers originating from the guest, but this seems problematic in general case</p>
</blockquote>



<a name="536573179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536573179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536573179">(Aug 28 2025 at 10:06)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2306910081">PR review comment</a>.</p>



<a name="536588325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536588325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536588325">(Aug 28 2025 at 11:49)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536593056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536593056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536593056">(Aug 28 2025 at 12:18)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536593938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536593938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536593938">(Aug 28 2025 at 12:23)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536594653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536594653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536594653">(Aug 28 2025 at 12:28)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536595276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536595276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536595276">(Aug 28 2025 at 12:31)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233313105">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>All existing WASI tests pass now for me locally. I'm a bit surprised that it looks like CI does not run on this PR anymore?</p>
<p>I've removed the reuseaddr test workaround, since this change set should remove the need for it, and close <a href="https://github.com/bytecodealliance/wasmtime/issues/11342">https://github.com/bytecodealliance/wasmtime/issues/11342</a></p>
</blockquote>



<a name="536595303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536595303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536595303">(Aug 28 2025 at 12:31)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233313105">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>All existing WASI tests pass now for me locally. I'm a bit surprised that it looks like CI does not run on this PR anymore?</p>
<p>I've removed the reuseaddr test workaround, since this change set should remove the need for it and close <a href="https://github.com/bytecodealliance/wasmtime/issues/11342">https://github.com/bytecodealliance/wasmtime/issues/11342</a></p>
</blockquote>



<a name="536596084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536596084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536596084">(Aug 28 2025 at 12:35)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233328058">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>The main remaining item left here is the cancellation-safety of <code>produce</code> functions, but we've been having some private conversations with @dicej and hopefully a pretty minor API change should suffice to address it.<br>
@dicej please let me know when the new API is available and I will happily fix WASI again.</p>
<p>I will meanwhile work on migrating #11440 to this API</p>
</blockquote>



<a name="536596193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536596193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536596193">(Aug 28 2025 at 12:36)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233328058">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>The main remaining item left here is the cancellation-safety of <code>produce</code> functions, but we've been having some private conversations with @dicej and hopefully a pretty minor API change should suffice to address it.<br>
@dicej please let me know when the new API is available and I will happily fix WASI again.<br>
Could you also rebase this PR on latest <code>main</code>, please?</p>
<p>I will meanwhile work on migrating #11440 to this API</p>
</blockquote>



<a name="536596924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536596924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536596924">(Aug 28 2025 at 12:39)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3164692040">PR review</a>.</p>



<a name="536596926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536596926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536596926">(Aug 28 2025 at 12:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2307291916">PR review comment</a>:</p>
<blockquote>
<p>Is "lying" like this OK, @dicej, or do we have to drive I/O and buffer the result?</p>
</blockquote>



<a name="536597104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536597104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536597104">(Aug 28 2025 at 12:40)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3164695401">PR review</a>.</p>



<a name="536597105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536597105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536597105">(Aug 28 2025 at 12:40)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2307294536">PR review comment</a>:</p>
<blockquote>
<p>Same as above, do we need to drive I/O?</p>
</blockquote>



<a name="536597173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536597173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536597173">(Aug 28 2025 at 12:41)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3164696557">PR review</a>.</p>



<a name="536597174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536597174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536597174">(Aug 28 2025 at 12:41)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2307295357">PR review comment</a>:</p>
<blockquote>
<p>same here</p>
</blockquote>



<a name="536597470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536597470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536597470">(Aug 28 2025 at 12:42)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233352025">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>On a second thought, I'm guessing that "lying" about the stream being open is probably not the expected behavior, so I'll work on driving I/O in these and buffering first</p>
</blockquote>



<a name="536610188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536610188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536610188">(Aug 28 2025 at 13:44)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536613139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536613139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536613139">(Aug 28 2025 at 13:59)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233620733">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<blockquote>
<p>On a second thought, I'm guessing that "lying" about the stream being open is probably not the expected behavior, so I'll work on driving I/O in these and buffering first</p>
</blockquote>
<p>This is a good reminder that we should add tests that involve zero-length reads and writes from the guest, asserting that the following non-zero-length read or write completes immediately.  So far, this hasn't really been relevant, but once we add p3 support to wasi-libc we'll have real-world code that relies on it.</p>
</blockquote>



<a name="536619110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536619110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536619110">(Aug 28 2025 at 14:26)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233723027">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>On a second thought, I'm guessing that "lying" about the stream being open is probably not the expected behavior, so I'll work on driving I/O in these and buffering first</p>
</blockquote>
<p>This is a good reminder that we should add tests that involve zero-length reads and writes from the guest, asserting that the following non-zero-length read or write completes immediately. So far, this hasn't really been relevant, but once we add p3 support to wasi-libc we'll have real-world code that relies on it.</p>
</blockquote>
<p>I was under impression that we wanted to avoid buffering, however buffering seems to be the only way of providing this behavior for writes to e.g. files. It looks like for filesystem we'll need to introduce a construct (similar to p2), where we'll have a thread performing file I/O and <code>wasi:filesystem</code> <em>write</em> just sends the buffer on something like <code>mpsc</code> channel.</p>
<p>Is that the expectation here?</p>
<p>I think makes sense to me, but it appears we'd also need to introduce <code>sync</code>/<code>flush</code> or similar to <code>wasi:filesystem</code> to be able to ensure that the host worker thread buffer has actually been passed over to the kernel</p>
</blockquote>



<a name="536619192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536619192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536619192">(Aug 28 2025 at 14:26)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233723027">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>On a second thought, I'm guessing that "lying" about the stream being open is probably not the expected behavior, so I'll work on driving I/O in these and buffering first</p>
</blockquote>
<p>This is a good reminder that we should add tests that involve zero-length reads and writes from the guest, asserting that the following non-zero-length read or write completes immediately. So far, this hasn't really been relevant, but once we add p3 support to wasi-libc we'll have real-world code that relies on it.</p>
</blockquote>
<p>I was under impression that we wanted to avoid buffering, however buffering seems to be the only way of providing this behavior for writes to e.g. files. It looks like for filesystem we'll need to introduce a construct (similar to p2), where we'll have a thread performing file I/O and <code>wasi:filesystem</code> <em>write</em> just sends the buffer on something like <code>mpsc</code> channel.</p>
<p>Is that the expectation here?</p>
<p>I think that makes sense to me, but it appears we'd also need to introduce <code>sync</code>/<code>flush</code> or similar to <code>wasi:filesystem</code> to be able to ensure that the host worker thread buffer has actually been passed over to the kernel</p>
</blockquote>



<a name="536619289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536619289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536619289">(Aug 28 2025 at 14:27)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233723027">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>On a second thought, I'm guessing that "lying" about the stream being open is probably not the expected behavior, so I'll work on driving I/O in these and buffering first</p>
</blockquote>
<p>This is a good reminder that we should add tests that involve zero-length reads and writes from the guest, asserting that the following non-zero-length read or write completes immediately. So far, this hasn't really been relevant, but once we add p3 support to wasi-libc we'll have real-world code that relies on it.</p>
</blockquote>
<p>I was under impression that we wanted to avoid buffering, however buffering seems to be the only way of providing this behavior for writes to e.g. files. It looks like for filesystem we'll need to introduce a construct (similar to p2), where we'll have a thread performing file I/O and <code>wasi:filesystem</code> <em>write</em> just sends the buffer on something like <code>mpsc</code> channel.</p>
<p>Is that the expectation here?</p>
<p>I think that makes sense to me, but it appears we'd also need to introduce <code>sync</code>/<code>flush</code> or similar to <code>wasi:filesystem</code> to be able to ensure that the host worker thread buffer has actually been passed over to the kernel since <code>stream.write</code> will no longer guarantee that</p>
</blockquote>



<a name="536619921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536619921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536619921">(Aug 28 2025 at 14:29)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233737407">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>hmm, <code>sync</code> does exist <a href="https://github.com/WebAssembly/wasi-filesystem/blob/d81d6256c271fe1c8937eb8353e2ddc25517c153/wit-0.3.0-draft/types.wit#L434">https://github.com/WebAssembly/wasi-filesystem/blob/d81d6256c271fe1c8937eb8353e2ddc25517c153/wit-0.3.0-draft/types.wit#L434</a>, so would we make it <code>async</code> then and await the flush before returning?</p>
</blockquote>



<a name="536620010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536620010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536620010">(Aug 28 2025 at 14:30)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3233737407">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>hmm, <code>sync</code> does exist <a href="https://github.com/WebAssembly/wasi-filesystem/blob/d81d6256c271fe1c8937eb8353e2ddc25517c153/wit-0.3.0-draft/types.wit#L434">https://github.com/WebAssembly/wasi-filesystem/blob/d81d6256c271fe1c8937eb8353e2ddc25517c153/wit-0.3.0-draft/types.wit#L434</a>, so would we need to await the flush before returning?</p>
</blockquote>



<a name="536629203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536629203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536629203">(Aug 28 2025 at 15:11)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3165334472">PR review</a>.</p>



<a name="536629205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536629205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536629205">(Aug 28 2025 at 15:11)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2307736410">PR review comment</a>:</p>
<blockquote>
<p>Yeah, I can see how that could be awkward -- you read items from the <code>Source</code> and then try to write them to some kind of sink, but that sink might not be immediately ready to accept all the items.  In that case do you just .await until the sink has accepted them all?  If you do, then you're kind of blocking the original writer more than you should -- you'd rather just say you didn't read all the items and let the writer write them again if and when it wants to.  Also, what if the sink closes before you can write them all?</p>
<p>So yeah, I think we might need to change this API as well as the <code>StreamProducer</code> one.</p>
</blockquote>



<a name="536636749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536636749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536636749">(Aug 28 2025 at 15:46)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="536640396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/536640396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#536640396">(Aug 28 2025 at 16:04)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3234094423">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>for reference: <a href="#narrow/channel/219900-wasi/topic/0-length.20stream.20writes.20with.20files.20and.20stdio">#wasi &gt; 0-length stream writes with files and stdio</a></p>
</blockquote>



<a name="537089202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537089202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537089202">(Sep 01 2025 at 11:28)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3242007925">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<blockquote>
<p>hmm, <code>sync</code> does exist <a href="https://github.com/WebAssembly/wasi-filesystem/blob/d81d6256c271fe1c8937eb8353e2ddc25517c153/wit-0.3.0-draft/types.wit#L434">https://github.com/WebAssembly/wasi-filesystem/blob/d81d6256c271fe1c8937eb8353e2ddc25517c153/wit-0.3.0-draft/types.wit#L434</a>, so would we need to await the flush before returning?</p>
</blockquote>
<p>There are two kinds of synchronizing here: one is that the data will be visible to independent readers, and the other is that the data will be visible to independent readers even after an abrupt power failure. wasil-filesystem's <code>sync</code> is for that second kind, which can be very slow, so we shouldn't use it unless the application has explicitly requested it.<br>
</p>
</blockquote>



<a name="537370084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537370084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537370084">(Sep 02 2025 at 21:57)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537371350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537371350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537371350">(Sep 02 2025 at 22:09)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537518077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537518077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537518077">(Sep 03 2025 at 16:51)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537561318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537561318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537561318">(Sep 03 2025 at 22:12)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537567544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537567544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537567544">(Sep 03 2025 at 23:28)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537633239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537633239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537633239">(Sep 04 2025 at 09:48)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537641161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537641161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537641161">(Sep 04 2025 at 10:35)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537641234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537641234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537641234">(Sep 04 2025 at 10:35)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537642690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537642690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537642690">(Sep 04 2025 at 10:44)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537642807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537642807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537642807">(Sep 04 2025 at 10:45)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2321606236">PR review comment</a>:</p>
<blockquote>
<p>this would always return <code>None</code>, wouldn't it? (since that's a guest buffer)</p>
</blockquote>



<a name="537642809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537642809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537642809">(Sep 04 2025 at 10:45)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3184537918">PR review</a>.</p>



<a name="537642828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537642828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537642828">(Sep 04 2025 at 10:45)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2321606236">PR review comment</a>.</p>



<a name="537679150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537679150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537679150">(Sep 04 2025 at 13:58)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3185470238">PR review</a>.</p>



<a name="537679154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537679154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537679154">(Sep 04 2025 at 13:58)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2322276588">PR review comment</a>:</p>
<blockquote>
<p>Good point; I didn't revisit that code after I added the <code>if/else</code> block around it.</p>
</blockquote>



<a name="537724915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537724915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537724915">(Sep 04 2025 at 17:58)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537725177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537725177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537725177">(Sep 04 2025 at 18:00)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537725691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537725691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537725691">(Sep 04 2025 at 18:03)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537726045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537726045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537726045">(Sep 04 2025 at 18:06)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3254921533">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>I'm signing off for today and have just finished the WASI crate adaptation a few minutes ago. I have not even really proof-read, for example, the <code>read_directory</code> implementation yet.<br>
There's quite a bit of room for improvement, mainly refactoring and cutting down on duplication.<br>
I also noticed that <code>read_directory</code> seems to not be tested at all.</p>
<p>That all said, all tests pass (at least locally, will have to wait for CI) and IMO this is "good enough" to get this PR merged. Feel free to clean-up as desired, otherwise I will do that tomorrow.</p>
</blockquote>



<a name="537753285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753285">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#issuecomment-3255639694">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>:</p>
<blockquote>
<p>I talked with @dicej about this and we concluded that let's go ahead and land this. I've got follow-up feedback and Joel's got some follow-up implementation work but we feel it's best to land this and iterate rather than continuing to block this. The hope is that by landing this @rvolosatovs you're more-or-less unblocke to continue to work on wasi-http while we continue to smith some details here in parallel</p>
</blockquote>



<a name="537753329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753329">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537753344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753344">(Sep 04 2025 at 20:58)</a>:</h4>
<p><strong>alexcrichton</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a> as ready for review.</p>



<a name="537753345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753345">(Sep 04 2025 at 20:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537753346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753346">(Sep 04 2025 at 20:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537753347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753347">(Sep 04 2025 at 20:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537753365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753365">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3186827078">PR review</a>.</p>



<a name="537753368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753368">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323246406">PR review comment</a>:</p>
<blockquote>
<p>Can we skip this fallback and rely on <code>as_direct_destination</code> always succeeding?</p>
</blockquote>



<a name="537753369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753369">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323245088">PR review comment</a>:</p>
<blockquote>
<p>I opened <a href="https://github.com/WebAssembly/wasi-cli/issues/81">https://github.com/WebAssembly/wasi-cli/issues/81</a> for this, but for now it might be good to <code>log::warn!</code> the error too</p>
</blockquote>



<a name="537753370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753370">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323249935">PR review comment</a>:</p>
<blockquote>
<p>How come this needs a special case vs the below case?</p>
</blockquote>



<a name="537753389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537753389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537753389">(Sep 04 2025 at 20:58)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537758696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758696">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3187249676">PR review</a>.</p>



<a name="537758697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758697">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323588311">PR review comment</a>:</p>
<blockquote>
<p>For stdio in particular I think we'll additionally want to call <code>poll_flush</code> here before returning <code>Completed</code> because otherwise tokio only puts this off on some other task and it hasn't actually made its way to stdout yet.</p>
</blockquote>



<a name="537758698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758698">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323551363">PR review comment</a>:</p>
<blockquote>
<p>I'm going to look into restructuring this function to hopefully not need duplication in this <code>match</code> here and the one far below after the spawn, but that's just refactoring a bit.</p>
</blockquote>



<a name="537758700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758700">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323592473">PR review comment</a>:</p>
<blockquote>
<p>Like writes below I think this'll want a special-case of 0-length buffers to do a <code>poll_read_ready</code> here</p>
</blockquote>



<a name="537758701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758701">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323591522">PR review comment</a>:</p>
<blockquote>
<p>This prompted discussion between Joel and I and led to <a href="https://github.com/WebAssembly/component-model/issues/561">https://github.com/WebAssembly/component-model/issues/561</a> but we'll need to carefully handle 0-length reads here</p>
</blockquote>



<a name="537758702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758702">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323549993">PR review comment</a>:</p>
<blockquote>
<p>Talked with Joel about this and he's going to refactor things so the fallback isn't necessary (e.g. <code>as_direct_destination</code> always returns non-<code>None</code>)</p>
</blockquote>



<a name="537758703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537758703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537758703">(Sep 04 2025 at 21:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323550633">PR review comment</a>:</p>
<blockquote>
<p>(talked with Joel and I'll handle this in a follow-up)</p>
</blockquote>



<a name="537759310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537759310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537759310">(Sep 04 2025 at 21:35)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11515">PR #11515</a>.</p>



<a name="537765436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537765436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537765436">(Sep 04 2025 at 22:34)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3187454315">PR review</a>.</p>



<a name="537765439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537765439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537765439">(Sep 04 2025 at 22:34)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323685039">PR review comment</a>:</p>
<blockquote>
<p>With a 0-length read this tries a buffered read and if that would block, it polls readiness.<br>
From what I understand that's the expectation of this API - produce at least 1 (buffered) element.</p>
<p>Is there a reason to poll readiness before optimistically trying to read?</p>
</blockquote>



<a name="537767650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537767650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537767650">(Sep 04 2025 at 22:59)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#pullrequestreview-3187501067">PR review</a>.</p>



<a name="537767652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311515%20Revamp%20component%20model%20stream/future.../near/537767652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311515.20Revamp.20component.20model.20stream.2Ffuture.2E.2E.2E.html#537767652">(Sep 04 2025 at 22:59)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11515#discussion_r2323716227">PR review comment</a>:</p>
<blockquote>
<p>True! I should clarify my comment more... I'm assuming that with @dicej's queued up changes the <code>None</code> case for <code>as_direct_destination</code> goes away and so I was assuming that all the non-<code>as_direct_destination</code> code was going to be deleted. In that world the 0-length case is missed here, but otherwise you're right the 0-length case is handled through the buffers otherwise. (although that <a href="https://github.com/WebAssembly/component-model/issues/561">has its own problems</a>)</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>