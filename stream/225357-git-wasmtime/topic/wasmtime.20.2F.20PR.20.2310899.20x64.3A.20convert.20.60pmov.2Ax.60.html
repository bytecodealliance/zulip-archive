<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10899 x64: convert `pmov*x` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html">wasmtime / PR #10899 x64: convert `pmov*x`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="521821195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521821195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521821195">(Jun 02 2025 at 18:57)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a> from <code>abrown:asm-pmovx</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This change converts all <code>pmovsx*</code> and <code>pmovzx*</code> instructions to use the new assembler.</p>
</blockquote>



<a name="521821200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521821200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521821200">(Jun 02 2025 at 18:57)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>.</p>



<a name="521821202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521821202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521821202">(Jun 02 2025 at 18:57)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>.</p>



<a name="521821311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521821311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521821311">(Jun 02 2025 at 18:58)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#issuecomment-2932062363">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>:</p>
<blockquote>
<p>We can wait on merging this until #10881 is resolved to avoid merge conflicts for @jlb6740.</p>
</blockquote>



<a name="521827804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521827804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521827804">(Jun 02 2025 at 19:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#pullrequestreview-2889695520">PR review</a>:</p>
<blockquote>
<p>Looks good overall, just a doc-comment request below; thanks!</p>
</blockquote>



<a name="521827805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521827805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521827805">(Jun 02 2025 at 19:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2121998526">PR review comment</a>:</p>
<blockquote>
<p>I see these are pre-existing (this part of the diff is just code motion) but even so, I'm not sure I understand what these variants mean -- could we have doc-comments on <code>xmm1</code>, <code>xmm2</code>, <code>xmm3</code> describing what they're for and how they differ?</p>
</blockquote>



<a name="521890971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521890971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521890971">(Jun 03 2025 at 03:35)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2122570613">PR review comment</a>:</p>
<blockquote>
<p>@cfallin When describing an instruction a unique location is required for each reg/mem operand to avoid name clashes when generating lowering code (<a href="http://assembler.rs">assembler.rs</a>). Before vex, there was just a single xmm location and that was fine, but when describing vex instructions that use multiple xmm registers, that not longer was adequate. There was an attempt append  subscripts to locations while generating code in <a href="http://assembler.rs">assembler.rs</a>, but it became clear that it made the most sense to create multiple xmm registers in the enum and just use the same subscript naming as is used as the Intel manual. </p>
</blockquote>



<a name="521890972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521890972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521890972">(Jun 03 2025 at 03:35)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#pullrequestreview-2890493777">PR review</a>.</p>



<a name="521891566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521891566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521891566">(Jun 03 2025 at 03:41)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#pullrequestreview-2890504793">PR review</a>.</p>



<a name="521891568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521891568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521891568">(Jun 03 2025 at 03:41)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2122577998">PR review comment</a>:</p>
<blockquote>
<p>OK, I'm not sure I understand why we need to define new <em>types of operands</em> though -- can't we have DSL methods that somehow specify which slot the registers correspond to?</p>
<p>In essence this seems like a category error to me: the enum so far defines the kinds of things we can operate on; an XMM register, a reg-or-mem, that sort of thing. Whether we use that as input X or Y, it's still that kind of thing. The fact that we use the operand in a certain way should be a property of the <em>instruction</em>, not the operand kind. The concern I have with this kind of conflation is that it's not at all clear to me (or presumably others in the future) which of these variants to use or what they mean -- a recipe for subtle bugs and footguns in the future. So I'd rather we find a way to store the information elsewhere...</p>
</blockquote>



<a name="521892663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521892663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521892663">(Jun 03 2025 at 03:52)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2122570613">PR review comment</a>.</p>



<a name="521893085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/521893085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#521893085">(Jun 03 2025 at 03:56)</a>:</h4>
<p>jlb6740 <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#issuecomment-2933321427">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>:</p>
<blockquote>
<blockquote>
<p>We can wait on merging this until #10881 is resolved to avoid merge conflicts for @jlb6740.</p>
</blockquote>
<p>@abrown Thanks. #10881 should be resolved now. </p>
</blockquote>



<a name="522199056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522199056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522199056">(Jun 03 2025 at 19:18)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#pullrequestreview-2893790947">PR review</a>.</p>



<a name="522199057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522199057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522199057">(Jun 03 2025 at 19:18)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2124716919">PR review comment</a>:</p>
<blockquote>
<p>Here's what is going on: this <code>enum Location</code> is actually the _concrete_ list of names accepted as operands, not a classification of operands. There are three reasons why this became concrete: (1) it makes it really simple for us to write <code>rax</code> or <code>m16</code> or <code>r32b</code> when defining instructions, (2) that name then matches how the manual defines the instruction, and (3) that name is then unique for the operand and we can use it as Rust field, e.g.</p>
<p>When it comes to _classifications_ of operands, we actually have two different ways of categorizing operands:</p>
<ul>
<li><code>enum OperandKind</code>, which we use to distinguish between <code>Reg</code>, <code>Mem</code>, etc.</li>
<li><code>enum RegClass</code>, which we use to distinguish between <code>Xmm</code> and <code>Gpr</code></li>
</ul>
<p>The concrete <code>Location</code> names get categorized appropriately in <code>Location::kind()</code> and <code>Location::reg_class()</code>. Most of the assembler code generation uses their output. I think it would be helpful to summarize all of this this text above in the doc comments of <code>Location</code>, which is what @cfallin you were originally asking, right? I think that would be a good addition: do you have any specific wording choices that would be most helpful here?</p>
</blockquote>



<a name="522393734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522393734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522393734">(Jun 04 2025 at 15:50)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>.</p>



<a name="522394719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522394719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522394719">(Jun 04 2025 at 15:54)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>.</p>



<a name="522412295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522412295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522412295">(Jun 04 2025 at 17:19)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#pullrequestreview-2897523386">PR review</a>.</p>



<a name="522412296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522412296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522412296">(Jun 04 2025 at 17:19)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2127085470">PR review comment</a>:</p>
<blockquote>
<p>For later reference: we discussed this in the Cranelift meeting today and @cfallin is planning to look into this a bit more. There are other ways to factor this that avoids having the concrete things in the same bucket with general ones while still "looking like the manual" and having unique Rust field names; @alexcrichton had some thoughts to write up in an issue. I'll go ahead and merge this for now since this discussion was unrelated to this PR.</p>
</blockquote>



<a name="522412747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522412747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522412747">(Jun 04 2025 at 17:21)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#pullrequestreview-2897528911">PR review</a>.</p>



<a name="522412748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522412748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522412748">(Jun 04 2025 at 17:21)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10899#discussion_r2127089067">PR review comment</a>:</p>
<blockquote>
<p>See <a href="https://github.com/bytecodealliance/wasmtime/issues/10922">https://github.com/bytecodealliance/wasmtime/issues/10922</a> for future discussion.</p>
</blockquote>



<a name="522416849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310899%20x64%3A%20convert%20%60pmov%2Ax%60/near/522416849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310899.20x64.3A.20convert.20.60pmov.2Ax.60.html#522416849">(Jun 04 2025 at 17:42)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10899">PR #10899</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>