<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12047 Add async to the component_api fuzzer · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html">wasmtime / PR #12047 Add async to the component_api fuzzer</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="558249063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249063">(Nov 19 2025 at 16:22)</a>:</h4>
<p>alexcrichton assigned dicej to <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>.</p>



<a name="558249067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249067">(Nov 19 2025 at 16:22)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a> from <code>alexcrichton:fuzz-async-roundtrip</code> to <code>bytecodealliance:main</code> (assigned to dicej):</p>
<blockquote>
<p>This commit extends the preexisting <code>component_api</code> fuzzer in Wasmtime to support <code>async</code>. This required a fair bit of refactoring to how the fuzzer worked but the basic idea remains the same. This fuzzer generates:</p>
<ul>
<li>An arbitrary component-model type signature (minus resources/futures/streams)</li>
<li>A component which imports a function of this signature from the host and exports a function of this signature to the host.</li>
<li>Internally the export is implemented with a component <code>caller</code> that imports/exports this function signature.</li>
<li>The <code>caller</code> component is instantiated with a <code>callee</code> component that imports/exports this function signature.</li>
<li>The <code>callee</code> component is instantiated with the host.</li>
</ul>
<p>In essence a component model value is threaded into a component, to another composed component, then back out to the host. The return value then makes its way back through the same channel. The fuzz test ensures that the parameters received in the host import are the same as those passed to the export. Additionally the return value of the export is ensured to be the same as the one that the host import returned. In essence this is testing ABI handling in Wasmtime to ensure that composition works correctly in addition to lifting/lowering code.</p>
<p>This fuzzer additionally has a "static" and "dynamic" mode where, at compile time, N components are generated with different signatures and use the "typed" APIs of Wasmtime. For "dynamic" <code>Val</code> is used to test and arbitrary components are generated at fuzz-time. The fuzzer finally executes this roundtrip in a loop multiple times in one fuzz test case to test different runtime-shapes of values in addition to compile-time-shapes of values.</p>
<p>The main addition in this commit is to extend all of this with the async ABI. The following knobs were added and implemented:</p>
<ul>
<li>
<p>The function type used for the root component export, the function between the composed components, and the function imported from the host all have the ability to be an <code>async</code> function type now.</p>
</li>
<li>
<p>The lifts/lowers, in all locations, can be configured with the various ABIs supported (e.g. sync, async-callback, or async-stackful for lifts, and sync/async for lowers).</p>
</li>
<li>
<p>Like before the string encoding can be varied between the components as well.</p>
</li>
</ul>
<p>This is intended to stress combining different flavors of ABI with different behaviors to ensure that all the various paths throughout Wasmtime and such are hit. The goal of this fuzzer is to stress ABI lifting/lowering, so this is not handling much related to async event scheduling (that's for a future fuzzer).</p>
<p>In a follow-up commit I hope to extend this fuzzer with some async event scheduling nonetheless. For example the fuzzer will generate an async yield point before/after calling <code>task.return</code> or before/after calling the host import. That is intended to stress <code>first_poll</code>-vs-not behavior as it relates to ABI handling. None of that is yet implemented and for this fuzzer async calls are assumed to always succeed immediately for now.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="558249073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249073">(Nov 19 2025 at 16:22)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>.</p>



<a name="558249075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249075">(Nov 19 2025 at 16:22)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>.</p>



<a name="558249076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249076">(Nov 19 2025 at 16:22)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>.</p>



<a name="558249079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249079">(Nov 19 2025 at 16:22)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>.</p>



<a name="558249254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558249254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558249254">(Nov 19 2025 at 16:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12047#issuecomment-3553599339">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>:</p>
<blockquote>
<p>I ran this overnight and it found <a href="https://github.com/bytecodealliance/wasmtime/issues/12046">https://github.com/bytecodealliance/wasmtime/issues/12046</a>, but that took quite some time. I expect it'll probably uncover something else but I think this is ready to at least send to oss-fuzz.</p>
</blockquote>



<a name="558260899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558260899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558260899">(Nov 19 2025 at 17:10)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a> (assigned to dicej).</p>



<a name="558288844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558288844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558288844">(Nov 19 2025 at 19:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/12047#issuecomment-3554355733">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="558297983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558297983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558297983">(Nov 19 2025 at 20:37)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12047#pullrequestreview-3484660012">PR review</a>:</p>
<blockquote>
<p>LGTM.  Thanks for doing this!</p>
</blockquote>



<a name="558304405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312047%20Add%20async%20to%20the%20component_api%20fuzzer/near/558304405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312047.20Add.20async.20to.20the.20component_api.20fuzzer.html#558304405">(Nov 19 2025 at 21:16)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12047">PR #12047</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>