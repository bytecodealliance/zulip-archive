<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12046 component-model-async: Panic in l... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312046.20component-model-async.3A.20Panic.20in.20l.2E.2E.2E.html">wasmtime / issue #12046 component-model-async: Panic in l...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="558245055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312046%20component-model-async%3A%20Panic%20in%20l.../near/558245055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312046.20component-model-async.3A.20Panic.20in.20l.2E.2E.2E.html#558245055">(Nov 19 2025 at 16:07)</a>:</h4>
<p>alexcrichton assigned dicej to <a href="https://github.com/bytecodealliance/wasmtime/issues/12046">issue #12046</a>.</p>



<a name="558245067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312046%20component-model-async%3A%20Panic%20in%20l.../near/558245067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312046.20component-model-async.3A.20Panic.20in.20l.2E.2E.2E.html#558245067">(Nov 19 2025 at 16:07)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12046">issue #12046</a>:</p>
<blockquote>
<p>(sorry bad bug title)</p>
<p>This input:</p>
<p>&lt;details&gt;</p>
<p>&lt;summary&gt;&lt;code&gt;test.wast&lt;/code&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(component
  (core module $libc (;0;)
    (type $#type0 (;0;) (func (param i32 i32 i32 i32) (result i32)))
    (memory $#memory0 (;0;) 1)
    (global $last (;0;) (mut i32) i32.const 8)
    (export "memory" (memory $#memory0))
    (export "realloc" (func $realloc))
    (func $realloc (;0;) (type $#type0) (param $old_ptr i32) (param $old_size i32) (param $align i32) (param $new_size i32) (result i32)
      (local $ret i32)
      local.get $old_ptr
      if $#label0
        local.get $old_size
        local.get $new_size
        i32.gt_u
        if $#label1
          local.get $old_ptr
          return
        end
      end
      global.get $last
      local.get $align
      i32.const -1
      i32.add
      i32.add
      local.get $align
      i32.const -1
      i32.add
      i32.const -1
      i32.xor
      i32.and
      global.set $last
      global.get $last
      local.set $ret
      global.get $last
      local.get $new_size
      i32.add
      global.set $last
      loop $loop
        memory.size
        i32.const 65536
        i32.mul
        global.get $last
        i32.lt_u
        if $#label1
          i32.const 1
          memory.grow
          i32.const -1
          i32.eq
          if $#label2
            unreachable
          end
          br $loop
        end
      end
      local.get $ret
      i32.const 222
      local.get $new_size
      memory.fill
      local.get $old_ptr
      if $#label0
        local.get $ret
        local.get $old_ptr
        local.get $old_size
        memory.copy
      end
      local.get $ret
    )
  )

  (component $caller
    (type $t5 (list u16))
    (type $t0 (tuple $t5 string string bool s16))
    (type $sig (func async (param "p0" $t0) (param "p1" $t0) (result $t0)))
    (import "echo-import" (func $f (type $sig)))

    (core instance $libc (instantiate $libc))
    (core func $f_lower
      (canon lower
        (func $f)
        (memory $libc "memory")
        (realloc (func $libc "realloc"))
        string-encoding=latin1+utf16
      )
    )

    (core module $m
      (type $import (func (param i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32)))
      (type $#type2 (func (param i32 i32 i32 i32) (result i32)))
      (import "libc" "realloc" (func $realloc (type $#type2)))
      (import "host" "echo-import" (func $host (type $import)))
      (func (export "echo-export") (param $retptr i32) (param $argptr i32) (param $#local2 i32) (param $#local3 i32) (param $#local4 i32) (param $#local5 i32) (param $#local6 i32) (param $#local7 i32) (param $#local8 i32) (param $#local9 i32) (param $#local10 i32) (param $#local11 i32) (param $#local12 i32) (param $#local13 i32) (param $#local14 i32) (param $#local15 i32) (result i32)
        (local $#local16 i32) (local $#local17 i32)
        local.get $retptr
        local.get $argptr
        local.get $#local2
        local.get $#local3
        local.get $#local4
        local.get $#local5
        local.get $#local6
        local.get $#local7
        local.get $#local8
        local.get $#local9
        local.get $#local10
        local.get $#local11
        local.get $#local12
        local.get $#local13
        local.get $#local14
        local.get $#local15
        i32.const 0
        i32.const 0
        i32.const 4
        i32.const 28
        call $realloc
        local.set $#local16
        local.get $#local16
        call $host
        local.get $#local16
      )
    )
    (core instance $i (instantiate $m
      (with "libc" (instance $libc))
      (with "host" (instance (export "echo-import" (func $f_lower))))
    ))
    (func (export "echo-export") (type $sig)
      (canon lift
        (core func $i "echo-export")
        (memory $libc "memory")
        (realloc (func $libc "realloc"))
        string-encoding=latin1+utf16)
    )
  )

  (component $callee
    (type $t0 (tuple (list u16) string string bool s16))
    (type $export_sig (func async (param "p0" $t0) (param "p1" $t0) (result $t0)))
    (core instance $libc (instantiate $libc))
    (core module $m
      (func (export "echo-export") (param i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32) (result i32)
        unreachable
      )
      (func (export "callback") (param i32 i32 i32) (result i32)
        unreachable
      )
    )
    (core instance $i (;3;) (instantiate $m
        (with "libc" (instance $libc))
      )
    )
    (func (export "echo-export") (type $export_sig)
      (canon lift
        (core func $i "echo-export")
        (memory $libc "memory")
        (realloc (func $libc "realloc"))
        string-encoding=utf8
        async
        (callback (func $i "callback"))
      )
    )
  )

  (instance $c1 (instantiate $callee))
  (instance $c2 (instantiate $caller
    (with "echo-import" (func $c1 "echo-export"))
  ))
  (export "echo-export" (func $c2 "echo-export"))
)

(assert_trap
  (invoke "echo-export"
    (tuple.const
      (list.const)
      (str.const "")
      (str.const "")
      (bool.const false)
      (s16.const 0)
    )
    (tuple.const
      (list.const )
      (str.const "")
      (str.const "")
      (bool.const false)
      (s16.const 0)
    )
  )
  "unreachable")
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>yields:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">dev</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.10</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span><span class="err">`</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">2543961</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">2120</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span>
<span class="nc">range</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="mi">16</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="558245070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312046%20component-model-async%3A%20Panic%20in%20l.../near/558245070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312046.20component-model-async.3A.20Panic.20in.20l.2E.2E.2E.html#558245070">(Nov 19 2025 at 16:07)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12046">Issue #12046</a>.</p>



<a name="558466465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312046%20component-model-async%3A%20Panic%20in%20l.../near/558466465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312046.20component-model-async.3A.20Panic.20in.20l.2E.2E.2E.html#558466465">(Nov 20 2025 at 15:52)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12046">issue #12046</a>:</p>
<blockquote>
<p>(sorry bad bug title)</p>
<p>This input:</p>
<p>&lt;details&gt;</p>
<p>&lt;summary&gt;&lt;code&gt;test.wast&lt;/code&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(component
  (core module $libc (;0;)
    (type $#type0 (;0;) (func (param i32 i32 i32 i32) (result i32)))
    (memory $#memory0 (;0;) 1)
    (global $last (;0;) (mut i32) i32.const 8)
    (export "memory" (memory $#memory0))
    (export "realloc" (func $realloc))
    (func $realloc (;0;) (type $#type0) (param $old_ptr i32) (param $old_size i32) (param $align i32) (param $new_size i32) (result i32)
      (local $ret i32)
      local.get $old_ptr
      if $#label0
        local.get $old_size
        local.get $new_size
        i32.gt_u
        if $#label1
          local.get $old_ptr
          return
        end
      end
      global.get $last
      local.get $align
      i32.const -1
      i32.add
      i32.add
      local.get $align
      i32.const -1
      i32.add
      i32.const -1
      i32.xor
      i32.and
      global.set $last
      global.get $last
      local.set $ret
      global.get $last
      local.get $new_size
      i32.add
      global.set $last
      loop $loop
        memory.size
        i32.const 65536
        i32.mul
        global.get $last
        i32.lt_u
        if $#label1
          i32.const 1
          memory.grow
          i32.const -1
          i32.eq
          if $#label2
            unreachable
          end
          br $loop
        end
      end
      local.get $ret
      i32.const 222
      local.get $new_size
      memory.fill
      local.get $old_ptr
      if $#label0
        local.get $ret
        local.get $old_ptr
        local.get $old_size
        memory.copy
      end
      local.get $ret
    )
  )

  (component $caller
    (type $t5 (list u16))
    (type $t0 (tuple $t5 string string bool s16))
    (type $sig (func async (param "p0" $t0) (param "p1" $t0) (result $t0)))
    (import "echo-import" (func $f (type $sig)))

    (core instance $libc (instantiate $libc))
    (core func $f_lower
      (canon lower
        (func $f)
        (memory $libc "memory")
        (realloc (func $libc "realloc"))
        string-encoding=latin1+utf16
      )
    )

    (core module $m
      (type $import (func (param i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32)))
      (type $#type2 (func (param i32 i32 i32 i32) (result i32)))
      (import "libc" "realloc" (func $realloc (type $#type2)))
      (import "host" "echo-import" (func $host (type $import)))
      (func (export "echo-export") (param $retptr i32) (param $argptr i32) (param $#local2 i32) (param $#local3 i32) (param $#local4 i32) (param $#local5 i32) (param $#local6 i32) (param $#local7 i32) (param $#local8 i32) (param $#local9 i32) (param $#local10 i32) (param $#local11 i32) (param $#local12 i32) (param $#local13 i32) (param $#local14 i32) (param $#local15 i32) (result i32)
        (local $#local16 i32) (local $#local17 i32)
        local.get $retptr
        local.get $argptr
        local.get $#local2
        local.get $#local3
        local.get $#local4
        local.get $#local5
        local.get $#local6
        local.get $#local7
        local.get $#local8
        local.get $#local9
        local.get $#local10
        local.get $#local11
        local.get $#local12
        local.get $#local13
        local.get $#local14
        local.get $#local15
        i32.const 0
        i32.const 0
        i32.const 4
        i32.const 28
        call $realloc
        local.set $#local16
        local.get $#local16
        call $host
        local.get $#local16
      )
    )
    (core instance $i (instantiate $m
      (with "libc" (instance $libc))
      (with "host" (instance (export "echo-import" (func $f_lower))))
    ))
    (func (export "echo-export") (type $sig)
      (canon lift
        (core func $i "echo-export")
        (memory $libc "memory")
        (realloc (func $libc "realloc"))
        string-encoding=latin1+utf16)
    )
  )

  (component $callee
    (type $t0 (tuple (list u16) string string bool s16))
    (type $export_sig (func async (param "p0" $t0) (param "p1" $t0) (result $t0)))
    (core instance $libc (instantiate $libc))
    (core module $m
      (func (export "echo-export") (param i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32 i32) (result i32)
        unreachable
      )
      (func (export "callback") (param i32 i32 i32) (result i32)
        unreachable
      )
    )
    (core instance $i (;3;) (instantiate $m
        (with "libc" (instance $libc))
      )
    )
    (func (export "echo-export") (type $export_sig)
      (canon lift
        (core func $i "echo-export")
        (memory $libc "memory")
        (realloc (func $libc "realloc"))
        string-encoding=utf8
        async
        (callback (func $i "callback"))
      )
    )
  )

  (instance $c1 (instantiate $callee))
  (instance $c2 (instantiate $caller
    (with "echo-import" (func $c1 "echo-export"))
  ))
  (export "echo-export" (func $c2 "echo-export"))
)

(assert_trap
  (invoke "echo-export"
    (tuple.const
      (list.const)
      (str.const "")
      (str.const "")
      (bool.const false)
      (s16.const 0)
    )
    (tuple.const
      (list.const )
      (str.const "")
      (str.const "")
      (bool.const false)
      (s16.const 0)
    )
  )
  "unreachable")
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>yields:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">dev</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.10</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span><span class="err">`</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">2543961</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">2120</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span>
<span class="nc">range</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="mi">16</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>