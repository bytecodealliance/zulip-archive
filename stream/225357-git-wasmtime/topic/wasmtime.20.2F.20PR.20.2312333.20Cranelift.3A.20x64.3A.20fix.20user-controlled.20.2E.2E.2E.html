<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12333 Cranelift: x64: fix user-controlled ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html">wasmtime / PR #12333 Cranelift: x64: fix user-controlled ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="567826491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826491">(Jan 13 2026 at 17:49)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a> from <code>cfallin:icmp-recursion</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>We had a set of rules introduced in #11097 that attempted to optimize the case of testing the result of an <code>icmp</code> for a nonzero value. This allowed optimization of, for example, <code>(((x == 0) == 0) == 0 ...)</code> to a single level, either <code>x == 0</code> or <code>x != 0</code> depending on even/odd nesting depth.</p>
<p>Unfortunately this kind of recursion in the backend has a depth bounded only by the user input, hence creates a DoS vulnerability: the wrong kind of compiler input can cause a stack overflow in Cranelift at compilation time. This case is reachable from Wasmtime's Wasm frontend via the <code>i32.eqz</code> operator (for example) as well.</p>
<p>Ideally, this kind of deep rewrite is best done in our mid-end optimizer, where we think carefully about bounds for recursive rewrites. The left-hand sides for the backend rules should really be fixed shapes that correspond to machine instructions, rather than ad-hoc peephole optimizations in their own right.</p>
<p>This fix thus simply removes the recursion case that causes the blowup. The patch includes two tests: one with optimizations disabled, showing correct compilation (without the fix, this case fails to compile with a stack overflow), and one with optimizations enabled, showing that the mid-end properly cleans up the nested expression and we get the expected one-level result anyway.</p>
<p>Note: this was reported as a security issue by @venkkatesh-sekar (thanks!); per our <a href="https://docs.wasmtime.dev/security-what-is-considered-a-security-vulnerability.html">security policy</a>, compilation DoS is not covered, so this is being fixed in a public PR. I will subsequently make a patch release to our currently supported versions (v36, v39, v40, 41).</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="567826495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826495">(Jan 13 2026 at 17:49)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567826496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826496">(Jan 13 2026 at 17:49)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567826531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826531">(Jan 13 2026 at 17:49)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567826693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826693">(Jan 13 2026 at 17:50)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>We had a set of rules introduced in #11097 that attempted to optimize the case of testing the result of an <code>icmp</code> for a nonzero value. This allowed optimization of, for example, <code>(((x == 0) == 0) == 0 ...)</code> to a single level, either <code>x == 0</code> or <code>x != 0</code> depending on even/odd nesting depth.</p>
<p>Unfortunately this kind of recursion in the backend has a depth bounded only by the user input, hence creates a compiler DoS vulnerability: the wrong kind of compiler input can cause a stack overflow in Cranelift at compilation time. This case is reachable from Wasmtime's Wasm frontend via the <code>i32.eqz</code> operator (for example) as well.</p>
<p>Ideally, this kind of deep rewrite is best done in our mid-end optimizer, where we think carefully about bounds for recursive rewrites. The left-hand sides for the backend rules should really be fixed shapes that correspond to machine instructions, rather than ad-hoc peephole optimizations in their own right.</p>
<p>This fix thus simply removes the recursion case that causes the blowup. The patch includes two tests: one with optimizations disabled, showing correct compilation (without the fix, this case fails to compile with a stack overflow), and one with optimizations enabled, showing that the mid-end properly cleans up the nested expression and we get the expected one-level result anyway.</p>
<p>Note: this was reported as a security issue by @venkkatesh-sekar (thanks!); per our <a href="https://docs.wasmtime.dev/security-what-is-considered-a-security-vulnerability.html">security policy</a>, compilation DoS is not covered, so this is being fixed in a public PR. I will subsequently make a patch release to our currently supported versions (v36, v39, v40, 41).</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="567826806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826806">(Jan 13 2026 at 17:50)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#pullrequestreview-3657096440">PR review</a>.</p>



<a name="567826940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567826940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567826940">(Jan 13 2026 at 17:51)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567832096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567832096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567832096">(Jan 13 2026 at 18:19)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3745737995">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>I haven't dug deeply into the fallout here, but it looks like just removing these rules isn't enough to retain the codegen we have from before. A rough hunch is that there's a number of entrypoints for using these ISLE helpers and while the wasm test case here is one which is also cleaned up by the optimizer I think that these rules might be load-bearing for other codegen patterns unrelated to the optimizer.</p>
<p>It might need to be the case that some entrypoints use one rule, which includes these deleted rules, but then these rules don't recurse on themselves?</p>
</blockquote>



<a name="567832445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567832445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567832445">(Jan 13 2026 at 18:21)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3745746996">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>Although, from another angle, this seems fine as a thing to backport since it's clearly such low impact. I'm not aware of these codegen patterns being load bearing in terms of performance so a temporary minor regression while a "full fix" is developed for <code>main</code> I think would also be reasonable. In such a case though there's a number of codegen/etc tests to update to get CI passing.</p>
</blockquote>



<a name="567838681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567838681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567838681">(Jan 13 2026 at 18:59)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3745905075">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>This broke some existing lowerings; playing a bit more with various ways to break the cycle.</p>
</blockquote>



<a name="567838814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567838814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567838814">(Jan 13 2026 at 19:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3745908749">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>(On refresh, what Alex said -- somehow those comments didn't appear for me.)</p>
</blockquote>



<a name="567854366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567854366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567854366">(Jan 13 2026 at 20:33)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567854668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567854668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567854668">(Jan 13 2026 at 20:35)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746460956">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>OK, I've reworked things a bit to preserve exactly the same codegen on branches -- I effectively peeled one layer off of <code>is_nonzero_cmp</code> to continue to use with branches but the previous backedge from <code>emit_cmp</code> to <code>is_nonzero_cmp</code> now invokes <code>is_nonzero</code> which has only the base cases. Together with explicit LHS patterns to peel one level of <code>uextend</code> this leaves us with no test-output changes now.</p>
</blockquote>



<a name="567854831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567854831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567854831">(Jan 13 2026 at 20:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567854832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567854832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567854832">(Jan 13 2026 at 20:37)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567854909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567854909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567854909">(Jan 13 2026 at 20:37)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746467903">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>Or, well, spoke too soon -- no Cranelift filetest changes. A few disas tests that do FP compares do regress to materializing the bool.</p>
</blockquote>



<a name="567865911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567865911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567865911">(Jan 13 2026 at 21:55)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567866236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567866236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567866236">(Jan 13 2026 at 21:58)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746747846">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>OK, I've gotten full equivalence on the disas tests too -- this needed one new mid-end rule to see through a pattern (<code>fcmp(...) != 0</code>) that we were previously only ever simplifying with this peephole rule in the backend. </p>
<p>@fitzgen mind giving this another look, since it's a little heavier than before?</p>
<p>Re: backport, I could certainly backport the rule deletions only, but I'd be a little concerned about performance regressions in that case because this affects many branches. If we feel ok about these rewrites I think the full patch should be applicable back to v36 (LTS).</p>
</blockquote>



<a name="567871891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567871891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567871891">(Jan 13 2026 at 22:42)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#pullrequestreview-3658212925">PR review</a>.</p>



<a name="567871893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567871893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567871893">(Jan 13 2026 at 22:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#discussion_r2688357363">PR review comment</a>:</p>
<blockquote>
<p>I think this change, the <code>uextend</code>-no-longer-recurses, is what's causing the remaining disassembly differences. Locally I'm seeing <code>(uextend (vall_{any,true} ..))</code> I believe for example.</p>
<p>Do you think it'd be worth adding those specifically here as well? I'm not sure how to deduplicate this amongst the <code>is_nonzero</code> selectors above otherwise. Although nowadays egraphs might be able to rewrite <code>(brif (uextend val))</code> to <code>(brif val)</code> which I know historically was difficult</p>
</blockquote>



<a name="567872108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567872108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567872108">(Jan 13 2026 at 22:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746904096">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>Also, logistically, @cfallin are you ok running point on backporting/point releases? And 24.0.0, while supported, is unaffected right?</p>
</blockquote>



<a name="567872655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567872655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567872655">(Jan 13 2026 at 22:50)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746917535">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>Yes, I'm happy to do the backports too. (Sorry, very slow today taking scraps of time between meetings and other interrupts; can hopefully do backports by end of tomorrow at latest.)</p>
</blockquote>



<a name="567872947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567872947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567872947">(Jan 13 2026 at 22:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746926403">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>Oh no worries! Just want to make sure there's explicitly an owner. Tomorrow is totally fine and I can be around to hit approvals and help babysit CI. We've had some CI changes recently like trusted publishing which raises the risk of broken CI on other branches, so something to watch out for.</p>
</blockquote>



<a name="567873497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873497">(Jan 13 2026 at 22:59)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567873512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873512">(Jan 13 2026 at 22:59)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#pullrequestreview-3658247843">PR review</a>.</p>



<a name="567873513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873513">(Jan 13 2026 at 22:59)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#discussion_r2688390569">PR review comment</a>:</p>
<blockquote>
<p>Ah, I missed this -- fixed in latest push (which drops the commit with any diffs to tests at all).</p>
</blockquote>



<a name="567873549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873549">(Jan 13 2026 at 22:59)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#discussion_r2688391268">PR review comment</a>:</p>
<blockquote>
<p>(Fixed by adding explicit patterns in <code>is_nonzero</code> as you suggest)</p>
</blockquote>



<a name="567873551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873551">(Jan 13 2026 at 22:59)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#pullrequestreview-3658248534">PR review</a>.</p>



<a name="567873648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873648">(Jan 13 2026 at 23:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746943725">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>OK, this should be good to go -- if r+ here then I can put up backports momentarily.</p>
</blockquote>



<a name="567873708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567873708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567873708">(Jan 13 2026 at 23:00)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3746943725">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>OK, this should be good to go -- if r+ here (on new changes) then I can put up backports momentarily.</p>
</blockquote>



<a name="567874783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567874783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567874783">(Jan 13 2026 at 23:10)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#pullrequestreview-3658269719">PR review</a>.</p>



<a name="567874910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567874910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567874910">(Jan 13 2026 at 23:11)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567877845"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567877845" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567877845">(Jan 13 2026 at 23:36)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>.</p>



<a name="567952578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312333%20Cranelift%3A%20x64%3A%20fix%20user-controlled%20.../near/567952578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312333.20Cranelift.3A.20x64.3A.20fix.20user-controlled.20.2E.2E.2E.html#567952578">(Jan 14 2026 at 10:46)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/12333#issuecomment-3748924064">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12333">PR #12333</a>:</p>
<blockquote>
<p>Thanks for taking care of this @cfallin, @alexcrichton, and @fitzgen!</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>