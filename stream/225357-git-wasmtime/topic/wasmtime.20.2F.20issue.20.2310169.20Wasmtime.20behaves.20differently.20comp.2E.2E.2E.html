<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10169 Wasmtime behaves differently comp... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html">wasmtime / issue #10169 Wasmtime behaves differently comp...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="497342125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497342125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497342125">(Feb 03 2025 at 06:43)</a>:</h4>
<p><a href="https://github.com/teyahb8">teyahb8</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">Issue #10169</a>.</p>



<a name="497342130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497342130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497342130">(Feb 03 2025 at 06:43)</a>:</h4>
<p>teyahb8 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>The wat code and the corresponding wasm module are compressed here: <a href="https://github.com/user-attachments/files/18638109/files.zip">files.zip</a></p>
<h3>Steps to Reproduce</h3>
<ul>
<li>Extract the files from the compressed file</li>
<li>Run <code>wat2wasm 366.wat</code></li>
<li>Run <code>wasmtime --invoke main 366.wasm</code></li>
</ul>
<h3>Expected Results</h3>
<p>Based on the differential behavior of <code>wasmer</code>, <code>wamr (aot mode)</code>, and <code>wasmedge</code> runtimes, the expected behavior is an <code>out of bounds</code> error.</p>
<h3>Actual Results</h3>
<p>The actual result from the <code>wasmtime</code> runtime is a <code>stack overflow</code>.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime 28.0.0 (3e0b7e501 2024-11-19)</p>
<p>Operating system: Linux</p>
<p>Architecture: x86_64</p>
<p>Can you please confirm if this behavior is expected from <code>wasmtime</code> or is this a bug? Thanks in advance.<br>
</p>
</blockquote>



<a name="497343128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497343128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497343128">(Feb 03 2025 at 06:51)</a>:</h4>
<p>teyahb8 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>The wat code and the corresponding wasm module are compressed here: <a href="https://github.com/user-attachments/files/18638109/files.zip">files.zip</a></p>
<h3>Steps to Reproduce</h3>
<ul>
<li>Extract the files from the compressed file</li>
<li>Run <code>wat2wasm 366.wat</code></li>
<li>Run <code>wasmtime --invoke main 366.wasm</code></li>
</ul>
<h3>Expected Results</h3>
<p>Based on the differential behavior of <code>wasmer</code>, <code>wamr (aot mode)</code>, and <code>wasmedge</code> runtimes, the expected behavior is an <code>out of bounds</code> error.</p>
<h3>Actual Results</h3>
<p>The actual result from the <code>wasmtime</code> runtime is a <code>stack overflow</code>.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime 30.0.0 (a0338af84 2025-01-31)</p>
<p>Operating system: Linux</p>
<p>Architecture: x86_64</p>
<p>Can you please confirm if this behavior is expected from <code>wasmtime</code> or is this a bug? Thanks in advance.<br>
</p>
</blockquote>



<a name="497347880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497347880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497347880">(Feb 03 2025 at 07:23)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/10169#issuecomment-2630159726">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<p>@teyahb8 in the future, would you mind posting the example directly? Posting a link to a .zip file that must be downloaded and extracted to view, especially when that <code>.zip</code> file is 506 bytes and the resulting WAT is 13 lines, is fairly wasteful of maintainers' time. Thanks!</p>
<p>The test-case is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span>
<span class="w">  </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"main"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">memory</span><span class="p">.</span><span class="n">grow</span>
<span class="w">    </span><span class="n">v128</span><span class="p">.</span><span class="n">load</span><span class="w"> </span><span class="n">offset</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="n">align</span><span class="o">=</span><span class="mi">2</span>
<span class="w">    </span><span class="n">block</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="mi">1</span>
<span class="w">      </span><span class="n">call</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">end</span>
<span class="w">    </span><span class="nb">drop</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>This program recurses, and on each recursion grows the memory by 2 Wasm pages (128 KiB). The memory does not have a limit (the <code>25</code> is its initial size in Wasm pages), so it will grow up to 4GiB, or about 32K recursions (4Gi / 128 Ki, minus initial 25 pages).</p>
<p>It seems unsurprising to me that a program that recurses 32K times runs out of stack. Perhaps the other Wasm engines have different default stack sizes, or allocate a different (smaller) frame per function. Stack exhaustion is one of several sources of engine-specific nondeterminism in Wasm, so if you're running tests of engines against each other, you will need to account for that.</p>
<p>Given all that, I think this is not a bug, just nondeterminism allowed by the spec. Do you agree? Or is there something I'm missing?</p>
</blockquote>



<a name="497348487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497348487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497348487">(Feb 03 2025 at 07:27)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/10169#issuecomment-2630164607">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<p>(And lest the <code>v128.load</code> raise suspicions, it is performing a load from an address based on the returned new memory size in <em>pages</em>, but treating that as a <em>byte-addressed</em> location; so it is always in-bounds.)</p>
</blockquote>



<a name="497403724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497403724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497403724">(Feb 03 2025 at 11:17)</a>:</h4>
<p>primoly <a href="https://github.com/bytecodealliance/wasmtime/issues/10169#issuecomment-2630658326">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<p>If the <code>memory.grow</code> fails due to the host not having enough memory, it returns -1 (=2&lt;sup&gt;32&lt;/sup&gt;-1) leading to an out of bounds memory access.</p>
<p>I tested it in Firefox and it seems to run out of stack as well. I can’t test the other runtimes right now, but could it be that they do some sort of tail-call optimisation? I think that would go against the WebAssembly spec.</p>
</blockquote>



<a name="497411916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497411916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497411916">(Feb 03 2025 at 11:52)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>The wat code and the corresponding wasm module are compressed here: <a href="https://github.com/user-attachments/files/18638109/files.zip">files.zip</a></p>
<h3>Steps to Reproduce</h3>
<ul>
<li>Extract the files from the compressed file</li>
<li>Run <code>wat2wasm 366.wat</code></li>
<li>Run <code>wasmtime --invoke main 366.wasm</code></li>
</ul>
<h3>Expected Results</h3>
<p>Based on the differential behavior of <code>wasmer</code>, <code>wamr (aot mode)</code>, and <code>wasmedge</code> runtimes, the expected behavior is an <code>out of bounds</code> error.</p>
<h3>Actual Results</h3>
<p>The actual result from the <code>wasmtime</code> runtime is a <code>stack overflow</code>.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime 30.0.0 (a0338af84 2025-01-31)</p>
<p>Operating system: Linux</p>
<p>Architecture: x86_64</p>
<p>Can you please confirm if this behavior is expected from <code>wasmtime</code> or is this a bug? Thanks in advance.<br>
</p>
</blockquote>



<a name="497411918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497411918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497411918">(Feb 03 2025 at 11:52)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10169#issuecomment-2630731896">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<p>I agree with @cfallin and @primoly in that there doesn't look to be a bug here. At best other runtimes have different defaults for when stack overflow occurs and at worst other runtimes are going against the spec as @primoly mentions. In either case resource exhaustion is not specified to be the exact same across all runtimes so I don't think there's anything for Wasmtime to do here, so closing.</p>
<p>I would also echo what @cfallin said, avoiding the indirection of a zip is much appreciated.</p>
</blockquote>



<a name="497427410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497427410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497427410">(Feb 03 2025 at 12:57)</a>:</h4>
<p>primoly edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10169#issuecomment-2630658326">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<p>If the <code>memory.grow</code> fails due to the host not having enough memory, it returns -1 (=2&lt;sup&gt;32&lt;/sup&gt;-1) leading to an out of bounds memory access.</p>
<p>I tested it in Edge and it seems to run out of stack as well. I can’t test the other runtimes right now, but could it be that they do some sort of tail-call optimisation? I think that would go against the WebAssembly spec.</p>
</blockquote>



<a name="497442728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310169%20Wasmtime%20behaves%20differently%20comp.../near/497442728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310169.20Wasmtime.20behaves.20differently.20comp.2E.2E.2E.html#497442728">(Feb 03 2025 at 13:59)</a>:</h4>
<p>teyahb8 <a href="https://github.com/bytecodealliance/wasmtime/issues/10169#issuecomment-2631085061">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10169">issue #10169</a>:</p>
<blockquote>
<p>Thanks for the clarification. I agree that the default stack exhaustion behavior can vary. Also, I appreciate the advice on the test case file format. I will make sure to keep this in mind for future issues.</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>