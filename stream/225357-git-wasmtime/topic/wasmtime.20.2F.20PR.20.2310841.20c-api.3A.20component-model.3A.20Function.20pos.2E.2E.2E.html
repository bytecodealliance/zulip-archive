<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10841 c-api: component-model: Function pos... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html">wasmtime / PR #10841 c-api: component-model: Function pos...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="520709682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/520709682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#520709682">(May 27 2025 at 16:24)</a>:</h4>
<p><strong>MangoPeachGrape</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>.</p>



<a name="520709683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/520709683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#520709683">(May 27 2025 at 16:24)</a>:</h4>
<p>MangoPeachGrape opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a> from <code>MangoPeachGrape:c-api/component-model/more</code> to <code>bytecodealliance:main</code>.</p>



<a name="520709684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/520709684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#520709684">(May 27 2025 at 16:24)</a>:</h4>
<p><strong>MangoPeachGrape</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>.</p>



<a name="520710803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/520710803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#520710803">(May 27 2025 at 16:28)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>.</p>



<a name="520760932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/520760932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#520760932">(May 27 2025 at 21:16)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#pullrequestreview-2872704499">PR review</a>:</p>
<blockquote>
<p>Thanks for this!</p>
<p>Random thought: do you know how we might run asan or something to check for memory leaks in CI? I'm not sure how to do that myself but it'd be nice to ensure that we're not accidentally leaking any memory with this representation anywhere</p>
</blockquote>



<a name="520763327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/520763327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#520763327">(May 27 2025 at 21:36)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>.</p>



<a name="521086478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/521086478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#521086478">(May 29 2025 at 12:39)</a>:</h4>
<p>MangoPeachGrape <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#issuecomment-2919271661">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>:</p>
<blockquote>
<p>@alexcrichton I'm not really sure, as the C and Rust allocators are different, right? Would you compile both with LeakSanitizer?<br>
See:<br>
<a href="https://doc.rust-lang.org/beta/unstable-book/compiler-flags/sanitizer.html#leaksanitizer">https://doc.rust-lang.org/beta/unstable-book/compiler-flags/sanitizer.html#leaksanitizer</a><br>
<a href="https://clang.llvm.org/docs/LeakSanitizer.html">https://clang.llvm.org/docs/LeakSanitizer.html</a></p>
</blockquote>



<a name="521118176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/521118176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#521118176">(May 29 2025 at 15:28)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#issuecomment-2919757301">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>:</p>
<blockquote>
<p>They should both bottom out in <code>malloc</code> and <code>free</code> by default, so I think ASAN might be enough (which IIRC also detects leaks in addition to other things).  If LSAN works though that also seems reasonable to me</p>
</blockquote>



<a name="521852668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/521852668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#521852668">(Jun 02 2025 at 22:04)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#issuecomment-2932670001">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>:</p>
<blockquote>
<p>I recently hooked up wasmtime and a C api project (though not wasmtime's C api) to asan to find my own bugs of that sort. I found that I needed to:</p>
<ul>
<li>compile the rust with nightly and <code>RUSTFLAGS=-Zsanitizer=address</code></li>
<li>install and build the C with an llvm/clang toolchain that is relatively recent so the sanitizer is compatible with the information emitted by rustc, since my CI package manager's was too old I used LLVM-20.1 which is the same version rust is using in nightly</li>
<li>build the C sources with <code>-fsanitize=address,undefined -fno-omit-frame-pointer</code> cflags</li>
</ul>
</blockquote>



<a name="521852734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/521852734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#521852734">(Jun 02 2025 at 22:05)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#issuecomment-2932670001">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>:</p>
<blockquote>
<p>I recently hooked up wasmtime and a C api project (though not wasmtime's C api) to asan to find my own bugs of that sort. I found that I needed to:</p>
<ul>
<li>compile the rust with nightly and <code>RUSTFLAGS=-Zsanitizer=address</code></li>
<li>install and build the C with an llvm/clang toolchain that is relatively recent so the sanitizer is compatible with the information emitted by rustc, since my CI package manager's was too old I used LLVM-20.1 which is the same version rust is using in nightly. I don't have a sense for when rust will drift far enough from that to break something, but it works right now anyway.</li>
<li>build the C sources with <code>-fsanitize=address,undefined -fno-omit-frame-pointer</code> cflags</li>
</ul>
</blockquote>



<a name="521853006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/521853006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#521853006">(Jun 02 2025 at 22:06)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#issuecomment-2932670001">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>:</p>
<blockquote>
<p>I recently hooked up wasmtime and a C api project (though not wasmtime's C api) to asan to find my own bugs of that sort. I found that I needed to:</p>
<ul>
<li>compile the rust with nightly and <code>RUSTFLAGS=-Zsanitizer=address</code></li>
<li>install and build the C with an llvm/clang toolchain that is relatively recent so the sanitizer is compatible with the information emitted by rustc, since my CI package manager's was too old I used LLVM-20.1 which is the same version rust is using in nightly. I don't have a sense for when rust will drift far enough from that to break something, but it works right now anyway.</li>
<li>build the C sources with <code>-fsanitize=address,undefined -fno-omit-frame-pointer</code> cflags</li>
<li>set <code>ASAN_SYMBOLIZER_PATH=&lt;install location of LLVM-20.1.0-Linux-X64&gt;/bin/llvm-symbolizer</code> to get symbols in asan's traces</li>
</ul>
</blockquote>



<a name="521853308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310841%20c-api%3A%20component-model%3A%20Function%20pos.../near/521853308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310841.20c-api.3A.20component-model.3A.20Function.20pos.2E.2E.2E.html#521853308">(Jun 02 2025 at 22:09)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10841#issuecomment-2932670001">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10841">PR #10841</a>:</p>
<blockquote>
<p>I recently hooked up wasmtime and a C api project (though not wasmtime's C api) to asan to find my own bugs of that sort. I found that I needed to:</p>
<ul>
<li>compile the rust with nightly and <code>RUSTFLAGS=-Zsanitizer=address</code></li>
<li>install and build the C with an llvm/clang toolchain that is relatively recent so the sanitizer is compatible with the information emitted by rustc, since my CI package manager's was too old I used LLVM-20.1 which is the same version rust is using in nightly. I don't have a sense for when rust will drift far enough from that to break something, but it works right now anyway.</li>
<li>build the C sources with <code>-fsanitize=address,undefined -fno-omit-frame-pointer</code> cflags</li>
<li>set <code>ASAN_SYMBOLIZER_PATH=&lt;install location of LLVM-20.1.0-Linux-X64&gt;/bin/llvm-symbolizer</code> to get symbols in asan's traces</li>
</ul>
<p>Also, beware that running debug builds of cranelift under asan will be egregiously, obscenely slow.</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>