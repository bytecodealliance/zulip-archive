<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11255 More table safety improvements · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html">wasmtime / PR #11255 More table safety improvements</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="529093301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529093301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529093301">(Jul 16 2025 at 16:07)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<a name="529093302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529093302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529093302">(Jul 16 2025 at 16:07)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a> from <code>alexcrichton:more-safer-tables</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is some more progress on #11179 aimed at improving the safety of management of tables internally within Wasmtime:</p>
<ul>
<li><code>Instance::table_index</code> is removed as it can be replaced with data stored directly in the <code>VMTableImport</code> now.</li>
<li><code>Instance::get_table</code> now returns <code>&amp;mut Table</code></li>
<li><code>Instance::get_defined_table_with_lazy_init</code> now returns <code>&amp;mut Table</code></li>
<li><code>Instance::with_defined_table_index_and_instance</code> now directly returns <code>DefinedTableIndex</code> plus <code>Pin&lt;&amp;mut Instance&gt;</code>, codifying the ability to "laterally move" between instances.</li>
<li><code>Instance::table_init_segment</code> was refactored to "take" the tables during initialization and replace them afterwards, resolving the split borrow issue and removing an <code>unsafe</code> block in the function.</li>
</ul>
<p>cc #11179</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="529093303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529093303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529093303">(Jul 16 2025 at 16:07)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<a name="529097925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529097925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529097925">(Jul 16 2025 at 16:35)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11255#pullrequestreview-3025842110">PR review</a>.</p>



<a name="529117100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529117100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529117100">(Jul 16 2025 at 18:43)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<a name="529117101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529117101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529117101">(Jul 16 2025 at 18:43)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<a name="529117102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529117102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529117102">(Jul 16 2025 at 18:43)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<a name="529117260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529117260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529117260">(Jul 16 2025 at 18:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11255#issuecomment-3079868378">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>:</p>
<blockquote>
<p>The Miri violation of stacked borrows is I believe legitimate, so I've added a new commit which improves the safety situation around <code>Table::copy</code>. @pchickey mind reviewing that new commit as well?</p>
</blockquote>



<a name="529151685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529151685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529151685">(Jul 16 2025 at 19:11)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<a name="529174224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529174224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529174224">(Jul 16 2025 at 22:12)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>:</p>
<blockquote>
<p>This is some more progress on #11179 aimed at improving the safety of management of tables internally within Wasmtime:</p>
<ul>
<li><code>Instance::table_index</code> is removed as it can be replaced with data stored directly in the <code>VMTableImport</code> now.</li>
<li><code>Instance::get_table</code> now returns <code>&amp;mut Table</code></li>
<li><code>Instance::get_defined_table_with_lazy_init</code> now returns <code>&amp;mut Table</code></li>
<li><code>Instance::with_defined_table_index_and_instance</code> now directly returns <code>DefinedTableIndex</code> plus <code>Pin&lt;&amp;mut Instance&gt;</code>, codifying the ability to "laterally move" between instances.</li>
<li><code>Instance::table_init_segment</code> was refactored to "take" the tables during initialization and replace them afterwards, resolving the split borrow issue and removing an <code>unsafe</code> block in the function.</li>
</ul>
<p>Closes #11179</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="529174306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529174306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529174306">(Jul 16 2025 at 22:13)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11255#issuecomment-3081372546">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>:</p>
<blockquote>
<p>I've also flagged this as closing <a href="https://github.com/bytecodealliance/wasmtime/issues/11179">https://github.com/bytecodealliance/wasmtime/issues/11179</a> as this resolves all remaining bits I know of there, and I otherwise split out <a href="https://github.com/bytecodealliance/wasmtime/issues/11262">https://github.com/bytecodealliance/wasmtime/issues/11262</a> from that issue.</p>
</blockquote>



<a name="529304429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529304429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529304429">(Jul 17 2025 at 15:25)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11255#pullrequestreview-3030019669">PR review</a>.</p>



<a name="529327749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311255%20More%20table%20safety%20improvements/near/529327749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311255.20More.20table.20safety.20improvements.html#529327749">(Jul 17 2025 at 17:40)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11255">PR #11255</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>