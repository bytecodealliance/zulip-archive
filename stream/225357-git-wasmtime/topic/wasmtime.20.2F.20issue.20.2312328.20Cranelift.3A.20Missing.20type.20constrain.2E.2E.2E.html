<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12328 Cranelift: Missing type constrain... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html">wasmtime / issue #12328 Cranelift: Missing type constrain...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="567662643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567662643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567662643">(Jan 12 2026 at 23:53)</a>:</h4>
<p>zzjas opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<h3><code>.clif</code> Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">optimize</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed</span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">trigger_bug</span><span class="p">(</span><span class="n">i32x4</span><span class="p">,</span><span class="w"> </span><span class="n">i32x4</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">i32x4</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span><span class="p">:</span><span class="w"> </span><span class="nc">i32x4</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">:</span><span class="w"> </span><span class="nc">i32x4</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">sgt</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">cranelift</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">clif</span><span class="o">-</span><span class="n">util</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">clif</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>No crash</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span><span class="p">#</span><span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">1654070</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">opts</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">191</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span>
<span class="nc">unimplemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="n">bits</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 54c1192eed26434359f3263e4fe95f3d8a2fa520</p>
<p>Operating system: Ubuntu 22.04.5</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>The optimization rules at <code>cranelift/codegen/src/opts/icmp.isle</code> lines 316-351 produce <code>(iconst_u ty 0)</code> without constraining ty to scalar types. When <code>ty</code> is a 128-bit vector type (e.g., <code>i32x4</code>), <code>iconst_u calls ty_umax()</code> → <code>ty_mask()</code>, which computes <code>64_u64.checked_sub(ty_bits)</code>. For 128-bit types, this underflows and panics with "unimplemented for &gt; 64 bits". Fix would be smilar to #12179. </p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351">https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351</a></p>
<p>Thanks for looking into this and please let us know if we missed anything or if you have any feedback!<br>
</p>
</blockquote>



<a name="567662644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567662644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567662644">(Jan 12 2026 at 23:53)</a>:</h4>
<p><a href="https://github.com/zzjas">zzjas</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">Issue #12328</a>.</p>



<a name="567662645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567662645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567662645">(Jan 12 2026 at 23:53)</a>:</h4>
<p><a href="https://github.com/zzjas">zzjas</a> added the cranelift label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">Issue #12328</a>.</p>



<a name="567663835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567663835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567663835">(Jan 13 2026 at 00:06)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3741094381">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<p>@zzjas would you be willing to try your hand at the fix?</p>
<p>(No worries if not, but this is a standard question I like to ask new folks doing fuzzing: fuzzing to find the issues is relatively less work than actually fixing them, and so in the interest of avoiding a labor imbalance / DoS'ing our project, and since you point out what the likely fix is, I want to see if you're willing to take on the fixes themselves as well -- thanks!)</p>
</blockquote>



<a name="567664302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567664302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567664302">(Jan 13 2026 at 00:10)</a>:</h4>
<p>zzjas <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3741112258">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<p>Yes for sure I'd love to prepare a fix and some more test cases (probably later tomorrow). Thanks!</p>
</blockquote>



<a name="567664982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567664982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567664982">(Jan 13 2026 at 00:19)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">Issue #12328</a>.</p>



<a name="567693869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567693869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567693869">(Jan 13 2026 at 06:47)</a>:</h4>
<p>lmtdit <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<p>Hi Chris,</p>
<p>Thank you for the suggestion. I'd be happy to work on a fix for this issue<br>
and will aim to submit a patch with additional test cases tomorrow. I'll<br>
make sure to follow the pattern from #12179 to properly constrain the type<br>
in the ISLE icmp rules.</p>
<p>I'll reach out if I have any questions during implementation.</p>
<p>Best regards,<br>
Zijie Zhao</p>
<p>Zijie Zhao <strong><em>@</em></strong>.***&gt; 于2026年1月13日周二 07:53写道：</p>
<blockquote>
<p><em>zzjas</em> created an issue (<a href="https://github.com/bytecodealliance/wasmtime/issues/12328">bytecodealliance/wasmtime#12328</a>)<br>
&lt;<a href="https://github.com/bytecodealliance/wasmtime/issues/12328">https://github.com/bytecodealliance/wasmtime/issues/12328</a>&gt;<br>
.clif Test Case</p>
<p>test optimize<br>
set opt_level=speed<br>
target x86_64</p>
<p>function %trigger_bug(i32x4, i32x4) -&gt; i32x4 {<br>
block0(v0: i32x4, v1: i32x4):<br>
    v2 = icmp sgt v0, v1<br>
    v3 = icmp slt v0, v1<br>
    v4 = band v2, v3<br>
    return v4<br>
}</p>
<p>Steps to Reproduce</p>
<p>RUST_BACKTRACE=1 cargo run -p cranelift-tools --bin clif-util -- test test.clif</p>
<p>Expected Results</p>
<p>No crash<br>
Actual Results</p>
<p>thread 'worker #0' (1654070) panicked at cranelift/codegen/src/opts.rs:191:5:<br>
unimplemented for &gt; 64 bits</p>
<p>Versions and Environment</p>
<p>Cranelift version or commit: 54c1192<br>
&lt;<a href="https://github.com/bytecodealliance/wasmtime/commit/54c1192eed26434359f3263e4fe95f3d8a2fa520">https://github.com/bytecodealliance/wasmtime/commit/54c1192eed26434359f3263e4fe95f3d8a2fa520</a>&gt;</p>
<p>Operating system: Ubuntu 22.04.5</p>
<p>Architecture: x86_64<br>
Extra Info</p>
<p>The optimization rules at cranelift/codegen/src/opts/icmp.isle lines<br>
316-351 produce (iconst_u ty 0) without constraining ty to scalar types.<br>
When ty is a 128-bit vector type (e.g., i32x4), iconst_u calls ty_umax()<br>
→ ty_mask(), which computes 64_u64.checked_sub(ty_bits). For 128-bit<br>
types, this underflows and panics with "unimplemented for &gt; 64 bits". Fix<br>
would be smilar to #12179<br>
&lt;<a href="https://github.com/bytecodealliance/wasmtime/pull/12179">https://github.com/bytecodealliance/wasmtime/pull/12179</a>&gt;.</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351">https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351</a></p>
<p>Thanks for looking into this and please let us know if we missed anything<br>
or if you have any feedback!</p>
<p>—<br>
Reply to this email directly, view it on GitHub<br>
&lt;<a href="https://github.com/bytecodealliance/wasmtime/issues/12328">https://github.com/bytecodealliance/wasmtime/issues/12328</a>&gt;, or<br>
unsubscribe<br>
&lt;<a href="https://github.com/notifications/unsubscribe-auth/ABBFIVKLLLSN5QR7MUQK3J34GQXZHAVCNFSM6AAAAACRPJV3B6VHI2DSMVQWIX3LMV43ASLTON2WKOZTHAYDMNBTGM3DSMQ">https://github.com/notifications/unsubscribe-auth/ABBFIVKLLLSN5QR7MUQK3J34GQXZHAVCNFSM6AAAAACRPJV3B6VHI2DSMVQWIX3LMV43ASLTON2WKOZTHAYDMNBTGM3DSMQ</a>&gt;<br>
.<br>
You are receiving this because you are subscribed to this thread.Message<br>
ID: <strong><em>@</em></strong>.***&gt;</p>
</blockquote>
</blockquote>



<a name="567847394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567847394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567847394">(Jan 13 2026 at 19:48)</a>:</h4>
<p>zzjas <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3746224993">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<p>No idea who <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302">https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302</a> is. It's not my account and not my message -- probably a spam...</p>
</blockquote>



<a name="567864419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567864419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567864419">(Jan 13 2026 at 21:49)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3746722626">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<blockquote>
<p>No idea who <a href="https://github.com/bytecodealliance/wasmtime/issues/12328#issuecomment-3742285302">#12328 (comment)</a> is. It's not my account and not my message -- probably a spam...</p>
</blockquote>
<p>Thanks, I blocked them.</p>
</blockquote>



<a name="567877825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312328%20Cranelift%3A%20Missing%20type%20constrain.../near/567877825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312328.20Cranelift.3A.20Missing.20type.20constrain.2E.2E.2E.html#567877825">(Jan 13 2026 at 23:36)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12328">issue #12328</a>:</p>
<blockquote>
<h3><code>.clif</code> Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">optimize</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed</span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">trigger_bug</span><span class="p">(</span><span class="n">i32x4</span><span class="p">,</span><span class="w"> </span><span class="n">i32x4</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">i32x4</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span><span class="p">:</span><span class="w"> </span><span class="nc">i32x4</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">:</span><span class="w"> </span><span class="nc">i32x4</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">sgt</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">cranelift</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">clif</span><span class="o">-</span><span class="n">util</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">clif</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>No crash</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span><span class="p">#</span><span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">1654070</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">opts</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">191</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span>
<span class="nc">unimplemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="n">bits</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 54c1192eed26434359f3263e4fe95f3d8a2fa520</p>
<p>Operating system: Ubuntu 22.04.5</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>The optimization rules at <code>cranelift/codegen/src/opts/icmp.isle</code> lines 316-351 produce <code>(iconst_u ty 0)</code> without constraining ty to scalar types. When <code>ty</code> is a 128-bit vector type (e.g., <code>i32x4</code>), <code>iconst_u calls ty_umax()</code> → <code>ty_mask()</code>, which computes <code>64_u64.checked_sub(ty_bits)</code>. For 128-bit types, this underflows and panics with "unimplemented for &gt; 64 bits". Fix would be smilar to #12179. </p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351">https://github.com/bytecodealliance/wasmtime/blob/54c1192eed26434359f3263e4fe95f3d8a2fa520/cranelift/codegen/src/opts/icmp.isle#L316-L351</a></p>
<p>Thanks for looking into this and please let us know if we missed anything or if you have any feedback!<br>
</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>