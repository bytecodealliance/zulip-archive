<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10459 [GC] id from different slab · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html">wasmtime / issue #10459 [GC] id from different slab</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="507385089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310459%20%5BGC%5D%20id%20from%20different%20slab/near/507385089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html#507385089">(Mar 21 2025 at 23:39)</a>:</h4>
<p><a href="https://github.com/vouillon">vouillon</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10459">Issue #10459</a>.</p>



<a name="507385094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310459%20%5BGC%5D%20id%20from%20different%20slab/near/507385094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html#507385094">(Mar 21 2025 at 23:40)</a>:</h4>
<p>vouillon opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10459">issue #10459</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><a href="https://github.com/user-attachments/files/19398643/fail.zip">fail.zip</a></p>
<h3>Steps to Reproduce</h3>
<p>Run the following command:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w">  </span><span class="o">-</span><span class="n">W</span><span class="o">=</span><span class="n">all</span><span class="o">-</span><span class="n">proposals</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="n">fail</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should not crash.</p>
<h3>Actual Results</h3>
<p>We get a panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jerome</span><span class="o">/</span><span class="n">sources</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">slab</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">387</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span>
<span class="nc">id</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">slab</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime commit: dbed370c8a0e1522c33a7cb8e086f04cffcf8378 (PR #10456)</p>
<p>Operating system: Linux</p>
<p>Architecture: x64<br>
</p>
</blockquote>



<a name="507385389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310459%20%5BGC%5D%20id%20from%20different%20slab/near/507385389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html#507385389">(Mar 21 2025 at 23:42)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/10459#issuecomment-2744687055">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10459">issue #10459</a>:</p>
<blockquote>
<p>Thanks! Will look into this next week</p>
</blockquote>



<a name="507863287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310459%20%5BGC%5D%20id%20from%20different%20slab/near/507863287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html#507863287">(Mar 24 2025 at 19:47)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/10459#issuecomment-2749229650">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10459">issue #10459</a>:</p>
<blockquote>
<p>Ah, it turns out that our struct field packing/reordering is invalid in the presence of subtyping. D'oh.</p>
</blockquote>



<a name="507863975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310459%20%5BGC%5D%20id%20from%20different%20slab/near/507863975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html#507863975">(Mar 24 2025 at 19:51)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/10459#issuecomment-2749238412">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10459">issue #10459</a>:</p>
<blockquote>
<p>Slightly reduced test case:</p>
<p><div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">type</span> <span class="nv">$func</span> <span class="p">(</span><span class="k">func</span><span class="p">))</span>

  <span class="p">(</span><span class="k">type</span> <span class="nv">$super</span> <span class="p">(</span><span class="err">sub</span> <span class="p">(</span><span class="err">struct</span> <span class="p">(</span><span class="err">field</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$func</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">type</span> <span class="nv">$sub</span> <span class="p">(</span><span class="err">sub</span> <span class="err">final</span> <span class="nv">$super</span> <span class="p">(</span><span class="err">struct</span> <span class="p">(</span><span class="err">field</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$func</span><span class="p">))</span> <span class="p">(</span><span class="err">field</span> <span class="p">(</span><span class="err">ref</span> <span class="err">eq</span><span class="p">)))))</span>

  <span class="p">(</span><span class="k">elem</span> <span class="err">declare</span> <span class="k">func</span> <span class="nv">$f</span><span class="p">)</span>
  <span class="p">(</span><span class="k">func</span> <span class="nv">$f</span><span class="p">)</span>

  <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"_start"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">drop</span>
      <span class="p">(</span><span class="err">struct.get</span> <span class="nv">$super</span> <span class="mi">0</span>
        <span class="p">(</span><span class="err">struct.new</span> <span class="nv">$sub</span>
          <span class="p">(</span><span class="err">ref.</span><span class="k">func</span> <span class="nv">$f</span><span class="p">)</span>
          <span class="p">(</span><span class="err">ref.i</span><span class="mi">31</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)))))</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="508145122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310459%20%5BGC%5D%20id%20from%20different%20slab/near/508145122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310459.20.5BGC.5D.20id.20from.20different.20slab.html#508145122">(Mar 25 2025 at 23:19)</a>:</h4>
<p>fitzgen closed <a href="https://github.com/bytecodealliance/wasmtime/issues/10459">issue #10459</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><a href="https://github.com/user-attachments/files/19398643/fail.zip">fail.zip</a></p>
<h3>Steps to Reproduce</h3>
<p>Run the following command:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w">  </span><span class="o">-</span><span class="n">W</span><span class="o">=</span><span class="n">all</span><span class="o">-</span><span class="n">proposals</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="n">fail</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should not crash.</p>
<h3>Actual Results</h3>
<p>We get a panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jerome</span><span class="o">/</span><span class="n">sources</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">slab</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">387</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span>
<span class="nc">id</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">slab</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime commit: dbed370c8a0e1522c33a7cb8e086f04cffcf8378 (PR #10456)</p>
<p>Operating system: Linux</p>
<p>Architecture: x64<br>
</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>