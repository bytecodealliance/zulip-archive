<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12043 trap on blocking call in sync task b... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html">wasmtime / PR #12043 trap on blocking call in sync task b...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="558014342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/558014342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#558014342">(Nov 18 2025 at 18:30)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a> from <code>dicej:trap-blocking-in-sync-tasks</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This implements a spec change (PR pending) such that tasks created for calls to synchronous exports may not call potentially-blocking imports or return <code>wait</code> or <code>poll</code> callback codes prior to returning a value.  Specifically, the following are prohibited in that scenario:</p>
<ul>
<li>returning callback-code.{wait,poll}</li>
<li>sync calling async import</li>
<li>sync calling subtask.cancel</li>
<li>sync calling {stream,future}.{read,write}</li>
<li>sync calling {stream,future}.cancel-{read,write}</li>
<li>calling waitable-set.{wait,poll}</li>
<li>calling thread.suspend</li>
</ul>
<p>This breaks a number of tests, which will be addressed in follow-up commits:</p>
<ul>
<li>
<p>The <code>{tcp,udp}-socket.bind</code> implementation in <code>wasmtime-wasi</code> is implemented using <code>Linker::func_wrap_concurrent</code> and thus assumed to be async, whereas the WIT interface says they're sync, leading to a type mismatch error at runtime. Alex and I have discussed this and have a general plan to address it.</p>
</li>
<li>
<p>A number of tests in the tests/component-model submodule that points to the spec repo are failing.  Those will presumably be fixed as part of the upcoming spec PR (although some could be due to bugs in this implementation, in which case I'll fix them).</p>
</li>
<li>
<p>A number of tests in tests/misc_testsuite are failing.  I'll address those in a follow-up commit.</p>
</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="558014373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/558014373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#558014373">(Nov 18 2025 at 18:30)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="558014848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/558014848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#558014848">(Nov 18 2025 at 18:33)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="558014872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/558014872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#558014872">(Nov 18 2025 at 18:33)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>This implements a spec change (PR pending) such that tasks created for calls to synchronous exports may not call potentially-blocking imports or return <code>wait</code> or <code>poll</code> callback codes prior to returning a value.  Specifically, the following are prohibited in that scenario:</p>
<ul>
<li>returning callback-code.{wait,poll}</li>
<li>sync calling an async import</li>
<li>sync calling subtask.cancel</li>
<li>sync calling {stream,future}.{read,write}</li>
<li>sync calling {stream,future}.cancel-{read,write}</li>
<li>calling waitable-set.{wait,poll}</li>
<li>calling thread.suspend</li>
</ul>
<p>This breaks a number of tests, which will be addressed in follow-up commits:</p>
<ul>
<li>
<p>The <code>{tcp,udp}-socket.bind</code> implementation in <code>wasmtime-wasi</code> is implemented using <code>Linker::func_wrap_concurrent</code> and thus assumed to be async, whereas the WIT interface says they're sync, leading to a type mismatch error at runtime. Alex and I have discussed this and have a general plan to address it.</p>
</li>
<li>
<p>A number of tests in the tests/component-model submodule that points to the spec repo are failing.  Those will presumably be fixed as part of the upcoming spec PR (although some could be due to bugs in this implementation, in which case I'll fix them).</p>
</li>
<li>
<p>A number of tests in tests/misc_testsuite are failing.  I'll address those in a follow-up commit.</p>
</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="558023718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/558023718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#558023718">(Nov 18 2025 at 19:19)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="558023796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/558023796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#558023796">(Nov 18 2025 at 19:20)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>This implements a spec change (PR pending) such that tasks created for calls to synchronous exports may not call potentially-blocking imports or return <code>wait</code> or <code>poll</code> callback codes prior to returning a value.  Specifically, the following are prohibited in that scenario:</p>
<ul>
<li>returning callback-code.{wait,poll}</li>
<li>sync calling an async import</li>
<li>sync calling subtask.cancel</li>
<li>sync calling {stream,future}.{read,write}</li>
<li>sync calling {stream,future}.cancel-{read,write}</li>
<li>calling waitable-set.{wait,poll}</li>
<li>calling thread.suspend</li>
</ul>
<p>This breaks a number of tests, which will be addressed in follow-up commits:</p>
<ul>
<li>
<p>The <code>{tcp,udp}-socket.bind</code> implementation in <code>wasmtime-wasi</code> is implemented using <code>Linker::func_wrap_concurrent</code> and thus assumed to be async, whereas the WIT interface says they're sync, leading to a type mismatch error at runtime. Alex and I have discussed this and have a general plan to address it.</p>
</li>
<li>
<p>A number of tests in the tests/component-model submodule that points to the spec repo are failing.  Those will presumably be fixed as part of the upcoming spec PR (although some could be due to bugs in this implementation, in which case I'll fix them).</p>
</li>
<li>
<p><del>A number of tests in tests/misc_testsuite are failing.  I'll address those in a follow-up commit.</del></p>
</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="559103068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/559103068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#559103068">(Nov 24 2025 at 17:02)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3571816483">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>Talked about this with @dicej today, current blockers are:</p>
<ul>
<li>Waiting on upstream PR to the spec to have an official point-of-reference</li>
<li>Current upstream tests are failing, and upstream spec PR likely to update.</li>
<li>Tests for "full matrix of trapping behavior" still needed</li>
</ul>
</blockquote>



<a name="559127442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/559127442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#559127442">(Nov 24 2025 at 18:56)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3572257198">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>Regarding the <code>{tcp,udp}-socket.bind</code> test failures, I've opened <a href="https://github.com/WebAssembly/wasi-sockets/issues/144">https://github.com/WebAssembly/wasi-sockets/issues/144</a>.</p>
<p>Eventually, we'll want a proper way for host functions to "cheat" and block the whole guest _without_ monopolizing the <code>Store</code>, as well, but no need to block this PR on that. </p>
</blockquote>



<a name="560013159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560013159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560013159">(Nov 24 2025 at 20:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3572674670">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>New thought: I think we're going to be required to implement "component-model-sync function can do async things on the host" in Wasmtime. Ignoring p3 for a moment, that's exactly how all async works in WASIp2. All WASIp2 functions are "sync" functions which leverage host superpowers to suspend the guest, and we can't break WASIp2, so I don't think that "just solve tcp/udp for wasip3" is a viable solution after all.</p>
</blockquote>



<a name="560015874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560015874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560015874">(Nov 24 2025 at 21:06)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="560023477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560023477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560023477">(Nov 24 2025 at 21:53)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3572869886">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<blockquote>
<p>All WASIp2 functions are "sync" functions which leverage host superpowers to suspend the guest, and we can't break WASIp2</p>
</blockquote>
<p>Agreed, but I don't see how that's relevant to this PR.  Sync-typed exports are still permitted to call sync-typed imports, and <code>wasmtime-wasi</code>'s p2 implementation uses <code>Linker::func_wrap_async</code>, which defines a sync-typed host function, so nothing in this PR or the proposed spec changes will break <code>wasmtime-wasi</code>'s p2 implementation.</p>
<p>Certainly we'll need to confront p2 head-on once we remove or replace <code>Linker::func_wrap_async</code>, but we're not doing that here.</p>
</blockquote>



<a name="560026453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560026453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560026453">(Nov 24 2025 at 22:11)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3572930200">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>Er right, yes, wires crossed again. That means though that <a href="https://github.com/bytecodealliance/wasmtime/pull/12085">https://github.com/bytecodealliance/wasmtime/pull/12085</a> is possible which "fixes" tcp/udp.</p>
</blockquote>



<a name="560036144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560036144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560036144">(Nov 24 2025 at 23:04)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="560036366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560036366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560036366">(Nov 24 2025 at 23:06)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>This implements a spec change (PR pending) such that tasks created for calls to synchronous exports may not call potentially-blocking imports or return <code>wait</code> or <code>poll</code> callback codes prior to returning a value.  Specifically, the following are prohibited in that scenario:</p>
<ul>
<li>returning callback-code.{wait,poll}</li>
<li>sync calling an async import</li>
<li>sync calling subtask.cancel</li>
<li>sync calling {stream,future}.{read,write}</li>
<li>sync calling {stream,future}.cancel-{read,write}</li>
<li>calling waitable-set.{wait,poll}</li>
<li>calling thread.suspend</li>
</ul>
<p>This breaks a number of tests, which will be addressed in follow-up commits:</p>
<ul>
<li>
<p><del>The <code>{tcp,udp}-socket.bind</code> implementation in <code>wasmtime-wasi</code> is implemented using <code>Linker::func_wrap_concurrent</code> and thus assumed to be async, whereas the WIT interface says they're sync, leading to a type mismatch error at runtime. Alex and I have discussed this and have a general plan to address it.</del> EDIT: addressed by <a href="https://github.com/bytecodealliance/wasmtime/pull/12085">https://github.com/bytecodealliance/wasmtime/pull/12085</a></p>
</li>
<li>
<p>A number of tests in the tests/component-model submodule that points to the spec repo are failing.  Those will presumably be fixed as part of the upcoming spec PR (although some could be due to bugs in this implementation, in which case I'll fix them).</p>
</li>
<li>
<p><del>A number of tests in tests/misc_testsuite are failing.  I'll address those in a follow-up commit.</del></p>
</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="560036686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560036686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560036686">(Nov 24 2025 at 23:09)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="560046313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560046313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560046313">(Nov 25 2025 at 00:25)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="560181724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560181724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560181724">(Nov 25 2025 at 15:13)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3576168969">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>Some of the WAST tests are hanging and/or busy looping.  I'll investigate this morning.</p>
</blockquote>



<a name="560203968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560203968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560203968">(Nov 25 2025 at 16:44)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="560208735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560208735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560208735">(Nov 25 2025 at 17:06)</a>:</h4>
<p><strong>dicej</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a> as ready for review.</p>



<a name="560208737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560208737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560208737">(Nov 25 2025 at 17:06)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="560208897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560208897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560208897">(Nov 25 2025 at 17:07)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3576661481">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>CI is green now; I'm temporarily pointing the <code>tests/component-model</code> submodule at <a href="https://github.com/WebAssembly/component-model/pull/577">https://github.com/WebAssembly/component-model/pull/577</a> until that PR is merged.</p>
</blockquote>



<a name="560209481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/560209481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#560209481">(Nov 25 2025 at 17:09)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3576671446">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>I believe we're just waiting on a spec PR (hopefully accompanied by WAST tests covering the changes) at this point.</p>
</blockquote>



<a name="561234929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561234929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561234929">(Dec 01 2025 at 17:47)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>This implements a spec change (PR pending) such that tasks created for calls to synchronous exports may not call potentially-blocking imports or return <code>wait</code> or <code>poll</code> callback codes prior to returning a value.  Specifically, the following are prohibited in that scenario:</p>
<ul>
<li>returning callback-code.{wait,poll}</li>
<li>sync calling an async import</li>
<li>sync calling subtask.cancel</li>
<li>sync calling {stream,future}.{read,write}</li>
<li>sync calling {stream,future}.cancel-{read,write}</li>
<li>calling waitable-set.{wait,poll}</li>
<li>calling thread.suspend</li>
</ul>
<p>This breaks a number of tests, which will be addressed in follow-up commits:</p>
<ul>
<li>
<p><del>The <code>{tcp,udp}-socket.bind</code> implementation in <code>wasmtime-wasi</code> is implemented using <code>Linker::func_wrap_concurrent</code> and thus assumed to be async, whereas the WIT interface says they're sync, leading to a type mismatch error at runtime. Alex and I have discussed this and have a general plan to address it.</del> EDIT: addressed by <a href="https://github.com/bytecodealliance/wasmtime/pull/12085">https://github.com/bytecodealliance/wasmtime/pull/12085</a></p>
</li>
<li>
<p><del>A number of tests in the tests/component-model submodule that points to the spec repo are failing.  Those will presumably be fixed as part of the upcoming spec PR (although some could be due to bugs in this implementation, in which case I'll fix them).</del> EDIT: addressed by <a href="https://github.com/WebAssembly/component-model/pull/577">https://github.com/WebAssembly/component-model/pull/577</a></p>
</li>
<li>
<p><del>A number of tests in tests/misc_testsuite are failing.  I'll address those in a follow-up commit.</del></p>
</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="561287633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561287633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561287633">(Dec 01 2025 at 22:28)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="561293742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561293742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561293742">(Dec 01 2025 at 23:17)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="561427489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561427489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561427489">(Dec 02 2025 at 14:27)</a>:</h4>
<p>pannous <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3602332637">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<blockquote>
<p>the following are prohibited in that scenario:<br>
      &gt;  sync calling an async import</p>
</blockquote>
<p>sorry again how is that not function coloring?</p>
</blockquote>



<a name="561436305"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561436305" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561436305">(Dec 02 2025 at 14:58)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="561436306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561436306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561436306">(Dec 02 2025 at 14:58)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="561542959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561542959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561542959">(Dec 03 2025 at 00:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3604461348">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>@pannous if you have technical concerns about this change, mind bringing it up on <a href="https://github.com/WebAssembly/component-model/pull/578">https://github.com/WebAssembly/component-model/pull/578</a>? That'll be a better forum for discussing the design than here</p>
</blockquote>



<a name="561910632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561910632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561910632">(Dec 04 2025 at 15:36)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3612844317">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>@dicej did you have anything else you wanted to sort out with this or is it ready to go?</p>
</blockquote>



<a name="561943971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/561943971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#561943971">(Dec 04 2025 at 18:00)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3613603435">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<blockquote>
<p>@dicej did you have anything else you wanted to sort out with this or is it ready to go?</p>
</blockquote>
<p>Currently the <code>tests/component-model</code> submodule is pointing at my PR branch, and we can't point it to the main branch until <a href="https://github.com/WebAssembly/component-model/pull/578">https://github.com/WebAssembly/component-model/pull/578</a> is merged.  If we're ok with temporarily pointing at the PR branch, we can merge this; otherwise, we need to wait.</p>
</blockquote>



<a name="562136354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562136354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562136354">(Dec 05 2025 at 16:06)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3617517213">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<p>Could this ignore the upstream tests temporarily and/or vendor working copies of them?</p>
<p>Behavior-wise though there's nothing more you're looking to add here?</p>
</blockquote>



<a name="562139332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562139332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562139332">(Dec 05 2025 at 16:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#pullrequestreview-3545425171">PR review</a>:</p>
<blockquote>
<p>Two extra thoughts in addition to the ones below:</p>
<ul>
<li>Could an <code>assert!</code> be done in a single "core" location that suspension happens that the task is allowed to block? That would be a final check that we did indeed sprinkle all the checks correctly.</li>
<li>We'll definitely want a test, in repo, that traps happen as opposed to just updating all existing tests to not trap. I believe Luke has one upstream, but for landing this ahead of the upstream PR could this vendor the test in this repo to ensure we're running it here?</li>
</ul>
</blockquote>



<a name="562139333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562139333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562139333">(Dec 05 2025 at 16:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#discussion_r2593223038">PR review comment</a>:</p>
<blockquote>
<p>Can you leave a comment on checks like this to indicate what the trap/check represents?</p>
</blockquote>



<a name="562139334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562139334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562139334">(Dec 05 2025 at 16:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#discussion_r2593213521">PR review comment</a>:</p>
<blockquote>
<p>This'll want to get filled out I believe</p>
</blockquote>



<a name="562139335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562139335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562139335">(Dec 05 2025 at 16:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#discussion_r2593233595">PR review comment</a>:</p>
<blockquote>
<p>Similar to <code>host.rs</code>, mind leaving a comment on these checks throughout this file explaining what's going on?</p>
</blockquote>



<a name="562139336"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562139336" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562139336">(Dec 05 2025 at 16:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#discussion_r2593220730">PR review comment</a>:</p>
<blockquote>
<p>Could this be plumbed through with <code>S</code> as a type parameter rather than an extra argument to follow the same idioms of the other constructors in this file?</p>
</blockquote>



<a name="562150827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562150827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562150827">(Dec 05 2025 at 17:21)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3617799209">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<blockquote>
<p>Could this ignore the upstream tests temporarily and/or vendor working copies of them?</p>
</blockquote>
<p>Yeah; I'll switch the submodule back and temporarily skip the offending tests.</p>
<blockquote>
<p>Behavior-wise though there's nothing more you're looking to add here?</p>
</blockquote>
<p>Correct; nothing left behavior-wise.</p>
</blockquote>



<a name="562151319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562151319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562151319">(Dec 05 2025 at 17:24)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#issuecomment-3617808059">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>:</p>
<blockquote>
<blockquote>
<ul>
<li>Could an <code>assert!</code> be done in a single "core" location that suspension happens that the task is allowed to block? That would be a final check that we did indeed sprinkle all the checks correctly.</li>
</ul>
</blockquote>
<p>I'll look into that.</p>
<blockquote>
<ul>
<li>We'll definitely want a test, in repo, that traps happen as opposed to just updating all existing tests to not trap. I believe Luke has one upstream, but for landing this ahead of the upstream PR could this vendor the test in this repo to ensure we're running it here?</li>
</ul>
</blockquote>
<p>Yup, I'll just copy the test from his PR into e.g. <code>misc_testsuite</code>.</p>
</blockquote>



<a name="562182836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562182836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562182836">(Dec 05 2025 at 21:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#pullrequestreview-3546445244">PR review</a>:</p>
<blockquote>
<p>Oh meant to do this too</p>
</blockquote>



<a name="562581716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562581716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562581716">(Dec 09 2025 at 00:43)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="562582213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562582213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562582213">(Dec 09 2025 at 00:50)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="562586216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562586216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562586216">(Dec 09 2025 at 01:45)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12043#pullrequestreview-3554883847">PR review</a>.</p>



<a name="562716095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562716095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562716095">(Dec 09 2025 at 15:27)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="562718068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562718068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562718068">(Dec 09 2025 at 15:34)</a>:</h4>
<p>dicej has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<a name="562727263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312043%20trap%20on%20blocking%20call%20in%20sync%20task%20b.../near/562727263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312043.20trap.20on.20blocking.20call.20in.20sync.20task.20b.2E.2E.2E.html#562727263">(Dec 09 2025 at 16:05)</a>:</h4>
<p>dicej merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12043">PR #12043</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>