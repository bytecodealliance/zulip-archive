<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8963 How to get control over filesystem... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html">wasmtime / issue #8963 How to get control over filesystem...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="451757440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/451757440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#451757440">(Jul 16 2024 at 13:20)</a>:</h4>
<p>stevenj opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Our implementation requires filesystems to be fully controlled, and files come from a VFS not any mounted filesystem.<br>
That means we need to control the low level aspects of filesystem access for WasiP2.</p>
<p>I don't see how that can be achieved, because the only option I see is giving Wasi access to a pre-opened directory, which is 100% off the table for our application.  How to use the WaiCtxBuilder, and abstract the necessary filesystem interfaces to the runtime?</p>
</blockquote>



<a name="451774291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/451774291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#451774291">(Jul 16 2024 at 14:41)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2231096470">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>For a fully virtual filesystem you won't be using <code>WasiCtxBuilder</code>. You'll want to instead implement the <code>Host</code> traits directly generated in the <code>wasmtime-wasi</code> crate such as <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/bindings/sync/filesystem/types/trait.Host.html">this</a>. You'd then call <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/bindings/filesystem/types/fn.add_to_linker.html"><code>add_to_linker</code></a> or similarly.</p>
</blockquote>



<a name="507235594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/507235594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#507235594">(Mar 21 2025 at 10:03)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2742892700">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>It looks like there <a href="https://github.com/bytecodealliance/wasmtime/pull/701">was once a <code>preopened_virt()</code> function</a> that maybe did this? It seems to have been removed though. :-(</p>
<p>It's a bit of a shame you can't use <code>WasiCtxBuilder</code> - I don't want to have to reimplement all the other APIs it provides too. Perhaps <code>WasiCtx</code> should be broken up into components (stdio, networking, filesystem etc?). Kind of feels like the trait system could solve this.</p>
</blockquote>



<a name="507341559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/507341559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#507341559">(Mar 21 2025 at 18:22)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2744131762">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>We used to have a more dynamic trait system to make this pluggable when wasmtime-wasi was backed by wasi-common, and when we rewrote wasmtime-wasi to detach it from the legacy wasi-common implementation, we got rid of it because it created significant maintenance burden and complexity for very little benefit over using the linker to do the same.</p>
<p>You can still use the linker to define the filesystem interfaces, and use the rest of wasmtime-wasi's linkers to define the rest of wasi based on WasiCtx, and they will interoperate fine as long as your wasmtime::component::bindgen to generate your filesystem traits has the same <code>with</code> settings for the wasi:io package <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/bindings.rs#L412-L418">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/bindings.rs#L412-L418</a></p>
</blockquote>



<a name="507357309"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/507357309" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#507357309">(Mar 21 2025 at 20:02)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2744333079">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Ah ok thanks. Sounds a little bit beyond me tbh but I'll have a go. So I wonder get multiple definition linker errors or something like that?</p>
</blockquote>



<a name="507823705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/507823705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#507823705">(Mar 24 2025 at 16:42)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2748763705">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Symbols will be duplicated if you call the <code>wasmtime_wasi::add_to_linker_*</code> functions directly, because those put all symbols into the linker. If you drop down to using the individual <code>wasmtime_wasi::bindings::&lt;package&gt;::&lt;interface&gt;::add_to_linker_get_host</code> (see <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/lib.rs#L356-L385">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/lib.rs#L356-L385</a> for how these are collected into the whole set for add_to_linker_async), you can add symbols to the linker on a per-interface basis.</p>
</blockquote>



<a name="522985007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/522985007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#522985007">(Jun 08 2025 at 15:53)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2954149013">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Hmm I had a go at this but it gets kind of complicated because of <a href="https://github.com/bytecodealliance/wasmtime/blob/7f8370a5fa37fe11c7a4581230cd09932656ea8d/crates/wasi/src/p2/bindings.rs#L429">this code</a>, note this comment:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="c1">// Configure all other resources to be concrete types defined in</span>
<span class="w">            </span><span class="c1">// this crate</span>
</code></pre></div>
<p>So I got as far as this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">add_modified_wasi_apis_to_linker_async</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiView</span><span class="o">&gt;</span><span class="p">(</span><span class="n">linker</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Linker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">LinkOptions</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi_io</span><span class="p">::</span><span class="n">add_to_linker_async</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_annotate</span><span class="p">::</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="p">(</span><span class="o">|</span><span class="n">t</span><span class="o">|</span><span class="w"> </span><span class="n">WasiImpl</span><span class="p">(</span><span class="n">IoImpl</span><span class="p">(</span><span class="n">t</span><span class="p">)));</span>

<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">wall_clock</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">monotonic_clock</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// We use our own instead.</span>
<span class="w">    </span><span class="c1">// wasmtime_wasi::p2::bindings::filesystem::preopens::add_to_linker_get_host(l, closure)?;</span>
<span class="w">    </span><span class="k">crate</span><span class="p">::</span><span class="n">vfs</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">random</span><span class="p">::</span><span class="n">random</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">random</span><span class="p">::</span><span class="n">insecure</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">random</span><span class="p">::</span><span class="n">insecure_seed</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">exit</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">environment</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdin</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdout</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stderr</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">terminal_input</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">terminal_output</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">terminal_stdin</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">terminal_stdout</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">terminal_stderr</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">tcp</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">tcp_create_socket</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">udp</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">udp_create_socket</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">instance_network</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">network</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">ip_name_lookup</span><span class="p">::</span><span class="n">add_to_linker_get_host</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>which is fine, and then</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::{</span><span class="n">Linker</span><span class="p">,</span><span class="w"> </span><span class="n">Resource</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::{</span><span class="n">p2</span><span class="p">::{</span><span class="n">bindings</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtx</span><span class="p">},</span><span class="w"> </span><span class="n">ResourceTable</span><span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">preopens</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cp">#[doc = </span><span class="s">" Return the set of preopened directories, and their paths."</span><span class="cp">]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">get_directories</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">preopens</span><span class="p">::</span><span class="n">Descriptor</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">preopens</span><span class="p">::</span><span class="n">Descriptor</span><span class="p">::</span><span class="n">Dir</span><span class="p">(</span><span class="fm">todo!</span><span class="p">());</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span>
<span class="w">            </span><span class="p">(</span><span class="n">Resource</span><span class="p">::</span><span class="n">new_own</span><span class="p">(</span><span class="fm">todo!</span><span class="p">()),</span><span class="w"> </span><span class="s">"/"</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">        </span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">add_to_linker_get_host</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">G</span><span class="p">:</span><span class="w"> </span><span class="nc">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">preopens</span><span class="p">::</span><span class="n">GetHost</span><span class="o">&lt;&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Host</span><span class="p">:</span><span class="w"> </span><span class="nc">preopens</span><span class="p">::</span><span class="n">Host</span><span class="o">&gt;&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">linker</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Linker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">host_getter</span><span class="p">:</span><span class="w"> </span><span class="nc">G</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">todo!</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>I haven't figured out what <code>Resource</code>, <code>Descriptor</code>, <code>Host</code>, <code>GetHost</code>, etc. are yet (really awkward to find the definition of these things due to the heavy use of proc macros)... but anyway the point is that <code>preopens::Host</code> seems to force the use of <code>preopens::Descriptor</code>, which is hard-coded to open files from disk, and that's the behaviour I want to change.</p>
<p>If I want custom FS behaviour do I need to completely replicate the entire <code>mod async_io {   wasmtime::component::bindgen!({ </code> call but change one line? That seems... awkward. :-/</p>
</blockquote>



<a name="524127075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/524127075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#524127075">(Jun 15 2025 at 12:12)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2973739472">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>I got a bit further... but ultimately you end up having to implement your own</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">add_to_linker_get_host</span><span class="o">&lt;</span>
<span class="w">    </span><span class="n">T</span><span class="p">,</span>
<span class="w">    </span><span class="n">G</span><span class="p">:</span><span class="w"> </span><span class="nc">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">preopens</span><span class="p">::</span><span class="n">GetHost</span><span class="o">&lt;&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Host</span><span class="p">:</span><span class="w"> </span><span class="nc">preopens</span><span class="p">::</span><span class="n">Host</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">linker</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Linker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">host_getter</span><span class="p">:</span><span class="w"> </span><span class="nc">G</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">todo!</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>In this repo that is full of generated code that ultimately comes from <a href="https://github.com/bytecodealliance/wasmtime/blob/4f3ee9432a2500f910ab6958ab1dcfd188324b0b/crates/wasi/src/p2/bindings.rs#L428-L429">these hard-coded types</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span><span class="w"> </span><span class="nn">async_io</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"src/p2/wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"wasi:cli/command"</span><span class="p">,</span>
<span class="o">..</span><span class="p">.</span>
<span class="w">        </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Configure all other resources to be concrete types defined in</span>
<span class="w">            </span><span class="c1">// this crate</span>
<span class="o">..</span><span class="p">.</span>
<span class="w">            </span><span class="s">"wasi:filesystem/types/directory-entry-stream"</span><span class="p">:</span><span class="w"> </span><span class="nc">crate</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">ReaddirIterator</span><span class="p">,</span>
<span class="w">            </span><span class="s">"wasi:filesystem/types/descriptor"</span><span class="p">:</span><span class="w"> </span><span class="nc">crate</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">Descriptor</span><span class="p">,</span>
<span class="o">..</span><span class="p">.</span>
</code></pre></div>
<p>What I really want to do is just use a different type there, but it doesn't seem possible. I think probably the easiest solution is just to fork the entire repo, which is probably what I'll end up doing. That's a bit sad though. :-(</p>
</blockquote>



<a name="524292359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/524292359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#524292359">(Jun 16 2025 at 16:29)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2977287581">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>In your own crate, can you run bindgen for the wasi:cli/command world and use <code>with</code> to point to all of the parts of wasmtime-wasi and wasmtime-wasi-io that you do want to reuse, and then redefine just the filesystem bits in your crate?</p>
</blockquote>



<a name="524303166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/524303166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#524303166">(Jun 16 2025 at 17:29)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2977451264">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Ooo yeah maybe, although that does mean I need to copy the exact <code>.wit</code> files into my crate right? I can't refer to the <code>.wit</code> files in another crate?</p>
</blockquote>



<a name="524306851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/524306851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#524306851">(Jun 16 2025 at 17:48)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2977500304">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>You may need to copy them if you are in a different repo. In the same repo, you can use <code>path:</code> to provide a folder to look inside.</p>
</blockquote>



<a name="524306910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/524306910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#524306910">(Jun 16 2025 at 17:48)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2977500304">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>You may need to copy them if you are in a different repo. In the same repo, you can use the <code>path:</code> argument to generate! to provide a folder to look inside.</p>
</blockquote>



<a name="524306963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/524306963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#524306963">(Jun 16 2025 at 17:48)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-2977500304">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>You may need to copy them if you are in a different repo. In the same repo, you can use the <code>path:</code> argument to bindgen! to provide a folder to look inside.</p>
</blockquote>



<a name="533645996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/533645996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#533645996">(Aug 10 2025 at 11:41)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3172568542">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Ok I finally got this working (as far as having a noddy <code>ls</code> WASI program run and list some fake files). Demo repo here: <a href="https://github.com/Timmmm/wasmtime_fs_demo">https://github.com/Timmmm/wasmtime_fs_demo</a></p>
<p>It's pretty unsatisfying in a number of ways though:</p>
<ol>
<li>I had to import the entire <a href="https://github.com/WebAssembly/wasi-filesystem"><code>wasi-filesystem</code></a> repo. So I have to manually keep it in sync with the <code>wasi-filesystem</code> <code>.wit</code> files that <code>wasmtime-wasi</code> uses.</li>
<li>I had to <a href="https://github.com/Timmmm/wasmtime_fs_demo/blob/master/src/wasi_linker_excluding_filesystem.rs">copy and paste the entire <code>add_to_linker_async()</code> functions</a> and then comment out the <code>wasi-filesystem</code> stuff. There's no easy way to only add some of it.</li>
<li>I had to <a href="https://github.com/Timmmm/wasmtime_fs_demo/blob/3ffc9bd657867f7434b0ad11122fedc40ffc3416/src/wasi_fs.rs#L28">copy and paste the bindgen call</a> and then comment everything except <code>wasi-filesystem</code> out, and change the <code>ReadDirIterator</code>/<code>Descriptor</code> types to point to my own versions. This contains a lot of stuff that appears to be undocumented (or at least unobvious and difficult to locate - unfortunately go-to-definition is useless here). E.g. what does <code>only_imports</code> do, or <code>tracing: false</code>?</li>
<li>To work around the orphan rule, wasmtime uses two levels of nested newtypes with several associated traits that are really hard to follow (<code>IoView</code>, <code>WasiView</code>, <code>HasData</code>, <code>IoImpl</code>, <code>WasiImpl</code>, <code>HasWasi</code>... who can follow this?). I think technically if I wanted to provide a generic filesystem virtualisation library I'd need a <em>third</em> level... Fortunately I don't want that, so I just used a concrete type. But still, there must be a better way?</li>
<li>The use of a proc macro to generate the code makes everything harder because rust-analyzer can't show you the code (apparently they're working on it). It took me an unreasonable amount of time just to create the empty trait impls. (Rust-analyzer helps a lot but it doesn't get everything right.)</li>
</ol>
<p>So I still think this could be improved. I guess it at least works for now though. Hopefully this helps someone.</p>
<p>I'm going to keep working on the <code>wasmtime_fs_demo</code> and try to connect it to <code>gitoxide</code> so it exposes a git commit as a filesystem to WASI.</p>
</blockquote>



<a name="534762341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534762341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534762341">(Aug 16 2025 at 13:23)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3193668178">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Ok I updated <a href="https://github.com/Timmmm/wasmtime_fs_demo">my demo repo</a> to expose a Git commit as a read-only filesystem using <a href="https://github.com/GitoxideLabs/gitoxide">Gix</a>. Not production quality, but a simple <code>tree</code>-style app that tries to infer the file type of every file works!</p>
<p>I found it is quite hard to actually implement some of the WASI functions because there isn't actually a specification for them. You often get "this is similar to &lt;some POSIX function&gt;" which is hardly a specification. Good example: <code>read()</code>'s spec is:</p>
<div class="codehilite"><pre><span></span><code>    /// Read from a descriptor, without using and updating the descriptor&#39;s offset.
    ///
    /// This function returns a list of bytes containing the data that was
    /// read, along with a bool which, when true, indicates that the end of the
    /// file was reached. The returned list will contain up to `length` bytes; it
    /// may return fewer than requested, if the end of the file is reached or
    /// if the I/O operation is interrupted.
    ///
    /// In the future, this may change to return a `stream&lt;u8, error-code&gt;`.
    ///
    /// Note: This is similar to `pread` in POSIX.
</code></pre></div>

<ol>
<li>As far as I know descriptors don't <em>have</em> an offset. Nothing else in the API indicates that they have one.</li>
<li>What happens if you <code>read()</code> with an offset past the end of the file? What about just up to the end of the file?</li>
<li>What if you try to read 0 bytes?</li>
<li>What if you try to read 0 bytes but outside the file?</li>
</ol>
<p>Etc. I'm guessing the answer is going to be "whatever POSIX does", but it only says it's <em>similar</em> to <code>pread</code> so who knows.</p>
<p>Hopefully that will be fixed before WASI 1.0. (Sorry that was a bit off-topic.)</p>
<p>Anyway, it would be good if there was a nicer way to integrate a custom filesystem backend than what I've done in that repo.</p>
</blockquote>



<a name="534972249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534972249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534972249">(Aug 18 2025 at 15:11)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3197332330">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>In lieu of copying the bindings and doing <code>bindgen!</code> yourself, could you reuse the traits/types from <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/bindings/filesystem/index.html"><code>wasmtime_wasi::p2::bindings::filesystem</code></a></p>
</blockquote>



<a name="534972346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534972346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534972346">(Aug 18 2025 at 15:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3197334817">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<blockquote>
<p>You often get "this is similar to " which is hardly a specification</p>
</blockquote>
<p>I'd recommend raising this in the WASI proposals themselves, Wasmtime is not the source of truth for the proposals.</p>
</blockquote>



<a name="534972663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534972663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534972663">(Aug 18 2025 at 15:13)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3197341065">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<blockquote>
<p>could you reuse the traits/types from <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/bindings/filesystem/index.html">wasmtime_wasi::p2::bindings::filesystem</a></p>
</blockquote>
<p>Unfortunately not because I need to change <a href="https://github.com/Timmmm/wasmtime_fs_demo/blob/3fd016c0993e114709fffa4f9a698aa00f89fd82/src/wasi_fs.rs#L116">these two concrete <code>with:</code> types</a>.</p>
</blockquote>



<a name="534973791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534973791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534973791">(Aug 18 2025 at 15:19)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3197364608">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Technically you don't need to override <code>with:</code>, but it's a bit convoluted. IMO it's less convoluted than copy/pasting all the bindings, however, so I'll explain it here. Using the upstream <code>Resource&lt;T&gt;</code> types the <code>T</code> there points to some type in the wasmtime-wasi crate, but you can effectively cast the <code>Resource&lt;T&gt;</code> to any other type, such as <code>Resource&lt;U&gt;</code>, as it's just a "helper" type and not actually related to stored types. This would involve calling the <code>Resource::new_*</code> constructors. You  could then wrap that up in your own helper functions/methods/extension traits to lookup your own descriptor type <code>U</code> inside a table with a <code>Resource&lt;T&gt;</code> (or something like that)</p>
</blockquote>



<a name="534979766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534979766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534979766">(Aug 18 2025 at 15:52)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3197485250">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>So for example where I currently have this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">wasi_fs</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">WasiState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">get_directories</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span>
<span class="w">        </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">Descriptor</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="c1">// My own `Descriptor` type.</span>
<span class="w">            </span><span class="nb">String</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[(</span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">resource_table</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Descriptor</span><span class="p">{</span>
<span class="w">                </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">EntryKind</span><span class="p">::</span><span class="n">Tree</span><span class="p">,</span>
<span class="w">                </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nc">self</span><span class="p">.</span><span class="n">gitfs</span><span class="p">.</span><span class="n">root</span><span class="p">,</span>
<span class="w">            </span><span class="p">}).</span><span class="n">with_context</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"failed to push root preopen"</span><span class="p">))</span><span class="o">?</span><span class="p">,</span>
<span class="w">            </span><span class="s">"/"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)])</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>I would do something like this?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">wasi_fs</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">WasiState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">get_directories</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span>
<span class="w">        </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">Descriptor</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="nb">String</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">my_resource</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Resource</span><span class="o">&lt;</span><span class="n">Descriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">resource_table</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Descriptor</span><span class="p">{</span>
<span class="w">                </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">EntryKind</span><span class="p">::</span><span class="n">Tree</span><span class="p">,</span>
<span class="w">                </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nc">self</span><span class="p">.</span><span class="n">gitfs</span><span class="p">.</span><span class="n">root</span><span class="p">,</span>
<span class="w">            </span><span class="p">}).</span><span class="n">with_context</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"failed to push root preopen"</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">converted_resource</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Resource</span><span class="o">&lt;</span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">Descriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="n">my_resource</span><span class="p">.</span><span class="n">owned</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Resource</span><span class="p">::</span><span class="n">new_owned</span><span class="p">(</span><span class="n">my_resource</span><span class="p">.</span><span class="n">rep</span><span class="p">())</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Resource</span><span class="p">::</span><span class="n">new_borrowed</span><span class="p">(</span><span class="n">my_resource</span><span class="p">.</span><span class="n">rep</span><span class="p">())</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[(</span>
<span class="w">            </span><span class="n">converted_resource</span><span class="p">,</span>
<span class="w">            </span><span class="s">"/"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)])</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="534994413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/534994413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#534994413">(Aug 18 2025 at 17:36)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3197834823">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Indeed yeah, that's functionally what reusing the <code>wasmtime_wasi</code>-based traits would look like. I'd recommend using an extension trait like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">ResourceTableExt</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">push_my_descriptor</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">my_descriptor</span><span class="p">:</span><span class="w"> </span><span class="nc">Descriptor</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">Descriptor</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">ResourceTableExt</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>as that would reduce the noise of conversions and such. You could do similarly for accessors too. Whether or not this is more palatable to generating bindings yourself is mostly a subjective point, however.</p>
</blockquote>



<a name="536201942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/536201942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#536201942">(Aug 26 2025 at 10:02)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3223497055">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Hmm unfortunately that doesn't quite work. The bindings that <code>wasmtime</code> generates use <a href="https://github.com/bytecodealliance/wasmtime/blob/e767c56b824e5ce8947997b052859e050419d35b/crates/wasi/src/p2/filesystem.rs#L398"><code>wasmtime_wasi::p2::filesystem::ReaddirIterator</code></a> for <code>read_dir()</code> but the <code>wasmtime_wasi::p2::filesystem</code> crate is private (<code>pub(crate)</code>) so I can't actually implement the <code>Host</code> trait.</p>
<p>Can we make that type public so that this approach would be possible?</p>
</blockquote>



<a name="536280934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/536280934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#536280934">(Aug 26 2025 at 17:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3225030947">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Oh definitely yeah, making that public is quite reasonable!</p>
</blockquote>



<a name="536287728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/536287728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#536287728">(Aug 26 2025 at 17:59)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3225175490">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Cool I will make a PR.</p>
</blockquote>



<a name="537060211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/537060211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#537060211">(Sep 01 2025 at 08:29)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3241392892">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>I tried updating but unfortunately these types are now private so I can't implement <code>add_to_linker_except_filesystem()</code>...</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">WasiCli</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">WasiClocks</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">WasiFilesystem</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">random</span><span class="p">::</span><span class="n">WasiRandom</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">WasiSockets</span><span class="p">;</span>
</code></pre></div>
<p>Can we make them public too?</p>
<p>Also, <a href="https://github.com/bytecodealliance/wasmtime/commit/0a074afce9fff4fe82e45069e1e493e7f13d33ba#diff-79f9dc0ff5e2ab859cfa7afc020cdeb7e7c10c9806a6317b824643b4c7de0063">this commit</a> has such a great commit message.. Can you teach my colleagues to do that? :-D And thanks for addressing my point <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3172568542">above</a> about <code>IoView</code>, <code>WasiView</code>, <code>HasData</code>, <code>IoImpl</code>, <code>WasiImpl</code>, <code>HasWasi</code>...  - this is definitely an improvement!</p>
</blockquote>



<a name="537325943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/537325943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#537325943">(Sep 02 2025 at 16:38)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3246057137">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Yeah I've gone back and forth on whether those should be public, but I've copied them outside of this repo before as well. Given that I think it's reasonable to make public, so feel free to make a PR!</p>
</blockquote>



<a name="537368245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238963%20How%20to%20get%20control%20over%20filesystem.../near/537368245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238963.20How.20to.20get.20control.20over.20filesystem.2E.2E.2E.html#537368245">(Sep 02 2025 at 21:39)</a>:</h4>
<p>Timmmm <a href="https://github.com/bytecodealliance/wasmtime/issues/8963#issuecomment-3246886965">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8963">issue #8963</a>:</p>
<blockquote>
<p>Woohoo I updated <a href="https://github.com/Timmmm/wasmtime_fs_demo/tree/master">my test repo</a> to use the resource type casting approach and it works! Definitely uglier and much less type safe, but overall I'd say it's the better approach.</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>