<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12366 Refactor core wasm host entrypoints · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html">wasmtime / PR #12366 Refactor core wasm host entrypoints</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="568537776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568537776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568537776">(Jan 16 2026 at 23:07)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a> from <code>alexcrichton:more-func-refactor</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit refactors the internals of how guest functions call out to the host. Previously Wasmtime had a split where <code>Func::new</code>-style constructors used one entrypoint and <code>Func::wrap</code>-style entrypoints used a different entrypoint. This was required long ago when we had an array and native ABI calling convention, but nowadays this is no longer required. This refactors things to have a single base-level signature which is the narrow waist through which all other function entrypoints go through. This enables having a single function handle all the things like panicking, call hooks, etc, and everything further builds on top of it.</p>
<p>This commit additionally pushes the async-ness of a function down even further. Previously many <code>*_async</code> constructors would quickly delegate to their non-async counterpart, but this is expected to more-or-less become not the right way to do things as wasmtime moves into the future. Historical refactorings related to GC, for example, have pushed <code>async</code> further down within Wasmtime and this continues that trend. There's no immediate benefit just yet, but this is hoped to make future refactorings easier.</p>
<p>Along the way some minor API changes happened too:</p>
<ul>
<li><code>*_unchecked</code> constructors now work with <code>MaybeUninit&lt;ValRaw&gt;</code> to correctly model how some values may not be initialized.</li>
<li>Some <code>*_async</code> functions picked up <code>T: Send</code> which should have in theory been required before and are now compiler-required.</li>
<li>Longstanding/old internal functions have been shuffled around/refactored.</li>
</ul>
<p>Finally, another eventual goal of this work is to share more between core wasm and components in terms of implementation. Right now the component host function entrypoints are quite different than the core wasm ones and that ideally wouldn't endure forever.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="568537779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568537779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568537779">(Jan 16 2026 at 23:07)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="568537780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568537780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568537780">(Jan 16 2026 at 23:07)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="568544380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568544380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568544380">(Jan 17 2026 at 00:39)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="568545841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568545841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568545841">(Jan 17 2026 at 01:00)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="568545842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568545842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568545842">(Jan 17 2026 at 01:00)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="568550702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568550702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568550702">(Jan 17 2026 at 02:23)</a>:</h4>
<p>github-actions[bot] added the label <code>wasmtime:api</code> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="568550704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/568550704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#568550704">(Jan 17 2026 at 02:23)</a>:</h4>
<p>github-actions[bot] added the label <code>wasmtime:c-api</code> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="569118361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569118361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569118361">(Jan 20 2026 at 20:08)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12366#discussion_r2709845410">PR review comment</a>:</p>
<blockquote>
<p>A while back we found that our <code>pub fn new(impl AsContextMut)</code>/<code>pub(crate) fn _new(&amp;mut StoreOpaque)</code> pair conventions were hiding when the latter constructor was dead code due to its underscore prefix.</p>
<p>Do we want to avoid the underscore prefix here as well?</p>
</blockquote>



<a name="569118362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569118362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569118362">(Jan 20 2026 at 20:08)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12366#pullrequestreview-3684009110">PR review</a>:</p>
<blockquote>
<p>Looks great, thanks for this clean up!</p>
</blockquote>



<a name="569118363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569118363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569118363">(Jan 20 2026 at 20:08)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12366#discussion_r2709906360">PR review comment</a>:</p>
<blockquote>
<p><code>ensure!</code>?</p>
</blockquote>



<a name="569118364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569118364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569118364">(Jan 20 2026 at 20:08)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12366#discussion_r2709901087">PR review comment</a>:</p>
<blockquote>
<p>Nitpick: newlines between methods in the impl block.</p>
</blockquote>



<a name="569120980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569120980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569120980">(Jan 20 2026 at 20:24)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="569121009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569121009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569121009">(Jan 20 2026 at 20:24)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="569123612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569123612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569123612">(Jan 20 2026 at 20:40)</a>:</h4>
<p>alexcrichton added <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366 Refactor core wasm host entrypoints</a> to the merge queue.</p>



<a name="569127554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569127554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569127554">(Jan 20 2026 at 21:05)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366</a>.</p>



<a name="569127555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312366%20Refactor%20core%20wasm%20host%20entrypoints/near/569127555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312366.20Refactor.20core.20wasm.20host.20entrypoints.html#569127555">(Jan 20 2026 at 21:05)</a>:</h4>
<p>alexcrichton removed <a href="https://github.com/bytecodealliance/wasmtime/pull/12366">PR #12366 Refactor core wasm host entrypoints</a> from the merge queue.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>