<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11963 c-api: wasi: In-memory stdio pipes · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html">wasmtime / issue #11963 c-api: wasi: In-memory stdio pipes</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="548322804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311963%20c-api%3A%20wasi%3A%20In-memory%20stdio%20pipes/near/548322804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html#548322804">(Nov 01 2025 at 17:05)</a>:</h4>
<p>MangoPeachGrape opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11963">issue #11963</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I would like to have a way to redirect stdout/stderr to an in-memory queue or pipe, and then have some API to get the output from C.</p>
<p>I see <code>MemoryOutputPipe</code> in <code>p2/pipe.rs</code>, but I'm unsure if calling <code>.contents()</code> removes from the underlying pipe? I think I would prefer if a reading operation would remove from it, so that the pipe wouldn't get full.</p>
<p>I was also thinking, what would be the API for this? Would reading from the pipe require an allocation and a copy, or could we get away with passing an non-owning pointer to the data to some callback instead?</p>
<p>Feel free to let me know if any ideas come to mind!</p>
<p>Thanks,<br>
MangoPeachGrape</p>
</blockquote>



<a name="548324246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311963%20c-api%3A%20wasi%3A%20In-memory%20stdio%20pipes/near/548324246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html#548324246">(Nov 01 2025 at 17:23)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11963#issuecomment-3476575567">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11963">issue #11963</a>:</p>
<blockquote>
<p>Would something like this work?</p>
<div class="codehilite" data-code-language="C"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">wasi_output_callback_t</span><span class="p">)(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">);</span>

<span class="n">WASI_API_EXTERN</span><span class="w"> </span><span class="kt">bool</span>
<span class="n">wasi_config_set_stdout_custom</span><span class="p">(</span><span class="n">wasi_config_t</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">,</span>
<span class="w">                              </span><span class="n">wasi_output_callback_t</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">finalizer</span><span class="p">)(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">));</span>
</code></pre></div>
<p>Basically the ability to have a custom callback which receives the bytes and can figure out what to do with it. That'd be up to the C implementation to figure out how to collect the output but being able to customize it entirely is sort of the next level up from what we currently have in the API.</p>
<p>(something similar could in theory be used for stdin too)</p>
</blockquote>



<a name="548325491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311963%20c-api%3A%20wasi%3A%20In-memory%20stdio%20pipes/near/548325491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html#548325491">(Nov 01 2025 at 17:37)</a>:</h4>
<p>MangoPeachGrape <a href="https://github.com/bytecodealliance/wasmtime/issues/11963#issuecomment-3476615242">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11963">issue #11963</a>:</p>
<blockquote>
<p>I think so yes!</p>
<p>I was thinking of it requiring a variant of <code>MemoryOutputPipe</code> with a callback to its data, but your solution seems _a lot_ better.</p>
<p>Should I try implementing it?</p>
</blockquote>



<a name="548325884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311963%20c-api%3A%20wasi%3A%20In-memory%20stdio%20pipes/near/548325884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html#548325884">(Nov 01 2025 at 17:42)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11963#issuecomment-3476618219">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11963">issue #11963</a>:</p>
<blockquote>
<p>Please do!</p>
</blockquote>



<a name="548325891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311963%20c-api%3A%20wasi%3A%20In-memory%20stdio%20pipes/near/548325891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html#548325891">(Nov 01 2025 at 17:42)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasmtime:c-api label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11963">Issue #11963</a>.</p>



<a name="553728779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311963%20c-api%3A%20wasi%3A%20In-memory%20stdio%20pipes/near/553728779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311963.20c-api.3A.20wasi.3A.20In-memory.20stdio.20pipes.html#553728779">(Nov 04 2025 at 22:34)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11963">issue #11963</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I would like to have a way to redirect stdout/stderr to an in-memory queue or pipe, and then have some API to get the output from C.</p>
<p>I see <code>MemoryOutputPipe</code> in <code>p2/pipe.rs</code>, but I'm unsure if calling <code>.contents()</code> removes from the underlying pipe? I think I would prefer if a reading operation would remove from it, so that the pipe wouldn't get full.</p>
<p>I was also thinking, what would be the API for this? Would reading from the pipe require an allocation and a copy, or could we get away with passing an non-owning pointer to the data to some callback instead?</p>
<p>Feel free to let me know if any ideas come to mind!</p>
<p>Thanks,<br>
MangoPeachGrape</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>