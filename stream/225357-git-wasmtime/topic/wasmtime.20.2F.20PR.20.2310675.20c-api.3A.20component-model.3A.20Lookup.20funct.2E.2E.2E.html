<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10675 c-api: component-model: Lookup funct... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html">wasmtime / PR #10675 c-api: component-model: Lookup funct...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="514452368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514452368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514452368">(Apr 25 2025 at 20:00)</a>:</h4>
<p>MangoPeachGrape opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a> from <code>MangoPeachGrape:c-api/component-model/get-func</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Only <code>get_func()</code> as of now, should <a href="https://github.com/bytecodealliance/wasmtime/pull/9812#discussion_r1884473950">https://github.com/bytecodealliance/wasmtime/pull/9812#discussion_r1884473950</a> come in a later PR?</p>
<p>One thing of note, if name isn't UTF-8, it returns false instead of returning an error, is that fine?</p>
</blockquote>



<a name="514452369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514452369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514452369">(Apr 25 2025 at 20:00)</a>:</h4>
<p><strong>MangoPeachGrape</strong> requested <a href="https://github.com/dicej">dicej</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514452371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514452371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514452371">(Apr 25 2025 at 20:00)</a>:</h4>
<p><strong>MangoPeachGrape</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514459638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514459638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514459638">(Apr 25 2025 at 20:45)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514460578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514460578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514460578">(Apr 25 2025 at 20:51)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#issuecomment-2831409890">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>:</p>
<blockquote>
<p>Thanks! This has triggered some further thoughts which are both preexisting and related to this PR as well:</p>
<ul>
<li>For names I realize now we shouldn't use <code>const char*</code>, but instead we should be using <code>wasm_name_t*</code>. Unicode can't be represented as <code>const char*</code> due to the lack of ability to support interior nul characters, so we'll want to change this and other APIs to use <code>wasm_name_t</code> instead.</li>
<li>For this I think we'll want to base lookup of an item on an <code>ComponentExportIndex</code> instead of a string, although a string can be used to acquire an <code>ComponentExportIndex</code>. Effectively I think we should bind <code>{Instance,Component}::get_export_index</code> and then an export index is used to lookup a function. That'll handle nested instances as well as top-level exports in the same manner.</li>
</ul>
</blockquote>



<a name="514460781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514460781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514460781">(Apr 25 2025 at 20:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#issuecomment-2831411972">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>:</p>
<blockquote>
<p>Er, sent too soon:</p>
<blockquote>
<p>One thing of note, if name isn't UTF-8, it returns false instead of returning an error, is that fine?</p>
</blockquote>
<p>Yeah sounds good!</p>
<hr>
<p>One other slightly orthogonal thing, I think it'd be nice to help clean up the C tests a bit. If you'd like I think it'd be reasonable to export the C API implementation  pointer from C++ structures, that way you could sort of intermix C++ and C where the C++ APIs could be used to handle auto-destruction and such. That might also make it easier to bind optional errors and assert that errors don't happen. Otherwise could the <code>CHECK</code> macro be deduplicated in a header instead of duplicated between files?</p>
</blockquote>



<a name="514651215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514651215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514651215">(Apr 27 2025 at 14:28)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514651644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514651644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514651644">(Apr 27 2025 at 14:33)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514835888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514835888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514835888">(Apr 28 2025 at 14:54)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#pullrequestreview-2799598303">PR review</a>.</p>



<a name="514835889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514835889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514835889">(Apr 28 2025 at 14:54)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#discussion_r2063839163">PR review comment</a>:</p>
<blockquote>
<p>Could this function return the nullable pointer directly perhaps?</p>
</blockquote>



<a name="514835890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514835890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514835890">(Apr 28 2025 at 14:54)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#discussion_r2063844984">PR review comment</a>:</p>
<blockquote>
<p>Oh for this I think we'll want to have this be <code>const wasm_name_t*</code> in C and not take ownership here.</p>
<p>Also I apologize again for yet more whiplash... Looking at <code>wasmtime_linker_t</code> it looks like the functions there idiomatically take a pointer/length instead of <code>&amp;wasm_name_t</code> (e.g. <a href="https://github.com/bytecodealliance/wasmtime/blob/5614b80b58d946a9a5270b1c56934fec99f097d9/crates/c-api/src/linker.rs#L51-L66"><code>wasmtime_linker_define</code></a>). I had forgotten about that where <code>wasm_name_t</code> I think is mostly used for return values as opposed to arguments. In light of that could the idioms of the component linker be similar where a pointer/length is given? (sorry I should have checked this earlier)</p>
</blockquote>



<a name="514867662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514867662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514867662">(Apr 28 2025 at 17:24)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514867868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514867868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514867868">(Apr 28 2025 at 17:25)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514870019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514870019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514870019">(Apr 28 2025 at 17:38)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514884029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514884029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514884029">(Apr 28 2025 at 18:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#pullrequestreview-2800398055">PR review</a>.</p>



<a name="514885585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514885585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514885585">(Apr 28 2025 at 19:06)</a>:</h4>
<p>MangoPeachGrape updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514886695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514886695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514886695">(Apr 28 2025 at 19:13)</a>:</h4>
<p>MangoPeachGrape <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#issuecomment-2836248545">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>:</p>
<blockquote>
<p>Next up values, which are required for function invocation?</p>
</blockquote>



<a name="514887920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514887920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514887920">(Apr 28 2025 at 19:20)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<a name="514888044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514888044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514888044">(Apr 28 2025 at 19:21)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10675#issuecomment-2836275348">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>:</p>
<blockquote>
<p>Yeah that seems reasonable. I'll be honest though in that I don't really know how to do values. Everything I've thought of historically is either extremely chatty over the C API boundary or extremely allocation-heavy, neither of which I feel is great... If you've got ideas though please dive in!</p>
</blockquote>



<a name="514891721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310675%20c-api%3A%20component-model%3A%20Lookup%20funct.../near/514891721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310675.20c-api.3A.20component-model.3A.20Lookup.20funct.2E.2E.2E.html#514891721">(Apr 28 2025 at 19:45)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10675">PR #10675</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>