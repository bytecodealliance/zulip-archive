<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11114 generalize async fiber abstraction · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html">wasmtime / PR #11114 generalize async fiber abstraction</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="525411676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525411676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525411676">(Jun 23 2025 at 21:45)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a> from <code>dicej:generalized-fiber-abstraction</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>As part of the work implementing the new Component Model async ABI in the <code>wasip3-prototyping</code> repo, I've generalized the <code>FiberFuture</code> abstraction in <code>wasmtime::runtime::store::async_</code> to support fibers which can either retain exclusive access to the store across suspend points or release it.  The latter allows the store to be used by the <code>component-model-async</code> event loop and/or other fibers to run before the original fiber resumes, which is the key to allowing multiple fibers to run concurrently, passing control of the store back and forth.</p>
<p>In the case of Pulley, the above generalization means we also need to give each fiber its own <code>Interpreter</code> so that multiple concurrent fibers don't clobber each other's state.</p>
<p>Concretely, this moves a lot of the code out of <code>async_.rs</code> and into a new <code>fiber.rs</code> submodule which will be shared with the <code>component-model-async</code> implementation.</p>
<p>This also pulls in a new <code>StoreToken&lt;T&gt;</code> utility which has been useful in <code>wasip3-prototyping</code> to safely convert from a <code>&amp;mut dyn VMStore</code> to a <code>StoreContextMut&lt;'a, T&gt;</code> when we previously witnessed a conversion in the other direction.</p>
<p>Note that I've added a <code>'static</code> bound to the <code>VMStore</code> trait, which simplifies use of <code>&amp;mut dyn VMStore</code>, avoiding thorny lifetime issues.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="525411677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525411677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525411677">(Jun 23 2025 at 21:45)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525411678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525411678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525411678">(Jun 23 2025 at 21:45)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525411680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525411680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525411680">(Jun 23 2025 at 21:45)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525412392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525412392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525412392">(Jun 23 2025 at 21:52)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525558083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558083">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954278673">PR review</a>:</p>
<blockquote>
<p>I'll keep taking a look at <code>fiber.rs</code>, but this is at least an initial round of feedback.</p>
</blockquote>



<a name="525558084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558084">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164276663">PR review comment</a>:</p>
<blockquote>
<p>Mind prefixing this with <code>SAFETY:</code>?</p>
</blockquote>



<a name="525558086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558086">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164299005">PR review comment</a>:</p>
<blockquote>
<p>I was surprised how much <code>'static</code> bounds cropped up all over the place from this refactoring and this is what I ended up tracing it back to. This <code>'static</code> can be replaced with <code>'a</code> and with that I believe many transitive callers of this function can also remove <code>'static</code></p>
<p>&lt;details&gt;</p>
<p>&lt;summary&gt;diff&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/crates/wasmtime/src/runtime/component/func/typed.rs b/crates/wasmtime/src/runtime/component/func/typed.rs</span>
<span class="gh">index f87447af7..c378742da 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/component/func/typed.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/component/func/typed.rs</span>
<span class="gu">@@ -179,7 +179,7 @@ where</span>
<span class="w"> </span>    ) -&gt; Result&lt;Return&gt;
<span class="w"> </span>    where
<span class="w"> </span>        Params: Send + Sync,
<span class="gd">-        Return: Send + Sync + 'static,</span>
<span class="gi">+        Return: Send + Sync,</span>
<span class="w"> </span>    {
<span class="w"> </span>        let mut store = store.as_context_mut();
<span class="w"> </span>        assert!(
<span class="gh">diff --git a/crates/wasmtime/src/runtime/fiber.rs b/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gh">index ba34e9e6b..76a89b3e7 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gu">@@ -585,7 +585,7 @@ unsafe fn suspend_fiber(</span>

<span class="w"> </span>/// Run the specified function on a newly-created fiber and `.await` its
<span class="w"> </span>/// completion.
<span class="gd">-pub(crate) async fn on_fiber&lt;R: Send + 'static&gt;(</span>
<span class="gi">+pub(crate) async fn on_fiber&lt;R: Send&gt;(</span>
<span class="w"> </span>    store: &amp;mut StoreOpaque,
<span class="w"> </span>    func: impl FnOnce(&amp;mut StoreOpaque) -&gt; R + Send,
<span class="w"> </span>) -&gt; Result&lt;R&gt; {
<span class="gu">@@ -596,7 +596,7 @@ pub(crate) async fn on_fiber&lt;R: Send + 'static&gt;(</span>
<span class="w"> </span>}

<span class="w"> </span>/// Wrap the specified function in a fiber and return it.
<span class="gd">-fn prepare_fiber&lt;'a, R: Send + 'static&gt;(</span>
<span class="gi">+fn prepare_fiber&lt;'a, R: Send + 'a&gt;(</span>
<span class="w"> </span>    store: &amp;mut dyn VMStore,
<span class="w"> </span>    func: impl FnOnce(&amp;mut dyn VMStore) -&gt; R + Send + 'a,
<span class="w"> </span>) -&gt; Result&lt;(StoreFiber&lt;'a&gt;, oneshot::Receiver&lt;R&gt;)&gt; {
<span class="gu">@@ -612,7 +612,7 @@ fn prepare_fiber&lt;'a, R: Send + 'static&gt;(</span>

<span class="w"> </span>/// Run the specified function on a newly-created fiber and `.await` its
<span class="w"> </span>/// completion.
<span class="gd">-async fn on_fiber_raw&lt;R: Send + 'static&gt;(</span>
<span class="gi">+async fn on_fiber_raw&lt;R: Send&gt;(</span>
<span class="w"> </span>    store: &amp;mut StoreOpaque,
<span class="w"> </span>    func: impl FnOnce(&amp;mut dyn VMStore) -&gt; R + Send,
<span class="w"> </span>) -&gt; Result&lt;R&gt; {
<span class="gh">diff --git a/crates/wasmtime/src/runtime/func/typed.rs b/crates/wasmtime/src/runtime/func/typed.rs</span>
<span class="gh">index e9304b755..0df0dcc40 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/func/typed.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/func/typed.rs</span>
<span class="gu">@@ -132,10 +132,7 @@ where</span>
<span class="w"> </span>        &amp;self,
<span class="w"> </span>        mut store: impl AsContextMut&lt;Data: Send&gt;,
<span class="w"> </span>        params: Params,
<span class="gd">-    ) -&gt; Result&lt;Results&gt;</span>
<span class="gd">-    where</span>
<span class="gd">-        Results: 'static,</span>
<span class="gd">-    {</span>
<span class="gi">+    ) -&gt; Result&lt;Results&gt; {</span>
<span class="w"> </span>        let mut store = store.as_context_mut();
<span class="w"> </span>        assert!(
<span class="w"> </span>            store.0.async_support(),
<span class="gh">diff --git a/crates/wasmtime/src/runtime/store/async_.rs b/crates/wasmtime/src/runtime/store/async_.rs</span>
<span class="gh">index c34d1dac4..f1c8a7454 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/store/async_.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/store/async_.rs</span>
<span class="gu">@@ -171,7 +171,7 @@ impl StoreOpaque {</span>
<span class="w"> </span>    /// This function will convert the synchronous `func` into an asynchronous
<span class="w"> </span>    /// future. This is done by running `func` in a fiber on a separate native
<span class="w"> </span>    /// stack which can be suspended and resumed from.
<span class="gd">-    pub(crate) async fn on_fiber&lt;R: Send + 'static&gt;(</span>
<span class="gi">+    pub(crate) async fn on_fiber&lt;R: Send&gt;(</span>
<span class="w"> </span>        &amp;mut self,
<span class="w"> </span>        func: impl FnOnce(&amp;mut Self) -&gt; R + Send,
<span class="w"> </span>    ) -&gt; Result&lt;R&gt; {
<span class="gu">@@ -286,7 +286,7 @@ impl StoreOpaque {</span>

<span class="w"> </span>impl&lt;T&gt; StoreContextMut&lt;'_, T&gt; {
<span class="w"> </span>    /// Executes a synchronous computation `func` asynchronously on a new fiber.
<span class="gd">-    pub(crate) async fn on_fiber&lt;R: Send + 'static&gt;(</span>
<span class="gi">+    pub(crate) async fn on_fiber&lt;R: Send&gt;(</span>
<span class="w"> </span>        &amp;mut self,
<span class="w"> </span>        func: impl FnOnce(&amp;mut StoreContextMut&lt;'_, T&gt;) -&gt; R + Send,
<span class="w"> </span>    ) -&gt; Result&lt;R&gt;
</code></pre></div>
<p>&lt;/summary&gt;</p>
<p>would that be possible to avoid the extra <code>'static</code> cropping up? I can sort of see how component-model-async bits may still require <code>'static</code>, but for preexisting bits in Wasmtime I'd be surprised if it required <code>'static</code>.</p>
</blockquote>



<a name="525558087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558087">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164279145">PR review comment</a>:</p>
<blockquote>
<p>Mind adding some brief comments as to the purpose of this type?</p>
</blockquote>



<a name="525558088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558088">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164282704">PR review comment</a>:</p>
<blockquote>
<p>Could this be directly imported at use-sites below to avoid the #[cfg]'d import?</p>
</blockquote>



<a name="525558089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558089">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164321911">PR review comment</a>:</p>
<blockquote>
<p>This runs a risk of causing problems because the <code>async</code> feature previously I believe didn't require the <code>std</code> feature, and now it does. Would it be possible to refactor to remove the need for the oneshot bits?</p>
</blockquote>



<a name="525558090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558090">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164402395">PR review comment</a>:</p>
<blockquote>
<p>Would it be possible for this to return <code>&amp;mut fiber::AsyncState</code> instead of a raw pointer?</p>
</blockquote>



<a name="525558091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558091">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164406501">PR review comment</a>:</p>
<blockquote>
<p>FWIW this style of imports is currently largely nonexistent within Wasmtime. Would you be ok reformatting this in a style more consistent with the rest of Wasmtime?</p>
</blockquote>



<a name="525558092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558092">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164397754">PR review comment</a>:</p>
<blockquote>
<p>If possible I think it'd be good to do the same to the <code>Send</code> bounds as well, but I haven't gamed that out yet.</p>
</blockquote>



<a name="525558093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558093">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164392181">PR review comment</a>:</p>
<blockquote>
<p>I'm not sure how exactly yet, but I'd prefer to avoid this #[cfg] necessity just to access <code>self.executor</code> as it's very easy to forget an non-obvious that it's required.</p>
</blockquote>



<a name="525558094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558094">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164278617">PR review comment</a>:</p>
<blockquote>
<p>In retrospect let's add <code>'static</code> here. There's weird things with variance about extending or shortening lifetimes in types (e.g. being able to safely change a <code>StoreToken&lt;T&gt;</code> to a <code>StoreToken&lt;U&gt;</code> where just the lifetimes differ). Having <code>'static</code> means we wouldn't have to worry about it though.</p>
</blockquote>



<a name="525558095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558095">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164458909">PR review comment</a>:</p>
<blockquote>
<p>Where possible I'd like to aggressively remove <code>pub(crate)</code> from this file. This function for example in wasip3-prototyping is only used elsewhere in <code>Instance::resume_fiber</code> and the implementation looks like a good candidate for moving to this file as a method on <code>StoreFiber&lt;'static&gt;</code>, so could this function be made purely internal?</p>
</blockquote>



<a name="525558096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558096">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164471296">PR review comment</a>:</p>
<blockquote>
<p>This to me feels like it's a safety contract that's a bit too onerous to uphold since none of the callers of this function actually have a <code>&amp;mut StoreOpaque</code> or similar in context. You'd have to travel a layer or two up the stack to actually see that and it feels a bit too "far" to me to find the proof of "ah, yes, ok this is safe". Would it be possible to actually take <code>&amp;mut StoreOpaque</code> here as an argument? (that would also simplify the executor handling pieces I believe)</p>
</blockquote>



<a name="525558097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558097">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164464751">PR review comment</a>:</p>
<blockquote>
<p>To expand on this some more, this is a pretty unsafe function and the boundaries of abstraction aren't really that clear to me. Understanding this function in isolation is pretty difficult and I feel it fits best within the context of <code>on_fiber_raw</code> or <code>Instance::resume_fiber</code>, which is where I'd prefer to keep all these unsafe set/reset/restore/etc bits all centralized in one function where possible so it's clear what's responsible for what.</p>
</blockquote>



<a name="525558098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558098">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164472575">PR review comment</a>:</p>
<blockquote>
<p>One of the sticklers for taking an argument is probably <code>Drop for StoreFiber</code>, and that's something where we can soup up the <code>Drop for Store</code> to call a function over here to avoid relying on <code>Drop for StoreFiber</code> (or something like that)</p>
</blockquote>



<a name="525558099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558099">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164475000">PR review comment</a>:</p>
<blockquote>
<p>Well, on second thought, no maybe that's not a good idea. Fibers can't be dropped unless they've finished so that would introduce footguns of forgetting to call the destructor on panics for example (or something like that)...</p>
<p>If the dtor is a "special case" that seems somewhat reasonable </p>
</blockquote>



<a name="525558101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525558101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525558101">(Jun 24 2025 at 16:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164461982">PR review comment</a>:</p>
<blockquote>
<p>Actually, on raeding this more, it looks like <code>Instance::resume_fiber</code> and <code>on_fiber_raw</code> above are more-or-less the same function where the only difference is <code>Instance::resume_fiber</code> can have a different type of return value which <code>on_fiber_raw</code> would assert never happens. Could the methods all get refactored/merged into this file?</p>
</blockquote>



<a name="525561169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525561169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525561169">(Jun 24 2025 at 17:03)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954652484">PR review</a>.</p>



<a name="525561170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525561170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525561170">(Jun 24 2025 at 17:03)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164505735">PR review comment</a>:</p>
<blockquote>
<p>I _think_ you can use <code>oneshot</code> without enabling the <code>futures/std</code> feature, so we might be able to just remove this line.  I'll play around with it.</p>
</blockquote>



<a name="525561324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525561324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525561324">(Jun 24 2025 at 17:04)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164507319">PR review comment</a>:</p>
<blockquote>
<p>I believe we did this to satisfy miri, but I can retest with <code>&amp;mut</code> and see what happens.</p>
</blockquote>



<a name="525561325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525561325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525561325">(Jun 24 2025 at 17:04)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954654843">PR review</a>.</p>



<a name="525566041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525566041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525566041">(Jun 24 2025 at 17:38)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525566198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525566198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525566198">(Jun 24 2025 at 17:39)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954753669">PR review</a>.</p>



<a name="525566199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525566199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525566199">(Jun 24 2025 at 17:39)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164563613">PR review comment</a>:</p>
<blockquote>
<p>I've applied your patch to remove the <code>'static</code> bounds; let me know if you want me to do the same for <code>Send</code>.</p>
</blockquote>



<a name="525567149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525567149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525567149">(Jun 24 2025 at 17:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164577863">PR review comment</a>:</p>
<blockquote>
<p>Yeah if possible I think we should remove <code>Send</code> here too as I think <code>'static</code> and <code>Send</code> are the root of <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/145">https://github.com/bytecodealliance/wasip3-prototyping/issues/145</a> perhaps?</p>
</blockquote>



<a name="525567150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525567150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525567150">(Jun 24 2025 at 17:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954777162">PR review</a>.</p>



<a name="525567512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525567512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525567512">(Jun 24 2025 at 17:50)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164582332">PR review comment</a>:</p>
<blockquote>
<p>Yeah, miri won't tolerate that:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">scenario</span><span class="p">::</span><span class="n">round_trip</span><span class="p">::</span><span class="n">async_round_trip_stackful</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span><span class="p">:</span><span class="w"> </span><span class="nc">attempting</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3440249</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1440939</span><span class="p">[</span><span class="mh">0x18</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dicej</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">fiber</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">444</span><span class="p">:</span><span class="mi">57</span>
<span class="w">     </span><span class="o">|</span>
<span class="mi">444</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">_reset_executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Reset</span><span class="p">(</span><span class="n">fiber</span><span class="p">.</span><span class="n">executor_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">fiber</span><span class="p">.</span><span class="n">executor_ptr</span><span class="p">);</span>
<span class="w">     </span><span class="o">|</span><span class="w">                                                         </span><span class="o">^^^^^^^^^^^^^^^^^^^</span>
<span class="w">     </span><span class="o">|</span><span class="w">                                                         </span><span class="o">|</span>
<span class="w">     </span><span class="o">|</span><span class="w">                                                         </span><span class="n">attempting</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3440249</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1440939</span><span class="p">[</span><span class="mh">0x18</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">     </span><span class="o">|</span><span class="w">                                                         </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1440939</span><span class="p">[</span><span class="mh">0x18</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">     </span><span class="o">|</span>
<span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">help</span><span class="p">:</span><span class="w"> </span><span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span><span class="p">:</span><span class="w"> </span><span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">help</span><span class="p">:</span><span class="w"> </span><span class="nc">see</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3440249</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x18</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">    </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dicej</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">fiber</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">476</span><span class="p">:</span><span class="mi">18</span>
<span class="w">     </span><span class="o">|</span>
<span class="mi">476</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">raw</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">store</span><span class="p">.</span><span class="n">store_opaque_mut</span><span class="p">().</span><span class="n">async_state</span><span class="p">()).</span><span class="n">current_executor</span><span class="w"> </span><span class="p">};</span>
<span class="w">     </span><span class="o">|</span><span class="w">                  </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">help</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3440249</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x38</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">retag</span>
<span class="w">    </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dicej</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">store</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1947</span><span class="p">:</span><span class="mi">9</span>
<span class="w">     </span><span class="o">|</span>
<span class="mi">1947</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">async_state</span>
<span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^</span>
</code></pre></div>
<p>We might be able to address it a different way (e.g. a larger refactoring), though.  Not sure how deep that rabbit hole will go.</p>
</blockquote>



<a name="525567513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525567513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525567513">(Jun 24 2025 at 17:50)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954784049">PR review</a>.</p>



<a name="525571542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525571542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525571542">(Jun 24 2025 at 18:15)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954863748">PR review</a>.</p>



<a name="525571543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525571543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525571543">(Jun 24 2025 at 18:15)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164622539">PR review comment</a>:</p>
<blockquote>
<p>Oof, and it looks like miri is upset for other reasons on <code>wasip3-prototyping</code> <code>main</code>; I seem to have caused a regression with the fiber unification PR.  Debugging now.</p>
</blockquote>



<a name="525572804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525572804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525572804">(Jun 24 2025 at 18:24)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525572905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525572905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525572905">(Jun 24 2025 at 18:25)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2954896164">PR review</a>.</p>



<a name="525572907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525572907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525572907">(Jun 24 2025 at 18:25)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164642190">PR review comment</a>:</p>
<blockquote>
<p>Okay, just pushed a fix for that regression: <a href="https://github.com/bytecodealliance/wasmtime/pull/11114/commits/ae227b658643761ebb3603a428879a826e4f0762">https://github.com/bytecodealliance/wasmtime/pull/11114/commits/ae227b658643761ebb3603a428879a826e4f0762</a></p>
</blockquote>



<a name="525576974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525576974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525576974">(Jun 24 2025 at 18:50)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525594524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525594524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525594524">(Jun 24 2025 at 20:59)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2955308647">PR review</a>.</p>



<a name="525594525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525594525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525594525">(Jun 24 2025 at 20:59)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164889720">PR review comment</a>:</p>
<blockquote>
<p>Oh I forgot to mention this earlier but FWIW this looks like it's copy/pasted from elsewhere and would be good to deduplicate.</p>
</blockquote>



<a name="525594526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525594526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525594526">(Jun 24 2025 at 20:59)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2164889387">PR review comment</a>:</p>
<blockquote>
<p>Toying around a bit with wasip3-prototyping, for this to be more sound we're going to want to add <code>Send + Sync</code> to the bounds of <code>fun</code>. That makes the <code>unsafe impl Send/Sync</code> above a bit more sound because it at least accounts for all captured values within <code>fun</code>. The fallout wasn't too large from what I saw and seemed mostly as-expected</p>
</blockquote>



<a name="525605304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525605304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525605304">(Jun 24 2025 at 22:30)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525605583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525605583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525605583">(Jun 24 2025 at 22:32)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2165056653">PR review comment</a>:</p>
<blockquote>
<p>We chatted about this over Zoom and concluded that changing the <code>*mut</code> to a <code>&amp;mut</code> would require a larger-scale refactoring to make sound and miri-approved, so we're leaving it as-is for now.</p>
</blockquote>



<a name="525605584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525605584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525605584">(Jun 24 2025 at 22:32)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2955589694">PR review</a>.</p>



<a name="525605637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525605637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525605637">(Jun 24 2025 at 22:33)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2955590209">PR review</a>.</p>



<a name="525605638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525605638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525605638">(Jun 24 2025 at 22:33)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2165057028">PR review comment</a>:</p>
<blockquote>
<p>I've pushed an update which addresses this.</p>
</blockquote>



<a name="525607168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525607168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525607168">(Jun 24 2025 at 22:49)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525610880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525610880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525610880">(Jun 24 2025 at 23:33)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525748877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525748877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525748877">(Jun 25 2025 at 16:19)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525753120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525753120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525753120">(Jun 25 2025 at 16:44)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525753426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525753426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525753426">(Jun 25 2025 at 16:46)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525795406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525795406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525795406">(Jun 25 2025 at 21:48)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525797823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525797823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525797823">(Jun 25 2025 at 22:15)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525800538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525800538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525800538">(Jun 25 2025 at 22:50)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525944495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525944495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525944495">(Jun 26 2025 at 16:45)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525946643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525946643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525946643">(Jun 26 2025 at 16:57)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525955538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525955538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525955538">(Jun 26 2025 at 17:58)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525965755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525965755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525965755">(Jun 26 2025 at 19:02)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525966955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525966955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525966955">(Jun 26 2025 at 19:13)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525967239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525967239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525967239">(Jun 26 2025 at 19:16)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525968932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525968932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525968932">(Jun 26 2025 at 19:31)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525969099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525969099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525969099">(Jun 26 2025 at 19:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2963338286">PR review</a>:</p>
<blockquote>
<p>@dicej ok these are all the changes I'd like to make, mind reviewing the changes I made as well before merging? Afterwards feel free to go ahead and queue this for merge</p>
</blockquote>



<a name="525979295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525979295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525979295">(Jun 26 2025 at 20:54)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#pullrequestreview-2963610179">PR review</a>.</p>



<a name="525979296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525979296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525979296">(Jun 26 2025 at 20:54)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/11114#discussion_r2169984068">PR review comment</a>:</p>
<blockquote>
<p>This comment is confusing since it refers to nonexistent docs for <code>resume_fiber</code>, and in any case we don't need to handwave about the "contract" anymore since <code>resume_fiber</code> now takes an explicit <code>&amp;mut StoreOpaque</code> parameter.  So maybe just say something like "This fiber will only be resumed using <code>resume_fiber</code>, which takes a <code>&amp;mut StoreOpaque</code> parameter and has given us exclusive access...".</p>
</blockquote>



<a name="525979929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525979929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525979929">(Jun 26 2025 at 20:59)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525979956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525979956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525979956">(Jun 26 2025 at 20:59)</a>:</h4>
<p>dicej has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525984158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525984158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525984158">(Jun 26 2025 at 21:38)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525984183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525984183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525984183">(Jun 26 2025 at 21:38)</a>:</h4>
<p>dicej has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<a name="525987140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311114%20generalize%20async%20fiber%20abstraction/near/525987140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311114.20generalize.20async.20fiber.20abstraction.html#525987140">(Jun 26 2025 at 22:15)</a>:</h4>
<p>dicej merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11114">PR #11114</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>