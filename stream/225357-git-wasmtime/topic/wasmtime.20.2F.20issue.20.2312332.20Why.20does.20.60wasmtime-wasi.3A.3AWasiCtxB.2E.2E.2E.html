<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12332 Why does `wasmtime-wasi::WasiCtxB... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html">wasmtime / issue #12332 Why does `wasmtime-wasi::WasiCtxB...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="567738370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567738370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567738370">(Jan 13 2026 at 11:16)</a>:</h4>
<p>LikeLakers2 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Hi, the title pretty much tells it all.</p>
<p>Basically, I was browsing the <code>wasmtime</code> and <code>wasmtime-wasi</code> docs, in an attempt to get an idea of how I might use this in a program.</p>
<p>Whilst doing so, I noticed that <code>wasmtime-wasi::WasiCtxBuilder::build()</code> takes <code>&amp;mut self</code>, but then proceeds to say that a <code>WasiCtxBuilder</code> can only be built once - with any additional <code>build()</code>s causing a panic.</p>
<p>So my question is, why not just have <code>build()</code> take <code>self</code> - meaning that calling <code>build()</code> will consume the <code>WasiCtxBuilder</code>? That way, Rust's type system itself will prevent the reuse of <code>WasiCtxBuilder</code> after it's been built.</p>
<p>This would align <code>WasiCtxBuilder</code> with most other builder types out there in rust crates.</p>
<p>Should this change be desired, I'd be happy to open a PR making the change.</p>
<p>Alternatively, if changing it to <code>self</code> is not desired/possible, I would enjoy understanding why.</p>
</blockquote>



<a name="567739628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567739628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567739628">(Jan 13 2026 at 11:24)</a>:</h4>
<p>LikeLakers2 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Hi, the title pretty much tells it all.</p>
<p>Basically, I was browsing the <code>wasmtime</code> and <code>wasmtime-wasi</code> docs, in an attempt to get an idea of how I might use this in a program.</p>
<p>Whilst doing so, I noticed that <code>wasmtime-wasi::WasiCtxBuilder::build()</code> takes <code>&amp;mut self</code>, but then proceeds to say that a <code>WasiCtxBuilder</code> can only be built once - with any additional <code>build()</code>s causing a panic.</p>
<p>So my question is, why not just have <code>build()</code> take <code>self</code> - meaning that calling <code>build()</code> will consume the <code>WasiCtxBuilder</code>? That way, Rust's type system itself will prevent the reuse of <code>WasiCtxBuilder</code> after it's been built.</p>
<p>This would align <code>WasiCtxBuilder</code> with most other builder types out there in rust crates.</p>
<p>Alternatively, if changing it to <code>self</code> is not desired/possible, I would enjoy understanding why.</p>
</blockquote>



<a name="567750662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567750662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567750662">(Jan 13 2026 at 12:26)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3744049857">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>All <code>WasiCtxBuilder</code> methods return <code>&amp;mut Self</code> . If <code>build</code> didn't, it wouldn't be possible to chain it as <code>WasiCtx::builder().stdin(...).build()</code>. You did need to do <code>let mut builder = WasiCtx::builder(); builder.stdin(...); builder.build()</code> then instead.</p>
</blockquote>



<a name="567787867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567787867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567787867">(Jan 13 2026 at 15:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3744852553">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>The decision for <code>&amp;mut self</code> is to more ergonomically enable incremental initialization at the cost of not statically preventing use-after-build. For example you can have a function that takes <code>&amp;mut WasiCtxtBuilder</code> and configures. With by-move, the main alternative, it would mean that a helper function would need to take <code>WasiCtxBuilder</code> and also return <code>WasiCtxBuilder</code> which can be quite cumbersome. Personally I find conditional initialization more cumbersome in by-move initialization as well.</p>
<p>As @bjorn3 mentioned changing just <code>build()</code> to take <code>self</code> would also make usage less ergonomic. It would require changing all the methods to take-and-return <code>self</code>.</p>
</blockquote>



<a name="567787897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567787897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567787897">(Jan 13 2026 at 15:05)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasmtime:api label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">Issue #12332</a>.</p>



<a name="567840690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567840690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567840690">(Jan 13 2026 at 19:11)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3745984199">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Then <code>WasiCtxBuilder</code> should be changed to be reusable for multiple <code>build()</code>s. It makes no sense for there to be a <code>WasiCtxBuilder</code> still lying around if we cannot reuse it.</p>
</blockquote>



<a name="567841048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567841048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567841048">(Jan 13 2026 at 19:13)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3745984199">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Then <code>WasiCtxBuilder</code> should be changed to be reusable for multiple <code>build()</code>s, as it makes no sense for <code>WasiCtxBuilder</code> to artificially prevent multiple <code>build()</code>s.</p>
</blockquote>



<a name="567841144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567841144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567841144">(Jan 13 2026 at 19:14)</a>:</h4>
<p>LikeLakers2 deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3745984199">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Then <code>WasiCtxBuilder</code> should be changed to be reusable for multiple <code>build()</code>s, as it makes no sense for <code>WasiCtxBuilder</code> to artificially prevent multiple <code>build()</code>s.</p>
</blockquote>



<a name="567843911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567843911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567843911">(Jan 13 2026 at 19:29)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746091532">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<blockquote>
<p>The decision for <code>&amp;mut self</code> is to more ergonomically enable incremental initialization at the cost of not statically preventing use-after-build.</p>
</blockquote>
<p>But <code>WasiCtxBuilder</code> artificially prevents its use after <code>build()</code>, by way of a <code>self.built</code> variable. &lt;<a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a>&gt; It effectively makes it a one-shot builder - unreusable unless you call <code>WasiCtxBuilder::new()</code> again.</p>
<blockquote>
<p>For example you can have a function that takes <code>&amp;mut WasiCtxtBuilder</code> and configures. With by-move, the main alternative, it would mean that a helper function would need to take <code>WasiCtxBuilder</code> and also return <code>WasiCtxBuilder</code> which can be quite cumbersome.</p>
</blockquote>
<p>The helper function wouldn't be chainable to the rest though - plus, you can still just pass <code>&amp;mut WasiCtxBuilder</code> to the function. As an example: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2</a></p>
<blockquote>
<p>As bjorn3 mentioned changing just <code>build()</code> to take <code>self</code> would also make usage less ergonomic. It would require changing all the methods to take-and-return <code>self</code>.</p>
</blockquote>
<p>Then they should all take <code>self</code> - or otherwise allow reuse after building.</p>
</blockquote>



<a name="567844029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567844029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567844029">(Jan 13 2026 at 19:30)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746091532">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<blockquote>
<p>The decision for <code>&amp;mut self</code> is to more ergonomically enable incremental initialization at the cost of not statically preventing use-after-build.</p>
</blockquote>
<p>But <code>WasiCtxBuilder</code> artificially prevents its use after <code>build()</code>, by way of a <code>self.built</code> variable. &lt;<a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a>&gt; It effectively makes it a one-shot builder - unreusable unless you call <code>WasiCtxBuilder::new()</code> again.</p>
<blockquote>
<p>For example you can have a function that takes <code>&amp;mut WasiCtxtBuilder</code> and configures. With by-move, the main alternative, it would mean that a helper function would need to take <code>WasiCtxBuilder</code> and also return <code>WasiCtxBuilder</code> which can be quite cumbersome.</p>
</blockquote>
<p>The helper function wouldn't be chainable to the rest in either case though - plus, you can still just pass <code>&amp;mut WasiCtxBuilder</code> to the function. As an example: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2</a></p>
<blockquote>
<p>As bjorn3 mentioned changing just <code>build()</code> to take <code>self</code> would also make usage less ergonomic. It would require changing all the methods to take-and-return <code>self</code>.</p>
</blockquote>
<p>Then they should all take <code>self</code> - or otherwise allow reuse after building.</p>
</blockquote>



<a name="567844326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567844326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567844326">(Jan 13 2026 at 19:32)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746091532">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<blockquote>
<p>The decision for <code>&amp;mut self</code> is to more ergonomically enable incremental initialization at the cost of not statically preventing use-after-build.</p>
</blockquote>
<p>But <code>WasiCtxBuilder</code> artificially prevents its reuse after <code>build()</code>, by way of a <code>self.built</code> variable. &lt;<a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a>&gt; It effectively makes it a one-shot builder - unreusable unless you call <code>WasiCtxBuilder::new()</code> again.</p>
<blockquote>
<p>For example you can have a function that takes <code>&amp;mut WasiCtxtBuilder</code> and configures. With by-move, the main alternative, it would mean that a helper function would need to take <code>WasiCtxBuilder</code> and also return <code>WasiCtxBuilder</code> which can be quite cumbersome.</p>
</blockquote>
<p>The helper function wouldn't be chainable to the rest in either case though - plus, you can still just pass <code>&amp;mut WasiCtxBuilder</code> to the function. As an example: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2</a></p>
<blockquote>
<p>As bjorn3 mentioned changing just <code>build()</code> to take <code>self</code> would also make usage less ergonomic. It would require changing all the methods to take-and-return <code>self</code>.</p>
</blockquote>
<p>Then they should all take <code>self</code> - or otherwise allow reuse after building.</p>
</blockquote>



<a name="567844619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567844619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567844619">(Jan 13 2026 at 19:34)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746091532">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<blockquote>
<p>The decision for <code>&amp;mut self</code> is to more ergonomically enable incremental initialization at the cost of not statically preventing use-after-build.</p>
</blockquote>
<p>But <code>WasiCtxBuilder</code> artificially prevents its reuse after <code>build()</code>, by way of a <code>self.built</code> variable. It effectively makes it a one-shot builder - unreusable unless you call <code>WasiCtxBuilder::new()</code> again - while simultaneously leaving a useless <code>WasiCtxBuilder</code> lying around.</p>
<p>&lt;<a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a>&gt;</p>
<blockquote>
<p>For example you can have a function that takes <code>&amp;mut WasiCtxtBuilder</code> and configures. With by-move, the main alternative, it would mean that a helper function would need to take <code>WasiCtxBuilder</code> and also return <code>WasiCtxBuilder</code> which can be quite cumbersome.</p>
</blockquote>
<p>The helper function wouldn't be chainable to the rest in either case though - plus, you can still just pass <code>&amp;mut WasiCtxBuilder</code> to the function. As an example: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=974d87f544e8af20129960c2436b31e2</a></p>
<blockquote>
<p>As bjorn3 mentioned changing just <code>build()</code> to take <code>self</code> would also make usage less ergonomic. It would require changing all the methods to take-and-return <code>self</code>.</p>
</blockquote>
<p>Then they should all take <code>self</code> - or otherwise allow reuse after building.</p>
</blockquote>



<a name="567845803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567845803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567845803">(Jan 13 2026 at 19:39)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746091532">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<blockquote>
<p>The decision for <code>&amp;mut self</code> is to more ergonomically enable incremental initialization at the cost of not statically preventing use-after-build.</p>
</blockquote>
<p>But <code>WasiCtxBuilder</code> artificially prevents its reuse after <code>build()</code>, by way of a <code>self.built</code> variable. It effectively makes it a one-shot builder - unreusable unless you call <code>WasiCtxBuilder::new()</code> again - while simultaneously leaving a useless <code>WasiCtxBuilder</code> lying around.</p>
<p>&lt;<a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a>&gt;</p>
<blockquote>
<p>For example you can have a function that takes <code>&amp;mut WasiCtxtBuilder</code> and configures. With by-move, the main alternative, it would mean that a helper function would need to take <code>WasiCtxBuilder</code> and also return <code>WasiCtxBuilder</code> which can be quite cumbersome.</p>
</blockquote>
<p>I mean... such a helper function wouldn't be chainable to the rest of the builder functions.</p>
<p>Also, it wouldn't need to take <code>WasiCtxBuilder</code> - Rust lets you create mutable references to a variable via <code>&amp;mut some_variable</code>.</p>
<p>See <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=2874a7a39eadc83689d3813dff582b49">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=2874a7a39eadc83689d3813dff582b49</a></p>
<blockquote>
<p>As bjorn3 mentioned changing just <code>build()</code> to take <code>self</code> would also make usage less ergonomic. It would require changing all the methods to take-and-return <code>self</code>.</p>
</blockquote>
<p>Then they should all take <code>self</code> - or otherwise allow reuse after building.</p>
</blockquote>



<a name="567845832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567845832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567845832">(Jan 13 2026 at 19:39)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746160494">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<blockquote>
<p>But WasiCtxBuilder artificially prevents its reuse after build(), by way of a self.built variable.</p>
</blockquote>
<p>It doesn't artificially prevent reuse. <code>self.built</code> is to prevent accidentally reusing it when doing so would be a clear bug due to <code>.build()</code> effectively having to reset the builder to it's default value as it needs to move it's contents into the created <code>WasiCtx</code>. Some things can't be cloned (like the randomness source, clocks, <code>socket_addr_check</code> closure), while cloning others would needlessly make building slower for the common case of not reusing the builder.</p>
</blockquote>



<a name="567846113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567846113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567846113">(Jan 13 2026 at 19:41)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746172106">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@bjorn3 Then... why not just have everything take <code>self</code> and avoid this whole kerfuffle? If the type system prevents its reuse, <code>WasiCtxBuilder</code> wouldn't need to handle preventing its own reuse.</p>
</blockquote>



<a name="567846180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567846180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567846180">(Jan 13 2026 at 19:41)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746172106">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@bjorn3 Then... why not just have everything take <code>self</code> and avoid this whole kerfuffle? Doing so means the type system prevents its reuse, and <code>WasiCtxBuilder</code> wouldn't need to handle preventing its own reuse.</p>
</blockquote>



<a name="567847779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567847779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567847779">(Jan 13 2026 at 19:51)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746244034">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Because it is less ergonomic when conditionally configuring the builder unfortunately.</p>
</blockquote>



<a name="567847973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567847973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567847973">(Jan 13 2026 at 19:52)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746257241">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>...No it's not? From my experience, and from a playground linked below, you can still do chaining with <code>self</code>.</p>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=f5cd354e0c8336dfce607e0d9a18ceb5">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=f5cd354e0c8336dfce607e0d9a18ceb5</a></p>
</blockquote>



<a name="567848203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567848203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567848203">(Jan 13 2026 at 19:54)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746257241">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>...No it's not? From my experience, and from testing in the playground linked below, you can still do chaining with <code>self</code>.</p>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=f5cd354e0c8336dfce607e0d9a18ceb5">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=f5cd354e0c8336dfce607e0d9a18ceb5</a></p>
</blockquote>



<a name="567848345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567848345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567848345">(Jan 13 2026 at 19:55)</a>:</h4>
<p>LikeLakers2 deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746257241">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>...No it's not? From my experience, and from testing in the playground linked below, you can still do chaining with <code>self</code>.</p>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=f5cd354e0c8336dfce607e0d9a18ceb5">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=f5cd354e0c8336dfce607e0d9a18ceb5</a></p>
</blockquote>



<a name="567851322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567851322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567851322">(Jan 13 2026 at 20:12)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746377810">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>...I'm becoming very confused as to what you all want.</p>
<p>From what I understand, what we want to allow is something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's simply not possible under Rust's type system, regardless of whether we use <code>&amp;mut self</code> or <code>self</code>.</p>
<p>If we use <code>&amp;mut self</code>, it has to be like this (&lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fbd31e733b87d5017513d4d8b33a96d0">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fbd31e733b87d5017513d4d8b33a96d0</a>&gt;):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>

<span class="n">builder</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's not considered ergonomic because it's not chaining to the original <code>MyBuilder::default()</code>.</p>
<p>Meanwhile, if we use <code>self</code>, it has to be like this (&lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=12fa26b158b08905cfb8b85b23268a98">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=12fa26b158b08905cfb8b85b23268a98</a>&gt;):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's not considered ergonomic because of the <code>builder =</code> inside the <code>if</code> statement.</p>
<p>So what is it the team wants?</p>
</blockquote>



<a name="567851563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567851563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567851563">(Jan 13 2026 at 20:14)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746377810">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>...I'm becoming very confused as to what you all want.</p>
<p>From what I understand, what we want to allow is something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's simply not possible under Rust's type system, regardless of whether we use <code>&amp;mut self</code> or <code>self</code>.</p>
<p>If we use <code>&amp;mut self</code> and return <code>&amp;mut Self</code>, it has to be like this (&lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fbd31e733b87d5017513d4d8b33a96d0">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fbd31e733b87d5017513d4d8b33a96d0</a>&gt;):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>

<span class="n">builder</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's not considered ergonomic because it's not chaining to the original <code>MyBuilder::default()</code>.</p>
<p>Meanwhile, if we use <code>self</code> and return <code>Self</code>, it has to be like this (&lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=12fa26b158b08905cfb8b85b23268a98">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=12fa26b158b08905cfb8b85b23268a98</a>&gt;):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's not considered ergonomic because of the <code>builder =</code> inside the <code>if</code> statement.</p>
<p>So what is it the team wants?</p>
</blockquote>



<a name="567851817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567851817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567851817">(Jan 13 2026 at 20:15)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746377810">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>...I'm becoming very confused as to what you all want.</p>
<p>From what I understand, what we want to allow is something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's simply not possible under Rust's type system, regardless of whether we use <code>&amp;mut self</code> or <code>self</code>.</p>
<p>If we use <code>&amp;mut self</code> and return <code>&amp;mut Self</code>, it has to be like this (&lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fbd31e733b87d5017513d4d8b33a96d0">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fbd31e733b87d5017513d4d8b33a96d0</a>&gt;):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>

<span class="n">builder</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's not considered ergonomic because it's not chaining to the original <code>MyBuilder::default()</code>.</p>
<p>Meanwhile, if we use <code>self</code> and return <code>Self</code>, it has to be like this (&lt;<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=12fa26b158b08905cfb8b85b23268a98">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=12fa26b158b08905cfb8b85b23268a98</a>&gt;):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBuilder</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_a</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">set_b</span><span class="p">(</span><span class="s">"b"</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">should_set_c</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">set_c</span><span class="p">(</span><span class="s">"c"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</code></pre></div>
<p>But that's not considered ergonomic because of the <code>builder =</code> inside the <code>if</code> statement.</p>
<p>So what is it the team wants?</p>
</blockquote>



<a name="567852848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567852848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567852848">(Jan 13 2026 at 20:23)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746416213">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@LikeLakers2 whether you mean it or not, you're coming across as somewhat confrontational. I'd encourage you to take a step back and determine what it is that you want: are you trying to understand our design decisions? Are you pushing for an alternative design? Do you see a contradiction that should be addressed?</p>
<p>The current design is, IMHO, a nice compromise. I believe you've gotten answers above regarding why we chose not to take alternatives (pure <code>self</code>: disallows control flow; <code>self</code> to <code>build</code>: disallows fully chained approach with <code>build</code> inline). You seem to be pointing to a "gotcha" contradiction, but I don't see the issue with your first listing. Is there some other issue you'd like to raise?</p>
</blockquote>



<a name="567854808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567854808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567854808">(Jan 13 2026 at 20:36)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746465582">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin I'm sorry if I come across as confrontational, but I'm more confused and frustrated trying to figure out what it is the team wants.</p>
<p>From my POV, the team seem to want things that even the current design doesn't provide - all the while saying that the alternatives can't provide what they want, despite the alternatives providing exactly those.</p>
<p>So I'm left wondering how the current design is better, and proposed designs are worse - even ignoring my own opinion, it sounds like the team thinks both designs suck?</p>
</blockquote>



<a name="567855091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567855091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567855091">(Jan 13 2026 at 20:39)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746465582">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin I'm sorry if I come across as confrontational, but I'm more confused and frustrated trying to figure out what it is the team wants.</p>
<p>From my POV, the team seem to want things that even the current design doesn't provide - all the while saying that the alternatives can't provide what they want, despite the alternatives providing exactly those.</p>
<p>So I'm left wondering how the current design is better, and proposed designs are worse - even ignoring my own opinion, it sounds like the team thinks both designs suck? Which leads me to be frustrated and confused as to what is even desired here - and thus, my frustration with this issue.</p>
</blockquote>



<a name="567857385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567857385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567857385">(Jan 13 2026 at 20:56)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746537676">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>No, I don't think the current design sucks. I think it's fine and meets our needs. I believe that we've answered above why the <code>build</code> method takes <code>&amp;mut self</code>, which was your original question, and why suggested alternatives do not work, so I'll go ahead and close this issue. If you have concrete suggestions for other APIs that meet all of the stated use cases above and are improvements, though, please feel free to file a issue or PR with that suggestion. Thanks!</p>
</blockquote>



<a name="567857390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567857390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567857390">(Jan 13 2026 at 20:56)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Hi, the title pretty much tells it all.</p>
<p>Basically, I was browsing the <code>wasmtime</code> and <code>wasmtime-wasi</code> docs, in an attempt to get an idea of how I might use this in a program.</p>
<p>Whilst doing so, I noticed that <code>wasmtime-wasi::WasiCtxBuilder::build()</code> takes <code>&amp;mut self</code>, but then proceeds to say that a <code>WasiCtxBuilder</code> can only be built once - with any additional <code>build()</code>s causing a panic.</p>
<p>So my question is, why not just have <code>build()</code> take <code>self</code> - meaning that calling <code>build()</code> will consume the <code>WasiCtxBuilder</code>? That way, Rust's type system itself will prevent the reuse of <code>WasiCtxBuilder</code> after it's been built.</p>
<p>This would align <code>WasiCtxBuilder</code> with most other builder types out there in rust crates.</p>
<p>Alternatively, if changing it to <code>self</code> is not desired/possible, I would enjoy understanding why.</p>
</blockquote>



<a name="567859015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567859015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567859015">(Jan 13 2026 at 21:08)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746584428">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin How do I explain, in a non-confrontational manner, that I am extremely confused as to what's even desired here? How do I explain that, even if an answer was given, I'm not understanding the answer?</p>
<p>Please, I'm trying desperately to not get angry here - but it's extremely hard when I try to explain my thoughts, that I don't understand the answers I've been given, only for them to be ignored in favor of "I believe we've already answered you."</p>
</blockquote>



<a name="567859377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567859377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567859377">(Jan 13 2026 at 21:10)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746584428">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin How do I explain, in a non-confrontational manner, that I am extremely confused as to what's even desired here? How do I explain that, even if an answer was given, I'm not understanding the answer?</p>
<p>Please, I'm trying desperately to not get frustrated here - but it's extremely hard when I try to explain my thoughts, that I don't understand the answers I've been given, only for them to be ignored in favor of "I believe we've already answered you."</p>
</blockquote>



<a name="567859640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567859640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567859640">(Jan 13 2026 at 21:12)</a>:</h4>
<p>LikeLakers2 deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746584428">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin How do I explain, in a non-confrontational manner, that I am extremely confused as to what's even desired here? How do I explain that, even if an answer was given, I'm not understanding the answer?</p>
<p>Please, I'm trying desperately to not get frustrated here - but it's extremely hard when I try to explain my thoughts, that I don't understand the answers I've been given, only for them to be ignored in favor of "I believe we've already answered you."</p>
</blockquote>



<a name="567860477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567860477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567860477">(Jan 13 2026 at 21:18)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746620007">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin, With all due respect: I'm trying to understand the stated use cases, and failing.</p>
<p>I'm trying my best to understand what's desired, and what's not - but I genuinely cannot feel I've gotten any answers out of this ordeal. Or if I have, it seems like they're all conflicting with one another, or with how Rust's type system works.</p>
<p>To be clear: I cannot give any concrete suggestions if I do not understand what is even desired.</p>
<p>So please help me understand what is desired? I'm genuinely trying, but the answers above have left me even more confused than when I'm started.</p>
</blockquote>



<a name="567860578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567860578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567860578">(Jan 13 2026 at 21:19)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746620007">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin, With all due respect: I'm trying to understand the stated use cases, but failing to do so. It's leaving me frustrated.</p>
<p>I'm trying my best to understand what's desired, and what's not - but I genuinely cannot feel I've gotten any answers out of this ordeal. Or if I have, it seems like they're all conflicting with one another, or with how Rust's type system works.</p>
<p>To be clear: I cannot give any concrete suggestions if I do not understand what is even desired.</p>
<p>So please help me understand what is desired? I'm genuinely trying, but the answers above have left me even more confused than when I'm started.</p>
</blockquote>



<a name="567860664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567860664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567860664">(Jan 13 2026 at 21:19)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746620007">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin, I'm trying my best to understand what's desired, and what's not - but I genuinely cannot feel I've gotten any answers out of this ordeal. Or if I have, it seems like they're all conflicting with one another, or with how Rust's type system works.</p>
<p>To be clear: I cannot give any concrete suggestions if I do not understand what is even desired.</p>
<p>So please help me understand what is desired? I'm genuinely trying, but the answers above have left me even more confused than when I'm started.</p>
</blockquote>



<a name="567860756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567860756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567860756">(Jan 13 2026 at 21:20)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746620007">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>@cfallin, I'm trying my best to understand what's desired, and what's not - but I genuinely cannot feel I've gotten any answers out of this ordeal. Or if I have, it seems like they're all conflicting with one another, or with how Rust's type system works.</p>
<p>To be clear: I cannot give any concrete suggestions if I do not understand what is even desired.</p>
<p>So please help me understand what is desired? I'm genuinely trying, but the answers above have left me even more confused than when I started.</p>
</blockquote>



<a name="567860922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567860922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567860922">(Jan 13 2026 at 21:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746631907">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Sure. To summarize the above, there are a few things we want in a builder API:</p>
<ul>
<li>We want chaining to work. <code>builder.a(...).b(...).c(...)</code>.</li>
<li>
<p>We want conditional updates to be reasonably ergonomic:<br>
<code>
   let mut builder = Builder::new();
   builder.a(...).b(...).c(...);
   if cond { builder.d(...).e(...); }
   </code></p>
</li>
<li>
<p>We want a one-liner to work for simple cases: <code>Builder::new().a(..).build()</code>.</p>
</li>
</ul>
<p>I believe that the second case above means we can't take <code>self</code> on setter (re-assigning the binding conditionally is not ergonomic enough) and the third case above means we can't take <code>self</code> on <code>build</code> if setters take <code>&amp;mut self</code>.</p>
<p>Does that answer your questions?</p>
</blockquote>



<a name="567861408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567861408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567861408">(Jan 13 2026 at 21:25)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746643243">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>That does, but that leaves me with another question:</p>
<p>As it stands, <code>WasiCtxBuilder</code> resets its state on <code>build()</code> by calling <code>Self::new()</code>:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a></p>
<p>This should leave it in a valid state to be reused - except that it artificially prevents reuse by way of the <code>self.built</code> variable being set to <code>true</code>.</p>
<p>So is there any reason we can't remove the <code>self.built</code> variable, and allow it to be reused?</p>
</blockquote>



<a name="567861442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567861442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567861442">(Jan 13 2026 at 21:25)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746643243">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>That does, but that leaves me with another question:</p>
<p>As it stands, <code>WasiCtxBuilder</code> resets its state on <code>build()</code> by replacing itself with <code>Self::new()</code>:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a></p>
<p>This should leave it in a valid state to be reused - except that it artificially prevents reuse by way of the <code>self.built</code> variable being set to <code>true</code>.</p>
<p>So is there any reason we can't remove the <code>self.built</code> variable, and allow it to be reused?</p>
</blockquote>



<a name="567861516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567861516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567861516">(Jan 13 2026 at 21:26)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746643243">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>That does, but that leaves me with another question:</p>
<p>As it stands, <code>WasiCtxBuilder</code> resets its state on <code>build()</code> by replacing itself with <code>Self::new()</code>:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451">https://github.com/bytecodealliance/wasmtime/blob/fb1827ee662b7b8fb7dbeb13fea8f7477e0339f9/crates/wasi/src/ctx.rs#L431-L451</a></p>
<p>This should leave it in a valid state to be reused - except that it prevents reuse by way of the <code>self.built</code> variable being set to <code>true</code>.</p>
<p>So is there any reason we can't remove the <code>self.built</code> variable, and allow it to be reused?</p>
</blockquote>



<a name="567862023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567862023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567862023">(Jan 13 2026 at 21:30)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746659429">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>I believe bjorn3 answered that above:</p>
<blockquote>
<p>self.built is to prevent accidentally reusing it when doing so would be a clear bug due to .build() effectively having to reset the builder to it's default value as it needs to move it's contents into the created WasiCtx. Some things can't be cloned (like the randomness source, clocks, socket_addr_check closure), while cloning others would needlessly make building slower for the common case of not reusing the builder.</p>
</blockquote>
</blockquote>



<a name="567864045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567864045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567864045">(Jan 13 2026 at 21:48)</a>:</h4>
<p>LikeLakers2 <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746719444">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Okay, I see where I went wrong on the first read of that. The blocking of reuse is to ensure that users don't accidentally use an unconfigured <code>WasiCtxBuilder</code>.</p>
<p>But now I'm wondering: Why not document that the <code>WasiCtxBuilder</code> will be returned to its default state on <code>build()</code>, and allow reuse?</p>
<p>I suggest this because, under the current API, if multiple <code>WasiCtx</code>s are needed, then each call to <code>WasiCtxBuilder::build()</code> then to <code>WasiCtxBuilder::new()</code> will be effectively two calls to <code>new()</code>, rather than one.</p>
<p>Allowing reuse here would reduce the number of times expensive operations (such as allocating heap space for <code>Vec</code>s) happen.</p>
</blockquote>



<a name="567865430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312332%20Why%20does%20%60wasmtime-wasi%3A%3AWasiCtxB.../near/567865430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312332.20Why.20does.20.60wasmtime-wasi.3A.3AWasiCtxB.2E.2E.2E.html#567865430">(Jan 13 2026 at 21:52)</a>:</h4>
<p>LikeLakers2 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/12332#issuecomment-3746719444">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12332">issue #12332</a>:</p>
<blockquote>
<p>Okay, I see where I went wrong on the first read of that. The blocking of reuse is to ensure that users don't accidentally use an unconfigured <code>WasiCtxBuilder</code>.</p>
<p>But now I'm wondering: Why not document that the <code>WasiCtxBuilder</code> will be returned to its default state on <code>build()</code>, and allow reuse?</p>
<p>I suggest this because, under the current API, if multiple <code>WasiCtx</code>s are needed, then each call to <code>WasiCtxBuilder::build()</code> then to <code>WasiCtxBuilder::new()</code> will be effectively two calls to <code>new()</code>, rather than one.</p>
<p>Allowing reuse here would reduce the number of times expensive operations (such as allocating heap space for <code>Vec</code>s) happen.</p>
<p>If there's a concern that people may not read the documentation, then we could perhaps allow such reuse through a function called <code>build_and_reset()</code> - making it explicit, even without the docs visible, that the <code>WasiCtxBuilder</code> will be reset to a default state.</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>