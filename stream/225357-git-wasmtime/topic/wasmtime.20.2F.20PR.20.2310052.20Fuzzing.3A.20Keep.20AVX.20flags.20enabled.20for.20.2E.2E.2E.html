<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10052 Fuzzing: Keep AVX flags enabled for ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html">wasmtime / PR #10052 Fuzzing: Keep AVX flags enabled for ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="494886364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/494886364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#494886364">(Jan 20 2025 at 18:05)</a>:</h4>
<p><strong>jeffcharles</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>.</p>



<a name="494886365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/494886365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#494886365">(Jan 20 2025 at 18:05)</a>:</h4>
<p><strong>jeffcharles</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>.</p>



<a name="494886368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/494886368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#494886368">(Jan 20 2025 at 18:05)</a>:</h4>
<p>jeffcharles opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a> from <code>jeffcharles:fuzzing-leave-avx-on-for-winch</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;<br>
Winch relies on AVX and AVX2 CPU features for implementing SIMD instructions on x64. The fuzzer sometimes disables these flags in Cranelift but the SIMD Wast tests are marked as supported if the Rust standard library says the current CPU has AVX and AVX2 support. So when the fuzzer disables these flags, the test is still marked as supported and then fails with an error saying AVX or AVX2 is required when the test is executed.</p>
</blockquote>



<a name="494900410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/494900410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#494900410">(Jan 20 2025 at 19:42)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>.</p>



<a name="494910072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/494910072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#494910072">(Jan 20 2025 at 20:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10052#issuecomment-2603205417">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="495081867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495081867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495081867">(Jan 21 2025 at 15:25)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10052#issuecomment-2605037950">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>:</p>
<blockquote>
<p>Thanks for this! Figuring out how to navigate the fuzzers around this I always find a bit of a challenge. For example I thought we <a href="https://github.com/bytecodealliance/wasmtime/blob/cd67a6090d515189a9c286bec2d993a591da3739/crates/fuzzing/src/generators/config.rs#L582">already disabled the simd proposal for winch</a>, so how come Winch got some simd instructions?</p>
<p>Once we know simd is in the picture it also might make more sense to either accept this as a "this is allowed error" or fail earlier during the test case itself. We try to keep the fuzz test cases meaning the same thing across machines so instead of force-enabling AVX it might make more sense to see if AVX is either explicitly disabled or unavailable on hardware and in that case bail out and discard the fuzz test case basically</p>
</blockquote>



<a name="495101088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495101088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495101088">(Jan 21 2025 at 16:49)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10052#issuecomment-2605251737">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>:</p>
<blockquote>
<p>Oh I also see now the fuzz bug this came in as! Specifically <code>wast_tests</code> fails because fuzz configuration is turning off <code>has_avx</code> (explicitly) and then running a simd test. The host actually has avx though which is why the test is expected to pass but then it fails because <code>has_avx</code> is manually disabled otherwise.</p>
<p>I'm wary to force-enable <code>has_avx</code> in such a core location in fuzzing because it'll mean we basically never fuzz Winch without AVX which seems useful to preserve. Would it be possible to perhaps scope this to just the <code>wast_tests</code> fuzzer and that one oracle? That could test for Winch, see if the test itself needs simd (which I think is available in configuration), and then the fuzz input could be thrown out (aka skipped) if avx is explicitly disabled?</p>
</blockquote>



<a name="495140663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495140663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495140663">(Jan 21 2025 at 20:41)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>.</p>



<a name="495141085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495141085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495141085">(Jan 21 2025 at 20:43)</a>:</h4>
<p>jeffcharles <a href="https://github.com/bytecodealliance/wasmtime/pull/10052#issuecomment-2605699503">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>:</p>
<blockquote>
<p>I had to add at least one method to the config to get access to the codegen flags in the oracle. Or at least I couldn't figure out another way to get access to the flags. The checks are also a little ugly because the value for the flag is typed as a <code>String</code> as opposed to a boolean.</p>
</blockquote>



<a name="495141795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495141795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495141795">(Jan 21 2025 at 20:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10052#pullrequestreview-2565662288">PR review</a>:</p>
<blockquote>
<p>Looks good to me, and thanks! I was just looking at a similar-ish thing over at <a href="https://github.com/bytecodealliance/wasmtime/pull/10068">https://github.com/bytecodealliance/wasmtime/pull/10068</a> which jogged my memory and leads me to ask, mind adding a <code>log::warn!</code> call that the test case is being skipped like <a href="https://github.com/bytecodealliance/wasmtime/blob/a018a5a9addb77d5998021a0150192aa955c71bf/crates/fuzzing/src/generators/codegen_settings.rs#L76-L77">this log here</a>? </p>
</blockquote>



<a name="495143925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495143925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495143925">(Jan 21 2025 at 21:02)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>.</p>



<a name="495149215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310052%20Fuzzing%3A%20Keep%20AVX%20flags%20enabled%20for%20.../near/495149215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310052.20Fuzzing.3A.20Keep.20AVX.20flags.20enabled.20for.20.2E.2E.2E.html#495149215">(Jan 21 2025 at 21:39)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10052">PR #10052</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>