<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11364 optimize host stream/future writes f... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html">wasmtime / PR #11364 optimize host stream/future writes f...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="532143882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532143882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532143882">(Jul 31 2025 at 18:36)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11364">PR #11364</a>.</p>



<a name="532143885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532143885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532143885">(Jul 31 2025 at 18:36)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11364">PR #11364</a> from <code>dicej:optimize-flat-lowerings</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>When we know statically that a payload will not require any guest realloc calls to lower, there's no need to defer the lowering to a fiber -- we can just do it immediately.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="532143886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532143886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532143886">(Jul 31 2025 at 18:36)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11364">PR #11364</a>.</p>



<a name="532144348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532144348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532144348">(Jul 31 2025 at 18:39)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/11364#issuecomment-3140979892">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11364">PR #11364</a>:</p>
<blockquote>
<p>One possible hole in this is that <code>LowerContext::options</code> is a public field, so someone could call <code>options.realloc</code> directly without going through <code>LowerContext::realloc</code> if they wanted (e.g. in a custom <code>Lower</code> implementation).  Do we need to address that?  If so, I could refactor some code so that we clone the options and null out the realloc function before passing it to <code>LowerContext</code>.</p>
</blockquote>



<a name="532145581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532145581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532145581">(Jul 31 2025 at 18:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11364#pullrequestreview-3076524889">PR review</a>:</p>
<blockquote>
<blockquote>
<p>One possible hole in this is that LowerContext::options is a public field</p>
</blockquote>
<p>I think that's ok because <code>Options::realloc</code> is a private method. It's possible to overwrite <code>Options</code> with something else which could be problematic, but this is just something for debug assertions and avoiding panics, not safety, so I think it's ok to ignore this. </p>
</blockquote>



<a name="532145582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532145582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532145582">(Jul 31 2025 at 18:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11364#discussion_r2246123214">PR review comment</a>:</p>
<blockquote>
<p>Could this be renamed to <code>MAY_REQUIRE_REALLOC</code>? This otherwise isn't a guarantee that can be relied on as it's only set for integers, but it's not set for aggregates of other flat types (e.g. option-of-enum, etc).</p>
<p>Also can you add documentation that getting this correct is required for not panicking? Basically how other parts of the codebase will, for example, skip fibers during lowering if "may require realloc" is <code>false</code></p>
</blockquote>



<a name="532145609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532145609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532145609">(Jul 31 2025 at 18:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11364#pullrequestreview-3076541993">PR review</a>.</p>



<a name="532151036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532151036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532151036">(Jul 31 2025 at 19:20)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11364">PR #11364</a>.</p>



<a name="532158053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311364%20optimize%20host%20stream/future%20writes%20f.../near/532158053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311364.20optimize.20host.20stream.2Ffuture.20writes.20f.2E.2E.2E.html#532158053">(Jul 31 2025 at 20:02)</a>:</h4>
<p>dicej merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11364">PR #11364</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>