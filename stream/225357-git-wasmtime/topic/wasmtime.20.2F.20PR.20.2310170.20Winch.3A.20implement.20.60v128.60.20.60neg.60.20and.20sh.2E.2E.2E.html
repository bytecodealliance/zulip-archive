<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10170 Winch: implement `v128` `neg` and sh... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html">wasmtime / PR #10170 Winch: implement `v128` `neg` and sh...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="497389558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497389558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497389558">(Feb 03 2025 at 10:21)</a>:</h4>
<p>MarinPostma opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a> from <code>MarinPostma:packed-integer-arithmetic-pt2</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>implements the following instructions for winch x64 backend:</p>
<ul>
<li><code>i8x16.neg</code></li>
<li><code>i16x8.neg</code></li>
<li><code>i32x4.neg</code></li>
<li><code>i64x2.neg</code></li>
<li><code>i8x16.shl</code></li>
<li><code>i16x8.shl</code></li>
<li><code>i32x4.shl</code></li>
<li><code>i64x2.shl</code></li>
<li><code>i8x16.shr_s</code></li>
<li><code>i16x8.shr_s</code></li>
<li><code>i32x4.shr_s</code></li>
<li><code>i64x2.shr_s</code></li>
<li><code>i8x16.shr_u</code></li>
<li><code>i16x8.shr_u</code></li>
<li><code>i32x4.shr_u</code></li>
<li><code>i64x2.shr_u</code></li>
</ul>
<p>depends on #10147</p>
<p>#8093<br>
</p>
</blockquote>



<a name="497389561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497389561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497389561">(Feb 03 2025 at 10:21)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497389562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497389562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497389562">(Feb 03 2025 at 10:21)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497389564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497389564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497389564">(Feb 03 2025 at 10:21)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497389566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497389566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497389566">(Feb 03 2025 at 10:21)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497389567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497389567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497389567">(Feb 03 2025 at 10:21)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497391063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497391063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497391063">(Feb 03 2025 at 10:27)</a>:</h4>
<p>MarinPostma edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>:</p>
<blockquote>
<p>implements the following instructions for winch x64 backend:</p>
<ul>
<li><code>i8x16.neg</code></li>
<li><code>i16x8.neg</code></li>
<li><code>i32x4.neg</code></li>
<li><code>i64x2.neg</code></li>
<li><code>i8x16.shl</code></li>
<li><code>i16x8.shl</code></li>
<li><code>i32x4.shl</code></li>
<li><code>i64x2.shl</code></li>
<li><code>i8x16.shr_s</code></li>
<li><code>i16x8.shr_s</code></li>
<li><code>i32x4.shr_s</code></li>
<li><code>i64x2.shr_s</code></li>
<li><code>i8x16.shr_u</code></li>
<li><code>i16x8.shr_u</code></li>
<li><code>i32x4.shr_u</code></li>
<li><code>i64x2.shr_u</code></li>
</ul>
<p>depends on #10147</p>
<p>One thing that we may improve is the handling of constants: My initial implementation introduced <code>WellKnown</code> addresses, because this is how cranelift implemented shifts. I revised that later on, to keep things simple, and used the constant infrastructure already present in winch. The use of well known constant addresses _may_ be more efficient, if we decided to use them. Happy to do that in a followup.</p>
<p>#8093<br>
</p>
</blockquote>



<a name="497444186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497444186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497444186">(Feb 03 2025 at 14:05)</a>:</h4>
<p>MarinPostma updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497446856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497446856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497446856">(Feb 03 2025 at 14:15)</a>:</h4>
<p>MarinPostma edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>:</p>
<blockquote>
<p>implements the following instructions for winch x64 backend:</p>
<ul>
<li><code>i8x16.neg</code></li>
<li><code>i16x8.neg</code></li>
<li><code>i32x4.neg</code></li>
<li><code>i64x2.neg</code></li>
<li><code>i8x16.shl</code></li>
<li><code>i16x8.shl</code></li>
<li><code>i32x4.shl</code></li>
<li><code>i64x2.shl</code></li>
<li><code>i8x16.shr_s</code></li>
<li><code>i16x8.shr_s</code></li>
<li><code>i32x4.shr_s</code></li>
<li><code>i64x2.shr_s</code></li>
<li><code>i8x16.shr_u</code></li>
<li><code>i16x8.shr_u</code></li>
<li><code>i32x4.shr_u</code></li>
<li><code>i64x2.shr_u</code></li>
</ul>
<p>One thing that we may improve is the handling of constants: My initial implementation introduced <code>WellKnown</code> addresses, because this is how cranelift implemented shifts. I revised that later on, to keep things simple, and used the constant infrastructure already present in winch. The use of well known constant addresses _may_ be more efficient, if we decided to use them. Happy to do that in a followup.</p>
<p>#8093<br>
</p>
</blockquote>



<a name="497470525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497470525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497470525">(Feb 03 2025 at 15:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10170#issuecomment-2631373369">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api", "wasmtime:docs", "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="497482771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497482771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497482771">(Feb 03 2025 at 16:32)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/saulecabrera">saulecabrera</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="497483088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497483088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497483088">(Feb 03 2025 at 16:33)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10170#issuecomment-2631500226">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>:</p>
<blockquote>
<p>Passing the review baton again to Saúl -- thanks!</p>
</blockquote>



<a name="497494070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/497494070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#497494070">(Feb 03 2025 at 17:24)</a>:</h4>
<p><strong>MarinPostma</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a> as ready for review.</p>



<a name="498124236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/498124236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#498124236">(Feb 06 2025 at 13:46)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10170#pullrequestreview-2598725410">PR review</a>:</p>
<blockquote>
<p>Looks reasonable to me, thanks!</p>
</blockquote>



<a name="498128285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/498128285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#498128285">(Feb 06 2025 at 14:04)</a>:</h4>
<p>saulecabrera <a href="https://github.com/bytecodealliance/wasmtime/pull/10170#issuecomment-2639921488">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>:</p>
<blockquote>
<p>The failure is because in main <code>xmm_rmi_rvex</code> no longer exists. </p>
</blockquote>



<a name="498150474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/498150474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#498150474">(Feb 06 2025 at 15:38)</a>:</h4>
<p>MarinPostma <a href="https://github.com/bytecodealliance/wasmtime/pull/10170#issuecomment-2640172841">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>:</p>
<blockquote>
<p>@saulecabrera rebased</p>
</blockquote>



<a name="498152200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/498152200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#498152200">(Feb 06 2025 at 15:46)</a>:</h4>
<p>MarinPostma updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<a name="498180615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310170%20Winch%3A%20implement%20%60v128%60%20%60neg%60%20and%20sh.../near/498180615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310170.20Winch.3A.20implement.20.60v128.60.20.60neg.60.20and.20sh.2E.2E.2E.html#498180615">(Feb 06 2025 at 18:00)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10170">PR #10170</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>