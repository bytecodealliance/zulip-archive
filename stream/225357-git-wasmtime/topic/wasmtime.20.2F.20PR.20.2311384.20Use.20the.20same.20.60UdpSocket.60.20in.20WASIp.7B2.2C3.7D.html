<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11384 Use the same `UdpSocket` in WASIp{2,3} · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html">wasmtime / PR #11384 Use the same `UdpSocket` in WASIp{2,3}</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="532962794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532962794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532962794">(Aug 05 2025 at 17:48)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="532962795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532962795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532962795">(Aug 05 2025 at 17:48)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a> from <code>alexcrichton:refactor-wasi-udp-socket</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit refactors the implementation of <code>wasi:sockets</code> for WASIp2 and WASIp3 to use the same underlying host data structure for the <code>UdpSocket</code> resource in WIT. Previously each version of WASI had its own socket which resulted in duplicated code. There's some minor differences between WASIp2 and WASIp3 but it's easy enough to paper over with the same socket type. This is intended to help with the maintainability of this going forward to only have one type to operate on rather than two (which also ensures that bugfixes for one should affect the other).</p>
<p>One other change made in this commit is that sprinkled checks for whether or not UDP is allowed are all removed and canonicalized during UDP socket creation. This means that UDP socket creation is the only location that checks for whether UDP is allowed. Once a UDP socket is created it can be used freely regardless of whether the UDP setting is enabled or disabled. This is not intended to have a large practical effect but it does mean the behavior of hosts that deny UDP but manually give access to a UDP socket resource to a component may behave subtly differently.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="532965209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532965209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532965209">(Aug 05 2025 at 18:03)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11384#pullrequestreview-3089212126">PR review</a>.</p>



<a name="532965210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532965210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532965210">(Aug 05 2025 at 18:03)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11384#discussion_r2254992491">PR review comment</a>:</p>
<blockquote>
<p>Could we clone the "check" from context here and avoid having to <code>Arc::clone</code> on each p3 usage of it?</p>
</blockquote>



<a name="532965211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532965211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532965211">(Aug 05 2025 at 18:03)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11384#discussion_r2254990312">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        socket.set_socket_addr_check(Some(check));
</code></pre></div><br>
</p>
</blockquote>



<a name="532965516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532965516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532965516">(Aug 05 2025 at 18:05)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11384#discussion_r2254992491">PR review comment</a>.</p>



<a name="532976155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532976155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532976155">(Aug 05 2025 at 19:19)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="532976612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532976612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532976612">(Aug 05 2025 at 19:22)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="532976859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532976859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532976859">(Aug 05 2025 at 19:24)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11384#pullrequestreview-3089432062">PR review</a>.</p>



<a name="532976860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532976860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532976860">(Aug 05 2025 at 19:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11384#discussion_r2255146397">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately no because the check will live in the store no matter what and we can't borrow the store across awaits, so it's got to get moved out.  This is mostly just here to handle how in WASIp2 the socket check is inherited from the <code>Network</code> type rather than unconditionally from <code>WasiCtx</code>. While esoteric it's possible for embedders to push their own <code>Network</code> without using <code>WasiCtx</code> which has a distinct check than the one in <code>WasiCtx</code> itself, although we might want to remove such a feature eventually (which would remove the need for this field here)</p>
</blockquote>



<a name="532976870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532976870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532976870">(Aug 05 2025 at 19:24)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="532982756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532982756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532982756">(Aug 05 2025 at 20:06)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="532982758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532982758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532982758">(Aug 05 2025 at 20:06)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="532982759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/532982759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#532982759">(Aug 05 2025 at 20:06)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="533004523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/533004523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#533004523">(Aug 06 2025 at 00:03)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<a name="533093241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311384%20Use%20the%20same%20%60UdpSocket%60%20in%20WASIp%7B2%2C3%7D/near/533093241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311384.20Use.20the.20same.20.60UdpSocket.60.20in.20WASIp.7B2.2C3.7D.html#533093241">(Aug 06 2025 at 12:38)</a>:</h4>
<p>rvolosatovs merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11384">PR #11384</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>