<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11836 feat(no_std): Add custom sync primit... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html">wasmtime / PR #11836 feat(no_std): Add custom sync primit...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="544270006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544270006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544270006">(Oct 11 2025 at 00:44)</a>:</h4>
<p>salmans opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a> from <code>salmans:custom-sync</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR introduces support for custom synchronization primitives in wasmtime's custom platform backend, enabling embedders to provide their own mutex and rwlock implementations through C FFI.</p>
<h3>Motivation</h3>
<p>The existing implementation in <code>sync_nostd.rs</code> uses uncontended locks that panic on contention, making it unsuitable for multithreaded environments. However, many no_std environments (such as OS kernels, embedded RTOS, or bare-metal systems with threading support) do have access to threading primitives and need proper synchronization.</p>
<p>This implementation follows the approach suggested in the comments <code>sync_nostd.rs</code> implementation, which recommended that hosts provide their own synchronization primitives via the C API for truly multithreaded no_std environments.</p>
<h3>Changes</h3>
<p>- New <code>custom-sync-primitives</code> feature: Allows wasmtime to use host-provided synchronization primitives instead of uncontended locks in <code>sync_nostd.rs</code><br>
  - C API declarations (in <code>capi.rs</code>): Defines the FFI interface for sync lock operations:<br>
    - <code>wasmtime_sync_lock_new/free</code> - Mutex lifecycle management<br>
    - <code>wasmtime_sync_lock_acquire/release</code> - Exclusive locking<br>
    - <code>wasmtime_sync_rwlock_read/write</code> - Reader-writer lock operations<br>
    - <code>wasmtime_sync_rwlock_read_release/write_release</code> - Lock release<br>
  - Implementation (in <code>custom/sync.rs</code>): Rust wrappers that call the C API functions, implementing wasmtime's internal <code>OnceLock</code> and <code>RwLock</code> types using the custom primitives</p>
</blockquote>



<a name="544271231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544271231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544271231">(Oct 11 2025 at 00:58)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544272329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544272329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544272329">(Oct 11 2025 at 01:11)</a>:</h4>
<p><strong>salmans</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a> as ready for review.</p>



<a name="544272331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544272331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544272331">(Oct 11 2025 at 01:11)</a>:</h4>
<p><strong>salmans</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544272333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544272333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544272333">(Oct 11 2025 at 01:11)</a>:</h4>
<p><strong>salmans</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544410119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544410119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544410119">(Oct 12 2025 at 15:47)</a>:</h4>
<p>salmans edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>This PR introduces support for custom synchronization primitives in wasmtime's custom platform backend, enabling embedders to provide their own mutex and rwlock implementations through C FFI.</p>
<h3>Motivation</h3>
<p>The existing implementation in <code>sync_nostd.rs</code> uses uncontended locks that panic on contention, making it unsuitable for multithreaded environments. However, many no_std environments (such as OS kernels, embedded RTOS, or bare-metal systems with threading support) do have access to threading primitives and need proper synchronization.</p>
<p>This implementation follows the approach suggested in the comments in <code>sync_nostd.rs</code> implementation, which recommended that hosts provide their own synchronization primitives via the C API for truly multithreaded no_std environments.</p>
<h3>Changes</h3>
<p>- New <code>custom-sync-primitives</code> feature: Allows wasmtime to use host-provided synchronization primitives instead of uncontended locks in <code>sync_nostd.rs</code><br>
  - C API declarations (in <code>capi.rs</code>): Defines the FFI interface for sync lock operations:<br>
    - <code>wasmtime_sync_lock_new/free</code> - Mutex lifecycle management<br>
    - <code>wasmtime_sync_lock_acquire/release</code> - Exclusive locking<br>
    - <code>wasmtime_sync_rwlock_read/write</code> - Reader-writer lock operations<br>
    - <code>wasmtime_sync_rwlock_read_release/write_release</code> - Lock release<br>
  - Implementation (in <code>custom/sync.rs</code>): Rust wrappers that call the C API functions, implementing wasmtime's internal <code>OnceLock</code> and <code>RwLock</code> types using the custom primitives</p>
</blockquote>



<a name="544573500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573500">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3331922678">PR review</a>:</p>
<blockquote>
<p>Thanks for this! I've got some various ideas/suggestions below I'm curiuos to get your take on. The high-level goal would be to simplify this module by putting a little bit more complexity into the implementation-side of the symbols and to additionally reduce duplication with the <code>sync_nostd</code> module since this is pretty tricky code to get right.</p>
<p>This is all primarily motivated by the lack of tests in this PR and the overall difficulty of testing an implementation. Ideally, if you're up for it, the <code>examples/min-platform</code> example would be updated with a new feature to implement synchronization primitives in terms of <code>pthread_*</code> functions. Would you be up for adding such a test?</p>
</blockquote>



<a name="544573504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573504">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426571697">PR review comment</a>:</p>
<blockquote>
<p>One drawback of this current approach is that this module has a lot of nontrivial implementation logic which isn't tested at all in our CI. Adding testing would be somewhat difficult unfortunately, as well. Given that I might recommend a few changes to the C API to make loops like this simpler:</p>
<ul>
<li><code>wasmtime_sync_lock_new</code> would take a <code>*mut usize</code> parameter rather than returning a <code>usize</code> (similar to all other functions).</li>
<li>It would be an API contract of <code>wasmtime_sync_lock_new</code> that the initial value of the pointer passed in is 0. That way if the implementation uses 0 to mean "initialized but inert" the function would be a noop. Otherwise it's up to the implementation to initialize-from-zero.</li>
<li>Lazy initialization would be deferred to the implementor rather than implemented here. That would remove the <code>spin_loop()</code> which is generally not appropriate and is best to leave to the actual synchronization library which can probably do something more productive than spinning (e.g. by yielding)</li>
</ul>
<p>Overall that would remove the need for this function entirely and should greatly simplify this interface.</p>
</blockquote>



<a name="544573505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573505">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426560436">PR review comment</a>:</p>
<blockquote>
<p>For this the main purpose of these custom cfgs are for when there's custom logic behind the definition, such as a cascade of other cfg's or checking other conditions. For this one it's an alias of <code>feature = "custom-sync-primitives"</code> so I think it's fine to omit.</p>
<p>Now that being said in the code this cfg is always coupled with <code>not(feature = "std")</code> as well. Given that I think it would be reasonable to keep <code>has_custom_sync</code> as a custom cfg, but factor in the <code>not(feature = "std")</code> calculating to enabling it as well. Basically when <code>feature = "std"</code> is enabled this <code>has_custom_sync</code> would never be enabled.</p>
</blockquote>



<a name="544573506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573506">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426586126">PR review comment</a>:</p>
<blockquote>
<p>In the interest of simplifying this module as much as possible due to the difficulty to test this, I think it would be good to share this implementation with the preexisting code in <code>sync_nostd.rs</code> which I suspect this is copied from. Could the <code>sync_nostd</code> module have a single <code>RwLock</code>, but internally there'd be something like a "raw" rwlock which has no data and is just the <code>lock: HostLock</code> primitive here? That way without <code>custom-sync-primitives</code> it'd use the panic-on-contention implementation from today but with the feature it'd use a lock defined in terms of the C API.</p>
</blockquote>



<a name="544573507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573507">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426561603">PR review comment</a>:</p>
<blockquote>
<p>Could the panic-on-contention error messages of this module be updated to mention the <code>custom-sync-primitives</code> Cargo feature?</p>
</blockquote>



<a name="544573508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573508">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426588074">PR review comment</a>:</p>
<blockquote>
<p>What do you think about using a custom constructor/destructor for an <code>RwLock</code> rather than sharing the same ones for the mutex? That way it leaves implementations the ability to have distinct implementations of the two, and if they're the same it wouldn't be too hard to route them to the same implementation.</p>
</blockquote>



<a name="544573509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573509">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426573751">PR review comment</a>:</p>
<blockquote>
<p>This'll want to be tagged as an <code>unsafe</code> function because it's generally not safe to call. Although this could also perhaps be exclusively part of the <code>Drop</code> implementation?</p>
</blockquote>



<a name="544573510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573510">(Oct 13 2025 at 14:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2426590172">PR review comment</a>:</p>
<blockquote>
<p>This makes me realize that this is actually missing from the <code>sync_nostd</code> implementation today. This is another point in favor for me to reduce the duplication between the two modules.</p>
</blockquote>



<a name="544573540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544573540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544573540">(Oct 13 2025 at 14:57)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544629517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629517">(Oct 13 2025 at 22:27)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544629625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629625">(Oct 13 2025 at 22:28)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2427434620">PR review comment</a>:</p>
<blockquote>
<p>I agree. Changes are reflected.</p>
</blockquote>



<a name="544629627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629627">(Oct 13 2025 at 22:28)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3333190050">PR review</a>.</p>



<a name="544629728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629728">(Oct 13 2025 at 22:30)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2427438141">PR review comment</a>:</p>
<blockquote>
<p>That's a great idea. I made those changes.</p>
</blockquote>



<a name="544629730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629730">(Oct 13 2025 at 22:30)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3333196317">PR review</a>.</p>



<a name="544629844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629844">(Oct 13 2025 at 22:31)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3333204024">PR review</a>.</p>



<a name="544629845"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629845" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629845">(Oct 13 2025 at 22:31)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2427442154">PR review comment</a>:</p>
<blockquote>
<p>I unified the two implementations but wondering if that properly reflects your ideas. Please let me know if something doesn't seem right or missing.</p>
</blockquote>



<a name="544629867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629867">(Oct 13 2025 at 22:31)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3333204866">PR review</a>.</p>



<a name="544629868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629868">(Oct 13 2025 at 22:31)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2427442813">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="544629881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629881">(Oct 13 2025 at 22:32)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3333206030">PR review</a>.</p>



<a name="544629882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629882">(Oct 13 2025 at 22:32)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2427443330">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="544629967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629967">(Oct 13 2025 at 22:33)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3333212822">PR review</a>.</p>



<a name="544629968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544629968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544629968">(Oct 13 2025 at 22:33)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2427446703">PR review comment</a>:</p>
<blockquote>
<p>Wondering if this is a good idea.</p>
</blockquote>



<a name="544630905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544630905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544630905">(Oct 13 2025 at 22:47)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544631116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544631116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544631116">(Oct 13 2025 at 22:50)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3399313319">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>@alexcrichton Thanks for the quick review. I agree. with all points you made and tried to address them. And absolutely, I'll extend the <code>min_platform</code> example accordingly (it's a very useful example that has helped me a lot in the past!).</p>
</blockquote>



<a name="544631125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544631125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544631125">(Oct 13 2025 at 22:50)</a>:</h4>
<p>salmans edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3399313319">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>@alexcrichton Thanks for the quick review. I agree with all points you made and tried to address them. And absolutely, I'll extend the <code>min_platform</code> example accordingly (it's a very useful example that has helped me a lot in the past!).</p>
</blockquote>



<a name="544631450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544631450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544631450">(Oct 13 2025 at 22:56)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544639060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544639060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544639060">(Oct 14 2025 at 00:47)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544639353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544639353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544639353">(Oct 14 2025 at 00:51)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3399562698">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>I pushed two more commits to reflect the custom sync changes in min-platform example. The first one implements the sync primitives but to have a truly multithreaded system, I needed to change the existing TLS implementation that assumes a single threaded execution. Feel free to drop the second commit if not needed or let me know if needs adjustment.</p>
</blockquote>



<a name="544639740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544639740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544639740">(Oct 14 2025 at 00:55)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544769932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769932">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3336061275">PR review</a>.</p>



<a name="544769939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769939">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429464764">PR review comment</a>:</p>
<blockquote>
<p>For this I'd say it's reasonable to unconditionally call <code>wasmtime_sync_lock_free</code> and leave it up to the implementation to be a noop if the lock was never actually used.</p>
</blockquote>



<a name="544769940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769940">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429472392">PR review comment</a>:</p>
<blockquote>
<p>If possible let's keep this removed because that means that <code>cargo test</code> will still test this module's internals and run the <code>#[cfg(test)]</code> module, otherwise the tests won't run at all.</p>
</blockquote>



<a name="544769941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769941">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429457515">PR review comment</a>:</p>
<blockquote>
<p>I might recommend dropping this field in the guards and accessing it directly from <code>self.lock</code> to shrink the size of the guard</p>
</blockquote>



<a name="544769942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769942">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429456089">PR review comment</a>:</p>
<blockquote>
<p>Hm ok on second though I don't think I fully thought this through. Fully thinking this through now, I think let's actually delete the <code>*_new</code> functions entirely. Any lazy initialization, if necessary, can be done by <code>wasmtime_sync_rwlock_write</code> here for example. The C API would then have two documented guarantees:</p>
<ul>
<li>Freshly initialized locks will always have a zero pattern for initialization.</li>
<li><code>*_free</code> may be called on a lock that was initialized but never used (e.g. is a zero pattern)</li>
</ul>
<p>That still allows for lazy init and means that wasmtime never explicitly calls <code>*_new</code> and defers initialization, if any, to the implementation. </p>
<p>Basically otherwise it feels a bit odd calling <code>*_new</code> on each operation. Apologies for the confusion!</p>
</blockquote>



<a name="544769944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769944">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429475893">PR review comment</a>:</p>
<blockquote>
<p>I don't think that this is a valid implementation of the API because if locks are acquired in order then this could cause a deadlock by having multiple locks get mapped to the same lock. I think for the sample implementation here heap allocation will be needed.</p>
</blockquote>



<a name="544769945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769945">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429463051">PR review comment</a>:</p>
<blockquote>
<p>Dropping the lock here will want to happen as part of a <code>Drop</code>-based destructor instead of manually here to handle panicking, for example, in the constructor</p>
</blockquote>



<a name="544769948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544769948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544769948">(Oct 14 2025 at 14:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2429470401">PR review comment</a>:</p>
<blockquote>
<p>Also I think it'd help cut down on some duplication by placing this <code>Drop</code> implementation on <code>HostLock</code> above to avoid having it both here and for <code>Mutex&lt;T&gt;</code></p>
</blockquote>



<a name="544848255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544848255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544848255">(Oct 14 2025 at 22:40)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544849244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544849244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544849244">(Oct 14 2025 at 22:53)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544850732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544850732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544850732">(Oct 14 2025 at 23:11)</a>:</h4>
<p>salmans submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3337835621">PR review</a>.</p>



<a name="544850735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544850735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544850735">(Oct 14 2025 at 23:11)</a>:</h4>
<p>salmans created <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#discussion_r2430718630">PR review comment</a>:</p>
<blockquote>
<p>Good catch, thank you!<br>
I pushed a couple of new commits, addressing your previous comments as well as this one. The example is now using heap allocation but I guess it's fine to use <code>stdlib</code> here. Also when running tests locally, I discovered a race condition (when running ~500 threads concurrently), so added CAS logic, which fix the issue.</p>
</blockquote>



<a name="544883697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544883697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544883697">(Oct 15 2025 at 06:11)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="544990690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544990690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544990690">(Oct 15 2025 at 14:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#pullrequestreview-3340856920">PR review</a>:</p>
<blockquote>
<p>Thanks again for your work on this!</p>
</blockquote>



<a name="544994632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/544994632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#544994632">(Oct 15 2025 at 15:09)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3406937265">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>Thanks so much for your feedback and the quick turnaround!</p>
</blockquote>



<a name="545345580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545345580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545345580">(Oct 16 2025 at 14:27)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3411184300">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>@alexcrichton this apparently got kicked out of the merge queue. Do you mind trying one more time? Thanks again!</p>
</blockquote>



<a name="545347007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545347007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545347007">(Oct 16 2025 at 14:31)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3411201402">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>Oh that's because of the <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/18533087678/job/52820896339">test failure</a> that happened. I think there's a different version of bindgen installed in CI than you were running locally, and it's fine to either update CI or downgrade your version locally, whichever's easiest for you</p>
</blockquote>



<a name="545390964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545390964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545390964">(Oct 16 2025 at 16:20)</a>:</h4>
<p><strong>salmans</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="545390966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545390966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545390966">(Oct 16 2025 at 16:20)</a>:</h4>
<p><strong>salmans</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="545390968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545390968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545390968">(Oct 16 2025 at 16:20)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="545399817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545399817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545399817">(Oct 16 2025 at 16:44)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3411747291">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>Ah thank you! I updated the CI version. It should be good now.</p>
</blockquote>



<a name="545409378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545409378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545409378">(Oct 16 2025 at 17:26)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3411947686">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>This got bounced again but I'm not able to see any logs.</p>
</blockquote>



<a name="545409645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545409645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545409645">(Oct 16 2025 at 17:27)</a>:</h4>
<p>salmans deleted a <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3411947686">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>This got bounced again but I'm not able to see any logs.</p>
</blockquote>



<a name="545410615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545410615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545410615">(Oct 16 2025 at 17:32)</a>:</h4>
<p>salmans updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<a name="545411293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545411293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545411293">(Oct 16 2025 at 17:34)</a>:</h4>
<p>salmans <a href="https://github.com/bytecodealliance/wasmtime/pull/11836#issuecomment-3412007660">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>:</p>
<blockquote>
<p>I had accidentally edited the comments in the header file generated by cbindgen, which caused the PR get rejected again (sorry about that!). It should be fine now.</p>
</blockquote>



<a name="545430669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311836%20feat%28no_std%29%3A%20Add%20custom%20sync%20primit.../near/545430669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311836.20feat.28no_std.29.3A.20Add.20custom.20sync.20primit.2E.2E.2E.html#545430669">(Oct 16 2025 at 19:24)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11836">PR #11836</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>