<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12480 fix: ensure EntitySet::insert reserv... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html">wasmtime / PR #12480 fix: ensure EntitySet::insert reserv...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="570973732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/570973732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#570973732">(Jan 30 2026 at 09:02)</a>:</h4>
<p>lisenokdonbassenok opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a> from <code>lisenokdonbassenok:fix/entity-set-insert-capacity</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Cause: <code>wasmtime_environ::collections::EntitySet::insert</code> called <code>try_ensure_capacity(k.index())</code>, while <code>CompoundBitSet::try_ensure_capacity</code> guarantees capacity only for indices &lt; n. This could leave the backing bitset without space for k.index() and force a later infallible ensure_capacity inside insert, breaking the fallible-allocation contract and potentially panicking on OOM.<br>
Summary: Update <code>EntitySet::insert</code> to reserve capacity for indices 0..=k.index() by calling <code>try_ensure_capacity(k.index() + 1)</code> so that all allocations during insertion go through the fallible path and correctly report OutOfMemory instead of panicking.</p>
</blockquote>



<a name="570973735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/570973735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#570973735">(Jan 30 2026 at 09:02)</a>:</h4>
<p><strong>lisenokdonbassenok</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="570973736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/570973736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#570973736">(Jan 30 2026 at 09:02)</a>:</h4>
<p><strong>lisenokdonbassenok</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="571087404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571087404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571087404">(Jan 30 2026 at 17:33)</a>:</h4>
<p>pchickey unassigned pchickey from <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480 fix: ensure EntitySet::insert reserves correct capacity</a>.</p>



<a name="571087406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571087406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571087406">(Jan 30 2026 at 17:33)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="571112658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571112658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571112658">(Jan 30 2026 at 19:51)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12480#issuecomment-3825449600">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>:</p>
<blockquote>
<p>Thanks! Could you add a test for this in <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/fuzzing/tests/oom.rs">this file</a>? Ideally that'd be verified to fail before this PR but then pass after this PR</p>
</blockquote>



<a name="571291954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571291954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571291954">(Feb 01 2026 at 14:46)</a>:</h4>
<p><strong>lisenokdonbassenok</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="571291955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571291955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571291955">(Feb 01 2026 at 14:46)</a>:</h4>
<p>lisenokdonbassenok updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="571291967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571291967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571291967">(Feb 01 2026 at 14:46)</a>:</h4>
<p>lisenokdonbassenok <a href="https://github.com/bytecodealliance/wasmtime/pull/12480#issuecomment-3831147729">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>:</p>
<blockquote>
<blockquote>
<p>Thanks! Could you add a test for this in <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/fuzzing/tests/oom.rs">this file</a>? Ideally that'd be verified to fail before this PR but then pass after this PR</p>
</blockquote>
<p>Added test</p>
</blockquote>



<a name="571296411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571296411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571296411">(Feb 01 2026 at 15:48)</a>:</h4>
<p>github-actions[bot] added the label <code>fuzzing</code> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="571296438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571296438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571296438">(Feb 01 2026 at 15:49)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/12480#issuecomment-3831258162">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="571344980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571344980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571344980">(Feb 02 2026 at 04:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12480#pullrequestreview-3737249542">PR review</a>.</p>



<a name="571344988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571344988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571344988">(Feb 02 2026 at 04:27)</a>:</h4>
<p>alexcrichton added <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480 fix: ensure EntitySet::insert reserves correct capacity</a> to the merge queue.</p>



<a name="571347020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571347020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571347020">(Feb 02 2026 at 04:50)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>.</p>



<a name="571347022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571347022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571347022">(Feb 02 2026 at 04:50)</a>:</h4>
<p>alexcrichton removed <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480 fix: ensure EntitySet::insert reserves correct capacity</a> from the merge queue.</p>



<a name="571497955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312480%20fix%3A%20ensure%20EntitySet%3A%3Ainsert%20reserv.../near/571497955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312480.20fix.3A.20ensure.20EntitySet.3A.3Ainsert.20reserv.2E.2E.2E.html#571497955">(Feb 02 2026 at 18:17)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12480#issuecomment-3836885536">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12480">PR #12480</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>