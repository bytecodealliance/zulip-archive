<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11427 Huge array allocations are timing... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311427.20Huge.20array.20allocations.20are.20timing.2E.2E.2E.html">wasmtime / issue #11427 Huge array allocations are timing...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="534272831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311427%20Huge%20array%20allocations%20are%20timing.../near/534272831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311427.20Huge.20array.20allocations.20are.20timing.2E.2E.2E.html#534272831">(Aug 13 2025 at 17:22)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11427">issue #11427</a>:</p>
<blockquote>
<p>There's a <a href="https://oss-fuzz.com/testcase-detail/5285141607153664">timeout on oss-fuzz right now</a> in the <code>differential</code> fuzzer. Debugging this it looks like huge arrays are being allocated in wasm and limits aren't kicking into effect. I've verified that the memory limits aren't being exceeded as all allocations fall under our 1G limit for stores. </p>
<p>What appears to be happening is that Cranelift-generated wasm code is taking quite a long time to initialize the array in question. This is under Pulley which is also a slowdown hit too. Differential fuzzing relies on in-wasm fuel counters to ensure execution doesn't take too long and those counters aren't taking into account these "expensive" instructions.</p>
<p>There's a few things I've noticed here and some ideas for solving this:</p>
<ul>
<li>Compiled code for <code>array.new_default</code> has a loop which doesn't contain fuel/epoch checks. That will help in the general case but won't help here because while fuel is enabled for this fuzz test case it's given infinite fuel and relies on in-wasm fuel instead.</li>
<li>Wasm-smith could in theory decrement the size of <code>array.new_default</code> from the in-wasm fuel counter before executing <code>array.new_default</code>, but it doesn't currently.</li>
<li>Host-side allocations of large arrays don't have any await/fuel/epoch checks meaning that large allocations take take a significant chunk of time.</li>
</ul>
</blockquote>



<a name="534272833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311427%20Huge%20array%20allocations%20are%20timing.../near/534272833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311427.20Huge.20array.20allocations.20are.20timing.2E.2E.2E.html#534272833">(Aug 13 2025 at 17:22)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11427">Issue #11427</a>.</p>



<a name="534272836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311427%20Huge%20array%20allocations%20are%20timing.../near/534272836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311427.20Huge.20array.20allocations.20are.20timing.2E.2E.2E.html#534272836">(Aug 13 2025 at 17:22)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:gc label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11427">Issue #11427</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>