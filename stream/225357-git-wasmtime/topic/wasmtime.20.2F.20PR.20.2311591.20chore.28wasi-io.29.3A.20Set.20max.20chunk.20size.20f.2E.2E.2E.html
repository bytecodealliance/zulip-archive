<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11591 chore(wasi-io): Set max chunk size f... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311591.20chore.28wasi-io.29.3A.20Set.20max.20chunk.20size.20f.2E.2E.2E.html">wasmtime / PR #11591 chore(wasi-io): Set max chunk size f...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537347919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311591%20chore%28wasi-io%29%3A%20Set%20max%20chunk%20size%20f.../near/537347919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311591.20chore.28wasi-io.29.3A.20Set.20max.20chunk.20size.20f.2E.2E.2E.html#537347919">(Sep 02 2025 at 19:00)</a>:</h4>
<p>ThorstenHans opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11591">PR #11591</a> from <code>ThorstenHans:chore/wasio-streaming-chunksize</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>While moving vast amounts of data using <code>wasi:io</code> streams, we found the existing max chunk size of 4KB adding a lot of overhead. To reduce the number of chunks that one must create, this PR changes the max chunk size from 4KB to 64KB for all blocking write operations.</p>
<p>Here a simple table outlining how many chunks are required based on max chunk size being either 4KB or 64KB:</p>
<table>
<thead>
<tr>
<th>File Size</th>
<th>No. of Chunks (4 KB)</th>
<th>No. of Chunks (64 KB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>16 KB</td>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>100 KB</td>
<td>25</td>
<td>2</td>
</tr>
<tr>
<td>1 MB</td>
<td>256</td>
<td>16</td>
</tr>
<tr>
<td>10 MB</td>
<td>2,560</td>
<td>160</td>
</tr>
<tr>
<td>100 MB</td>
<td>25,600</td>
<td>1,600</td>
</tr>
<tr>
<td>1 GB</td>
<td>262,144</td>
<td>16,384</td>
</tr>
<tr>
<td>10 GB</td>
<td>2,621,440</td>
<td>163,840</td>
</tr>
<tr>
<td>100 GB</td>
<td>26,214,400</td>
<td>1,638,400</td>
</tr>
</tbody>
</table>
<p>I'll leave this in a draft state for now and will collect additional data on performance improvements<br>
</p>
</blockquote>



<a name="537372444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311591%20chore%28wasi-io%29%3A%20Set%20max%20chunk%20size%20f.../near/537372444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311591.20chore.28wasi-io.29.3A.20Set.20max.20chunk.20size.20f.2E.2E.2E.html#537372444">(Sep 02 2025 at 22:20)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/11591#issuecomment-3246971617">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11591">PR #11591</a>:</p>
<blockquote>
<p>The <code>blocking-write-and-flush</code> chunk size is specified in the wasi-io spec, not in wasmtime, so we actually can't make this change without a breaking change to Wasi, which won't happen at this point because streams are completely redone as part of the component model as part of Wasi 0.3.</p>
<p>Basically, <code>blocking-write-and-flush</code> is a convenience method that exists primarily to make sure its always possible to write a debug message without getting any sort of protocol right. Its not meant to be the fast path. Instead, you should use <code>check-write</code>, <code>write</code>, and polling on a <code>pollable</code> in order to get the maximum performance out of an <code>output-stream</code>. So, please check if you can start using a larger chunk size when switching to that part of the interface. We have a lot more flexibility with how those methods are implemented.</p>
</blockquote>



<a name="537469119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311591%20chore%28wasi-io%29%3A%20Set%20max%20chunk%20size%20f.../near/537469119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311591.20chore.28wasi-io.29.3A.20Set.20max.20chunk.20size.20f.2E.2E.2E.html#537469119">(Sep 03 2025 at 12:51)</a>:</h4>
<p>ThorstenHans <a href="https://github.com/bytecodealliance/wasmtime/pull/11591#issuecomment-3249124648">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11591">PR #11591</a>:</p>
<blockquote>
<p>@pchickey thanks for the feedback. </p>
<p>the blocking apis are actually used in a 3rd party dependency on the guest side. I'll reach out to one of the maintainers to discuss and suggest the change you mentioned.</p>
<p>Q: You mentioned the chunk size being "specified" in the wasi-io spec, I can only find <code>4096</code> being referenced in comments: <a href="https://github.com/WebAssembly/wasi-io/blob/73222408bd3de90c8a9144c9ece02bb606c834f6/wit/streams.wit#L154">https://github.com/WebAssembly/wasi-io/blob/73222408bd3de90c8a9144c9ece02bb606c834f6/wit/streams.wit#L154</a> </p>
<p>Any other places you can point me to? </p>
</blockquote>



<a name="537508902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311591%20chore%28wasi-io%29%3A%20Set%20max%20chunk%20size%20f.../near/537508902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311591.20chore.28wasi-io.29.3A.20Set.20max.20chunk.20size.20f.2E.2E.2E.html#537508902">(Sep 03 2025 at 16:01)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/11591#issuecomment-3249858858">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11591">PR #11591</a>:</p>
<blockquote>
<p>The comments are the spec, yes.</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>