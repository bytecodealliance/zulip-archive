<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12092 Cannot restart read of host-produ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312092.20Cannot.20restart.20read.20of.20host-produ.2E.2E.2E.html">wasmtime / issue #12092 Cannot restart read of host-produ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="560309769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312092%20Cannot%20restart%20read%20of%20host-produ.../near/560309769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312092.20Cannot.20restart.20read.20of.20host-produ.2E.2E.2E.html#560309769">(Nov 26 2025 at 05:52)</a>:</h4>
<p>alexcrichton assigned dicej to <a href="https://github.com/bytecodealliance/wasmtime/issues/12092">issue #12092</a>.</p>



<a name="560309770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312092%20Cannot%20restart%20read%20of%20host-produ.../near/560309770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312092.20Cannot.20restart.20read.20of.20host-produ.2E.2E.2E.html#560309770">(Nov 26 2025 at 05:52)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12092">issue #12092</a>:</p>
<blockquote>
<p>Applying this diff:</p>
<p>&lt;details&gt;</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/tests/all/component_model/async.rs b/tests/all/component_model/async.rs</span>
<span class="gh">index b3e816c758..b1e3bf8d55 100644</span>
<span class="gd">--- a/tests/all/component_model/async.rs</span>
<span class="gi">+++ b/tests/all/component_model/async.rs</span>
<span class="gu">@@ -1,5 +1,7 @@</span>
<span class="w"> </span>use crate::async_functions::{PollOnce, execute_across_threads};
<span class="w"> </span>use anyhow::Result;
<span class="gi">+use std::pin::Pin;</span>
<span class="gi">+use std::task::{Context, Poll};</span>
<span class="w"> </span>use wasmtime::{AsContextMut, Config, component::*};
<span class="w"> </span>use wasmtime::{Engine, Store, StoreContextMut, Trap};
<span class="w"> </span>use wasmtime_component_util::REALLOC_AND_FREE;
<span class="gu">@@ -670,3 +672,98 @@ async fn task_deletion() -&gt; Result&lt;()&gt; {</span>

<span class="w"> </span>    Ok(())
<span class="w"> </span>}
<span class="gi">+</span>
<span class="gi">+#[tokio::test]</span>
<span class="gi">+#[cfg_attr(miri, ignore)]</span>
<span class="gi">+async fn cancel_host_future() -&gt; Result&lt;()&gt; {</span>
<span class="gi">+    let mut config = Config::new();</span>
<span class="gi">+    config.async_support(true);</span>
<span class="gi">+    config.wasm_component_model_async(true);</span>
<span class="gi">+    let engine = Engine::new(&amp;config)?;</span>
<span class="gi">+</span>
<span class="gi">+    let component = Component::new(</span>
<span class="gi">+        &amp;engine,</span>
<span class="gi">+        r#"</span>
<span class="gi">+(component</span>
<span class="gi">+  (core module $libc (memory (export "memory") 1))</span>
<span class="gi">+  (core instance $libc (instantiate $libc))</span>
<span class="gi">+  (core module $m</span>
<span class="gi">+    (import "" "future.read" (func $future.read (param i32 i32) (result i32)))</span>
<span class="gi">+    (import "" "future.cancel-read" (func $future.cancel-read (param i32) (result i32)))</span>
<span class="gi">+    (memory (export "memory") 1)</span>
<span class="gi">+</span>
<span class="gi">+    (func (export "run") (param i32)</span>
<span class="gi">+      ;; read/cancel attempt 1</span>
<span class="gi">+      (call $future.read (local.get 0) (i32.const 100))</span>
<span class="gi">+      i32.const -1 ;; BLOCKED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+</span>
<span class="gi">+      (call $future.cancel-read (local.get 0))</span>
<span class="gi">+      i32.const 2 ;; CANCELLED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+</span>
<span class="gi">+      ;; read/cancel attempt 2</span>
<span class="gi">+      (call $future.read (local.get 0) (i32.const 100))</span>
<span class="gi">+      i32.const -1 ;; BLOCKED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+</span>
<span class="gi">+      (call $future.cancel-read (local.get 0))</span>
<span class="gi">+      i32.const 2 ;; CANCELLED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+    )</span>
<span class="gi">+  )</span>
<span class="gi">+</span>
<span class="gi">+  (type $f (future u32))</span>
<span class="gi">+  (core func $future.read (canon future.read $f async (memory $libc "memory")))</span>
<span class="gi">+  (core func $future.cancel-read (canon future.cancel-read $f))</span>
<span class="gi">+</span>
<span class="gi">+  (core instance $i (instantiate $m</span>
<span class="gi">+    (with "" (instance</span>
<span class="gi">+      (export "future.read" (func $future.read))</span>
<span class="gi">+      (export "future.cancel-read" (func $future.cancel-read))</span>
<span class="gi">+    ))</span>
<span class="gi">+  ))</span>
<span class="gi">+</span>
<span class="gi">+  (func (export "run") (param "f" $f)</span>
<span class="gi">+    (canon lift</span>
<span class="gi">+      (core func $i "run")</span>
<span class="gi">+      (memory $libc "memory")</span>
<span class="gi">+    )</span>
<span class="gi">+  )</span>
<span class="gi">+)</span>
<span class="gi">+        "#,</span>
<span class="gi">+    )?;</span>
<span class="gi">+</span>
<span class="gi">+    let mut store = Store::new(&amp;engine, ());</span>
<span class="gi">+    let instance = Linker::new(&amp;engine)</span>
<span class="gi">+        .instantiate_async(&amp;mut store, &amp;component)</span>
<span class="gi">+        .await?;</span>
<span class="gi">+    let func = instance.get_typed_func::&lt;(FutureReader&lt;u32&gt;,), ()&gt;(&amp;mut store, "run")?;</span>
<span class="gi">+    let reader = FutureReader::new(&amp;mut store, MyFutureReader);</span>
<span class="gi">+    func.call_async(&amp;mut store, (reader,)).await?;</span>
<span class="gi">+</span>
<span class="gi">+    return Ok(());</span>
<span class="gi">+</span>
<span class="gi">+    struct MyFutureReader;</span>
<span class="gi">+</span>
<span class="gi">+    impl FutureProducer&lt;()&gt; for MyFutureReader {</span>
<span class="gi">+        type Item = u32;</span>
<span class="gi">+</span>
<span class="gi">+        fn poll_produce(</span>
<span class="gi">+            self: Pin&lt;&amp;mut Self&gt;,</span>
<span class="gi">+            _cx: &amp;mut Context&lt;'_&gt;,</span>
<span class="gi">+            _store: StoreContextMut&lt;()&gt;,</span>
<span class="gi">+            finish: bool,</span>
<span class="gi">+        ) -&gt; Poll&lt;Result&lt;Option&lt;Self::Item&gt;&gt;&gt; {</span>
<span class="gi">+            if finish {</span>
<span class="gi">+                Poll::Ready(Ok(None))</span>
<span class="gi">+            } else {</span>
<span class="gi">+                Poll::Pending</span>
<span class="gi">+            }</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>currently fails with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="n">test</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">cancel_host_future</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">test</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.10</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">all</span><span class="o">-</span><span class="n">e79d98f84418a5e1</span><span class="p">)</span>

<span class="n">running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">test</span>
<span class="n">test</span><span class="w"> </span><span class="n">component_model</span><span class="p">::</span><span class="n">r</span><span class="p">#</span><span class="k">async</span><span class="p">::</span><span class="n">cancel_host_future</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span><span class="w"> </span><span class="n">component_model</span><span class="p">::</span><span class="n">r</span><span class="p">#</span><span class="k">async</span><span class="p">::</span><span class="n">cancel_host_future</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w">     </span><span class="mh">0xba</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m</span><span class="o">!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">cannot</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">succeeded</span>


<span class="n">failures</span><span class="p">:</span>
<span class="w">    </span><span class="nc">component_model</span><span class="p">::</span><span class="n">r</span><span class="p">#</span><span class="k">async</span><span class="p">::</span><span class="n">cancel_host_future</span>

<span class="n">test</span><span class="w"> </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="nc">FAILED</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">passed</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">failed</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ignored</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">measured</span><span class="p">;</span><span class="w"> </span><span class="mi">982</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"> </span><span class="n">finished</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.01</span><span class="n">s</span>

<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">test</span><span class="w"> </span><span class="n">failed</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">rerun</span><span class="w"> </span><span class="n">pass</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">test</span><span class="w"> </span><span class="n">all</span><span class="err">`</span>
</code></pre></div>
<p>where the second <code>future.read</code> call is what's failing here</p>
</blockquote>



<a name="560309772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312092%20Cannot%20restart%20read%20of%20host-produ.../near/560309772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312092.20Cannot.20restart.20read.20of.20host-produ.2E.2E.2E.html#560309772">(Nov 26 2025 at 05:52)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:component-model-async label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12092">Issue #12092</a>.</p>



<a name="560309776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312092%20Cannot%20restart%20read%20of%20host-produ.../near/560309776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312092.20Cannot.20restart.20read.20of.20host-produ.2E.2E.2E.html#560309776">(Nov 26 2025 at 05:52)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12092">Issue #12092</a>.</p>



<a name="560433742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312092%20Cannot%20restart%20read%20of%20host-produ.../near/560433742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312092.20Cannot.20restart.20read.20of.20host-produ.2E.2E.2E.html#560433742">(Nov 26 2025 at 16:34)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12092">issue #12092</a>:</p>
<blockquote>
<p>Applying this diff:</p>
<p>&lt;details&gt;</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/tests/all/component_model/async.rs b/tests/all/component_model/async.rs</span>
<span class="gh">index b3e816c758..b1e3bf8d55 100644</span>
<span class="gd">--- a/tests/all/component_model/async.rs</span>
<span class="gi">+++ b/tests/all/component_model/async.rs</span>
<span class="gu">@@ -1,5 +1,7 @@</span>
<span class="w"> </span>use crate::async_functions::{PollOnce, execute_across_threads};
<span class="w"> </span>use anyhow::Result;
<span class="gi">+use std::pin::Pin;</span>
<span class="gi">+use std::task::{Context, Poll};</span>
<span class="w"> </span>use wasmtime::{AsContextMut, Config, component::*};
<span class="w"> </span>use wasmtime::{Engine, Store, StoreContextMut, Trap};
<span class="w"> </span>use wasmtime_component_util::REALLOC_AND_FREE;
<span class="gu">@@ -670,3 +672,98 @@ async fn task_deletion() -&gt; Result&lt;()&gt; {</span>

<span class="w"> </span>    Ok(())
<span class="w"> </span>}
<span class="gi">+</span>
<span class="gi">+#[tokio::test]</span>
<span class="gi">+#[cfg_attr(miri, ignore)]</span>
<span class="gi">+async fn cancel_host_future() -&gt; Result&lt;()&gt; {</span>
<span class="gi">+    let mut config = Config::new();</span>
<span class="gi">+    config.async_support(true);</span>
<span class="gi">+    config.wasm_component_model_async(true);</span>
<span class="gi">+    let engine = Engine::new(&amp;config)?;</span>
<span class="gi">+</span>
<span class="gi">+    let component = Component::new(</span>
<span class="gi">+        &amp;engine,</span>
<span class="gi">+        r#"</span>
<span class="gi">+(component</span>
<span class="gi">+  (core module $libc (memory (export "memory") 1))</span>
<span class="gi">+  (core instance $libc (instantiate $libc))</span>
<span class="gi">+  (core module $m</span>
<span class="gi">+    (import "" "future.read" (func $future.read (param i32 i32) (result i32)))</span>
<span class="gi">+    (import "" "future.cancel-read" (func $future.cancel-read (param i32) (result i32)))</span>
<span class="gi">+    (memory (export "memory") 1)</span>
<span class="gi">+</span>
<span class="gi">+    (func (export "run") (param i32)</span>
<span class="gi">+      ;; read/cancel attempt 1</span>
<span class="gi">+      (call $future.read (local.get 0) (i32.const 100))</span>
<span class="gi">+      i32.const -1 ;; BLOCKED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+</span>
<span class="gi">+      (call $future.cancel-read (local.get 0))</span>
<span class="gi">+      i32.const 2 ;; CANCELLED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+</span>
<span class="gi">+      ;; read/cancel attempt 2</span>
<span class="gi">+      (call $future.read (local.get 0) (i32.const 100))</span>
<span class="gi">+      i32.const -1 ;; BLOCKED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+</span>
<span class="gi">+      (call $future.cancel-read (local.get 0))</span>
<span class="gi">+      i32.const 2 ;; CANCELLED</span>
<span class="gi">+      i32.ne</span>
<span class="gi">+      if unreachable end</span>
<span class="gi">+    )</span>
<span class="gi">+  )</span>
<span class="gi">+</span>
<span class="gi">+  (type $f (future u32))</span>
<span class="gi">+  (core func $future.read (canon future.read $f async (memory $libc "memory")))</span>
<span class="gi">+  (core func $future.cancel-read (canon future.cancel-read $f))</span>
<span class="gi">+</span>
<span class="gi">+  (core instance $i (instantiate $m</span>
<span class="gi">+    (with "" (instance</span>
<span class="gi">+      (export "future.read" (func $future.read))</span>
<span class="gi">+      (export "future.cancel-read" (func $future.cancel-read))</span>
<span class="gi">+    ))</span>
<span class="gi">+  ))</span>
<span class="gi">+</span>
<span class="gi">+  (func (export "run") (param "f" $f)</span>
<span class="gi">+    (canon lift</span>
<span class="gi">+      (core func $i "run")</span>
<span class="gi">+      (memory $libc "memory")</span>
<span class="gi">+    )</span>
<span class="gi">+  )</span>
<span class="gi">+)</span>
<span class="gi">+        "#,</span>
<span class="gi">+    )?;</span>
<span class="gi">+</span>
<span class="gi">+    let mut store = Store::new(&amp;engine, ());</span>
<span class="gi">+    let instance = Linker::new(&amp;engine)</span>
<span class="gi">+        .instantiate_async(&amp;mut store, &amp;component)</span>
<span class="gi">+        .await?;</span>
<span class="gi">+    let func = instance.get_typed_func::&lt;(FutureReader&lt;u32&gt;,), ()&gt;(&amp;mut store, "run")?;</span>
<span class="gi">+    let reader = FutureReader::new(&amp;mut store, MyFutureReader);</span>
<span class="gi">+    func.call_async(&amp;mut store, (reader,)).await?;</span>
<span class="gi">+</span>
<span class="gi">+    return Ok(());</span>
<span class="gi">+</span>
<span class="gi">+    struct MyFutureReader;</span>
<span class="gi">+</span>
<span class="gi">+    impl FutureProducer&lt;()&gt; for MyFutureReader {</span>
<span class="gi">+        type Item = u32;</span>
<span class="gi">+</span>
<span class="gi">+        fn poll_produce(</span>
<span class="gi">+            self: Pin&lt;&amp;mut Self&gt;,</span>
<span class="gi">+            _cx: &amp;mut Context&lt;'_&gt;,</span>
<span class="gi">+            _store: StoreContextMut&lt;()&gt;,</span>
<span class="gi">+            finish: bool,</span>
<span class="gi">+        ) -&gt; Poll&lt;Result&lt;Option&lt;Self::Item&gt;&gt;&gt; {</span>
<span class="gi">+            if finish {</span>
<span class="gi">+                Poll::Ready(Ok(None))</span>
<span class="gi">+            } else {</span>
<span class="gi">+                Poll::Pending</span>
<span class="gi">+            }</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>currently fails with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="n">test</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">cancel_host_future</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">test</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.10</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">all</span><span class="o">-</span><span class="n">e79d98f84418a5e1</span><span class="p">)</span>

<span class="n">running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">test</span>
<span class="n">test</span><span class="w"> </span><span class="n">component_model</span><span class="p">::</span><span class="n">r</span><span class="p">#</span><span class="k">async</span><span class="p">::</span><span class="n">cancel_host_future</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span><span class="w"> </span><span class="n">component_model</span><span class="p">::</span><span class="n">r</span><span class="p">#</span><span class="k">async</span><span class="p">::</span><span class="n">cancel_host_future</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w">     </span><span class="mh">0xba</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m</span><span class="o">!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">cannot</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">succeeded</span>


<span class="n">failures</span><span class="p">:</span>
<span class="w">    </span><span class="nc">component_model</span><span class="p">::</span><span class="n">r</span><span class="p">#</span><span class="k">async</span><span class="p">::</span><span class="n">cancel_host_future</span>

<span class="n">test</span><span class="w"> </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="nc">FAILED</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">passed</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">failed</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ignored</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">measured</span><span class="p">;</span><span class="w"> </span><span class="mi">982</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"> </span><span class="n">finished</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.01</span><span class="n">s</span>

<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">test</span><span class="w"> </span><span class="n">failed</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">rerun</span><span class="w"> </span><span class="n">pass</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">test</span><span class="w"> </span><span class="n">all</span><span class="err">`</span>
</code></pre></div>
<p>where the second <code>future.read</code> call is what's failing here</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>