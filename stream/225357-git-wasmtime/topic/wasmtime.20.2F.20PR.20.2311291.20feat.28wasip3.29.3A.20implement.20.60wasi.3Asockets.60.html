<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11291 feat(wasip3): implement `wasi:sockets` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html">wasmtime / PR #11291 feat(wasip3): implement `wasi:sockets`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="529942354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529942354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529942354">(Jul 21 2025 at 18:08)</a>:</h4>
<p>rvolosatovs opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a> from <code>rvolosatovs:feat/wasip3-sockets</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Implement <code>wasip3</code> <code>wasi:sockets</code>.</p>
<p>I've refactored <code>FutureWriter::write</code> a little bit to allow for non-blocking send</p>
<p>Refs <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/228">https://github.com/bytecodealliance/wasip3-prototyping/issues/228</a><br>
Closes <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/226">https://github.com/bytecodealliance/wasip3-prototyping/issues/226</a> (not the addition of yield from the guest)</p>
</blockquote>



<a name="529943013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529943013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529943013">(Jul 21 2025 at 18:12)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>:</p>
<blockquote>
<p>Implement <code>wasip3</code> <code>wasi:sockets</code>.</p>
<p>I've refactored <code>FutureWriter::write</code> a little bit to allow for non-blocking send</p>
<p>Refs <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/228">https://github.com/bytecodealliance/wasip3-prototyping/issues/228</a><br>
Closes <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/226">https://github.com/bytecodealliance/wasip3-prototyping/issues/226</a> (not the addition of yield from the guest)<br>
I was not able to reproduce <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/44">https://github.com/bytecodealliance/wasip3-prototyping/issues/44</a> with:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="k">while</span><span class="w"> </span>cargo<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--features<span class="w"> </span>p3<span class="w"> </span>p3_sockets_udp_sample_application<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>:<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<p>on MacOS</p>
</blockquote>



<a name="529943104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529943104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529943104">(Jul 21 2025 at 18:13)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="529943382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529943382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529943382">(Jul 21 2025 at 18:15)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>:</p>
<blockquote>
<p>Implement <code>wasip3</code> <code>wasi:sockets</code>.</p>
<p>I've refactored <code>FutureWriter::write</code> a little bit to allow for non-blocking send</p>
<p>Refs <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/228">https://github.com/bytecodealliance/wasip3-prototyping/issues/228</a><br>
Closes <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/226">https://github.com/bytecodealliance/wasip3-prototyping/issues/226</a> (note the addition of yield from the guest)<br>
I was not able to reproduce <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/44">https://github.com/bytecodealliance/wasip3-prototyping/issues/44</a> with:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="k">while</span><span class="w"> </span>cargo<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--features<span class="w"> </span>p3<span class="w"> </span>p3_sockets_udp_sample_application<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>:<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<p>on MacOS</p>
</blockquote>



<a name="529954951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529954951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529954951">(Jul 21 2025 at 19:39)</a>:</h4>
<p><strong>rvolosatovs</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a> as ready for review.</p>



<a name="529954954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529954954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529954954">(Jul 21 2025 at 19:39)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="529954956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529954956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529954956">(Jul 21 2025 at 19:39)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/dicej">dicej</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="529954957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529954957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529954957">(Jul 21 2025 at 19:39)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="529954958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/529954958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#529954958">(Jul 21 2025 at 19:39)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="530167429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530167429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530167429">(Jul 22 2025 at 15:08)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#issuecomment-3103270170">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>:</p>
<blockquote>
<p>FYI: I'm currently working on reusing most of the socket utilities across p2 and p3 to avoid duplication</p>
</blockquote>



<a name="530221529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530221529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530221529">(Jul 22 2025 at 20:57)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="530221746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530221746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530221746">(Jul 22 2025 at 20:58)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="530224224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530224224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530224224">(Jul 22 2025 at 21:17)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="530231984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231984">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3044950884">PR review</a>.</p>



<a name="530231985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231985">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223883705">PR review comment</a>:</p>
<blockquote>
<p>Could you detail a bit more the rationale for this change? The PR description mentions a non-blocking send but I don't fully grok that. In the context of <a href="https://github.com/bytecodealliance/wasip3-prototyping/pull/240">https://github.com/bytecodealliance/wasip3-prototyping/pull/240</a> this method is going to change more so if precise control over sending messages is needed that may be a red flag of something we'll need to change at the call-site rather than here</p>
</blockquote>



<a name="530231986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231986">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223888787">PR review comment</a>:</p>
<blockquote>
<p>I think this'll want some extra handling, namely:</p>
<ul>
<li>If <code>Some(...)</code> is returned, that means the other side went away, so the loop can be exited immediately here.</li>
<li>If <code>Some(...)</code> is returned then the resource table needs to be updated here to take out what was previously pushed in</li>
</ul>
</blockquote>



<a name="530231987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231987">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223879541">PR review comment</a>:</p>
<blockquote>
<p>This may be a preexisting bug in the p2 implementation, but I'm under the impression that the equivalent of <code>write_all</code> for UDP is inappropriate. I'd expect this to return an error if the entire buffer wasn't sent personally, but I'm also not sure the context these are used within.</p>
</blockquote>



<a name="530231988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231988">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223894491">PR review comment</a>:</p>
<blockquote>
<p>Could this be wrapped up in something like <code>Arc&lt;NonInheritedOptions&gt;</code> or something like that? That'll help cut down on the <code>Arc</code>-traffic and additionally enable scoping handling of this to a separate file and/or abstraction. Ideally it'd also be shared with the p2 implementation if possible which I suspect has very similar #[cfg].</p>
</blockquote>



<a name="530231989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231989">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223896011">PR review comment</a>:</p>
<blockquote>
<p>I think this buf is intended to be outside of the <code>loop</code>?</p>
</blockquote>



<a name="530231990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231990">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223892464">PR review comment</a>:</p>
<blockquote>
<p>In the future we may have to watch out for this as <code>watch_reader</code> is a pretty expensive operation right now and each iteration of the loop unconditionally sets this up. The changes at <a href="https://github.com/bytecodealliance/wasip3-prototyping/pull/240">https://github.com/bytecodealliance/wasip3-prototyping/pull/240</a> may help though.</p>
</blockquote>



<a name="530231991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231991">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223923460">PR review comment</a>:</p>
<blockquote>
<p>Should this be using <code>Receiving</code> instead of <code>Closed</code>? As-is it looks like you can send-then-receive but you can't receive-then-send.</p>
</blockquote>



<a name="530231992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231992">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223899184">PR review comment</a>:</p>
<blockquote>
<p>All of the <code>break</code>s in this loop are write-then-break, so could this be refactored as break-with-value followed by just one write?</p>
</blockquote>



<a name="530231993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231993">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223902978">PR review comment</a>:</p>
<blockquote>
<p>This branch I think could be replaced with a <code>?</code> on the <code>with</code> block.</p>
</blockquote>



<a name="530231994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231994">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223901764">PR review comment</a>:</p>
<blockquote>
<p>One thing we may want to keep an eye out for in the future is some sort of fast path here to avoid the <code>Arc::clone</code> in the typical case.</p>
</blockquote>



<a name="530231995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231995">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223917986">PR review comment</a>:</p>
<blockquote>
<p>It might be worth leaving a <code>FIXME</code> here along the lines of handling cancellation. Here we'll ideally want to hook into the drop of the outer future and put the socket back in the store or something like that.</p>
</blockquote>



<a name="530231996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530231996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530231996">(Jul 22 2025 at 22:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2223897329">PR review comment</a>:</p>
<blockquote>
<p>Also, mind extracting this constant to a <code>const</code> at the top of the file (or something like that) to reference?</p>
</blockquote>



<a name="530266461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530266461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530266461">(Jul 23 2025 at 05:51)</a>:</h4>
<p>badeend submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3045728308">PR review</a>.</p>



<a name="530266462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530266462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530266462">(Jul 23 2025 at 05:51)</a>:</h4>
<p>badeend created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2224441844">PR review comment</a>:</p>
<blockquote>
<p>Nice catch. This is indeed not correct for UDP.</p>
<p>The <a href="https://github.com/bytecodealliance/wasmtime/blob/0e6d9c679f5df5cf712357f147088bbce0c61fe9/crates/wasi/src/p2/host/udp.rs#L454-L458">P2 implementation</a> simply ignores the return value.</p>
<p>I'd have to refresh my mind on this, but I recall that UDP either: returns successfully with input buffer size or fails with EMSGSIZE. Could be wrong.</p>
</blockquote>



<a name="530266951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530266951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530266951">(Jul 23 2025 at 05:57)</a>:</h4>
<p>badeend edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2224441844">PR review comment</a>.</p>



<a name="530267634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530267634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530267634">(Jul 23 2025 at 06:04)</a>:</h4>
<p>badeend edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2224441844">PR review comment</a>.</p>



<a name="530301812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530301812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530301812">(Jul 23 2025 at 09:36)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2224981507">PR review comment</a>:</p>
<blockquote>
<p>Currently, calling <code>FutureWriter::write</code> without awaiting the returned future does nothing. This patch makes it so that once <code>Future::write</code> returns it is guaranteed that a value is <em>written</em> akin to <a href="https://docs.rs/tokio/latest/tokio/sync/oneshot/struct.Sender.html#method.send">https://docs.rs/tokio/latest/tokio/sync/oneshot/struct.Sender.html#method.send</a>, which is used internally. <em>async</em> is only used then to await the <em>receipt</em> of the value.</p>
<p>From the WASI implementation perspective this means that we now can write future values without an <code>async</code> context, meaning, for example, that we don't need to spawn a task just to send a static value like was done e.g. here: <a href="https://github.com/bytecodealliance/wasip3-prototyping/blob/9c837320498adb1f4bda9ad7bbb12769fcdd08b5/crates/wasi/src/p3/sockets/host/types/tcp.rs#L482-L487">https://github.com/bytecodealliance/wasip3-prototyping/blob/9c837320498adb1f4bda9ad7bbb12769fcdd08b5/crates/wasi/src/p3/sockets/host/types/tcp.rs#L482-L487</a></p>
</blockquote>



<a name="530301815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530301815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530301815">(Jul 23 2025 at 09:36)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3046523613">PR review</a>.</p>



<a name="530303236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530303236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530303236">(Jul 23 2025 at 09:42)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2224995603">PR review comment</a>:</p>
<blockquote>
<p><code>Closed</code> is normally used throughout the codebase as a marker to emulate a <em>take</em> operation, the resulting state is never <code>Closed</code>, it's either changed (to receiving) or rolled back, if it was not <em>connected</em></p>
</blockquote>



<a name="530303237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530303237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530303237">(Jul 23 2025 at 09:42)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3046542503">PR review</a>.</p>



<a name="530398988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530398988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530398988">(Jul 23 2025 at 17:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3048389114">PR review</a>.</p>



<a name="530398989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530398989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530398989">(Jul 23 2025 at 17:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2226227504">PR review comment</a>:</p>
<blockquote>
<p>I think it'd be reasonable to check the return value to double-check it matches the message size on success and synthesizing our trap (or error) on failure.</p>
</blockquote>



<a name="530399666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530399666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530399666">(Jul 23 2025 at 17:32)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3048398961">PR review</a>.</p>



<a name="530399667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530399667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530399667">(Jul 23 2025 at 17:32)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2226234623">PR review comment</a>:</p>
<blockquote>
<p>If possible I'd prefer to avoid this change and perhaps add a new method for this. I'm worried about conflating the guarantees/semantics of Rust-level <code>async</code> with the semantics desired here. For example this seems like it would encourage calling <code>write</code> and dropping the returned future while still having a guarantee that the item was sent. That the item is sent in this situation is, in my opinion, a bug. Dropping a future should cancel whatever that future's computation is so in my mind the semantics of this function is that you're never guaranteed that the value is sent until the future is <code>.await</code>-ed.</p>
<p>I think it's reasonable though to shoot for an ideal of being able to send a value without having to full wait for its receipt. For this an extra host-level function I think would be appropriate. Even that though I think would be best to wait for the refactoring above.</p>
<p>In the interm would you be ok to back out this change and spawn tasks if necessary?</p>
</blockquote>



<a name="530399956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530399956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530399956">(Jul 23 2025 at 17:34)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3048403859">PR review</a>.</p>



<a name="530399957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/530399957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#530399957">(Jul 23 2025 at 17:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2226237589">PR review comment</a>:</p>
<blockquote>
<p>Oh sorry I somehow missed the <code>*tcp_state = ..</code> below. The take/replace pattern seems reasonable to me but I just missed that (not sure how I did...)</p>
</blockquote>



<a name="531530843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531530843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531530843">(Jul 29 2025 at 07:14)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531536283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531536283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531536283">(Jul 29 2025 at 07:42)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531539317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531539317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531539317">(Jul 29 2025 at 07:57)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3066069257">PR review</a>.</p>



<a name="531539319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531539319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531539319">(Jul 29 2025 at 07:57)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2238885195">PR review comment</a>:</p>
<blockquote>
<p>I've updated the p3 implementation.</p>
<p>I do want to point out that on Windows at most <code>i32::MAX</code> bytes will be written <a href="https://github.com/rust-lang/rust/blob/cb6785f73df1aa3f558796a22a4ab9652cf38e26/library/std/src/sys/net/connection/socket.rs#L806">https://github.com/rust-lang/rust/blob/cb6785f73df1aa3f558796a22a4ab9652cf38e26/library/std/src/sys/net/connection/socket.rs#L806</a> <a href="https://github.com/rust-lang/rust/blob/cb6785f73df1aa3f558796a22a4ab9652cf38e26/library/std/src/sys/net/connection/socket/windows.rs#L19">https://github.com/rust-lang/rust/blob/cb6785f73df1aa3f558796a22a4ab9652cf38e26/library/std/src/sys/net/connection/socket/windows.rs#L19</a></p>
<p>According to the spec, it appears that lists can have up to <code>u32::MAX</code> elements (core Wasm <a href="https://webassembly.github.io/spec/core/binary/conventions.html#binary-vec">https://webassembly.github.io/spec/core/binary/conventions.html#binary-vec</a> and CM <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#container-types">https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#container-types</a>). So it appears that at least on Windows a partial write is theoretically possible, but I'm not sure if it could cause an issue in practice for most use cases</p>
</blockquote>



<a name="531539996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531539996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531539996">(Jul 29 2025 at 08:01)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3066082972">PR review</a>.</p>



<a name="531539999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531539999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531539999">(Jul 29 2025 at 08:01)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2238893151">PR review comment</a>:</p>
<blockquote>
<p>Yes, although that means we need to do more bookkeeping to e.g. ensure that the socket is indeed dropped in the reuseaddr tests (<a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/226">https://github.com/bytecodealliance/wasip3-prototyping/issues/226</a>)</p>
<p>Moving the PR to draft to figure this out.</p>
<p>Perhaps I will just add the additional function to the runtime to support this use case, which can be removed or reworked in #11325 </p>
</blockquote>



<a name="531542001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531542001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531542001">(Jul 29 2025 at 08:11)</a>:</h4>
<p>badeend submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3066126448">PR review</a>.</p>



<a name="531542002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531542002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531542002">(Jul 29 2025 at 08:11)</a>:</h4>
<p>badeend created <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2238919550">PR review comment</a>:</p>
<blockquote>
<p>That shouldn't be an issue for UDP. The <a href="https://github.com/WebAssembly/wasi-sockets/blob/main/wit-0.3.0-draft/types.wit#L605">spec says</a>:</p>
<blockquote>
<p>Implementations may trap if the <code>data</code> length exceeds 64 KiB.</p>
</blockquote>
</blockquote>



<a name="531542349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531542349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531542349">(Jul 29 2025 at 08:13)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531546051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531546051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531546051">(Jul 29 2025 at 08:31)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531555296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531555296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531555296">(Jul 29 2025 at 09:13)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531555455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531555455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531555455">(Jul 29 2025 at 09:13)</a>:</h4>
<p>rvolosatovs deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#discussion_r2238893151">PR review comment</a>.</p>



<a name="531569055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531569055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531569055">(Jul 29 2025 at 10:17)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531706115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531706115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531706115">(Jul 29 2025 at 21:58)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531706127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531706127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531706127">(Jul 29 2025 at 21:58)</a>:</h4>
<p><strong>alexcrichton</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a> as ready for review.</p>



<a name="531709162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531709162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531709162">(Jul 29 2025 at 22:22)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<a name="531716865"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531716865" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531716865">(Jul 29 2025 at 23:35)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3069484257">PR review</a>:</p>
<blockquote>
<p>I had to update the REUSEADDR test a bit more and I'll file a follow-up issue for that, but otherwise this all looks good to me.</p>
</blockquote>



<a name="531717233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531717233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531717233">(Jul 29 2025 at 23:39)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11291#pullrequestreview-3069484257">PR review</a>:</p>
<blockquote>
<p>I had to update the REUSEADDR test a bit more and I'll file a follow-up issue for that (EDIT <a href="https://github.com/bytecodealliance/wasmtime/issues/11342">https://github.com/bytecodealliance/wasmtime/issues/11342</a>), but otherwise this all looks good to me.</p>
</blockquote>



<a name="531719317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311291%20feat%28wasip3%29%3A%20implement%20%60wasi%3Asockets%60/near/531719317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311291.20feat.28wasip3.29.3A.20implement.20.60wasi.3Asockets.60.html#531719317">(Jul 30 2025 at 00:00)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11291">PR #11291</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>