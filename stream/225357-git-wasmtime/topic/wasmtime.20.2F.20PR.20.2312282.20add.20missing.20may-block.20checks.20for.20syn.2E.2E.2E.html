<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12282 add missing may-block checks for syn... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html">wasmtime / PR #12282 add missing may-block checks for syn...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="566846685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566846685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566846685">(Jan 08 2026 at 00:21)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a> from <code>dicej:better-may-block-tracking</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Previously, we weren't updating or checking the may-block status of a task across sync-to-sync, guest-to-guest calls, meaning we were allowing blocking in cases we shouldn't have.</p>
<p>This fixes that by adding a new <code>task_may_block</code> field to <code>VMComponentContext</code>, plus code to update it every time we switch threads or do a sync-to-sync, guest-to-guest call.  We use that field as the source of truth about whether a blocking operation is permitted.</p>
<p>I've updated various tests to match, and Luke has an item on his to-do list to add sad-path coverage for various cases to the upstream <code>component-model</code> test suite.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="566846702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566846702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566846702">(Jan 08 2026 at 00:21)</a>:</h4>
<p><strong>dicej</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a> as ready for review.</p>



<a name="566846705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566846705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566846705">(Jan 08 2026 at 00:21)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="566846706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566846706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566846706">(Jan 08 2026 at 00:21)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="566846707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566846707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566846707">(Jan 08 2026 at 00:21)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="566860868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566860868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566860868">(Jan 08 2026 at 03:29)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="566976088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566976088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566976088">(Jan 08 2026 at 15:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12282#pullrequestreview-3640054025">PR review</a>:</p>
<blockquote>
<p>Test-wise, to confirm, you feel that the upstream spec tests adequately cover this? And/or the test updates that were required here? Or should some dedicated tests be written as well?</p>
</blockquote>



<a name="566976090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566976090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566976090">(Jan 08 2026 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12282#discussion_r2672895493">PR review comment</a>:</p>
<blockquote>
<p>While technically this should work, I think this'll want to be <code>ret.ptr.size_of_vmglobal_definition()</code> because we view this allocation region as a global, right?</p>
</blockquote>



<a name="566976091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566976091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566976091">(Jan 08 2026 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12282#discussion_r2672894150">PR review comment</a>:</p>
<blockquote>
<p>Can you update the comment at the top of the file to  match this pseudo-struct?</p>
</blockquote>



<a name="566976092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/566976092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#566976092">(Jan 08 2026 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12282#discussion_r2672908677">PR review comment</a>:</p>
<blockquote>
<p>The old <code>InstanceFlags</code> structure is pretty unsafe due to retaining a long-lived pointer disconnected from the <code>ComponentInstance</code>, so ideally we wouldn't model this after that if we don't need to. Would it be possible to have safe get/set/as_raw methods on <code>ComponentInstance</code> and avoid having this type entirely?</p>
</blockquote>



<a name="567019122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567019122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567019122">(Jan 08 2026 at 19:41)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="567022621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567022621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567022621">(Jan 08 2026 at 20:02)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="567026755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567026755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567026755">(Jan 08 2026 at 20:26)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="567027984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567027984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567027984">(Jan 08 2026 at 20:34)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="567030724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567030724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567030724">(Jan 08 2026 at 20:50)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="567045136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567045136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567045136">(Jan 08 2026 at 22:40)</a>:</h4>
<p>dicej merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>.</p>



<a name="567169697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567169697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567169697">(Jan 09 2026 at 15:39)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12282#issuecomment-3729435303">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>:</p>
<blockquote>
<blockquote>
<p>Test-wise, to confirm, you feel that the upstream spec tests adequately cover this? And/or the test updates that were required here? Or should some dedicated tests be written as well?</p>
</blockquote>
<p>(Sorry, I forgot to respond to this earlier)</p>
<p>We _do_ need dedicated tests for this, and I've added an item to @lukewagner's "WAST-as-a-service" backlog to cover that.</p>
</blockquote>



<a name="567171415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312282%20add%20missing%20may-block%20checks%20for%20syn.../near/567171415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312282.20add.20missing.20may-block.20checks.20for.20syn.2E.2E.2E.html#567171415">(Jan 09 2026 at 15:48)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12282#issuecomment-3729463859">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12282">PR #12282</a>:</p>
<blockquote>
<p>Makes sense, but while that makes sense for retroactively testing things I'd prefer to try to ensure that we are also writing <code>*.wast</code> tests for new things or anything our vision is currently set on. I don't think, for example, that Luke should be the one-and-only person writing those <code>*.wast</code> tests</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>