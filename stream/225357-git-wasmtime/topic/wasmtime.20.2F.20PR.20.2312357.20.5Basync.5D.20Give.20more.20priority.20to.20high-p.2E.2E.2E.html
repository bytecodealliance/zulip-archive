<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12357 [async] Give more priority to high-p... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html">wasmtime / PR #12357 [async] Give more priority to high-p...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="568185310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568185310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568185310">(Jan 15 2026 at 11:33)</a>:</h4>
<p>TartanLlama opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a> from <code>TartanLlama:sy/high-priority-queue</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Currently, the main async event loop processes either all of the high-priority work items, or all of the low-priority work items if there are no high-priority items. This means that, if there are multiple low-priority tasks and an early one adds a task to the high-priority queue, this new task has to wait for the remaining low-priority tasks to complete before it gets a chance to run.</p>
<p>This PR changes the event loop to run at most one low-priority task on every iteration. As such, if this task enqueues a high-priority task, that task will get a chance to run before any other low-priority tasks.</p>
<p>I also reduced the nesting of the <code>poll_until</code> loop and added better names to make the code more easily understandable. </p>
</blockquote>



<a name="568185311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568185311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568185311">(Jan 15 2026 at 11:33)</a>:</h4>
<p><strong>TartanLlama</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>.</p>



<a name="568185313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568185313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568185313">(Jan 15 2026 at 11:33)</a>:</h4>
<p><strong>TartanLlama</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>.</p>



<a name="568185458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568185458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568185458">(Jan 15 2026 at 11:34)</a>:</h4>
<p>TartanLlama edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>:</p>
<blockquote>
<p>Currently, the main async event loop processes either all of the high-priority work items, or all of the low-priority work items if there are no high-priority items. This means that, if there are multiple low-priority tasks and an early one adds a task to the high-priority queue, this new task has to wait for the remaining low-priority tasks to complete before it gets a chance to run.</p>
<p>This PR changes the event loop to run at most one low-priority task on every iteration. As such, if this task enqueues a high-priority task, that task will get a chance to run before any other low-priority tasks.</p>
<p>I also reduced the nesting of the <code>poll_until</code> loop, factored out pulling the work items out of <code>ConcurrentState</code>, and added better names to make the code more easily understandable. </p>
</blockquote>



<a name="568204607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568204607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568204607">(Jan 15 2026 at 13:02)</a>:</h4>
<p>github-actions[bot] added the label <code>wasmtime:api</code> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>.</p>



<a name="568249996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568249996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568249996">(Jan 15 2026 at 15:50)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/dicej">dicej</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>.</p>



<a name="568250010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568250010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568250010">(Jan 15 2026 at 15:50)</a>:</h4>
<p>alexcrichton unassigned alexcrichton from <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357 [async] Give more priority to high-priority work items</a>.</p>



<a name="568272759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568272759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568272759">(Jan 15 2026 at 17:20)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12357#issuecomment-3756007491">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>:</p>
<blockquote>
<p>I'm working on the <code>async_poll_stackless</code> test failure now.  Should have a fix soonish.</p>
</blockquote>



<a name="568289460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568289460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568289460">(Jan 15 2026 at 18:54)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/12357#issuecomment-3756379876">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>:</p>
<blockquote>
<p>#12360 will fix the CI failure</p>
</blockquote>



<a name="568290208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568290208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568290208">(Jan 15 2026 at 18:58)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12357#pullrequestreview-3667116104">PR review</a>:</p>
<blockquote>
<p>LGTM, thanks!</p>
</blockquote>



<a name="568400064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568400064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568400064">(Jan 16 2026 at 10:19)</a>:</h4>
<p>TartanLlama updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>.</p>



<a name="568436816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568436816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568436816">(Jan 16 2026 at 13:41)</a>:</h4>
<p>dicej added <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357 [async] Give more priority to high-priority work items</a> to the merge queue.</p>



<a name="568443336"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568443336" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568443336">(Jan 16 2026 at 14:11)</a>:</h4>
<p>dicej merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357</a>.</p>



<a name="568443341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312357%20%5Basync%5D%20Give%20more%20priority%20to%20high-p.../near/568443341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312357.20.5Basync.5D.20Give.20more.20priority.20to.20high-p.2E.2E.2E.html#568443341">(Jan 16 2026 at 14:11)</a>:</h4>
<p>dicej removed <a href="https://github.com/bytecodealliance/wasmtime/pull/12357">PR #12357 [async] Give more priority to high-priority work items</a> from the merge queue.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>