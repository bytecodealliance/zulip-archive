<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11749 Panic performing reverse-map of p... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html">wasmtime / issue #11749 Panic performing reverse-map of p...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="541857853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311749%20Panic%20performing%20reverse-map%20of%20p.../near/541857853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html#541857853">(Sep 28 2025 at 03:32)</a>:</h4>
<p>alexcrichton assigned fitzgen to <a href="https://github.com/bytecodealliance/wasmtime/issues/11749">issue #11749</a>.</p>



<a name="541857856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311749%20Panic%20performing%20reverse-map%20of%20p.../near/541857856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html#541857856">(Sep 28 2025 at 03:32)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11749">issue #11749</a>:</p>
<blockquote>
<p>This input:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(module
  (type $a (array (mut i64)))
  (elem declare externref)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func $f2
    (local (ref null any))
    data.drop 0
    call $f2

    local.get 0
    ref.test nullref
    unreachable
  )
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func (export "") unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func (export "entry") (result externref)
    call $f1

    i32.const 0
    array.new_default $a
    i32.const 0
    array.new_default $a
    elem.drop 0
    unreachable
  )
  (func $f1 call $f2 call $f2)
  (data)
)
</code></pre></div>
<p>fails with this command:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">pulley64</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="n">Wfunction</span><span class="o">-</span><span class="n">references</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="n">Wgc</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="n">Wunknown</span><span class="o">-</span><span class="n">imports</span><span class="o">-</span><span class="n">default</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">testcase0</span><span class="p">.</span><span class="n">wat</span>
<span class="o">..</span><span class="p">.</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">environ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">builtin</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">353</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">len</span><span class="p">()</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>I believe the cause of this is <a href="https://github.com/bytecodealliance/wasmtime/pull/11630">https://github.com/bytecodealliance/wasmtime/pull/11630</a> so cc @fitzgen </p>
</blockquote>



<a name="541857857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311749%20Panic%20performing%20reverse-map%20of%20p.../near/541857857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html#541857857">(Sep 28 2025 at 03:32)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11749">Issue #11749</a>.</p>



<a name="541857926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311749%20Panic%20performing%20reverse-map%20of%20p.../near/541857926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html#541857926">(Sep 28 2025 at 03:33)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11749#issuecomment-3342239041">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11749">issue #11749</a>:</p>
<blockquote>
<p>The test here is super brittle  and I did my best to reduce it but was unable to go much further. I've written a more custom test at <a href="https://github.com/bytecodealliance/wasmtime/pull/11750">https://github.com/bytecodealliance/wasmtime/pull/11750</a> which reproduces this at a much lower level much quicker. </p>
<p>@fitzgen would you be ok looking into this? I'm assuming the index bits are fresh enough in your head it might be easier that way, but I can also give it a stab too.</p>
</blockquote>



<a name="542098095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311749%20Panic%20performing%20reverse-map%20of%20p.../near/542098095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html#542098095">(Sep 29 2025 at 17:23)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/11749#issuecomment-3348151794">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11749">issue #11749</a>:</p>
<blockquote>
<blockquote>
<p><a href="https://github.com/fitzgen">@fitzgen</a> would you be ok looking into this? I'm assuming the index bits are fresh enough in your head it might be easier that way, but I can also give it a stab too.</p>
</blockquote>
<p>Yeah I can look into this, thanks for the ping</p>
</blockquote>



<a name="542351391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311749%20Panic%20performing%20reverse-map%20of%20p.../near/542351391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311749.20Panic.20performing.20reverse-map.20of.20p.2E.2E.2E.html#542351391">(Sep 30 2025 at 19:22)</a>:</h4>
<p>fitzgen closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11749">issue #11749</a>:</p>
<blockquote>
<p>This input:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(module
  (type $a (array (mut i64)))
  (elem declare externref)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func $f2
    (local (ref null any))
    data.drop 0
    call $f2

    local.get 0
    ref.test nullref
    unreachable
  )
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func (export "") unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func unreachable)
  (func (export "entry") (result externref)
    call $f1

    i32.const 0
    array.new_default $a
    i32.const 0
    array.new_default $a
    elem.drop 0
    unreachable
  )
  (func $f1 call $f2 call $f2)
  (data)
)
</code></pre></div>
<p>fails with this command:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">pulley64</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="n">Wfunction</span><span class="o">-</span><span class="n">references</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="n">Wgc</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="n">Wunknown</span><span class="o">-</span><span class="n">imports</span><span class="o">-</span><span class="n">default</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">testcase0</span><span class="p">.</span><span class="n">wat</span>
<span class="o">..</span><span class="p">.</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">environ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">builtin</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">353</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">len</span><span class="p">()</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>I believe the cause of this is <a href="https://github.com/bytecodealliance/wasmtime/pull/11630">https://github.com/bytecodealliance/wasmtime/pull/11630</a> so cc @fitzgen </p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>