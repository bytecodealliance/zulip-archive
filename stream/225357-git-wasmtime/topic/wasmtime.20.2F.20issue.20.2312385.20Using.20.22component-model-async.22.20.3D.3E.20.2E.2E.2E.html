<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12385 Using &quot;component-model-async&quot; =&gt; ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.22component-model-async.22.20.3D.3E.20.2E.2E.2E.html">wasmtime / issue #12385 Using &quot;component-model-async&quot; =&gt; ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="569362378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312385%20Using%20%22component-model-async%22%20%3D%3E%20.../near/569362378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312385.20Using.20.22component-model-async.22.20.3D.3E.20.2E.2E.2E.html#569362378">(Jan 21 2026 at 21:43)</a>:</h4>
<p>ignatz opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12385">issue #12385</a>:</p>
<blockquote>
<p>For context, I found <a href="https://github.com/bytecodealliance/wasmtime/issues/12154">https://github.com/bytecodealliance/wasmtime/issues/12154</a> which had the same error message but supposedly it's fixed, it may also be unrelated...</p>
<p>...anyway, I'm using wasmtime v41.0.0 enabling the  "component-model-async" feature, while still using WASIp2.</p>
<p>The host seems to be happy, but when I build the WASM guest, I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">rust</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">testfixture</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sebastian</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">trailbase</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">testfixture</span><span class="o">/</span><span class="n">guests</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_post_trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-http-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-job-handlers"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/init-endpoint@0.1.0#init-sqlite-functions"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"trailbase:component/sqlite-function-endpoint@0.1.0#dispatch-scalar-function"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"wasi:http/incoming-handler@0.2.9#handle"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;431 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/tmp/rustcvjZFo1/{libwit_bindgen-82480354a7f0311d,libwit_bindgen-07ccf6eb5537f8e1}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/libcompiler_builtins-*.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/build/wit-bindgen-8ffd3c9ddbea9b25/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/sebastian/projects/trailbase/target/wasm32-wasip2/release/deps/wasm_rust_guest_testfixture.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"--no-entry"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">componentization</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">decoding</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="k">type</span><span class="p">:</span><span class="nc">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="p">:</span><span class="mf">0.51.0</span><span class="p">:</span><span class="nc">trailbase</span><span class="p">:</span><span class="nc">component</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">:</span><span class="nc">interfaces</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">its</span><span class="o">-</span><span class="n">exports</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span><span class="nc">encoded</span><span class="w"> </span><span class="n">world</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">invalid</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="p">(</span><span class="mh">0x43</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x2a38</span><span class="p">)</span>
</code></pre></div>
<p>When I build with <code>--target wasm-unknown-unknown</code> or <code>--target wasm-wasip1</code>, the component builds but the guest is not able to load it: "Wasmtime: failed to parse WebAssembly module".</p>
<p>The wasm-wasip3 target seems to be retired? Anyway, which would be the right one? Am I holding something else wrong? For example, does <code>component-model-async</code> require me to also switch to WASIp3 in lock-step?</p>
<p>Much appreciated <span aria-label="folded hands" class="emoji emoji-1f64f" role="img" title="folded hands">:folded_hands:</span> </p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>