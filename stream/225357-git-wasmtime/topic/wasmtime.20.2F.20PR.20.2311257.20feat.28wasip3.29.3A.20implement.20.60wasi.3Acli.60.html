<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11257 feat(wasip3): implement `wasi:cli` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html">wasmtime / PR #11257 feat(wasip3): implement `wasi:cli`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="529112470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529112470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529112470">(Jul 16 2025 at 18:11)</a>:</h4>
<p>rvolosatovs opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a> from <code>rvolosatovs:feat/wasip3-cli</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>follow-up on #11221, this implements <code>wasi:cli</code>, mostly by moving and cleaning up the implementation from <a href="https://github.com/bytecodealliance/wasip3-prototyping">https://github.com/bytecodealliance/wasip3-prototyping</a></p>
</blockquote>



<a name="529120620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120620">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#pullrequestreview-3026423401">PR review</a>.</p>



<a name="529120622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120622">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211313527">PR review comment</a>:</p>
<blockquote>
<p>Could the <code>InputStream</code> and <code>OutputStream</code> traits directly have a <code>Send</code> supertrait to avoid needing <code>InputStream + Send</code> for example in the builder and such?</p>
</blockquote>



<a name="529120623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120623">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211305017">PR review comment</a>:</p>
<blockquote>
<p>Would it be possible to use <code>std::io::IsTerminal</code> instead?</p>
</blockquote>



<a name="529120624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120624">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211306388">PR review comment</a>:</p>
<blockquote>
<p>FWIW a trick I've used in the past is to use <code>T::clocks(self)</code> in the body which forcibly ensures that recursion doesn't happen and avoids <code>**</code> syntax as well. Just a style thing though, no meaningful difference</p>
</blockquote>



<a name="529120625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120625">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211314678">PR review comment</a>:</p>
<blockquote>
<p>Would it be possible to drop <code>Unpin</code> since this is already in a box anyway?</p>
</blockquote>



<a name="529120626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120626">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211325428">PR review comment</a>:</p>
<blockquote>
<p>I'm a bit wary of making the implementation more generic than it already is, so would it be possible to drop these associated types and hardwire the trait objects? Or are these needed to multiplex the p2/p3 implementation?</p>
</blockquote>



<a name="529120627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120627">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211329957">PR review comment</a>:</p>
<blockquote>
<p>Could you explain a bit more as to why this is necessary?</p>
<p>I forget the matrix of types/traits involved here, but I would naively expect that <code>&amp;mut WasiImpl&lt;Self&gt;</code> is basically equivalent to <code>WasiImpl&lt;&amp;mut Self&gt;</code></p>
</blockquote>



<a name="529120629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529120629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529120629">(Jul 16 2025 at 19:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2211323419">PR review comment</a>:</p>
<blockquote>
<p>My guess is "no" given the litany of implementations we have, but in such a case could documentation be added that this is basically a mirror of what's in libstd? Also is it worth trying to add a blanket <code>impl&lt;T: std::IsTerminal&gt; wasi::IsTermainal for T</code> impl?</p>
</blockquote>



<a name="529242675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529242675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529242675">(Jul 17 2025 at 09:55)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#pullrequestreview-3028811352">PR review</a>.</p>



<a name="529242676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529242676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529242676">(Jul 17 2025 at 09:55)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2212896672">PR review comment</a>:</p>
<blockquote>
<p>We cannot use the <code>std::io::IsTerminal</code>, because it's sealed: <a href="https://github.com/rust-lang/rust/blob/f8f6997469237299c1d60814c7b9828602a1f8e4/library/std/src/io/stdio.rs#L1197">https://github.com/rust-lang/rust/blob/f8f6997469237299c1d60814c7b9828602a1f8e4/library/std/src/io/stdio.rs#L1197</a></p>
<p>Unfortunately, largely because of that, blanket implementations for <code>T</code> also do not appear to be possible.</p>
<p>For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0119</span><span class="p">]:</span><span class="w"> </span><span class="nc">conflicting</span><span class="w"> </span><span class="n">implementations</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">cli</span><span class="p">::</span><span class="n">IsTerminal</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="n">tokio</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Stderr</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">crates</span><span class="o">/</span><span class="n">wasi</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">cli</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">126</span><span class="p">:</span><span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">66</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">IsTerminal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">IsTerminal</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">---------------------------------------------</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">here</span>
<span class="o">..</span><span class="p">.</span>
<span class="mi">126</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">IsTerminal</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">tokio</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Stderr</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">tokio</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Stderr</span><span class="err">`</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">upstream</span><span class="w"> </span><span class="n">crates</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">std</span><span class="p">::</span><span class="n">sealed</span><span class="p">::</span><span class="n">Sealed</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="n">tokio</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Stderr</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">upstream</span><span class="w"> </span><span class="n">crates</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">IsTerminal</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="n">tokio</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Stderr</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span>
</code></pre></div>
<p><code>tokio::io::Stderr</code> cannot implement <code>std::io::IsTerminal</code>, because it's sealed and <em>we</em> cannot implement <code>wasmtime_wasi::cli::IsTerminal</code> for it if we provide a blanket implementation for <code>std::io::IsTerminal</code></p>
</blockquote>



<a name="529249059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529249059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529249059">(Jul 17 2025 at 10:34)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#pullrequestreview-3028946064">PR review</a>.</p>



<a name="529249061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529249061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529249061">(Jul 17 2025 at 10:34)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2212981797">PR review comment</a>:</p>
<blockquote>
<p>Depends, if these per-proposal "View" traits are adopted by <code>p2</code> implementation, then the associated types would be used for exactly this purpose. Currently, only the p3 implementation uses these traits.</p>
<p>I'll move this trait to <code>wasmtime_wasi::p3::cli::WasiCliView</code> without the associated types for now and maybe we can revisit once we have all of WASI implemented in this repo.</p>
</blockquote>



<a name="529252023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529252023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529252023">(Jul 17 2025 at 10:53)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#pullrequestreview-3029006168">PR review</a>.</p>



<a name="529252024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529252024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529252024">(Jul 17 2025 at 10:53)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2213019311">PR review comment</a>:</p>
<blockquote>
<p>I was hoping for that as well, but I've spent roughly 1h actively working on it and roughly an hour more trying things out while in meetings, but I could not figure it out without significant API changes.<br>
What I'd like to get from this implementation:</p>
<ul>
<li>be able to select a proposal to link (<code>wasi:cli</code> in this case) and:<ul>
<li><em>only</em> implement parts relevant for that proposal (<code>WasiCliView</code> instead of <code>WasiView</code>)</li>
<li>add symbols to linker using a familiar API (<code>wasmtime_wasi::p3::cli::add_to_linker</code>) without having to resort to lower-level, generated <code>wasmtime_wasi::p3::bindings::wasi::cli::*</code> per-interface functions - which is error prone, tedious and introduces additional maintenance burden</li>
</ul>
</li>
<li>be able to link <em>all</em> of WASI, i.e. implement <code>WasiView</code> and call <code>wasmtime_wasi::p3::add_to_linker</code></li>
</ul>
<p>The convention is that we implement interfaces for <code>WasiCliImpl&lt;T&gt;</code>, where <code>T: WasiCliView</code>. The challenge then in the likes of: <a href="https://github.com/bytecodealliance/wasmtime/blob/90ab7916a996a38dc405b1ff861c7c137ed230a7/crates/wasi/src/p3/clocks/mod.rs#L74">https://github.com/bytecodealliance/wasmtime/blob/90ab7916a996a38dc405b1ff861c7c137ed230a7/crates/wasi/src/p3/clocks/mod.rs#L74</a></p>
<p>We need a <code>WasiCliImpl(&amp;mut T)</code>, where <code>T</code> implements <code>WasiCliView</code>, but I don't see a way to acquire such a <code>T</code>, when we start with <code>WasiView</code>. I can't do a <code>|v| &amp;mut WasiImpl(v)</code>, since that would create an intermediate reference, which would be immediately dropped. I don't see a way to thread the lifetime through in a way that supports two different traits directly here.<br>
We also currently have a separate trait for getting the resource table and we cannot call both <code>WasiCliView::cli</code> and <code>ResourceView::table</code> inside the closure, since that would make us mutably borrow twice</p>
<p>There are workarounds though:</p>
<ol>
<li>Have <code>WasiCliView::cli</code> return a tuple <code>(&amp;mut WasiCliCtx, &amp;mut ResourceTable)</code></li>
<li>Store <code>ResourceTable</code> in <code>WasiCliCtx</code></li>
</ol>
<p>This morning I actually got another idea, which I'm going to try now: <code>WasiCliCtxView&lt;'a&gt;</code>, which would have to <code>&amp;mut</code> borrows, <code>&amp;mut WasiCliCtx</code> and <code>&amp;mut ResourceTable</code>, so <code>WasiCliView::cli</code> would have to return that. A bit awkward to use, but potentially it could work and hopefully it'd only be required in this lower level/advanced use case API</p>
</blockquote>



<a name="529252218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529252218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529252218">(Jul 17 2025 at 10:54)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2213019311">PR review comment</a>.</p>



<a name="529261997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529261997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529261997">(Jul 17 2025 at 11:53)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529262082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529262082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529262082">(Jul 17 2025 at 11:53)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#pullrequestreview-3029201049">PR review</a>.</p>



<a name="529262084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529262084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529262084">(Jul 17 2025 at 11:53)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#discussion_r2213135626">PR review comment</a>:</p>
<blockquote>
<p>It worked! No <code>WasiCliImpl</code> and no need for generics in the host implementations anymore</p>
</blockquote>



<a name="529262594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529262594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529262594">(Jul 17 2025 at 11:56)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529266996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529266996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529266996">(Jul 17 2025 at 12:21)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529270041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529270041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529270041">(Jul 17 2025 at 12:38)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529270752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529270752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529270752">(Jul 17 2025 at 12:42)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529272977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529272977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529272977">(Jul 17 2025 at 12:54)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#issuecomment-3083968779">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>:</p>
<blockquote>
<p>Semantics of <code>wasi:cli</code> stdio are not completely clear to me at this point, so I don't want to spend too much time designing the API for it, especially since this interface will likely change soon. There's currently no out-of-the-box way to "capture" stdout/stderr, users will have to implement their own with synchronization (e.g. using a <code>Mutex</code>)</p>
<p>refs <a href="https://github.com/WebAssembly/wasi-cli/issues/65">https://github.com/WebAssembly/wasi-cli/issues/65</a><br>
refs <a href="https://github.com/WebAssembly/wasi-cli/issues/64">https://github.com/WebAssembly/wasi-cli/issues/64</a> </p>
</blockquote>



<a name="529273036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529273036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529273036">(Jul 17 2025 at 12:55)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#issuecomment-3083968779">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>:</p>
<blockquote>
<p>Semantics of <code>wasi:cli</code> stdio are not completely clear to me at this point, so I don't want to spend too much time designing the API for it, especially since this interface will likely change soon. There's currently no out-of-the-box way to "capture" stdout/stderr, users will have to implement their own with synchronization (e.g. using a <code>Mutex</code>) for now</p>
<p>refs <a href="https://github.com/WebAssembly/wasi-cli/issues/65">https://github.com/WebAssembly/wasi-cli/issues/65</a><br>
refs <a href="https://github.com/WebAssembly/wasi-cli/issues/64">https://github.com/WebAssembly/wasi-cli/issues/64</a> </p>
</blockquote>



<a name="529273057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529273057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529273057">(Jul 17 2025 at 12:55)</a>:</h4>
<p><strong>rvolosatovs</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a> as ready for review.</p>



<a name="529273058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529273058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529273058">(Jul 17 2025 at 12:55)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529273062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529273062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529273062">(Jul 17 2025 at 12:55)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529273063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529273063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529273063">(Jul 17 2025 at 12:55)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529303198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529303198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529303198">(Jul 17 2025 at 15:19)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#pullrequestreview-3029996261">PR review</a>:</p>
<blockquote>
<p>Nice I like how the changes worked out, thanks for pushing on it!</p>
</blockquote>



<a name="529303333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529303333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529303333">(Jul 17 2025 at 15:20)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#issuecomment-3084481539">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>:</p>
<blockquote>
<blockquote>
<p>There's currently no out-of-the-box way to "capture" stdout/stderr</p>
</blockquote>
<p>Agreed yeah this is ok for now. For anything else along these lines mind opening an issue for that? I'll open an issue for this one specifically</p>
</blockquote>



<a name="529316752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529316752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529316752">(Jul 17 2025 at 16:31)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11257#issuecomment-3084696917">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>:</p>
<blockquote>
<p>Oh while cargo vet I think was spurious the <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/16350124789/job/46194454343">failure on Windows</a> I think is valid  which is <a href="https://github.com/bytecodealliance/wasmtime/pull/11257/files#diff-20f1fb49b0d9c0f977b5090e0b0b5df8d606c8200105e41431969a8dbfea8766R14">this line</a>. IIRC we set a few extra env vars for Windows for WASI testing</p>
</blockquote>



<a name="529435435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529435435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529435435">(Jul 18 2025 at 10:32)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529435563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529435563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529435563">(Jul 18 2025 at 10:33)</a>:</h4>
<p>rvolosatovs has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<a name="529442496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311257%20feat%28wasip3%29%3A%20implement%20%60wasi%3Acli%60/near/529442496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311257.20feat.28wasip3.29.3A.20implement.20.60wasi.3Acli.60.html#529442496">(Jul 18 2025 at 11:19)</a>:</h4>
<p>rvolosatovs merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11257">PR #11257</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>