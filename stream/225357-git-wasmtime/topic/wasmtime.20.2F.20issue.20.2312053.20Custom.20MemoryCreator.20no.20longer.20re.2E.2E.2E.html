<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12053 Custom MemoryCreator no longer re... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312053.20Custom.20MemoryCreator.20no.20longer.20re.2E.2E.2E.html">wasmtime / issue #12053 Custom MemoryCreator no longer re...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="558365846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312053%20Custom%20MemoryCreator%20no%20longer%20re.../near/558365846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312053.20Custom.20MemoryCreator.20no.20longer.20re.2E.2E.2E.html#558365846">(Nov 20 2025 at 07:46)</a>:</h4>
<p>d-sonuga opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12053">issue #12053</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I've run into an issue after upgrading from Wasmtime 21 to 33, specifically around the behavior of a custom <code>MemoryCreator</code> implementation. I'm using a custom memory creator that allocates memory using mmaped pages.  When the memory is modified, those changes are persisted to disk. On startup, the memory creator reconstructs linear memory from the persisted pages.</p>
<p>This setup works fine on Wasmtime 21.<br>
However, on Wasmtime 33 (and 38), the behavior changes: the custom-created memory region appears not to be modified, even though the wasm module executes normally. It looks like Wasmtime doesn't actually modify the memory returned by the <code>MemoryCreator</code>.</p>
<p>My suspicion is that something in Wasmtime's internal memory handling changed, but I'm not certain.</p>
<p>This is the configuration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">config</span><span class="p">.</span><span class="n">wasm_backtrace</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">wasm_backtrace_details</span><span class="p">(</span><span class="n">WasmBacktraceDetails</span><span class="p">::</span><span class="n">Disable</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">native_unwind_info</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">max_wasm_stack</span><span class="p">(</span><span class="mh">0x80000</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">consume_fuel</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">strategy</span><span class="p">(</span><span class="n">Strategy</span><span class="p">::</span><span class="n">Cranelift</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">OptLevel</span><span class="p">::</span><span class="n">SpeedAndSize</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_nan_canonicalization</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">memory_may_move</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">memory_guard_size</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">guard_before_linear_memory</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">memory_init_cow</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">generate_address_map</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">macos_use_mach_ports</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">wasm_memory64</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p>The <code>with_host_memory</code> is called later on to set the memory creator.</p>
<p>@alexcrichton?</p>
</blockquote>



<a name="558376264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312053%20Custom%20MemoryCreator%20no%20longer%20re.../near/558376264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312053.20Custom.20MemoryCreator.20no.20longer.20re.2E.2E.2E.html#558376264">(Nov 20 2025 at 08:48)</a>:</h4>
<p>d-sonuga <a href="https://github.com/bytecodealliance/wasmtime/issues/12053#issuecomment-3556640016">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12053">issue #12053</a>:</p>
<blockquote>
<p>Update: the memory actually gets written - the mmap page faults are being triggered and handled correctly - I think the reason is because of instance initialization - the memory keeps getting reinitialized, even when it shouldn't, the <code>needs_init</code> has been removed from the <code>LinearMemory</code> implementation - I think that's it - what was it replaced with?</p>
</blockquote>



<a name="558384522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312053%20Custom%20MemoryCreator%20no%20longer%20re.../near/558384522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312053.20Custom.20MemoryCreator.20no.20longer.20re.2E.2E.2E.html#558384522">(Nov 20 2025 at 09:31)</a>:</h4>
<p>d-sonuga <a href="https://github.com/bytecodealliance/wasmtime/issues/12053#issuecomment-3556870116">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12053">issue #12053</a>:</p>
<blockquote>
<p>Update: sorry, it's not Wasmtime that changed. The problem was on my side.</p>
</blockquote>



<a name="558458583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312053%20Custom%20MemoryCreator%20no%20longer%20re.../near/558458583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312053.20Custom.20MemoryCreator.20no.20longer.20re.2E.2E.2E.html#558458583">(Nov 20 2025 at 15:23)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12053">issue #12053</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I've run into an issue after upgrading from Wasmtime 21 to 33, specifically around the behavior of a custom <code>MemoryCreator</code> implementation. I'm using a custom memory creator that allocates memory using mmaped pages.  When the memory is modified, those changes are persisted to disk. On startup, the memory creator reconstructs linear memory from the persisted pages.</p>
<p>This setup works fine on Wasmtime 21.<br>
However, on Wasmtime 33 (and 38), the behavior changes: the custom-created memory region appears not to be modified, even though the wasm module executes normally. It looks like Wasmtime doesn't actually modify the memory returned by the <code>MemoryCreator</code>.</p>
<p>My suspicion is that something in Wasmtime's internal memory handling changed, but I'm not certain.</p>
<p>This is the configuration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">config</span><span class="p">.</span><span class="n">wasm_backtrace</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">wasm_backtrace_details</span><span class="p">(</span><span class="n">WasmBacktraceDetails</span><span class="p">::</span><span class="n">Disable</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">native_unwind_info</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">max_wasm_stack</span><span class="p">(</span><span class="mh">0x80000</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">consume_fuel</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">strategy</span><span class="p">(</span><span class="n">Strategy</span><span class="p">::</span><span class="n">Cranelift</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">OptLevel</span><span class="p">::</span><span class="n">SpeedAndSize</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_nan_canonicalization</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">memory_may_move</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">memory_guard_size</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">guard_before_linear_memory</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">memory_init_cow</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">generate_address_map</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">macos_use_mach_ports</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">wasm_memory64</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p>The <code>with_host_memory</code> is called later on to set the memory creator.</p>
<p>@alexcrichton?</p>
</blockquote>



<a name="558458586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312053%20Custom%20MemoryCreator%20no%20longer%20re.../near/558458586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312053.20Custom.20MemoryCreator.20no.20longer.20re.2E.2E.2E.html#558458586">(Nov 20 2025 at 15:23)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12053#issuecomment-3558645204">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12053">issue #12053</a>:</p>
<blockquote>
<p>Ah no worries! I wouldn't rule out something changing on the Wasmtime side as well, so if that shows up feel free to comment here and I can reopen</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>