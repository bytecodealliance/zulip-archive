<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10122 Wasmtime should always print gues... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html">wasmtime / issue #10122 Wasmtime should always print gues...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="496162866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/496162866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#496162866">(Jan 27 2025 at 16:22)</a>:</h4>
<p><a href="https://github.com/tschneidereit">tschneidereit</a> added the enhancement label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">Issue #10122</a>.</p>



<a name="496162872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/496162872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#496162872">(Jan 27 2025 at 16:22)</a>:</h4>
<p>tschneidereit opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Currently, Wasmtime doesn't always print anything to <code>stderr</code> when the guest panics: e.g. when serving incoming HTTP requests, panics are only printed if they happen before a response is sent. If the panic happens after the response headers have been sent, the panic is silently swallowed, and will only show up with the right <code>WASMTIME_LOG</code> incantation.</p>
<h4>Benefit</h4>
<p>Make guest panics easier to identify and debug.</p>
<h4>Implementation</h4>
<p>I'm not sure where this needs to be added, unfortunately.</p>
<h4>Alternatives</h4>
<p>Do nothing.<br>
</p>
</blockquote>



<a name="496162920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/496162920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#496162920">(Jan 27 2025 at 16:23)</a>:</h4>
<p><a href="https://github.com/tschneidereit">tschneidereit</a> added the wasmtime label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">Issue #10122</a>.</p>



<a name="496183826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/496183826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#496183826">(Jan 27 2025 at 18:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10122#issuecomment-2616540780">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<p>Do you have an example to run? Glancing at the logging in <code>wasmtime serve</code> it looks like it's writing everything to stdout/stderr as soon as it gets it, so I'm not immediately sure where the issue might lie. </p>
</blockquote>



<a name="501270976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/501270976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#501270976">(Feb 22 2025 at 14:16)</a>:</h4>
<p>primoly <a href="https://github.com/bytecodealliance/wasmtime/issues/10122#issuecomment-2676232097">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<p>When a component traps before calling <code>set</code>, <code>receiver.await</code> has an error and this code is invoked<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L537">https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L537</a><br>
and the underlying cause of the failure of the <code>task</code> is retrieved.</p>
<p>But when it traps afterwards, <code>receiver.await</code> returns <code>Ok</code>, this code is executed<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L526">https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L526</a><br>
causing the error from the <code>task</code> to get discarded.</p>
<p>The code currently makes two wrong assumptions:</p>
<ol>
<li>An error in <code>receiver</code> means an error in <code>task</code>.</li>
<li>Success in <code>receiver</code> means success in <code>task</code>.</li>
</ol>
<p>(1) has been fixed in #10256, but @tschneidereit’s problem (2) hasn’t yet.</p>
<p>Here a proxy component to try at home. It traps <em>after</em> calling <code>set</code> (line 117). To see the difference of trapping <em>before</em>, uncomment <code>;; unreachable</code> on line 91.</p>
<p>&lt;details&gt;&lt;summary&gt;proxy.wat&lt;/summary&gt;</p>
<p><div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">component</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span>
    <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"error"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">import</span> <span class="s2">"wasi:io/error@0.2.0"</span> <span class="p">(</span><span class="err">instance</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"error"</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span><span class="p">))</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span>
    <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"output-stream"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="err">alias</span> <span class="err">outer</span> <span class="mf">1 1</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span><span class="p">))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;2;)</span> <span class="s2">"error"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">1</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="err">variant</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"last-operation-failed"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"closed"</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;5;)</span> <span class="s2">"stream-error"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">4</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;6;)</span> <span class="p">(</span><span class="err">borrow</span> <span class="mi">0</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;7;)</span> <span class="p">(</span><span class="err">list</span> <span class="err">u</span><span class="mi">8</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;8;)</span> <span class="p">(</span><span class="k">result</span> <span class="p">(</span><span class="err">error</span> <span class="mi">5</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;9;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"self"</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"contents"</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">8</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"[method]output-stream.blocking-write-and-flush"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">9</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">import</span> <span class="s2">"wasi:io/streams@0.2.0"</span> <span class="p">(</span><span class="err">instance</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">1</span> <span class="s2">"output-stream"</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span><span class="p">))</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span>
    <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"fields"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;1;)</span> <span class="s2">"response-outparam"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;2;)</span> <span class="s2">"outgoing-response"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">string</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">16</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;5;)</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"rcode"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"info-code"</span> <span class="mi">4</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;6;)</span> <span class="s2">"DNS-error-payload"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">5</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;7;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">8</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;8;)</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"alert-id"</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"alert-message"</span> <span class="mi">3</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;9;)</span> <span class="s2">"TLS-alert-received-payload"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">8</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;10;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">32</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;11;)</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"field-name"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"field-size"</span> <span class="mi">10</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;12;)</span> <span class="s2">"field-size-payload"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">11</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;13;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">64</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;14;)</span> <span class="p">(</span><span class="err">option</span> <span class="mi">12</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;15;)</span> <span class="p">(</span><span class="err">variant</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"DNS-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"DNS-error"</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-not-found"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-unavailable"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-IP-prohibited"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-IP-unroutable"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-refused"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-terminated"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-read-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-write-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-limit-reached"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"TLS-protocol-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"TLS-certificate-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"TLS-alert-received"</span> <span class="mi">9</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-denied"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-length-required"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-body-size"</span> <span class="mi">13</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-method-invalid"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-URI-invalid"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-URI-too-long"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-header-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-header-size"</span> <span class="mi">14</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-trailer-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-trailer-size"</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-incomplete"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-header-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-header-size"</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-body-size"</span> <span class="mi">13</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-trailer-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-trailer-size"</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-transfer-coding"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-content-coding"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-upgrade-failed"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-protocol-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"loop-detected"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"configuration-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"internal-error"</span> <span class="mi">3</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;16;)</span> <span class="s2">"error-code"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">15</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;17;)</span> <span class="s2">"headers"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">0</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;18;)</span> <span class="s2">"outgoing-body"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="err">alias</span> <span class="err">outer</span> <span class="mf">1 3</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;19;)</span><span class="p">))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;20;)</span> <span class="s2">"output-stream"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">19</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;21;)</span> <span class="s2">"incoming-request"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;22;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">0</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;23;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">result</span> <span class="mi">22</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"[constructor]fields"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">23</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;24;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;25;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;26;)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">25</span> <span class="p">(</span><span class="err">error</span> <span class="mi">16</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;27;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"param"</span> <span class="mi">24</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"response"</span> <span class="mi">26</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;1;)</span> <span class="s2">"[static]response-outparam.set"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">27</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;28;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">17</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;29;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"headers"</span> <span class="mi">28</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">25</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;2;)</span> <span class="s2">"[constructor]outgoing-response"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">29</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;30;)</span> <span class="p">(</span><span class="err">borrow</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;31;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">18</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;32;)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">31</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;33;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"self"</span> <span class="mi">30</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">32</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;3;)</span> <span class="s2">"[method]outgoing-response.body"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">33</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;34;)</span> <span class="p">(</span><span class="err">borrow</span> <span class="mi">18</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;35;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">20</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;36;)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">35</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;37;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"self"</span> <span class="mi">34</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">36</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;4;)</span> <span class="s2">"[method]outgoing-body.write"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">37</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">import</span> <span class="s2">"wasi:http/types@0.2.0"</span> <span class="p">(</span><span class="err">instance</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="cm">(;0;)</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:io/streams@0.2"</span> <span class="s2">"[method]output-stream.blocking-write-and-flush"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$write</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[static]response-outparam.set"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$set</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[constructor]fields"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$headers</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[constructor]outgoing-response"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$out-res</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[method]outgoing-response.body"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$body</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[method]outgoing-body.write"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$body-write</span> <span class="cm">(;5;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">memory</span> <span class="cm">(;0;)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"cm32p2_memory"</span> <span class="p">(</span><span class="k">memory</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"cm32p2|wasi:http/incoming-handler@0.2|handle"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">6</span><span class="p">))</span>
    <span class="p">(</span><span class="k">func</span> <span class="cm">(;6;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$out-param</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="p">(</span><span class="k">local</span> <span class="nv">$res</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="c1">;; unreachable</span>
      <span class="nb">call</span> <span class="nv">$headers</span>
      <span class="nb">call</span> <span class="nv">$out-res</span>
      <span class="nb">local.tee</span> <span class="nv">$res</span>
      <span class="nb">i32.const</span> <span class="mf">256</span>
      <span class="nb">call</span> <span class="nv">$body</span>
      <span class="nb">local.get</span> <span class="nv">$out-param</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="nv">$res</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i64.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">call</span> <span class="nv">$set</span>
      <span class="nb">i32.const</span> <span class="mf">260</span>
      <span class="nb">i32.load</span>
      <span class="nb">i32.const</span> <span class="mf">256</span>
      <span class="nb">call</span> <span class="nv">$body-write</span>
      <span class="nb">i32.const</span> <span class="mf">260</span>
      <span class="nb">i32.load</span>
      <span class="nb">i32.const</span> <span class="mi">16</span>
      <span class="nb">i32.const</span> <span class="mi">25</span>
      <span class="nb">i32.const</span> <span class="mf">512</span>
      <span class="nb">call</span> <span class="nv">$write</span>
      <span class="nb">unreachable</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">data</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">16</span><span class="p">)</span> <span class="s2">"Hello from the other side.</span><span class="se">\0a</span><span class="s2">"</span><span class="p">)</span>
    <span class="p">(</span><span class="err">@producers</span>
      <span class="p">(</span><span class="err">processed-by</span> <span class="s2">"wit-component"</span> <span class="s2">"0.225.0"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="cm">(;1;)</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">table</span> <span class="cm">(;0;)</span> <span class="mf">4 4</span> <span class="k">funcref</span><span class="p">)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"0"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:io/streams@0.2-[method]output-stream.blocking-write-and-flush"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"1"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[static]response-outparam.set"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"2"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-response.body"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"3"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-body.write"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"$imports"</span> <span class="p">(</span><span class="k">table</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:io/streams@0.2-[method]output-stream.blocking-write-and-flush"</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">local.get</span> <span class="mi">2</span>
      <span class="nb">local.get</span> <span class="mi">3</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[static]response-outparam.set"</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">local.get</span> <span class="mi">2</span>
      <span class="nb">local.get</span> <span class="mi">3</span>
      <span class="nb">local.get</span> <span class="mi">4</span>
      <span class="nb">local.get</span> <span class="mi">5</span>
      <span class="nb">local.get</span> <span class="mi">6</span>
      <span class="nb">local.get</span> <span class="mi">7</span>
      <span class="nb">local.get</span> <span class="mi">8</span>
      <span class="nb">i32.const</span> <span class="mi">1</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-response.body"</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">i32.const</span> <span class="mi">2</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-body.write"</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">i32.const</span> <span class="mi">3</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="err">@producers</span>
      <span class="p">(</span><span class="err">processed-by</span> <span class="s2">"wit-component"</span> <span class="s2">"0.225.0"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="cm">(;2;)</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"0"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"1"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"2"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"3"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"$imports"</span> <span class="p">(</span><span class="k">table</span> <span class="cm">(;0;)</span> <span class="mf">4 4</span> <span class="k">funcref</span><span class="p">))</span>
    <span class="p">(</span><span class="k">elem</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)</span> <span class="k">func</span> <span class="mf">0 1</span> <span class="mf">2 3</span><span class="p">)</span>
    <span class="p">(</span><span class="err">@producers</span>
      <span class="p">(</span><span class="err">processed-by</span> <span class="s2">"wit-component"</span> <span class="s2">"0.225.0"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="err">instantiate</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="err">core</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"0"</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;0;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="cm">(;1;)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"[method]output-stream.blocking-write-and-flush"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">alias</span> <span class="err">core</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"1"</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;1;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">2</span> <span class="s2">"[constructor]fields"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;0;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="err">canon</span> <span class="err">lower</span> <span class="p">(</span><span class="k">func</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">2</span> <span class="s2">"[constructor]outgoing-response"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;1;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="err">canon</span> <span class="err">lower</span> <span class="p">(</span><span class="k">func</span>
<span class="err">[message</span> <span class="err">truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="501276388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/501276388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#501276388">(Feb 22 2025 at 15:25)</a>:</h4>
<p>primoly edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10122#issuecomment-2676232097">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<p>When a component traps before calling <code>set</code>, <code>receiver.await</code> has an error and this code is invoked<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L537">https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L537</a><br>
and the underlying cause of the failure of the <code>task</code> is retrieved.</p>
<p>But when it traps afterwards, <code>receiver.await</code> returns <code>Ok</code>, this code is executed<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L526">https://github.com/bytecodealliance/wasmtime/blob/2e48fbc9279f89d89f4dd99c48da48e2735e18cc/src/commands/serve.rs#L526</a><br>
causing the error from the <code>task</code> to get discarded.</p>
<p>The code currently makes two wrong assumptions:</p>
<ol>
<li>An error in <code>receiver</code> means an error in <code>task</code>.</li>
<li>Success in <code>receiver</code> means success in <code>task</code>.</li>
</ol>
<p>(1) has been fixed in #10256, but @tschneidereit’s problem (2) hasn’t yet.</p>
<p>Here a proxy component to try at home. It traps <em>after</em> calling <code>set</code> (line 117). To see the difference of trapping <em>before</em>, uncomment <code>;; unreachable</code> on line 91.</p>
<p>&lt;details&gt;&lt;summary&gt;proxy.wat&lt;/summary&gt;</p>
<p><div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">component</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span>
    <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"error"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">import</span> <span class="s2">"wasi:io/error@0.2.0"</span> <span class="p">(</span><span class="err">instance</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"error"</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span><span class="p">))</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span>
    <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"output-stream"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="err">alias</span> <span class="err">outer</span> <span class="mf">1 1</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span><span class="p">))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;2;)</span> <span class="s2">"error"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">1</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="err">variant</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"last-operation-failed"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"closed"</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;5;)</span> <span class="s2">"stream-error"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">4</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;6;)</span> <span class="p">(</span><span class="err">borrow</span> <span class="mi">0</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;7;)</span> <span class="p">(</span><span class="err">list</span> <span class="err">u</span><span class="mi">8</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;8;)</span> <span class="p">(</span><span class="k">result</span> <span class="p">(</span><span class="err">error</span> <span class="mi">5</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;9;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"self"</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"contents"</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">8</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"[method]output-stream.blocking-write-and-flush"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">9</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">import</span> <span class="s2">"wasi:io/streams@0.2.0"</span> <span class="p">(</span><span class="err">instance</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">1</span> <span class="s2">"output-stream"</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span><span class="p">))</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span>
    <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"fields"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;1;)</span> <span class="s2">"response-outparam"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;2;)</span> <span class="s2">"outgoing-response"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">string</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">16</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;5;)</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"rcode"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"info-code"</span> <span class="mi">4</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;6;)</span> <span class="s2">"DNS-error-payload"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">5</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;7;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">8</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;8;)</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"alert-id"</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"alert-message"</span> <span class="mi">3</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;9;)</span> <span class="s2">"TLS-alert-received-payload"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">8</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;10;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">32</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;11;)</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"field-name"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"field-size"</span> <span class="mi">10</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;12;)</span> <span class="s2">"field-size-payload"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">11</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;13;)</span> <span class="p">(</span><span class="err">option</span> <span class="err">u</span><span class="mi">64</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;14;)</span> <span class="p">(</span><span class="err">option</span> <span class="mi">12</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;15;)</span> <span class="p">(</span><span class="err">variant</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"DNS-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"DNS-error"</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-not-found"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-unavailable"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-IP-prohibited"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"destination-IP-unroutable"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-refused"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-terminated"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-read-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-write-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"connection-limit-reached"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"TLS-protocol-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"TLS-certificate-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"TLS-alert-received"</span> <span class="mi">9</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-denied"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-length-required"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-body-size"</span> <span class="mi">13</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-method-invalid"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-URI-invalid"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-URI-too-long"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-header-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-header-size"</span> <span class="mi">14</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-trailer-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-request-trailer-size"</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-incomplete"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-header-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-header-size"</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-body-size"</span> <span class="mi">13</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-trailer-section-size"</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-trailer-size"</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-transfer-coding"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-content-coding"</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-response-timeout"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-upgrade-failed"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"HTTP-protocol-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"loop-detected"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"configuration-error"</span><span class="p">)</span> <span class="p">(</span><span class="err">case</span> <span class="s2">"internal-error"</span> <span class="mi">3</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;16;)</span> <span class="s2">"error-code"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">15</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;17;)</span> <span class="s2">"headers"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">0</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;18;)</span> <span class="s2">"outgoing-body"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="err">alias</span> <span class="err">outer</span> <span class="mf">1 3</span> <span class="p">(</span><span class="k">type</span> <span class="cm">(;19;)</span><span class="p">))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;20;)</span> <span class="s2">"output-stream"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">eq</span> <span class="mi">19</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;21;)</span> <span class="s2">"incoming-request"</span> <span class="p">(</span><span class="k">type</span> <span class="p">(</span><span class="err">sub</span> <span class="err">resource</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;22;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">0</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;23;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">result</span> <span class="mi">22</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;0;)</span> <span class="s2">"[constructor]fields"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">23</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;24;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;25;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;26;)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">25</span> <span class="p">(</span><span class="err">error</span> <span class="mi">16</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;27;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"param"</span> <span class="mi">24</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"response"</span> <span class="mi">26</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;1;)</span> <span class="s2">"[static]response-outparam.set"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">27</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;28;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">17</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;29;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"headers"</span> <span class="mi">28</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">25</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;2;)</span> <span class="s2">"[constructor]outgoing-response"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">29</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;30;)</span> <span class="p">(</span><span class="err">borrow</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;31;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">18</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;32;)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">31</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;33;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"self"</span> <span class="mi">30</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">32</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;3;)</span> <span class="s2">"[method]outgoing-response.body"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">33</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;34;)</span> <span class="p">(</span><span class="err">borrow</span> <span class="mi">18</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;35;)</span> <span class="p">(</span><span class="err">own</span> <span class="mi">20</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;36;)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">35</span><span class="p">))</span>
      <span class="p">(</span><span class="k">type</span> <span class="cm">(;37;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"self"</span> <span class="mi">34</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="mi">36</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">export</span> <span class="cm">(;4;)</span> <span class="s2">"[method]outgoing-body.write"</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">type</span> <span class="mi">37</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">import</span> <span class="s2">"wasi:http/types@0.2.0"</span> <span class="p">(</span><span class="err">instance</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="cm">(;0;)</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:io/streams@0.2"</span> <span class="s2">"[method]output-stream.blocking-write-and-flush"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$write</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[static]response-outparam.set"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$set</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[constructor]fields"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$headers</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[constructor]outgoing-response"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$out-res</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[method]outgoing-response.body"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$body</span> <span class="cm">(;4;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">"cm32p2|wasi:http/types@0.2"</span> <span class="s2">"[method]outgoing-body.write"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$body-write</span> <span class="cm">(;5;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">memory</span> <span class="cm">(;0;)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"cm32p2_memory"</span> <span class="p">(</span><span class="k">memory</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"cm32p2|wasi:http/incoming-handler@0.2|handle"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">6</span><span class="p">))</span>
    <span class="p">(</span><span class="k">func</span> <span class="cm">(;6;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$out-param</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="p">(</span><span class="k">local</span> <span class="nv">$res</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="c1">;; unreachable</span>
      <span class="nb">call</span> <span class="nv">$headers</span>
      <span class="nb">call</span> <span class="nv">$out-res</span>
      <span class="nb">local.tee</span> <span class="nv">$res</span>
      <span class="nb">i32.const</span> <span class="mf">256</span>
      <span class="nb">call</span> <span class="nv">$body</span>
      <span class="nb">local.get</span> <span class="nv">$out-param</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="nv">$res</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i64.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">call</span> <span class="nv">$set</span>
      <span class="nb">i32.const</span> <span class="mf">260</span>
      <span class="nb">i32.load</span>
      <span class="nb">i32.const</span> <span class="mf">256</span>
      <span class="nb">call</span> <span class="nv">$body-write</span>
      <span class="nb">i32.const</span> <span class="mf">260</span>
      <span class="nb">i32.load</span>
      <span class="nb">i32.const</span> <span class="mi">16</span>
      <span class="nb">i32.const</span> <span class="mi">27</span>
      <span class="nb">i32.const</span> <span class="mf">512</span>
      <span class="nb">call</span> <span class="nv">$write</span>
      <span class="nb">unreachable</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">data</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">16</span><span class="p">)</span> <span class="s2">"Hello from the other side.</span><span class="se">\0a</span><span class="s2">"</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="cm">(;1;)</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">table</span> <span class="cm">(;0;)</span> <span class="mf">4 4</span> <span class="k">funcref</span><span class="p">)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"0"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:io/streams@0.2-[method]output-stream.blocking-write-and-flush"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"1"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[static]response-outparam.set"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"2"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-response.body"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"3"</span> <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-body.write"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"$imports"</span> <span class="p">(</span><span class="k">table</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:io/streams@0.2-[method]output-stream.blocking-write-and-flush"</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">local.get</span> <span class="mi">2</span>
      <span class="nb">local.get</span> <span class="mi">3</span>
      <span class="nb">i32.const</span> <span class="mi">0</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[static]response-outparam.set"</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">local.get</span> <span class="mi">2</span>
      <span class="nb">local.get</span> <span class="mi">3</span>
      <span class="nb">local.get</span> <span class="mi">4</span>
      <span class="nb">local.get</span> <span class="mi">5</span>
      <span class="nb">local.get</span> <span class="mi">6</span>
      <span class="nb">local.get</span> <span class="mi">7</span>
      <span class="nb">local.get</span> <span class="mi">8</span>
      <span class="nb">i32.const</span> <span class="mi">1</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-response.body"</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">i32.const</span> <span class="mi">2</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">func</span> <span class="err">$</span><span class="s2">"indirect-cm32p2|wasi:http/types@0.2-[method]outgoing-body.write"</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="nb">local.get</span> <span class="mi">0</span>
      <span class="nb">local.get</span> <span class="mi">1</span>
      <span class="nb">i32.const</span> <span class="mi">3</span>
      <span class="nb">call_indirect</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="cm">(;2;)</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i64</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">type</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"0"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"1"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;1;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"2"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"3"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"$imports"</span> <span class="p">(</span><span class="k">table</span> <span class="cm">(;0;)</span> <span class="mf">4 4</span> <span class="k">funcref</span><span class="p">))</span>
    <span class="p">(</span><span class="k">elem</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)</span> <span class="k">func</span> <span class="mf">0 1</span> <span class="mf">2 3</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="err">instantiate</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="err">core</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"0"</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;0;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="cm">(;1;)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"[method]output-stream.blocking-write-and-flush"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">alias</span> <span class="err">core</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"1"</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;1;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">2</span> <span class="s2">"[constructor]fields"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;0;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;2;)</span> <span class="p">(</span><span class="err">canon</span> <span class="err">lower</span> <span class="p">(</span><span class="k">func</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="k">export</span> <span class="mi">2</span> <span class="s2">"[constructor]outgoing-response"</span> <span class="p">(</span><span class="k">func</span> <span class="cm">(;1;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;3;)</span> <span class="p">(</span><span class="err">canon</span> <span class="err">lower</span> <span class="p">(</span><span class="k">func</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="err">core</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"2"</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;4;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">alias</span> <span class="err">core</span> <span class="k">export</span> <span class="mi">0</span> <span class="s2">"3"</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="cm">(;5;)</span><span class="p">))</span>
  <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="cm">(;2;)</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"[static]response-outparam.set"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="k">export</span> <span class="s2">"[constructor]</span>
<span class="s2">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="501580196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/501580196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#501580196">(Feb 24 2025 at 15:54)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10122#issuecomment-2678901666">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<p>I think I'm still not quite following. I tried this test in Wasmtime's repository:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">_</span><span class="p">:</span><span class="w"> </span><span class="nc">IncomingRequest</span><span class="p">,</span><span class="w"> </span><span class="n">outparam</span><span class="p">:</span><span class="w"> </span><span class="nc">ResponseOutparam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fields</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OutgoingResponse</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">fields</span><span class="p">);</span>

<span class="w">        </span><span class="n">ResponseOutparam</span><span class="p">::</span><span class="n">set</span><span class="p">(</span><span class="n">outparam</span><span class="p">,</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">resp</span><span class="p">));</span>

<span class="w">        </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"what"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>and I got:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Serving</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//0.0.0.0:8080/</span>
<span class="n">stderr</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span>
<span class="nc">stderr</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cli_serve_panic_after_set</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span>
<span class="nc">stderr</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">what</span>
<span class="n">stderr</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span><span class="n">T15</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">45.303636</span><span class="n">Z</span><span class="w"> </span><span class="n">ERROR</span><span class="w"> </span><span class="n">wasmtime_cli</span><span class="p">::</span><span class="n">commands</span><span class="p">::</span><span class="n">serve</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="mh">0xa177</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">__rust_start_panic</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="mh">0xa0c9</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">rust_panic</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="mh">0xa09c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">rust_panic_with_hook</span><span class="p">::</span><span class="n">he1beb51ce54153b5</span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="mh">0x93c6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">begin_panic_handler</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}::</span><span class="n">hdbff82bd9d56f6f9</span>
<span class="w">    </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="mh">0x9300</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">__rust_end_short_backtrace</span><span class="p">::</span><span class="n">h5bb26fcae04a79f5</span>
<span class="w">    </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="mh">0x9a30</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">rust_begin_unwind</span>
<span class="w">    </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="mh">0xe8e8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span><span class="p">::</span><span class="n">h2781e55e5f70e742</span>
<span class="w">    </span><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="mh">0x1722</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!&lt;</span><span class="n">cli_serve_panic_after_set</span><span class="p">::</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">test_programs</span><span class="p">::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">Guest</span><span class="o">&gt;</span><span class="p">::</span><span class="n">handle</span><span class="p">::</span><span class="n">h92d89fc0d302a262</span>
<span class="w">    </span><span class="mi">8</span><span class="p">:</span><span class="w"> </span><span class="mh">0x15ce</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">test_programs</span><span class="p">::</span><span class="n">proxy</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">incoming_handler</span><span class="p">::</span><span class="n">_export_handle_cabi</span><span class="p">::</span><span class="n">hb366510da1a4a724</span>
<span class="w">    </span><span class="mi">9</span><span class="p">:</span><span class="w"> </span><span class="mh">0x175f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cli_serve_panic_after_set</span><span class="o">-</span><span class="mi">0</span><span class="n">a3657b6bedfd56f</span><span class="p">.</span><span class="n">wasm</span><span class="o">!</span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">incoming</span><span class="o">-</span><span class="n">handler</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">#</span><span class="n">handle</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">WASMTIME_BACKTRACE_DETAILS</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="n">information</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>where both the <code>stderr</code> of the guest itself (the Rust-printed panic) as well as the trap (via <code>ERROR</code>) is printed by default.  I think the <code>ERROR</code> can theoretically be suppressed with a different <code>WASMTIME_LOG=...</code> so we should perhaps fix that, but it's printed by default.</p>
<blockquote>
<p>Here a proxy component to try at home. It traps after calling set (line 117). To see the difference of trapping before, uncomment ;; unreachable on line 91.</p>
</blockquote>
<p>Could you clarify the expected behavior here? As-is I see the program prints that it traps and additionally returns the body, which is what I'd expect. If I uncomment the <code>unreachable</code> then I get nothing from <code>curl</code> (what I'd expect) and the console shows both the trap message and the message about not calling <code>response-outparam::set</code></p>
</blockquote>



<a name="501617718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/501617718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#501617718">(Feb 24 2025 at 18:21)</a>:</h4>
<p>primoly <a href="https://github.com/bytecodealliance/wasmtime/issues/10122#issuecomment-2679298919">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<p>In the trap before <code>set</code> case, you see the trap of the component reported twice:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Serving</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//0.0.0.0:8080/</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span><span class="n">T18</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mf">00.873347</span><span class="n">Z</span><span class="w"> </span><span class="n">ERROR</span><span class="w"> </span><span class="n">wasmtime_cli</span><span class="p">::</span><span class="n">commands</span><span class="p">::</span><span class="n">serve</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">Error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="s">"error while executing at wasm backtrace:</span><span class="se">\n</span><span class="s">    0:  0x975 - &lt;unknown&gt;!&lt;wasm function 6&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="n">source</span><span class="p">:</span><span class="w"> </span><span class="nc">UnreachableCodeReached</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">hyper</span><span class="p">::</span><span class="n">Error</span><span class="p">(</span><span class="n">User</span><span class="p">(</span><span class="n">Service</span><span class="p">),</span><span class="w"> </span><span class="n">guest</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">invoked</span><span class="w"> </span><span class="err">`</span><span class="n">response</span><span class="o">-</span><span class="n">outparam</span><span class="p">::</span><span class="n">set</span><span class="err">`</span><span class="w"> </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w">  </span><span class="mh">0x975</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">6</span><span class="o">&gt;</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span><span class="p">)</span>
</code></pre></div>
<p>The first is the <code>ERROR …</code>, which is triggered by</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/3fb6dc72da1ae0237848beb3ed7619771cc705d4/src/commands/serve.rs#L518">https://github.com/bytecodealliance/wasmtime/blob/3fb6dc72da1ae0237848beb3ed7619771cc705d4/src/commands/serve.rs#L518</a></p>
<p>while the second, <code>error: …</code> is caused by</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/3fb6dc72da1ae0237848beb3ed7619771cc705d4/src/commands/serve.rs#L540">https://github.com/bytecodealliance/wasmtime/blob/3fb6dc72da1ae0237848beb3ed7619771cc705d4/src/commands/serve.rs#L540</a></p>
<p>which reports both the error in <code>hyper</code> as well as the underlying <code>unreachable</code> in the component (<code>Caused by: …</code>).</p>
<p>When trapping after calling <code>set</code>, you get this output instead:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Serving</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//0.0.0.0:8080/</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span><span class="n">T18</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">53.563983</span><span class="n">Z</span><span class="w"> </span><span class="n">ERROR</span><span class="w"> </span><span class="n">wasmtime_cli</span><span class="p">::</span><span class="n">commands</span><span class="p">::</span><span class="n">serve</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">Error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="s">"error while executing at wasm backtrace:</span><span class="se">\n</span><span class="s">    0:  0x9ae - &lt;unknown&gt;!&lt;wasm function 6&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="n">source</span><span class="p">:</span><span class="w"> </span><span class="nc">UnreachableCodeReached</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Notice how the trap is reported just once, this time only by <code>log::error</code>.</p>
<p>And to get back to @tschneidereit’s original issue, you can use <code>WASMTIME_LOG</code> to enable or suppress that log, while the error is printed regardless.<br>
</p>
</blockquote>



<a name="501651831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310122%20Wasmtime%20should%20always%20print%20gues.../near/501651831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310122.20Wasmtime.20should.20always.20print.20gues.2E.2E.2E.html#501651831">(Feb 24 2025 at 21:28)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10122#issuecomment-2679690106">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10122">issue #10122</a>:</p>
<blockquote>
<p>That all makes sense to me yeah and matches what I'm seeing, but I feel like I'm still missing the connection from what's here to what the desired state of things is.</p>
<p>For example I don't think it's great that the trap is sometimes reported twice and sometimes once, but that seems like an orthogonal issue from @tschneidereit's issue which is about panics and stderr. In all cases so far stderr has never been swallowed and it's always been emitted.</p>
<p>I also think it's not great that you could set <code>WASMTIME_LOG=off</code> and have these traps entirely hidden, but that again seems orthogonal from the original issue.</p>
<p>@primoly are you perhaps saying that the trap should be reported once, and only once, and it shouldn't use <code>log::error!</code> and should instead us something like <code>eprintln!</code>?</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>