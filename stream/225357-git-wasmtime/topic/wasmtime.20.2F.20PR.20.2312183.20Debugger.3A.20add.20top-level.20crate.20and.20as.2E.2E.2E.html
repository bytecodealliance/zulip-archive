<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12183 Debugger: add top-level crate and as... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html">wasmtime / PR #12183 Debugger: add top-level crate and as...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="564607784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564607784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564607784">(Dec 19 2025 at 02:56)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="564607786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564607786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564607786">(Dec 19 2025 at 02:56)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a> from <code>cfallin:debugger-crate</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>The debug support in Wasmtime so far is structured around async callbacks that occur at certain kinds of events, like breakpoints. This is a suitable foundation but makes for an awkward implementation of a top-level debugger implementation, which likely has an event loop dealing with user commands (via a UI or a protocol connection) and expects to perform actions such as "run until next breakpoint".</p>
<p>This PR introduces a new crate that wraps a <code>Store</code> in a <code>Debugger</code>. This wrapper embodies an inner async body that can perform whatever actions it likes on the <code>Store</code> that is passed back in. This inner body is spawned as an async task. The debugger wrapper registers its own <code>DebugHandler</code> callback that communicates with the outside world via bidirectional command/response queues.</p>
<p>On the "outside", the <code>Debugger</code> presents an interface suitable for inserting into a debug protocol server or UI: an async method that runs until next event and returns that event, and a method that permits querying or modifying the store whenever the <code>run</code> method is not executing. The latter operates by sending a closure over the queue, because the <code>Store</code> must continue to be owned by the async task that is (still) running and suspended in async callbacks.</p>
<p>Right now, this is exercised only via a few unit tests, but the intent is to next build up the "top half" of the debugger using this abstraction, e.g. by running a gdbstub protocol server (likely as a Wasm component in a "debug-main WIT world" -- RFC needed for this).</p>
<p>Also, when we eventually move debugging over to native use of <code>run_concurrent</code>, this paradigm should remain mostly unchanged at this level of API: there can still be an object that has an async method that runs and yields the next event, and there can still be a method that takes a closure that can operate (within its scope only) on the <code>Store</code>.</p>
<p>A few warts that I could use feedback on:</p>
<ul>
<li>
<p>Cancelation safety is weird. Fibers panic when dropped before execution of their body completes, and this seems to mean that we can't allow a <code>Debugger</code> to drop early (or at least, the <code>tokio::test</code> unit test that owns the runtime that runs the async task to finish before the debugged body completes!). If there is a better way to handle cancelation safety here, I'm all ears.</p>
</li>
<li>
<p>It's not clear to me if the boxed-closure-and-<code>Any</code> approach to providing access to the <code>Store</code> is the best we can do, but I suspect it is.</p>
</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="564607787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564607787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564607787">(Dec 19 2025 at 02:56)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="564607788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564607788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564607788">(Dec 19 2025 at 02:56)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="564627311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564627311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564627311">(Dec 19 2025 at 06:34)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="564748495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564748495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564748495">(Dec 19 2025 at 17:43)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="564764720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564764720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564764720">(Dec 19 2025 at 19:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3599582028">PR review</a>:</p>
<blockquote>
<p>Have to context switch, but want to get my comments thus far posted.</p>
</blockquote>



<a name="564764721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564764721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564764721">(Dec 19 2025 at 19:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2635961023">PR review comment</a>:</p>
<blockquote>
<p>Could be good to have an ascii diagram of the state machine here. Assuming we start in the <code>Paused</code> state, effectively always beginning at a breakpoint just before the program's first instantiation, I'm thinking something like</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>  |
  |
  V
Paused &lt;---------&gt; Queried
  ^
  |
  |
  V
Running
  |
  |
  V
Complete
</code></pre></div>
<p>But now that I think about it some more, it seems like complete and paused are actually the same for "reactor" style programs? That is, those that are a bag of exported functions that can be called in any order, rather than those defining just a <code>main</code>. This is because you start out in the initial paused state, call into some exported function and do stuff and then that can complete but you can always call back in again and do more stuff and debug these subsequent entries into the program as well.</p>
<p>This also makes me think of something that I don't think we've discussed thus far in our debugging conversations: debugging the start function and instantiation in general. For example, what if a data segment's initialization traps due to out-of-bounds memory access? We want to support debugging that, but I don't think we raise a debugging trap event for that yet, do we? (Obviously, we don't need to address all that in this PR, but I think this state machine should reflect the actual states we want to support in the fullness of time, IMO). So given that I think we actually want something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="n">V</span>
<span class="n">Uninstantiated</span><span class="w"> </span><span class="o">&lt;---</span><span class="p">.</span>
<span class="w">   </span><span class="o">^</span><span class="w">               </span><span class="o">|</span>
<span class="w">   </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">debugger</span><span class="w"> </span><span class="n">says</span><span class="w"> </span><span class="n">terminate</span><span class="p">)</span>
<span class="w">   </span><span class="o">|</span><span class="w">               </span><span class="o">|</span>
<span class="w">   </span><span class="n">V</span><span class="w">               </span><span class="o">|</span>
<span class="n">Running</span><span class="w">            </span><span class="o">|</span>
<span class="w">   </span><span class="o">^</span><span class="w">               </span><span class="o">|</span>
<span class="w">   </span><span class="o">|</span><span class="w">               </span><span class="o">|</span>
<span class="w">   </span><span class="o">|</span><span class="w">               </span><span class="o">|</span>
<span class="w">   </span><span class="n">V</span><span class="w">               </span><span class="o">|</span>
<span class="n">Paused</span><span class="o">-------------'</span>
<span class="w">   </span><span class="o">^</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="n">V</span>
<span class="n">Queried</span>
</code></pre></div>
<p>where uninstantiated to running involves instantiation, and returning from <code>main</code> or any other export that we called into as the entry point puts us back at paused (since we can inspect memories and such in this state, but can't in the uninstantiated state)</p>
</blockquote>



<a name="564764722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564764722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564764722">(Dec 19 2025 at 19:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2635910884">PR review comment</a>:</p>
<blockquote>
<p>Maybe name this <code>Paused</code>, because the name is a bit ambiguous with <code>Complete</code> otherwise (a program stops when it is finished, does it not?)</p>
</blockquote>



<a name="564766555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564766555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564766555">(Dec 19 2025 at 19:50)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3599858904">PR review</a>.</p>



<a name="564766557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564766557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564766557">(Dec 19 2025 at 19:50)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636121299">PR review comment</a>:</p>
<blockquote>
<p>Happy to add a state diagram!</p>
<p>One point of clarification regarding "before instantiation" or distinctions between different lifecycle states of a Wasm instance/component: this interface actually has no concept of instantiation. The "inner body" can be anything: it could create a bunch of instances, it could continue to call into an already-existing instance, etc. It inverts control so that the code on the outside gets events when the callback occurs, that's it; and the body doesn't run until the first <code>run()</code>.</p>
<p>So, yes, we could add debug events for out-of-bounds accesses by data segments. Any breakpoints in the start function should already "just work" though in the sense that it'll be Wasm execution within the scope of the inner body.</p>
</blockquote>



<a name="564781621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564781621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564781621">(Dec 19 2025 at 22:06)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3600263666">PR review</a>:</p>
<blockquote>
<blockquote>
<p>this seems to mean that we can't allow a Debugger to drop early</p>
</blockquote>
<p>This is definitely a bug in Wasmtime that we need to fix. Can you add a failing test or gist one that I can help poke around?</p>
</blockquote>



<a name="564781623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564781623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564781623">(Dec 19 2025 at 22:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636414411">PR review comment</a>:</p>
<blockquote>
<p>You can drop debug/std/async here since that'll come in through the normal dependency</p>
</blockquote>



<a name="564781625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564781625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564781625">(Dec 19 2025 at 22:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636413341">PR review comment</a>:</p>
<blockquote>
<p>should this be omitted?</p>
</blockquote>



<a name="564781626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564781626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564781626">(Dec 19 2025 at 22:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2636426603">PR review comment</a>:</p>
<blockquote>
<p>This should be define-able with <code>async fn handle(...)</code> and you don't need to worry about <code>Send</code></p>
</blockquote>



<a name="564786840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564786840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564786840">(Dec 19 2025 at 23:09)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3676964136">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<blockquote>
<p>This is definitely a bug in Wasmtime that we need to fix. Can you add a failing test or gist one that I can help poke around?</p>
</blockquote>
<p>Sure thing -- with <a href="https://github.com/cfallin/wasmtime/commit/2d22450579d820257317fe125b634ab360291e51">this</a> commit and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">debugger</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">basic_debugger</span>
</code></pre></div>
<p>I see</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">test</span><span class="p">::</span><span class="n">basic_debugger</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">1129985</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cfallin</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">fiber</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">199</span><span class="p">:</span><span class="mi">70</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="564786885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/564786885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#564786885">(Dec 19 2025 at 23:10)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3676965200">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>(It's entirely possible that I'm holding some part of the async machinery wrong, either in this PR or in earlier work to add the async debugger hook -- happy to have your opinions on that if so!)</p>
</blockquote>



<a name="565037098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565037098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565037098">(Dec 22 2025 at 16:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3682843250">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>That'll get fixed by this:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/crates/wasmtime/src/runtime/fiber.rs b/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gh">index 68dce6884f..1ab5120ef3 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gu">@@ -358,7 +358,7 @@ impl StoreOpaque {</span>
<span class="w"> </span>    }

<span class="w"> </span>    /// Returns whether `block_on` will succeed or panic.
<span class="gd">-    #[cfg(feature = "call-hook")]</span>
<span class="gi">+    #[cfg(any(feature = "call-hook", feature = "debug"))]</span>
<span class="w"> </span>    pub(crate) fn can_block(&amp;mut self) -&gt; bool {
<span class="w"> </span>        self.fiber_async_state_mut().current_future_cx.is_some()
<span class="w"> </span>    }
<span class="gh">diff --git a/crates/wasmtime/src/runtime/store.rs b/crates/wasmtime/src/runtime/store.rs</span>
<span class="gh">index 0ce69fc6c3..ac6929d376 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/store.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/store.rs</span>
<span class="gu">@@ -2839,6 +2839,9 @@ unsafe impl&lt;T&gt; VMStore for StoreInner&lt;T&gt; {</span>
<span class="w"> </span>    #[cfg(feature = "debug")]
<span class="w"> </span>    fn block_on_debug_handler(&amp;mut self, event: crate::DebugEvent&lt;'_&gt;) -&gt; anyhow::Result&lt;()&gt; {
<span class="w"> </span>        if let Some(handler) = self.debug_handler.take() {
<span class="gi">+            if !self.can_block() {</span>
<span class="gi">+                bail!("couldn't grab async_cx for debug handler")</span>
<span class="gi">+            }</span>
<span class="w"> </span>            log::trace!("about to raise debug event {event:?}");
<span class="w"> </span>            StoreContextMut(self).with_blocking(|store, cx| {
<span class="w"> </span>                cx.block_on(Pin::from(handler.handle(store, event)).as_mut())
</code></pre></div>
<p>tl;dr; when a store is dropped all fibers are resumed with a trap that says "please die immediately" but there are some circumstances in internal code where during the process of returning an error from everything something async is attempted. The async attempt fails because the blocking context (rightfully) wasn't configured. </p>
<p>This happened before with call hooks for example where we would try to invoke the call hook when the fiber is exiting saying "hey a trap happened". The fix here is to just skip debug events/call hooks/etc during this situation since if the store is being dropped that's no interesting anyway</p>
</blockquote>



<a name="565037124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565037124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565037124">(Dec 22 2025 at 16:35)</a>:</h4>
<p>alexcrichton edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3682843250">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>That'll get fixed by this:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/crates/wasmtime/src/runtime/fiber.rs b/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gh">index 68dce6884f..1ab5120ef3 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/fiber.rs</span>
<span class="gu">@@ -358,7 +358,7 @@ impl StoreOpaque {</span>
<span class="w"> </span>    }

<span class="w"> </span>    /// Returns whether `block_on` will succeed or panic.
<span class="gd">-    #[cfg(feature = "call-hook")]</span>
<span class="gi">+    #[cfg(any(feature = "call-hook", feature = "debug"))]</span>
<span class="w"> </span>    pub(crate) fn can_block(&amp;mut self) -&gt; bool {
<span class="w"> </span>        self.fiber_async_state_mut().current_future_cx.is_some()
<span class="w"> </span>    }
<span class="gh">diff --git a/crates/wasmtime/src/runtime/store.rs b/crates/wasmtime/src/runtime/store.rs</span>
<span class="gh">index 0ce69fc6c3..ac6929d376 100644</span>
<span class="gd">--- a/crates/wasmtime/src/runtime/store.rs</span>
<span class="gi">+++ b/crates/wasmtime/src/runtime/store.rs</span>
<span class="gu">@@ -2839,6 +2839,9 @@ unsafe impl&lt;T&gt; VMStore for StoreInner&lt;T&gt; {</span>
<span class="w"> </span>    #[cfg(feature = "debug")]
<span class="w"> </span>    fn block_on_debug_handler(&amp;mut self, event: crate::DebugEvent&lt;'_&gt;) -&gt; anyhow::Result&lt;()&gt; {
<span class="w"> </span>        if let Some(handler) = self.debug_handler.take() {
<span class="gi">+            if !self.can_block() {</span>
<span class="gi">+                bail!("couldn't grab async_cx for debug handler")</span>
<span class="gi">+            }</span>
<span class="w"> </span>            log::trace!("about to raise debug event {event:?}");
<span class="w"> </span>            StoreContextMut(self).with_blocking(|store, cx| {
<span class="w"> </span>                cx.block_on(Pin::from(handler.handle(store, event)).as_mut())
</code></pre></div>
<p>tl;dr; when a store is dropped all fibers are resumed with a trap that says "please die immediately" but there are some circumstances in internal code where during the process of returning an error from everything something async is attempted. The async attempt fails because the blocking context (rightfully) wasn't configured. </p>
<p>This happened before with call hooks for example where we would try to invoke the call hook when the fiber is exiting saying "hey a trap happened". The fix here is to just skip debug events/call hooks/etc during this situation since if the store is being dropped that's no interesting anyway</p>
<p>(if you wouldn't mind this'd be a good thing to add a test for too)</p>
</blockquote>



<a name="565051514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051514">(Dec 22 2025 at 18:20)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565051527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051527">(Dec 22 2025 at 18:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605218427">PR review</a>.</p>



<a name="565051529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051529">(Dec 22 2025 at 18:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640810573">PR review comment</a>:</p>
<blockquote>
<p>Added in cce7e85d8c.</p>
</blockquote>



<a name="565051552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051552">(Dec 22 2025 at 18:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605219419">PR review</a>.</p>



<a name="565051554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051554">(Dec 22 2025 at 18:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640811460">PR review comment</a>:</p>
<blockquote>
<p>Ah, good point -- fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>
</blockquote>



<a name="565051576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051576">(Dec 22 2025 at 18:21)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605220260">PR review</a>.</p>



<a name="565051577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051577">(Dec 22 2025 at 18:21)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640812166">PR review comment</a>:</p>
<blockquote>
<p>Good point, thanks -- fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>
</blockquote>



<a name="565051607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051607">(Dec 22 2025 at 18:21)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605221143">PR review</a>.</p>



<a name="565051611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565051611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565051611">(Dec 22 2025 at 18:21)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640812888">PR review comment</a>:</p>
<blockquote>
<p>Ah, yes, that was a copy-paste leftover -- fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>
</blockquote>



<a name="565052003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565052003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565052003">(Dec 22 2025 at 18:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605231934">PR review</a>.</p>



<a name="565052004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565052004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565052004">(Dec 22 2025 at 18:24)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#discussion_r2640821895">PR review comment</a>:</p>
<blockquote>
<p>Yes, good point. Fixed in fac011ac15ccdef503841b073b1886215bd43bb2.</p>
</blockquote>



<a name="565067698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565067698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565067698">(Dec 22 2025 at 20:44)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565068191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565068191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565068191">(Dec 22 2025 at 20:49)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565068289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565068289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565068289">(Dec 22 2025 at 20:50)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3684112072">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Awesome, thanks @alexcrichton for that fix! Updated and added a test with an early drop of debugger/store.</p>
</blockquote>



<a name="565069116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565069116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565069116">(Dec 22 2025 at 20:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605706420">PR review</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> from me (I defer to you/Nick to possibly await his approval too)</p>
</blockquote>



<a name="565071619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565071619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565071619">(Dec 22 2025 at 21:21)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3684224163">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Thanks! I'll go ahead and merge and we can always tweak anything we need as we build on top of this.</p>
</blockquote>



<a name="565096020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565096020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565096020">(Dec 23 2025 at 04:06)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3685012187">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>CI failure on i686 (i.e., pulley32) is due to a problem with <code>PreserveAll</code> interacting poorly with Pulley's call1/2/3/4 optimization; #12213 fixes (tested locally). Will merge that here once that PR lands.</p>
</blockquote>



<a name="565203362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565203362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565203362">(Dec 23 2025 at 19:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#pullrequestreview-3605706420">PR review</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> from me (I defer to you/Nick to possibly await his approval too)</p>
</blockquote>



<a name="565203365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565203365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565203365">(Dec 23 2025 at 19:23)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565203388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565203388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565203388">(Dec 23 2025 at 19:23)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565212458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565212458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565212458">(Dec 23 2025 at 21:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3687966604">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>The CI error there is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Running</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="s">"curl"</span><span class="w"> </span><span class="s">"--user-agent"</span><span class="w"> </span><span class="s">"bytecodealliance/wasmtime auto-publish script"</span><span class="w"> </span><span class="s">"https://crates.io/api/v1/crates/wasmtime-internal-debugger/owners"</span><span class="err">`</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">2599</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">publish</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">623</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span>

<span class="nc">crate</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">debugger</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">owned</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">publish</span><span class="p">,</span><span class="w"> </span><span class="n">please</span><span class="w"> </span><span class="n">run</span><span class="p">:</span>

<span class="w">    </span><span class="nc">cargo</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">publish</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">debugger</span>

<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>notably we verify that all crates are owned by <code>wasmtime-publish</code> and already published to <a href="http://crates.io">crates.io</a> -- this ensures the auto-publish later succeeds. Can you publish a stub crate and invite the <code>wasmtime-publish</code> owner?</p>
</blockquote>



<a name="565215641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565215641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565215641">(Dec 23 2025 at 21:41)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688039342">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Yep, I've just published <a href="https://crates.io/crates/wasmtime-internal-debugger/">the crate</a> and invited <code>wasmtime-publish</code> -- let me know when ready to re-attempt landing.</p>
</blockquote>



<a name="565220509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565220509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565220509">(Dec 23 2025 at 22:43)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688148897">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>I'm not sure I understand the failure now -- I added <code>wasmtime-publish</code> and it shows as an owner; I removed myself as an owner; it's still failing. @alexcrichton any ideas?</p>
</blockquote>



<a name="565221594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565221594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565221594">(Dec 23 2025 at 22:51)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688159771">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Oh that's wasmtime-publish-the-github-team not wasmtime-publish-the-github user. If you run <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/20472786270/job/58831624617#step:6:2009">the comment it printed out</a> it should be resolved</p>
</blockquote>



<a name="565223200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565223200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565223200">(Dec 23 2025 at 23:06)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3688178417">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Hmm. Unfortunately I removed myself from the crate after <code>wasmtime-publish</code> accepted the invite. So I'm not able to make any more permissions changes.</p>
<p>Do you have credentials for that user so you can log in and invite the team? Or have we lost the crate name forever?</p>
<p>(FWIW, I want to reiterate my <a href="https://github.com/bytecodealliance/wasmtime/pull/12163#issuecomment-3662737163">suggestion from earlier</a> that we have a runbook for all of this now that we have such a complex publishing and permissions scheme, because this was all very ambiguous and undocumented to me)</p>
</blockquote>



<a name="565302713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565302713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565302713">(Dec 24 2025 at 17:13)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3690265923">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Yeah the BA has a 1password with credentials for wasmtime-publish (that's how I accepted the invite in the first place). I added the team. Agreed this can be documented better (like pretty much everything else infrastructure-related), and it's something I hope to handle in January with the move to trusted publishing.</p>
</blockquote>



<a name="565309492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565309492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565309492">(Dec 24 2025 at 18:47)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565309500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565309500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565309500">(Dec 24 2025 at 18:47)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<a name="565309516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565309516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565309516">(Dec 24 2025 at 18:48)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12183#issuecomment-3690373690">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="565311742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312183%20Debugger%3A%20add%20top-level%20crate%20and%20as.../near/565311742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312183.20Debugger.3A.20add.20top-level.20crate.20and.20as.2E.2E.2E.html#565311742">(Dec 24 2025 at 19:22)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12183">PR #12183</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>