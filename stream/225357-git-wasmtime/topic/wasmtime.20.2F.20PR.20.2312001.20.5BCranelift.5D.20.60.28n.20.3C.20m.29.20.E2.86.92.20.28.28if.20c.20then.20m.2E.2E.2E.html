<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12001 [Cranelift] `(n &lt; m) → ((if c then m... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html">wasmtime / PR #12001 [Cranelift] `(n &lt; m) → ((if c then m...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="554248814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554248814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554248814">(Nov 07 2025 at 06:52)</a>:</h4>
<p>bongjunj opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12001">PR #12001</a> from <code>bongjunj:select_slt_falase</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>…= false`</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="554248815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554248815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554248815">(Nov 07 2025 at 06:52)</a>:</h4>
<p><strong>bongjunj</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12001">PR #12001</a>.</p>



<a name="554248817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554248817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554248817">(Nov 07 2025 at 06:52)</a>:</h4>
<p><strong>bongjunj</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12001">PR #12001</a>.</p>



<a name="554277747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554277747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554277747">(Nov 07 2025 at 09:45)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#issuecomment-3501548402">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12001">PR #12001</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="554380741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554380741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554380741">(Nov 07 2025 at 17:40)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#pullrequestreview-3435421095">PR review</a>:</p>
<blockquote>
<p>Thanks again for finding another missing optimization! Comment below with a suggested way to do this a little differently.</p>
</blockquote>



<a name="554380904"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554380904" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554380904">(Nov 07 2025 at 17:41)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#discussion_r2504761070">PR review comment</a>:</p>
<blockquote>
<p>It might make sense to add a general rule to dedupe selects, something like this:</p>
<div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">slt</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">select</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span>
<span class="w">                        </span><span class="p">(</span><span class="nv">select</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">d</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="nv">select</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="p">(</span><span class="nv">slt</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span>
<span class="w">                      </span><span class="p">(</span><span class="nv">slt</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">d</span><span class="p">)))</span>
</code></pre></div>
<p>I think this could be an intermediate step that would reveal optimization possibilities for existing small rules and effectively subsume this larger rule. I think this is also beneficial on its own, since <code>select</code>s should generally be more expensive than <code>slt</code>s (although I am not sure that our cost functions encode that at the moment), so I'm not worried about unnecessarily blowing up the enode count in this case.</p>
<p>All that said, we would really want the equivalent of this rule for ~all operators, not just <code>slt</code>:</p>
<div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">iadd</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">select</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span>
<span class="w">                         </span><span class="p">(</span><span class="nv">select</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">d</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="nv">select</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="p">(</span><span class="nv">iadd</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span>
<span class="w">                      </span><span class="p">(</span><span class="nv">iadd</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nb">cond</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">d</span><span class="p">)))</span>
</code></pre></div>
<p>And all those rules would be annoying to write in ISLE today without macros or higher-order terms.</p>
<p>But then again, roughly the same could be said about this rule as-is (it is combining a cprop rule, a <code>x &lt; x ==&gt; false</code> rule, and the pull-selects-out rule I sketched above; we could do the same kind of thing for all other operators' rules by combining them with their own version of the pull-selects-out rule).</p>
<p>So after writing all this out, I think I have convinced myself that my proposed intermediate rule is the way to go, rather than writing out the "combined" rule as you have here. (And we don't need to add all the other operator variants of that rule now, but probably should eventually.) But we should check that adding that rule really is enough to do the "combined" rewrite you've proposed in this PR. We should be able to check that via your existing tests.</p>
<p>Does all that make sense?</p>
</blockquote>



<a name="554380911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554380911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554380911">(Nov 07 2025 at 17:41)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#pullrequestreview-3435421987">PR review</a>.</p>



<a name="554386688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554386688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554386688">(Nov 07 2025 at 18:08)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#pullrequestreview-3435549130">PR review</a>.</p>



<a name="554386691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554386691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554386691">(Nov 07 2025 at 18:08)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#discussion_r2504861078">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>(although I am not sure that our cost functions encode that at the moment)</p>
</blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/12006">https://github.com/bytecodealliance/wasmtime/pull/12006</a></p>
</blockquote>



<a name="554566881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554566881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554566881">(Nov 09 2025 at 14:31)</a>:</h4>
<p>bongjunj submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#pullrequestreview-3440068578">PR review</a>.</p>



<a name="554566882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554566882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554566882">(Nov 09 2025 at 14:31)</a>:</h4>
<p>bongjunj created <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#discussion_r2508092790">PR review comment</a>:</p>
<blockquote>
<p>Hi, just want to let you know it could take a while to leave my thoughts here due to my schedule. Gonna come back later soon! Thanks for your thoughtful comment.</p>
</blockquote>



<a name="554599158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554599158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554599158">(Nov 09 2025 at 23:13)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#pullrequestreview-3440422009">PR review</a>.</p>



<a name="554599159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/554599159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#554599159">(Nov 09 2025 at 23:13)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12001#discussion_r2508386633">PR review comment</a>:</p>
<blockquote>
<p>For sure, no rush! I’m out of office visiting family for a week or so, so I will also be slow to respond </p>
</blockquote>



<a name="555061340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312001%20%5BCranelift%5D%20%60%28n%20%3C%20m%29%20%E2%86%92%20%28%28if%20c%20then%20m.../near/555061340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312001.20.5BCranelift.5D.20.60.28n.20.3C.20m.29.20.E2.86.92.20.28.28if.20c.20then.20m.2E.2E.2E.html#555061340">(Nov 12 2025 at 08:52)</a>:</h4>
<p>bongjunj edited <a href="https://github.com/bytecodealliance/wasmtime/pull/12001">PR #12001</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>