<html>
<head><meta charset="utf-8"><title>wasmtime / issue #1068 Cranelift: support aggregate types... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html">wasmtime / issue #1068 Cranelift: support aggregate types...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="281216935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/281216935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#281216935">(May 04 2022 at 20:43)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Hello there, I have a slightly trivial question.</p>
<p>How does one represent a structure in Cranelift IR? I know that structures are more-or-less a virtual concept and can be introduced "virtually", by representing parts of them as different objects in memory. However, what if one wants to inter-operate with C library APIs that require passing a structure? As far as I understand, some strict memory layout standard should be followed with correct paddings and organisation. </p>
<p>Is there any easy way of doing this? Thanks!</p>
</blockquote>



<a name="281216941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/281216941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#281216941">(May 04 2022 at 20:43)</a>:</h4>
<p>cfallin labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Hello there, I have a slightly trivial question.</p>
<p>How does one represent a structure in Cranelift IR? I know that structures are more-or-less a virtual concept and can be introduced "virtually", by representing parts of them as different objects in memory. However, what if one wants to inter-operate with C library APIs that require passing a structure? As far as I understand, some strict memory layout standard should be followed with correct paddings and organisation. </p>
<p>Is there any easy way of doing this? Thanks!</p>
</blockquote>



<a name="281216947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/281216947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#281216947">(May 04 2022 at 20:43)</a>:</h4>
<p>cfallin labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Hello there, I have a slightly trivial question.</p>
<p>How does one represent a structure in Cranelift IR? I know that structures are more-or-less a virtual concept and can be introduced "virtually", by representing parts of them as different objects in memory. However, what if one wants to inter-operate with C library APIs that require passing a structure? As far as I understand, some strict memory layout standard should be followed with correct paddings and organisation. </p>
<p>Is there any easy way of doing this? Thanks!</p>
</blockquote>



<a name="340083518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/340083518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#340083518">(Mar 07 2023 at 11:30)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-1458007264">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Should we close this as out of scope? We already removed the heap concept used to represent the webassembly linear memory. It should be possible to write an external crate for convenient handling of higher level types which desugars struct accesses into primitive accesses.</p>
</blockquote>



<a name="340179995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/340179995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#340179995">(Mar 07 2023 at 18:18)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-1458622862">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Yeah, I think that in the three years (!) since the above discussion, we've come to a clearer consensus about the level of abstraction in CLIF. Namely, we have a view of the world that consists of primitive integer/float types, and loads/stores; and higher-level abstractions can be built from those by the producer. This is explicitly lower-level than LLVM, where one does have a notion of aggregate types and the compiler is responsible for computing their layout. Having only register-sized values makes many things simpler here.</p>
<p>So I'll go ahead and close this as @bjorn3 suggests but anyone please do feel free to leave a note here if there is a compelling argument for this that we've missed.</p>
</blockquote>



<a name="340179997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/340179997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#340179997">(Mar 07 2023 at 18:18)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Hello there, I have a slightly trivial question.</p>
<p>How does one represent a structure in Cranelift IR? I know that structures are more-or-less a virtual concept and can be introduced "virtually", by representing parts of them as different objects in memory. However, what if one wants to inter-operate with C library APIs that require passing a structure? As far as I understand, some strict memory layout standard should be followed with correct paddings and organisation. </p>
<p>Is there any easy way of doing this? Thanks!</p>
</blockquote>



<a name="372992551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/372992551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#372992551">(Jul 06 2023 at 18:47)</a>:</h4>
<p>simvux <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-1624157763">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>Would it not make sense to support aggregate types in the <code>cranelift_frontend</code> crate as it aims to provide an optional convenience on top of <code>cranelift_codegen</code>? </p>
<p>Or would it be out of scope since it requires a bit more logic than just being a builder pattern wrapper</p>
</blockquote>



<a name="372998561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/372998561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#372998561">(Jul 06 2023 at 19:14)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-1624188378">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>In principle it could be, but I think over time we've converged on <code>cranelift_frontend</code> being mostly a wrapper around SSA construction -- it doesn't really have much else in the way of "semantic lowering".</p>
<p>It's possible we could add another abstraction layer -- <code>cranelift_values</code> or <code>cranelift_struct_abi</code> or something -- that has its own type system that is a superset of core CLIF's, and can handle aggregate types and match the native C ABI for passing them as args and returns. Perhaps part of the reason this doesn't exist yet is that as one moves up the abstraction layers, details start to become application-specific -- for example, a C compiler using Cranelift may want exactly what was just described, but <code>cg_clif</code> has its own ABI details that it imports from <code>rustc</code> and associated support code and data model.</p>
<p>If you're interested in designing and building such a thing, I think we'd be open to at least helping with the design. It might make sense to build it out-of-tree first, and if it becomes useful for a large number of users then it could eventually move in-tree.</p>
</blockquote>



<a name="499646851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/499646851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#499646851">(Feb 14 2025 at 05:47)</a>:</h4>
<p>fiveseven-lambda <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-2658341229">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>In LLVM IR, a function can return a structure:</p>
<div class="codehilite" data-code-language="LLVM"><pre><span></span><code><span class="k">define</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="vg">@func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">ret</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Is there an equivalent way to return a structure in Cranelift?</p>
<p>From what I understand, Cranelift provides ways to compute field addresses using a struct's address and alignment. However, this alone does not seem sufficient to directly return a structure from a function.<br>
</p>
</blockquote>



<a name="499670259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/499670259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#499670259">(Feb 14 2025 at 08:25)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-2658575568">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>You can have multiple return values. This is equivalent to returning a struct in LLVM IR.</p>
</blockquote>



<a name="499671220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231068%20Cranelift%3A%20support%20aggregate%20types.../near/499671220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231068.20Cranelift.3A.20support.20aggregate.20types.2E.2E.2E.html#499671220">(Feb 14 2025 at 08:29)</a>:</h4>
<p>fiveseven-lambda <a href="https://github.com/bytecodealliance/wasmtime/issues/1068#issuecomment-2658586555">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1068">issue #1068</a>:</p>
<blockquote>
<p>@bjorn3 Oh! Thank you.</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>