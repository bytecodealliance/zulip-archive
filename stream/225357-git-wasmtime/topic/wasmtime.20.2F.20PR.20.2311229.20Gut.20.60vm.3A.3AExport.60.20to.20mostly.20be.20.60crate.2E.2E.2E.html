<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11229 Gut `vm::Export` to mostly be `crate... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html">wasmtime / PR #11229 Gut `vm::Export` to mostly be `crate...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="528417396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528417396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528417396">(Jul 11 2025 at 23:32)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a> from <code>alexcrichton:less-exports</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This series of commits removes all of the <code>vm::Export*</code> types from Wasmtime. These were all relatively unsafe types which were schlepping around unsafe pointers from point A to point B. In lieu of this and given prior refactorings this commit replaces all of these items with the top-level crate definitions (e.g. <code>crate::Func</code> instead of <code>ExportFunc</code>). The goal here is to improve safety and generally reduce <code>unsafe</code> functions and blocks necessary. A nice benefit is that from a <code>vm::Instance</code> you can now directly load all top-level types such as <code>crate::Table</code>.</p>
</blockquote>



<a name="528417397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528417397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528417397">(Jul 11 2025 at 23:32)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>.</p>



<a name="528417398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528417398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528417398">(Jul 11 2025 at 23:32)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>.</p>



<a name="528419422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528419422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528419422">(Jul 12 2025 at 00:09)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>.</p>



<a name="528428095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528428095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528428095">(Jul 12 2025 at 03:16)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#issuecomment-3064574037">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api", "wasmtime:ref-types"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: wasmtime:ref-types</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="528720489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528720489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528720489">(Jul 14 2025 at 18:45)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#pullrequestreview-3017251962">PR review</a>:</p>
<blockquote>
<p>LGTM modulo one safety comment/question below that should be addressed before merging</p>
</blockquote>



<a name="528720491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528720491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528720491">(Jul 14 2025 at 18:45)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#discussion_r2205490169">PR review comment</a>:</p>
<blockquote>
<p>yesss</p>
</blockquote>



<a name="528720492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528720492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528720492">(Jul 14 2025 at 18:45)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#discussion_r2205583083">PR review comment</a>:</p>
<blockquote>
<p>Can we actually encapsulate the unsafety here? Because <code>from_vm_func_ref</code> requires that the store owns the given funcref, but because we take the store as an argument but get the funcref from <code>self</code>, we don't technically have the guarantee that the given store owns this funcref. So I think either this function should be <code>unsafe</code> because it relies on passing the correct <code>StoreId</code> in, or we need to get that <code>StoreId</code> from <code>self</code> somehow.</p>
</blockquote>



<a name="528720493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528720493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528720493">(Jul 14 2025 at 18:45)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#discussion_r2205501401">PR review comment</a>:</p>
<blockquote>
<p>Needs safety comment</p>
</blockquote>



<a name="528738223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528738223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528738223">(Jul 14 2025 at 20:50)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>.</p>



<a name="528738291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528738291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528738291">(Jul 14 2025 at 20:51)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#pullrequestreview-3017771072">PR review</a>.</p>



<a name="528738292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528738292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528738292">(Jul 14 2025 at 20:51)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11229#discussion_r2205798895">PR review comment</a>:</p>
<blockquote>
<p>Good point yeah, I meant to come back and fix this up but forgot to do so. It's a bit unfortunate how infectious the unsafety is here but I agree it's required to be sound regardless.</p>
</blockquote>



<a name="528738304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528738304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528738304">(Jul 14 2025 at 20:51)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>.</p>



<a name="528743626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311229%20Gut%20%60vm%3A%3AExport%60%20to%20mostly%20be%20%60crate.../near/528743626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311229.20Gut.20.60vm.3A.3AExport.60.20to.20mostly.20be.20.60crate.2E.2E.2E.html#528743626">(Jul 14 2025 at 21:29)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11229">PR #11229</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>