<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11354  Refine `Guard*` APIs and implementa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html">wasmtime / PR #11354  Refine `Guard*` APIs and implementa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="531919202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531919202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531919202">(Jul 30 2025 at 19:58)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a> from <code>alexcrichton:refactor-guards</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is a follow-up to <a href="https://github.com/bytecodealliance/wasmtime/pull/11325">https://github.com/bytecodealliance/wasmtime/pull/11325</a> with a number of cosmetic changes about<br>
the shape of the API and structure of the internals:</p>
<ul>
<li>
<p><code>{Stream,Future}{Reader,Writer}::guard</code> is now an alternative<br>
  constructor to <code>Guard*::new</code> (import fewer types).</p>
</li>
<li>
<p>Internally <code>WithAccessor</code> and <code>DropWithStore</code> are removed in favor of<br>
  direct <code>Drop for Guard*</code> impls.</p>
</li>
<li>
<p>An <code>Option</code> is used to replace <code>ManuallyDrop</code> and <code>unsafe</code> code.</p>
</li>
<li>
<p><code>{Stream,Future}{Reader,Writer}::close{,_with}</code> now take <code>&amp;mut self</code><br>
  instead of <code>self</code> to be more composable with <code>&amp;mut self</code> arguments<br>
  during <code>Drop</code> for other structures (e.g. build-your-own<br>
  drop-with-store).</p>
</li>
<li>
<p>The type parameters on <code>Guard*</code> are simplified to just <code>T</code>, the future<br>
  or stream payload, and <code>A: AsAccessor</code>. This helps cut down on the<br>
  complexity of signatures.</p>
</li>
<li>
<p><code>Guard*</code> types now have <code>into_{stream,future}</code> as an alternative to<br>
<code>.into()</code> which doesn't require type annotations.</p>
</li>
</ul>
</blockquote>



<a name="531919203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531919203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531919203">(Jul 30 2025 at 19:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531919204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531919204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531919204">(Jul 30 2025 at 19:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531919254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531919254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531919254">(Jul 30 2025 at 19:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/dicej">dicej</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531919290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531919290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531919290">(Jul 30 2025 at 19:59)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11354#issuecomment-3137646116">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>:</p>
<blockquote>
<p>I'll note the first commit here is from <a href="https://github.com/bytecodealliance/wasmtime/pull/11351">https://github.com/bytecodealliance/wasmtime/pull/11351</a>, so only the second commit is for this PR</p>
</blockquote>



<a name="531932551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531932551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531932551">(Jul 30 2025 at 21:19)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531932552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531932552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531932552">(Jul 30 2025 at 21:19)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531932553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531932553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531932553">(Jul 30 2025 at 21:19)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531932554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531932554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531932554">(Jul 30 2025 at 21:19)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531932555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531932555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531932555">(Jul 30 2025 at 21:19)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531935984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531935984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531935984">(Jul 30 2025 at 21:41)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11354#pullrequestreview-3073414568">PR review</a>:</p>
<blockquote>
<p>LGTM, although I am not super familiar with this code</p>
</blockquote>



<a name="531936195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531936195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531936195">(Jul 30 2025 at 21:42)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<a name="531936226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/531936226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#531936226">(Jul 30 2025 at 21:42)</a>:</h4>
<p>alexcrichton edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11354#issuecomment-3137646116">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>:</p>
<blockquote>
<p><del>I'll note the first commit here is from <a href="https://github.com/bytecodealliance/wasmtime/pull/11351">https://github.com/bytecodealliance/wasmtime/pull/11351</a>, so only the second commit is for this PR</del> EDIT: prereqs landed</p>
</blockquote>



<a name="532081502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/532081502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#532081502">(Jul 31 2025 at 13:56)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11354#pullrequestreview-3075549881">PR review</a>.</p>



<a name="532094054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311354%20%20Refine%20%60Guard%2A%60%20APIs%20and%20implementa.../near/532094054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311354.20.20Refine.20.60Guard.2A.60.20APIs.20and.20implementa.2E.2E.2E.html#532094054">(Jul 31 2025 at 14:45)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11354">PR #11354</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>