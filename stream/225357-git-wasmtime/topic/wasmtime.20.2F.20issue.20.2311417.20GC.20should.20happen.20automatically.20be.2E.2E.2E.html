<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11417 GC should happen automatically be... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311417.20GC.20should.20happen.20automatically.20be.2E.2E.2E.html">wasmtime / issue #11417 GC should happen automatically be...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="533900877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311417%20GC%20should%20happen%20automatically%20be.../near/533900877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311417.20GC.20should.20happen.20automatically.20be.2E.2E.2E.html#533900877">(Aug 12 2025 at 03:37)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11417">issue #11417</a>:</p>
<blockquote>
<p>When a GC allocation fails in Wasmtime right now the current algorithm is to (a) grow the heap and (b) failing that perform a GC. This means that practically all applications will, by default, grow the entire GC heap to 4GB before any GC actually happens. This has an unfortunate side effect of meaning that we very rarely test GC behavior outside of explicit GC calls right now in tests and fuzzing (otherwise I would presume issues in <a href="https://github.com/bytecodealliance/wasmtime/pull/11416">https://github.com/bytecodealliance/wasmtime/pull/11416</a> would have been caught sooner?). This additionally means that applications which have a small working set of memory but a large amount of churn will have a very large memory footprint as the heap grows.</p>
<p>I think this is something we'll want to tune over time, but by default I think that a GC should happen with some amount of balance before reaching the limit of linear memory. I'm not sure what a good heuristic is, but I feel that our current heuristic isn't the right default.</p>
</blockquote>



<a name="533900878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311417%20GC%20should%20happen%20automatically%20be.../near/533900878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311417.20GC.20should.20happen.20automatically.20be.2E.2E.2E.html#533900878">(Aug 12 2025 at 03:37)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:gc label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11417">Issue #11417</a>.</p>



<a name="534024277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311417%20GC%20should%20happen%20automatically%20be.../near/534024277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311417.20GC.20should.20happen.20automatically.20be.2E.2E.2E.html#534024277">(Aug 12 2025 at 17:15)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/11417#issuecomment-3180272994">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11417">issue #11417</a>:</p>
<blockquote>
<p>Perhaps a decent heuristic could be: when we hit the GC heap limit, GC first, then if the heap occupancy after GC is over a threshold (50%? tunable knob?) then grow?</p>
<p>I wonder if this could be a reason that we see large slowdowns in allocation-heavy benchmarks currently: even if growth is in-place (virtual memory-based GC store), growth-first guarantees cache misses on every new object, while a benchmark with a small working set that could fit in cache would otherwise be much happier with address reuse after a GC. (This trades off with the time to do the GC, of course!)</p>
</blockquote>



<a name="534025203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311417%20GC%20should%20happen%20automatically%20be.../near/534025203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311417.20GC.20should.20happen.20automatically.20be.2E.2E.2E.html#534025203">(Aug 12 2025 at 17:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11417#issuecomment-3180292851">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11417">issue #11417</a>:</p>
<blockquote>
<p>That seems reasonable to me yeah. While I'm sure caches are indeed an issue historical profiling has also shown that <a href="https://github.com/bytecodealliance/wasmtime/issues/11159">https://github.com/bytecodealliance/wasmtime/issues/11159</a> is a major slodown -- basically the allocation algorithm right now is pretty non-optimal.</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>