<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11837 fuzzing: Fix division by zero when r... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html">wasmtime / PR #11837 fuzzing: Fix division by zero when r...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="544318286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544318286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544318286">(Oct 11 2025 at 12:45)</a>:</h4>
<p>jiang1997 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a> from <code>jiang1997:structnew-limit-guard</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>libFuzzer can mutate serialized bytes to create states where operations reference non-existent resources (LocalGet with num_params=0, etc). This caused panics when fixup() tried to normalize indices via modulo.</p>
<p>Fix by replacing these operations with equivalent ones before fixup():</p>
<ul>
<li>LocalGet/GlobalGet → Null (when params/globals = 0)</li>
<li>LocalSet/GlobalSet → Drop (when params/globals = 0)</li>
<li>StructNew → Drop (when max_types = 0)</li>
</ul>
<p>This preserves stack effects and ensures generated Wasm is always valid.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="544318289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544318289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544318289">(Oct 11 2025 at 12:45)</a>:</h4>
<p><strong>jiang1997</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>.</p>



<a name="544318290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544318290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544318290">(Oct 11 2025 at 12:45)</a>:</h4>
<p><strong>jiang1997</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>.</p>



<a name="544320259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544320259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544320259">(Oct 11 2025 at 13:09)</a>:</h4>
<p>jiang1997 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>.</p>



<a name="544326548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544326548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544326548">(Oct 11 2025 at 14:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/11837#issuecomment-3393392407">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="544600311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544600311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544600311">(Oct 13 2025 at 17:53)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11837#pullrequestreview-3332538137">PR review</a>:</p>
<blockquote>
<p>Thanks! A couple things to address below before we merge this.</p>
</blockquote>



<a name="544600312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544600312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544600312">(Oct 13 2025 at 17:53)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11837#discussion_r2426979369">PR review comment</a>:</p>
<blockquote>
<p>Because this is inside a submodule of the module where <code>TableOps::fixup</code> is defined, we can just call it directly, instead of doing it indirectly via <code>to_wasm_binary</code> and then ignoring the resulting Wasm binary:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        ops.fixup();
</code></pre></div><br>
</p>
</blockquote>



<a name="544600313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544600313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544600313">(Oct 13 2025 at 17:53)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11837#discussion_r2426974838">PR review comment</a>:</p>
<blockquote>
<p><em>If</em> we are going to attempt to replace invalid ops with new ones that have the same type signature (i.e. pop the same operand types from the stack and then push the same type of results) then we should actually do that for <code>StructNew</code>: insert <code>fields.len()</code> <code>drop</code> instructions (currently always 0 since the struct support is still WIP) and then a <code>ref.null struct</code> instruction to produce the ~same result type (will be abstract instead of concrete, but this is the closest we can get without defining concrete types).</p>
<p>But I could see this code becoming a little bit of a hassle/burden as time goes on and we extend this fuzz target to cover all of the GC proposal. So another option would be to simply continue to the next iteration of the loop in these cases, and let each <code>op.fixup(...)</code> call deal with the fallout of the changes to the operand stack (since they have to do that anyways due to random mutations to the op sequence).</p>
</blockquote>



<a name="544600347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544600347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544600347">(Oct 13 2025 at 17:53)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11837#issuecomment-3398519009">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>:</p>
<blockquote>
<p>cc @khagankhan </p>
</blockquote>



<a name="544806729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544806729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544806729">(Oct 14 2025 at 17:44)</a>:</h4>
<p>jiang1997 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>.</p>



<a name="544806804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544806804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544806804">(Oct 14 2025 at 17:44)</a>:</h4>
<p>jiang1997 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>:</p>
<blockquote>
<p>Fix by filtering out problematic operations before fixup() runs:</p>
<ul>
<li>Skip StructNew when max_types = 0</li>
<li>Skip LocalGet/LocalSet when num_params = 0</li>
<li>Skip GlobalGet/GlobalSet when num_globals = 0</li>
</ul>
<p>This prevents the division by zero and ensures generated Wasm is valid.</p>
</blockquote>



<a name="544809422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544809422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544809422">(Oct 14 2025 at 18:00)</a>:</h4>
<p><strong>jiang1997</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11837">PR #11837</a>.</p>



<a name="544811284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311837%20fuzzing%3A%20Fix%20division%20by%20zero%20when%20r.../near/544811284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311837.20fuzzing.3A.20Fix.20division.20by.20zero.20when.20r.2E.2E.2E.html#544811284">(Oct 14 2025 at 18:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11837#pullrequestreview-3336898386">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>