<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10348 meta: deduplicate source generation ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html">wasmtime / PR #10348 meta: deduplicate source generation ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="503856728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503856728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503856728">(Mar 06 2025 at 17:59)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a> from <code>abrown:assembler-deduplicate-srcgen</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>When building the new <code>cranelift-assembler-x64</code> crate, I duplicated some <code>Formatter</code> functionality that we were using in <code>cranelift-codegen-meta</code> to generate both Rust and ISLE code. This change splits out that functionality into a separate crate that both <code>cranelift-assembler-x64</code> and <code>cranelift-codegen-meta</code> can depend on without depending on each other.</p>
<p>While doing this, I rationalized the divergence that had happened between both copies of <code>Formatter</code>; more details are noted in the commit messages. As a part of all of this, I will highlight that the <code>Formatter</code> now knows which language it is emitting (Rust or ISLE) and how to emit Rust brace-delimited blocks, a wide-ranging change.</p>
<p>All of this is to support the same goal as <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">https://github.com/bytecodealliance/wasmtime/pull/10334</a>. To avoid <code>OUT_DIR</code> issues, I believe we should move the ISLE generation from <code>cranelift-assembler-x64</code> to <code>cranelift-codegen-meta</code> (with the rest of the ISLE wrangling). This PR is a first step in that direction by sorting out the crate dependencies.</p>
</blockquote>



<a name="503856731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503856731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503856731">(Mar 06 2025 at 17:59)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503856732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503856732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503856732">(Mar 06 2025 at 17:59)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503856733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503856733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503856733">(Mar 06 2025 at 17:59)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503858094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503858094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503858094">(Mar 06 2025 at 18:05)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10348#pullrequestreview-2665257595">PR review</a>.</p>



<a name="503858095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503858095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503858095">(Mar 06 2025 at 18:05)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10348#discussion_r1983833587">PR review comment</a>:</p>
<blockquote>
<p>It felt to me that this kind of crate isn't the same as the other Cranelift crates in terms of versioning, but I suspect we will have to give it a <code>0.119.0</code> version just to get it to pass the <code>publish.rs</code> script? I noticed that some fuzzing infrastructure crate had a <code>0.0.0</code> version but perhaps that isn't published?</p>
</blockquote>



<a name="503858248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503858248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503858248">(Mar 06 2025 at 18:06)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10348#pullrequestreview-2665259178">PR review</a>.</p>



<a name="503858249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503858249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503858249">(Mar 06 2025 at 18:06)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10348#discussion_r1983834487">PR review comment</a>:</p>
<blockquote>
<p>Oh, and vets... we'll probably need vets for this.</p>
</blockquote>



<a name="503858728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503858728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503858728">(Mar 06 2025 at 18:09)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503908249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503908249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503908249">(Mar 06 2025 at 23:01)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10348#pullrequestreview-2665729280">PR review</a>:</p>
<blockquote>
<p>This is really nice; thanks for the cleanups/refactors!</p>
</blockquote>



<a name="503908250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503908250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503908250">(Mar 06 2025 at 23:01)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10348#discussion_r1984108701">PR review comment</a>:</p>
<blockquote>
<p>Yep, I think the version-bumping automation will fall down otherwise. Also there's <a href="https://github.com/bytecodealliance/wasmtime/blob/ddaaed60aea235b7047de25db050224d26a28060/scripts/publish.rs#L19">this</a> list of crates to publish that will need an update.</p>
</blockquote>



<a name="503923620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503923620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503923620">(Mar 07 2025 at 00:59)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503923696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503923696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503923696">(Mar 07 2025 at 01:00)</a>:</h4>
<p>abrown has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503931650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503931650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503931650">(Mar 07 2025 at 02:11)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503931799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503931799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503931799">(Mar 07 2025 at 02:12)</a>:</h4>
<p>abrown has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<a name="503935329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310348%20meta%3A%20deduplicate%20source%20generation%20.../near/503935329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310348.20meta.3A.20deduplicate.20source.20generation.20.2E.2E.2E.html#503935329">(Mar 07 2025 at 02:48)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10348">PR #10348</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>