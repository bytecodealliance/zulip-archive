<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10334 Generate x64 assembler definitions i... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html">wasmtime / PR #10334 Generate x64 assembler definitions i...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="503482618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503482618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503482618">(Mar 05 2025 at 11:05)</a>:</h4>
<p>adambratschikaye opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a> from <code>adambratschikaye:abk/move-assembler-x64-generation</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Generate <code>assembler-definitions.isle</code> during build of <code>cranelift-codegen</code> instead of <code>cranelift-assembler-x64</code>. The problem with generating it in <code>cranelift-assembler-x64</code> is that that setup requires <code>cranelift-codegen</code> to have access to the <code>OUT_DIR</code> used by <code>cranelift-assembler-x64</code> which is prevented when building under Bazel which tries to isolate the builds of separate crates.</p>
<p>This change instead adds a function to <code>cranelift-assembler-x64</code> which returns the expected contents of <code>assembler-definitions.isle</code> so that the build step of <code>cranelift-codegen</code> can write it to an accessible directory.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="503482625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503482625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503482625">(Mar 05 2025 at 11:05)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="503482626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503482626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503482626">(Mar 05 2025 at 11:05)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="503485285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503485285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503485285">(Mar 05 2025 at 11:18)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="503486189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503486189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503486189">(Mar 05 2025 at 11:23)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#pullrequestreview-2660798581">PR review</a>.</p>



<a name="503486190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503486190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503486190">(Mar 05 2025 at 11:23)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#discussion_r1981205180">PR review comment</a>:</p>
<blockquote>
<p>I think it would be nice if this executable kept showing a path to a file on the disk. It is for debugging only and emitting the entire file to stdout would be annoying. Maybe it could write the file to somewhere in the directory from which it is invoked?</p>
</blockquote>



<a name="503499629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503499629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503499629">(Mar 05 2025 at 12:30)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="503561394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503561394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503561394">(Mar 05 2025 at 16:10)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="503582879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503582879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503582879">(Mar 05 2025 at 17:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#pullrequestreview-2661830717">PR review</a>:</p>
<blockquote>
<p>Thank you for submitting this change; I would like to suggest another approach here but I want to make it clear that this looks fine to me as a temporary measure. In thinking about generating the ISLE definitions, I realized recently that they are quite <code>cranelift-codegen</code>-specific. I think that, if we move the ISLE generation out of the <code>cranelift-assembler-x64-meta</code> crate and directly into the <code>cranelift-codegen-meta</code> crate, we not only fix this <code>OUT_DIR</code> issue that affects Bazel builds but it's better code organization. All ISLE compilation/generation lives in <code>cranelift-codegen-meta</code> already, so why not move the assembler part of that to the same place? I recognize that may be a larger refactor than this PR and I'm willing to do it since I'm most familiar with all of this. Thoughts?</p>
</blockquote>



<a name="503582880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503582880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503582880">(Mar 05 2025 at 17:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#discussion_r1981841558">PR review comment</a>:</p>
<blockquote>
<p>What's unfortunate about this change is that it loses information about the _other_ files generated for the assembler. There were three files and this forgets about two of them.</p>
</blockquote>



<a name="503714661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503714661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503714661">(Mar 06 2025 at 07:05)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="503716479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503716479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503716479">(Mar 06 2025 at 07:15)</a>:</h4>
<p>adambratschikaye submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#pullrequestreview-2663537516">PR review</a>.</p>



<a name="503716482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503716482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503716482">(Mar 06 2025 at 07:15)</a>:</h4>
<p>adambratschikaye created <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#discussion_r1982812825">PR review comment</a>:</p>
<blockquote>
<p>What about changing the <code>main</code> function back to its previous behavior (<a href="http://url">here</a>)?</p>
</blockquote>



<a name="503716968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/503716968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#503716968">(Mar 06 2025 at 07:17)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#issuecomment-2703011729">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>:</p>
<blockquote>
<blockquote>
<p>I think that, if we move the ISLE generation out of the <code>cranelift-assembler-x64-meta</code> crate and directly into the <code>cranelift-codegen-meta</code> crate, we not only fix this <code>OUT_DIR</code> issue that affects Bazel builds but it's better code organization.</p>
</blockquote>
<p>I'm not familiar enough with this part of the codebase to comment on whether it's better organization or not, but I agree it would fix the issue with Bazel builds.</p>
</blockquote>



<a name="504112401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/504112401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#504112401">(Mar 07 2025 at 14:47)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#issuecomment-2706633043">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>:</p>
<blockquote>
<p>@adambratschikaye: ok, I pushed #10352 as an alternative to this PR. Can you confirm that it fixes the build issues you were seeing in Bazel?</p>
</blockquote>



<a name="504498434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/504498434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#504498434">(Mar 10 2025 at 08:03)</a>:</h4>
<p>adambratschikaye closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>.</p>



<a name="504498439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310334%20Generate%20x64%20assembler%20definitions%20i.../near/504498439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310334.20Generate.20x64.20assembler.20definitions.20i.2E.2E.2E.html#504498439">(Mar 10 2025 at 08:03)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/10334#issuecomment-2709726561">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10334">PR #10334</a>:</p>
<blockquote>
<blockquote>
<p>@adambratschikaye: ok, I pushed #10352 as an alternative to this PR. Can you confirm that it fixes the build issues you were seeing in Bazel?</p>
</blockquote>
<p>Yep, that fix works for us. Thanks for helping out!</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>