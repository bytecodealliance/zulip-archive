<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10110 asm: introduce a new x64 assembler · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html">wasmtime / PR #10110 asm: introduce a new x64 assembler</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="495803045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495803045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495803045">(Jan 24 2025 at 22:24)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a> from <code>abrown:assembler-upstream</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is a first step to providing an external assembler for <code>cranelift-codegen</code> as described in <a href="https://github.com/bytecodealliance/wasmtime/issues/41">https://github.com/bytecodealliance/wasmtime/issues/41</a>. Each commit has further details, but the summary is that this direction would eventually move all assembler logic out into crates designed for easier checking (e.g., fuzzing).</p>
</blockquote>



<a name="495805068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495805068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495805068">(Jan 24 2025 at 22:43)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495805946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495805946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495805946">(Jan 24 2025 at 22:52)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495806612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495806612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495806612">(Jan 24 2025 at 22:59)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495813648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495813648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495813648">(Jan 25 2025 at 00:13)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495814427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495814427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495814427">(Jan 25 2025 at 00:23)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495815764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495815764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495815764">(Jan 25 2025 at 00:39)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495816010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495816010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495816010">(Jan 25 2025 at 00:42)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2573850856">PR review</a>.</p>



<a name="495816017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495816017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495816017">(Jan 25 2025 at 00:42)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1929412393">PR review comment</a>:</p>
<blockquote>
<p>@cfallin, I'm not a big fan of this <code>KnownOffsetTable</code> approach: it seems like we may want to just add appropriate <code>CodeSink</code>/<code>MachBuffer</code> methods to propagate this kind of thing.</p>
</blockquote>



<a name="495816260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495816260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495816260">(Jan 25 2025 at 00:45)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2573854021">PR review</a>.</p>



<a name="495816261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495816261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495816261">(Jan 25 2025 at 00:45)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1929414505">PR review comment</a>:</p>
<blockquote>
<p>Looking at this CLIF diffs, I see some potential problems: removed instructions, different immediates, potential <code>and</code> -&gt; <code>or</code> miscompilations... This bears another look.</p>
</blockquote>



<a name="495816375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495816375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495816375">(Jan 25 2025 at 00:46)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495816439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495816439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495816439">(Jan 25 2025 at 00:47)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495817259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495817259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495817259">(Jan 25 2025 at 00:56)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1929414505">PR review comment</a>.</p>



<a name="495817341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495817341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495817341">(Jan 25 2025 at 00:57)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1929420713">PR review comment</a>:</p>
<blockquote>
<p>(Pretty sure those <code>add</code> -&gt; <code>or</code> "miscompilations" were just bits changing in the constant pool... not sure why they're changing, though).</p>
</blockquote>



<a name="495817344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495817344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495817344">(Jan 25 2025 at 00:57)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2573863006">PR review</a>.</p>



<a name="495818257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495818257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495818257">(Jan 25 2025 at 01:06)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495818281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495818281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495818281">(Jan 25 2025 at 01:06)</a>:</h4>
<p><strong>abrown</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a> as ready for review.</p>



<a name="495818282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495818282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495818282">(Jan 25 2025 at 01:06)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="495818283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/495818283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#495818283">(Jan 25 2025 at 01:06)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="496619493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619493">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2581581706">PR review</a>:</p>
<blockquote>
<p>This looks really really good -- thanks for spawning this idea and working to build it out!</p>
<p>Most of my feedback you already got offline as this was being built and the general shape is therefore what I'd expect and am overall quite happy with. A bunch of nits below but nothing major -- let's get this merged and we can iterate and start the migration process.</p>
<p>Thanks again!</p>
</blockquote>



<a name="496619494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619494">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934280588">PR review comment</a>:</p>
<blockquote>
<p>Could we add doc-comments here? Most are pretty obvious (<code>name</code> is indeed the name) but our general style is for all pub types to have docs. I guess documenting some of the specifics could be helpful too: does "name" mean what you would write in an assembler, or is it a unique name for a particular variant of an instruction?</p>
</blockquote>



<a name="496619495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619495">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934199834">PR review comment</a>:</p>
<blockquote>
<p>It looks like we're a little inconsistent across our crates but I think we can do:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">version</span><span class="p">.</span><span class="n">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">edition</span><span class="p">.</span><span class="n">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">rust-version</span><span class="p">.</span><span class="n">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</code></pre></div>
<p>to inherit a bit more from the top-level.</p>
</blockquote>



<a name="496619496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619496">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934284239">PR review comment</a>:</p>
<blockquote>
<p>earlier than... Cranelift execution? compiling generated Rust code from the DSL?</p>
</blockquote>



<a name="496619497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619497">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934322665">PR review comment</a>:</p>
<blockquote>
<p>Is there a part of the manual we can add a reference to that describes the validity conditions here? (I guess some are implicit e.g. in the description of <code>r</code> and <code>digit</code> implying they're mutually exclusive?)</p>
</blockquote>



<a name="496619498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619498">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934327419">PR review comment</a>:</p>
<blockquote>
<p>slightly confusing error message -- I first read it as "the bits (data content) we are encoding must match some operand's actual value", rather than "bits" in the sense of "width". Maybe "for an immediate, the encoding's expected immediate width must match the declared operand's width"?</p>
</blockquote>



<a name="496619499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619499">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934321387">PR review comment</a>:</p>
<blockquote>
<p>Can we have doc-comments on the builder methods? Some of them are fairly obvious (e.g. <code>prefix</code>) but it would be good to have one-sentence reminders on the others (<code>w</code> is the <code>REX.W</code> bit, etc) if only for LSP tooltips/hints as folks write the DSL...</p>
</blockquote>



<a name="496619500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619500">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934328912">PR review comment</a>:</p>
<blockquote>
<p>Is this how the Intel manual writes the prefix? (It wouldn't surprise me if so but...) it's a bit confusing in a little-endian world: naively I'd expect <code>0x66F0</code> to serialize as <code>F0 66 ...</code> when it's the other way around. If we're not otherwise constrained, can we write it bytewise, e.g. `0x66 0xF0 + "?</p>
</blockquote>



<a name="496619501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619501">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934331602">PR review comment</a>:</p>
<blockquote>
<p>I was surprised not to see <code>0F</code> when I got here -- so my earlier thought about how two-byte instructions are encoded was wrong. Is the plan to add <code>0F</code> when we eventually need to encode e.g. <code>0F 1B</code>, or will we expand the opcode to a u16 or u32 with length?</p>
</blockquote>



<a name="496619502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619502">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934356601">PR review comment</a>:</p>
<blockquote>
<p>Could we put this const slice alongside the <code>Feature</code> enum definition so it's easier to update/keep in sync?</p>
</blockquote>



<a name="496619503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619503">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934288691">PR review comment</a>:</p>
<blockquote>
<p>We should note here that "multi-byte opcodes" (e.g. <code>0F 1B</code> for <code>ud2</code>) are handled by defining <code>0F</code> to be a prefix and then calling the following byte <code>opcode</code> (not obvious to a casual observer otherwise how this might work).</p>
</blockquote>



<a name="496619504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619504">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934340136">PR review comment</a>:</p>
<blockquote>
<p>Are we planning to support encoding 32-bit x86 with this assembler as well eventually? (I think that'd be great if so, not that we need it in the short term) If so, do we need to make any of the descriptions over in <code>Rex</code> more general regarding size prefixes, availability of the REX prefix byte itself, etc? Also are we going to gate register availability (e.g. the top 8 of 16) on features?</p>
</blockquote>



<a name="496619506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619506">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934343663">PR review comment</a>:</p>
<blockquote>
<p>Can we add a sentence here describing how this fits into the instruction definitions -- e.g., every instruction has a format, and the format must correspond to the specific instruction encoding's expected operands?</p>
</blockquote>



<a name="496619507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619507">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934337198">PR review comment</a>:</p>
<blockquote>
<p>minor pedantry I guess but does the manual describe it as "default"? My 2025-era x86 CPU still boots up thinking it's an 8086 in 16-bit real mode...</p>
<p>"standard mode" or "expected mode of operation" maybe?</p>
</blockquote>



<a name="496619509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619509">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934364647">PR review comment</a>:</p>
<blockquote>
<p>You've probably thought about this already but just to check: is there any way we could share this code directly? E.g. depend on <code>cranelift-codegen-meta</code>, or factor out another crate (<code>cranelift/meta-utils</code>), or something like that?</p>
</blockquote>



<a name="496619510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619510">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934362182">PR review comment</a>:</p>
<blockquote>
<p>minor thing but could we put these on separate lines?</p>
</blockquote>



<a name="496619512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619512">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934371335">PR review comment</a>:</p>
<blockquote>
<p>What's the reason for the commented-out variant here -- could we add a comment describing why in the code? Or does it still need to be disabled?</p>
</blockquote>



<a name="496619513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619513">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934373907">PR review comment</a>:</p>
<blockquote>
<p>Is this for testing? If so can we add a comment saying so? (The specificity of only 2-elem arrays otherwise is somewhat surprising)</p>
</blockquote>



<a name="496619514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619514">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934358705">PR review comment</a>:</p>
<blockquote>
<p>Oh no! I think we all prefer Intel syntax and are kind of stuck with AT&amp;T only because of legacy/inertia. It might be worth listing here or somewhere else why we're doing this for now and what the plan is: e.g. will we remove this swap and update all the compile test expectations once we've migrated all instructions to the new DSL?</p>
</blockquote>



<a name="496619515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619515">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934376228">PR review comment</a>:</p>
<blockquote>
<p>Egads -- is there a way to configure Capstone to always print in decimal or hex? (Necessary evil otherwise, not your fault, just ugly)</p>
</blockquote>



<a name="496619516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619516">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934374388">PR review comment</a>:</p>
<blockquote>
<p>Can we make this a newtype wrapper (<code>pub struct KnownOffset(usize)</code>) instead?</p>
</blockquote>



<a name="496619518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619518">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934379838">PR review comment</a>:</p>
<blockquote>
<p><code>MinusRsp</code> evokes some sort of subtraction operation in my mind; maybe <code>NonRspGpr</code> or something like that?</p>
</blockquote>



<a name="496619519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619519">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934384593">PR review comment</a>:</p>
<blockquote>
<p>"from is" and ending with "are..." -- incomplete sentence?</p>
</blockquote>



<a name="496619520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619520">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934391445">PR review comment</a>:</p>
<blockquote>
<p>Totally fine to do <code>Err(PccError::UnimplementedInst)</code> for now -- I'll need to go and update this once we've moved instructions over that PCC cares about, but PCC isn't fuzzed at the moment anyway until I can make an update/fix pass...</p>
</blockquote>



<a name="496619521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496619521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496619521">(Jan 29 2025 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1934387743">PR review comment</a>:</p>
<blockquote>
<p>Perhaps! Were you thinking we'd have specific trait methods for e.g. <code>incoming_arg</code> and <code>slot_offset</code>? Or that we'd still be generic over the set of known offsets but have a query method?</p>
<p>I'm totally fine with the latter, in fact it's probably even cleaner; for the former I'd be concerned about baking details of Cranelift's ABI impl into the lower-level library and would still want to follow the analogy of a real assembler letting one define symbolic constants and use them with specific values plugged in. Happy to look at proposed diff if you have one.</p>
</blockquote>



<a name="496894000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496894000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496894000">(Jan 31 2025 at 00:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585392253">PR review</a>.</p>



<a name="496894001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496894001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496894001">(Jan 31 2025 at 00:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936493161">PR review comment</a>:</p>
<blockquote>
<p>I don't think any of the Cranelift crates use <code>version.workspace</code>; I assume that's because they exist within the overall Wasmtime workspace?</p>
</blockquote>



<a name="496894745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496894745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496894745">(Jan 31 2025 at 00:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585398001">PR review</a>.</p>



<a name="496894746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496894746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496894746">(Jan 31 2025 at 00:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936496702">PR review comment</a>:</p>
<blockquote>
<p>Ah right, I forgot about the Wasmtime-vs-Cranelift-version distinction; you're right, thanks!</p>
</blockquote>



<a name="496898308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496898308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496898308">(Jan 31 2025 at 01:02)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="496900285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496900285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496900285">(Jan 31 2025 at 01:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585458829">PR review</a>.</p>



<a name="496900286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496900286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496900286">(Jan 31 2025 at 01:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936532475">PR review comment</a>:</p>
<blockquote>
<p>This condition is in section 2.1.2 of the "Instruction Format" chapter of volume 2 of, etc., etc.: "an additional 3-bit opcode field is sometimes encoded..." That chapter may be a good start and I'll link it here but, honestly, there's a lot there and it isn't always easy to pull out all the various conditions. I just started with some pretty standard ones here to catch trivial mistakes early; the real safety is in fuzzing against a known-good disassembler.</p>
</blockquote>



<a name="496900878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496900878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496900878">(Jan 31 2025 at 01:29)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585475107">PR review</a>.</p>



<a name="496900881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496900881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496900881">(Jan 31 2025 at 01:29)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936545800">PR review comment</a>:</p>
<blockquote>
<p>There are no hex hints: e.g., <code>66 0F 54 /r ANDPD xmm1, xmm2/m128</code>. I'll switch this, retaining the <code>0x</code> hints.</p>
</blockquote>



<a name="496901091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496901091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496901091">(Jan 31 2025 at 01:31)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585477685">PR review</a>.</p>



<a name="496901092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496901092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496901092">(Jan 31 2025 at 01:31)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936547221">PR review comment</a>:</p>
<blockquote>
<p>Yeah, I just didn't need it at the moment. I would say that it could be completely valid to also expand the opcode width, but let's see what we think when we get to those instructions.</p>
</blockquote>



<a name="496901111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496901111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496901111">(Jan 31 2025 at 01:31)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="496920044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496920044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496920044">(Jan 31 2025 at 05:17)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585686905">PR review</a>.</p>



<a name="496920045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496920045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496920045">(Jan 31 2025 at 05:17)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936693780">PR review comment</a>:</p>
<blockquote>
<p>Yeah, true 32-bit support requires a bit more work. Since I had received the request to at least consider it, though, I thought that the first and quite crucial step is to set up instructions to be gated on 32-bit support.</p>
</blockquote>



<a name="496920568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496920568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496920568">(Jan 31 2025 at 05:24)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2585696004">PR review</a>.</p>



<a name="496920569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/496920569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#496920569">(Jan 31 2025 at 05:24)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1936699205">PR review comment</a>:</p>
<blockquote>
<p>I agree, we should avoid Cranelift-izing this assembler as much as possible. I guess things I don't like about the known offset table approach is that (a) we rebuild this table for every emissions and (b) building it the way I'm doing it here feels quite fragile. How long before things get out of sync with the keys used during amode conversion?!</p>
</blockquote>



<a name="497057835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497057835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497057835">(Jan 31 2025 at 17:48)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937691146">PR review comment</a>:</p>
<blockquote>
<p>Leaving it as a <code>type</code> enables us to just tag on the <code>Index&lt;KnownOffset, ...&gt;</code> to the trait and no implementation is needed for vectors and slices. Since I wasn't really in love with this part (see my initial comments above) I took a pretty minimal approach. Let's figure out the big picture for this and then we can decide whether to flesh this out more.</p>
</blockquote>



<a name="497057838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497057838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497057838">(Jan 31 2025 at 17:48)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587422753">PR review</a>.</p>



<a name="497058287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497058287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497058287">(Jan 31 2025 at 17:51)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497059380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497059380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497059380">(Jan 31 2025 at 17:57)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937719207">PR review comment</a>:</p>
<blockquote>
<p>I don't think so... it all seems to be hidden away behind a variant in <a href="https://docs.rs/capstone/latest/capstone/arch/x86/enum.ArchSyntax.html"><code>ArchSyntax</code></a>. I suspect there's more configurability possible with a more x86-specific tool like XED but we're just not ready for that yet. The upside to the fuzzing approach here, though, is that the minute we switch to another disassembler that doesn't have this representation we will see fuzz bugs and be able to remove this code.</p>
</blockquote>



<a name="497059381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497059381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497059381">(Jan 31 2025 at 17:57)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587463088">PR review</a>.</p>



<a name="497060066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060066">(Jan 31 2025 at 18:01)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587469732">PR review</a>.</p>



<a name="497060069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060069">(Jan 31 2025 at 18:01)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937723291">PR review comment</a>:</p>
<blockquote>
<p>I tried that initially but I see test failures?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">FAIL</span><span class="w"> </span><span class="n">filetests</span><span class="o">/</span><span class="n">filetests</span><span class="o">/</span><span class="n">pcc</span><span class="o">/</span><span class="n">succeed</span><span class="o">/</span><span class="n">imul</span><span class="o">-</span><span class="n">fuzzbug</span><span class="p">.</span><span class="n">clif</span><span class="p">:</span><span class="w"> </span><span class="nc">compile</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">Proof</span><span class="o">-</span><span class="n">carrying</span><span class="o">-</span><span class="n">code</span><span class="w"> </span><span class="n">validation</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">UnimplementedInst</span>
</code></pre></div>
<p>To reproduce with the <code>Err(...)</code> version: <code>cd cranelift &amp;&amp; cargo test --test filetests</code>.</p>
</blockquote>



<a name="497060221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060221">(Jan 31 2025 at 18:02)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587470965">PR review</a>.</p>



<a name="497060222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060222">(Jan 31 2025 at 18:02)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937724105">PR review comment</a>:</p>
<blockquote>
<p>No <code>and</code> in that test but it's probably used in lowering some other instruction...</p>
</blockquote>



<a name="497060341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060341">(Jan 31 2025 at 18:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587472420">PR review</a>.</p>



<a name="497060342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060342">(Jan 31 2025 at 18:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937724948">PR review comment</a>:</p>
<blockquote>
<p>Oh, I had forgotten we also had that test-suite still active -- OK, no worries, this is fine (and leave the TODO) and I'll get to it in my update pass!</p>
</blockquote>



<a name="497060524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060524">(Jan 31 2025 at 18:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587473804">PR review</a>.</p>



<a name="497060532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497060532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497060532">(Jan 31 2025 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937725758">PR review comment</a>:</p>
<blockquote>
<p>Yep, sounds good, it's at least well-tested!</p>
</blockquote>



<a name="497062900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497062900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497062900">(Jan 31 2025 at 18:19)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497065238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497065238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497065238">(Jan 31 2025 at 18:33)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587521197">PR review</a>.</p>



<a name="497065239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497065239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497065239">(Jan 31 2025 at 18:33)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937754381">PR review comment</a>:</p>
<blockquote>
<p>Well, due to the ISLE bits we need <code>cranelift-codegen-meta</code> to depend on <code>cranelift-assembler-x64-meta</code>, but I guess we could pull the formatting bits into a third crate they both depend on. I think at this point the <code>Formatter</code> and <code>fmtln!</code> logic has diverged a bit since on the assembler side I both simplified and then added interesting bits like the "append the location as a comment" logic.</p>
<p>I'm fine with trying to re-synchronize this formatter code into a third crate though I think I should commit to doing that in a future PR to avoid re-working everything here. But another option is to use a pre-existing crate: a casual glance online suggests <code>quote</code> + <code>prettyplease</code> or even <code>genco</code> could be an alternative. I feel like we're in an in-between place where we don't need the full power of something like <code>quote</code> but now we would be re-inventing parts of it into a new crate...</p>
</blockquote>



<a name="497077529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077529">(Jan 31 2025 at 19:52)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587708326">PR review</a>.</p>



<a name="497077530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077530">(Jan 31 2025 at 19:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937873946">PR review comment</a>:</p>
<blockquote>
<p>Question on this: how does this know that an unsigned value is desired? For example if you have <code>(a: u8) &amp; -2</code> that means it would fail <code>is_imm8</code>, right? But the x64 instruction should be able to encode that?</p>
<p>With the assembler immediates all annotated with if they're sign/zero-extended should there be <code>Simm8</code> and <code>Uimm8</code> and the extractors here would be <code>is_simm8</code> and <code>is_uimm8</code>?</p>
<p>(also as a side note I find <code>u8::try_from(...)</code> handy in cases of conversion like this so you don't have to do any <code>as</code> casts yourself)</p>
</blockquote>



<a name="497077531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077531">(Jan 31 2025 at 19:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937877372">PR review comment</a>:</p>
<blockquote>
<p>(sorry if this was already covered elsewhere) but how come these are changing from a 32-bit and to an 8-bit and?</p>
</blockquote>



<a name="497077532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077532">(Jan 31 2025 at 19:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937880180">PR review comment</a>:</p>
<blockquote>
<p>This one looks like 3 bytes were shaved off the encoding (the 0x19 =&gt; 0x16 in the diff), are the new assembler methods perhaps slightly more optimal in encoding size?</p>
</blockquote>



<a name="497077533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077533">(Jan 31 2025 at 19:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937882575">PR review comment</a>:</p>
<blockquote>
<p>If possible could the <code>Arbitrary</code> methods be left off? And the <code>Arbitrary</code> impl for each instruction have <code>where R::ReadGpr: Arbitrary</code>?</p>
</blockquote>



<a name="497077579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077579">(Jan 31 2025 at 19:52)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#issuecomment-2628262066">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>:</p>
<blockquote>
<p>(feel free to ignore my comments and respond after landing)</p>
</blockquote>



<a name="497077846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497077846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497077846">(Jan 31 2025 at 19:54)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#issuecomment-2628266695">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>:</p>
<blockquote>
<p>Oh one blocking thing if that's ok: this adds a hard dependency of cranelift on capstone which I believe wasn't previously there. Would it be possible to move that to a dev-dependency or a feature'd dependency?</p>
</blockquote>



<a name="497079521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497079521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497079521">(Jan 31 2025 at 20:05)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587780571">PR review</a>.</p>



<a name="497079522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497079522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497079522">(Jan 31 2025 at 20:05)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937924362">PR review comment</a>:</p>
<blockquote>
<p>There's a couple of issues that caused us to leave this disabled. There are instructions under the <code>and</code> family that, when a <code>REX</code> prefix is prepended, end up sign-extending their operands. When this encoding is used, they have limitations on their registers: "In 64-bit mode, r/m8 can not be encoded to access the following byte registers if a REX prefix is used: AH, BH, CH, DH." Since we won't be using the high 8-bit slots here, we can probably disregard that, but that was one of the initial concerns. The second concern is that, in documenting these instructions, it is not clear if there are mistakes: some of these <code>REX + ...</code> indicate sign extension for certain instructions but not others (e.g., compare <code>and</code>'s <code>RM</code> format and <code>or</code>'s <code>RM</code> format. The third is that, with both Capstone and XED, we don't really see a difference in the disassembled string, so our fuzzing cannot check that we correctly emit one instruction and not the other. Currently thinking about what to do...</p>
</blockquote>



<a name="497079569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497079569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497079569">(Jan 31 2025 at 20:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#issuecomment-2628306294">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>:</p>
<blockquote>
<p>(I sent a PR for that change as <a href="https://github.com/abrown/wasmtime/pull/10">https://github.com/abrown/wasmtime/pull/10</a>)</p>
</blockquote>



<a name="497082109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497082109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497082109">(Jan 31 2025 at 20:21)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587811072">PR review</a>.</p>



<a name="497082110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497082110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497082110">(Jan 31 2025 at 20:21)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937943192">PR review comment</a>:</p>
<blockquote>
<p>Yeah, that's what I concluded.</p>
</blockquote>



<a name="497084845"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497084845" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497084845">(Jan 31 2025 at 20:41)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587839167">PR review</a>.</p>



<a name="497084846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497084846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497084846">(Jan 31 2025 at 20:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937960317">PR review comment</a>:</p>
<blockquote>
<p>I think I need to ask some questions internally about this part of the reference manual. I'll add a TODO here with a comment.</p>
</blockquote>



<a name="497085231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497085231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497085231">(Jan 31 2025 at 20:44)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497089985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497089985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497089985">(Jan 31 2025 at 21:16)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587889616">PR review</a>.</p>



<a name="497089987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497089987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497089987">(Jan 31 2025 at 21:16)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937990399">PR review comment</a>:</p>
<blockquote>
<p>I'm a bit mystified: CLIF's <code>icmp</code> should return a truthy <code>Int</code> which reduces down to an 8-bit value here:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/a0338af84f66cb452fdf4b692d4facb5d052c12d/cranelift/codegen/meta/src/cdsl/typevar.rs#L433-L435">https://github.com/bytecodealliance/wasmtime/blob/a0338af84f66cb452fdf4b692d4facb5d052c12d/cranelift/codegen/meta/src/cdsl/typevar.rs#L433-L435</a></p>
<p>So those <code>band</code> instructions should always have lowered to an <code>andb</code>? Perhaps the original encoding just modified a larger width...</p>
</blockquote>



<a name="497091023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497091023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497091023">(Jan 31 2025 at 21:24)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2587903988">PR review</a>.</p>



<a name="497091024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497091024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497091024">(Jan 31 2025 at 21:24)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1937998513">PR review comment</a>:</p>
<blockquote>
<p>Ok, I see what you mean. The assembler doesn't care too much about the sign, it just wants 8 bits, so I chose to use <code>u8</code> to pass those along. What I was trying to do here (incorrectly) is check that we can fit whatever was in the <code>simm32: i32</code> into those 8 bits.</p>
</blockquote>



<a name="497102194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497102194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497102194">(Jan 31 2025 at 22:49)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2588011900">PR review</a>.</p>



<a name="497102195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497102195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497102195">(Jan 31 2025 at 22:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1938063567">PR review comment</a>:</p>
<blockquote>
<p>(I pushed up a commit for this over at <a href="https://github.com/abrown/wasmtime/pull/10">https://github.com/abrown/wasmtime/pull/10</a>)</p>
</blockquote>



<a name="497102414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497102414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497102414">(Jan 31 2025 at 22:51)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2588013653">PR review</a>.</p>



<a name="497102415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497102415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497102415">(Jan 31 2025 at 22:51)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1938064735">PR review comment</a>:</p>
<blockquote>
<p>I talked a bit more about this with @abrown and the reason for this is that Cranelift today <a href="https://github.com/bytecodealliance/wasmtime/blob/a0338af84f66cb452fdf4b692d4facb5d052c12d/cranelift/codegen/src/isa/x64/inst.isle#L2061">clamps operand sizes to 32-bits</a> in the <code>alu_rmi_r</code> constructor. That means that all 8-bit <code>and</code>s are actually 32-bit <code>and</code>s when emitted to x64. Andrew's PR is (IMO correctly) changing the 8-bit and to use <code>andb</code> instead. </p>
<p>@cfallin do you remember what <code>operand_size_of_type_32_64</code> was doing there? For example why clamp it to 32-bit? (and if so, are said reasons still applicable today?)</p>
</blockquote>



<a name="497104814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497104814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497104814">(Jan 31 2025 at 23:15)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2588035344">PR review</a>.</p>



<a name="497104815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497104815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497104815">(Jan 31 2025 at 23:15)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1938079240">PR review comment</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="497107637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497107637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497107637">(Jan 31 2025 at 23:45)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497107975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497107975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497107975">(Jan 31 2025 at 23:48)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497111972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497111972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497111972">(Feb 01 2025 at 00:32)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497502851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497502851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497502851">(Feb 03 2025 at 18:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2590666922">PR review</a>.</p>



<a name="497502853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497502853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497502853">(Feb 03 2025 at 18:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1939822255">PR review comment</a>:</p>
<blockquote>
<p>I suspect this is an artifact of the development path: initially we only had the 32- and 64-bit versions of the instruction available, and it's safe to implement 8-bit AND with 32-bit AND, so that's what we did.</p>
<p>I don't know about performance implications -- I do recall vaguely something about "partial-register stalls" if one updates only a part of the destination register but maybe it's fine if the instruction already depends on the register as an input. Assuming that's not a concern (@abrown confirm?) then this seems fine with me.</p>
</blockquote>



<a name="497518984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497518984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497518984">(Feb 03 2025 at 19:47)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2590854044">PR review</a>.</p>



<a name="497518987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497518987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497518987">(Feb 03 2025 at 19:47)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1939936516">PR review comment</a>:</p>
<blockquote>
<p>Hm, that _could_ be an issue. Maybe I should just leave the 32-bit versions in place in <code>inst.isle</code> just to be safe. I'll put a note there.</p>
</blockquote>



<a name="497520565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497520565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497520565">(Feb 03 2025 at 19:58)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497520650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497520650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497520650">(Feb 03 2025 at 19:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#pullrequestreview-2590875880">PR review</a>.</p>



<a name="497520651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497520651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497520651">(Feb 03 2025 at 19:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#discussion_r1939949797">PR review comment</a>:</p>
<blockquote>
<p>Ok, see 2c8a276.</p>
</blockquote>



<a name="497546999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497546999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497546999">(Feb 03 2025 at 22:50)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497547264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497547264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497547264">(Feb 03 2025 at 22:53)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<a name="497553709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497553709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497553709">(Feb 03 2025 at 23:44)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#issuecomment-2632428481">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>:</p>
<blockquote>
<p>This latest <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/13124822832/job/36618948362#step:18:987">CI failure</a> is under QEMU-emulated s390x. Have we ever observed a segfault here before? I can't imagine this has much to do with the new <code>cranelift-assembler-x64</code> crate since that is excluded here...</p>
</blockquote>



<a name="497553767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497553767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497553767">(Feb 03 2025 at 23:45)</a>:</h4>
<p>abrown edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#issuecomment-2632428481">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>:</p>
<blockquote>
<p>This latest <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/13124822832/job/36618948362#step:18:987">CI failure</a> is under QEMU-emulated s390x. Have we ever observed a segfault here before? I can't imagine this has much to do with the new <code>cranelift-assembler-x64</code> crate since that is excluded here... I'll try re-running the failed jobs.</p>
</blockquote>



<a name="497553803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497553803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497553803">(Feb 03 2025 at 23:45)</a>:</h4>
<p>abrown edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10110#issuecomment-2632428481">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>:</p>
<blockquote>
<p>This latest <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/13124822832/job/36618948362#step:18:987">CI failure</a> is under QEMU-emulated s390x. Have we ever observed a segfault here before? I can't imagine this has much to do with the new <code>cranelift-assembler-x64</code> crate since that is excluded in that CI check... I'll try re-running the failed jobs.</p>
</blockquote>



<a name="497557578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310110%20asm%3A%20introduce%20a%20new%20x64%20assembler/near/497557578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310110.20asm.3A.20introduce.20a.20new.20x64.20assembler.html#497557578">(Feb 04 2025 at 00:20)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10110">PR #10110</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>