<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12445 wasmtime: don&#x27;t use memory_reserv... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312445.20wasmtime.3A.20don.27t.20use.20memory_reserv.2E.2E.2E.html">wasmtime / issue #12445 wasmtime: don&#x27;t use memory_reserv...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="570304769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312445%20wasmtime%3A%20don%27t%20use%20memory_reserv.../near/570304769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312445.20wasmtime.3A.20don.27t.20use.20memory_reserv.2E.2E.2E.html#570304769">(Jan 27 2026 at 12:17)</a>:</h4>
<p>tage64 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12445">issue #12445</a>:</p>
<blockquote>
<p>In the function <code>MallocMemory::new()</code> (in the file <code>/crates/wasmtime/src/runtime/vm/memory/malloc.rs</code>), we allocate <code>minimum + tunables.memory_reservation_for_growth</code> bytes. I was working in a bare metal context and therefore didn't have access to virtual memory. An error message kindly told me that "malloc memory is only compatible with no ahead-of-time memory reservation". This led me to set <code>config.memory_reservation(0)</code>. But then <code>memory_reservation_for_growth</code> still defaulted to 2 GiB causing the <code>MallocMemory</code> to allocate more than 2 GiB of memory. This time I didn't get a helpful error message but an allocation failure without further context.</p>
<p>Is there a reason why we even use the <code>memory_reservation_for_growth</code> option in the <code>MallocMemory</code>? Otherwise I propose that we either ignore it or throw an error if it is greater than 0.</p>
<p>Wasmtime version: 41.0.0</p>
</blockquote>



<a name="570340144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312445%20wasmtime%3A%20don%27t%20use%20memory_reserv.../near/570340144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312445.20wasmtime.3A.20don.27t.20use.20memory_reserv.2E.2E.2E.html#570340144">(Jan 27 2026 at 14:48)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12445#issuecomment-3805649468">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12445">issue #12445</a>:</p>
<blockquote>
<p>This knob is used to amortize the cost of growth of a memory because without it all wasm growth would require reallocating the memory and moving it around. In that sense it's an intentional knob that is indeed used, but improving error messages for allocation failures is always reasonable.</p>
<p>Are you unable to set this configuration option to 0? Or are you interested in having it default to 0 for your target so you don't have to configure it?</p>
</blockquote>



<a name="570834076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312445%20wasmtime%3A%20don%27t%20use%20memory_reserv.../near/570834076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312445.20wasmtime.3A.20don.27t.20use.20memory_reserv.2E.2E.2E.html#570834076">(Jan 29 2026 at 15:58)</a>:</h4>
<p>tage64 <a href="https://github.com/bytecodealliance/wasmtime/issues/12445#issuecomment-3818590250">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12445">issue #12445</a>:</p>
<blockquote>
<p>I was indeed able to set <code>memory_reservation_for_growth</code> to 0. The problem was to find out that was the cause of my allocation failure. I am working on a risc-v 64-bit platform so it defaulted to 2 GiB which was a lot more than available. I don't know of the best solution. The problem is just the confusing error which doesn't direct the user to this configuration.</p>
</blockquote>



<a name="570871951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312445%20wasmtime%3A%20don%27t%20use%20memory_reserv.../near/570871951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312445.20wasmtime.3A.20don.27t.20use.20memory_reserv.2E.2E.2E.html#570871951">(Jan 29 2026 at 18:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12445#issuecomment-3819641702">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12445">issue #12445</a>:</p>
<blockquote>
<p>I've expanded the error contexts in <a href="https://github.com/bytecodealliance/wasmtime/pull/12468">https://github.com/bytecodealliance/wasmtime/pull/12468</a> to try to help make the error here more clear.</p>
</blockquote>



<a name="570880501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312445%20wasmtime%3A%20don%27t%20use%20memory_reserv.../near/570880501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312445.20wasmtime.3A.20don.27t.20use.20memory_reserv.2E.2E.2E.html#570880501">(Jan 29 2026 at 19:37)</a>:</h4>
<p>pchickey closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12445">issue #12445</a>:</p>
<blockquote>
<p>In the function <code>MallocMemory::new()</code> (in the file <code>/crates/wasmtime/src/runtime/vm/memory/malloc.rs</code>), we allocate <code>minimum + tunables.memory_reservation_for_growth</code> bytes. I was working in a bare metal context and therefore didn't have access to virtual memory. An error message kindly told me that "malloc memory is only compatible with no ahead-of-time memory reservation". This led me to set <code>config.memory_reservation(0)</code>. But then <code>memory_reservation_for_growth</code> still defaulted to 2 GiB causing the <code>MallocMemory</code> to allocate more than 2 GiB of memory. This time I didn't get a helpful error message but an allocation failure without further context.</p>
<p>Is there a reason why we even use the <code>memory_reservation_for_growth</code> option in the <code>MallocMemory</code>? Otherwise I propose that we either ignore it or throw an error if it is greater than 0.</p>
<p>Wasmtime version: 41.0.0</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>