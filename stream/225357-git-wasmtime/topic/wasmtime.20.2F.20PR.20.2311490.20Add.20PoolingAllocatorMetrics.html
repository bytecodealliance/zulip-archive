<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11490 Add PoolingAllocatorMetrics · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html">wasmtime / PR #11490 Add PoolingAllocatorMetrics</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="535537308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535537308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535537308">(Aug 21 2025 at 16:13)</a>:</h4>
<p>lann opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a> from <code>lann:pooling-metrics</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This exposes some basic runtime metrics derived from the internal state of a <code>PoolingInstanceAllocator</code>.</p>
<p>Two new atomics were added to PoolingInstanceAllocator: <code>live_memories</code> and <code>live_tables</code>. While these counts could be derived from existing state it would require acquiring mutexes on some inner state.</p>
<p>Fixes <a href="https://github.com/bytecodealliance/wasmtime/issues/11449">https://github.com/bytecodealliance/wasmtime/issues/11449</a><br>
&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="535537313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535537313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535537313">(Aug 21 2025 at 16:13)</a>:</h4>
<p><strong>lann</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535537316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535537316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535537316">(Aug 21 2025 at 16:13)</a>:</h4>
<p><strong>lann</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535542383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535542383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535542383">(Aug 21 2025 at 16:44)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535542529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535542529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535542529">(Aug 21 2025 at 16:45)</a>:</h4>
<p><strong>lann</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a> as ready for review.</p>



<a name="535543121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535543121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535543121">(Aug 21 2025 at 16:50)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3141544756">PR review</a>.</p>



<a name="535543122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535543122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535543122">(Aug 21 2025 at 16:50)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291630286">PR review comment</a>:</p>
<blockquote>
<p>I copied this approach from <code>increment_component_instance_count</code> but I could easily be convinced that it would be fine to just increment after successful allocation.</p>
</blockquote>



<a name="535543341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535543341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535543341">(Aug 21 2025 at 16:52)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291633842">PR review comment</a>:</p>
<blockquote>
<p>I was on the fence about whether to just do <code>Ordering::Relaxed</code> here, but if someone ends up using metrics in actual business logic (like server backpressure) it would be a pretty nasty surprise for these to underflow...</p>
</blockquote>



<a name="535543342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535543342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535543342">(Aug 21 2025 at 16:52)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3141549246">PR review</a>.</p>



<a name="535543379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535543379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535543379">(Aug 21 2025 at 16:52)</a>:</h4>
<p>lann edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291633842">PR review comment</a>.</p>



<a name="535560867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535560867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535560867">(Aug 21 2025 at 18:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3141909185">PR review</a>.</p>



<a name="535560868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535560868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535560868">(Aug 21 2025 at 18:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291883813">PR review comment</a>:</p>
<blockquote>
<p>Similar to above, I'd say that using <code>Relaxed</code> here is fine since these aren't actually synchronizing with anything other than themselves.</p>
</blockquote>



<a name="535560869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535560869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535560869">(Aug 21 2025 at 18:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291880387">PR review comment</a>:</p>
<blockquote>
<p>You'll want to switch this to using a <code>Drop</code> implementation because otherwise this won't be correctly accounted for if the future is cancelled/dropped.</p>
</blockquote>



<a name="535560870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535560870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535560870">(Aug 21 2025 at 18:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291882238">PR review comment</a>:</p>
<blockquote>
<p>Given the need to have a <code>Drop</code> to handle the cancelled-the-future case I'd be ok just putting this in the <code>Ok</code> path since that would avoid the need for <code>Drop</code> entirely</p>
</blockquote>



<a name="535560871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535560871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535560871">(Aug 21 2025 at 18:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291878913">PR review comment</a>:</p>
<blockquote>
<p>I'd actually opt towards using <code>Relaxed</code> here since there's explicitly no data dependency with anything else in the system (e.g. this isn't looking for memory effects of another operation or publishing its own memory effects). Could you detail more about the underflow point though? How would atomic ordering affect that?</p>
</blockquote>



<a name="535560872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535560872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535560872">(Aug 21 2025 at 18:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291882623">PR review comment</a>:</p>
<blockquote>
<p>Perhaps <code>debug_assert!</code> the previous value is <code>&gt; 0</code>?</p>
</blockquote>



<a name="535562904"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535562904" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535562904">(Aug 21 2025 at 19:06)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3141956824">PR review</a>.</p>



<a name="535562906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535562906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535562906">(Aug 21 2025 at 19:06)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291907673">PR review comment</a>:</p>
<blockquote>
<p>Ah good point; I didn't think about this hard enough when I rebased on #11470. I'll just switch to incrementing on Ok anyway.</p>
</blockquote>



<a name="535563607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535563607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535563607">(Aug 21 2025 at 19:11)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3141971659">PR review</a>.</p>



<a name="535563610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535563610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535563610">(Aug 21 2025 at 19:11)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291916695">PR review comment</a>:</p>
<blockquote>
<p>Sounds good. I don't really have a good grasp of relaxed atomic semantics so I just pessimistically assume that a concurrent thread would be able to go back in time and kill its own grandparent or whatever.</p>
</blockquote>



<a name="535564139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535564139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535564139">(Aug 21 2025 at 19:15)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535564245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535564245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535564245">(Aug 21 2025 at 19:16)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3141984490">PR review</a>.</p>



<a name="535564247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535564247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535564247">(Aug 21 2025 at 19:16)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291925765">PR review comment</a>:</p>
<blockquote>
<p>Heh nah makes sense. I'm by no means an expert but I'm confident enough in my understanding that if atomics are used for things like metric purposes it's fine to use relaxed. Relaxed ordering, AFAIK, basically means that you get no guarantees about other memory locations in the program when you observe a value. For the memory location in question, though, everything is still just as atomic as you'd expect (e.g. fetch-and-add still does that, it doesn't like switch to non-atomics). This happens because relaxed atomics can be reordered around each other by the compiler, so you can't for example say "I saw N memories in use, therefore I must see N+1 tables in use next", that's not valid.</p>
</blockquote>



<a name="535564599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535564599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535564599">(Aug 21 2025 at 19:18)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535565048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535565048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535565048">(Aug 21 2025 at 19:22)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3142000301">PR review</a>.</p>



<a name="535565051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535565051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535565051">(Aug 21 2025 at 19:22)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291937484">PR review comment</a>:</p>
<blockquote>
<p>Yeah makes sense. I guess I'm not entirely clear on what makes <code>increment_component_instance_count</code> different here that it would need <code>AcqRel</code>?</p>
</blockquote>



<a name="535565265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535565265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535565265">(Aug 21 2025 at 19:23)</a>:</h4>
<p>lann edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291937484">PR review comment</a>.</p>



<a name="535565774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535565774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535565774">(Aug 21 2025 at 19:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#pullrequestreview-3142012942">PR review</a>.</p>



<a name="535565775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535565775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535565775">(Aug 21 2025 at 19:27)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#discussion_r2291946567">PR review comment</a>:</p>
<blockquote>
<p>Oh it's not, the main difference is I saw this here and no one saw it there most likely. There's no need for that to use <code>AcqRel</code> either and IMO it should also be using <code>Relaxed</code></p>
</blockquote>



<a name="535565806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535565806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535565806">(Aug 21 2025 at 19:27)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535583483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535583483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535583483">(Aug 21 2025 at 21:45)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#issuecomment-3212170627">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>:</p>
<blockquote>
<p>While the vet error is spurious, the <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/17137044780/job/48615486728">miri failure</a> looks legitimate.</p>
</blockquote>



<a name="535709552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535709552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535709552">(Aug 22 2025 at 15:41)</a>:</h4>
<p>lann <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#issuecomment-3214812642">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>:</p>
<blockquote>
<p>This does indeed fail under miri locally: <a href="https://github.com/bytecodealliance/wasmtime/blob/fc3f429d72fabd4fb669f17c977c11752e078313/crates/wasmtime/src/runtime/vm/instance/allocator/pooling/metrics.rs#L76-L77">https://github.com/bytecodealliance/wasmtime/blob/fc3f429d72fabd4fb669f17c977c11752e078313/crates/wasmtime/src/runtime/vm/instance/allocator/pooling/metrics.rs#L76-L77</a></p>
<p>Presumably I can work around this by overriding some default config, but is it a bug that the defaults don't work with miri?</p>
</blockquote>



<a name="535710052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535710052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535710052">(Aug 22 2025 at 15:44)</a>:</h4>
<p>lann <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#issuecomment-3214822829">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>:</p>
<blockquote>
<p>Oh well I guess that's pretty straightforward: <a href="https://github.com/bytecodealliance/wasmtime/blob/fc3f429d72fabd4fb669f17c977c11752e078313/crates/environ/src/tunables.rs#L149-L150">https://github.com/bytecodealliance/wasmtime/blob/fc3f429d72fabd4fb669f17c977c11752e078313/crates/environ/src/tunables.rs#L149-L150</a></p>
<p>Any preference on how to fix this?</p>
<ul>
<li>Add a <code>cfg!(miri)</code> for default <code>max_memory_size</code></li>
<li>Just set <code>max_memory_size</code> in the test</li>
</ul>
</blockquote>



<a name="535710695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535710695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535710695">(Aug 22 2025 at 15:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11490#issuecomment-3214840333">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>:</p>
<blockquote>
<p>The main test suite has a <a href="https://github.com/bytecodealliance/wasmtime/blob/f5af05e25533246f8f0750f3bfff5ba6456072f0/tests/all/main.rs#L94-L113">helper function for a "small pool config"</a> which could be modeled here as well, but this test isn't too interesting for miri so it's also fine to slap a <code>#[cfg_attr(miri, ignore)]</code> on the test</p>
</blockquote>



<a name="535711499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535711499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535711499">(Aug 22 2025 at 15:51)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535712612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535712612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535712612">(Aug 22 2025 at 15:57)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<a name="535717405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311490%20Add%20PoolingAllocatorMetrics/near/535717405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311490.20Add.20PoolingAllocatorMetrics.html#535717405">(Aug 22 2025 at 16:25)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11490">PR #11490</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>