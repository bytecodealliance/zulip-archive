<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10856 Add round variants to the new assembler · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html">wasmtime / PR #10856 Add round variants to the new assembler</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="520997442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997442">(May 29 2025 at 00:42)</a>:</h4>
<p>jlb6740 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a> from <code>jlb6740:add-rounding-to-new-assembler</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="520997443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997443">(May 29 2025 at 00:42)</a>:</h4>
<p><strong>jlb6740</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="520997444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997444">(May 29 2025 at 00:42)</a>:</h4>
<p><strong>jlb6740</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="520997460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997460">(May 29 2025 at 00:42)</a>:</h4>
<p>jlb6740 <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#issuecomment-2917922379">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>:</p>
<blockquote>
<p>Will add vround variants in a follow-up to this patch.</p>
</blockquote>



<a name="520997490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997490">(May 29 2025 at 00:43)</a>:</h4>
<p>jlb6740 <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#issuecomment-2917922693">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>:</p>
<blockquote>
<p>Only touches the assembler part. </p>
</blockquote>



<a name="520997499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997499">(May 29 2025 at 00:43)</a>:</h4>
<p>jlb6740 deleted a <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#issuecomment-2917922693">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>:</p>
<blockquote>
<p>Only touches the assembler part. </p>
</blockquote>



<a name="520997527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/520997527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#520997527">(May 29 2025 at 00:43)</a>:</h4>
<p>jlb6740 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#issuecomment-2917922379">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>:</p>
<blockquote>
<p>Will add vround variants in a follow-up to this patch. Also, this only touches the assembler and does not connect isle.</p>
</blockquote>



<a name="521190426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521190426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521190426">(May 30 2025 at 00:02)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521190570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521190570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521190570">(May 30 2025 at 00:04)</a>:</h4>
<p>jlb6740 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#issuecomment-2917922379">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>:</p>
<blockquote>
<p>This only touches the assembler and does not connect isle.</p>
</blockquote>



<a name="521364775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521364775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521364775">(May 30 2025 at 20:08)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521365532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521365532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521365532">(May 30 2025 at 20:14)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521366624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521366624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521366624">(May 30 2025 at 20:23)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521368199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521368199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521368199">(May 30 2025 at 20:35)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521373259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521373259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521373259">(May 30 2025 at 21:19)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#pullrequestreview-2882582284">PR review</a>.</p>



<a name="521373400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521373400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521373400">(May 30 2025 at 21:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#pullrequestreview-2882584117">PR review</a>.</p>



<a name="521373401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521373401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521373401">(May 30 2025 at 21:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116682224">PR review comment</a>:</p>
<blockquote>
<p>Should these be <code>align(xmm_m128)</code>?</p>
<p>(should we maybe have a check in the DSL that non-avx <code>xmm_m128</code> arguments are required to be <code>align</code>?)</p>
</blockquote>



<a name="521374916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521374916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521374916">(May 30 2025 at 21:34)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#pullrequestreview-2882603622">PR review</a>.</p>



<a name="521374917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521374917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521374917">(May 30 2025 at 21:34)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116694456">PR review comment</a>:</p>
<blockquote>
<p>I read this comment multiple times trying to interpret: </p>
<p>"NB: the non-AVX variant of this instruction does not require that the operand<br>
;; is aligned, but the instruction variant used here requires it to be aligned."</p>
<p>Perhaps I should have asked. So the non-AVX variant here does require alignment? </p>
</blockquote>



<a name="521374941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521374941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521374941">(May 30 2025 at 21:35)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116694456">PR review comment</a>.</p>



<a name="521375285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521375285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521375285">(May 30 2025 at 21:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116699400">PR review comment</a>:</p>
<blockquote>
<p>Ah yeah I believe that comment is referring to <code>rounds{s,d}</code>, as opposed to <code>roundp{s,d}</code>. I'm under the impression that the f32/f64 versions do not require aligned memory but the 128-bit versions require aligned memory. The comment in ISLE I believe can be deleted with the new instructions since it's correctly modeled.</p>
<p>This reminds me as well, should <code>rounds{s,d}</code> below use <code>xmm_m{32,64}</code> instead of <code>xmm_m128</code>? We don't have anything actually checking that right now but with PCC in the future (or some other integration) it might matter to annotate that with the appropriate bit-width.</p>
</blockquote>



<a name="521375286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521375286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521375286">(May 30 2025 at 21:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#pullrequestreview-2882611853">PR review</a>.</p>



<a name="521375716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521375716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521375716">(May 30 2025 at 21:42)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521375821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521375821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521375821">(May 30 2025 at 21:43)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116694456">PR review comment</a>.</p>



<a name="521375858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521375858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521375858">(May 30 2025 at 21:43)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116694456">PR review comment</a>.</p>



<a name="521376734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521376734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521376734">(May 30 2025 at 21:52)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10856">PR #10856</a>.</p>



<a name="521378094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521378094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521378094">(May 30 2025 at 22:05)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#pullrequestreview-2882641014">PR review</a>.</p>



<a name="521378095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521378095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521378095">(May 30 2025 at 22:05)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116719548">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton Yes you are right on the rounds{s,d}. I am not sure how this would come in to play but let me update this to the correct annotation and also maybe remove that comment. </p>
</blockquote>



<a name="521378107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521378107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521378107">(May 30 2025 at 22:05)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116719548">PR review comment</a>.</p>



<a name="521378498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521378498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521378498">(May 30 2025 at 22:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#discussion_r2116732820">PR review comment</a>:</p>
<blockquote>
<p>Oh sorry fully reading your comment I can also clarify more:</p>
<p>The documentation there referred to the ISLE-specific abstraction of <code>XmmUnaryRmRImm</code> which internally stores <code>XmmMemAligned</code>. The <code>roundss</code> and <code>roundsd</code> instructions used <code>XmmUnaryRmRImm</code> but this was technically not a correct way to model these instructions. The <code>roundss</code> and <code>roundsd</code> instructions do not actually require alignment. The problem, and where the comment comes from, is that the way this happens in ISLE is that first a <code>Value</code> is converted to <code>XmmMem</code> as the load is "sinkable". Next it goes to the <code>x64_round</code> helper which takes <code>XmmMem</code>. Next, without AVX, it would go to <code>XmmUnaryRmRImm</code>, but this required converting the <code>XmmMem</code> to <code>XmmMemAligned</code>. That, for all WebAssembly loads/stores, would automatically do an unaligned load and then use a register operand. The problem with this is that the automatic load inserted would load 128-bits, not the appropriate number of bits for the f32/f64. </p>
<p>So basically that long comment was an artifact of a precisely how ISLE is set up today. None of it is applicable under the new assembler, and I think that the <code>roundps</code> and <code>roundpd</code> instructions need <code>align(xmm_m128)</code> but <code>roundss</code> and <code>roundsd</code> can use <code>xmm_m32</code> and <code>xmm_m64</code> since they don't require alignment.</p>
<p>Also FWIW I see a new commit here but I don't believe it landed because it was pushed after this was already in the merge queue, so mind filing a follow-up commit with that?</p>
</blockquote>



<a name="521378499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310856%20Add%20round%20variants%20to%20the%20new%20assembler/near/521378499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310856.20Add.20round.20variants.20to.20the.20new.20assembler.html#521378499">(May 30 2025 at 22:10)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10856#pullrequestreview-2882661922">PR review</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>