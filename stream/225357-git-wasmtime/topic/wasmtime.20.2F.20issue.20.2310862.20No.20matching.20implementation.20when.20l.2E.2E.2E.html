<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10862 No matching implementation when l... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html">wasmtime / issue #10862 No matching implementation when l...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="521131737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521131737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521131737">(May 29 2025 at 16:45)</a>:</h4>
<p>HillOfTong opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>After i follow guide <a href="https://component-model.bytecodealliance.org/language-support/rust.html">here</a> finishing my first cargo component project, i tried to wrote my own rust program loading wasm component with wasmtime::component module.</p>
<p>Here is my component code:<br>
world.wat:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="nc">hello</span><span class="o">-</span><span class="n">world</span><span class="p">;</span>

<span class="sd">/// An example world for the component to target.</span>
<span class="n">world</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">hello</span><span class="o">-</span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a href="http://lib.rs">lib.rs</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[allow(warnings)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">bindings</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="n">bindings</span><span class="p">::</span><span class="n">Guest</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Component</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// Say hello!</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">test</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">"Hello, World!"</span><span class="p">.</span><span class="n">to_string</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">bindings</span><span class="p">::</span><span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Component</span><span class="w"> </span><span class="n">with_types_in</span><span class="w"> </span><span class="n">bindings</span><span class="p">);</span>
</code></pre></div>
<p>I compile this code to wasm with cli "cargo component build", the i copy the hello_world.wasm file to my rust project.</p>
<p>Here is my app code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">::</span><span class="n">current_dir</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="n">path</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="s">"hello_world.wasm"</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"file_path: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">my_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">Component</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">my_component</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,),(</span><span class="nb">String</span><span class="p">,)</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"hello_world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"hello_world"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),))</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"result: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>Error  ocurred when i tried to run my app.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">component</span><span class="w"> </span><span class="n">imports</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.3</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">linker</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">get</span><span class="o">-</span><span class="n">environment</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">function</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">missing</span>
</code></pre></div>
<p>So here are my questions:</p>
<ol>
<li>How to import this dependency to wasm? I tried "cargo component add wasi:cli" , but it doesn't work. </li>
<li>I wonder if this is the right way to run component?"let result = func.call(&amp;mut store,("hello_world".to_string(),))?; " Can i pass the string to wasm and then get the result?</li>
</ol>
<p>THANKS!</p>
<p><a href="https://github.com/user-attachments/files/20508259/hello_world.wasm.zip">hello_world.wasm.zip</a></p>
</blockquote>



<a name="521213658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521213658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521213658">(May 30 2025 at 03:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921148755">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>You're on the right track, and the missing piece here is that the component is importing WASI but you're not supplying that. For that you'll want to use the <code>wasmtime-wasi</code> crate, and you can find a number of examples throughout the documentation there. For example you might want <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/fn.add_to_linker_async.html"><code>add_to_linker_async</code></a> and there's a <code>*_sync</code> version too to use.</p>
</blockquote>



<a name="521242725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521242725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521242725">(May 30 2025 at 08:04)</a>:</h4>
<p>HillOfTong <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921550083">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>Thanks for you supporting!</p>
<p>After i follow the guide, i successfully run the wasm code.</p>
<p>I tried to call function which is exported from wasm, it worked well first time. When i tried to call function twice, the error occurred.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">"Hello from func test."</span><span class="p">,)</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">cannot</span><span class="w"> </span><span class="n">enter</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">instance</span>
</code></pre></div>
<p>Here is my app code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::{</span><span class="n">ResourceTable</span><span class="p">,</span><span class="w"> </span><span class="n">Linker</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::{</span><span class="n">IoView</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtx</span><span class="p">,</span><span class="w"> </span><span class="n">WasiView</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">};</span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">IoView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">::</span><span class="n">current_dir</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="n">path</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="s">"hello_world.wasm"</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"file_path: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">my_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">Component</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span><span class="p">::</span><span class="o">&lt;</span><span class="n">MyState</span><span class="o">&gt;</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>


<span class="w">    </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">p2</span><span class="p">::</span><span class="n">add_to_linker_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span>
<span class="w">        </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">builder</span><span class="p">.</span><span class="n">build</span><span class="p">(),</span>
<span class="w">            </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">::</span><span class="n">new</span><span class="p">(),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">my_component</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">func_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(),(</span><span class="nb">String</span><span class="p">,)</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"func-test"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func_test</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"result: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>


<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,),(</span><span class="nb">String</span><span class="p">,)</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"hello-world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"WASM HELLO WORLD"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),))</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"result: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>


<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>So here come some questions:</p>
<ol>
<li>It seems i can only call function that exported from wasm once? How can i use wasm like a imported module?</li>
<li>I don't understand why i need to define the struct struct MyState {table: ResourceTable, ctx: WasiCtx,} when i tried to define a component linker?</li>
</ol>
</blockquote>



<a name="521243582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521243582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521243582">(May 30 2025 at 08:10)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921563759">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>After <code>func.call()</code> you have to call <code>func.post_return()</code> to run any cleanup code the guest may have. In addition while any function within a wasm component is running, you can't re-enter the same wasm component again. Only once the wasm component finishes can you re-enter it.</p>
</blockquote>



<a name="521247696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521247696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521247696">(May 30 2025 at 08:36)</a>:</h4>
<p>HillOfTong <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921623368">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<blockquote>
<p>After <code>func.call()</code> you have to call <code>func.post_return()</code> to run any cleanup code the guest may have. In addition while any function within a wasm component is running, you can't re-enter the same wasm component again. Only once the wasm component finishes can you re-enter it.</p>
</blockquote>
<p>What do you mean "I can't re-enter the same wasm component again"? When i call a function within a wasm component async, i can't call any function unless it finish running?</p>
<p>It seems engine isn't thread-safe.Is there any function to know if it's running?</p>
</blockquote>



<a name="521252023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521252023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521252023">(May 30 2025 at 09:03)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921709381">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<blockquote>
<p>When i call a function within a wasm component async, i can't call any function unless it finish running?</p>
</blockquote>
<p>Yes. The wasm component likely has a single stack. If you were to call two functions at the same time, they would clobber the stack of each other, so for safety reasons the component model denies it entirely: <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#component-invariants">https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#component-invariants</a></p>
<blockquote>
<p>It seems engine isn't thread-safe.Is there any function to know if it's running?</p>
</blockquote>
<p>You mean the <code>Engine</code> type. That one is fully thread-safe and meant (though not strictly required) to be shared between all code that uses wasmtime inside a single process. As for knowing if a component currently has a function running, I'm not sure if there is an api for that.</p>
</blockquote>



<a name="521252667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521252667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521252667">(May 30 2025 at 09:08)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921709381">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<blockquote>
<p>When i call a function within a wasm component async, i can't call any function unless it finish running?</p>
</blockquote>
<p>Yes. The wasm component likely has a single stack. If you were to call two functions at the same time, they would clobber the stack of each other, so for safety reasons the component model denies it entirely: <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#component-invariants">https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#component-invariants</a></p>
<p>If the function inside the wasm component is itself async in the future you should be able to use <code>func.call_concurrent()</code> which does allow multiple concurrent calls. While this function already exists in upstream wasmtime, it isn't yet implemented there. You have to use the wasmtime version from <a href="https://github.com/bytecodealliance/wasip3-prototyping">https://github.com/bytecodealliance/wasip3-prototyping</a> instead, which is still experimental.</p>
<blockquote>
<p>It seems engine isn't thread-safe.Is there any function to know if it's running?</p>
</blockquote>
<p>You mean the <code>Engine</code> type. That one is fully thread-safe and meant (though not strictly required) to be shared between all code that uses wasmtime inside a single process. As for knowing if a component currently has a function running, I'm not sure if there is an api for that.</p>
</blockquote>



<a name="521252785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521252785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521252785">(May 30 2025 at 09:08)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921709381">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<blockquote>
<p>When i call a function within a wasm component async, i can't call any function unless it finish running?</p>
</blockquote>
<p>Yes. The wasm component likely has a single stack. If you were to call two functions at the same time, they would clobber the stack of each other, so for safety reasons the component model denies it entirely: <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#component-invariants">https://github.com/WebAssembly/component-model/blob/main/design/mvp/Explainer.md#component-invariants</a></p>
<p>If the function inside the wasm component is itself async in the future you should be able to use <code>func.call_concurrent()</code> which does allow multiple concurrent calls. While this function already exists in upstream wasmtime, it isn't yet implemented there. You have to use the wasmtime version from <a href="https://github.com/bytecodealliance/wasip3-prototyping">https://github.com/bytecodealliance/wasip3-prototyping</a> instead, which is still experimental. Native async support for the component model is still very new.</p>
<blockquote>
<p>It seems engine isn't thread-safe.Is there any function to know if it's running?</p>
</blockquote>
<p>You mean the <code>Engine</code> type. That one is fully thread-safe and meant (though not strictly required) to be shared between all code that uses wasmtime inside a single process. As for knowing if a component currently has a function running, I'm not sure if there is an api for that.</p>
</blockquote>



<a name="521258004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521258004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521258004">(May 30 2025 at 09:40)</a>:</h4>
<p>HillOfTong <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921812386">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>Thanks! </p>
<p>I also want to know why i need to define strut like this. I follow the example for this <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/fn.add_to_linker_async.html">link</a></p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">IoView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="521258038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521258038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521258038">(May 30 2025 at 09:40)</a>:</h4>
<p>HillOfTong edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921812386">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>Thanks! </p>
<p>I also want to know why i need to define struct like this. I follow the example for this <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/fn.add_to_linker_async.html">link</a></p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">IoView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="521258057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521258057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521258057">(May 30 2025 at 09:40)</a>:</h4>
<p>HillOfTong edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2921812386">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>Thanks! </p>
<p>I also want to know why i need to define struct like this. I follow the example for this <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/fn.add_to_linker_async.html">link</a>.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">IoView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="521372086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310862%20No%20matching%20implementation%20when%20l.../near/521372086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310862.20No.20matching.20implementation.20when.20l.2E.2E.2E.html#521372086">(May 30 2025 at 21:08)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10862#issuecomment-2923499068">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10862">issue #10862</a>:</p>
<blockquote>
<p>More-or-less, that's just how the APIs of Wasmtime are designed at this time. </p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>