<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11682 wasmtime panics when dealing with... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311682.20wasmtime.20panics.20when.20dealing.20with.2E.2E.2E.html">wasmtime / issue #11682 wasmtime panics when dealing with...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="538797094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311682%20wasmtime%20panics%20when%20dealing%20with.../near/538797094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311682.20wasmtime.20panics.20when.20dealing.20with.2E.2E.2E.html#538797094">(Sep 11 2025 at 08:19)</a>:</h4>
<p>plusvic opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11682">issue #11682</a>:</p>
<blockquote>
<p>When I try to instantiate a WASM module that contains a very large function, and <code>cranelift</code> is configure to use optimizations (<code>wasmtime::OptLevel::Speed</code> or <code>wasmtime::OptLevel::SpeedAndSize</code>), it panics with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">vmalvarez</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">1949</span><span class="n">cf8c6b5b557f</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.123.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ir</span><span class="o">/</span><span class="n">instructions</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">228</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">payload</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae8298</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">BacktraceLock</span><span class="p">::</span><span class="n">print</span><span class="p">::</span><span class="n">DisplayBacktrace</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="o">&gt;</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="n">hc62d1c602f32d045</span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105b06898</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="n">write</span><span class="p">::</span><span class="n">hec54c1d5587662ba</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae55c4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Write</span><span class="p">::</span><span class="n">write_fmt</span><span class="p">::</span><span class="n">h32cb3f1ee5943fae</span>
<span class="w">   </span><span class="mi">3</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae814c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">BacktraceLock</span><span class="p">::</span><span class="n">print</span><span class="p">::</span><span class="n">hbdf74b1541f6a1ff</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae9914</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">default_hook</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}::</span><span class="n">h5448a63c4ecd0e4e</span>
<span class="w">   </span><span class="mi">5</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae976c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">default_hook</span><span class="p">::</span><span class="n">ha395121f3118f99a</span>
<span class="w">   </span><span class="mi">6</span><span class="p">:</span><span class="w">        </span><span class="mh">0x104cca9ec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yr</span><span class="p">::</span><span class="n">main</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}::</span><span class="n">hfe5d5caf9c5c3c1f</span>
<span class="w">   </span><span class="mi">7</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105aea3d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">rust_panic_with_hook</span><span class="p">::</span><span class="n">h2cf6c7b76a1ec3f1</span>
<span class="w">   </span><span class="mi">8</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae9fa8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">begin_panic_handler</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}::</span><span class="n">hb6df43c194981807</span>
<span class="w">   </span><span class="mi">9</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae8750</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sys</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">__rust_end_short_backtrace</span><span class="p">::</span><span class="n">h870816de405e4980</span>
<span class="w">  </span><span class="mi">10</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105ae9cac</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__rustc</span><span class="p">[</span><span class="n">e402ec7dbc433fa7</span><span class="p">]::</span><span class="n">rust_begin_unwind</span>
<span class="w">  </span><span class="mi">11</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105b84214</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span><span class="p">::</span><span class="n">hae8dacf72a638e20</span>
<span class="w">  </span><span class="mi">12</span><span class="p">:</span><span class="w">        </span><span class="mh">0x105b84284</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic</span><span class="p">::</span><span class="n">hc324204614143dd3</span>
<span class="w">  </span><span class="mi">13</span><span class="p">:</span><span class="w">        </span><span class="mh">0x1056ee7fc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">ir</span><span class="p">::</span><span class="n">instructions</span><span class="p">::</span><span class="n">InstructionData</span><span class="p">::</span><span class="n">map_values</span><span class="p">::</span><span class="n">h0278140030621a4a</span>
<span class="w">  </span><span class="mi">14</span><span class="p">:</span><span class="w">        </span><span class="mh">0x1056fd830</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">egraph</span><span class="p">::</span><span class="n">EgraphPass</span><span class="p">::</span><span class="n">run</span><span class="p">::</span><span class="n">h63605c10fdb90cc5</span>
<span class="w">  </span><span class="mi">15</span><span class="p">:</span><span class="w">        </span><span class="mh">0x1056a35bc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">context</span><span class="p">::</span><span class="n">Context</span><span class="p">::</span><span class="n">optimize</span><span class="p">::</span><span class="n">h4483eab5301b4a42</span>
<span class="w">  </span><span class="mi">16</span><span class="p">:</span><span class="w">        </span><span class="mh">0x1056a2f60</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">context</span><span class="p">::</span><span class="n">Context</span><span class="p">::</span><span class="n">compile_stencil</span><span class="p">::</span><span class="n">ha8e37d40161c2624</span>
<span class="w">  </span><span class="mi">17</span><span class="p">:</span><span class="w">        </span><span class="mh">0x1056a3910</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cranelift_codegen</span><span class="p">::</span><span class="n">context</span><span class="p">::</span><span class="n">Context</span><span class="p">::</span><span class="n">compile</span><span class="p">::</span><span class="n">h81a4bb0e1cd3db9e</span>
<span class="w">  </span><span class="mi">18</span><span class="p">:</span><span class="w">        </span><span class="mh">0x10543dbec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_internal_cranelift</span><span class="p">::</span><span class="n">compiler</span><span class="p">::</span><span class="n">FunctionCompiler</span><span class="p">::</span><span class="n">finish_with_info</span><span class="p">::</span><span class="n">hc96d5e0ca4268141</span>
<span class="w">  </span><span class="mi">19</span><span class="p">:</span><span class="w">        </span><span class="mh">0x10543c7cc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasmtime_internal_cranelift</span><span class="p">::</span><span class="n">compiler</span><span class="p">::</span><span class="n">Compiler</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime_environ</span><span class="p">::</span><span class="n">compile</span><span class="p">::</span><span class="n">InliningCompiler</span><span class="o">&gt;</span><span class="p">::</span><span class="n">finish_compiling</span><span class="p">::</span><span class="n">h7532ff7544c0367b</span>
</code></pre></div>
<p>If I disable optimizations (with <code>wasmtime::OptLevel::None</code>), the panic disappears and I get this error from <code>wasmtime::Module::from_binary</code>:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Compilation</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">Code</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">large</span>
<span class="err">````</span>

<span class="n">My</span><span class="w"> </span><span class="n">expectation</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="err">`</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="n">functions</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">matter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimization</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">choose</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift</span><span class="err">`</span><span class="p">.</span>

<span class="n">I</span><span class="o">'</span><span class="na">m</span><span class="w"> </span><span class="n">attaching</span><span class="w"> </span><span class="n">WASM</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">triggers</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">issue</span><span class="p">.</span>


<span class="p">###</span><span class="w"> </span><span class="n">Versions</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">Environment</span>

<span class="n">Wasmtime</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">commit</span><span class="p">:</span><span class="w"> </span><span class="mf">36.0.2</span>

<span class="n">Operating</span><span class="w"> </span><span class="n">system</span><span class="p">:</span><span class="w"> </span><span class="nc">Linux</span><span class="p">,</span><span class="w"> </span><span class="n">macOS</span>

<span class="n">Architecture</span><span class="p">:</span><span class="w"> </span><span class="nc">x86_64</span><span class="p">,</span><span class="w"> </span><span class="n">aarch64</span>

<span class="p">[</span><span class="n">large</span><span class="p">.</span><span class="n">wasm</span><span class="p">.</span><span class="n">zip</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/user-attachments/files/22270986/large.wasm.zip)</span>

<span class="o">~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="538797095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311682%20wasmtime%20panics%20when%20dealing%20with.../near/538797095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311682.20wasmtime.20panics.20when.20dealing.20with.2E.2E.2E.html#538797095">(Sep 11 2025 at 08:19)</a>:</h4>
<p><a href="https://github.com/plusvic">plusvic</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11682">Issue #11682</a>.</p>



<a name="538904372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311682%20wasmtime%20panics%20when%20dealing%20with.../near/538904372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311682.20wasmtime.20panics.20when.20dealing.20with.2E.2E.2E.html#538904372">(Sep 11 2025 at 16:39)</a>:</h4>
<p>fitzgen assigned cfallin to <a href="https://github.com/bytecodealliance/wasmtime/issues/11682">issue #11682</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>