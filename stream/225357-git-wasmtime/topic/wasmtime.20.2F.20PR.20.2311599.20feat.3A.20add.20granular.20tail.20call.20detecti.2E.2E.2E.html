<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11599 feat: add granular tail call detecti... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html">wasmtime / PR #11599 feat: add granular tail call detecti...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537532508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537532508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537532508">(Sep 03 2025 at 18:24)</a>:</h4>
<p>pnodet opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a> from <code>pnodet:pnodet-9</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR introduces granular call instruction classification in Cranelift's machine instruction layer, enabling more precise function type analysis and potential optimization opportunities.</p>
<h4>Changes</h4>
<p>- Added <code>CallType</code> enum to distinguish between regular calls, tail calls, and non-calls<br>
  - Introduced <code>FunctionType</code> enum for enhanced function classification (<code>Leaf</code>, <code>TailCallOnly</code>, <code>NonLeaf</code>)<br>
  - Replaced boolean <code>is_call()</code> with more descriptive <code>call_type()</code> method in MachInst trait<br>
   - Updated all ISA backends (AArch64, x64, RISC-V 64, s390x, Pulley) to implement <code>call_type()</code> methodAdds core infrastructure for distinguishing between regular calls and tail calls at the instruction level.</p>
</blockquote>



<a name="537532509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537532509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537532509">(Sep 03 2025 at 18:24)</a>:</h4>
<p><strong>pnodet</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a>.</p>



<a name="537532513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537532513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537532513">(Sep 03 2025 at 18:24)</a>:</h4>
<p><strong>pnodet</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a>.</p>



<a name="537534744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534744">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3181952139">PR review</a>:</p>
<blockquote>
<p>Thanks! Some comments below.</p>
</blockquote>



<a name="537534745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534745">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319852151">PR review comment</a>:</p>
<blockquote>
<p>rustdoc formatting nit: blank line between summary and details (here and below)</p>
</blockquote>



<a name="537534746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534746">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319854908">PR review comment</a>:</p>
<blockquote>
<p>A few naming thoughts:</p>
<ul>
<li><code>FunctionType</code> evokes something more like a function signature to me; maybe <code>FunctionCalls</code> for this enum?</li>
<li>Once we call it that, the arms might be a little clearer as <code>FunctionCalls::None</code>, <code>FunctionCalls::TailOnly</code>, and <code>FunctionCalls::Regular</code>.</li>
</ul>
</blockquote>



<a name="537534747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534747">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319856645">PR review comment</a>:</p>
<blockquote>
<p>Can we make these enums <code>pub(crate)</code>? There's no reason to export them to the world (we don't support external backends).</p>
</blockquote>



<a name="537534750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534750">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319857976">PR review comment</a>:</p>
<blockquote>
<p>This is, properly speaking, a property of the ABI -- some may require frame setup for every function, some may not, some may support frame-less tail calls, etc. Can we move the logic to <code>machinst/abi.rs</code> instead?</p>
</blockquote>



<a name="537534751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534751">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319863427">PR review comment</a>:</p>
<blockquote>
<p>No need for little tests like this on helper methods that are just <code>match</code>es on an enum -- they don't add any value but rather they are just repeating the definition.</p>
</blockquote>



<a name="537534752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534752">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319859499">PR review comment</a>:</p>
<blockquote>
<p>This appears to be used only in tests and in passing to <code>compute_frame_layout</code>, and the latter can just take the enum type directly; could we remove this method?</p>
</blockquote>



<a name="537534753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534753">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319866156">PR review comment</a>:</p>
<blockquote>
<p>Rather than ad-hoc merge logic like this, it would be better to add a method <code>update</code> on the <code>FunctionType</code> (or <code>FunctionCalls</code>) that takes a <code>CallType</code>. Then you can have <code>let mut function_calls = FunctionCalls::None;</code> above the loop, and <code>function_calls.update(self.insts[i].call_type());</code> in the loop, and all the logic is placed close to where the enum domains are defined.</p>
</blockquote>



<a name="537534754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534754">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319862189">PR review comment</a>:</p>
<blockquote>
<p>This doesn't seem to be used anywhere -- can we remove it? Best not to have methods that try to summarize/coarsen the enum domain unless we have a precise definition of what we actually want and a place that needs it; let the modeled information domain stand on its own otherwise.</p>
</blockquote>



<a name="537534755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537534755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537534755">(Sep 03 2025 at 18:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319867242">PR review comment</a>:</p>
<blockquote>
<p>Rather than pass the bool, let's pass the enum directly. Then the ABI can decide what it wants to do about tails vs regular calls, etc.</p>
</blockquote>



<a name="537536822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537536822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537536822">(Sep 03 2025 at 18:57)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182026880">PR review</a>.</p>



<a name="537536823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537536823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537536823">(Sep 03 2025 at 18:57)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319904805">PR review comment</a>:</p>
<blockquote>
<p>Do we actually need to make a distinction between <code>Leaf</code> and <code>TailCallOnly</code>?</p>
</blockquote>



<a name="537537570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537537570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537537570">(Sep 03 2025 at 19:02)</a>:</h4>
<p>pnodet updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a>.</p>



<a name="537537813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537537813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537537813">(Sep 03 2025 at 19:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182058840">PR review</a>.</p>



<a name="537537816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537537816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537537816">(Sep 03 2025 at 19:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319927770">PR review comment</a>:</p>
<blockquote>
<p>We don't right now. I was interpreting this PR as a refactor along the way to eventually doing so, and the additional enum arm is minor enough that I don't mind the "YAGNI violation"; but @pnodet can you say more about your plans here?</p>
</blockquote>



<a name="537537906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537537906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537537906">(Sep 03 2025 at 19:05)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319927770">PR review comment</a>.</p>



<a name="537538374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537538374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537538374">(Sep 03 2025 at 19:08)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182070200">PR review</a>.</p>



<a name="537538375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537538375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537538375">(Sep 03 2025 at 19:08)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319935039">PR review comment</a>:</p>
<blockquote>
<p>I agree for <code>FunctionType</code> / <code>FunctionCalls</code> enum.</p>
<p>But for <code>CallType</code>, since I added to the <code>pub trait MachInst</code> a <code>call_type()</code> method returning <code>CallType</code> I need to either keep it public or add <code>#[allow(private_interface)]</code> to the method</p>
</blockquote>



<a name="537538847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537538847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537538847">(Sep 03 2025 at 19:11)</a>:</h4>
<p>pnodet updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a>.</p>



<a name="537538857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537538857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537538857">(Sep 03 2025 at 19:11)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319941543">PR review comment</a>:</p>
<blockquote>
<p>I don't mind FunctionCalls</p>
</blockquote>



<a name="537538858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537538858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537538858">(Sep 03 2025 at 19:11)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182080649">PR review</a>.</p>



<a name="537539028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537539028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537539028">(Sep 03 2025 at 19:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319944591">PR review comment</a>:</p>
<blockquote>
<p>Ah, that's fair -- we aren't consistent currently with our usage of <code>pub</code>; someone should do a broader pass on that (probably not a good task for a newcomer since it has more to do with our published interface and policy questions) but for now <code>pub</code> is fine there.</p>
</blockquote>



<a name="537539029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537539029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537539029">(Sep 03 2025 at 19:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182085893">PR review</a>.</p>



<a name="537540641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537540641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537540641">(Sep 03 2025 at 19:22)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182115178">PR review</a>.</p>



<a name="537540643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537540643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537540643">(Sep 03 2025 at 19:22)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319964570">PR review comment</a>:</p>
<blockquote>
<p>Yes, this changes are not trying to fix anything per se but after working on the is_leaf detection PR  I thought it could help for improvements and optimizations in the future. I don't think it introduces much and open to discussion as I didn't really go through an issue -&gt; pr process</p>
</blockquote>



<a name="537541216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537541216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537541216">(Sep 03 2025 at 19:26)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182125974">PR review</a>.</p>



<a name="537541217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537541217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537541217">(Sep 03 2025 at 19:26)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2319972131">PR review comment</a>:</p>
<blockquote>
<p>They are no optimizations made here so this PR could be regarded as a in between step / preparation phase</p>
</blockquote>



<a name="537562396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537562396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537562396">(Sep 03 2025 at 22:25)</a>:</h4>
<p>pnodet updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a>.</p>



<a name="537562480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537562480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537562480">(Sep 03 2025 at 22:26)</a>:</h4>
<p>pnodet submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182717308">PR review</a>.</p>



<a name="537562481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537562481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537562481">(Sep 03 2025 at 22:26)</a>:</h4>
<p>pnodet created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2320362406">PR review comment</a>:</p>
<blockquote>
<p>I gave this a bit of thought and made a pass in this commit <a href="https://github.com/bytecodealliance/wasmtime/pull/11599/commits/bbbbf0ec0a9761eaff1d5d00440c155e17001afc">https://github.com/bytecodealliance/wasmtime/pull/11599/commits/bbbbf0ec0a9761eaff1d5d00440c155e17001afc</a> </p>
</blockquote>



<a name="537563310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537563310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537563310">(Sep 03 2025 at 22:36)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2320380533">PR review comment</a>:</p>
<blockquote>
<p>Once the optimization is done, we can change back to an is_leaf bool where true could be either no calls or only tail calls, right? Doing the is_call change and optimization in one step would avoid most of the changes in this PR, right?</p>
</blockquote>



<a name="537563311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537563311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537563311">(Sep 03 2025 at 22:36)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182748381">PR review</a>.</p>



<a name="537563951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537563951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537563951">(Sep 03 2025 at 22:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#discussion_r2320400588">PR review comment</a>:</p>
<blockquote>
<p>@bjorn3 that's not totally clear to me at least -- for example, if the tail-calls result in an outgoing argument area of nonzero size, that precludes skipping the frame, whereas a tail call with args in registers only can still avoid the frame (if no other clobber-saves or stackslots). So the ABI logic may need to handle it specially.</p>
</blockquote>



<a name="537563952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537563952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537563952">(Sep 03 2025 at 22:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182787017">PR review</a>.</p>



<a name="537564169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537564169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537564169">(Sep 03 2025 at 22:47)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11599#pullrequestreview-3182799422">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="537564178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537564178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537564178">(Sep 03 2025 at 22:47)</a>:</h4>
<p><strong>cfallin</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a> as ready for review.</p>



<a name="537565735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311599%20feat%3A%20add%20granular%20tail%20call%20detecti.../near/537565735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311599.20feat.3A.20add.20granular.20tail.20call.20detecti.2E.2E.2E.html#537565735">(Sep 03 2025 at 23:08)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11599">PR #11599</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>