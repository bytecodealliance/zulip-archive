<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12308 Polyfill `ToWasmtimeResult` and add ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html">wasmtime / PR #12308 Polyfill `ToWasmtimeResult` and add ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="567257957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567257957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567257957">(Jan 09 2026 at 20:31)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-wasi-reviewers">wasmtime-wasi-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567257958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567257958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567257958">(Jan 09 2026 at 20:31)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a> from <code>fitzgen:polyfill-to-wasmtime-result</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit polyfills <code>wasmtime_internal_error::ToWasmtimeResult</code> in <code>wasmtime_environ</code>, adds the cargo feature plumbing that will eventually connect to the <code>"wasmtime_internal_error/anyhow"</code> cargo feature but for now just configures this polyfill, and adds uses of the polyfill at all the sites that will be necessary once we swap out <code>anyhow</code> for<br>
<code>wasmtime_internal_error</code>. Currently, the polyfill is just an identity function, because <code>wasmtime::Result</code>/<code>wasmtime_environ::error::Result</code> is just another name for <code>anyhow::Result</code>. Once we do move away from <code>anyhow</code>, however, that will no longer be the case, and these uses will do the necessary conversion.</p>
<p>My goal with landing this as an incremental commit is to make it so that the actual commit that does the error crate swap out can be as close to _just_ the <code>Cargo.toml</code> dependency change, without any other code changes as much as possible. This, in turn, means that swap out should be super easy to revert, if necessary.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="567257960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567257960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567257960">(Jan 09 2026 at 20:31)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567257961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567257961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567257961">(Jan 09 2026 at 20:31)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567257962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567257962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567257962">(Jan 09 2026 at 20:31)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567261950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567261950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567261950">(Jan 09 2026 at 21:02)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3730559251">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<p>Personally I'd like to see this trait used as an absolute last resort "quick hack before we figure out what's best to do instead" ideally. What would you think about, instead of using this trait internally, instead propagating the usage of <code>anyhow::Error</code> to the callers? This looks like it's mostly used in tests and such so I don't think it'll affect our public API or anything like that.</p>
<p>Additionally, looking forward a bit, one thing I'm worried about is <code>bindgen!</code>-generated traits all written with <code>anyhow::Error</code> previously and deeply integrated with the rest of an embedding, and that would all in theory need to change and use this trait. What do you think about a new <code>bindgen!</code> configuration flag which, when enabled, uses <code>to_wasmtime_result()</code> and this trait on the result of all functions? It would generate trait signatures with <code>anyhow::Result</code> instead of <code>wasmtime::Result</code>, for example.</p>
</blockquote>



<a name="567261978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567261978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567261978">(Jan 09 2026 at 21:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567273607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567273607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567273607">(Jan 09 2026 at 22:47)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3730835772">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api", "wizer"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: wizer</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="567637456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567637456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567637456">(Jan 12 2026 at 20:26)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3740358214">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<blockquote>
<p>Personally I'd like to see this trait used as an absolute last resort "quick hack before we figure out what's best to do instead" ideally.</p>
</blockquote>
<p>This trait <em>is</em> used as an absolute last resort, and not as a quick hack, already in this PR as it is today:</p>
<ul>
<li>All crates in the workspace have been migrated to <code>wasmtime[_environ]::Error</code>. This makes things uniform and gives us a simple rule for development in the workspace. No weird half-migrations or having to think about which kind of error to use/import at a given location.</li>
<li>All <code>core::error::Error</code> impls (including those originating from deps outside the workspace) automatically get converted into <code>wasmtime::Error</code> in <code>?</code> propagation and via <code>From&lt;E&gt; for wasmtime::Error where E: core::error::Error</code>. This is the same as when we were (or, still are) using <code>anyhow::Error</code>.</li>
<li>We <em>only</em> invoke <code>.to_wasmtime_result()</code> when the above cases do not apply: we are using a worskpace-external dep which returns an <code>anyhow::Error</code> (which does not implement <code>core::error::Error</code> due to conflicting trait impls). In this last case, we <em>absolutely must</em> use the <code>.to_wasmtime_result()</code> trait method (or some other quivalent explicit conversion) because we cannot implement <code>From&lt;anyhow::Error&gt; for wasmtime::Error</code> (for conflicting trait impl reasons similar to why there is no <code>From&lt;impl core::error::Error&gt; for anyhow::Error</code>).</li>
</ul>
<p>This is not a quick hack. This is only and exactly the places where we must insert the conversions.</p>
<blockquote>
<p>What would you think about, instead of using this trait internally, instead propagating the usage of <code>anyhow::Error</code> to the callers? This looks like it's mostly used in tests and such so I don't think it'll affect our public API or anything like that.</p>
</blockquote>
<p>This would result in a much more confusing situation where sometimes we are using <code>anyhow::Error</code> and sometimes we are using <code>wasmtime::Error</code> but either way it is imported locally as just <code>Error</code> so you always have to check to see which one you're dealing with and at the end of the day you are still going to have to convert between the two everywhere except in tests (which are only ~1/4 of the use sites, if you look at the diff) so we would just be making things more confusing and losing a clear line for determining when to use which error but we wouldn't even avoiding most of the conversions.</p>
<blockquote>
<p>Additionally, looking forward a bit, one thing I'm worried about is <code>bindgen!</code>-generated traits all written with <code>anyhow::Error</code> previously and deeply integrated with the rest of an embedding, and that would all in theory need to change and use this trait. What do you think about a new <code>bindgen!</code> configuration flag which, when enabled, uses <code>to_wasmtime_result()</code> and this trait on the result of all functions? It would generate trait signatures with <code>anyhow::Result</code> instead of <code>wasmtime::Result</code>, for example.</p>
</blockquote>
<p>Makes sense to me, but also probably something that doesn't need to happen in this PR, I don't think? If you feel strongly that it should be part of this PR, I can add it here though.</p>
</blockquote>



<a name="567638067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567638067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567638067">(Jan 12 2026 at 20:30)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3740358214">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<blockquote>
<p>Personally I'd like to see this trait used as an absolute last resort "quick hack before we figure out what's best to do instead" ideally.</p>
</blockquote>
<p>This trait <em>is</em> used as an absolute last resort, and not as a quick hack, already in this PR as it is today:</p>
<ul>
<li>All crates in the workspace have been migrated to <code>wasmtime[_environ]::Error</code>. This makes things uniform and gives us a simple rule for development in the workspace. No weird half-migrations or having to think about which kind of error to use/import at a given location.</li>
<li>All <code>core::error::Error</code> impls (including those originating from deps outside the workspace) automatically get converted into <code>wasmtime::Error</code> in <code>?</code> propagation and via <code>From&lt;E&gt; for wasmtime::Error where E: core::error::Error</code>. This is the same as when we were (or, still are) using <code>anyhow::Error</code>.</li>
<li>We <em>only</em> invoke <code>.to_wasmtime_result()</code> when the above cases do not apply: we are using a worskpace-external dep which returns an <code>anyhow::Error</code> (which does not implement <code>core::error::Error</code> due to conflicting trait impls). In this last case, we <em>absolutely must</em> use the <code>.to_wasmtime_result()</code> trait method (or some other quivalent explicit conversion) because we cannot implement <code>From&lt;anyhow::Error&gt; for wasmtime::Error</code> (for conflicting trait impl reasons similar to why there is no <code>impl core::error::Error for anyhow::Error</code>).</li>
</ul>
<p>This is not a quick hack. This is only and exactly the places where we must insert the conversions.</p>
<blockquote>
<p>What would you think about, instead of using this trait internally, instead propagating the usage of <code>anyhow::Error</code> to the callers? This looks like it's mostly used in tests and such so I don't think it'll affect our public API or anything like that.</p>
</blockquote>
<p>This would result in a much more confusing situation where sometimes we are using <code>anyhow::Error</code> and sometimes we are using <code>wasmtime::Error</code> but either way it is imported locally as just <code>Error</code> so you always have to check to see which one you're dealing with and at the end of the day you are still going to have to convert between the two everywhere except in tests (which are only ~1/4 of the use sites, if you look at the diff) so we would just be making things more confusing and losing a clear line for determining when to use which error but we wouldn't even avoiding most of the conversions.</p>
<blockquote>
<p>Additionally, looking forward a bit, one thing I'm worried about is <code>bindgen!</code>-generated traits all written with <code>anyhow::Error</code> previously and deeply integrated with the rest of an embedding, and that would all in theory need to change and use this trait. What do you think about a new <code>bindgen!</code> configuration flag which, when enabled, uses <code>to_wasmtime_result()</code> and this trait on the result of all functions? It would generate trait signatures with <code>anyhow::Result</code> instead of <code>wasmtime::Result</code>, for example.</p>
</blockquote>
<p>Makes sense to me, but also probably something that doesn't need to happen in this PR, I don't think? If you feel strongly that it should be part of this PR, I can add it here though.</p>
</blockquote>



<a name="567642568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567642568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567642568">(Jan 12 2026 at 21:01)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567642569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567642569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567642569">(Jan 12 2026 at 21:01)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567642786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567642786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567642786">(Jan 12 2026 at 21:02)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3740358214">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<blockquote>
<p>Personally I'd like to see this trait used as an absolute last resort "quick hack before we figure out what's best to do instead" ideally.</p>
</blockquote>
<p>This trait <em>is</em> used as an absolute last resort, and not as a quick hack, already in this PR as it is today:</p>
<ul>
<li>All (non-cranelift) crates in the workspace have been migrated to <code>wasmtime[_environ]::Error</code>. This makes things uniform and gives us a simple rule for development in the workspace. No weird half-migrations or having to think about which kind of error to use/import at a given location.</li>
<li>All <code>core::error::Error</code> impls (including those originating from deps outside the workspace) automatically get converted into <code>wasmtime::Error</code> in <code>?</code> propagation and via <code>From&lt;E&gt; for wasmtime::Error where E: core::error::Error</code>. This is the same as when we were (or, still are) using <code>anyhow::Error</code>.</li>
<li>We <em>only</em> invoke <code>.to_wasmtime_result()</code> when the above cases do not apply: we are using a worskpace-external dep which returns an <code>anyhow::Error</code> (which does not implement <code>core::error::Error</code> due to conflicting trait impls). In this last case, we <em>absolutely must</em> use the <code>.to_wasmtime_result()</code> trait method (or some other quivalent explicit conversion) because we cannot implement <code>From&lt;anyhow::Error&gt; for wasmtime::Error</code> (for conflicting trait impl reasons similar to why there is no <code>impl core::error::Error for anyhow::Error</code>).</li>
</ul>
<p>This is not a quick hack. This is only and exactly the places where we must insert the conversions.</p>
<blockquote>
<p>What would you think about, instead of using this trait internally, instead propagating the usage of <code>anyhow::Error</code> to the callers? This looks like it's mostly used in tests and such so I don't think it'll affect our public API or anything like that.</p>
</blockquote>
<p>This would result in a much more confusing situation where sometimes we are using <code>anyhow::Error</code> and sometimes we are using <code>wasmtime::Error</code> but either way it is imported locally as just <code>Error</code> so you always have to check to see which one you're dealing with and at the end of the day you are still going to have to convert between the two everywhere except in tests (which are only ~1/4 of the use sites, if you look at the diff) so we would just be making things more confusing and losing a clear line for determining when to use which error but we wouldn't even avoiding most of the conversions.</p>
<blockquote>
<p>Additionally, looking forward a bit, one thing I'm worried about is <code>bindgen!</code>-generated traits all written with <code>anyhow::Error</code> previously and deeply integrated with the rest of an embedding, and that would all in theory need to change and use this trait. What do you think about a new <code>bindgen!</code> configuration flag which, when enabled, uses <code>to_wasmtime_result()</code> and this trait on the result of all functions? It would generate trait signatures with <code>anyhow::Result</code> instead of <code>wasmtime::Result</code>, for example.</p>
</blockquote>
<p>Makes sense to me, but also probably something that doesn't need to happen in this PR, I don't think? If you feel strongly that it should be part of this PR, I can add it here though.</p>
</blockquote>



<a name="567645443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567645443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567645443">(Jan 12 2026 at 21:21)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3740537231">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<p>Sorry yeah "quick hack" is not the right term for this, I was trying to emulate a use case of using <code>wasmtime::Error</code> in an application embedding and went a bit too far. I agree though with all your points about why this trait generally isn't needed, and it's clear that it's not pervasively needed throughout.</p>
<p>I think you're right as well that, in this workspace, trying to sometimes use <code>wasmtime::Error</code> and sometimes use <code>anyhow::Error</code> probably isn't worth it. That would remove the need for this conversion trait in this workspace but at too high of a conceptual cost.</p>
<p>Personally though I'm still not a fan of this trait. Idiomatically in Rust everyone expects <code>?</code> to handle type conversion of errors, so requiring a trait + <code>.to_wasmtime_result()</code> call is pretty unintuitive. I understand there's no better solution given our technical constraints, however. One learning, perhaps, is that it's the fault of the libraries in question for producing some sort of error that doesn't implement the <code>Error</code> trait (e.g. <code>anyhow::Error</code>). The libraries in question are apparently all me-inflicting-pain-on-myself:</p>
<ul>
<li>wasmprinter</li>
<li>wit-component</li>
<li>wasm-compose</li>
<li>pulley profiling</li>
<li>json-from-wast</li>
</ul>
<p>I think it would be reasonable to update these libraries to have a more dedicated error-type-per-library which does indeed implement the <code>Error</code> trait for any one particular error. That would mean that the majority of the conversions in this PR aren't necessary.</p>
<p>Question for you though, the other instance in this PR is the updates to the <code>cranelift-{fuzzgen,icache}</code> targets fuzz targets. I think we control the code in question, right? Is that perhaps more code to transition to <code>wasmtime::Error</code>, or a concrete error, as opposed to <code>anyhow::Error</code>? Because otherwise the current state of affairs is the confusion we're trying to avoid, where the internal libraries are using <code>anyhow</code> but shouldn't?</p>
<blockquote>
<p>also probably something that doesn't need to happen in this PR, I don't think? </p>
</blockquote>
<p>Agreed yeah, the <code>bindgen!</code> changes should be separate (sorry just wanted to write it down before I forgot and I was writing here). </p>
<p>If you're ok with it I'd prefer to block landing the actual switchover until this PR is implemented, but I would hope that this PR would be pretty easy to do.</p>
</blockquote>



<a name="567648177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567648177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567648177">(Jan 12 2026 at 21:40)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3740602598">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<blockquote>
<p>One learning, perhaps, is that it's the fault of the libraries in question for producing some sort of error that doesn't implement the <code>Error</code> trait (e.g. <code>anyhow::Error</code>).</p>
</blockquote>
<p>Yes, I would agree. We really shouldn't be doing that as much as possible.</p>
<p>Also somewhat Rust-the-language's fault for not allowing some kind of very basic specialization or something to enable both of the following impls to co-exist:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">anyhow</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Question for you though, the other instance in this PR is the updates to the <code>cranelift-{fuzzgen,icache}</code> targets fuzz targets. I think we control the code in question, right? Is that perhaps more code to transition to <code>wasmtime::Error</code>, or a concrete error, as opposed to <code>anyhow::Error</code>? Because otherwise the current state of affairs is the confusion we're trying to avoid, where the internal libraries are using <code>anyhow</code> but shouldn't?</p>
</blockquote>
<p>I wasn't totally sure what to do about cranelift code using <code>anyhow</code>, which is mostly testing/fuzzing/infra stuff, and ultimately opted to leave it using <code>anyhow</code> rather than <code>wasmtime_environ::Error</code> because that seemed (logically) like a weird dependency inversion. But then I also moved <code>wasmtime-fuzz</code> to <code>wasmtime::Error</code>, so I also moved the cranelift-specific fuzz targets over to <code>wasmtime::Error</code> as well, but not the cranelift fuzzing crates that they depend on.</p>
<p>I am not sure these were the right decisions. Maybe better to</p>
<ul>
<li>keep the cranelift fuzz targets on <code>anyhow</code>, or</li>
<li>move the cranelift crates using <code>anyhow</code> over to <code>wasmtime_environ::Error</code>, despite the "inverted" dependency?</li>
</ul>
<p>Any opinions on this? Or we can just leave the cut as-is. Its a bit ambiguous to me.</p>
<blockquote>
<p>If you're ok with it I'd prefer to block landing the actual switchover until this PR is implemented, but I would hope that this PR would be pretty easy to do.</p>
</blockquote>
<p>Sounds good to me.</p>
</blockquote>



<a name="567649747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567649747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567649747">(Jan 12 2026 at 21:51)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3740659071">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<p>I'd say switch cranelift fuzzing over to <code>anyhow</code> since that's what fuzzgen already uses, and then good to land?</p>
</blockquote>



<a name="567649768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567649768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567649768">(Jan 12 2026 at 21:51)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#pullrequestreview-3652882240">PR review</a>.</p>



<a name="567660563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567660563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567660563">(Jan 12 2026 at 23:30)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567660573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567660573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567660573">(Jan 12 2026 at 23:30)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567668221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567668221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567668221">(Jan 13 2026 at 01:05)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/12308#issuecomment-3741302017">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="567826960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567826960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567826960">(Jan 13 2026 at 17:51)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567826997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567826997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567826997">(Jan 13 2026 at 17:51)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<a name="567833690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312308%20Polyfill%20%60ToWasmtimeResult%60%20and%20add%20.../near/567833690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312308.20Polyfill.20.60ToWasmtimeResult.60.20and.20add.20.2E.2E.2E.html#567833690">(Jan 13 2026 at 18:28)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12308">PR #12308</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>