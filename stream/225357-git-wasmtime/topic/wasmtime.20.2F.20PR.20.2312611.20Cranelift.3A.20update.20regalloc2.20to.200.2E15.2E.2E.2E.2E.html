<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12611 Cranelift: update regalloc2 to 0.15.... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html">wasmtime / PR #12611 Cranelift: update regalloc2 to 0.15....</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="574396965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574396965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574396965">(Feb 17 2026 at 22:26)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a> from <code>cfallin:regalloc2-upgrade-vreg-bounds</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This pulls in <a href="https://github.com/bytecodealliance/regalloc2/issues/257">bytecodealliance/regalloc2#257</a> to permit more VRegs to be used in a single function body, addressing #12229 and our followup discussions about supporting function body sizes up to the Wasm implementation limit standard.</p>
<p>In addition to the RA2 upgrade, this also includes a bit more explicit limit-checking on the Cranelift side: note that we don't directly use <code>regalloc2::VReg</code> but instead we further bitpack it into <code>Reg</code>, which is logically a sum type of <code>VReg</code>, <code>PReg</code> and <code>SpillSlot</code> (the last one needed to represent stack allocation locations on defs, e.g. on callsites with many returns). <code>PReg</code>s are packed into the beginning of the <code>VReg</code> index space but <code>SpillSlot</code>s are distinguished by stealing the upper bit of a <code>u32</code>. This was previously not a problem given the smaller <code>VReg</code> index space but now we need to check explicitly; hence <code>Reg::from_virtual_reg_checked</code> and its use in the lowering vreg allocator. Because the <code>VReg</code> index packs the class into the bottom two bits, and index into the upper 30, but we steal one bit at the top, the true limit for VReg count is thus actually 2^29, or 512M.</p>
<p>Fixes #12229.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="574396966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574396966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574396966">(Feb 17 2026 at 22:26)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574396968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574396968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574396968">(Feb 17 2026 at 22:26)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574396969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574396969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574396969">(Feb 17 2026 at 22:26)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574397874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574397874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574397874">(Feb 17 2026 at 22:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12611#pullrequestreview-3816635397">PR review</a>.</p>



<a name="574403020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574403020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574403020">(Feb 17 2026 at 23:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12611#issuecomment-3917588371">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>:</p>
<blockquote>
<p>The failing test (<code>code_too_large</code>) fails as expected because we now support the generated function body size. A few thoughts though:</p>
<ul>
<li>In theory it should be impossible to write this test once we fully hit the goal of "compile any valid Wasm function that <code>wasmparser</code>'s implementation-limit checks pass on";</li>
<li>But there's still the interesting question of whether there's a "gap" as we sweep the code size upward where we start to throw errors;</li>
<li>In attempting to check this by increasing the test's <code>N</code>, I found that our <code>ValueDataPacked</code> encoding gives 24 bits to value numbers, so I'm working on reclaiming some bits there. In particular the <code>Type</code> encoding seems pretty inefficient so I'll try to steal some of those bits back.</li>
</ul>
</blockquote>



<a name="574403506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574403506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574403506">(Feb 17 2026 at 23:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/12611#issuecomment-3917603318">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>:</p>
<blockquote>
<p>I think that test already takes forever to compile/run in debug mode on all platforms so jettisoning that test doesn't seem unreasonable to me, and agreed it in theory should not be possible to write. Maybe it's sufficient to have a local script to run or some online corpus of "must compile big modules" or something like that?</p>
<p>Either that or we could create a dedicated test job for "compile wasmtime in release on one fast platform and compile big modules" to make sure everything succeeds.</p>
</blockquote>



<a name="574407947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574407947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574407947">(Feb 18 2026 at 00:10)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574407948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574407948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574407948">(Feb 18 2026 at 00:10)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574407950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574407950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574407950">(Feb 18 2026 at 00:10)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574407976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574407976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574407976">(Feb 18 2026 at 00:10)</a>:</h4>
<p>cfallin unassigned fitzgen from <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611 Cranelift: update regalloc2 to 0.15.0 to permit more VRegs.</a>.</p>



<a name="574408033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574408033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574408033">(Feb 18 2026 at 00:11)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/12611#issuecomment-3917737837">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>:</p>
<blockquote>
<p>Sure thing -- I'll push the "corpus of big inputs to test" as followup (after #12613 lands as well); removed the <code>code_too_large</code> test here.</p>
</blockquote>



<a name="574408039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574408039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574408039">(Feb 18 2026 at 00:11)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574409112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574409112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574409112">(Feb 18 2026 at 00:23)</a>:</h4>
<p>cfallin added <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611 Cranelift: update regalloc2 to 0.15.0 to permit more VRegs.</a> to the merge queue</p>



<a name="574412451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574412451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574412451">(Feb 18 2026 at 01:04)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611</a>.</p>



<a name="574412455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312611%20Cranelift%3A%20update%20regalloc2%20to%200.15..../near/574412455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312611.20Cranelift.3A.20update.20regalloc2.20to.200.2E15.2E.2E.2E.2E.html#574412455">(Feb 18 2026 at 01:04)</a>:</h4>
<p>cfallin removed <a href="https://github.com/bytecodealliance/wasmtime/pull/12611">PR #12611 Cranelift: update regalloc2 to 0.15.0 to permit more VRegs.</a> from the merge queue</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>