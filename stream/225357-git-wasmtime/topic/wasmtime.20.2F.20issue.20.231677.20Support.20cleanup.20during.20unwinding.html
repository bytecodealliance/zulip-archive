<html>
<head><meta charset="utf-8"><title>wasmtime / issue #1677 Support cleanup during unwinding · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html">wasmtime / issue #1677 Support cleanup during unwinding</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="244792591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/244792591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#244792591">(Jul 03 2021 at 09:03)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-873373778">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>Original pdf no longer exists. See <a href="https://itanium-cxx-abi.github.io/cxx-abi/abi-eh.html">https://itanium-cxx-abi.github.io/cxx-abi/abi-eh.html</a> instead.</p>
</blockquote>



<a name="338130784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/338130784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#338130784">(Feb 26 2023 at 11:12)</a>:</h4>
<p>bayedieng <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-1445332741">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>Could this issue be solved independently using the aforementioned solution in the OP's comment or would #3427 be needed to be resolved first?</p>
</blockquote>



<a name="338131830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/338131830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#338131830">(Feb 26 2023 at 11:20)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-1445334653">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>I'm working on this.</p>
</blockquote>



<a name="447181252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/447181252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#447181252">(Jun 26 2024 at 10:34)</a>:</h4>
<p>noverby <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2191363114">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>@bjorn3 Any PR or branch where it is possible to follow progress?</p>
</blockquote>



<a name="447183418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/447183418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#447183418">(Jun 26 2024 at 10:45)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2191384907">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p><a href="https://github.com/bjorn3/wasmtime/tree/bsc-unwinding-simple-invoke3">https://github.com/bjorn3/wasmtime/tree/bsc-unwinding-simple-invoke3</a> is the latest version I have. I will rebase it and work on upstreaming when I finish my thesis about it.</p>
</blockquote>



<a name="513978469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/513978469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#513978469">(Apr 23 2025 at 23:07)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Currently the generated unwinding information only restores registers. This issue proposes to make it possible to also run cleanup actions like running destructors during unwinding.</p>
<h4>Benefit</h4>
<p>This is necessary to support unwinding after a panic in rustc_codegen_cranelift.</p>
<h4>Implementation</h4>
<p>Add a new <code>invoke</code> terminator that is similar to the <code>call</code> instruction, but has an additional cleanup edge. This cleanup edge will be ignored when emitting actual machine instructions, but it will take part in the regalloc. Next add a way to mark a block as "landing pad". Only "landing pad" blocks can be used as cleanup edge of an <code>invoke</code> terminator. At the start of a "cleanup" block all values are stored either on stack or in any of the registers restored by the system unwinder. The "landing pad" block can also take several arguments. Those will be the values stored in the registers that are allowed for arguments to the landing pad received from the personality function. After codegen the location of every "landing pad" block will be stored in a variable. This will allow the embedder to generate the appropriate LSDA (language specific data area) to reference from the unwinding table.</p>
<h4>Alternatives</h4>
<p>It is basically impossible to implement cleanup during unwinding without Cranelift support.</p>
<h4>References</h4>
<p>The "Transferring Control to a Landing Pad" section of <a href="https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf">https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf</a></p>
</blockquote>



<a name="513978470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/513978470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#513978470">(Apr 23 2025 at 23:07)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2825724575">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>Cleaning up old issues and I believe this is covered now by the exceptions support we landed recently (#10510). Thanks all (and thanks bjorn3 for the experimental work that helped us develop our current design).</p>
</blockquote>



<a name="514082114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/514082114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#514082114">(Apr 24 2025 at 10:29)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2827125338">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>Oh, does wasmtime support exceptions now? This is incredibly exciting, is there anything I can read on that?</p>
</blockquote>



<a name="514114815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/514114815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#514114815">(Apr 24 2025 at 12:42)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2827482734">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>This isn't implemented on the Wasmtime side yet.</p>
</blockquote>



<a name="514115358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/514115358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#514115358">(Apr 24 2025 at 12:44)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2827482734">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>This isn't implemented on the Wasmtime side yet.</p>
<p>Edit: <a href="https://github.com/bytecodealliance/wasmtime/issues/2049">https://github.com/bytecodealliance/wasmtime/issues/2049</a>, <a href="https://github.com/bytecodealliance/wasmtime/issues/3427">https://github.com/bytecodealliance/wasmtime/issues/3427</a> and <a href="https://github.com/bytecodealliance/wasmtime/issues/10252">https://github.com/bytecodealliance/wasmtime/issues/10252</a> are still open.</p>
</blockquote>



<a name="514163346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/514163346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#514163346">(Apr 24 2025 at 15:52)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2828119761">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>Right, this issue was specifically about Cranelift exceptions, @whitequark -- I will hopefully get time to do the Wasmtime side soon (next few months-ish)...</p>
</blockquote>



<a name="514175277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/514175277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#514175277">(Apr 24 2025 at 16:48)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2828257322">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>And if you'd like to learn more, here is the RFC: <a href="https://github.com/bytecodealliance/rfcs/pull/36">https://github.com/bytecodealliance/rfcs/pull/36</a></p>
</blockquote>



<a name="514175795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231677%20Support%20cleanup%20during%20unwinding/near/514175795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231677.20Support.20cleanup.20during.20unwinding.html#514175795">(Apr 24 2025 at 16:51)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/1677#issuecomment-2828266402">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">issue #1677</a>:</p>
<blockquote>
<p>Thanks all!</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>