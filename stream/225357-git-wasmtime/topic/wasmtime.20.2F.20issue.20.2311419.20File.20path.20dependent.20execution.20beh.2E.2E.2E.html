<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11419 File path dependent execution beh... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311419.20File.20path.20dependent.20execution.20beh.2E.2E.2E.html">wasmtime / issue #11419 File path dependent execution beh...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="533929901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311419%20File%20path%20dependent%20execution%20beh.../near/533929901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311419.20File.20path.20dependent.20execution.20beh.2E.2E.2E.html#533929901">(Aug 12 2025 at 08:19)</a>:</h4>
<p>erxiaozhou opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11419">issue #11419</a>:</p>
<blockquote>
<h2>Summary</h2>
<p>Wasmtime exhibits non-deterministic behavior where identical WebAssembly files produce different execution results based solely on their file paths. </p>
<h2>Steps to Reproduce</h2>
<ol>
<li>Create two identical WASM files with different names:<br>
case: </li>
</ol>
<p><a href="https://github.com/user-attachments/files/21729973/rt3.zip">rt3.zip</a></p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># Files are byte-for-byte identical</span>
md5sum<span class="w"> </span>tt/rt3.wasm<span class="w"> </span>tt/combine_out.wasm
<span class="c1"># b19d889a5d6828ace636f2669d68c919  tt/rt3.wasm</span>
<span class="c1"># b19d889a5d6828ace636f2669d68c919  tt/combine_out.wasm</span>
</code></pre></div>
<ol start="2">
<li>Run both files with identical Wasmtime options:</li>
</ol>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wasmtime<span class="w"> </span>run<span class="w">   </span>tt/rt3.wasm
wasmtime<span class="w"> </span>run<span class="w">  </span>tt/combine_out.wasm
</code></pre></div>
<h2>Expected Results</h2>
<p>Both executions should produce identical results since the files are byte-for-byte identical.</p>
<h2>Actual Results</h2>
<ul>
<li><code>tt/rt3.wasm</code>: Executes successfully (returncode 0)</li>
<li><code>tt/combine_out.wasm</code>: Fails with <code>indirect call type mismatch</code> error</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">tt</span><span class="o">/</span><span class="n">combine_out</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">indirect</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">mismatch</span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">38</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">39</span><span class="o">&gt;</span>
</code></pre></div>
<h2>Additional Evidence</h2>
<h2>Environment</h2>
<ul>
<li><strong>Wasmtime version</strong>: v35.0.0 </li>
<li><strong>Operating system</strong>: Ubuntu</li>
<li><strong>Architecture</strong>: x86_64</li>
<li><strong>Compilation</strong>: The WASM file appears to be compiled with optimization and contains indirect calls</li>
</ul>
<p>The following workarounds were tested but <strong>did not resolve</strong> the issue:</p>
<ul>
<li><code>--disable-cache</code></li>
<li><code>--disable-address-map</code> </li>
<li><code>--disable-memory-init-cow</code></li>
<li><code>--opt-level 0</code></li>
<li>Clearing <code>~/.cache/wasmtime/</code></li>
<li>Using absolute paths vs relative paths</li>
</ul>
<p>I'm not sure whether the behavior can be reproduced, because it seems to be associated with the host.<br>
</p>
</blockquote>



<a name="533999237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311419%20File%20path%20dependent%20execution%20beh.../near/533999237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311419.20File.20path.20dependent.20execution.20beh.2E.2E.2E.html#533999237">(Aug 12 2025 at 14:55)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11419#issuecomment-3179706436">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11419">issue #11419</a>:</p>
<blockquote>
<p>This program imports <code>"wasi_snapshot_preview1" "args_get"</code> which is a source of non-determinisim for when the program is run under two paths. I've seen bugs in programs in the past related to the length of a filename causing different malloc behavior. Do you have reason to believe this is a bug in Wasmtime and not a bug in the guest? For example if the guest traps if the filename is larger than 10 characters that'll look like different behavior when in fact it's a bug in the guest. Do you, for example, have the source code this guest was generated from?</p>
<p>I might recommend reading over <a href="https://docs.wasmtime.dev/contributing-fuzzing.html#external-fuzzing-campaigns">https://docs.wasmtime.dev/contributing-fuzzing.html#external-fuzzing-campaigns</a> as well if you're doing fuzzing.</p>
</blockquote>



<a name="534341617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311419%20File%20path%20dependent%20execution%20beh.../near/534341617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311419.20File.20path.20dependent.20execution.20beh.2E.2E.2E.html#534341617">(Aug 14 2025 at 04:54)</a>:</h4>
<p>erxiaozhou closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11419">issue #11419</a>:</p>
<blockquote>
<h2>Summary</h2>
<p>Wasmtime exhibits non-deterministic behavior where identical WebAssembly files produce different execution results based solely on their file paths. </p>
<h2>Steps to Reproduce</h2>
<ol>
<li>Create two identical WASM files with different names:<br>
case: </li>
</ol>
<p><a href="https://github.com/user-attachments/files/21729973/rt3.zip">rt3.zip</a></p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># Files are byte-for-byte identical</span>
md5sum<span class="w"> </span>tt/rt3.wasm<span class="w"> </span>tt/combine_out.wasm
<span class="c1"># b19d889a5d6828ace636f2669d68c919  tt/rt3.wasm</span>
<span class="c1"># b19d889a5d6828ace636f2669d68c919  tt/combine_out.wasm</span>
</code></pre></div>
<ol start="2">
<li>Run both files with identical Wasmtime options:</li>
</ol>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wasmtime<span class="w"> </span>run<span class="w">   </span>tt/rt3.wasm
wasmtime<span class="w"> </span>run<span class="w">  </span>tt/combine_out.wasm
</code></pre></div>
<h2>Expected Results</h2>
<p>Both executions should produce identical results since the files are byte-for-byte identical.</p>
<h2>Actual Results</h2>
<ul>
<li><code>tt/rt3.wasm</code>: Executes successfully (returncode 0)</li>
<li><code>tt/combine_out.wasm</code>: Fails with <code>indirect call type mismatch</code> error</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">tt</span><span class="o">/</span><span class="n">combine_out</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span><span class="p">:</span><span class="w"> </span><span class="nc">indirect</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">mismatch</span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">38</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">39</span><span class="o">&gt;</span>
</code></pre></div>
<h2>Additional Evidence</h2>
<h2>Environment</h2>
<ul>
<li><strong>Wasmtime version</strong>: v35.0.0 </li>
<li><strong>Operating system</strong>: Ubuntu</li>
<li><strong>Architecture</strong>: x86_64</li>
<li><strong>Compilation</strong>: The WASM file appears to be compiled with optimization and contains indirect calls</li>
</ul>
<p>The following workarounds were tested but <strong>did not resolve</strong> the issue:</p>
<ul>
<li><code>--disable-cache</code></li>
<li><code>--disable-address-map</code> </li>
<li><code>--disable-memory-init-cow</code></li>
<li><code>--opt-level 0</code></li>
<li>Clearing <code>~/.cache/wasmtime/</code></li>
<li>Using absolute paths vs relative paths</li>
</ul>
<p>I'm not sure whether the behavior can be reproduced, because it seems to be associated with the host.<br>
</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>