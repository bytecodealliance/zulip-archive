<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12411 PGO errors with wasmtime::compone... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html">wasmtime / issue #12411 PGO errors with wasmtime::compone...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="569791705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569791705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569791705">(Jan 23 2026 at 19:45)</a>:</h4>
<p>tliron opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>While trying to create a PGO build of a complex program that uses wasmtime as well as <code>wasmtime::component::bindgen</code> I encountered a linker error during the PGO optimization phase:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/{libregex-c07ab95555f39da0,libregex_automata-7ee923d5f6c2717f,libaho_corasick-5c8f4fd45dbfd81d,libmemchr-6bf3bd84cc706660,libregex_syntax-29ae9a4cd46cd534,libpuccini_plugin_sdk_tosca_2_0-e5bae6e4238f19b8,libchrono-cdb2d612e7931659,libiana_time_zone-e1ddac5c8d3f6e30,libbase64-bc218090048adb9e,libfloria_plugin_sdk-2d3041ed2aa76b6f,libwit_bindgen-d74a0375665663a5,libwaki-0efdb38898b964aa,libform_urlencoded-b370f73aedd7d6ac,libpercent_encoding-3f263064c2841206,libwit_bindgen-fb809008eb3c2160,libwit_bindgen_rt-0a4c48ecc7933c57,libbitflags-50780dc367a8909d,libhttp-25d9a9cb8324f3c8,libitoa-6dd9b0b770f89707,libbytes-fe6d9b7a8a9571c5,libanyhow-8b765c7e03803d5b,libordered_float-1bbdc6eb007024dd,libserde-6a94ee0c090e296d,libserde_core-67855228a5a4e304,libnum_traits-24fe799717f9791d}.rlib"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,libcfg_if-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/tmp/rustctoZu3J/raw-dylibs"</span><span class="w"> </span><span class="s">"-B&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/bin/gcc-ld"</span><span class="w"> </span><span class="s">"-fuse-ld=lld"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-z,noexecstack"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/libpuccini_plugin_tosca_2_0.so"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-shared"</span><span class="w"> </span><span class="s">"-Wl,-z,relro,-z,now"</span><span class="w"> </span><span class="s">"-Wl,-O1"</span><span class="w"> </span><span class="s">"-Wl,--strip-debug"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">rust</span><span class="o">-</span><span class="n">lld</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rustctoZu3J</span><span class="o">/</span><span class="n">list</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span><span class="cp">#[method]</span><span class="n">custom</span><span class="o">-</span><span class="n">resource</span><span class="p">.</span><span class="n">replica</span><span class="p">;</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="o">^</span>
<span class="w">          </span><span class="n">collect2</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>
</code></pre></div>
<p>As you can see, it <em>seems</em> to have something to do with the symbol name for the C ABI. I opened this <a href="https://github.com/Kobzol/cargo-pgo/issues/79">issue first on cargo-pgo</a> but it's a head-scratcher.</p>
<p>Maybe we can try to figure this out together?</p>
<h3>Steps to Reproduce</h3>
<p>Not trivial, but the best way is this:</p>
<p>Clone and install the <a href="https://github.com/tliron/khutulun-dev">khutulun-dev</a> repository. And then try to PGO Puccini:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">puccini</span>
<span class="n">PGO</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="n">WASM_PRECOMPILE</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">LTO</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">r</span>
</code></pre></div>
<p>(We don't actually need to disable Wasm precompile and LOT, but they don't make a different for this bug and this will get you the results faster)</p>
<p>For reference, here is the <a href="https://github.com/tliron/floria/blob/main/library/assets/wit/floria-plugins.wit">WIT file</a> used.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 41.0.0</p>
<p>Operating system: Fedora 43</p>
<p>Architecture: x86-64</p>
</blockquote>



<a name="569791706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569791706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569791706">(Jan 23 2026 at 19:45)</a>:</h4>
<p><a href="https://github.com/tliron">tliron</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">Issue #12411</a>.</p>



<a name="569792414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569792414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569792414">(Jan 23 2026 at 19:50)</a>:</h4>
<p>tliron edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>While trying to create a PGO build of a complex program that uses wasmtime as well as <code>wasmtime::component::bindgen</code> I encountered a linker error during the PGO optimization phase:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/{libregex-c07ab95555f39da0,libregex_automata-7ee923d5f6c2717f,libaho_corasick-5c8f4fd45dbfd81d,libmemchr-6bf3bd84cc706660,libregex_syntax-29ae9a4cd46cd534,libpuccini_plugin_sdk_tosca_2_0-e5bae6e4238f19b8,libchrono-cdb2d612e7931659,libiana_time_zone-e1ddac5c8d3f6e30,libbase64-bc218090048adb9e,libfloria_plugin_sdk-2d3041ed2aa76b6f,libwit_bindgen-d74a0375665663a5,libwaki-0efdb38898b964aa,libform_urlencoded-b370f73aedd7d6ac,libpercent_encoding-3f263064c2841206,libwit_bindgen-fb809008eb3c2160,libwit_bindgen_rt-0a4c48ecc7933c57,libbitflags-50780dc367a8909d,libhttp-25d9a9cb8324f3c8,libitoa-6dd9b0b770f89707,libbytes-fe6d9b7a8a9571c5,libanyhow-8b765c7e03803d5b,libordered_float-1bbdc6eb007024dd,libserde-6a94ee0c090e296d,libserde_core-67855228a5a4e304,libnum_traits-24fe799717f9791d}.rlib"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,libcfg_if-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/tmp/rustctoZu3J/raw-dylibs"</span><span class="w"> </span><span class="s">"-B&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/bin/gcc-ld"</span><span class="w"> </span><span class="s">"-fuse-ld=lld"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-z,noexecstack"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/libpuccini_plugin_tosca_2_0.so"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-shared"</span><span class="w"> </span><span class="s">"-Wl,-z,relro,-z,now"</span><span class="w"> </span><span class="s">"-Wl,-O1"</span><span class="w"> </span><span class="s">"-Wl,--strip-debug"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">rust</span><span class="o">-</span><span class="n">lld</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rustctoZu3J</span><span class="o">/</span><span class="n">list</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span><span class="cp">#[method]</span><span class="n">custom</span><span class="o">-</span><span class="n">resource</span><span class="p">.</span><span class="n">replica</span><span class="p">;</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="o">^</span>
<span class="w">          </span><span class="n">collect2</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>
</code></pre></div>
<p>As you can see, it <em>seems</em> to have something to do with the symbol name for the C ABI. I opened this <a href="https://github.com/Kobzol/cargo-pgo/issues/79">issue first on cargo-pgo</a> but it's a head-scratcher.</p>
<p>Maybe we can try to figure this out together?</p>
<h3>Steps to Reproduce</h3>
<p>Not trivial, but the best way is this:</p>
<p>Clone and install the <a href="https://github.com/tliron/khutulun-dev">khutulun-dev</a> repository. And then try to PGO Puccini:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">puccini</span>
<span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">examples</span>
<span class="n">PGO</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="n">WASM_PRECOMPILE</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">LTO</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">r</span>
</code></pre></div>
<p>(We don't actually need to disable Wasm precompile and LOT, but they don't make a different for this bug and this will get you the results faster)</p>
<p>For reference, here is the <a href="https://github.com/tliron/floria/blob/main/library/assets/wit/floria-plugins.wit">WIT file</a> used.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 41.0.0</p>
<p>Operating system: Fedora 43</p>
<p>Architecture: x86-64</p>
</blockquote>



<a name="569792493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569792493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569792493">(Jan 23 2026 at 19:50)</a>:</h4>
<p>tliron edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>While trying to create a PGO build of a complex program that uses wasmtime as well as <code>wasmtime::component::bindgen</code> I encountered a linker error during the PGO optimization phase:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/{libregex-c07ab95555f39da0,libregex_automata-7ee923d5f6c2717f,libaho_corasick-5c8f4fd45dbfd81d,libmemchr-6bf3bd84cc706660,libregex_syntax-29ae9a4cd46cd534,libpuccini_plugin_sdk_tosca_2_0-e5bae6e4238f19b8,libchrono-cdb2d612e7931659,libiana_time_zone-e1ddac5c8d3f6e30,libbase64-bc218090048adb9e,libfloria_plugin_sdk-2d3041ed2aa76b6f,libwit_bindgen-d74a0375665663a5,libwaki-0efdb38898b964aa,libform_urlencoded-b370f73aedd7d6ac,libpercent_encoding-3f263064c2841206,libwit_bindgen-fb809008eb3c2160,libwit_bindgen_rt-0a4c48ecc7933c57,libbitflags-50780dc367a8909d,libhttp-25d9a9cb8324f3c8,libitoa-6dd9b0b770f89707,libbytes-fe6d9b7a8a9571c5,libanyhow-8b765c7e03803d5b,libordered_float-1bbdc6eb007024dd,libserde-6a94ee0c090e296d,libserde_core-67855228a5a4e304,libnum_traits-24fe799717f9791d}.rlib"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,libcfg_if-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/tmp/rustctoZu3J/raw-dylibs"</span><span class="w"> </span><span class="s">"-B&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/bin/gcc-ld"</span><span class="w"> </span><span class="s">"-fuse-ld=lld"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-z,noexecstack"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/libpuccini_plugin_tosca_2_0.so"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-shared"</span><span class="w"> </span><span class="s">"-Wl,-z,relro,-z,now"</span><span class="w"> </span><span class="s">"-Wl,-O1"</span><span class="w"> </span><span class="s">"-Wl,--strip-debug"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">rust</span><span class="o">-</span><span class="n">lld</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rustctoZu3J</span><span class="o">/</span><span class="n">list</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span><span class="cp">#[method]</span><span class="n">custom</span><span class="o">-</span><span class="n">resource</span><span class="p">.</span><span class="n">replica</span><span class="p">;</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="o">^</span>
<span class="w">          </span><span class="n">collect2</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>
</code></pre></div>
<p>As you can see, it <em>seems</em> to have something to do with the symbol name for the C ABI. I opened this <a href="https://github.com/Kobzol/cargo-pgo/issues/79">issue first on cargo-pgo</a> but it's a head-scratcher.</p>
<p>Maybe we can try to figure this out together?</p>
<h3>Steps to Reproduce</h3>
<p>Not trivial, but the best way is this:</p>
<p>Clone and install the <a href="https://github.com/tliron/khutulun-dev">khutulun-dev</a> repository. And then try to PGO Puccini:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">puccini</span>
<span class="n">scripts</span><span class="o">/</span><span class="n">build</span>
<span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">examples</span>
<span class="n">PGO</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="n">WASM_PRECOMPILE</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">LTO</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">r</span>
</code></pre></div>
<p>(We don't actually need to disable Wasm precompile and LOT, but they don't make a different for this bug and this will get you the results faster)</p>
<p>For reference, here is the <a href="https://github.com/tliron/floria/blob/main/library/assets/wit/floria-plugins.wit">WIT file</a> used.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 41.0.0</p>
<p>Operating system: Fedora 43</p>
<p>Architecture: x86-64</p>
</blockquote>



<a name="569792556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569792556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569792556">(Jan 23 2026 at 19:51)</a>:</h4>
<p>tliron edited <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>While trying to create a PGO build of a complex program that uses wasmtime as well as <code>wasmtime::component::bindgen</code> I encountered a linker error during the PGO optimization phase:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/{libregex-c07ab95555f39da0,libregex_automata-7ee923d5f6c2717f,libaho_corasick-5c8f4fd45dbfd81d,libmemchr-6bf3bd84cc706660,libregex_syntax-29ae9a4cd46cd534,libpuccini_plugin_sdk_tosca_2_0-e5bae6e4238f19b8,libchrono-cdb2d612e7931659,libiana_time_zone-e1ddac5c8d3f6e30,libbase64-bc218090048adb9e,libfloria_plugin_sdk-2d3041ed2aa76b6f,libwit_bindgen-d74a0375665663a5,libwaki-0efdb38898b964aa,libform_urlencoded-b370f73aedd7d6ac,libpercent_encoding-3f263064c2841206,libwit_bindgen-fb809008eb3c2160,libwit_bindgen_rt-0a4c48ecc7933c57,libbitflags-50780dc367a8909d,libhttp-25d9a9cb8324f3c8,libitoa-6dd9b0b770f89707,libbytes-fe6d9b7a8a9571c5,libanyhow-8b765c7e03803d5b,libordered_float-1bbdc6eb007024dd,libserde-6a94ee0c090e296d,libserde_core-67855228a5a4e304,libnum_traits-24fe799717f9791d}.rlib"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,libcfg_if-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/tmp/rustctoZu3J/raw-dylibs"</span><span class="w"> </span><span class="s">"-B&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/bin/gcc-ld"</span><span class="w"> </span><span class="s">"-fuse-ld=lld"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-z,noexecstack"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/xxx/.cargo/target/x86_64-unknown-linux-gnu/release/deps/libpuccini_plugin_tosca_2_0.so"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-shared"</span><span class="w"> </span><span class="s">"-Wl,-z,relro,-z,now"</span><span class="w"> </span><span class="s">"-Wl,-O1"</span><span class="w"> </span><span class="s">"-Wl,--strip-debug"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">rust</span><span class="o">-</span><span class="n">lld</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rustctoZu3J</span><span class="o">/</span><span class="n">list</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="n">cabi_post_floria</span><span class="p">:</span><span class="nc">plugins</span><span class="o">/</span><span class="n">dispatch</span><span class="cp">#[method]</span><span class="n">custom</span><span class="o">-</span><span class="n">resource</span><span class="p">.</span><span class="n">replica</span><span class="p">;</span>
<span class="w">          </span><span class="o">&gt;&gt;&gt;</span><span class="w">     </span><span class="o">^</span>
<span class="w">          </span><span class="n">collect2</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>
</code></pre></div>
<p>As you can see, it <em>seems</em> to have something to do with the symbol name for the C ABI. I opened this <a href="https://github.com/Kobzol/cargo-pgo/issues/79">issue first on cargo-pgo</a> but it's a head-scratcher.</p>
<p>Maybe we can try to figure this out together?</p>
<h3>Steps to Reproduce</h3>
<p>Not trivial, but the best way is this:</p>
<p>Clone and install the <a href="https://github.com/tliron/khutulun-dev">khutulun-dev</a> repository. And then try to PGO Puccini:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">puccini</span>
<span class="n">scripts</span><span class="o">/</span><span class="n">build</span>
<span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">examples</span>
<span class="n">PGO</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="n">WASM_PRECOMPILE</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">LTO</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">r</span>
</code></pre></div>
<p>(We don't actually need to disable Wasm precompile and LTO, but they don't make a different for this bug and this will get you the results faster)</p>
<p>For reference, here is the <a href="https://github.com/tliron/floria/blob/main/library/assets/wit/floria-plugins.wit">WIT file</a> used.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 41.0.0</p>
<p>Operating system: Fedora 43</p>
<p>Architecture: x86-64</p>
</blockquote>



<a name="569793761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569793761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569793761">(Jan 23 2026 at 19:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12411#issuecomment-3792127713">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>Thanks for the report! I think this is probably due to <code>wit-bindgen</code>, however, since that symbol looks like it was generated by <code>wit-bindgen</code>. Would it be possible to exclude the dependency using <code>wit-bindgen</code> on native platforms? That's still something that should probably be fixed in wit-bindgen itself but for now excluding that dependency might work</p>
</blockquote>



<a name="569795014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569795014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569795014">(Jan 23 2026 at 20:07)</a>:</h4>
<p>tliron <a href="https://github.com/bytecodealliance/wasmtime/issues/12411#issuecomment-3792163513">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>Thanks, though I'm not entirely sure I follow.</p>
<p>I am not <em>exactly</em> using wit-bindgen. Well, it's there when I build the Wasm blob, and that blob <em>is</em> included in this binary (using <code>include_bytes!</code>), which is then compiled at runtime by cranelift in wasmtime. But that's indirect and I don't think that would be related to PGO of the program itself. Specifically, when I run <code>cargo pgo optimize</code> there is no Wasm blob involved.</p>
<p>But maybe you mean something else? Where do you intend for me disable a wit-bindgen dependency?</p>
</blockquote>



<a name="569795481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569795481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569795481">(Jan 23 2026 at 20:11)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12411#issuecomment-3792183597">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>The symbol name in question, <code>cabi_post_floria:plugins/dispatch#[method]custom-resource.replica</code>, is a symbol generated by <code>wit-bindgen</code>. I agree <code>wit-bindgen</code> is intended for in-wasm use primarily, but it's possible for it to leak in to the crate graph nonetheless in some situations for native compilations.</p>
<p>For example the linker command line you pasted here contains <code>libfloria_plugin_sdk-2d3041ed2aa76b6f,libwit_bindgen-d74a0375665663a5</code> which looks like it's including an SDK that was intended for wasm and <code>wit-bindgen</code> itself is being linked in. This is someting we can fix in <code>wit-bindgen</code> (generate different symbol names on native that are more amenable to native linkers), but if you're able to exclude the dependency on <code>floria-plugin-sdk</code> that'd probably also help here.</p>
</blockquote>



<a name="569796987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569796987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569796987">(Jan 23 2026 at 20:22)</a>:</h4>
<p>tliron <a href="https://github.com/bytecodealliance/wasmtime/issues/12411#issuecomment-3792238178">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411</a>:</p>
<blockquote>
<p>Good catch!</p>
<p>The issue seems to be with the cargo-pgo tool. It was trying to optimize <em>everything</em> in the <code>[workspace]</code> project, which <em>included</em> the Wasm blob, and that was where I got the failure. After some hacking I was able to get it to get it to only optimize the native binary, and there was no failure there.</p>
<p>I will continue the issue in cargo-pgo, but I wonder if it's worth pursuing the secondary issue of PGO for wit-bindgen Wasm builds. I would think that it's an important use case to have PGO there. You say that it might possible to produce more compatible symbols there. How do you recommend we proceed? Open an issue with wit-bindgen?</p>
</blockquote>



<a name="569797163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312411%20PGO%20errors%20with%20wasmtime%3A%3Acompone.../near/569797163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312411.20PGO.20errors.20with.20wasmtime.3A.3Acompone.2E.2E.2E.html#569797163">(Jan 23 2026 at 20:24)</a>:</h4>
<p>alexcrichton transferred <a href="https://github.com/bytecodealliance/wasmtime/issues/12411">issue #12411 PGO errors with wasmtime::component::bindgen</a> to <a href="https://github.com/bytecodealliance/wit-bindgen/issues/1509">bytecodealliance/wit-bindgen/#1509</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>