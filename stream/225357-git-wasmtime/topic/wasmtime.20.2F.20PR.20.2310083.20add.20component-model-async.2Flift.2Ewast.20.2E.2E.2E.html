<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10083 add component-model-async/lift.wast ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html">wasmtime / PR #10083 add component-model-async/lift.wast ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="495386860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495386860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495386860">(Jan 22 2025 at 22:42)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495386861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495386861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495386861">(Jan 22 2025 at 22:42)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a> from <code>dicej:async-lift-test</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is another piece of #9582 which I'm splitting out to make review easier.</p>
<p>This test includes two components: one which exports a function using the async-with-callback ABI, and another which uses the async-without-callback ABI. It doesn't actually instantiate or run either component yet.</p>
<p>The rest of the changes fill in some TODOs to make the test pass.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="495386862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495386862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495386862">(Jan 22 2025 at 22:42)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495386863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495386863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495386863">(Jan 22 2025 at 22:42)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495387327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495387327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495387327">(Jan 22 2025 at 22:47)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2568450811">PR review</a>.</p>



<a name="495387328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495387328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495387328">(Jan 22 2025 at 22:47)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1926077406">PR review comment</a>:</p>
<blockquote>
<p>This file was shamelessly copied from <a href="http://resources.rs">resources.rs</a> and modified for use with stream/future/error-context state.  Those handles are different enough from resource handles that I didn't want to try to address everything with a single data structure.  I'm open to other approaches, though.</p>
</blockquote>



<a name="495389884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495389884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495389884">(Jan 22 2025 at 23:08)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495390849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495390849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495390849">(Jan 22 2025 at 23:17)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495391489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495391489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495391489">(Jan 22 2025 at 23:23)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495402290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495402290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495402290">(Jan 23 2025 at 01:05)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#issuecomment-2608626933">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing", "wasmtime:api", "wasmtime:config"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="495408802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495408802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495408802">(Jan 23 2025 at 02:07)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#issuecomment-2608695611">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>:</p>
<blockquote>
<h4>Label Messager: wasmtime:config</h4>
<p>It looks like you are changing Wasmtime's configuration options. Make sure to<br>
complete this check list:</p>
<ul>
<li>
<p>[ ] If you added a new <code>Config</code> method, you wrote extensive documentation for<br>
      it.</p>
<p>&lt;details&gt;</p>
<p>Our documentation should be of the following form:</p>
<p>```text<br>
Short, simple summary sentence.</p>
<p>More details. These details can be multiple paragraphs. There should be<br>
information about not just the method, but its parameters and results as<br>
well.</p>
<p>Is this method fallible? If so, when can it return an error?</p>
<p>Can this method panic? If so, when does it panic?</p>
<h1>Example</h1>
<p>Optional example here.<br>
```</p>
<p>&lt;/details&gt;</p>
</li>
<li>
<p>[ ] If you added a new <code>Config</code> method, or modified an existing one, you<br>
  ensured that this configuration is exercised by the fuzz targets.</p>
<p>&lt;details&gt;</p>
<p>For example, if you expose a new strategy for allocating the next instance<br>
slot inside the pooling allocator, you should ensure that at least one of our<br>
fuzz targets exercises that new strategy.</p>
<p>Often, all that is required of you is to ensure that there is a knob for this<br>
configuration option in [<code>wasmtime_fuzzing::Config</code>][fuzzing-config] (or one<br>
of its nested <code>struct</code>s).</p>
<p>Rarely, this may require authoring a new fuzz target to specifically test this<br>
configuration. See [our docs on fuzzing][fuzzing-docs] for more details.</p>
<p>&lt;/details&gt;</p>
</li>
<li>
<p>[ ] If you are enabling a configuration option by default, make sure that it<br>
  has been fuzzed for at least two weeks before turning it on by default.</p>
</li>
</ul>
<p>[fuzzing-config]: <a href="https://github.com/bytecodealliance/wasmtime/blob/ca0e8d0a1d8cefc0496dba2f77a670571d8fdcab/crates/fuzzing/src/generators.rs#L182-L194">https://github.com/bytecodealliance/wasmtime/blob/ca0e8d0a1d8cefc0496dba2f77a670571d8fdcab/crates/fuzzing/src/generators.rs#L182-L194</a><br>
[fuzzing-docs]: <a href="https://docs.wasmtime.dev/contributing-fuzzing.html">https://docs.wasmtime.dev/contributing-fuzzing.html</a></p>
<hr>
<p>&lt;details&gt;</p>
<p>To modify this label's message, edit the &lt;code&gt;.github/label-messager/wasmtime-config.md&lt;/code&gt; file.</p>
<p>To add new label messages or remove existing label messages, edit the<br>
&lt;code&gt;.github/label-messager.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/label-messager-action">Learn more.</a></p>
<p>&lt;/details&gt;</p>
</blockquote>



<a name="495606409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606409">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2568540188">PR review</a>:</p>
<blockquote>
<p>I'm definitely pretty far out of my comfort zone reviewing this in the sense that there's enough pieces that I don't see how they're connected just in this PR that I'm not confident I have the ability to review without going over to the spec. At a high level the test added here seems like it probably doesn't require the lift/lower impls, but then again I suspect that removing those impls would remove all the meat of the PR. Would it be possible to add some tests exercising the impls added here in this PR? </p>
</blockquote>



<a name="495606410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606410">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927805246">PR review comment</a>:</p>
<blockquote>
<p>To confirm, this'll eventually be a <code>concurrent.rs</code> in a future PR? So just a placeholder for now?</p>
</blockquote>



<a name="495606411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606411">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927808686">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps be <code>impl&lt;T&gt; From&lt;FutureReader&lt;T&gt;&gt; for Val</code>?</p>
</blockquote>



<a name="495606412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606412">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1926139409">PR review comment</a>:</p>
<blockquote>
<p>If you'd prefer to simplify this I think it's reasonable to just fold this into the component-model feature above too</p>
</blockquote>



<a name="495606413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606413">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927813461">PR review comment</a>:</p>
<blockquote>
<p>For this and the below change I had to reread and re-figure-out what I was originally intending with this. I think it would be preferable to not add <code>pub(crate)</code> here as that expands the number of locations that need to be audited when working with this field.</p>
<p>I think it should be ok though to add accessors like <code>fn instance(&amp;self) -&gt; &amp;ComponentInstance</code> and <code>fn instance_mut(&amp;mut self) -&gt; &amp;mut ComponentInstance</code> to these types (lift/lower contexts). That would remove the need for <code>unsafe</code> at access sites and might clean up some preexisting access sites as well</p>
</blockquote>



<a name="495606414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606414">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927806298">PR review comment</a>:</p>
<blockquote>
<p>How temporary is the representation of these structures? E.g. is the <code>u32</code> what it'll be in the long run?</p>
</blockquote>



<a name="495606415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606415">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927806521">PR review comment</a>:</p>
<blockquote>
<p>The <code>::&lt;()&gt;</code> bit here and below gives me a bit of pause. Is that temporary or final-into-the-future?</p>
</blockquote>



<a name="495606416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606416">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927822770">PR review comment</a>:</p>
<blockquote>
<p>Personally I know I'm in a state of "I'm not a component-model async expert" so coming across bits of nontrivial code like this I'm left to go find where in the spec this behavior is implementing and trying to cross-reference that for example. Basically I find myself unable to reason about this locally and understand, just from what's here, what's going on.</p>
<p>Could you add some comments for any sort of nontrivial transformations like this? For example with resources I <a href="https://github.com/bytecodealliance/wasmtime/blob/8a969897f76e9725778f713a31024651f7e3e72b/crates/wasmtime/src/runtime/component/resources.rs#L646-L669">tried to leave comments</a> about all the various state transitions in lifts/lowers.</p>
<p>I suspect the majority of future readers of this code are also unlikely to be component-model async experts and comments can help quite a bit in understanding what's going on. The more I read in various places in this PR this is also applicable in general to any nontrivial bits here as opposed to just this one function. For example <code>get_mut_by_index_from</code> above is easy enough to understand as it's pretty mechanical internally but in isolation I'm not really sure what it's doing in a broader sense just from reading it. It may not be too helpful to understand at-a-glance what it's doing but at the same time having a comment I think would still be helpful.</p>
<p>(aka this is sort of a general request for more comments on anything nontrivial)</p>
</blockquote>



<a name="495606417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606417">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927829863">PR review comment</a>:</p>
<blockquote>
<p>Mind adding some comments as to what this <code>rep</code> is? My naive understanding of component model async is probably showing here but I'm familiar with "rep" of a resource where it's user-supplied but I didn't think that there was anything user-supplied here but rather this is an index to something (but I'm not sure)</p>
</blockquote>



<a name="495606418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606418">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927835966">PR review comment</a>:</p>
<blockquote>
<p>I'll definitely admit that I'm very lost when it comes to error-context here. I see a local refcount table and a global refcount table but I don't actually see the global refcount table being used. I'm also not really sure what <code>rep</code> is in the context of an error-context so I'm pretty lost here.</p>
<p>While comments would help here is this something that may be best deferred to a future PR? For example ideally there'd be a test exercising this lifting and lowering and testing various errors here and things like that, but I suspect such a test isn't quite ready yet?</p>
</blockquote>



<a name="495606419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606419">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927814845">PR review comment</a>:</p>
<blockquote>
<p>s/error/error-context/</p>
</blockquote>



<a name="495606420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606420">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927828760">PR review comment</a>:</p>
<blockquote>
<p>I'm not sure how much this will persist int he future but you can drop the <code>&lt;Data = U&gt;</code> here in the sense that it's not necessary as part of this definition. In the future if you need bounds on <code>U</code> it should be possible to do <code>S::Data: Bound</code> I think too</p>
</blockquote>



<a name="495606421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606421">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927836759">PR review comment</a>:</p>
<blockquote>
<p>This might be one part about error-context I don't understand b/c I think I'm missing where this is used...</p>
</blockquote>



<a name="495606422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495606422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495606422">(Jan 23 2025 at 23:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927855230">PR review comment</a>:</p>
<blockquote>
<p>Could you expand the documentation for this struct as to what problem it's solving? For example what extra functionality it has over <code>ResourceTable</code>. I'm a bit surprised for example of the <code>reps_to_indexes</code> reverse mapping where most of the component model stuff doesn't require hash maps today and that seems like it's bordering on needing something like that.</p>
<p>Also this is something I probably should have done for <code>ResourceTable</code> but if it's possible this'd be a good place to have some <code>#[test]</code> unit tests for this data structure doing some simple pushes/pops/etc.</p>
</blockquote>



<a name="495608476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495608476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495608476">(Jan 24 2025 at 00:16)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571383956">PR review</a>.</p>



<a name="495608479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495608479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495608479">(Jan 24 2025 at 00:16)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927913036">PR review comment</a>:</p>
<blockquote>
<p><code>concurrent.rs</code> is <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/component/concurrent.rs">already in main</a> and was added in <a href="https://github.com/bytecodealliance/wasmtime/pull/10044">https://github.com/bytecodealliance/wasmtime/pull/10044</a> (and will be expanded in subsequent PRs).  This is the stub module to be used when the <code>component-model-async</code> feature is disabled, so it will only go away when that feature is removed.</p>
<p>Alternatively, I could remove this stub module and make <code>concurrent.rs</code> the only implementation, but that would mean adding more <code>#[cfg(...)]</code> annotations elsewhere, so it's kind of a tradeoff.  Happy to do whichever you think is best, though.</p>
</blockquote>



<a name="495608810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495608810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495608810">(Jan 24 2025 at 00:18)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571388028">PR review</a>.</p>



<a name="495608812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495608812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495608812">(Jan 24 2025 at 00:18)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927915013">PR review comment</a>:</p>
<blockquote>
<p>They're like resource reps in that they'll be <code>u32</code>s for wasm32 but become <code>u64</code>s when we add wasm64 support for the component model.</p>
</blockquote>



<a name="495609730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495609730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495609730">(Jan 24 2025 at 00:29)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571398337">PR review</a>.</p>



<a name="495609731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495609731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495609731">(Jan 24 2025 at 00:29)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927921626">PR review comment</a>:</p>
<blockquote>
<p>It's "final" in that I wasn't planning to change it, but I agree it looks weird.  I had already written the static API <code>Lift</code>/<code>Lower</code> impls for these types, so I figured I'd reuse those implementations here since they're payload-type-agnostic.  I'll move the lifting and lowering code into separate, top-level functions which both the static API and dynamic API can use, which will avoid this.</p>
</blockquote>



<a name="495610221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495610221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495610221">(Jan 24 2025 at 00:34)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571404003">PR review</a>.</p>



<a name="495610222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495610222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495610222">(Jan 24 2025 at 00:34)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927925193">PR review comment</a>:</p>
<blockquote>
<p>Agreed and apologies for forgetting to add comments; I have "Add doc and code comments to new, non-trivial code (especially <a href="http://concurrent.rs">concurrent.rs</a> and <a href="http://futures_and_streams.rs">futures_and_streams.rs</a>)" in the task list on #9582, and that was my next priority before I switched my focus to breaking the PR up into smaller pieces.  I'll start doing both now.</p>
</blockquote>



<a name="495610244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495610244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495610244">(Jan 24 2025 at 00:34)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927925193">PR review comment</a>.</p>



<a name="495610881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495610881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495610881">(Jan 24 2025 at 00:41)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571410536">PR review</a>.</p>



<a name="495610882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495610882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495610882">(Jan 24 2025 at 00:41)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927929805">PR review comment</a>:</p>
<blockquote>
<p>Good catch.  This is just a stub, with the signature copied from <a href="https://github.com/dicej/wasmtime/blob/d1596df0361a4a8c956ba7ef34ac8d3c5e0140e1/crates/wasmtime/src/runtime/component/concurrent/futures_and_streams.rs#L578">https://github.com/dicej/wasmtime/blob/d1596df0361a4a8c956ba7ef34ac8d3c5e0140e1/crates/wasmtime/src/runtime/component/concurrent/futures_and_streams.rs#L578</a>, but it looks like the real version doesn't use <code>U</code> either, so I'm guessing I had originally been using <code>U</code>, then stopped using it, but forgot to update the signature.</p>
</blockquote>



<a name="495611714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495611714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495611714">(Jan 24 2025 at 00:51)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571419801">PR review</a>.</p>



<a name="495611715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495611715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495611715">(Jan 24 2025 at 00:51)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927935807">PR review comment</a>:</p>
<blockquote>
<p>I might have the terminology mixed up myself, but I've been using "rep" to mean "the instance-agnostic index for the waitable" which used to look up the state of the stream/future/task in a table (which will be added in a later PR), akin to the <code>ResourceTable</code> index for resources.  When lifting and lowering we convert between that index and a per-instance local index visible to the guest.</p>
<p>If there's a more conventional way to refer to these "global" and "local" indexes, I'm happy to adopt it.</p>
</blockquote>



<a name="495612179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495612179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495612179">(Jan 24 2025 at 00:56)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571424164">PR review</a>.</p>



<a name="495612180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495612180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495612180">(Jan 24 2025 at 00:56)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927938793">PR review comment</a>:</p>
<blockquote>
<p>Yeah, I can replace this stuff with stubs.  My approach with this PR was to run the lift.wast test, hit a <code>todo!()</code>, replace the <code>todo!()</code> with code copied from #9582, let the compiler tell me what _other_ code _that_ code needed, then either copying more code or adding stubs to make the compiler happy.  Looks like I copied over too much, and that's making the review more difficult; sorry about that.  I'll trim it down.</p>
</blockquote>



<a name="495612284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495612284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495612284">(Jan 24 2025 at 00:57)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2571425097">PR review</a>.</p>



<a name="495612285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495612285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495612285">(Jan 24 2025 at 00:57)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1927939462">PR review comment</a>:</p>
<blockquote>
<p>I don't think it _is_ being used yet; again, I may have copied over more than necessary from the Big PR.</p>
</blockquote>



<a name="495744018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495744018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495744018">(Jan 24 2025 at 15:50)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495744864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495744864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495744864">(Jan 24 2025 at 15:55)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#issuecomment-2612857030">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>:</p>
<blockquote>
<p>@alexcrichton I've "rebooted" this PR from scratch, this time only pulling in the minimum code needed for the <code>lift.wast</code> test.  It's much smaller now.</p>
<p>As a consequence, most of your review comments no longer apply, but I'll address them in future PRs.  Sorry for the churn; I'll try to keep future PRs more focused.</p>
</blockquote>



<a name="495745651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495745651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495745651">(Jan 24 2025 at 15:59)</a>:</h4>
<p><strong>dicej</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495750747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495750747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495750747">(Jan 24 2025 at 16:26)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2573091710">PR review</a>.</p>



<a name="495750749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495750749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495750749">(Jan 24 2025 at 16:26)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1928944777">PR review comment</a>:</p>
<blockquote>
<p>Ah I see, sorry I missed the <code>not(...)</code>!</p>
<p>I'll take a closer look in a future PR to see how it fits together <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="495751221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495751221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495751221">(Jan 24 2025 at 16:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2573097143">PR review</a>.</p>



<a name="495751223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495751223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495751223">(Jan 24 2025 at 16:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1928947982">PR review comment</a>:</p>
<blockquote>
<p>No worries of course! I myself basically never write comments as I write code itself and then I have to force myself to go back afterwards and comment things, which I often forget to do. I just wanted to highlight this as something I think will be important to do as pieces incrementally land as opposed to only once at the end</p>
</blockquote>



<a name="495751616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495751616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495751616">(Jan 24 2025 at 16:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2573101922">PR review</a>.</p>



<a name="495751617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495751617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495751617">(Jan 24 2025 at 16:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#discussion_r1928950851">PR review comment</a>:</p>
<blockquote>
<p>How about something like <code>rep: WaitableIndex</code>? Basically using a type here to indicate more clearly what it's pointing to. My history with resources makes me think that "rep" comes from guests themselves and needs to be preserved and handed back to the guest but I don't think that's what's going on here, so this isn't so much a "representation" internally but moreso an index somewhere else, which is where I think a custom newtype might help to distinguish</p>
</blockquote>



<a name="495751682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495751682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495751682">(Jan 24 2025 at 16:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10083#pullrequestreview-2573102834">PR review</a>:</p>
<blockquote>
<p>Looks good to me, thanks!</p>
</blockquote>



<a name="495753741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495753741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495753741">(Jan 24 2025 at 16:44)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495753856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495753856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495753856">(Jan 24 2025 at 16:44)</a>:</h4>
<p>dicej has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495753998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495753998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495753998">(Jan 24 2025 at 16:45)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<a name="495759588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310083%20add%20component-model-async/lift.wast%20.../near/495759588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310083.20add.20component-model-async.2Flift.2Ewast.20.2E.2E.2E.html#495759588">(Jan 24 2025 at 17:21)</a>:</h4>
<p>dicej merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10083">PR #10083</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>