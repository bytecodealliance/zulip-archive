<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11043 Add lowering rules for `{add,sub,or,... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html">wasmtime / PR #11043 Add lowering rules for `{add,sub,or,...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="524029535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524029535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524029535">(Jun 14 2025 at 00:18)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524029536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524029536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524029536">(Jun 14 2025 at 00:18)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a> from <code>fitzgen:x64-op-mem-imm</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="524029537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524029537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524029537">(Jun 14 2025 at 00:18)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524029538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524029538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524029538">(Jun 14 2025 at 00:18)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524029539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524029539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524029539">(Jun 14 2025 at 00:18)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524030945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524030945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524030945">(Jun 14 2025 at 00:44)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524032638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524032638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524032638">(Jun 14 2025 at 01:23)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524088005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524088005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524088005">(Jun 14 2025 at 21:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2928845018">PR review</a>:</p>
<blockquote>
<p>What do you think about blocking on the suggestion below to clean up <code>lower.isle</code>?</p>
<p>Also other instructions that might be interesting to add are <code>xor</code> (probably easy) and shifts (maybe harder? unsure)</p>
</blockquote>



<a name="524088006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524088006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524088006">(Jun 14 2025 at 21:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2147333213">PR review comment</a>:</p>
<blockquote>
<p>A possible alternative: what about:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">decl</span><span class="w"> </span><span class="n">x64_or_mem</span><span class="w"> </span><span class="p">(</span><span class="n">Amode</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span><span class="w"> </span><span class="n">SideEffectNoResult</span><span class="p">)</span>
</code></pre></div>
<p>The type could be inferred from the value, and that would also enable dispatching internally based on iconst-or-not to all the various rules. That way we additionally wouldn't need any new rules in <code>lower.isle</code> and would reduce the duplication there.</p>
</blockquote>



<a name="524290015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524290015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524290015">(Jun 16 2025 at 16:15)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524290109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524290109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524290109">(Jun 16 2025 at 16:15)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2932748163">PR review</a>.</p>



<a name="524290110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524290110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524290110">(Jun 16 2025 at 16:15)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150387525">PR review comment</a>:</p>
<blockquote>
<p>Done! Please take another look</p>
</blockquote>



<a name="524304299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524304299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524304299">(Jun 16 2025 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150512652">PR review comment</a>:</p>
<blockquote>
<p>This could replace <code>i64_from_iconst</code> with <code>i32_from_iconst</code> to avoid the <code>if-let</code> </p>
</blockquote>



<a name="524304301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524304301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524304301">(Jun 16 2025 at 17:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2932942534">PR review</a>.</p>



<a name="524304302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524304302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524304302">(Jun 16 2025 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150517002">PR review comment</a>:</p>
<blockquote>
<p>Personally I'm always wary to discard the lower bits with <code>as</code> in lowering rules lest they accidentally get removed. Given that <code>iconst</code> extraction is generally signed could the above rules do <code>(i16_from_iconst imm)</code> and then the immediate to the instruction is <code>(i16_as_u16 imm)</code> to be clear that there's no data loss it's just reinterpreting the sign bit?</p>
</blockquote>



<a name="524304303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524304303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524304303">(Jun 16 2025 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150513717">PR review comment</a>:</p>
<blockquote>
<p>Would it make sense to add <code>i8_from_iconst</code> to make these two cases one-liners too?</p>
</blockquote>



<a name="524310032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524310032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524310032">(Jun 16 2025 at 18:06)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2933039075">PR review</a>.</p>



<a name="524310034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524310034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524310034">(Jun 16 2025 at 18:06)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150567276">PR review comment</a>:</p>
<blockquote>
<p>We can't do that because <code>i32_from_const</code> will unconditionally truncate upper bits, but we need to only match this rule when the <code>iconst</code> bits will losslessly fit in an <code>i32</code>.</p>
</blockquote>



<a name="524310090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524310090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524310090">(Jun 16 2025 at 18:07)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2933040194">PR review</a>.</p>



<a name="524310092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524310092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524310092">(Jun 16 2025 at 18:07)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150568078">PR review comment</a>:</p>
<blockquote>
<p>Similarly, this also needs to be fallible</p>
</blockquote>



<a name="524310552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524310552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524310552">(Jun 16 2025 at 18:10)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150572994">PR review comment</a>:</p>
<blockquote>
<p>I don't think that's correct? The definition of <code>i32_from_iconst</code> uses <code>try_from</code>? (it very much should or we have a lot of incorrect lowering rules)</p>
</blockquote>



<a name="524310553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524310553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524310553">(Jun 16 2025 at 18:10)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2933049558">PR review</a>.</p>



<a name="524311280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524311280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524311280">(Jun 16 2025 at 18:15)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2933063139">PR review</a>.</p>



<a name="524311282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524311282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524311282">(Jun 16 2025 at 18:15)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150580281">PR review comment</a>:</p>
<blockquote>
<p>There is no <code>i16_from_iconst</code> and this is only used to implement <code>u16_from_iconst</code> and our existing <code>foo_from_iconst</code> extractors (such as <code>u32_from_iconst</code>) already use lossy <code>as</code> conversions and bring the assumption that the caller is choosing a value based on the correct width for their type context.</p>
<p>I don't think that is really the correct choice, but I also don't want to do something different and make it so we have multiple idioms here. We already have enough trouble from some things being extractors and some being pure partial constructors and not being able to reuse one kind of thing for the other. All of our <code>iconst</code> and numerics stuff could definitely be overhauled but, again, I don't really want to do it in this PR. I'd rather just follow the existing code conventions.</p>
</blockquote>



<a name="524314340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524314340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524314340">(Jun 16 2025 at 18:38)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2933133883">PR review</a>.</p>



<a name="524314341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524314341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524314341">(Jun 16 2025 at 18:38)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150623570">PR review comment</a>:</p>
<blockquote>
<p><code>i32_from_iconst</code> seems to do the checks but then we have these other cases that do not:</p>
<p><div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">u32_from_iconst</span><span class="w"> </span><span class="p">(</span><span class="nv">u32</span><span class="p">)</span><span class="w"> </span><span class="nv">Value</span><span class="p">)</span>
<span class="p">(</span><span class="nv">extractor</span><span class="w"> </span><span class="p">(</span><span class="nv">u32_from_iconst</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">           </span><span class="p">(</span><span class="nv">u64_from_iconst</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_as_u32</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span>

<span class="c1">;; ...</span>

<span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">i8_from_iconst</span><span class="w"> </span><span class="p">(</span><span class="nv">i8</span><span class="p">)</span><span class="w"> </span><span class="nv">Value</span><span class="p">)</span>
<span class="p">(</span><span class="nv">extractor</span><span class="w"> </span><span class="p">(</span><span class="nv">i8_from_iconst</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">           </span><span class="p">(</span><span class="nv">i32_from_iconst</span><span class="w"> </span><span class="p">(</span><span class="nv">i32_as_i8</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="524314439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524314439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524314439">(Jun 16 2025 at 18:38)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#pullrequestreview-2933135771">PR review</a>.</p>



<a name="524314440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524314440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524314440">(Jun 16 2025 at 18:38)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#discussion_r2150624723">PR review comment</a>:</p>
<blockquote>
<p>So I guess this particular one can change, but I don't think we can blanket apply this reasoning to the other cases</p>
</blockquote>



<a name="524318944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524318944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524318944">(Jun 16 2025 at 19:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#issuecomment-2977785449">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>:</p>
<blockquote>
<p>Extracting a comment out here since it's not particularly relevant in isolation: I suppose this is fine to land and while on one hand it's not making things worse on the other hand it's also making things worse because it's adding more places to update with a future refactoring. I'll start working on such a refactoring as this is something that's bothered me for quite some time. If you'd like to land this in the meantime I think that's ok too.</p>
</blockquote>



<a name="524319428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524319428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524319428">(Jun 16 2025 at 19:16)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#issuecomment-2977799704">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>:</p>
<blockquote>
<p>I was thinking it would be nice to automatically generate the full combinatorial set of fallible, infallible, checked, and truncating ISLE conversions for numeric types in the meta crate</p>
</blockquote>



<a name="524319471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524319471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524319471">(Jun 16 2025 at 19:17)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11043#issuecomment-2977800653">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>:</p>
<blockquote>
<p>But yeah, I'll land this now and then we can do the much needed clean up in follow ups.</p>
</blockquote>



<a name="524321763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524321763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524321763">(Jun 16 2025 at 19:36)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524321785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524321785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524321785">(Jun 16 2025 at 19:36)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<a name="524326374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311043%20Add%20lowering%20rules%20for%20%60%7Badd%2Csub%2Cor%2C.../near/524326374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311043.20Add.20lowering.20rules.20for.20.60.7Badd.2Csub.2Cor.2C.2E.2E.2E.html#524326374">(Jun 16 2025 at 20:11)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11043">PR #11043</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>