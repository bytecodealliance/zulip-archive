<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10503 Reuse Wasm linear memories code for ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html">wasmtime / PR #10503 Reuse Wasm linear memories code for ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="509520877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509520877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509520877">(Apr 01 2025 at 18:28)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="509520879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509520879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509520879">(Apr 01 2025 at 18:28)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a> from <code>fitzgen:gc-heap-config-knobs</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Instead of bespoke code paths and structures for Wasm GC, this commit makes it so that we now reuse VM structures like <code>VMMemoryDefinition</code> and bounds-checking logic. Notably, we also reuse all the associated bounds-checking optimizations and, when possible, virtual-memory techniques to completely elide them.</p>
<p>Furthermore, this commit adds support for growing GC heaps, reusing the machinery for growing memories, and makes it so that GC heaps always start out empty. This allows us to properly delay allocating the GC heap's storage until a GC object is actually allocated.</p>
<p>Fixes #9350</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="509520881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509520881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509520881">(Apr 01 2025 at 18:28)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="509520883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509520883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509520883">(Apr 01 2025 at 18:28)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="509520884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509520884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509520884">(Apr 01 2025 at 18:28)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="509521316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509521316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509521316">(Apr 01 2025 at 18:30)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="509534637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534637">(Apr 01 2025 at 19:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#issuecomment-2770515992">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:area:x64", "wasmtime:api", "wasmtime:ref-types"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: wasmtime:ref-types</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="509534667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534667">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2733837601">PR review</a>:</p>
<blockquote>
<p>I've gotten through a chunk of this, but if possible I do really think it would be nice to split this apart. I realize it's extra work over what's already here to split this apart but it's pretty hard to review this all-at-once even though I was helping out for at least a chunk of it. If it's too hard it doesn't have to be split but I tend to get nervous when big changes to core runtime bits happen all in one large PR</p>
</blockquote>



<a name="509534668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534668">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023555548">PR review comment</a>:</p>
<blockquote>
<p>Note to myself: somehow I think we need to address this before merging. At minimum this should probably have a FIXME (or somewhere else), but changing all embeddings to reserve two slots for memory when basically no embedding using GC right now feels pretty bad as well.</p>
</blockquote>



<a name="509534669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534669">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023554296">PR review comment</a>:</p>
<blockquote>
<p>I see these both. here and in <code>wasmtime-wast</code>, could they perhaps move to helper methods directly on <code>StoreContextMut</code> or similar?</p>
</blockquote>



<a name="509534670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534670">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023569199">PR review comment</a>:</p>
<blockquote>
<p>TODO (and just below)</p>
</blockquote>



<a name="509534671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534671">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023567571">PR review comment</a>:</p>
<blockquote>
<p>Mind leaving this as <code>NonNull</code> to avoid the cognitive overhead of using <code>SendSyncPtr</code>?</p>
</blockquote>



<a name="509534672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534672">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023571398">PR review comment</a>:</p>
<blockquote>
<p>TODO</p>
</blockquote>



<a name="509534673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534673">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023550776">PR review comment</a>:</p>
<blockquote>
<p>The <code>ErrorExt</code> trait I added in a PR yesterday means I think we can avoid this refactoring and/or you can use <code>assert_contains</code> instead of manually doing <code>e:?</code></p>
</blockquote>



<a name="509534674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534674">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023572712">PR review comment</a>:</p>
<blockquote>
<p>I think this line of the error message can be omitted as <code>assert!</code> should print out the expression that failed</p>
</blockquote>



<a name="509534675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534675">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023560147">PR review comment</a>:</p>
<blockquote>
<p>Similar to tests, this pattern is 3 times in this file, would it be possible to refactor that to share code amongst the users?</p>
</blockquote>



<a name="509534677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534677">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023573558">PR review comment</a>:</p>
<blockquote>
<p>Ditto from libcalls, this is being duplicated enough that it should be centralized somehow to a smaller handful of functions than are in use today</p>
</blockquote>



<a name="509534678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534678">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023573773">PR review comment</a>:</p>
<blockquote>
<p>TODO</p>
</blockquote>



<a name="509534679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534679">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023579245">PR review comment</a>:</p>
<blockquote>
<p>TODO</p>
</blockquote>



<a name="509534681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534681">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023577401">PR review comment</a>:</p>
<blockquote>
<p>Should this be inverted? First GC then maybe grow if necessary?</p>
</blockquote>



<a name="509534682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/509534682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#509534682">(Apr 01 2025 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2023574258">PR review comment</a>:</p>
<blockquote>
<p>And these should return an error if <code>bytes_needed</code> space wasn't actually free'd?</p>
</blockquote>



<a name="510773826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/510773826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#510773826">(Apr 07 2025 at 21:54)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="510775625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/510775625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#510775625">(Apr 07 2025 at 22:08)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="510775946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/510775946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#510775946">(Apr 07 2025 at 22:11)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#issuecomment-2784746314">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>:</p>
<blockquote>
<p>Okay, after splitting out all of those PRs, I have this down to</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="mi">51</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">changed</span><span class="p">,</span><span class="w"> </span><span class="mi">1650</span><span class="w"> </span><span class="n">insertions</span><span class="p">(</span><span class="o">+</span><span class="p">),</span><span class="w"> </span><span class="mi">698</span><span class="w"> </span><span class="n">deletions</span><span class="p">(</span><span class="o">-</span><span class="p">)</span>
</code></pre></div>
<p>when ignoring the <code>disas</code> test expectation updates, which isn't too bad.</p>
<p>Still need to fix the C API and address some of the review comments. Will leave a comment once I've done that and this is ready for re-review.</p>
</blockquote>



<a name="511021405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511021405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511021405">(Apr 08 2025 at 20:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2751327896">PR review</a>.</p>



<a name="511021409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511021409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511021409">(Apr 08 2025 at 20:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2033983294">PR review comment</a>:</p>
<blockquote>
<p>This is a little bit of an annoying combinatorial problem:</p>
<ul>
<li>we want <code>async</code> and regular versions</li>
<li>we want an <code>externref</code> version that plumbs through the external value to the retry, and a non-<code>externref</code> version that doesn't have that value</li>
<li>we want this method on all of <code>Store</code>, <code>StoreContextMut</code>, and <code>Caller</code></li>
</ul>
<p>And even after all that, the API is still not very good, because as a caller you don't actually want to think about this stuff, you just want to do <code>ExternRef::new(...)</code> and have everything else just work.</p>
<p>We originally didn't automatically trigger GC because that means we would need both <code>new</code> and <code>new_async</code> methods on <code>{Any,Extern,...}Ref</code>, as well as <code>new_manually_rooted</code> and <code>new_manually_rooted_async</code>. But I'm starting to think that is actually better than trying to expose generic <code>retry_after_gc</code> methods. And I also don't think we actually need <code>new_manually_rooted</code> variants at all: users can easily do <code>ExternRef::new(..).to_manually_rooted(..)</code> if they want to. Then we only need <code>FooRef::new</code> and <code>FooRef::new_async</code>, which really isn't too bad from a maintenance perspective, and is way better from a user API perspective.</p>
<p>So: what do you think of doing that larger clean up after this lands?</p>
</blockquote>



<a name="511023701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511023701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511023701">(Apr 08 2025 at 20:52)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2751370017">PR review</a>.</p>



<a name="511023704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511023704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511023704">(Apr 08 2025 at 20:52)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2034012040">PR review comment</a>:</p>
<blockquote>
<p>Ah, this isn't necessary anymore. Removed.</p>
</blockquote>



<a name="511031543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511031543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511031543">(Apr 08 2025 at 21:49)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2751490078">PR review</a>.</p>



<a name="511031545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511031545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511031545">(Apr 08 2025 at 21:49)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2034084345">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately, if you specify any custom message, then it doesn't show the original expression anymore: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fb30232a93261b5bfa0bd219eac3ea7c">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2024&amp;gist=fb30232a93261b5bfa0bd219eac3ea7c</a></p>
</blockquote>



<a name="511033331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511033331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511033331">(Apr 08 2025 at 22:02)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2751508287">PR review</a>.</p>



<a name="511033332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511033332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511033332">(Apr 08 2025 at 22:02)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2034096452">PR review comment</a>:</p>
<blockquote>
<p>We want to grow first because</p>
<ol>
<li>it is usually cheaper (just updating the accessible region of a mapping; even copying bytes to a new region is also cheaper) and</li>
<li>
<p>if we swapped the order, then we could hit the following pathological case:</p>
<p>```rust<br>
 // Assume: the GC heap has capacity for N objects, and we have N-1<br>
 // objects allocated and held alive.</p>
<p>// Allocate an object, now the GC heap is at capacity. We do not keep the<br>
 // object live, however.<br>
 drop(allocate());</p>
<p>loop {<br>
     // Upon entry of this loop, the GC heap is at capacity.</p>
<div class="codehilite"><pre><span></span><code> // Allocate another object. This triggers a collect-or-else-grow, the
 // collection reclaims the previously allocated object, and then this
 // allocation succeeds without needing to grow the heap.
 drop(allocate());

 // At the end of this loop, the GC heap is still at capacity.
</code></pre></div>

<p>}<br>
 ```</p>
<p>This scenario means we will trigger a GC <em>on every allocation inside the loop</em> which is super pathological. We should really only enter into this kind of behavior when there really is no more memory we can give the GC heap (and even then, the embedder probably wants to cancel the execution via async epochs/fuel at some point; may eventually make sense to add a GC limiter style API).</p>
</li>
</ol>
</blockquote>



<a name="511033707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511033707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511033707">(Apr 08 2025 at 22:05)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511033761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511033761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511033761">(Apr 08 2025 at 22:05)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2751512952">PR review</a>.</p>



<a name="511033762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511033762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511033762">(Apr 08 2025 at 22:05)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2034099663">PR review comment</a>:</p>
<blockquote>
<p>See my other comment about folding the retry-after-gc into the <code>FooRef</code> constructors.</p>
</blockquote>



<a name="511033981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511033981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511033981">(Apr 08 2025 at 22:07)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#issuecomment-2787765303">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>:</p>
<blockquote>
<p>Okay I've fixed the C API's compilation and updated most things pointed out in review, modulo making a single shared retry-after-gc helper that we expose from the <code>wasmtime</code> crate. See my comments about that here: <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2033983294">https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2033983294</a></p>
<p>I think this is ready for another round of review @alexcrichton.</p>
</blockquote>



<a name="511038626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511038626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511038626">(Apr 08 2025 at 22:46)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511038628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511038628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511038628">(Apr 08 2025 at 22:46)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511038629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511038629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511038629">(Apr 08 2025 at 22:46)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511039266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511039266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511039266">(Apr 08 2025 at 22:52)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511040488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511040488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511040488">(Apr 08 2025 at 23:03)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511041718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511041718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511041718">(Apr 08 2025 at 23:16)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511049863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511049863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511049863">(Apr 09 2025 at 00:39)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511059740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511059740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511059740">(Apr 09 2025 at 02:15)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#issuecomment-2788114701">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing", "wasmtime:c-api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="511198080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511198080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511198080">(Apr 09 2025 at 15:02)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2753821659">PR review</a>.</p>



<a name="511198082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511198082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511198082">(Apr 09 2025 at 15:02)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035575461">PR review comment</a>:</p>
<blockquote>
<p>That makes sense, but isn't this current behavior pathological too? GC heaps will, by default, balloon to 4G before a GC ever runs? </p>
<p>This makes me think that there's not an ideal answer one way or the other, but picking either extreme seems bad?</p>
</blockquote>



<a name="511198447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511198447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511198447">(Apr 09 2025 at 15:04)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2753827143">PR review</a>.</p>



<a name="511198451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511198451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511198451">(Apr 09 2025 at 15:04)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035578810">PR review comment</a>:</p>
<blockquote>
<p>Agreed with your conclusions as well. And yeah ok let's defer this for dual <code>new</code> and <code>new_async</code> constructors.</p>
</blockquote>



<a name="511211274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211274">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2753829812">PR review</a>.</p>



<a name="511211279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211279">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035590653">PR review comment</a>:</p>
<blockquote>
<p>This carries an unsafe requirement that the memory being replaced has to be basically the same as <code>take_memory</code>, right? In that it must be at least the same size?</p>
</blockquote>



<a name="511211280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211280">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035601732">PR review comment</a>:</p>
<blockquote>
<p>re my comment below: this was my worry, the method here duplicates <code>maybe_async_grow_or_collect_gc_heap</code> and I find it confusing to trace what method is used where. I'd prefer ideally if there were a single "do gc" method that everything funnels through rather than having a forest of methods with no narrow waist</p>
</blockquote>



<a name="511211281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211281">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035608556">PR review comment</a>:</p>
<blockquote>
<p>Can you add some comments here for why the <code>unreachable!()</code> isn't reachable? It wasn't immediately obvious to me until I saw that the <code>new</code> constructor is gated, so presumably it's not possible to call this method when <code>gc</code> is disabled, but I think a comment here might be good to have</p>
</blockquote>



<a name="511211282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211282">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035580459">PR review comment</a>:</p>
<blockquote>
<p>Outdated change now?  (although I understand why this was done I think <a href="https://github.com/bytecodealliance/wasmtime/pull/10538">https://github.com/bytecodealliance/wasmtime/pull/10538</a> is the "true" fix? or something like that?)</p>
</blockquote>



<a name="511211285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211285">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035618462">PR review comment</a>:</p>
<blockquote>
<p>Why not define this as <code>size_of::&lt;VMGcKind&gt;()</code> to avoid the const assertion?</p>
</blockquote>



<a name="511211286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211286">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035597698">PR review comment</a>:</p>
<blockquote>
<p>Would it be possible to avoid the split between either GC or grow? My hope would be that there's a single location which makes a determination of what to do. I might just not be familiar with the code and the method below is The Location, but I feel like the logic of exactly whether to grow or GC is spread out across multiple files at this time.</p>
<p>I understand we probably want a method-per-op at some point but  I would hope that would be buried in some guaranteed-module-private location rather than so prominently exposed to the entire codebase through the <code>VMStore</code> trait.</p>
</blockquote>



<a name="511211287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211287">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035604687">PR review comment</a>:</p>
<blockquote>
<p>To double-check, you've confirmed that all locations that evaluate const exprs are on fibers?</p>
</blockquote>



<a name="511211288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211288">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035674243">PR review comment</a>:</p>
<blockquote>
<p>Bikeshedding a bit here, how about <code>StaticOffset</code>, <code>StaticObjectField</code>, and <code>DynamicObjectField</code>? I know you're in a GC-centric mindset right now but making normal linear memory accesses named <code>BoundsCheck::Field</code> feels a bit weird to me</p>
</blockquote>



<a name="511211289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211289">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035676520">PR review comment</a>:</p>
<blockquote>
<p>AFAIK this is the first time this code has had to deal with <code>access_size == 0</code>, could you do an audit on the below function to ensure that everything works reasonably if the access size is zero?</p>
</blockquote>



<a name="511211290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211290">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035674877">PR review comment</a>:</p>
<blockquote>
<p>Mind renaming <code>s/gc_heap_bound/bound/</code>? (to emphasize this isn't just GC accesses)</p>
</blockquote>



<a name="511211291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511211291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511211291">(Apr 09 2025 at 16:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035587267">PR review comment</a>:</p>
<blockquote>
<p>(un-resolving this since this is still <code>SendSyncPtr</code>?)</p>
</blockquote>



<a name="511213831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511213831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511213831">(Apr 09 2025 at 16:10)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2754025482">PR review</a>.</p>



<a name="511213833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511213833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511213833">(Apr 09 2025 at 16:10)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2035698510">PR review comment</a>:</p>
<blockquote>
<p>Oh huh, I guess I lost this in a rebase or something, because I definitely undid this change at one point</p>
</blockquote>



<a name="511215776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511215776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511215776">(Apr 09 2025 at 16:19)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511216044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511216044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511216044">(Apr 09 2025 at 16:20)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#issuecomment-2790268700">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>:</p>
<blockquote>
<p>I'm going to implement the <code>new</code> and <code>new_async</code> stuff first, before this PR lands, because I am finding a long tail of ref-type allocations in things like doc tests, and fixing all of them is annoying. Would rather just fix the callee than every caller.</p>
</blockquote>



<a name="511259819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511259819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511259819">(Apr 09 2025 at 20:48)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#issuecomment-2790965484">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>:</p>
<blockquote>
<blockquote>
<p>I'm going to implement the <code>new</code> and <code>new_async</code> stuff first, before this PR lands, because I am finding a long tail of ref-type allocations in things like doc tests, and fixing all of them is annoying. Would rather just fix the callee than every caller.</p>
</blockquote>
<p>This is <a href="https://github.com/bytecodealliance/wasmtime/pull/10560">https://github.com/bytecodealliance/wasmtime/pull/10560</a></p>
</blockquote>



<a name="511499291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511499291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511499291">(Apr 10 2025 at 20:07)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2758236247">PR review</a>.</p>



<a name="511499292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511499292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511499292">(Apr 10 2025 at 20:07)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2038233765">PR review comment</a>:</p>
<blockquote>
<p>Yep <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="511713664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511713664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511713664">(Apr 11 2025 at 18:43)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2761266410">PR review</a>.</p>



<a name="511713665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511713665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511713665">(Apr 11 2025 at 18:43)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2040110802">PR review comment</a>:</p>
<blockquote>
<p>The idea is to do it this way to make sure that it doesn't actually vary depending on the target</p>
</blockquote>



<a name="511715124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511715124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511715124">(Apr 11 2025 at 18:52)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2761295719">PR review</a>.</p>



<a name="511715125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511715125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511715125">(Apr 11 2025 at 18:52)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2040126077">PR review comment</a>:</p>
<blockquote>
<p>looks good to me</p>
</blockquote>



<a name="511718948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511718948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511718948">(Apr 11 2025 at 19:16)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511721583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511721583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511721583">(Apr 11 2025 at 19:34)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511722524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511722524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511722524">(Apr 11 2025 at 19:40)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2761435845">PR review</a>.</p>



<a name="511722528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511722528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511722528">(Apr 11 2025 at 19:40)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#discussion_r2040214405">PR review comment</a>:</p>
<blockquote>
<p>I think growing to the limit before doing GC is actually what you want: you don't <em>want</em> to do GC if you can avoid it. Growing the heap is faster than doing a GC. There are knobs for limiting the max size of memories, including the GC heap, so unbounded growth isn't really a concern (also there is a hard bound of 4 GiB since the GC heap is a 32-bit memory). And we are likely going to throw away the whole store, and the GC heap along with it, before we ever need to collect, and doing that is also much faster than doing a collection.</p>
</blockquote>



<a name="511722627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511722627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511722627">(Apr 11 2025 at 19:41)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511722993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511722993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511722993">(Apr 11 2025 at 19:44)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511724970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511724970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511724970">(Apr 11 2025 at 19:58)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10503#pullrequestreview-2761464851">PR review</a>.</p>



<a name="511733428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511733428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511733428">(Apr 11 2025 at 21:02)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511733473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511733473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511733473">(Apr 11 2025 at 21:03)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<a name="511739342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310503%20Reuse%20Wasm%20linear%20memories%20code%20for%20.../near/511739342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310503.20Reuse.20Wasm.20linear.20memories.20code.20for.20.2E.2E.2E.html#511739342">(Apr 11 2025 at 21:39)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10503">PR #10503</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>