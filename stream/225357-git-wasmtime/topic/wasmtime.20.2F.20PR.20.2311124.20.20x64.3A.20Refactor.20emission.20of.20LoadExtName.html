<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11124  x64: Refactor emission of LoadExtName · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html">wasmtime / PR #11124  x64: Refactor emission of LoadExtName</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="525560006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525560006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525560006">(Jun 24 2025 at 16:56)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a> from <code>alexcrichton:x64-cleanup-load-ext-name</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Don't use raw bytes when emitting this instruction but instead use<br>
symbolic assembler directives to avoid needing to hardcode bytes. This<br>
additionally fixes an issue where with <code>colocated</code> symbols the offset of<br>
the symbol was not taken into account (but for Wasmtime it's always been<br>
0 so this otherwise hasn't come up so far)</p>
</blockquote>



<a name="525560007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525560007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525560007">(Jun 24 2025 at 16:56)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525560008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525560008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525560008">(Jun 24 2025 at 16:56)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525560595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525560595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525560595">(Jun 24 2025 at 17:00)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#pullrequestreview-2954644022">PR review</a>:</p>
<blockquote>
<p>Looks reasonable; thanks! Good catch handling the offsets.</p>
</blockquote>



<a name="525560700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525560700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525560700">(Jun 24 2025 at 17:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#issuecomment-3001222291">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>:</p>
<blockquote>
<p>(The <code>Reg</code> -&gt; <code>Gpr</code> refactoring tripped up in the <code>cranelift-codegen</code> tests, it seems)</p>
</blockquote>



<a name="525562085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525562085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525562085">(Jun 24 2025 at 17:09)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525562139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525562139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525562139">(Jun 24 2025 at 17:09)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525564836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525564836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525564836">(Jun 24 2025 at 17:29)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525592403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525592403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525592403">(Jun 24 2025 at 20:44)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525592481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525592481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525592481">(Jun 24 2025 at 20:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#issuecomment-3001810957">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>:</p>
<blockquote>
<p>Ok to resolve the test failure I had to push up a semi-substantial change as the final commit here. cc @abrown on the assembler change, and mind taking another look @cfallin?</p>
</blockquote>



<a name="525593989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525593989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525593989">(Jun 24 2025 at 20:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#pullrequestreview-2955288630">PR review</a>:</p>
<blockquote>
<p>New approach looks reasonable, but deferring to @abrown for final opinions on the <code>CodeSink</code> refactor...</p>
</blockquote>



<a name="525593990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525593990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525593990">(Jun 24 2025 at 20:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#discussion_r2164883403">PR review comment</a>:</p>
<blockquote>
<p>Maybe a panic here with a panic message including <code>offset</code>? Technically it's unreachable but the unreachability invariant is "remote" (part of another crate) so I'd rather make this easier debug / more verbose if we do miss something later...</p>
</blockquote>



<a name="525593991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525593991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525593991">(Jun 24 2025 at 20:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#discussion_r2164876852">PR review comment</a>:</p>
<blockquote>
<p>grammar fix -- "inform ... of a use ... is about to happen" -&gt; "inform ... that a use ... is about to happen"</p>
</blockquote>



<a name="525593993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525593993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525593993">(Jun 24 2025 at 20:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#discussion_r2164877938">PR review comment</a>:</p>
<blockquote>
<p>s/the bytes are then placed/the bytes are then expected to be placed/</p>
<p>(it's part of the contract for what the caller must do, rather than a result of this method call, right?)</p>
</blockquote>



<a name="525595253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525595253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525595253">(Jun 24 2025 at 21:05)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#issuecomment-3001857933">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>:</p>
<blockquote>
<p>(Was this auto-added to merge queue? I gave r+ but Andrew should still weigh in and there were a few comment nits)</p>
</blockquote>



<a name="525596568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525596568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525596568">(Jun 24 2025 at 21:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#issuecomment-3001883350">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>:</p>
<blockquote>
<p>Oops I forgot to disable that and pushes from maintainers doesn't auto-disable it, thanks for catching!</p>
</blockquote>



<a name="525608256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525608256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525608256">(Jun 24 2025 at 23:02)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525765409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525765409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525765409">(Jun 25 2025 at 18:06)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#discussion_r2167306983">PR review comment</a>:</p>
<blockquote>
<p>Yup, this is better! Thanks for this refactor; I had been worrying a bit about how to get rid of the offset table.</p>
</blockquote>



<a name="525765411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525765411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525765411">(Jun 25 2025 at 18:06)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#pullrequestreview-2959155196">PR review</a>.</p>



<a name="525765413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525765413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525765413">(Jun 25 2025 at 18:06)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#discussion_r2167313875">PR review comment</a>:</p>
<blockquote>
<p>I guess the decision here is to keep <code>asm::KnownOffset</code> as an index instead of converting it into an <code>enum</code>... I suppose there might be some generic way to pass around a <code>cranelift-codegen</code>-specific <code>KnownOffset</code> type to be a bit safer. But, honestly, that could come much later. This is better already.</p>
</blockquote>



<a name="525768162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525768162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525768162">(Jun 25 2025 at 18:27)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11124">PR #11124</a>.</p>



<a name="525770076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525770076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525770076">(Jun 25 2025 at 18:41)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#pullrequestreview-2959263014">PR review</a>.</p>



<a name="525770078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311124%20%20x64%3A%20Refactor%20emission%20of%20LoadExtName/near/525770078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311124.20.20x64.3A.20Refactor.20emission.20of.20LoadExtName.html#525770078">(Jun 25 2025 at 18:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11124#discussion_r2167376493">PR review comment</a>:</p>
<blockquote>
<p>Yeah I was brainstorming how to get a type in there (also for things like <code>ExternalName</code> or relocations) and my conclusion was that we'd have to change <code>enum Amode&lt;R: AsReg&gt;</code> to <code>enum Amode&lt;R: Registers&gt;</code> and then also have:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Registers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">CodeSink</span><span class="p">:</span><span class="w"> </span><span class="nc">CodeSink</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>and then store <code>&lt;R::CodeSink as CodeSink&gt;::KnownOffset</code> within an <code>Amode</code>.</p>
<p>That all gets pretty hairy and relatively complicated so I decided to not go down that route quite yet...</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>