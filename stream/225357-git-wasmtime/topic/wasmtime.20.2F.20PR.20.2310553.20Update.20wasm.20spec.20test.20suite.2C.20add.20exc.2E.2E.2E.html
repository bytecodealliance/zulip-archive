<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10553 Update wasm spec test suite, add exc... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html">wasmtime / PR #10553 Update wasm spec test suite, add exc...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="511028274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028274">(Apr 08 2025 at 21:24)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a> from <code>alexcrichton:update-spec-test-suite</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit performs an update of the spec test suite submodule to the next-to-latest commit. The latest commit will require updating the <code>wast</code> dependency which isn't published yet.</p>
<p>This update brings in the <code>wasm-3.0</code> folder of tests since it's been awhile since the last update. That update notably means that the exception-handling proposal is mixed in with all the others with various tests. Getting tests as flagged as passing or failing as a result was unexpectedly difficult.</p>
<p>The solution I ended up settling on was to preemptively implement some infrastructure for the exceptions proposal:</p>
<ul>
<li><code>wasmtime::Config</code> methods</li>
<li><code>wasmtime</code> CLI flags</li>
<li>integration with wast testing</li>
<li>various updates to <code>should_fail</code></li>
</ul>
<p>It turns out we can run a few tests with the exception proposal, notably due to tags being implemented for stack switching. That meant that this couldn't blanket ignore the exceptions proposal and say it's expected to fail. Instead the proposal is said "this passes!" and tests are individually listed as "this is expected to fail".</p>
<p>This then required changing an <code>unsupported!</code> panic to plumbing errors around to avoid actually implementing the exceptions proposal here.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="511028275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028275">(Apr 08 2025 at 21:24)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<a name="511028276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028276">(Apr 08 2025 at 21:24)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<a name="511028277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028277">(Apr 08 2025 at 21:24)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<a name="511028278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028278">(Apr 08 2025 at 21:24)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<a name="511028311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028311">(Apr 08 2025 at 21:24)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#issuecomment-2787696385">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>:</p>
<blockquote>
<p>cc @cfallin here on how this touches on the exceptions proposal</p>
</blockquote>



<a name="511028756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028756">(Apr 08 2025 at 21:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#pullrequestreview-2751439677">PR review</a>.</p>



<a name="511028757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028757">(Apr 08 2025 at 21:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#discussion_r2034056759">PR review comment</a>:</p>
<blockquote>
<p>FWIW this was the panic which needed to become a fallible result. Changing this required propagating quite a few layers up the stack since this is a very core conversion method</p>
</blockquote>



<a name="511028758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511028758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511028758">(Apr 08 2025 at 21:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#discussion_r2034058844">PR review comment</a>:</p>
<blockquote>
<p>I'll note that I don't mean to commit us to supporting this one day through adding this. This is required to have the current wast-testing to more easily plumb this around, but we can fix that if necessary. Additionally I was thinking that with an implementation of the exceptions proposal it's probably not actually hard at all to add support for this (forever off-by-default of course).</p>
<p>My hope though is that this stays as-is and goes no further, and if/when the legacy tests are ever purged from the spec test suite we can remove this.</p>
</blockquote>



<a name="511030374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511030374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511030374">(Apr 08 2025 at 21:40)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#pullrequestreview-2751463265">PR review</a>:</p>
<blockquote>
<p>Yeah we shouldn't ever implement the legacy exceptions on principle, but this knob makes sense for the <code>.wast</code> test suite.</p>
</blockquote>



<a name="511030376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511030376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511030376">(Apr 08 2025 at 21:40)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#discussion_r2034071847">PR review comment</a>:</p>
<blockquote>
<p>Can we also mark it deprecated something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[deprecated = </span><span class="s">"This configuration option only exists for internal \</span>
<span class="s">                usage with the spec testsuite. It may be removed at \</span>
<span class="s">                any time and without warning. Do not rely on it!"</span><span class="cp">]</span>
</code></pre></div>
<p>and then in our couple of usages just do <code>#[allow(deprecated)]</code> on the use</p>
</blockquote>



<a name="511030377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511030377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511030377">(Apr 08 2025 at 21:40)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#discussion_r2034066820">PR review comment</a>:</p>
<blockquote>
<p>This should be <code>doc(hidden)</code> and <code>clap(hidden)</code> or whatever as well, same as the <code>Config::method</code>.</p>
</blockquote>



<a name="511031448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511031448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511031448">(Apr 08 2025 at 21:48)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<a name="511031504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511031504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511031504">(Apr 08 2025 at 21:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#pullrequestreview-2751489653">PR review</a>.</p>



<a name="511031506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511031506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511031506">(Apr 08 2025 at 21:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10553#discussion_r2034084037">PR review comment</a>:</p>
<blockquote>
<p>We unfortunately don't have that here, but I can put "DEPRECATED" in the doc at least!</p>
</blockquote>



<a name="511031515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511031515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511031515">(Apr 08 2025 at 21:49)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<a name="511035910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310553%20Update%20wasm%20spec%20test%20suite%2C%20add%20exc.../near/511035910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310553.20Update.20wasm.20spec.20test.20suite.2C.20add.20exc.2E.2E.2E.html#511035910">(Apr 08 2025 at 22:21)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10553">PR #10553</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>