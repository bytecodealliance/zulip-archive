<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11392 Fix Out-of-memory in table-ops · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html">wasmtime / PR #11392 Fix Out-of-memory in table-ops</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="533221233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533221233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533221233">(Aug 07 2025 at 05:47)</a>:</h4>
<p>khagankhan opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a> from <code>khagankhan:OOM-bugs</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<ul>
<li>Decoupled <code>TableOps</code> and <code>TableOpsLimits,</code> which are now passed explicitly to <code>TableOp::fixup</code></li>
<li>Updated the macro to align with the new struct separation</li>
<li><code>TableOps::fixup</code> now processes the entire sequence of operations instead of starting from specific index</li>
</ul>
<p>I placed clamping logic at the beginning of the <code>to_wasm_binary</code> method since the OOM issues originate in t<code>o_wasm_binary</code> This relies on <code>TableOp::fixup</code> to ensure that values respect those clamped limits to avoid potential traps.</p>
<p>I previously added clamping at the start of <code>TableOps::fixup</code> but the OOM still occurred there.</p>
<p>I let it fuzz for a while, and it ran fine but I sense something might be missing.</p>
</blockquote>



<a name="533221235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533221235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533221235">(Aug 07 2025 at 05:47)</a>:</h4>
<p><strong>khagankhan</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>.</p>



<a name="533221237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533221237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533221237">(Aug 07 2025 at 05:47)</a>:</h4>
<p><strong>khagankhan</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>.</p>



<a name="533221365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533221365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533221365">(Aug 07 2025 at 05:49)</a>:</h4>
<p>khagankhan edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<ul>
<li>Decoupled <code>TableOps</code> and <code>TableOpsLimits,</code> which are now passed explicitly to <code>TableOp::fixup</code></li>
<li>Updated the macro to align with the new struct separation</li>
<li><code>TableOps::fixup</code> now processes the entire sequence of operations instead of starting from specific index</li>
</ul>
<p>I placed clamping logic at the beginning of the <code>to_wasm_binary</code> method since the OOM issues originate in t<code>o_wasm_binary</code> This relies on <code>TableOp::fixup</code> to ensure that values respect those clamped limits to avoid potential traps.</p>
<p>I previously added clamping at the start of <code>TableOps::fixup</code> but the OOM still occurred there.</p>
<p>I let it fuzz for a while, and it ran fine but I sense something might be missing.</p>
<p>Related Issues: #11345 and #11346</p>
</blockquote>



<a name="533236150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533236150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533236150">(Aug 07 2025 at 07:47)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3162944010">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="533323808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533323808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533323808">(Aug 07 2025 at 16:11)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#pullrequestreview-3097835477">PR review</a>:</p>
<blockquote>
<p>Looks good to me with the nitpick about <code>println!</code> below addressed.</p>
<p>I think we should also switch to calling <code>fixup</code> at the start of <code>to_wasm_binary</code> instead of after each particular mutation, since it has to process all ops and can't take advantage of our knowledge of which mutation we performed and where that mutation was anymore. This change will cut down on the number of call sites and also make it more obvious that the clamping in <code>to_wasm_binary</code> won't ever produce invalid Wasm binaries. (With this PR now, I think we could produce invalid Wasm binaries from <code>to_wasm_binary</code>'s clamping due to deserializing some ops that haven't been <code>fixup</code>'d to work with the clamping yet.) This can happen in a follow up PR if you'd prefer.</p>
<p>Thanks!</p>
</blockquote>



<a name="533323810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533323810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533323810">(Aug 07 2025 at 16:11)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#discussion_r2260786219">PR review comment</a>:</p>
<blockquote>
<p>This should be <code>log::debug!</code> and not a <code>println!</code>.</p>
</blockquote>



<a name="533324893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533324893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533324893">(Aug 07 2025 at 16:18)</a>:</h4>
<p>khagankhan <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3164899011">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<p>Thanks! Yes that makes sense. Initially, I did that. Calling fixup in to_wasm_binary(). It hit assertion failure at for limit &gt; 0. I guess after addressing it we can do that. I will make another PR where clamping happen at the beginning of fixup and fixup is called in encoding.</p>
<p>I forgot to remove println! :/<br>
</p>
</blockquote>



<a name="533367593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/533367593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#533367593">(Aug 07 2025 at 21:47)</a>:</h4>
<p>khagankhan updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>.</p>



<a name="535370629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/535370629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#535370629">(Aug 20 2025 at 18:38)</a>:</h4>
<p>khagankhan <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3207609067">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<p>I was not merged. @fitzgen do you know why this may happen <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span>?</p>
</blockquote>



<a name="535371420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/535371420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#535371420">(Aug 20 2025 at 18:45)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3207625332">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<p>It looks like CI failed, you can see this via the "view details" button next to the "<a href="https://github.com/apps/github-merge-queue">github-merge-queue</a> bot removed this pull request from the <a href="https://github.com/bytecodealliance/wasmtime/queue/main">merge queue</a> due to failed status checks" notification.</p>
<p>In particular, this job failed: <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/16817124055/job/47636482289">https://github.com/bytecodealliance/wasmtime/actions/runs/16817124055/job/47636482289</a></p>
<p>It looks like it is old enough that the logs were deleted however, so I will try re-enqueing this PR and if it fails again, you can see the failure via the method described above.</p>
</blockquote>



<a name="535376126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/535376126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#535376126">(Aug 20 2025 at 19:17)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3207735076">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<p>This failure looks like some spurious networking issue involving docker or something. Retrying once more.</p>
</blockquote>



<a name="535383098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/535383098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#535383098">(Aug 20 2025 at 20:09)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3207942569">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<p>Looks like this time there was an internal assertion inside the macos linker?? Retrying once more...</p>
</blockquote>



<a name="535384366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/535384366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#535384366">(Aug 20 2025 at 20:20)</a>:</h4>
<p>khagankhan <a href="https://github.com/bytecodealliance/wasmtime/pull/11392#issuecomment-3207974795">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>:</p>
<blockquote>
<p>Thanks!<span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>
</blockquote>



<a name="535386153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311392%20Fix%20Out-of-memory%20in%20table-ops/near/535386153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311392.20Fix.20Out-of-memory.20in.20table-ops.html#535386153">(Aug 20 2025 at 20:34)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11392">PR #11392</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>