<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12465 `ResourceAny` API ergonomics · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312465.20.60ResourceAny.60.20API.20ergonomics.html">wasmtime / issue #12465 `ResourceAny` API ergonomics</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="570756679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312465%20%60ResourceAny%60%20API%20ergonomics/near/570756679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312465.20.60ResourceAny.60.20API.20ergonomics.html#570756679">(Jan 29 2026 at 10:27)</a>:</h4>
<p>crepererum opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12465">issue #12465</a>:</p>
<blockquote>
<h4>Feature</h4>
<p><code>ResourceAny</code> is in the component model, both when the guest returns resources but also when <code>borrow&lt;...&gt;</code> resources are passed to the guest. The <code>ResourceAny</code> type <code>Copy</code>able handle and is usually passed by value. To destroy a resource <code>resource_drop[_async]</code> is called. Since the handle itself is <code>Copy</code>, you may still have copies of that handle around. Accidently reusing the handle results in:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>host-owned resource is being used with the wrong type
</code></pre></div>
<p>as this test shows:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/23c0f09d0ba1041fc300bc4aabada0ded783c538/tests/all/component_model/resources.rs#L181-L203">https://github.com/bytecodealliance/wasmtime/blob/23c0f09d0ba1041fc300bc4aabada0ded783c538/tests/all/component_model/resources.rs#L181-L203</a></p>
<p>Now there are two DX issues here:</p>
<ul>
<li>the error message is somewhat misleading (it actually even happens when you allocate the same resource type into the slot, i.e. if the test would have used <code>t1</code> &amp; <code>t1</code> instead of <code>t</code> and <code>u</code>)</li>
<li>since the handle doesn't have any form of refcounting, it is hard to enforce a "don't reuse a de-allocated resource" in a codebase esp. since <code>ResourceAny</code> is <code>Copy</code> and is often passed by value, hence you cannot really build a strong ref-count guard around it</li>
</ul>
<h4>Benefit</h4>
<p>Improving the situation may prevent certain "used after free" bugs (even though they don't panic or SEGFAULT, they are still not great)</p>
<h4>Implementation</h4>
<p>Ideally <code>ResourceAny</code> wouldn't be <code>Copy</code> and would be passed by reference. Then <code>resource_drop[_async]</code> could consume the type. However there might be other API considerations that could prevent that.</p>
<h4>Alternatives</h4>
<p>If the type stays <code>Copy</code>, could we at least make the error message a bit clearer?<br>
</p>
</blockquote>



<a name="570852768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312465%20%60ResourceAny%60%20API%20ergonomics/near/570852768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312465.20.60ResourceAny.60.20API.20ergonomics.html#570852768">(Jan 29 2026 at 17:14)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasmtime:api label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12465">Issue #12465</a>.</p>



<a name="570852770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312465%20%60ResourceAny%60%20API%20ergonomics/near/570852770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312465.20.60ResourceAny.60.20API.20ergonomics.html#570852770">(Jan 29 2026 at 17:14)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasm-proposal:component-model label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12465">Issue #12465</a>.</p>



<a name="570853018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312465%20%60ResourceAny%60%20API%20ergonomics/near/570853018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312465.20.60ResourceAny.60.20API.20ergonomics.html#570853018">(Jan 29 2026 at 17:15)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12465#issuecomment-3819091443">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12465">issue #12465</a>:</p>
<blockquote>
<p>cc @alexcrichton @rvolosatovs </p>
</blockquote>



<a name="570872479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312465%20%60ResourceAny%60%20API%20ergonomics/near/570872479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312465.20.60ResourceAny.60.20API.20ergonomics.html#570872479">(Jan 29 2026 at 18:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12465#issuecomment-3819655355">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12465">issue #12465</a>:</p>
<blockquote>
<p>This is definitely a known deficiency of the API design of <code>ResourceAny</code>, but it was currently designed as a sort of least-bad version of the functionality to provide. Destroying a resource, or cloning a resource, requires access to a store which means that this can't use normal Rust traits. Additionally destroying a resource involves executing WebAssembly meaning it might be an async operation.</p>
<p>I do think that the error messages could be improved here, yeah, but I'm not aware of a great way to manage the resource here in a more automatic Rust-y fashion.</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>