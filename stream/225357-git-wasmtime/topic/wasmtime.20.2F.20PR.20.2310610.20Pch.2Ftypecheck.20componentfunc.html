<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10610 Pch/typecheck componentfunc · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html">wasmtime / PR #10610 Pch/typecheck componentfunc</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="512924404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/512924404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#512924404">(Apr 17 2025 at 22:06)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a> from <code>bytecodealliance:pch/typecheck_componentfunc</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="512925504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/512925504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#512925504">(Apr 17 2025 at 22:16)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<a name="512926195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/512926195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#512926195">(Apr 17 2025 at 22:22)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<a name="512927893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/512927893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#512927893">(Apr 17 2025 at 22:37)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<a name="512929048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/512929048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#512929048">(Apr 17 2025 at 22:49)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<a name="512940018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/512940018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#512940018">(Apr 18 2025 at 00:30)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<a name="513050789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513050789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513050789">(Apr 18 2025 at 15:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10610#pullrequestreview-2778809365">PR review</a>.</p>



<a name="513050790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513050790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513050790">(Apr 18 2025 at 15:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10610#discussion_r2050761737">PR review comment</a>:</p>
<blockquote>
<p>Technically this isn't possible, type-checking at the component level. Components import abstract resources which don't match any types defined in Rust, which is what would be passed in as the type parameters here. The type-check can only be done once you have an <code>InstancePre</code> or <code>Linker</code> where the actual resource types are all assigned and we can match up the host-provided resources with our expectations.</p>
<p>That being said I do like the property that <code>FooIndices</code> is all you need to "quickly load the thing" and as such represents a type-checked version of the component. Given that one options is to switch this to using <code>InstancePre&lt;T&gt;</code> instead of <code>&amp;Component</code> as a construction argument. In doing so though we're not really prepared to have that working. The problem is that we'd have to prevent crossing <code>FooIndices</code> values by accident.  Right now export indices are intrinsically tied to a <code>Component</code> which has a unique ID, but not a <code>Linker</code> which does not have a unique ID. That means you could technically create a <code>FooIndices</code> with one linker and then extract exports from a component created with another linker, and if we skip the type-checks with <code>unsafe</code> (which I assume this PR is building towards) that could be memory-unsafe.</p>
<p>That might be solvable though by putting a unique ID in linkers and plumbing that to <code>InstancePre</code> and <code>Instance</code> which is checked.</p>
</blockquote>



<a name="513055629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513055629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513055629">(Apr 18 2025 at 15:50)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10610#pullrequestreview-2778863460">PR review</a>.</p>



<a name="513055630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513055630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513055630">(Apr 18 2025 at 15:50)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/10610#discussion_r2050798379">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>The type-check can only be done once you have an InstancePre or Linker where the actual resource types are all assigned and we can match up the host-provided resources with our expectations.<br>
Agreed, thats exactly where I got to - something representing that resource assignment (__internals::InstanceType) needs to be passed into ComponentFunc::typecheck as an argument. I got pretty tangled up with InstanceType because it borrows arcs of Store's type tables instead of cloning the arcs, so I am going to either change the structure or make a variant of it that owns the arcs.</p>
</blockquote>
</blockquote>



<a name="513055652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513055652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513055652">(Apr 18 2025 at 15:50)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10610#discussion_r2050798379">PR review comment</a>.</p>



<a name="513056147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513056147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513056147">(Apr 18 2025 at 15:54)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10610#discussion_r2050798379">PR review comment</a>.</p>



<a name="513093345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513093345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513093345">(Apr 18 2025 at 20:26)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<a name="513093556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310610%20Pch/typecheck%20componentfunc/near/513093556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310610.20Pch.2Ftypecheck.20componentfunc.html#513093556">(Apr 18 2025 at 20:28)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10610">PR #10610</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>