<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12391 [CM async] panic performing block... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html">wasmtime / issue #12391 [CM async] panic performing block...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="569391493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569391493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569391493">(Jan 22 2026 at 01:36)</a>:</h4>
<p><a href="https://github.com/lukewagner">lukewagner</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">Issue #12391</a>.</p>



<a name="569391494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569391494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569391494">(Jan 22 2026 at 01:36)</a>:</h4>
<p>lukewagner opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">issue #12391</a>:</p>
<blockquote>
<p>Currently, this WAST:</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">assert_trap</span>
  <span class="p">(</span><span class="err">component</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$Memory</span> <span class="p">(</span><span class="k">memory</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"mem"</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="nv">$memory</span> <span class="p">(</span><span class="err">instantiate</span> <span class="nv">$Memory</span><span class="p">))</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$M</span>
      <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"waitable-set.new"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.new</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"waitable-set.wait"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.wait</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">func</span> <span class="nv">$start</span>
        <span class="p">(</span><span class="nb">drop</span> <span class="p">(</span><span class="nb">call</span> <span class="nv">$waitable-set.wait</span> <span class="p">(</span><span class="nb">call</span> <span class="nv">$waitable-set.new</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)))</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="k">start</span> <span class="nv">$start</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="err">canon</span> <span class="err">wai</span><span class="k">table</span><span class="err">-set.new</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="nv">$waitable-set.new</span><span class="p">))</span>
    <span class="p">(</span><span class="err">canon</span> <span class="err">wai</span><span class="k">table</span><span class="err">-set.wait</span> <span class="p">(</span><span class="k">memory</span> <span class="nv">$memory</span> <span class="s2">"mem"</span><span class="p">)</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="nv">$waitable-set.wait</span><span class="p">))</span>
    <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="nv">$m</span> <span class="p">(</span><span class="err">instantiate</span> <span class="nv">$M</span> <span class="p">(</span><span class="err">with</span> <span class="s2">""</span> <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="s2">"waitable-set.new"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.new</span><span class="p">))</span>
      <span class="p">(</span><span class="k">export</span> <span class="s2">"waitable-set.wait"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.wait</span><span class="p">))</span>
    <span class="p">))))</span>
  <span class="p">)</span>
  <span class="s2">"cannot block a synchronous task before returning"</span>
<span class="p">)</span>
</code></pre></div>
<p>panics with:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">2367885</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1517</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">__rustc</span><span class="p">::</span><span class="n">rust_begin_unwind</span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic</span>
<span class="w">   </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">option</span><span class="p">::</span><span class="n">unwrap_failed</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">concurrent</span><span class="p">::</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">store</span><span class="p">::</span><span class="n">StoreOpaque</span><span class="o">&gt;</span><span class="p">::</span><span class="n">check_blocking</span>
<span class="w">   </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">concurrent</span><span class="p">::</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">Instance</span><span class="o">&gt;</span><span class="p">::</span><span class="n">waitable_set_wait</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="569392377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569392377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569392377">(Jan 22 2026 at 01:46)</a>:</h4>
<p>lukewagner <a href="https://github.com/bytecodealliance/wasmtime/issues/12391#issuecomment-3782036095">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">issue #12391</a>:</p>
<blockquote>
<p>This test case and another like it now available to pull in from <a href="https://github.com/WebAssembly/component-model/blob/main/test/async/dont-block-start.wast"><code>test/async/dont-block-start.wast</code></a> on <code>main</code>.</p>
</blockquote>



<a name="569528403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569528403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569528403">(Jan 22 2026 at 15:56)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12391#issuecomment-3785185022">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">issue #12391</a>:</p>
<blockquote>
<p>@dicej this should be fixed by <a href="https://github.com/bytecodealliance/wasmtime/pull/12379">https://github.com/bytecodealliance/wasmtime/pull/12379</a> I think, right?</p>
</blockquote>



<a name="569532753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569532753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569532753">(Jan 22 2026 at 16:13)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/12391#issuecomment-3785270802">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">issue #12391</a>:</p>
<blockquote>
<blockquote>
<p><a href="https://github.com/dicej">@dicej</a> this should be fixed by <a href="https://github.com/bytecodealliance/wasmtime/pull/12379">#12379</a> I think, right?</p>
</blockquote>
<p>Yes, it should be.  I'll test it on that branch when I get a chance.</p>
</blockquote>



<a name="569533655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569533655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569533655">(Jan 22 2026 at 16:17)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/12391#issuecomment-3785288398">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">issue #12391</a>:</p>
<blockquote>
<p>Yup, test passes (no panic) on that branch.</p>
</blockquote>



<a name="569778958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312391%20%5BCM%20async%5D%20panic%20performing%20block.../near/569778958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312391.20.5BCM.20async.5D.20panic.20performing.20block.2E.2E.2E.html#569778958">(Jan 23 2026 at 18:17)</a>:</h4>
<p>dicej closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12391">issue #12391</a>:</p>
<blockquote>
<p>Currently, this WAST:</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">assert_trap</span>
  <span class="p">(</span><span class="err">component</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$Memory</span> <span class="p">(</span><span class="k">memory</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"mem"</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="nv">$memory</span> <span class="p">(</span><span class="err">instantiate</span> <span class="nv">$Memory</span><span class="p">))</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$M</span>
      <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"waitable-set.new"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.new</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">import</span> <span class="s2">""</span> <span class="s2">"waitable-set.wait"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.wait</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">func</span> <span class="nv">$start</span>
        <span class="p">(</span><span class="nb">drop</span> <span class="p">(</span><span class="nb">call</span> <span class="nv">$waitable-set.wait</span> <span class="p">(</span><span class="nb">call</span> <span class="nv">$waitable-set.new</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)))</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="k">start</span> <span class="nv">$start</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="err">canon</span> <span class="err">wai</span><span class="k">table</span><span class="err">-set.new</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="nv">$waitable-set.new</span><span class="p">))</span>
    <span class="p">(</span><span class="err">canon</span> <span class="err">wai</span><span class="k">table</span><span class="err">-set.wait</span> <span class="p">(</span><span class="k">memory</span> <span class="nv">$memory</span> <span class="s2">"mem"</span><span class="p">)</span> <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="nv">$waitable-set.wait</span><span class="p">))</span>
    <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="nv">$m</span> <span class="p">(</span><span class="err">instantiate</span> <span class="nv">$M</span> <span class="p">(</span><span class="err">with</span> <span class="s2">""</span> <span class="p">(</span><span class="err">instance</span>
      <span class="p">(</span><span class="k">export</span> <span class="s2">"waitable-set.new"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.new</span><span class="p">))</span>
      <span class="p">(</span><span class="k">export</span> <span class="s2">"waitable-set.wait"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$waitable-set.wait</span><span class="p">))</span>
    <span class="p">))))</span>
  <span class="p">)</span>
  <span class="s2">"cannot block a synchronous task before returning"</span>
<span class="p">)</span>
</code></pre></div>
<p>panics with:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">2367885</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1517</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">__rustc</span><span class="p">::</span><span class="n">rust_begin_unwind</span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic</span>
<span class="w">   </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">option</span><span class="p">::</span><span class="n">unwrap_failed</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">concurrent</span><span class="p">::</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">store</span><span class="p">::</span><span class="n">StoreOpaque</span><span class="o">&gt;</span><span class="p">::</span><span class="n">check_blocking</span>
<span class="w">   </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">concurrent</span><span class="p">::</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">Instance</span><span class="o">&gt;</span><span class="p">::</span><span class="n">waitable_set_wait</span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>