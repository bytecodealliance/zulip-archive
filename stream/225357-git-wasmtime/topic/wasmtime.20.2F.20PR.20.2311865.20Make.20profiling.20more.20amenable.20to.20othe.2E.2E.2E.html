<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11865 Make profiling more amenable to othe... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html">wasmtime / PR #11865 Make profiling more amenable to othe...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="545017164"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545017164" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545017164">(Oct 15 2025 at 16:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11865">PR #11865</a>.</p>



<a name="545017165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545017165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545017165">(Oct 15 2025 at 16:55)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11865">PR #11865</a> from <code>alexcrichton:multi-engine-profiling</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Both the perfmap and jitdump protocols for profiling JITs require that there's a single file with metadata per-process. This has the unfortunate side effect of if there are multiple engines in the same process there's no real way for them to coordinate when writing out records to this file. In an attempt to at least try to synchronize this commit updates these two implementations to issue a single <code>write</code> syscall with the full contents of the record to a file opened in <code>O_APPEND</code> mode.</p>
<p>If all the stars align and a partial write doesn't happen then that means we're doing our best effort to cooperate with other engines in the same process. If a partial write happens the decision in this PR is to go ahead and retry the rest of the write (using the <code>write_all</code> helper). This is a tradeoff where it makes the single-engine use case more robust (partial writes are handled correctly) but the multi-engine use case will produce corrupt files. It doesn't feel like a great tradeoff to say that profiling can't be done in Wasmtime when a partial write would happen for this niche use case of multiple engines, hence the direction of this tradeoff.</p>
<p>Closes #11862</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="545017166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545017166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545017166">(Oct 15 2025 at 16:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11865">PR #11865</a>.</p>



<a name="545017285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545017285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545017285">(Oct 15 2025 at 16:55)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11865#pullrequestreview-3341443735">PR review</a>.</p>



<a name="545017286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545017286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545017286">(Oct 15 2025 at 16:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11865#discussion_r2433339176">PR review comment</a>:</p>
<blockquote>
<p>I ended up deleting this method since it's not used in Wasmtime at all and opted to expose a <code>file</code> and <code>file_mut</code> accessor in case anyone externally is using this and still wants to be able to write.</p>
</blockquote>



<a name="545132874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545132874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545132874">(Oct 15 2025 at 21:51)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11865#pullrequestreview-3342479268">PR review</a>.</p>



<a name="545136282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311865%20Make%20profiling%20more%20amenable%20to%20othe.../near/545136282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311865.20Make.20profiling.20more.20amenable.20to.20othe.2E.2E.2E.html#545136282">(Oct 15 2025 at 22:20)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11865">PR #11865</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>