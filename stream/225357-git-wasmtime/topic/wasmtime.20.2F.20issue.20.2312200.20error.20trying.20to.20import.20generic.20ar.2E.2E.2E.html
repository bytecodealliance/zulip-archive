<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12200 error trying to import generic ar... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html">wasmtime / issue #12200 error trying to import generic ar...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="565058900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312200%20error%20trying%20to%20import%20generic%20ar.../near/565058900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html#565058900">(Dec 22 2025 at 19:23)</a>:</h4>
<p>michaelficarra opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12200">issue #12200</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">test_arrayref</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (func (export "len") (param $a arrayref) (result i32)</span>
<span class="s">                (array.len (local.get $a))</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (type $concrete_array (array (mut i32)))</span>
<span class="s">            (import "module_a" "len" (func $len (param (ref null $concrete_array)) (result i32)))</span>
<span class="s">            (func (export "use_len") (result i32)</span>
<span class="s">                (call $len</span>
<span class="s">                    (array.new_fixed $concrete_array 3</span>
<span class="s">                        (i32.const 1)</span>
<span class="s">                        (i32.const 2)</span>
<span class="s">                        (i32.const 3)</span>
<span class="s">                    )</span>
<span class="s">                )</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_gc</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_function_references</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">empty_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">empty_imports</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">exports_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance_a</span><span class="p">.</span><span class="n">exports</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">).</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">positional_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">module_b</span><span class="p">.</span><span class="n">imports</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exports_a</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">find</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">import</span><span class="p">.</span><span class="n">name</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="n">positional_imports</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">export</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">into_extern</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">positional_imports</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">use_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance_b</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"use_len"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">use_len</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>or, if you prefer to use <code>Linker</code> instead of manually wiring up the imports, this should be equivalent:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">test_arrayref</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (func (export "len") (param $a arrayref) (result i32)</span>
<span class="s">                (array.len (local.get $a))</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (type $concrete_array (array (mut i32)))</span>
<span class="s">            (import "module_a" "len" (func $len (param (ref null $concrete_array)) (result i32)))</span>
<span class="s">            (func (export "use_len") (result i32)</span>
<span class="s">                (call $len</span>
<span class="s">                    (array.new_fixed $concrete_array 3</span>
<span class="s">                        (i32.const 1)</span>
<span class="s">                        (i32.const 2)</span>
<span class="s">                        (i32.const 3)</span>
<span class="s">                    )</span>
<span class="s">                )</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_gc</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_function_references</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">module</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"module_a"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">module</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"module_b"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">use_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance_b</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"use_len"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">use_len</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Run the test.</li>
</ul>
<h3>Expected Results</h3>
<p>I expect the wasm to validate and run. I expect the Rust assertion <code>assert_eq!(result, 3);</code> to then pass.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">----</span><span class="w"> </span><span class="n">test</span><span class="p">::</span><span class="n">manual</span><span class="p">::</span><span class="n">test_arrayref</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">incompatible</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">for</span><span class="w"> </span><span class="err">`</span><span class="n">module_a</span><span class="p">::</span><span class="n">len</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">types</span><span class="w"> </span><span class="n">incompatible</span><span class="p">:</span><span class="w"> </span><span class="nc">expected</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">(</span><span class="n">engine</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="n">array</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="err">`</span>
</code></pre></div>
<p>If you remove the import and replace the function call (<code>call $len</code>) with the <code>array.len</code> instruction, it works.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 40.0.0</p>
<p>Operating system: <code>Darwin L6QHWH6D3R 24.5.0 Darwin Kernel Version 24.5.0: Tue Apr 22 19:54:29 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6030 arm64 arm Darwin</code></p>
<p>Architecture: arm64</p>
<h3>Extra Info</h3>
</blockquote>



<a name="565058901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312200%20error%20trying%20to%20import%20generic%20ar.../near/565058901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html#565058901">(Dec 22 2025 at 19:23)</a>:</h4>
<p><a href="https://github.com/michaelficarra">michaelficarra</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12200">Issue #12200</a>.</p>



<a name="565059881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312200%20error%20trying%20to%20import%20generic%20ar.../near/565059881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html#565059881">(Dec 22 2025 at 19:32)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:gc label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12200">Issue #12200</a>.</p>



<a name="565059928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312200%20error%20trying%20to%20import%20generic%20ar.../near/565059928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html#565059928">(Dec 22 2025 at 19:32)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12200#issuecomment-3683854806">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12200">issue #12200</a>:</p>
<blockquote>
<p>I believe this is expected where subtyping doesn't apply at the function-level like this. @fitzgen would know for sure though</p>
</blockquote>



<a name="566436204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312200%20error%20trying%20to%20import%20generic%20ar.../near/566436204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html#566436204">(Jan 05 2026 at 20:49)</a>:</h4>
<p>fitzgen closed <a href="https://github.com/bytecodealliance/wasmtime/issues/12200">issue #12200</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">test_arrayref</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (func (export "len") (param $a arrayref) (result i32)</span>
<span class="s">                (array.len (local.get $a))</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (type $concrete_array (array (mut i32)))</span>
<span class="s">            (import "module_a" "len" (func $len (param (ref null $concrete_array)) (result i32)))</span>
<span class="s">            (func (export "use_len") (result i32)</span>
<span class="s">                (call $len</span>
<span class="s">                    (array.new_fixed $concrete_array 3</span>
<span class="s">                        (i32.const 1)</span>
<span class="s">                        (i32.const 2)</span>
<span class="s">                        (i32.const 3)</span>
<span class="s">                    )</span>
<span class="s">                )</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_gc</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_function_references</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">empty_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">empty_imports</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">exports_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance_a</span><span class="p">.</span><span class="n">exports</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">).</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">positional_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">module_b</span><span class="p">.</span><span class="n">imports</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exports_a</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">find</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">import</span><span class="p">.</span><span class="n">name</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="n">positional_imports</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">export</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">into_extern</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">positional_imports</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">use_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance_b</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"use_len"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">use_len</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>or, if you prefer to use <code>Linker</code> instead of manually wiring up the imports, this should be equivalent:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">test_arrayref</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (func (export "len") (param $a arrayref) (result i32)</span>
<span class="s">                (array.len (local.get $a))</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wat</span><span class="p">::</span><span class="n">parse_str</span><span class="p">(</span><span class="s">r#"</span>
<span class="s">        (module</span>
<span class="s">            (type $concrete_array (array (mut i32)))</span>
<span class="s">            (import "module_a" "len" (func $len (param (ref null $concrete_array)) (result i32)))</span>
<span class="s">            (func (export "use_len") (result i32)</span>
<span class="s">                (call $len</span>
<span class="s">                    (array.new_fixed $concrete_array 3</span>
<span class="s">                        (i32.const 1)</span>
<span class="s">                        (i32.const 2)</span>
<span class="s">                        (i32.const 3)</span>
<span class="s">                    )</span>
<span class="s">                )</span>
<span class="s">            )</span>
<span class="s">        )</span>
<span class="s">    "#</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_gc</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_function_references</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">module</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"module_a"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">module</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"module_b"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">use_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance_b</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"use_len"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">use_len</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Run the test.</li>
</ul>
<h3>Expected Results</h3>
<p>I expect the wasm to validate and run. I expect the Rust assertion <code>assert_eq!(result, 3);</code> to then pass.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">----</span><span class="w"> </span><span class="n">test</span><span class="p">::</span><span class="n">manual</span><span class="p">::</span><span class="n">test_arrayref</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">incompatible</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">for</span><span class="w"> </span><span class="err">`</span><span class="n">module_a</span><span class="p">::</span><span class="n">len</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">types</span><span class="w"> </span><span class="n">incompatible</span><span class="p">:</span><span class="w"> </span><span class="nc">expected</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">(</span><span class="n">engine</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="n">array</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="err">`</span>
</code></pre></div>
<p>If you remove the import and replace the function call (<code>call $len</code>) with the <code>array.len</code> instruction, it works.</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 40.0.0</p>
<p>Operating system: <code>Darwin L6QHWH6D3R 24.5.0 Darwin Kernel Version 24.5.0: Tue Apr 22 19:54:29 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6030 arm64 arm Darwin</code></p>
<p>Architecture: arm64</p>
<h3>Extra Info</h3>
</blockquote>



<a name="566436211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312200%20error%20trying%20to%20import%20generic%20ar.../near/566436211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312200.20error.20trying.20to.20import.20generic.20ar.2E.2E.2E.html#566436211">(Jan 05 2026 at 20:49)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/12200#issuecomment-3712036714">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12200">issue #12200</a>:</p>
<blockquote>
<p>Yes, this is expected because the imported <code>module_a::len</code> type is not exactly same as nor an explicitly-declared subtype of the exported <code>len</code> function's type.</p>
<p>You could adjust the test case to make linking succeed by either:</p>
<ol>
<li>
<p>Changing the import to this:</p>
<p><code>wat
 (import "module_a" "len" (func $len (param arrayref) (result i32)))
 </code></p>
</li>
<li>
<p>Changing the <code>len</code> function's definition to this:</p>
<p><code>wat
 (type $concrete_array (array (mut i32)))
 (func (export "len") (param $a (ref null $concrete_array)) (result i32)
   (array.len (local.get $a))
 )
 </code></p>
</li>
<li>
<p>Declaring the function as non-final[^short-hand] so that it is subtype-able:</p>
<p><code>wat
 ;; module_a
 (type $len_ty (sub (func (param arrayref) (result i32))))
 (func (export "len") (type $len_ty)
   (array.len (local.get 0))
 )
 </code></p>
<p>and then when importing it, you can still import the function as one which takes the concrete type, but you have to declare the function types and the subtyping relationship:</p>
<p><code>wat
 ;; module_b
 (type $sup_len_ty (sub (func (param arrayref) (result i32))))
 (type $sub_len_ty (sub $sup_len_ty (func (param (ref null $concrete_array)) (result i32)))))
 (import "module_a" "len" (func (type $sub_len_ty)))
 </code></p>
</li>
</ol>
<p>[^short-hand]: When you do <code>(type (func ...))</code>, which is what declaring a function's type inline is short-hand for, then that in turn is short hand for <code>(sub final (func ...))</code>.</p>
<p>Closing this as working as expected, but feel free to ask more follow up questions / clarifications or open new issues if you run into anything else!</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>