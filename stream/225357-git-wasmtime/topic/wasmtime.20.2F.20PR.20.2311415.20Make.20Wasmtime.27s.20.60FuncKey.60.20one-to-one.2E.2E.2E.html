<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11415 Make Wasmtime&#x27;s `FuncKey` one-to-one... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html">wasmtime / PR #11415 Make Wasmtime&#x27;s `FuncKey` one-to-one...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="533880060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880060">(Aug 11 2025 at 22:53)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a> from <code>fitzgen:inlining-fuzz-bugs</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p><code>FuncKey</code>, which used to be called <code>CompileKey</code>, is now one-to-one with <code>cranelift_codegen::ir::UserExternalName</code>, and is used for not just identifying compilation objects but also relocations and call-graph edges. This allows us to determine the <code>StaticModuleIndex</code> and <code>DefinedFuncIndex</code> pair for any <code>cranelift_codegen::ir::FuncRef</code>, regardless of inlining depth, which fixes some fuzz bugs on OSS-Fuzz.</p>
<p>This continues pushing on the idea that Wasmtime's compilation orchestration and linking should be relatively agnostic to the kinds of things it is actually compiling and linking, allowing us to tweak, add, and remove new kinds of <code>FuncKey</code>s more easily. Adding a new <code>FuncKey</code> should not require modifying relocation resolution, for example, just a little bit of code to run the associated compilation and optionally some code to extract metadata into our final artifacts for querying at runtime. Everything in between should Just Continue Working. We still aren't all the way there yet, but this does bring us a little bit closer.</p>
<p>Finally, in Cranelift's inlining pass, this adds a check that a block is inserted in the layout before attempting to remove it from the layout, which would otherwise cause panics. This was triggered by multi-level inlining and now-unreachable blocks in the inner callees.</p>
<p>I'll note that this does update basically all of the disas tests, or at least nearly all of them that make function calls. This is because the namespace/index numbering pair changed slightly to align with <code>FuncKey</code>, but that should pretty much be the only changes.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="533880061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880061">(Aug 11 2025 at 22:53)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="533880063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880063">(Aug 11 2025 at 22:53)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="533880064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880064">(Aug 11 2025 at 22:53)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="533880065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880065">(Aug 11 2025 at 22:53)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="533880523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880523">(Aug 11 2025 at 22:58)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#pullrequestreview-3108001915">PR review</a>.</p>



<a name="533880524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533880524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533880524">(Aug 11 2025 at 22:58)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#discussion_r2268182476">PR review comment</a>:</p>
<blockquote>
<p>Whoops, I need to fill out this comment</p>
</blockquote>



<a name="533881399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533881399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533881399">(Aug 11 2025 at 23:06)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="533895204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533895204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533895204">(Aug 12 2025 at 02:22)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#issuecomment-3177477146">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "wasmtime:api", "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="533899656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533899656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533899656">(Aug 12 2025 at 03:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#pullrequestreview-3108418824">PR review</a>.</p>



<a name="533936836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533936836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533936836">(Aug 12 2025 at 09:00)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#pullrequestreview-3109379592">PR review</a>.</p>



<a name="533936838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/533936838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#533936838">(Aug 12 2025 at 09:01)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#discussion_r2269187875">PR review comment</a>:</p>
<blockquote>
<p>Maybe print the indexes as hex without <code>0x</code> prefix? <code>format!("u{namespace:x}:{index:x}")</code></p>
</blockquote>



<a name="534014992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534014992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534014992">(Aug 12 2025 at 16:19)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#pullrequestreview-3111774759">PR review</a>.</p>



<a name="534014994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534014994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534014994">(Aug 12 2025 at 16:19)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11415#discussion_r2270482445">PR review comment</a>:</p>
<blockquote>
<p>This would require also updating the CLIF parser, and I'd rather not get into that in this PR, as it is fairly unrelated.</p>
</blockquote>



<a name="534015502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534015502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534015502">(Aug 12 2025 at 16:21)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="534019036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534019036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534019036">(Aug 12 2025 at 16:42)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="534019907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534019907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534019907">(Aug 12 2025 at 16:47)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="534033448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534033448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534033448">(Aug 12 2025 at 18:22)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="534033449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534033449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534033449">(Aug 12 2025 at 18:22)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<a name="534038363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311415%20Make%20Wasmtime%27s%20%60FuncKey%60%20one-to-one.../near/534038363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311415.20Make.20Wasmtime.27s.20.60FuncKey.60.20one-to-one.2E.2E.2E.html#534038363">(Aug 12 2025 at 18:57)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11415">PR #11415</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>