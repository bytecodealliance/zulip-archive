<html>
<head><meta charset="utf-8"><title>wasmtime / PR #12428 Use `gimli::write::Dwarf::convert_wi... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html">wasmtime / PR #12428 Use `gimli::write::Dwarf::convert_wi...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="569923270"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/569923270" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#569923270">(Jan 25 2026 at 03:51)</a>:</h4>
<p>philipc opened <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428</a> from <code>philipc:transform</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Replace parts of the transform code with <code>gimli</code>'s generic DWARF transformation support. Most of the remaining code is specific to the needs of Wasmtime.</p>
<p>This change relates to #5537. While this PR provides some small improvements, it doesn't fundamentally change the quality of the transformed DWARF. The primary benefit is simply less code in Wasmtime.</p>
<p>The overall behaviour is the same as the previous implementation. We build a graph of the DIE dependencies, and prune DIEs that don't have valid code ranges. Then we traverse the DIE tree again and transform the DIEs. However, there are some differences.</p>
<p>Previously, unresolved references to DIEs were stored in <code>PendingUnitRefs</code> and <code>PendingDebugInfoRefs</code>, then at the end of the transformation we went back and fixed up these references. The new behaviour reserves IDs for all of the DIEs in the dependency tree before transformation, which avoids the need to fix up references later. It also allows gimli to correctly handle references in DWARF expressions, although that doesn't currently matter for Wasmtime because it doesn't handle references in expressions yet. The visible effect of this in Wasmtime is that the order of transformed attributes will now always match the original DWARF.</p>
<p>The DIE tree pruning is slightly different. We no longer add back-edges pointing to namespace DIEs or the root DIE, which previously caused some DIEs to be reachable when they should not have been. In particular, this affects DW_TAG_variable DIEs for global variables. Wasmtime can't currently translate the location for globals, so they were added without a valid DW_AT_location. These DIEs are now omitted from the transformed DWARF. In the future when global variables can be translated correctly, they can be included by calling <code>ReserveUnitSection::require_entry</code>.</p>
<p>Performance measurements for <code>wasmtime compile -D debug-info=y</code> show minimal change.</p>
</blockquote>



<a name="569923271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/569923271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#569923271">(Jan 25 2026 at 03:51)</a>:</h4>
<p><strong>philipc</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428</a>.</p>



<a name="569923272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/569923272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#569923272">(Jan 25 2026 at 03:51)</a>:</h4>
<p><strong>philipc</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428</a>.</p>



<a name="570179855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/570179855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#570179855">(Jan 26 2026 at 20:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/12428#pullrequestreview-3707683937">PR review</a>:</p>
<blockquote>
<p>Fantastic, thanks so much!</p>
</blockquote>



<a name="570179856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/570179856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#570179856">(Jan 26 2026 at 20:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/12428#discussion_r2728987805">PR review comment</a>:</p>
<blockquote>
<p>Nice to see this parameter list getting smaller!</p>
</blockquote>



<a name="570179922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/570179922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#570179922">(Jan 26 2026 at 20:12)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/12428#issuecomment-3801549456">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428</a>:</p>
<blockquote>
<p>Going to wait until <a href="https://www.githubstatus.com/incidents/90hj03y5tj3c">https://www.githubstatus.com/incidents/90hj03y5tj3c</a> is resolved before adding this to the merge queue.</p>
</blockquote>



<a name="570194246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/570194246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#570194246">(Jan 26 2026 at 21:44)</a>:</h4>
<p>alexcrichton added <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428 Use <code>gimli::write::Dwarf::convert_with_filter</code> for DWARF transform</a> to the merge queue.</p>



<a name="570215019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/570215019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#570215019">(Jan 27 2026 at 00:45)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428</a>.</p>



<a name="570215021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2312428%20Use%20%60gimli%3A%3Awrite%3A%3ADwarf%3A%3Aconvert_wi.../near/570215021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2312428.20Use.20.60gimli.3A.3Awrite.3A.3ADwarf.3A.3Aconvert_wi.2E.2E.2E.html#570215021">(Jan 27 2026 at 00:45)</a>:</h4>
<p>alexcrichton removed <a href="https://github.com/bytecodealliance/wasmtime/pull/12428">PR #12428 Use <code>gimli::write::Dwarf::convert_with_filter</code> for DWARF transform</a> from the merge queue.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>