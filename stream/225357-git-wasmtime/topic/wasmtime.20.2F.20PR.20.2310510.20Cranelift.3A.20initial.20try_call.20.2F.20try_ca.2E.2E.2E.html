<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10510 Cranelift: initial try_call / try_ca... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html">wasmtime / PR #10510 Cranelift: initial try_call / try_ca...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="509573794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509573794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509573794">(Apr 02 2025 at 00:39)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a> from <code>cfallin:lets-be-truly-exceptional</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR adds <code>try_call</code> and <code>try_call_indirect</code> instructions, and lowerings on four of five ISAs (x86-64, aarch64, riscv64, pulley; s390x has its own non-shared ABI code that will need separate work).</p>
<p>It extends CLIF to support these instructions as new kinds of branches, and extends block-calls to accept <code>retN</code> and <code>exnN</code> block-call args that carry the normal return values or exception payloads (respectively) into the appropriate successor blocks.</p>
<p>It wires up the "normal return path" so that it continues to work. It updates the ABI so that unwinding is possible without an initial register state at throw: specifically, as per our RFC, all registers are clobbered. It also includes metadata in the <code>MachBuffer</code> that describes exception-catch destinations. However, no unwinder exists to interpret these catch-destinations yet, so they are untested.</p>
</blockquote>



<a name="509573796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509573796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509573796">(Apr 02 2025 at 00:39)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="509573797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509573797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509573797">(Apr 02 2025 at 00:39)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="509573798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509573798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509573798">(Apr 02 2025 at 00:39)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="509573889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509573889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509573889">(Apr 02 2025 at 00:40)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2770983293">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>This builds on #10502; only the last commit is new.</p>
</blockquote>



<a name="509574189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509574189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509574189">(Apr 02 2025 at 00:42)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2770985531">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>Procedural note: I'm happy to go through review on this and try to land it with the "normal return" path working (ah, I should add runtests too!), or we can wait until I've implemented a test unwinder in the <code>clif-util</code> function runner. I'm happy to go either way.</p>
<p>I'm also happy to add a Cranelift feature to gate this off by default until we've got it fully tested, if desired.</p>
</blockquote>



<a name="509574431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509574431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509574431">(Apr 02 2025 at 00:44)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2770987314">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>Also, I haven't built full Wasmtime since rebasing so some newer CLIF-producing code needs to be updated; I'll put this in draft until then (and the runtests).</p>
</blockquote>



<a name="509577279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509577279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509577279">(Apr 02 2025 at 01:09)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="509577527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509577527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509577527">(Apr 02 2025 at 01:11)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2771015639">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<blockquote>
<p>Procedural note: I'm happy to go through review on this and try to land it with the "normal return" path working (ah, I should add runtests too!), or we can wait until I've implemented a test unwinder in the <code>clif-util</code> function runner. I'm happy to go either way.</p>
</blockquote>
<p>Testing the normal path only for the moment seems fine by me.</p>
<p>Will take a look at this PR tomorrow.</p>
</blockquote>



<a name="509789062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509789062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509789062">(Apr 02 2025 at 20:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="509796031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796031">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2737400037">PR review</a>:</p>
<blockquote>
<p>Looks great! A bunch of nitpicks and a couple more serious comments below.</p>
</blockquote>



<a name="509796032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796032">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025484742">PR review comment</a>:</p>
<blockquote>
<p>Nitpick: it shouldn't catch <em>any</em> thrown exception, just the exceptions specified in its exceptions table, so maybe rename this to</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        Call a function, catching the specified exceptions.
</code></pre></div><br>
</p>
</blockquote>



<a name="509796033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796033">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025506789">PR review comment</a>:</p>
<blockquote>
<p>I don't think we even need to specify this do we? The embedder can choose whether the reserved value is "catch all", or instead use <code>tag0</code>, or even whether they have a "catch all" tag at all or not.</p>
<p>It may still make sense to explicitly communicate this freedom by saying something like</p>
<blockquote>
<p>The embedder may reserve a particular tag (for example, the reserved value or <code>tag0</code>) to mean "catch all".</p>
</blockquote>
</blockquote>



<a name="509796034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796034">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025486870">PR review comment</a>:</p>
<blockquote>
<p>Not prepended anymore, right? There is a special kind of block call parameter to specify where they go, no? (I haven't read through everything yet)</p>
</blockquote>



<a name="509796035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796035">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025499905">PR review comment</a>:</p>
<blockquote>
<p>If this is already going to be a generic function over the type of <code>args</code>, it makes sense to also be generic over the <code>Item</code>, which (with <code>From&lt;Value&gt; for BlockCall</code> and <code>From&lt;&amp;'a Value&gt; for BlockCall</code> impls) should make a bunch of call sites a little less noisy:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    pub fn block_call&lt;T&gt;(
        &amp;mut self,
        block: Block,
        args: impl IntoIterator&lt;Item = T&gt;,
    ) -&gt; BlockCall
    where
        T: Into&lt;BlockArg&gt;
    {
</code></pre></div><br>
</p>
</blockquote>



<a name="509796036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796036">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025523946">PR review comment</a>:</p>
<blockquote>
<p>Maybe we should put the normal return last, so that <code>tags[i]</code> is for <code>targets[i]</code>?</p>
<p>And maybe we should make the members of this struct not-<code>pub</code> (maybe not even <code>pub(crate)</code>?) and only expose accessors that we can ensure are correct, use the right indices, etc...? This would mean that only this module needs to check/maintain the length invariant, or be concerned with correct indexing, not all code that interacts exception tables.</p>
</blockquote>



<a name="509796037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796037">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025512042">PR review comment</a>:</p>
<blockquote>
<p>Care to just put this in the <code>entity_impl!</code> macro? Then we could implement the constructors that assert that <code>n != u32::MAX</code> with unwrapping a call to this.</p>
</blockquote>



<a name="509796038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796038">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025520225">PR review comment</a>:</p>
<blockquote>
<p>Idle comment, not suggesting we actually do this or anything, but we <em>could</em> do a ref-counting + CoW kind of thing here. Not really worth the complexity tho.</p>
</blockquote>



<a name="509796039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796039">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025527824">PR review comment</a>:</p>
<blockquote>
<p>Ditto about making the iterator's <code>Item</code> generic here.</p>
</blockquote>



<a name="509796040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796040">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025530008">PR review comment</a>:</p>
<blockquote>
<p>And then this could be </p>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    pub fn append_argument(&amp;mut self, arg: impl Into&lt;BlockArg&gt;, pool: &amp;mut ValueListPool) {
</code></pre></div>
<p>as well</p>
</blockquote>



<a name="509796041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796041">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025513344">PR review comment</a>:</p>
<blockquote>
<p>"ex" feels a little too brief and potentially ambiguous, maybe</p>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>entity_impl!(ExceptionTable, "exn_table");
</code></pre></div>
<p>?</p>
</blockquote>



<a name="509796042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796042">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025566451">PR review comment</a>:</p>
<blockquote>
<p>This is the one thing that cranelift is constraining on the embedder's runtime: it must supply the exception values in the expected registers and this is inherently ISA specific. I don't know how to be document and communicate this. Maybe just a list of each ISA's registers in the docs for the <code>try_call</code> instruction? Or maybe in the docs for exception tags?</p>
<p>But it is also per-calling convention, so maybe on the calling convention's docs? Bit of a mess...</p>
</blockquote>



<a name="509796043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796043">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025534630">PR review comment</a>:</p>
<blockquote>
<p>And here as well</p>
</blockquote>



<a name="509796044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796044">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025548114">PR review comment</a>:</p>
<blockquote>
<p>Would be kinda nice if <code>PRegSet</code> had a <code>with_range</code> method or something like that. I've vaguely wanted that method before, and this function would sure appreciate that method's existence.</p>
</blockquote>



<a name="509796045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796045">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025558553">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>            &amp;Inst::Call { ref info } if info.try_call_info.is_some() =&gt; MachTerminator::Direct,
</code></pre></div>
<p>right?</p>
</blockquote>



<a name="509796046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796046">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025614558">PR review comment</a>:</p>
<blockquote>
<p>It looks like we are laying the code out such that the exceptional blocks are coming before the normal return blocks here. Ideally the call would fall through to the normal return block. Obviously, with blocks that are both a <code>try_call</code>'s normal return and the successor of many other blocks, this isn't always possible/desirable, but that is not the case in this example, which means we have room for improvement.</p>
<p>This isn't anything to fix before this PR can land, but is something we should think about for follow ups.</p>
</blockquote>



<a name="509796047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796047">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025577245">PR review comment</a>:</p>
<blockquote>
<p>Looks like the exception payload registers for each handler are not included in here. But I think they should be, or else the unwinder implementation will have to just know what we happen to use since, while system-v documents this, there is no such existing docs/constraints for our <code>tail</code> convention. We could even theoretically let regalloc pick the registers, if we wanted.</p>
</blockquote>



<a name="509796048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796048">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025616733">PR review comment</a>:</p>
<blockquote>
<p>It would also be good to test when both normal return blocks and exceptional return blocks don't only have <code>try_call</code> predecessors, but also regular control-flow predecessors.</p>
</blockquote>



<a name="509796049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796049">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025573394">PR review comment</a>:</p>
<blockquote>
<p>I guess we could include this in the unwind table data structures returned by cranelift after compilation. That actually seems easiest to me. Maybe that is indeed what is done and I haven't seen it yet or overlooked it.</p>
</blockquote>



<a name="509796050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796050">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025618032">PR review comment</a>:</p>
<blockquote>
<p>It would also be nice to have a runtest to exercise the normal return path, even before we have a filetest unwinder to exercise exceptional paths.</p>
</blockquote>



<a name="509796051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/509796051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#509796051">(Apr 02 2025 at 21:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2025489795">PR review comment</a>:</p>
<blockquote>
<p>Maybe some kind of mention here that it is the user's responsibility to coordinate with the runtime on the meaning of tags and how look up is done, and that all of that is outside of Cranelift's purview, itself here.</p>
</blockquote>



<a name="510006173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510006173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510006173">(Apr 03 2025 at 18:04)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510006646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510006646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510006646">(Apr 03 2025 at 18:07)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510007280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510007280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510007280">(Apr 03 2025 at 18:11)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510045368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045368">(Apr 03 2025 at 22:09)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741300543">PR review</a>.</p>



<a name="510045370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045370">(Apr 03 2025 at 22:09)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027813458">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately this seems to create a ton of noise elsewhere: it means that <code>ins.jump(target, &amp;[])</code> leads to a type-inference error, because <code>T</code> is now unconstrained. I've tried a bunch of things here including a custom trait <code>IntoBlockArgs</code> etc and this seems to be the least-bad; other ideas welcome...</p>
</blockquote>



<a name="510045449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045449">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510045452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045452">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741301119">PR review</a>.</p>



<a name="510045453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045453">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027813870">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510045466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045466">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741301205">PR review</a>.</p>



<a name="510045467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045467">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027813928">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510045487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045487">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741301402">PR review</a>.</p>



<a name="510045488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045488">(Apr 03 2025 at 22:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027814028">PR review comment</a>:</p>
<blockquote>
<p>Ah yes, fixed, sorry, this is old text. Fixed.</p>
</blockquote>



<a name="510045558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045558">(Apr 03 2025 at 22:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741302435">PR review</a>.</p>



<a name="510045560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510045560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510045560">(Apr 03 2025 at 22:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027814686">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately runs into the same unconstrained-generic problem with empty args list as above...</p>
</blockquote>



<a name="510046194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046194">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741321668">PR review</a>.</p>



<a name="510046197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046197">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027820508">PR review comment</a>:</p>
<blockquote>
<p>Indeed; that's a type from <code>regalloc2</code> so this would need a separate PR and release roundtrip, so unfortunately not in this PR, but will file this away...</p>
</blockquote>



<a name="510046209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046209">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510046212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046212">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741322459">PR review</a>.</p>



<a name="510046213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046213">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027820640">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510046222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046222">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741322807">PR review</a>.</p>



<a name="510046224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046224">(Apr 03 2025 at 22:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027820720">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510046322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046322">(Apr 03 2025 at 22:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741324778">PR review</a>.</p>



<a name="510046324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510046324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510046324">(Apr 03 2025 at 22:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027821306">PR review comment</a>:</p>
<blockquote>
<p>Yes, that's true; bigger change for sure, and we'd want to do it for jumptables for consistency. Might be worth it if we end up with large lists of handler locations on lots of callsites someday.</p>
</blockquote>



<a name="510048409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510048409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510048409">(Apr 03 2025 at 22:38)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741356645">PR review</a>.</p>



<a name="510048410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510048410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510048410">(Apr 03 2025 at 22:38)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027840027">PR review comment</a>:</p>
<blockquote>
<p>That's technically true, but there are a number of reasons that pushed me toward "fixed payload registers" and "not listed in metadata":</p>
<ul>
<li>Letting these be dynamic and allocating them with regalloc is pretty complex, because non-fixed-reg-but-still-reg-constrained defs on calls are error-prone -- we have to carefully poke holes in the clobbers to try to force regalloc to use those holes, then we have to assert that it did the right thing (because otherwise everything is clobbered). We really want a "def after clobbers" constraint but that is a weird thing in its own way.</li>
<li>Naming different registers per exception handler record per callsite is going to be quite bloated -- right now we have three <code>u32</code>s here, vs. 5.</li>
<li>Naming a variable-length list of registers (we don't specify that there are exactly e.g. two payload regs; that's a property of the platform and calling convention) is also complex: do we have an owned smallvec/vec per record here? separate list and ranges in it?</li>
<li>Letting the register choice be dynamic means that the unwinder needs a way to take an index and set an arbitrary register, rather than a fixed one. That rules out small handwritten longjmp-like trampolines/stubs (set rsp/rbp/rax and jump).</li>
</ul>
<p>So basically it seemed like too much generality, leading to far too much complexity, vs. saying that each platform gets to specify fixed payload regs. I think I'm comfortable with specifying that the payload registers are a fixed choice and this choice becomes part of our public contract (we should document this somewhere; I'll add it to the doc-comments on <code>try_call</code> / <code>try_call_indirect</code> and/or the <code>CallConv</code> arms...).</p>
</blockquote>



<a name="510048829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510048829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510048829">(Apr 03 2025 at 22:41)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510049105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510049105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510049105">(Apr 03 2025 at 22:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741363344">PR review</a>.</p>



<a name="510049107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510049107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510049107">(Apr 03 2025 at 22:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027844354">PR review comment</a>:</p>
<blockquote>
<p>(comment below -- added docs on <code>CallConv</code> and a note pointing to those docs on <code>try_call</code>)</p>
</blockquote>



<a name="510049595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510049595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510049595">(Apr 03 2025 at 22:49)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027848478">PR review comment</a>:</p>
<blockquote>
<p>Actually removed this paragraph -- I ended up with <code>PackedOption&lt;ExceptionTag&gt;</code> to allow <code>None</code> to mean "catch-all".</p>
</blockquote>



<a name="510049596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510049596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510049596">(Apr 03 2025 at 22:49)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741369376">PR review</a>.</p>



<a name="510049597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510049597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510049597">(Apr 03 2025 at 22:49)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510050236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510050236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510050236">(Apr 03 2025 at 22:55)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510050237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510050237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510050237">(Apr 03 2025 at 22:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2741376521">PR review</a>.</p>



<a name="510050239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510050239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510050239">(Apr 03 2025 at 22:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2027853320">PR review comment</a>:</p>
<blockquote>
<p>Good call, went for <code>extable</code> (underscores don't seem to be used elsewhere in these tags).</p>
</blockquote>



<a name="510259238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510259238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510259238">(Apr 04 2025 at 17:50)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2743746070">PR review</a>.</p>



<a name="510259241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510259241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510259241">(Apr 04 2025 at 17:50)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2029222945">PR review comment</a>:</p>
<blockquote>
<p>Sure, mind if I do this in a separate refactor? This is following the pattern that all the entities use -- happy to do them all at once.</p>
</blockquote>



<a name="510267459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510267459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510267459">(Apr 04 2025 at 18:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510267626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510267626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510267626">(Apr 04 2025 at 18:38)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2743835089">PR review</a>.</p>



<a name="510267628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510267628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510267628">(Apr 04 2025 at 18:38)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2029276388">PR review comment</a>:</p>
<blockquote>
<p>Interesting -- I took a look at where this is consumed and it seems we don't really need the distinction anymore (it's left over from older one-vs-two-armed conditional branches and branch finalization). So I collapsed direct/indirect/conditional into one "Branch" case.</p>
</blockquote>



<a name="510305672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510305672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510305672">(Apr 04 2025 at 23:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2744258661">PR review</a>.</p>



<a name="510305674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510305674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510305674">(Apr 04 2025 at 23:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2029538293">PR review comment</a>:</p>
<blockquote>
<p>Ah, great idea, done on both counts. This also had the nice side-effect of putting the normal-return path first in block order (i.e. fallthrough) because the <code>BlockLoweringOrder</code> processes out-edges in reverse order for particular heuristic reasons that I forget...</p>
</blockquote>



<a name="510305706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510305706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510305706">(Apr 04 2025 at 23:12)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510305968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510305968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510305968">(Apr 04 2025 at 23:15)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510306022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306022">(Apr 04 2025 at 23:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2744261249">PR review</a>.</p>



<a name="510306023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306023">(Apr 04 2025 at 23:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2029540193">PR review comment</a>:</p>
<blockquote>
<p>Resolved by above!</p>
</blockquote>



<a name="510306037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306037">(Apr 04 2025 at 23:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2744261390">PR review</a>.</p>



<a name="510306039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306039">(Apr 04 2025 at 23:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2029540276">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510306602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306602">(Apr 04 2025 at 23:22)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510306606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306606">(Apr 04 2025 at 23:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2744264596">PR review</a>.</p>



<a name="510306608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306608">(Apr 04 2025 at 23:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2029542618">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510306628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306628">(Apr 04 2025 at 23:22)</a>:</h4>
<p><strong>cfallin</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a> as ready for review.</p>



<a name="510306820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510306820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510306820">(Apr 04 2025 at 23:24)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2779894678">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>@fitzgen I think I've addressed everything except for the unresolved comments above (see comments, happy to take suggestions). I think #10502 also needs a review (Alex deferred to you per [here]https://github.com/bytecodealliance/wasmtime/pull/10502#pullrequestreview-2733680435); I'll make the update that Ulrich suggests in a separate commit). Thanks!</p>
</blockquote>



<a name="510309126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510309126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510309126">(Apr 04 2025 at 23:51)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510309228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510309228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510309228">(Apr 04 2025 at 23:52)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2779914127">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>Rebased on top of latest #10502 (and had to squash the stack of review-feedback commits to avoid too many conflicts-at-every-step but they're still at <a href="https://github.com/bytecodealliance/wasmtime/commit/8f95de2101c6bfd5b72ba2e2c74f2b7ecff5615a">this branch</a>)</p>
</blockquote>



<a name="510309382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510309382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510309382">(Apr 04 2025 at 23:54)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510309383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510309383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510309383">(Apr 04 2025 at 23:54)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510309384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510309384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510309384">(Apr 04 2025 at 23:54)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510730140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510730140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510730140">(Apr 07 2025 at 17:34)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2747585366">PR review</a>.</p>



<a name="510730141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510730141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510730141">(Apr 07 2025 at 17:34)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2031700890">PR review comment</a>:</p>
<blockquote>
<p>Ah yeah, I wish we could provide default type parameters for functions too, not just types. Oh well.</p>
</blockquote>



<a name="510730207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510730207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510730207">(Apr 07 2025 at 17:34)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2747586098">PR review</a>.</p>



<a name="510730212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510730212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510730212">(Apr 07 2025 at 17:34)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2031701339">PR review comment</a>:</p>
<blockquote>
<p>Sure thing, thanks</p>
</blockquote>



<a name="510730399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510730399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510730399">(Apr 07 2025 at 17:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2747588344">PR review</a>.</p>



<a name="510730400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510730400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510730400">(Apr 07 2025 at 17:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2031702789">PR review comment</a>:</p>
<blockquote>
<p>That seems fair. Figuring out a good place to document this for users is going to be annoying.</p>
</blockquote>



<a name="510733418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510733418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510733418">(Apr 07 2025 at 17:51)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2747606299">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="510733420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510733420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510733420">(Apr 07 2025 at 17:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2031715809">PR review comment</a>:</p>
<blockquote>
<p>And then somewhere around here is where we would actually implement that check.</p>
</blockquote>



<a name="510733421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510733421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510733421">(Apr 07 2025 at 17:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2031714029">PR review comment</a>:</p>
<blockquote>
<p>Since we are only defining the exception registers for the <code>tail</code> calling convention, can we also check that <code>try_call</code>ing a function of a different calling convention triggers verifier errors? At least for now, we can always loosen this later and document the registers used for other conventions at that point. I double checked the <code>try_call.clif</code> verifier filetest and didn't see a case for this there.</p>
</blockquote>



<a name="510780535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510780535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510780535">(Apr 07 2025 at 22:55)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510783718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510783718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510783718">(Apr 07 2025 at 23:23)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510785161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785161">(Apr 07 2025 at 23:36)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510785182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785182">(Apr 07 2025 at 23:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2748327025">PR review</a>.</p>



<a name="510785183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785183">(Apr 07 2025 at 23:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2032148444">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510785191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785191">(Apr 07 2025 at 23:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2748327130">PR review</a>.</p>



<a name="510785192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785192">(Apr 07 2025 at 23:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2032148535">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="510785399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785399">(Apr 07 2025 at 23:39)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2784866568">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>Thanks! All addressed; while looking over it I noticed I still had <code>try_call_indirect</code> lowerings as a TODO and added the ~20 lines of final plumbing to wire it up. Separated that as last commit and wanted to flag before merging -- lemme know if good.</p>
</blockquote>



<a name="510785673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785673">(Apr 07 2025 at 23:41)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510785867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510785867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510785867">(Apr 07 2025 at 23:43)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2748337540">PR review</a>.</p>



<a name="510786088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510786088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510786088">(Apr 07 2025 at 23:45)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510790239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510790239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510790239">(Apr 08 2025 at 00:23)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>.</p>



<a name="510914614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510914614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510914614">(Apr 08 2025 at 12:08)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2786224329">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>Hi @cfallin , I'm looking to implement this for s390x, and I'm a bit confused about the two (different?) SigRef's in play in <code>gen_try_call</code>: one passed as direct argument, and one taken from the <code>et</code>.   Which one is supposed to be used when?  The current code mixed them in unexpected ways:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">caller_conv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">lower_ctx</span><span class="p">.</span><span class="n">abi</span><span class="p">().</span><span class="n">call_conv</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">lower_ctx</span><span class="p">.</span><span class="n">sigs</span><span class="p">());</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">sigref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">lower_ctx</span><span class="p">.</span><span class="n">dfg</span><span class="p">().</span><span class="n">exception_tables</span><span class="p">[</span><span class="n">et</span><span class="p">].</span><span class="n">signature</span><span class="p">();</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">lower_ctx</span><span class="p">.</span><span class="n">dfg</span><span class="p">().</span><span class="n">signatures</span><span class="p">[</span><span class="n">sigref</span><span class="p">];</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">num_rets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sig</span><span class="p">.</span><span class="n">returns</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="cp">$abicaller</span><span class="o">&gt;</span><span class="p">::</span><span class="n">from_func</span><span class="p">(</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">lower_ctx</span><span class="p">.</span><span class="n">sigs</span><span class="p">(),</span>
<span class="w">                </span><span class="n">sig_ref</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">extname</span><span class="p">,</span>
<span class="w">                </span><span class="n">IsTailCall</span><span class="p">::</span><span class="n">No</span><span class="p">,</span>
<span class="w">                </span><span class="n">dist</span><span class="p">,</span>
<span class="w">                </span><span class="n">caller_conv</span><span class="p">,</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">backend</span><span class="p">.</span><span class="n">flags</span><span class="p">().</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">            </span><span class="p">);</span>
</code></pre></div>
<p>Why do we compute <code>num_rets</code> from one <code>SigRef</code> but pass the other to <code>from_func</code>?   Also, why is this handled differently between <code>gen_try_call</code> and <code>gen_try_call_indirect</code> ?<br>
</p>
</blockquote>



<a name="510953317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510953317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510953317">(Apr 08 2025 at 14:42)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750262516">PR review</a>.</p>



<a name="510953319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510953319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510953319">(Apr 08 2025 at 14:42)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033361367">PR review comment</a>:</p>
<blockquote>
<p>FWIW I had put it in <code>MachCallSite</code> instead, but this should also work fine.</p>
</blockquote>



<a name="510954737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510954737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510954737">(Apr 08 2025 at 14:48)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750287248">PR review</a>.</p>



<a name="510954751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510954751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510954751">(Apr 08 2025 at 14:48)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033373454">PR review comment</a>:</p>
<blockquote>
<p>Cranelift doesn't care about this, right? Only the embedder should care. I don't see why they can't choose to do a different assignment, so should this really be documented and there be a <code>PackedOption</code> around the <code>ExceptionTag</code>. Wasmtime could assign exception tag 0 to the catch-all handler, right?</p>
</blockquote>



<a name="510955128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510955128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510955128">(Apr 08 2025 at 14:49)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750292041">PR review</a>.</p>



<a name="510955130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510955130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510955130">(Apr 08 2025 at 14:49)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033376519">PR review comment</a>:</p>
<blockquote>
<p>This isn't currently checked by the verifier, right? It probably should be.</p>
</blockquote>



<a name="510956054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510956054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510956054">(Apr 08 2025 at 14:53)</a>:</h4>
<p>bjorn3 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033376519">PR review comment</a>.</p>



<a name="510956427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510956427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510956427">(Apr 08 2025 at 14:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750308753">PR review</a>.</p>



<a name="510956428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510956428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510956428">(Apr 08 2025 at 14:54)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033386802">PR review comment</a>:</p>
<blockquote>
<p>Why are all registers clobbered for <code>try_call</code>? For regular systemv unwinding, all callee saved registers are preserved on the unwind path too.</p>
</blockquote>



<a name="510973797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510973797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510973797">(Apr 08 2025 at 16:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750580633">PR review</a>.</p>



<a name="510973798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510973798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510973798">(Apr 08 2025 at 16:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033547517">PR review comment</a>:</p>
<blockquote>
<p>Right, I suppose the alternative is to give the embedder a raw <code>u32</code> to plumb through, or let it assign a special sentinel value by convention; I guess one advantage of this approach is that it distinguishes the tags in CLIF so they aren't just bare integers.</p>
</blockquote>



<a name="510974371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510974371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510974371">(Apr 08 2025 at 16:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750589096">PR review</a>.</p>



<a name="510974373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510974373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510974373">(Apr 08 2025 at 16:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033552840">PR review comment</a>:</p>
<blockquote>
<p>Ah, yes, this came out of our discussions regarding the Wasmtime side of the implementation: we didn't want to have to require all registers to be saved and accessible in all trampolines out to the host as a starting-point for the unwind register state (otherwise we are penalizing. all existing programs when the feature is turned on); and we didn't necessarily want to have the unwind-info be load-bearing for correctness. With this approach we can restart at the catch-point without having to set up any register state other than the payload.</p>
<p>This could definitely become a codegen flag for use in native code; not doing that is just an oversight in the initial PR, sorry. I'd be happy to review a PR for that!</p>
</blockquote>



<a name="510980249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510980249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510980249">(Apr 08 2025 at 16:39)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2750689279">PR review</a>.</p>



<a name="510980250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/510980250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#510980250">(Apr 08 2025 at 16:39)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033610908">PR review comment</a>:</p>
<blockquote>
<p>It would be possible to make <code>ExceptionTag</code> a wrapper around a u32 without niche, right?</p>
</blockquote>



<a name="511012773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/511012773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#511012773">(Apr 08 2025 at 19:43)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2751212066">PR review</a>.</p>



<a name="511012775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/511012775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#511012775">(Apr 08 2025 at 19:43)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2033914102">PR review comment</a>:</p>
<blockquote>
<p>It would have been nice if this accepted <code>impl IntoIterator&lt;Item = BlockArg&gt;</code>. <code>BlockArg</code> is <code>Copy</code>, so you can use <code>.copied()</code> on the iterator if necessary to convert from an <code>&amp;BlockArg</code> to a <code>BlockArg</code> iterator. However if you are trying to build the <code>BlockArgs</code>s on the fly, you are forced to collect them into a <code>Vec</code> before passing it to <code>block_call</code> with the current function signature.</p>
</blockquote>



<a name="511023432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/511023432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#511023432">(Apr 08 2025 at 20:51)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2787632143">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>Hi @uweigand,</p>
<blockquote>
<p>Why do we compute <code>num_rets</code> from one <code>SigRef</code> but pass the other to <code>from_func</code>? Also, why is this handled differently between <code>gen_try_call</code> and <code>gen_try_call_indirect</code> ?</p>
</blockquote>
<p>I think this is just an oversight, sorry! The signature ID needs to be in the exception table because <code>TryCallIndirect</code> doesn't have space in the <code>InstructionData</code> directly for the ID, as the <code>CallIndirect</code> case does. IMHO we should uniformly use the version from the exception table in both <code>try_call</code> and <code>try_call_indirect</code> handling (and thus not take a separate parameter). In the direct-call case, the verifier checks that the exception table's sigref matches the called function's signature, so it should be fine no matter the source we use.</p>
</blockquote>



<a name="511023493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/511023493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#511023493">(Apr 08 2025 at 20:51)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#issuecomment-2787633112">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10510">PR #10510</a>:</p>
<blockquote>
<p>(And: please feel free to update this as you need to when building out s390x support for this!)</p>
</blockquote>



<a name="511023798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/511023798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#511023798">(Apr 08 2025 at 20:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#pullrequestreview-2751373023">PR review</a>.</p>



<a name="511023801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310510%20Cranelift%3A%20initial%20try_call%20/%20try_ca.../near/511023801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310510.20Cranelift.3A.20initial.20try_call.20.2F.20try_ca.2E.2E.2E.html#511023801">(Apr 08 2025 at 20:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/10510#discussion_r2034014368">PR review comment</a>:</p>
<blockquote>
<p>IIRC, this was necessary to allow <code>&amp;[a, b]</code>-style arg-lists, which are everywhere in other crates in-repo, to continue to work. Although now that I think about it, I suppose just <code>[a, b]</code> might work with <code>Item = BlockArg</code>. I don't have strong feelings here and I'm happy to review a PR if you can find a way to make it nicer (including with existing callsites)...</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>