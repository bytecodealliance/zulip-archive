<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11449 Expose pooling allocator runtime ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311449.20Expose.20pooling.20allocator.20runtime.20.2E.2E.2E.html">wasmtime / issue #11449 Expose pooling allocator runtime ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="534976614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311449%20Expose%20pooling%20allocator%20runtime%20.../near/534976614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311449.20Expose.20pooling.20allocator.20runtime.20.2E.2E.2E.html#534976614">(Aug 18 2025 at 15:35)</a>:</h4>
<p>lann opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11449">issue #11449</a>:</p>
<blockquote>
<blockquote>
<p>This is similar to #2640 but is about pull rather than push metrics.</p>
</blockquote>
<p>The pooling allocator has <a href="https://docs.rs/wasmtime/35.0.0/wasmtime/struct.PoolingAllocationConfig.html">a bunch of configurable limits</a>. It can be difficult to understand the runtime behavior of a system to decide how to tune those limits, so it would be helpful to expose some runtime metrics to embedders.</p>
<p>For the API, we could crib from <a href="https://docs.rs/tokio/1.47.1/tokio/runtime/struct.Runtime.html#method.metrics">tokio</a> with something like <code>Engine::metrics(&amp;self) -&gt; RuntimeMetrics</code> and <code>RuntimeMetrics::pooling_allocator_live_core_instances(&amp;self) -&gt; u64</code>.</p>
<p>I've been looking at the allocator code and I think I have a rough understanding of how to implement what I'm most interested in:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasmtime/src/runtime/vm/instance/allocator/pooling.rs#L304-L305"><code>live_core_instances</code> and <code>live_component_instances</code></a>: these are already atomics so should be straightforward to report</li>
<li>Used memory slots: I _think_ the used slot count can be derived from the <a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasmtime/src/runtime/vm/instance/allocator/pooling/memory_pool.rs#L82">stripe allocator(s)</a>. That approach would require taking a <code>Mutex</code> which seems OK in this context as long as metrics reporting frequency is limited. Alternatively the used slot count could be tracked separately in a new atomic.</li>
<li>Used table slots: looks like the same story as <code>MemoryPoll</code>, potentially tracking via the <a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasmtime/src/runtime/vm/instance/allocator/pooling/table_pool.rs#L20">allocator</a></li>
</ul>
</blockquote>



<a name="534993135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311449%20Expose%20pooling%20allocator%20runtime%20.../near/534993135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311449.20Expose.20pooling.20allocator.20runtime.20.2E.2E.2E.html#534993135">(Aug 18 2025 at 17:26)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/11449#issuecomment-3197804698">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11449">issue #11449</a>:</p>
<blockquote>
<p>Sounds like a very reasonable design to me! The only thing I'd to a minor bikeshed on is something like <code>Engine::pooling_allocator_metrics(&amp;self) -&gt; Option&lt;PoolingAllocatorMetrics&gt;</code> to handle the defaults-vs-pooling distinction. A general <code>Engine::metrics</code> could focus on generic things like instance count perhaps which makes sense to track for all allocators instead of just pooling.</p>
</blockquote>



<a name="535717407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311449%20Expose%20pooling%20allocator%20runtime%20.../near/535717407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311449.20Expose.20pooling.20allocator.20runtime.20.2E.2E.2E.html#535717407">(Aug 22 2025 at 16:25)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/11449">issue #11449</a>:</p>
<blockquote>
<blockquote>
<p>This is similar to #2640 but is about pull rather than push metrics.</p>
</blockquote>
<p>The pooling allocator has <a href="https://docs.rs/wasmtime/35.0.0/wasmtime/struct.PoolingAllocationConfig.html">a bunch of configurable limits</a>. It can be difficult to understand the runtime behavior of a system to decide how to tune those limits, so it would be helpful to expose some runtime metrics to embedders.</p>
<p>For the API, we could crib from <a href="https://docs.rs/tokio/1.47.1/tokio/runtime/struct.Runtime.html#method.metrics">tokio</a> with something like <code>Engine::metrics(&amp;self) -&gt; RuntimeMetrics</code> and <code>RuntimeMetrics::pooling_allocator_live_core_instances(&amp;self) -&gt; u64</code>.</p>
<p>I've been looking at the allocator code and I think I have a rough understanding of how to implement what I'm most interested in:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasmtime/src/runtime/vm/instance/allocator/pooling.rs#L304-L305"><code>live_core_instances</code> and <code>live_component_instances</code></a>: these are already atomics so should be straightforward to report</li>
<li>Used memory slots: I _think_ the used slot count can be derived from the <a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasmtime/src/runtime/vm/instance/allocator/pooling/memory_pool.rs#L82">stripe allocator(s)</a>. That approach would require taking a <code>Mutex</code> which seems OK in this context as long as metrics reporting frequency is limited. Alternatively the used slot count could be tracked separately in a new atomic.</li>
<li>Used table slots: looks like the same story as <code>MemoryPoll</code>, potentially tracking via the <a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasmtime/src/runtime/vm/instance/allocator/pooling/table_pool.rs#L20">allocator</a></li>
</ul>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>