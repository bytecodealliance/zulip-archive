<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11785 Revert &quot;Constant propagation opts (#... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html">wasmtime / PR #11785 Revert &quot;Constant propagation opts (#...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="542979131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542979131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542979131">(Oct 03 2025 at 16:08)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11785">PR #11785</a> from <code>alexcrichton:revert</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This reverts #11748 as fuzzing turned up a differential execution error which bisected to this PR. The original failing test case is:</p>
<p>&lt;details&gt;</p>
<p>&lt;summary&gt;&lt;code&gt;testcase0.wat&lt;/code&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(module
  (type (;0;) (func (param i32 i32) (result i32)))
  (global (;0;) (mut i32) i32.const 0)
  (global (;1;) (mut i32) i32.const 1000)
  (export "r_ coatin-1not r e*_e*A__se*r  ,r,r_ coatin-1not r e*_e*A__se*_," (func 0))
  (export "r,r_ coatin-1not r e*_,r,rt_co ain-1not r  _ coatin-1not r e*\u{1f},r,rt_co ain-1not r  ,_,r,r_ ocatin-0not r  ,r,r_ " (global 0))
  (elem (;0;) func)
  (func (;0;) (type 0) (param i32 i32) (result i32)
    global.get 1
    i32.eqz
    if ;; label = @1
      unreachable
    end
    global.get 1
    i32.const 1
    i32.sub
    global.set 1
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.popcnt
    i32.extend8_s
    i32.popcnt
    i64.extend_i32_u
    i64.clz
    i64.clz
    i64.extend8_s
    i32.const -131072
    local.tee 1
    i32.extend8_s
    i32.popcnt
    local.set 0
    i64.extend8_s
    local.get 1
    i32.extend8_s
    local.get 0
    i32.lt_s
    i64.extend_i32_u
    i64.popcnt
    i64.shr_u
    local.get 0
    local.set 0
    i32.const 825060969
    local.get 0
    i32.lt_s
    local.set 0
    i64.ctz
    i64.clz
    i64.ctz
    elem.drop 0
    i64.clz
    i64.ctz
    elem.drop 0
    i64.ctz
    i32.const -513
    local.get 1
    i32.xor
    local.set 1
    local.get 0
    i64.extend_i32_u
    i64.or
    i64.extend8_s
    i64.ctz
    local.get 1
    i64.extend_i32_u
    i64.shr_s
    i64.clz
    i64.extend8_s
    i32.const -131072
    local.tee 1
    i32.extend8_s
    i32.extend8_s
    local.set 0
    i32.const 825060969
    local.get 0
    i32.lt_s
    local.set 0
    i64.extend8_s
    local.get 1
    i32.extend8_s
    local.get 0
    i32.lt_s
    i32.ctz
    i32.extend8_s
    i64.extend_i32_u
    i64.gt_s
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    i32.popcnt
    i64.extend_i32_u
    i64.clz
    i64.clz
    i64.extend8_s
    i64.extend8_s
    elem.drop 0
    i64.extend8_s
    local.get 1
    i32.extend8_s
    local.get 0
    i32.lt_s
    i32.ctz
    i32.extend8_s
    i64.extend_i32_u
    i64.gt_s
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    i32.popcnt
    i64.extend_i32_u
    i64.clz
    i64.clz
    i64.extend8_s
    i64.extend8_s
    elem.drop 0
    i64.extend8_s
    local.get 1
    i32.extend8_s
    local.get 0
    i32.lt_s
    i32.ctz
    i32.extend8_s
    i64.extend_i32_u
    i64.gt_s
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    local.set 1
    local.get 1
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    i32.lt_s
    local.set 0
    local.get 1
    local.set 0
    local.get 1
    i32.popcnt
    i32.extend8_s
    i32.extend8_s
    i32.popcnt
    i64.extend_i32_u
    i64.clz
    i64.clz
    i64.extend8_s
    i64.extend8_s
    elem.drop 0
    i64.extend8_s
    local.get 1
    i32.extend8_s
    local.get 0
    i32.lt_s
    i32.ctz
    i32.extend8_s
    i64.extend_i32_u
    i64.gt_s
    local.get 1
    i32.xor
    local.set 0
    local.get 0
    local.set 0
    i32.const 808283753
    local.get 0
    global.get 0
    i32.xor
    global.set 0
  )

  (func (export "x")  (result i32)
      i32.const -1 i32.const -1
      call 0
      drop
      global.get 0)
)
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>and <code>wasm-tools shrink</code>-minimized version is attached to this PR as a regression test as well.</p>
</blockquote>



<a name="542979136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542979136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542979136">(Oct 03 2025 at 16:08)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11785">PR #11785</a>.</p>



<a name="542979137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542979137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542979137">(Oct 03 2025 at 16:08)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11785">PR #11785</a>.</p>



<a name="542979138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542979138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542979138">(Oct 03 2025 at 16:08)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11785">PR #11785</a>.</p>



<a name="542979848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542979848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542979848">(Oct 03 2025 at 16:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11785#pullrequestreview-3299776159">PR review</a>:</p>
<blockquote>
<p>Thanks for triaging!</p>
</blockquote>



<a name="542979867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542979867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542979867">(Oct 03 2025 at 16:12)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11785">PR #11785</a>.</p>



<a name="542985946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311785%20Revert%20%22Constant%20propagation%20opts%20%28%23.../near/542985946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311785.20Revert.20.22Constant.20propagation.20opts.20.28.23.2E.2E.2E.html#542985946">(Oct 03 2025 at 16:44)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11785">PR #11785</a>.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>