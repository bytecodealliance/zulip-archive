<html>
<head><meta charset="utf-8"><title>wasmtime / issue #12172 Windows symlink oddness · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html">wasmtime / issue #12172 Windows symlink oddness</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="564051110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564051110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564051110">(Dec 16 2025 at 14:11)</a>:</h4>
<p>wingo opened <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">issue #12172</a>:</p>
<blockquote>
<p>This simple test fails on Windows:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">process</span><span class="p">;</span>
<span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:filesystem/imports@0.3.0-rc-2025-09-16;</span>
<span class="s">      include wasi:cli/command@0.3.0-rc-2025-09-16;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span>
<span class="w">    </span><span class="n">additional_derives</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nb">PartialEq</span><span class="p">,</span><span class="w"> </span><span class="nb">Eq</span><span class="p">,</span><span class="w"> </span><span class="n">Hash</span><span class="p">,</span><span class="w"> </span><span class="nb">Clone</span><span class="p">],</span>
<span class="w">    </span><span class="c1">// Work around https://github.com/bytecodealliance/wasm-tools/issues/2285.</span>
<span class="w">    </span><span class="n">features</span><span class="p">:[</span><span class="s">"clocks-timezone"</span><span class="p">],</span>
<span class="w">    </span><span class="n">generate_all</span>
<span class="p">});</span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_symlink</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wasi</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">::</span><span class="n">get_directories</span><span class="p">()[</span><span class="o">..</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">[(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">dir</span><span class="p">.</span><span class="n">symlink_at</span><span class="p">(</span><span class="s">".."</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">"t"</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="k">await</span>
<span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">            </span><span class="n">dir</span><span class="p">.</span><span class="n">unlink_file_at</span><span class="p">(</span><span class="s">"t"</span><span class="p">.</span><span class="n">to_string</span><span class="p">()).</span><span class="k">await</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">[</span><span class="o">..</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">"usage: run with one open dir"</span><span class="p">);</span>
<span class="w">            </span><span class="n">process</span><span class="p">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Component</span><span class="p">;</span>
<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Component</span><span class="p">);</span>
<span class="k">impl</span><span class="w"> </span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">run</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">test_symlink</span><span class="p">().</span><span class="k">await</span><span class="p">;</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">unreachable!</span><span class="p">(</span><span class="s">"main is a stub"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The issue is that creating a symlink to <code>..</code> doesn't work and fails with <code>EPERM</code>, whereas on POSIX platforms any permission check is only made when dereferencing the symlink.</p>
<p>Similarly, <code>ln_s("does-not-exist".to_string(), "whatever".to_string).await.unwrap()</code> fails on Windows with <code>ENOENT</code>.  I can make a symlink to a file that does exist, however.  I only tested via CI, on <a href="https://github.com/WebAssembly/wasi-testsuite/pull/195">https://github.com/WebAssembly/wasi-testsuite/pull/195</a>.</p>
<p>What's going on?  Is this another area of WASI in which we have to relax the requirements?</p>
</blockquote>



<a name="564051112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564051112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564051112">(Dec 16 2025 at 14:11)</a>:</h4>
<p><a href="https://github.com/wingo">wingo</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">Issue #12172</a>.</p>



<a name="564262603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564262603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564262603">(Dec 17 2025 at 14:17)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/12172#issuecomment-3665566725">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">issue #12172</a>:</p>
<blockquote>
<p>More oddness:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="n">dir</span><span class="p">.</span><span class="n">create_directory_at</span><span class="p">(</span><span class="s">"child.cleanup"</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="k">await</span>
<span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">            </span><span class="n">dir</span><span class="p">.</span><span class="n">symlink_at</span><span class="p">(</span><span class="s">"../a.txt"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">"child.cleanup/b"</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="k">await</span>
<span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<p>I.e. I can't symlink to a file from a parent directory?  Works on POSIX, whether making the symlink from the parent (as above) or from the child.</p>
</blockquote>



<a name="564515119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564515119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564515119">(Dec 18 2025 at 17:07)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasi:impl label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">Issue #12172</a>.</p>



<a name="564515122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564515122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564515122">(Dec 18 2025 at 17:07)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasi:tests label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">Issue #12172</a>.</p>



<a name="564515123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564515123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564515123">(Dec 18 2025 at 17:07)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the wasi label to <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">Issue #12172</a>.</p>



<a name="564534933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2312172%20Windows%20symlink%20oddness/near/564534933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2312172.20Windows.20symlink.20oddness.html#564534933">(Dec 18 2025 at 18:42)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/12172#issuecomment-3671685026">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/12172">issue #12172</a>:</p>
<blockquote>
<p>I know very little about Windows symlinks myself but I wouldn't be surprised if they're different from unix-style symlinks in subtle and surprising ways. Similar to <a href="https://github.com/bytecodealliance/wasmtime/issues/12178#issuecomment-3671670651">this</a> I don't think we have much recourse other than acknolwedging the reality that symlinks are the same at 10k feet but implemented entirely differently under the hood.</p>
</blockquote>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>