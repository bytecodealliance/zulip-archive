<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10119 `wasmtime_wasi::bindings` compila... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html">wasmtime / issue #10119 `wasmtime_wasi::bindings` compila...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="496023568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496023568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496023568">(Jan 27 2025 at 02:13)</a>:</h4>
<p><a href="https://github.com/robherley">robherley</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">Issue #10119</a>.</p>



<a name="496023570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496023570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496023570">(Jan 27 2025 at 02:13)</a>:</h4>
<p>robherley opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>I have a minimal repro in this repository: <a href="https://github.com/robherley/wasmtime-bindgen-repro">https://github.com/robherley/wasmtime-bindgen-repro</a></p>
<h3>Steps to Reproduce</h3>
<ol>
<li>
<p>Follow the example from wasmtime-wasi crate: <br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41">https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41</a></p>
</li>
<li>
<p>Attempt to compile.</p>
</li>
<li>Error, need to <code>cargo expand</code> (see my <a href="https://github.com/robherley/wasmtime-bindgen-repro/blob/main/tmp/expanded.rs"><code>expanded.rs</code></a>) or add <code>include_generated_code_from_file: true</code> to the macro.</li>
</ol>
<h3>Expected Results</h3>
<p>The generated binding have the correction function signatures.</p>
<h3>Actual Results</h3>
<p>&lt;img width="1040" alt="Image" src="<a href="https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640">https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640</a>" /&gt;</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <code>29.0.1</code></p>
<p>Operating system: <code>macOS 15.1.1</code></p>
<p>Architecture: <code>arm64</code></p>
<h3>Extra Info</h3>
<p>The only affected bindings are:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">__with_name0</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">exit</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="n">get</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="n">__with_name0</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">network</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="n">get</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
<p>Which are missing <code>&amp;wasmtime_wasi::bindings::cli::exit::LinkOptions</code> and <code>&amp;wasmtime_wasi::bindings::sockets::network::LinkOptions</code></p>
</blockquote>



<a name="496023973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496023973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496023973">(Jan 27 2025 at 02:17)</a>:</h4>
<p>robherley <a href="https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2614734031">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<p>I'm guessing this is related to runtime feature-gated options:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/wasmtime/pull/9381">https://github.com/bytecodealliance/wasmtime/pull/9381</a></li>
</ul>
<blockquote>
<p>Instead, the generated add_to_linker*** functions take an additional LinkOptions parameter if the world/interface has any unstable features.</p>
</blockquote>
</blockquote>



<a name="496184330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496184330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496184330">(Jan 27 2025 at 18:10)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616547988">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<p>Thanks for the report! I think the problem may lie in your original WIT files perhaps? Looking at <a href="https://github.com/robherley/wasmtime-bindgen-repro/blob/main/wit/deps/wasi-cli-0.2.3/package.wit">https://github.com/robherley/wasmtime-bindgen-repro/blob/main/wit/deps/wasi-cli-0.2.3/package.wit</a> I don't see exit-with-code which is a feature-gated API, which means that the two bindgens are starting from different WITs?</p>
</blockquote>



<a name="496212799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496212799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496212799">(Jan 27 2025 at 21:13)</a>:</h4>
<p>robherley <a href="https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616907241">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> @alexcrichton Thanks for following up so fast! It does look like the wit does not match the bindings provided by <code>wasmtime_wasi</code> crate. </p>
<p>But, I resolved my <code>.wit</code> files from <a href="https://github.com/bytecodealliance/wasm-pkg-tools">wkg</a>:</p>
<p>&lt;img width="576" alt="Image" src="<a href="https://github.com/user-attachments/assets/e1f5f678-d577-4da3-81bb-49be3f91ada0">https://github.com/user-attachments/assets/e1f5f678-d577-4da3-81bb-49be3f91ada0</a>" /&gt;</p>
<p>Which is odd, since the resolved version of <code>wasi-cli-0.2.3</code> doesn't seem to have <code>exit-with-code</code>? </p>
<p>Even if I run:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wkg</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">@</span><span class="mf">0.2.3</span>
<span class="n">cat</span><span class="w"> </span><span class="n">wasi_cli</span><span class="o">@</span><span class="mf">0.2.3.</span><span class="n">wit</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">exit</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">code</span>
</code></pre></div>
<p>There is no reference to the <code>@unstable(feature = cli-exit-with-code)</code>.</p>
<p>Is the version of <code>wasi:cli</code> on the registry incorrect? Or is there something else I'm misunderstanding</p>
</blockquote>



<a name="496213946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496213946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496213946">(Jan 27 2025 at 21:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616922146">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<p>I think the issue might like with <code>wkg</code> yeah, there's some subtelties around handling WIT and features which might need some patching. Mind opening an issue over there and cc'ing me?</p>
</blockquote>



<a name="496214625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496214625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496214625">(Jan 27 2025 at 21:27)</a>:</h4>
<p>robherley closed <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>I have a minimal repro in this repository: <a href="https://github.com/robherley/wasmtime-bindgen-repro">https://github.com/robherley/wasmtime-bindgen-repro</a></p>
<h3>Steps to Reproduce</h3>
<ol>
<li>
<p>Follow the example from wasmtime-wasi crate: <br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41">https://github.com/bytecodealliance/wasmtime/blob/58282df898d79a787a726d829b166272dde155b9/crates/wasi/src/bindings.rs#L39-L41</a></p>
</li>
<li>
<p>Attempt to compile.</p>
</li>
<li>Error, need to <code>cargo expand</code> (see my <a href="https://github.com/robherley/wasmtime-bindgen-repro/blob/main/tmp/expanded.rs"><code>expanded.rs</code></a>) or add <code>include_generated_code_from_file: true</code> to the macro.</li>
</ol>
<h3>Expected Results</h3>
<p>The generated binding have the correction function signatures.</p>
<h3>Actual Results</h3>
<p>&lt;img width="1040" alt="Image" src="<a href="https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640">https://github.com/user-attachments/assets/8b20dc15-a59b-491f-84a8-7b6c7a09d640</a>" /&gt;</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <code>29.0.1</code></p>
<p>Operating system: <code>macOS 15.1.1</code></p>
<p>Architecture: <code>arm64</code></p>
<h3>Extra Info</h3>
<p>The only affected bindings are:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">__with_name0</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">exit</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="n">get</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="n">__with_name0</span><span class="p">::</span><span class="n">sockets</span><span class="p">::</span><span class="n">network</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="n">get</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
<p>Which are missing <code>&amp;wasmtime_wasi::bindings::cli::exit::LinkOptions</code> and <code>&amp;wasmtime_wasi::bindings::sockets::network::LinkOptions</code></p>
</blockquote>



<a name="496214629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310119%20%60wasmtime_wasi%3A%3Abindings%60%20compila.../near/496214629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310119.20.60wasmtime_wasi.3A.3Abindings.60.20compila.2E.2E.2E.html#496214629">(Jan 27 2025 at 21:27)</a>:</h4>
<p>robherley <a href="https://github.com/bytecodealliance/wasmtime/issues/10119#issuecomment-2616931463">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10119">issue #10119</a>:</p>
<blockquote>
<p>Totally, I'll close this one out <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>