<html>
<head><meta charset="utf-8"><title>wasmtime / issue #11607 wasip3: unexpected error for mkdi... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html">wasmtime / issue #11607 wasip3: unexpected error for mkdi...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="537690150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537690150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537690150">(Sep 04 2025 at 14:44)</a>:</h4>
<p>wingo opened <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>Consider this test for an open <code>Descriptor</code> on a directory, <code>dirfd</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">dirfd</span><span class="p">.</span><span class="n">create_directory_at</span><span class="p">(</span><span class="s">""</span><span class="p">.</span><span class="n">to_string</span><span class="p">()).</span><span class="k">await</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">Err</span><span class="p">(</span><span class="n">ErrorCode</span><span class="p">::</span><span class="n">Invalid</span><span class="p">));</span>
</code></pre></div>
<p>I think <code>Invalid</code> is the right error.  However instead the error is <code>NoEntry</code>, which corresponds to <a href="https://man7.org/linux/man-pages/man2/statx.2.html#ERRORS">this <code>statx</code> documentation</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="n">ENOENT</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">pathname</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">pathname</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">AT_EMPTY_PATH</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span>
</code></pre></div>
<p>I think that these "at" WASI interfaces should instead avoid syscalling for <code>""</code>, and instead return <code>Invalid</code>.</p>
</blockquote>



<a name="537690152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537690152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537690152">(Sep 04 2025 at 14:44)</a>:</h4>
<p><a href="https://github.com/wingo">wingo</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">Issue #11607</a>.</p>



<a name="537690404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537690404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537690404">(Sep 04 2025 at 14:45)</a>:</h4>
<p>wingo edited <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>Consider this test for an open <code>Descriptor</code> on a directory, <code>dirfd</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">dirfd</span><span class="p">.</span><span class="n">create_directory_at</span><span class="p">(</span><span class="s">""</span><span class="p">.</span><span class="n">to_string</span><span class="p">()).</span><span class="k">await</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">Err</span><span class="p">(</span><span class="n">ErrorCode</span><span class="p">::</span><span class="n">Invalid</span><span class="p">));</span>
</code></pre></div>
<p>I think <code>Invalid</code> is the right error.  However instead the error is <code>NoEntry</code>, which corresponds to <a href="https://man7.org/linux/man-pages/man2/statx.2.html#ERRORS">this <code>statx</code> documentation</a>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="n">ENOENT</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">pathname</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">pathname</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">AT_EMPTY_PATH</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span>
</code></pre></div>
<p>I think that these "at" WASI interfaces should instead avoid syscalling for <code>""</code>, and instead return <code>Invalid</code>.</p>
</blockquote>



<a name="537692685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537692685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537692685">(Sep 04 2025 at 14:57)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3254124241">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>Same issue for <code>stat-at("")</code>, <code>open-at("")</code>, <code>readlink-at("")</code>, <code>remove-directory-at("")</code>, possibly others.</p>
</blockquote>



<a name="537692902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537692902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537692902">(Sep 04 2025 at 14:58)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3254128206">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>For me the solution probably goes through something like <a href="https://github.com/bytecodealliance/wasmtime/issues/11524#issuecomment-3253843726">https://github.com/bytecodealliance/wasmtime/issues/11524#issuecomment-3253843726</a>.</p>
</blockquote>



<a name="537695588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537695588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537695588">(Sep 04 2025 at 15:08)</a>:</h4>
<p>wingo edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3254124241">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>Same issue for <code>stat-at("")</code>, <code>open-at("")</code>, <code>readlink-at("")</code>, <code>remove-directory-at("")</code>, <code>metadata-hash-at("")</code>, possibly others.</p>
</blockquote>



<a name="537745981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537745981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537745981">(Sep 04 2025 at 20:18)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasi:impl label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">Issue #11607</a>.</p>



<a name="537745982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/537745982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#537745982">(Sep 04 2025 at 20:18)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasi label to <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">Issue #11607</a>.</p>



<a name="538310956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/538310956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#538310956">(Sep 08 2025 at 20:36)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3267922068">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>What would be the motivation for returning <code>Invalid</code> here?</p>
<p>wasi-filesystem is unfortunately not an advantageous place to have novel opinions about how filesystem APIs should work, because it is constrained by compatibility requirements with underlying host implementations on one side, and in the expectations of applications on the other. If Linux returns <code>ENOENT</code> for <code>statx</code> and <code>openat</code> and friends when given empty strings, then that makes it more likely to be compatible with existing applications than <code>EINVAL</code>.</p>
</blockquote>



<a name="538362022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/538362022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#538362022">(Sep 09 2025 at 06:50)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3269135609">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p><code>NoEntry</code> to me implies an error originating in the filesystem: some component leading up to the leaf is not present.  However here we have no leaf and in fact no path, and because we don't expose an <code>AT_EMPTY_PATH</code> interface, passing <code>""</code> is simply invalid.  If you were designing it today, <code>Invalid</code> is the right return.</p>
<p>I am sympathetic to the compatibility concern but I think that's more a wasi-libc question; in this case, wasmtime is fabricating the <code>ENOENT</code>, it does not come from the kernel.</p>
</blockquote>



<a name="538842389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/538842389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#538842389">(Sep 11 2025 at 12:14)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3280303700">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>If we use <code>Invalid</code> here, and wish wasi-libc to translate it to <code>ENOENT</code>, then wasi-libc would need to be able to distinguish an <code>Invalid</code> that was caused by an empty path string from an <code>Invalid</code> with any other cause. I suppose that's doable, but it seems awkward to have it redo the error checking the host does.</p>
</blockquote>



<a name="539019032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2311607%20wasip3%3A%20unexpected%20error%20for%20mkdi.../near/539019032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2311607.20wasip3.3A.20unexpected.20error.20for.20mkdi.2E.2E.2E.html#539019032">(Sep 12 2025 at 09:20)</a>:</h4>
<p>wingo <a href="https://github.com/bytecodealliance/wasmtime/issues/11607#issuecomment-3284466056">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/11607">issue #11607</a>:</p>
<blockquote>
<p>Ah, true.  I guess the question is, do you want wasi-libc to translate to <code>ENOENT</code> ?  I didn't think that would be necessary, but I can see the value of wasi-filesystem being as close to POSIX as possible if the goal is to have the thinnest wasi-libc.</p>
<p>You know what, thank you for humoring me here, but posix <code>mkdirat</code> specifies <code>ENOENT</code> for empty-string, so I think I am just barking up the wrong tree: <a href="https://pubs.opengroup.org/onlinepubs/9699919799.2013edition/functions/mkdir.html">https://pubs.opengroup.org/onlinepubs/9699919799.2013edition/functions/mkdir.html</a>.  Propose to close this bug as invalid.</p>
</blockquote>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>