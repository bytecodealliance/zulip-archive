<html>
<head><meta charset="utf-8"><title>wasmtime / PR #11769 Wasmtime: implement debug instrument... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html">wasmtime / PR #11769 Wasmtime: implement debug instrument...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="542401802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401802">(Oct 01 2025 at 03:37)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a> from <code>cfallin:wasmtime-debug-instrumentation</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR implements ideas from the [recent RFC] to serve as the basis<br>
for Wasm (guest) debugging: it adds a stackslot to each function<br>
translated from Wasm, stores to replicate Wasm VM state in the<br>
stackslot as the program runs, and metadata to describe the format of<br>
that state and allow reading it out at runtime.</p>
<p>As an initial user of this state, this PR adds a basic "stack view"<br>
API that, from host code that has been called from Wasm, can examine<br>
Wasm frames currently on the stack and read out all of their locals<br>
and stack slots.</p>
<p>Note in particular that this PR does not include breakpoints,<br>
watchpoints, stepped execution, or any sort of user interface for any<br>
of this; it is only a foundation.</p>
<p>This PR still has a few unsatisfying bits that I intend to address:</p>
<ul>
<li>
<p>The "stack view" performs some O(n) work when the view is initially<br>
  taken, computing some internal data per frame. This is forced by the<br>
  current design of <code>Backtrace</code>, which takes a closure and walks that<br>
  closure over stack frames eagerly (rather than work as an<br>
  iterator). It's got some impressive iterator-chain stuff going on<br>
  internally, so refactoring it to the latter approach might not<br>
  be <em>too</em> bad, but I haven't tackled it yet.</p>
<p>A O(1) stack view, that is, one that does work only for frames as<br>
the host API is used to walk up the stack, is desirable because some<br>
use-cases may want to quickly examine e.g. only the deepest<br>
frame (say, running with a breakpoint condition that needs to read a<br>
particular local's value after each step).</p>
</li>
<li>
<p>It includes a new <code>Config::compiler_force_inlining()</code> option that is<br>
  used only for testing that we get the correct frames after<br>
  inlining. I couldn't get the existing flags to work on a Wasmtime<br>
  config level and suspect there may be an existing bug there; I will<br>
  try to split out a fix for it.</p>
</li>
</ul>
<p>This PR renames the existing <code>debug</code> option to <code>native_debug</code>, to<br>
distinguish it from the new approach.</p>
<p>(Stacked on #11768.)</p>
<p>[recent RFC]: <a href="https://github.com/bytecodealliance/rfcs/pull/44">https://github.com/bytecodealliance/rfcs/pull/44</a></p>
</blockquote>



<a name="542401804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401804">(Oct 01 2025 at 03:37)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542401805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401805">(Oct 01 2025 at 03:37)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542401806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401806">(Oct 01 2025 at 03:37)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542401807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401807">(Oct 01 2025 at 03:37)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542401882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401882">(Oct 01 2025 at 03:38)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3354600020">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>(Marking this as a draft until I resolve the two issues above; posting to show how the Cranelift side is used in practice, in case that's useful.)</p>
</blockquote>



<a name="542401939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542401939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542401939">(Oct 01 2025 at 03:39)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542402129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542402129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542402129">(Oct 01 2025 at 03:41)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542402753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542402753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542402753">(Oct 01 2025 at 03:49)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542403907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542403907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542403907">(Oct 01 2025 at 04:03)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542404088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542404088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542404088">(Oct 01 2025 at 04:05)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542404485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542404485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542404485">(Oct 01 2025 at 04:11)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542404508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542404508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542404508">(Oct 01 2025 at 04:11)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542404862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542404862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542404862">(Oct 01 2025 at 04:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542406885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542406885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542406885">(Oct 01 2025 at 04:41)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542407017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542407017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542407017">(Oct 01 2025 at 04:42)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542409144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542409144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542409144">(Oct 01 2025 at 05:07)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542413611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542413611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542413611">(Oct 01 2025 at 06:01)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542840641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542840641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542840641">(Oct 02 2025 at 22:39)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542841446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542841446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542841446">(Oct 02 2025 at 22:48)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542845306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542845306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542845306">(Oct 02 2025 at 23:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542866610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542866610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542866610">(Oct 03 2025 at 04:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542868731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542868731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542868731">(Oct 03 2025 at 05:03)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>This PR implements ideas from the [recent RFC] to serve as the basis<br>
for Wasm (guest) debugging: it adds a stackslot to each function<br>
translated from Wasm, stores to replicate Wasm VM state in the<br>
stackslot as the program runs, and metadata to describe the format of<br>
that state and allow reading it out at runtime.</p>
<p>As an initial user of this state, this PR adds a basic "stack view"<br>
API that, from host code that has been called from Wasm, can examine<br>
Wasm frames currently on the stack and read out all of their locals<br>
and stack slots.</p>
<p>Note in particular that this PR does not include breakpoints,<br>
watchpoints, stepped execution, or any sort of user interface for any<br>
of this; it is only a foundation.</p>
<p>This PR renames the existing <code>debug</code> option to <code>native_debug</code>, to<br>
distinguish it from the new approach.</p>
<p>(Stacked on #11768 and #11783, and depends on #11784.)</p>
<p>[recent RFC]: <a href="https://github.com/bytecodealliance/rfcs/pull/44">https://github.com/bytecodealliance/rfcs/pull/44</a></p>
</blockquote>



<a name="542868743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542868743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542868743">(Oct 03 2025 at 05:03)</a>:</h4>
<p><strong>cfallin</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a> as ready for review.</p>



<a name="542868985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542868985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542868985">(Oct 03 2025 at 05:06)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3364272510">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Alright, I've rebased this on the latest #11768, and updated it to take an iterator-based approach instead. The borrowing is a little tricky but does work out: we implement a custom iterator up the stack frames (<code>StackView</code>), which owns the store while alive, and a mutable borrow of that iterator must be passed into methods on the objects it returns (<code>FrameView</code>) to actually read values. All of that gives a safe, lazy (<code>O(1)</code>) way of walking the stack.</p>
<p>In #11783 (underlying iterator that this refactor used) I chose not to replicate all of the complex logic to walk all activations and continuation stack-chains; for now, this API walks only the last activation that entered the host. That seems sufficient for a basic debugger application to me, but I can update it as desired.</p>
<p>This is now stacked on #11768 and #11783, and depends on the just-filed #11784 to be resolved somehow.</p>
</blockquote>



<a name="542977246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542977246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542977246">(Oct 03 2025 at 15:58)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="542977921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/542977921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#542977921">(Oct 03 2025 at 16:01)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543022707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543022707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543022707">(Oct 03 2025 at 20:12)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543022794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543022794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543022794">(Oct 03 2025 at 20:13)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>This PR implements ideas from the [recent RFC] to serve as the basis<br>
for Wasm (guest) debugging: it adds a stackslot to each function<br>
translated from Wasm, stores to replicate Wasm VM state in the<br>
stackslot as the program runs, and metadata to describe the format of<br>
that state and allow reading it out at runtime.</p>
<p>As an initial user of this state, this PR adds a basic "stack view"<br>
API that, from host code that has been called from Wasm, can examine<br>
Wasm frames currently on the stack and read out all of their locals<br>
and stack slots.</p>
<p>Note in particular that this PR does not include breakpoints,<br>
watchpoints, stepped execution, or any sort of user interface for any<br>
of this; it is only a foundation.</p>
<p>This PR renames the existing <code>debug</code> option to <code>native_debug</code>, to<br>
distinguish it from the new approach.</p>
<p>(Stacked on #11768, and depends on #11784.)</p>
<p>[recent RFC]: <a href="https://github.com/bytecodealliance/rfcs/pull/44">https://github.com/bytecodealliance/rfcs/pull/44</a></p>
</blockquote>



<a name="543023348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543023348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543023348">(Oct 03 2025 at 20:17)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3367092813">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Rebased on #11783 now that it's landed.</p>
<p>Also a few more refined thoughts on</p>
<blockquote>
<p>I chose not to replicate all of the complex logic to walk all activations and continuation stack-chains; for now, this API walks only the last activation that entered the host. That seems sufficient for a basic debugger application to me, but I can update it as desired.</p>
</blockquote>
<p>I am realizing in building the next step that we probably do want a "debug session" to apply only to one Wasm activation -- if for no other reason than that the API is much more semantically clear when exits back to the host are atomic events rather than somehow "translucent" (host code invisible but nested Wasm invocations visible). And there are weird corner cases where, for example, the recursively invoked host code itself tries to set up a (nested) debug context that we'd want to rule out anyway. So: the limit to introspect only the most recent activation is a feature, not a bug!</p>
</blockquote>



<a name="543399171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543399171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543399171">(Oct 06 2025 at 20:04)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543399311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543399311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543399311">(Oct 06 2025 at 20:05)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3373804917">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>And rebased out #11768 as well; now this only depends on #11784 (either accepting the <code>compiler_force_inlining</code> option added here, or doing something else).</p>
</blockquote>



<a name="543399364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543399364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543399364">(Oct 06 2025 at 20:05)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>This PR implements ideas from the [recent RFC] to serve as the basis<br>
for Wasm (guest) debugging: it adds a stackslot to each function<br>
translated from Wasm, stores to replicate Wasm VM state in the<br>
stackslot as the program runs, and metadata to describe the format of<br>
that state and allow reading it out at runtime.</p>
<p>As an initial user of this state, this PR adds a basic "stack view"<br>
API that, from host code that has been called from Wasm, can examine<br>
Wasm frames currently on the stack and read out all of their locals<br>
and stack slots.</p>
<p>Note in particular that this PR does not include breakpoints,<br>
watchpoints, stepped execution, or any sort of user interface for any<br>
of this; it is only a foundation.</p>
<p>This PR renames the existing <code>debug</code> option to <code>native_debug</code>, to<br>
distinguish it from the new approach.</p>
<p>(Depends on #11784.)</p>
<p>[recent RFC]: <a href="https://github.com/bytecodealliance/rfcs/pull/44">https://github.com/bytecodealliance/rfcs/pull/44</a></p>
</blockquote>



<a name="543412788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543412788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543412788">(Oct 06 2025 at 21:40)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543412826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543412826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543412826">(Oct 06 2025 at 21:40)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>This PR implements ideas from the [recent RFC] to serve as the basis<br>
for Wasm (guest) debugging: it adds a stackslot to each function<br>
translated from Wasm, stores to replicate Wasm VM state in the<br>
stackslot as the program runs, and metadata to describe the format of<br>
that state and allow reading it out at runtime.</p>
<p>As an initial user of this state, this PR adds a basic "stack view"<br>
API that, from host code that has been called from Wasm, can examine<br>
Wasm frames currently on the stack and read out all of their locals<br>
and stack slots.</p>
<p>Note in particular that this PR does not include breakpoints,<br>
watchpoints, stepped execution, or any sort of user interface for any<br>
of this; it is only a foundation.</p>
<p>This PR renames the existing <code>debug</code> option to <code>native_debug</code>, to<br>
distinguish it from the new approach.</p>
<p>[recent RFC]: <a href="https://github.com/bytecodealliance/rfcs/pull/44">https://github.com/bytecodealliance/rfcs/pull/44</a></p>
</blockquote>



<a name="543412866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543412866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543412866">(Oct 06 2025 at 21:40)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3374315080">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Rebased out temporary config fix to #11784 as well now that #11797 merged.</p>
</blockquote>



<a name="543423710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543423710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543423710">(Oct 06 2025 at 23:45)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3374660122">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<h4>Label Messager: wasmtime:config</h4>
<p>It looks like you are changing Wasmtime's configuration options. Make sure to<br>
complete this check list:</p>
<ul>
<li>
<p>[ ] If you added a new <code>Config</code> method, you wrote extensive documentation for<br>
      it.</p>
<p>&lt;details&gt;</p>
<p>Our documentation should be of the following form:</p>
<p>```text<br>
Short, simple summary sentence.</p>
<p>More details. These details can be multiple paragraphs. There should be<br>
information about not just the method, but its parameters and results as<br>
well.</p>
<p>Is this method fallible? If so, when can it return an error?</p>
<p>Can this method panic? If so, when does it panic?</p>
<h1>Example</h1>
<p>Optional example here.<br>
```</p>
<p>&lt;/details&gt;</p>
</li>
<li>
<p>[ ] If you added a new <code>Config</code> method, or modified an existing one, you<br>
  ensured that this configuration is exercised by the fuzz targets.</p>
<p>&lt;details&gt;</p>
<p>For example, if you expose a new strategy for allocating the next instance<br>
slot inside the pooling allocator, you should ensure that at least one of our<br>
fuzz targets exercises that new strategy.</p>
<p>Often, all that is required of you is to ensure that there is a knob for this<br>
configuration option in [<code>wasmtime_fuzzing::Config</code>][fuzzing-config] (or one<br>
of its nested <code>struct</code>s).</p>
<p>Rarely, this may require authoring a new fuzz target to specifically test this<br>
configuration. See [our docs on fuzzing][fuzzing-docs] for more details.</p>
<p>&lt;/details&gt;</p>
</li>
<li>
<p>[ ] If you are enabling a configuration option by default, make sure that it<br>
  has been fuzzed for at least two weeks before turning it on by default.</p>
</li>
</ul>
<p>[fuzzing-config]: <a href="https://github.com/bytecodealliance/wasmtime/blob/ca0e8d0a1d8cefc0496dba2f77a670571d8fdcab/crates/fuzzing/src/generators.rs#L182-L194">https://github.com/bytecodealliance/wasmtime/blob/ca0e8d0a1d8cefc0496dba2f77a670571d8fdcab/crates/fuzzing/src/generators.rs#L182-L194</a><br>
[fuzzing-docs]: <a href="https://docs.wasmtime.dev/contributing-fuzzing.html">https://docs.wasmtime.dev/contributing-fuzzing.html</a></p>
<hr>
<p>&lt;details&gt;</p>
<p>To modify this label's message, edit the &lt;code&gt;.github/label-messager/wasmtime-config.md&lt;/code&gt; file.</p>
<p>To add new label messages or remove existing label messages, edit the<br>
&lt;code&gt;.github/label-messager.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/label-messager-action">Learn more.</a></p>
<p>&lt;/details&gt;</p>
</blockquote>



<a name="543632199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632199">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3307857894">PR review</a>:</p>
<blockquote>
<p>These are some initial thoughts I had from reading this last night and just now. I wanted to take a closer look at <code>debug.rs</code> but I stopped once I realized that I think the current API proposed here is unsound. Assuming you agree with my comment below I'll take another look once it's updated.</p>
</blockquote>



<a name="543632202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632202">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408976992">PR review comment</a>:</p>
<blockquote>
<p>Could this go in <code>before_translate_operator</code> rather than being an additional "before" hook?</p>
</blockquote>



<a name="543632203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632203">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408978412">PR review comment</a>:</p>
<blockquote>
<p>Would it make sense to store this in <code>stack</code> directly? That'd avoid the need to always try to keep the two in sync</p>
</blockquote>



<a name="543632204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632204">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408985429">PR review comment</a>:</p>
<blockquote>
<p>Is this safety comment still relevant? Naively I'd expect this to be a safe function since getting a backtrace of a store should always be a safe operation</p>
</blockquote>



<a name="543632205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632205">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408996074">PR review comment</a>:</p>
<blockquote>
<p>Passing thought about this -- how do stack maps come into play here with GC? E.g. if we implement a moving GC, wouldn't all of these values need to be roots for the GC? </p>
</blockquote>



<a name="543632206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632206">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408975043">PR review comment</a>:</p>
<blockquote>
<p>This is technically a breaking change for the CLI and our existing documentation around this. I don't have a great idea of what to do instead, but I'm wary of breaking existing users of our debug info without prior warning</p>
</blockquote>



<a name="543632207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632207">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2409001240">PR review comment</a>:</p>
<blockquote>
<p>s/EXTERNREF/FUNCREF/</p>
</blockquote>



<a name="543632208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632208">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408980130">PR review comment</a>:</p>
<blockquote>
<p>Instead of duplicating this check from below, could this be refactored either into a loop outside of this conditional or some sort of helper method?</p>
</blockquote>



<a name="543632209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632209">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408990677">PR review comment</a>:</p>
<blockquote>
<p>If <code>debug</code> is the default here, should it also be in the default list for the <code>wasmtime</code> crate?</p>
</blockquote>



<a name="543632210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632210">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2409003071">PR review comment</a>:</p>
<blockquote>
<p>This scoping seems like something we'll want to change perhaps? For example maybe the entire iterator holds <code>AutoAssertNoGc</code>? It seems like if a GC happened in the middle of a stack walk that things would probably go bad...</p>
<p>There's also the question of the scope that these rooted values are pushed onto. It seems like that should be a pseudo-requirement of a caller? Or maybe just documented? I'm not sure if there's too much we can do to help this from a caller's perspective...</p>
</blockquote>



<a name="543632211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632211">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2408997950">PR review comment</a>:</p>
<blockquote>
<p>Would it make sense to pass these around as a unit-of-sorts if they all live in some sort of <code>FuncEnvironment</code> structure or similar? They're otherwise being passesd around pretty frequently and it's a lot of boilerplate to skip over</p>
</blockquote>



<a name="543632212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632212">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412085063">PR review comment</a>:</p>
<blockquote>
<p>I think this is going to have to change one way or another to make this sound. Some things I can think of to break soundness with this are:</p>
<ul>
<li>I think a <code>FrameView</code> could get paired with the wrong <code>Store</code>.</li>
<li>A <code>FrameView</code> could be persisted outside of a stack trace and then later read once the frames are all gone (or with the wrong store)</li>
</ul>
<p>Personally I think it would be worth trying to consolidate the <code>unsafe</code> here in this module as much as possible. Ideally we'd just have one tiny "thing", whatever that is, which does the <code>unsafe</code> bits of actually reading from the stack and, ideally, we'd be able to read the definition of this "thing" and trivially conclude "yep that's fine".</p>
</blockquote>



<a name="543632213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632213">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2409004095">PR review comment</a>:</p>
<blockquote>
<p>GIven that <code>Val</code> is self-describing in its type, could the <code>ValType</code> return be omitted?</p>
</blockquote>



<a name="543632214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632214">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2409005761">PR review comment</a>:</p>
<blockquote>
<p>GIven that wasm modules are generally all <code>u32</code>-heavy on the encoding side, could this be a <code>u32</code> and <code>local</code> would also take a <code>u32</code> below?</p>
</blockquote>



<a name="543632215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543632215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543632215">(Oct 07 2025 at 22:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2409004982">PR review comment</a>:</p>
<blockquote>
<p>To make this more amenable to strict provenance (hypothetically one day being supported in Wasmtime...) instead of passing addresses around as <code>usize</code> could they be passed around as <code>*const u8</code> or similar?</p>
</blockquote>



<a name="543634465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543634465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543634465">(Oct 07 2025 at 23:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3378982074">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Regarding unsoundness of <code>FrameView</code> being unattached to a lifetime:</p>
<p>Hmm. I agree that as written this API permits those patterns; I had been mostly concerned with keeping the stack "frozen" with the <code>StackView</code> iterator, then realized that the <code>Store</code> needs to be kept separate from whatever the iterator yields (because you cannot yield a <code>&amp;mut _</code> more than once from an iterator if they overlap, and the alternative would otherwise be to have the store mut-borrow be reborrowed by <code>FrameView</code>, but that's not viable here).</p>
<p>I suspect that the easiest sound option may be to give up on providing an actual iterator, that literally yields externalizable values (<code>FrameView</code>) for each frame, but rather integrate the reading-of-the-frame methods into the <code>StackView</code> itself. That cleanly disallows any of the "save it for later" or "use it with the wrong store" cases because the <code>StackView</code> holds the store borrow.</p>
<p>It does mean a user would look something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="o">!</span><span class="n">stack_view</span><span class="p">.</span><span class="n">done</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_view</span><span class="p">.</span><span class="n">instance</span><span class="p">();</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_view</span><span class="p">.</span><span class="n">defined_func_index</span><span class="p">();</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_view</span><span class="p">.</span><span class="n">local</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="n">stack_view</span><span class="p">.</span><span class="n">move_up</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>What do you think?</p>
</blockquote>



<a name="543634757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543634757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543634757">(Oct 07 2025 at 23:03)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3378985985">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Yeah that matches my intuition as well where the disconnect of the iterator value from the store felt a bit fishy. "Lending iterators" is definitely something that's not natural/easy to do in Rust, but I agree that having a custom API to handle this is reasonable. Best-in-class ergonomics seems ok to not have as a goal for a debugging-exclusive API.</p>
</blockquote>



<a name="543634867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543634867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543634867">(Oct 07 2025 at 23:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312185614">PR review</a>.</p>



<a name="543634869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543634869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543634869">(Oct 07 2025 at 23:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412124718">PR review comment</a>:</p>
<blockquote>
<p>It's possible; it would mean moving things around so that <code>stack.push*()</code> helpers, and all other manipulations of <code>stack.stack</code>, directly create a stack-shape node as well, which involves deeper refactoring. I was trying to keep changes to the code translator to a minimum in the initial PR. I'll play with this though!</p>
</blockquote>



<a name="543635199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543635199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543635199">(Oct 07 2025 at 23:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312192490">PR review</a>.</p>



<a name="543635200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543635200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543635200">(Oct 07 2025 at 23:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412129498">PR review comment</a>:</p>
<blockquote>
<p>Sure, I was trying to invent a policy to keep the old debugging approach separate by renaming it to "native debugging", but I'm happy to swap things around so existing native debug remains <code>debug-info</code> and the new thing becomes <code>guest-debug</code> or something like that. I guess I was leaning on our "semver lets us change things each major release" policy but I agree CLI stability here may be desirable.</p>
<p>What do you think about <code>guest-debug</code> as a general moniker for the new approach?</p>
</blockquote>



<a name="543639507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543639507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543639507">(Oct 08 2025 at 00:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312315797">PR review</a>.</p>



<a name="543639508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543639508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543639508">(Oct 08 2025 at 00:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412199587">PR review comment</a>:</p>
<blockquote>
<p>I believe so: the difference between this and <code>Backtrace::trace</code> for example is that the latter doesn't give you a mutable store while it's doing the tracing. In theory, a maximally evil client could take the owned store, translate that to full ownership of the raw stack, and mutate the frames that we're walking through.</p>
<p>That said, we don't provide any other APIs on a store today (to my knowledge!) that could mutate the stack arbitrarily, e.g. on-stack replacement of some form; so perhaps we can kick this can down the road and re-assign responsibility for safety to whichever mechanism eventually does that. Happy to do what you feel is best!</p>
</blockquote>



<a name="543640072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640072">(Oct 08 2025 at 00:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312362538">PR review</a>.</p>



<a name="543640073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640073">(Oct 08 2025 at 00:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412214550">PR review comment</a>:</p>
<blockquote>
<p>Yes, I think so; I'll add a note about this.</p>
<p>I can see two options:</p>
<ul>
<li>We could extend the "tail is new and needs to be synced" state to <em>arbitrary</em> dirtyness, and mark all ref-typed values as dirty after a safepoint; this would then force the stack sync to re-write all (potentially updated) GC refs to the instrumentation slots.</li>
<li>We could extend the instrumentation frame-shape metadata to be able to refer directly to other stackslots; then we could let the spilling that already happens for safepoints also give us full debug visibility.</li>
</ul>
<p>I favor the second overall but probably want to defer this for now, to get the basic functionality working...</p>
</blockquote>



<a name="543640548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640548">(Oct 08 2025 at 00:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312377099">PR review</a>.</p>



<a name="543640549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640549">(Oct 08 2025 at 00:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412220539">PR review comment</a>:</p>
<blockquote>
<p>Yes, assert-no-gc seems reasonable; I initially was thinking I didn't want to impose that limitation because a mutating debugger interface may want to allow evaluations that could allocate other things, but that's far-future stuff; happy to defer it.</p>
<p>(And actually, just to note it, this intersects with your above point about GC rooting too; in the presence of a moving GC we'd have to be careful to have debug metadata refer directly to the existing user-stack-map for that to work, rather than re-spill values to instrumentation after a safepoint, because while still walking the stack that re-spill code wouldn't run.)</p>
</blockquote>



<a name="543640617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640617">(Oct 08 2025 at 00:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543640641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640641">(Oct 08 2025 at 00:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312379598">PR review</a>.</p>



<a name="543640642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640642">(Oct 08 2025 at 00:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412221844">PR review comment</a>:</p>
<blockquote>
<p>(Updated in 2df6a9140c.)</p>
</blockquote>



<a name="543640666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640666">(Oct 08 2025 at 00:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412222133">PR review comment</a>:</p>
<blockquote>
<p>Fixed in 2df6a9140c per the sketch below.</p>
</blockquote>



<a name="543640667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640667">(Oct 08 2025 at 00:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312380167">PR review</a>.</p>



<a name="543640747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640747">(Oct 08 2025 at 00:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312381286">PR review</a>.</p>



<a name="543640748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640748">(Oct 08 2025 at 00:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412222740">PR review comment</a>:</p>
<blockquote>
<p>Good point; I think this is left over from something earlier (was I trying to return a precise type including runtime GC types? I'm not sure) but it's simpler not to. Removed in 2df6a9140c.</p>
</blockquote>



<a name="543640760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640760">(Oct 08 2025 at 00:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312381634">PR review</a>.</p>



<a name="543640761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640761">(Oct 08 2025 at 00:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412222905">PR review comment</a>:</p>
<blockquote>
<p>Fixed via removal in 2df6a9140c.</p>
</blockquote>



<a name="543640782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640782">(Oct 08 2025 at 00:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312382212">PR review</a>.</p>



<a name="543640783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640783">(Oct 08 2025 at 00:19)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412223223">PR review comment</a>:</p>
<blockquote>
<p>Note added in 2df6a9140c; to be addressed in a more thorough way later.</p>
</blockquote>



<a name="543640813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640813">(Oct 08 2025 at 00:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312382943">PR review</a>.</p>



<a name="543640814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640814">(Oct 08 2025 at 00:19)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412223693">PR review comment</a>:</p>
<blockquote>
<p>(Kept this but feel free to ask me to remove or reword if you feel differently.)</p>
</blockquote>



<a name="543640875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543640875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543640875">(Oct 08 2025 at 00:20)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3379126230">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Pushed a fix to the API to encapsulate the frame with the iterator; will address the other bits later tonight or tomorrow. Thanks!</p>
</blockquote>



<a name="543654754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543654754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543654754">(Oct 08 2025 at 03:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312726581">PR review</a>.</p>



<a name="543654755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543654755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543654755">(Oct 08 2025 at 03:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412427280">PR review comment</a>:</p>
<blockquote>
<p>OK, I've pushed on this a bit locally, but I think it makes things much worse:</p>
<ul>
<li>a lot of the operand stack management assumes it can take slices of <code>&amp;[Value]</code> and even mutate those in some cases, so although <code>(Value, FrameStackShape)</code> is the natural type for a stack entry (or rather <code>(Value, Option&lt;FrameStackShape&gt;)</code> since instrumentation is optional), that alters a <em>ton</em> of code;</li>
<li>push/pop methods on <code>stacks</code> require the builder now, which creates a huge diff that alters every operator translation (it's pretty mechanical, but still);</li>
<li>the distinction between <code>stack</code> and <code>stack_shape</code> actually corresponds an important algorithmic detail: we let them go out of sync (specifically, <code>stack_shape</code> can always be shorter than <code>stack</code> if not all values are flushed) then do the sync at the end of a given operator translation. This is important because we get the specific type from the validator's view of the Wasm state and it only makes sense to query that after the operator translation has updated the stack completely to match the current program point, rather than at each individual push/pop.</li>
</ul>
<p>The last one is the most fundamental, the other two are "only" big mechanical refactors, but for all these reasons I think the current approach is the most workable (and the doc-comment here does a not terrible job explaining the invariant imho).</p>
</blockquote>



<a name="543655002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655002">(Oct 08 2025 at 03:50)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543655023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655023">(Oct 08 2025 at 03:51)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412431289">PR review comment</a>:</p>
<blockquote>
<p>Sure, merged this (and the after-hook too) into existing hooks in 32b15c30f8.</p>
</blockquote>



<a name="543655024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655024">(Oct 08 2025 at 03:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312731547">PR review</a>.</p>



<a name="543655253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655253">(Oct 08 2025 at 03:54)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543655275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655275">(Oct 08 2025 at 03:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312735936">PR review</a>.</p>



<a name="543655276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655276">(Oct 08 2025 at 03:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412435210">PR review comment</a>:</p>
<blockquote>
<p>Sure, addressed in 645dfe1470.</p>
</blockquote>



<a name="543655387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655387">(Oct 08 2025 at 03:56)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543655399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655399">(Oct 08 2025 at 03:56)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312737847">PR review</a>.</p>



<a name="543655400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543655400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543655400">(Oct 08 2025 at 03:56)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412436856">PR review comment</a>:</p>
<blockquote>
<p>Sure, added in 618bd094ef.</p>
</blockquote>



<a name="543657145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657145">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543657154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657154">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312766831">PR review</a>.</p>



<a name="543657155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657155">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412459536">PR review comment</a>:</p>
<blockquote>
<p>So currently <code>stack</code> and <code>func_env</code> are kept separate throughout the whole translator for what I suspect are deep borrowing-related reasons; it just so happens that we need <code>stack</code> in a few more places. <code>srcloc</code> on the other hand is in theory known by the <code>builder</code> anywhere we have that, so I've added an accessor and removed it in a few places in e19e867b0d.</p>
</blockquote>



<a name="543657158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657158">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312766894">PR review</a>.</p>



<a name="543657159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657159">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412459591">PR review comment</a>:</p>
<blockquote>
<p>Sure, addressed in 21c3b4fe4b (and used <code>with_exposed_provenance</code> to go from the FP that comes in from other runtime machinery as a <code>usize</code> to the <code>*const u8</code> we use here).</p>
</blockquote>



<a name="543657163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657163">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312766944">PR review</a>.</p>



<a name="543657165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543657165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543657165">(Oct 08 2025 at 04:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412459630">PR review comment</a>:</p>
<blockquote>
<p>Sure, addressed in 011f656292.</p>
</blockquote>



<a name="543658244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543658244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543658244">(Oct 08 2025 at 04:34)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543658290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543658290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543658290">(Oct 08 2025 at 04:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3312786598">PR review</a>.</p>



<a name="543658291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543658291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543658291">(Oct 08 2025 at 04:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2412474842">PR review comment</a>:</p>
<blockquote>
<p>Alright, I've renamed some things in f660ba9296 so the current (native DWARF) approach remains under the same option names on the CLI and <code>Config</code> and the new thing is "guest debugging".</p>
</blockquote>



<a name="543658332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543658332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543658332">(Oct 08 2025 at 04:35)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3379536495">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>I believe I've addressed all review comments so far; thanks!</p>
</blockquote>



<a name="543658381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543658381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543658381">(Oct 08 2025 at 04:36)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543889551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543889551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543889551">(Oct 09 2025 at 07:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="543989390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543989390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543989390">(Oct 09 2025 at 15:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417066560">PR review comment</a>:</p>
<blockquote>
<p>Nah yeah I understand the rationale for the rename and I agree that if we were to start from scratch I'd prefer to rename this, but also yeah the CLI generally needs more stability than the major version bumps technically allow so I think it'll cause unnecessary churn to rename the CLI option.</p>
<p>That being said I still like the idea of classifying debugging as "native debugging" or "guest debugging" internally in Wasmtime. For example the new tunables option <code>debug_guest</code> and using <code>guest-debug</code> here in the CLI sounds reasonable to me. I think it'd be reasonable to "deprecate" this <code>-Ddebug-info</code> option in favor of <code>-Dnative-debug</code> where "deprecate" is in quotes because we don't actually warn on deprecations, but we could technicaly accept both.</p>
</blockquote>



<a name="543989530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/543989530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#543989530">(Oct 09 2025 at 15:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3319385003">PR review</a>.</p>



<a name="544034991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544034991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544034991">(Oct 09 2025 at 19:38)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417239715">PR review comment</a>:</p>
<blockquote>
<p>Similarly to how you already merged the debug instrumentation before/after each op into the existing before/after each op hook, can we put the <code>debug_instrumentation_at_{start,end}</code> stuff inside the existing <code>{before,after}_translate_function</code> hooks?</p>
</blockquote>



<a name="544034993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544034993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544034993">(Oct 09 2025 at 19:38)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3319624655">PR review</a>:</p>
<blockquote>
<p>Didn't get to finish looking over everything yet, but what I've seen looks great, one minor nitpick below.</p>
</blockquote>



<a name="544042959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042959">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3319387083">PR review</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> from me, but @fitzgen should probably also sign off too</p>
</blockquote>



<a name="544042961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042961">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417067847">PR review comment</a>:</p>
<blockquote>
<p>Could the tunables option here retain the "native" part of the name? To mirror the <code>debug_guest</code> option I think it'd be reasonable to rename this as <code>debug_native</code> too</p>
</blockquote>



<a name="544042962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042962">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417869887">PR review comment</a>:</p>
<blockquote>
<p>s/teh/the/</p>
</blockquote>



<a name="544042963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042963">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417887534">PR review comment</a>:</p>
<blockquote>
<p>If most of this module operated on <code>&amp;StoreOpaque</code> rather than <code>&amp;mut StoreOpaque</code> that might be a way to avoid this <code>Vec</code> too perhaps</p>
</blockquote>



<a name="544042964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042964">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417874216">PR review comment</a>:</p>
<blockquote>
<p>Could this, and maybe stackwalking in general, actually take <code>&amp;StoreOpaque</code>, notably not mutable? That way I think stack iteration could be 100% safe since mutations are impossible while the store is held, and it'd also prevent a GC since that requires a mutable store</p>
</blockquote>



<a name="544042965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042965">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417075290">PR review comment</a>:</p>
<blockquote>
<p>Could the documentation here link to the types in the public API which are enabled when this option is turned on?</p>
</blockquote>



<a name="544042966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042966">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417868863">PR review comment</a>:</p>
<blockquote>
<p>Mind adding a "SAFETY" comment about why this is safe?</p>
</blockquote>



<a name="544042967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042967">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417896735">PR review comment</a>:</p>
<blockquote>
<p>Ah ok yeah that all makes sense, thanks for pushing on this regardless!</p>
</blockquote>



<a name="544042968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042968">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417876788">PR review comment</a>:</p>
<blockquote>
<p>Could this point to a spot in code translation and/or Cranelift where offset 0 is the vmctx? (and ideally point from there to here too)</p>
</blockquote>



<a name="544042969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042969">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417865327">PR review comment</a>:</p>
<blockquote>
<p>Ah ok that makes sense to me yeah, but can the safety comment here be worded specifically around how the store is a public field? The current docs feel a bit inaccurate because the store isn't yielded on each iteration nor is it possible to store this iterator, return to wasm, and then resume the iterator later.</p>
<p>(also unresolving for visibility)</p>
</blockquote>



<a name="544042970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042970">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417072146">PR review comment</a>:</p>
<blockquote>
<p>Mind also filing an issue for this? And maybe making a tag for guest-debug related things? Mostly want to make sure we don't lose track of this as this seems pretty important and if it's just a comment we'll inevitably forget it a few months from now.</p>
<p>(unresolving this conversation for visibility)</p>
</blockquote>



<a name="544042971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544042971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544042971">(Oct 09 2025 at 20:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2417883394">PR review comment</a>:</p>
<blockquote>
<p>Shouldn't this be a bug or debug assert if a program point isn't found?</p>
</blockquote>



<a name="544222605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544222605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544222605">(Oct 10 2025 at 17:58)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2421491331">PR review comment</a>:</p>
<blockquote>
<p>The tricky thing here is that reading out a GC reference actually <em>does</em> mutate the store: it roots the reference and the root-set is in the store. This is not super-satisfying to me either but it's forced by the design today I think...</p>
</blockquote>



<a name="544222607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544222607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544222607">(Oct 10 2025 at 17:58)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3325113372">PR review</a>.</p>



<a name="544251749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544251749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544251749">(Oct 10 2025 at 21:40)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3326006378">PR review</a>.</p>



<a name="544251750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544251750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544251750">(Oct 10 2025 at 21:40)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2422138634">PR review comment</a>:</p>
<blockquote>
<p>Ah good point, and yeah that forces our hand here.</p>
</blockquote>



<a name="544439519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439519">(Oct 13 2025 at 00:44)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544439641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439641">(Oct 13 2025 at 00:46)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544439642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439642">(Oct 13 2025 at 00:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425045028">PR review comment</a>:</p>
<blockquote>
<p>Done in 0b20becd0c!</p>
</blockquote>



<a name="544439643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439643">(Oct 13 2025 at 00:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329733536">PR review</a>.</p>



<a name="544439736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439736">(Oct 13 2025 at 00:48)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544439741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439741">(Oct 13 2025 at 00:48)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329742916">PR review</a>.</p>



<a name="544439742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439742">(Oct 13 2025 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425050081">PR review comment</a>:</p>
<blockquote>
<p>Done in 690d88c2fb!</p>
</blockquote>



<a name="544439953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439953">(Oct 13 2025 at 00:53)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544439956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439956">(Oct 13 2025 at 00:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329749877">PR review</a>.</p>



<a name="544439957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544439957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544439957">(Oct 13 2025 at 00:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425054677">PR review comment</a>:</p>
<blockquote>
<p>Done (to <code>debug_native</code>) in 59df486fca.</p>
</blockquote>



<a name="544440465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440465">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544440486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440486">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329766230">PR review</a>.</p>



<a name="544440487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440487">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425065305">PR review comment</a>:</p>
<blockquote>
<p>Done in 6b48c9fd61.</p>
</blockquote>



<a name="544440488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440488">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329766270">PR review</a>.</p>



<a name="544440489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440489">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425065328">PR review comment</a>:</p>
<blockquote>
<p>Done in 6b48c9fd61.</p>
</blockquote>



<a name="544440495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440495">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329766325">PR review</a>.</p>



<a name="544440497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440497">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425065382">PR review comment</a>:</p>
<blockquote>
<p>Done; added a few references in 6b48c9fd61.</p>
</blockquote>



<a name="544440507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440507">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329766368">PR review</a>.</p>



<a name="544440508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440508">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425065424">PR review comment</a>:</p>
<blockquote>
<p>Yes, I think this was left over from some earlier thinking before I realized that debug instrumentation should be uniform across the whole activation because we're in one store with one set of settings... removed in </p>
</blockquote>



<a name="544440516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440516">(Oct 13 2025 at 01:03)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425065424">PR review comment</a>.</p>



<a name="544440523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440523">(Oct 13 2025 at 01:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425065516">PR review comment</a>:</p>
<blockquote>
<p>(see other comment about mutability -- unfortunately I don't think we can change this at the moment)</p>
</blockquote>



<a name="544440524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440524">(Oct 13 2025 at 01:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329766468">PR review</a>.</p>



<a name="544440580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440580">(Oct 13 2025 at 01:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329767133">PR review</a>.</p>



<a name="544440581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440581">(Oct 13 2025 at 01:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425066000">PR review comment</a>:</p>
<blockquote>
<p>OK cool -- I'll add such deprecation to my TODO list for the public-facing interface once I get there on my marathon (I don't think we should do it before we have the alternative thing available) :-)</p>
</blockquote>



<a name="544440731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440731">(Oct 13 2025 at 01:07)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544440733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440733">(Oct 13 2025 at 01:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329768704">PR review</a>.</p>



<a name="544440734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544440734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544440734">(Oct 13 2025 at 01:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425067178">PR review comment</a>:</p>
<blockquote>
<p>Oops, sorry, I missed that outdated wording -- fixed in ef26d17428.</p>
</blockquote>



<a name="544441201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544441201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544441201">(Oct 13 2025 at 01:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3329775705">PR review</a>.</p>



<a name="544441204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544441204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544441204">(Oct 13 2025 at 01:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425071433">PR review comment</a>:</p>
<blockquote>
<p>Filed #11841, but as I wrote that, I realized that even for our current non-moving GC this is a problem, because DCE could remove the part of the program that would otherwise root a value (e.g., for a Wasm program that takes an <code>anyref</code> as a parameter, pushes it on the operand stack, then drops it at the end; that's live for the debugger but won't be in any user stack maps).</p>
<p>I'll see about adding debug metadata traversal to tracing directly, so every ref-typed value at the current program point gets traced...</p>
</blockquote>



<a name="544441795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544441795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544441795">(Oct 13 2025 at 01:27)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544463657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544463657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544463657">(Oct 13 2025 at 06:06)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544464047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544464047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544464047">(Oct 13 2025 at 06:09)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3330085252">PR review</a>.</p>



<a name="544464050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544464050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544464050">(Oct 13 2025 at 06:09)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2425296479">PR review comment</a>:</p>
<blockquote>
<p>OK, I've actually implemented the proper rooting in 66e650522e. I have a basic test with a GC ref semantically-live-but-optimizing-compiler-dead across a hostcall, with that hostcall observing the value in the slot. A really proper test would actually invoke a GC on the store during that hostcall, which I can't do in this PR yet (the followup gives a store context that would let me do that) but hopefully this is sufficient for now.</p>
</blockquote>



<a name="544464160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544464160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544464160">(Oct 13 2025 at 06:09)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3395990493">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Alright, I think this is ready for a final look -- thanks for the feedback so far!</p>
</blockquote>



<a name="544599316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544599316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544599316">(Oct 13 2025 at 17:43)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2426938721">PR review comment</a>:</p>
<blockquote>
<p>Musing about this, and I realize this isn't supported right now anyway, but will this be enough to support modifying the stack or locals during a debugging session. I was naively thinking "no" because locals can have a more refined type as well as values on the stack. Effectively the wasm validator understands a local/stack entry to have a particular type, and the runtime value may be that type or a subtype. Mutating the stack should allow anything that's a subtype of the known type, but by only recording the top type here we lose the knowledge of precisely what type it needs to be.</p>
<p>I suppose bringing it back to this PR: I would be surprised if <code>FrameValType</code> continues to support future use cases as-is. In the end what I might naively expect is that <code>FrameValType</code> becomes literally <code>WasmValType</code>. Do you think it might be worthwhile to go ahead and plumb that to avoid a future conversion? (and of course deferring this to an issue is also fine)</p>
</blockquote>



<a name="544599317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544599317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544599317">(Oct 13 2025 at 17:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3332486263">PR review</a>:</p>
<blockquote>
<p>One final thought, but doesn't change the fact that I'm still <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> on this landing as-is</p>
</blockquote>



<a name="544599727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544599727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544599727">(Oct 13 2025 at 17:47)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544600327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544600327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544600327">(Oct 13 2025 at 17:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3332545541">PR review</a>.</p>



<a name="544600328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544600328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544600328">(Oct 13 2025 at 17:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2426980199">PR review comment</a>:</p>
<blockquote>
<p>Interesting; yeah, I think you're right.</p>
<p>The driving factor here so far (as I'm sure you intuited) is that I didn't want to pull runtime types down into <code>environ</code>; but I guess the <code>environ</code>-level metadata can use module-level type indices and then we translate that at runtime via the engine type registry, like everywhere else.</p>
<p>I've created #11847 to track. I think that's a bit much to put on top of this PR, IMHO, but happy to do it once needed for mutation. It'd also give a nice ability to query the precise type (in runtime terms) on any local/stack slot.</p>
</blockquote>



<a name="544629932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544629932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544629932">(Oct 13 2025 at 22:32)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3333141894">PR review</a>:</p>
<blockquote>
<p>r=me with the bit about stack tracing using stack maps instead of also debug info (<a href="https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128">https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128</a>) and then also a couple nitpicks/bikesheds that I am happy to be convinced otherwise about</p>
<p>Thanks Chris!</p>
</blockquote>



<a name="544629933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544629933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544629933">(Oct 13 2025 at 22:32)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2427422229">PR review comment</a>:</p>
<blockquote>
<p>Bikeshedding: So this doesn't view the whole stack anymore, just one frame in the linked list that makes up the stack, so what do you think of <code>FrameView</code> instead? And it is for the purposes of debugging, so maybe <code>DebugFrameView</code>? Or maybe just <code>DebugFrame</code>?</p>
</blockquote>



<a name="544629934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544629934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544629934">(Oct 13 2025 at 22:32)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2427441193">PR review comment</a>:</p>
<blockquote>
<p>Placeholder for <a href="https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128">https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128</a></p>
</blockquote>



<a name="544629935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544629935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544629935">(Oct 13 2025 at 22:32)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2427424457">PR review comment</a>:</p>
<blockquote>
<p>This name is assuming that the stack grows down, which isn't really defined at the Wasm level.</p>
<p>How about</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">parent</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">DebugFrame</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</code></pre></div>
<p>?</p>
<p>Or if we want to keep it cursor-style, rather than returning a new frame, maybe we should call it <code>move_to_parent</code> and also call the type <code>DebugStackCursor</code>. (I think <code>View</code> implies a more slice-like, O(1)-access thing than <code>Cursor</code> does).</p>
<p>What I like about returning a new frame, over the cursor style, is that it is very clear when you've reached to initial stack frame and there is nothing else to traverse. I personally just find it more natural as well. (The lifetimes should make it so that you can't have two <code>DebugFrame</code>s alive at the same time for the same stack anyways).</p>
</blockquote>



<a name="544629936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544629936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544629936">(Oct 13 2025 at 22:32)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2427409362">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    /// The flattened list of (symbol name, FuncKey, compiled
    /// function) triples, as they will be laid out in the object file.
</code></pre></div><br>
</p>
</blockquote>



<a name="544658896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544658896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544658896">(Oct 14 2025 at 04:49)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544659390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544659390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544659390">(Oct 14 2025 at 04:55)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544660083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544660083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544660083">(Oct 14 2025 at 05:02)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3400120526">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>@fitzgen </p>
<blockquote>
<p>the bit about stack tracing using stack maps instead of also debug info (<a href="https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128">https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128</a>)</p>
</blockquote>
<p>I built this out in e462fda5eb but I'm not super happy about it for three reasons:</p>
<ul>
<li>user stack maps were emitted only on calls (as they were designed for); we now need to add them to sequence point instructions, and in the future will need to add them to <em>every trapping instruction</em>, because on trap, we yield to the debugger, and the instrumentation-slot values need to remain rooted until we eventually tear down (and with mutable access to the store that could include a GC). So that means that e.g. every load/store, and every ALU instruction emit case on x86-64 (because mem folding).</li>
<li>That would be fine if we handle it in one place (take stack map before emitting every inst), but now we have a pretty big blowup of metadata space. The stack map will contain an entry for every ref-typed local, and duplicate these for every Wasm memory instruction -- quadratic space. The debug frame state in contrast stores the types and offsets for all locals once.</li>
<li>There's the awkward bit about zero-length sequence points and duplicated stack maps; again not fatal, we can handle it, but shows how this is pushing what stackmaps were designed for a bit.</li>
</ul>
<p>The asymptotic efficiency bit is the fundamental one I think.</p>
<p>I can make an argument in principle for GC tracing using debug metadata as well: debug state has different requirements (much more frequent state points, and many of them are identical i.e. locals), and is logically a separate kind of rooting area (albeit one per frame), just as globals and user roots are separate areas.</p>
<p>What do you think? Happy to revert the last commit if you agree.</p>
</blockquote>



<a name="544660140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544660140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544660140">(Oct 14 2025 at 05:03)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3400120526">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>@fitzgen </p>
<blockquote>
<p>the bit about stack tracing using stack maps instead of also debug info (<a href="https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128">https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128</a>)</p>
</blockquote>
<p>I built this out in e462fda5eb but I'm not super happy about it for three reasons:</p>
<ul>
<li>user stack maps were emitted only on calls (as they were designed for); we now need to add them to sequence point instructions, and in the future will need to add them to <em>every trapping instruction</em>, because on trap, we yield to the debugger, and the instrumentation-slot values need to remain rooted until we eventually tear down (and with mutable access to the store that could include a GC). So that means e.g. every load/store, and every ALU instruction emit case on x86-64 (because mem folding).</li>
<li>That would be fine if we handle it in one place (take stack map before emitting every inst), but now we have a pretty big blowup of metadata space. The stack map will contain an entry for every ref-typed local, and duplicate these for every Wasm memory instruction -- quadratic space. The debug frame state in contrast stores the types and offsets for all locals once.</li>
<li>There's the awkward bit about zero-length sequence points and duplicated stack maps; again not fatal, we can handle it, but shows how this is pushing what stackmaps were designed for a bit.</li>
</ul>
<p>The asymptotic efficiency bit is the fundamental one I think.</p>
<p>I can make an argument in principle for GC tracing using debug metadata as well: debug state has different requirements (much more frequent state points, and many of them are identical i.e. locals), and is logically a separate kind of rooting area (albeit one per frame), just as globals and user roots are separate areas.</p>
<p>What do you think? Happy to revert the last commit if you agree.</p>
</blockquote>



<a name="544660264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544660264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544660264">(Oct 14 2025 at 05:04)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3400120526">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>@fitzgen </p>
<blockquote>
<p>the bit about stack tracing using stack maps instead of also debug info (<a href="https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128">https://github.com/bytecodealliance/wasmtime/issues/11841#issuecomment-3399148128</a>)</p>
</blockquote>
<p>I built this out in e462fda5eb but I'm not super happy about it for three reasons:</p>
<ul>
<li>user stack maps were emitted only on calls (as they were designed for); we now need to add them to sequence point instructions, and in the future will need to add them to <em>every trapping instruction</em>, because on trap, we yield to the debugger, and the instrumentation-slot values need to remain rooted until we eventually tear down (and with mutable access to the store that could include a GC). So that means e.g. every load/store, and every ALU instruction emit case on x86-64 (because mem folding).</li>
<li>That would be fine if we handle it in one place (take stack map before emitting every inst), but now we have a pretty big blowup of metadata space. The stack map will contain an entry for every ref-typed local, and duplicate these for every Wasm instruction -- quadratic space. The debug frame state in contrast stores the types and offsets for all locals once.</li>
<li>There's the awkward bit about zero-length sequence points and duplicated stack maps; again not fatal, we can handle it, but shows how this is pushing what stackmaps were designed for a bit.</li>
</ul>
<p>The asymptotic efficiency bit is the fundamental one I think.</p>
<p>I can make an argument in principle for GC tracing using debug metadata as well: debug state has different requirements (much more frequent state points, and many of them are identical i.e. locals), and is logically a separate kind of rooting area (albeit one per frame), just as globals and user roots are separate areas.</p>
<p>What do you think? Happy to revert the last commit if you agree.</p>
</blockquote>



<a name="544810931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544810931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544810931">(Oct 14 2025 at 18:09)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3403050897">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>Overall, the latest commit looks like what I expected, and seems good to me.</p>
<blockquote>
<p>The asymptotic efficiency bit is the fundamental one I think.</p>
</blockquote>
<p>It is true that the total size of stack maps is technically <code>O(num_live_gc_refs * num_safepoints)</code>. However, I don't think this will actually be an issue in practice because</p>
<ul>
<li>Each stack map is already a packed bitmap, minimizing the effect of <code>num_live_gc_refs</code> to a degree</li>
<li><code>num_live_gc_refs</code> is not actually large in practice</li>
<li><code>num_safepoints</code> is only large when debugging in practice</li>
<li>All of this only affects code size in edge cases, not run time performance</li>
</ul>
<p>But if we <em>are</em> concerned about this when adding debugging instrumentation's stack map entries, then I think we should also be concerned about stack maps as they exist today. It is certainly already possible to construct a Wasm that just does a ton of calls (making <code>num_safepoints</code> grow) with a ton of live GC refs on the stack. So if we are concerned about this, then we should make the stack maps in general have prefix sharing similar to what you've done for debug info. (Also I'm sure it is also possible to construct Wasm inputs that have similar Wasm:native code size blow ups in general due to Cranelift being an optimizing/non-template compiler with remat, demand-based egraph elaboration in the face of conditional branches, etc.)</p>
<p>But I don't really want to keep holding up your debugging work, especially since you have so many PRs stacked on top of this one already. So if you still prefer the previous approach, then go for it. I won't draw any lines in the sand here.</p>
</blockquote>



<a name="544844049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544844049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544844049">(Oct 14 2025 at 22:02)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544844083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544844083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544844083">(Oct 14 2025 at 22:03)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#issuecomment-3403760564">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>:</p>
<blockquote>
<p>OK, yeah, I pushed on this a bit more to see if I could make it nicer; I do agree that <em>in principle</em> stack maps should be the sole owner of "GC refs on the stack", and also that any efficiency concerns with them could be addressed directly.</p>
<p>That said I was trying to harmonize the stackmap emission a bit so it isn't special-cased for <code>sequence_point</code> and calls only, since we'll ultimately need them on many different kinds of instructions; and working through that ended up calling for reinvention of a lot of what debug tags already handle, e.g. pre- and post-points on instructions, and seemed to be going against the grain in general. So I think I'll keep it as-is but we can always try this refactor later. Thanks for the push to try this in any case!</p>
</blockquote>



<a name="544844209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544844209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544844209">(Oct 14 2025 at 22:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2430594230">PR review comment</a>:</p>
<blockquote>
<p>(Resolving for now but we can try this refactor later if we can make supporting stackmaps across all instructions nicer)</p>
</blockquote>



<a name="544844210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544844210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544844210">(Oct 14 2025 at 22:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3337662015">PR review</a>.</p>



<a name="544845279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845279">(Oct 14 2025 at 22:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3337683322">PR review</a>.</p>



<a name="544845280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845280">(Oct 14 2025 at 22:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2430608677">PR review comment</a>:</p>
<blockquote>
<p>Fixed in 4fdcd4eb1b, thanks!</p>
</blockquote>



<a name="544845287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845287">(Oct 14 2025 at 22:12)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544845427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845427">(Oct 14 2025 at 22:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3337685065">PR review</a>.</p>



<a name="544845431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845431">(Oct 14 2025 at 22:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2430610022">PR review comment</a>:</p>
<blockquote>
<p>Ah, I like the cursor naming here; switched to <code>DebugFrameCursor</code>, an accessor <code>debug_frames()</code> on the store, and <code>move_to_parent()</code>. Thanks! Updated in 4fdcd4eb1b.</p>
</blockquote>



<a name="544845467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845467">(Oct 14 2025 at 22:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#pullrequestreview-3337685633">PR review</a>.</p>



<a name="544845469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845469">(Oct 14 2025 at 22:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/11769#discussion_r2430610383">PR review comment</a>:</p>
<blockquote>
<p>Updated to <code>DebugFrameCursor</code> per below in 4fdcd4eb1b.</p>
</blockquote>



<a name="544845505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544845505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544845505">(Oct 14 2025 at 22:13)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544853691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544853691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544853691">(Oct 14 2025 at 23:50)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544853728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544853728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544853728">(Oct 14 2025 at 23:51)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<a name="544856567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2311769%20Wasmtime%3A%20implement%20debug%20instrument.../near/544856567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2311769.20Wasmtime.3A.20implement.20debug.20instrument.2E.2E.2E.html#544856567">(Oct 15 2025 at 00:27)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/11769">PR #11769</a>.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>