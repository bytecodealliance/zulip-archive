<html>
<head><meta charset="utf-8"><title>Compact import section proposal implementation · wasm-tools · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/index.html">wasm-tools</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html">Compact import section proposal implementation</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="562517771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562517771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562517771">(Dec 08 2025 at 17:06)</a>:</h4>
<p>I'm implementing the <a href="https://github.com/WebAssembly/compact-import-section">custom import section proposal</a> in wasm-tools this week and just have a few questions about the implementation.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/compact-import-section" style="background-image: url(&quot;https://uploads.zulipusercontent.net/844992c9a7f3ed6a80c8fcc09062c521184dfac0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336264373530636638613739363230656138623036326130656234663133643937323364306664653430353365636432343565316635383665653337643430382f576562417373656d626c792f636f6d706163742d696d706f72742d73656374696f6e&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/compact-import-section" title="GitHub - WebAssembly/compact-import-section: Proposal repository for compact import sections">GitHub - WebAssembly/compact-import-section: Proposal repository for compact import sections</a></div><div class="message_embed_description">Proposal repository for compact import sections. Contribute to WebAssembly/compact-import-section development by creating an account on GitHub.</div></div></div>



<a name="562518062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562518062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562518062">(Dec 08 2025 at 17:08)</a>:</h4>
<p>The first and biggest question is: how should I update the binary parser to handle these groups of imports? Right now we have:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">ImportSectionReader</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SectionLimited</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">Import</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</code></pre></div>
<p>But now the entries in the import section can contain multiple imports. So naively I would think I need to change <code>Import&lt;'a&gt;</code> to <code>Imports&lt;'a&gt;</code> (and declare that Imports type). But that would presumably cascade through the entire wasm-tools library in a pretty unpleasant way, no?</p>



<a name="562518185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562518185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562518185">(Dec 08 2025 at 17:09)</a>:</h4>
<p>In the main spec (and SpiderMonkey) I was able to have the imports be a flat list in the module AST. Is that possible here? (Sorry for the noob question, I am not that familiar with the overall architecture of wasm-tools and how all the parts connect)</p>



<a name="562518437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562518437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562518437">(Dec 08 2025 at 17:10)</a>:</h4>
<p>Or do we <em>want</em> to plumb that information all the way through so that text encodings like <code>(import "foo" (item "bar" type) (item "baz" type))</code> map to the new binary encoding and vice versa?</p>



<a name="562522988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562522988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562522988">(Dec 08 2025 at 17:35)</a>:</h4>
<p>Also, this <code>skip</code> stuff from issue 188 really is a huge pain here, unless I'm missing something.</p>



<a name="562525055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562525055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562525055">(Dec 08 2025 at 17:47)</a>:</h4>
<p>Yeah unfortunately wasm-tools is probably going to be more difficult than spidermonkey here because wasmparser tries to reflect (roughly) the AST of the module as opposed to specializing on just one embedding (e.g. "just read all imports" vs "give me a parsed view of what all the imports look like")</p>
<p>Given that I think, yes, this'll result in <code>s/Import/Imports/</code>. We can add helper methods though to assist with "just ignore the binary encoding and give me all the imports", for example a method that auto-<code>flat_map</code>'s the result or something like that. Basically if you find yourself having to update a lot of code I'm happy to help out and come up with a way to reduce the boilerplate.</p>
<p>For <code>skip</code>, yeah :(. At this point I feel that it's sort of just a fundamental design property (flaw?) of how <code>wasmparser</code> works and there'se not really any way around it unfortunately</p>



<a name="562525168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562525168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562525168">(Dec 08 2025 at 17:48)</a>:</h4>
<p>Well, hopefully maybe I'm doing this right<br>
<a href="/user_uploads/15107/eq9g1MmsqNte-hMVBJno3Imf/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/eq9g1MmsqNte-hMVBJno3Imf/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="799x488" src="/user_uploads/thumbnail/15107/eq9g1MmsqNte-hMVBJno3Imf/image.png/840x560.webp"></a></div>



<a name="562525192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562525192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562525192">(Dec 08 2025 at 17:48)</a>:</h4>
<p>From a possibly naive point of view though I would agree and say that we do want to plumb the binary structure through <code>wasmparser</code> so, for example, <code>wasmprinter</code> could print the <code>(item ...)</code> form instead of the multi-<code>(import ...)</code> form</p>



<a name="562525290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562525290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562525290">(Dec 08 2025 at 17:48)</a>:</h4>
<p>yeah that looks reasonable to me w.r.t. <code>skip</code></p>



<a name="562525316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562525316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562525316">(Dec 08 2025 at 17:49)</a>:</h4>
<p>that one's definitely on us to fix that at some point</p>



<a name="562525624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562525624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562525624">(Dec 08 2025 at 17:50)</a>:</h4>
<p>IIRC the only "solution" I could think of to <code>skip</code> was completely inverting control flow to instead of "pull things from an iterator" it's "<code>wasmparser</code> pushes things into a trait you provide"</p>



<a name="562757548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562757548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562757548">(Dec 09 2025 at 17:55)</a>:</h4>
<p>Hopping back here for an open-ended question, I'm trying to figure out how to write the reencoder stuff to map from wasmparser::Imports to wasm_encoder::core::Imports</p>



<a name="562757667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562757667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562757667">(Dec 09 2025 at 17:55)</a>:</h4>
<p>in a very copy-pastey sort of way, I have set up the types like so:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="sd">/// TODO</span>
<span class="cp">#[derive(Clone, Debug)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ImportCompact</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// TODO</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// TODO</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">EntityType</span><span class="p">,</span>
<span class="p">}</span>

<span class="sd">/// TODO</span>
<span class="cp">#[derive(Clone, Debug)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ImportGroupCompact1</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// TODO</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">module</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// TODO</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="nc">Cow</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ImportCompact</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>



<a name="562757848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562757848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562757848">(Dec 09 2025 at 17:56)</a>:</h4>
<p>But a) I have no idea what the <code>Cow</code> is doing for me, and b) I have no idea how to map over to that</p>



<a name="562758404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562758404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562758404">(Dec 09 2025 at 17:59)</a>:</h4>
<p>ah, I see some other code in here just collects everything into a vec?</p>



<a name="562758429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562758429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562758429">(Dec 09 2025 at 17:59)</a>:</h4>
<p>(in <a href="http://reencode.rs">reencode.rs</a>)</p>



<a name="562759293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562759293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562759293">(Dec 09 2025 at 18:02)</a>:</h4>
<p>maybe I'm getting it<br>
<a href="/user_uploads/15107/_AhvsdyWdbUwYYIrfKkEH00W/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/_AhvsdyWdbUwYYIrfKkEH00W/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="549x288" src="/user_uploads/thumbnail/15107/_AhvsdyWdbUwYYIrfKkEH00W/image.png/840x560.webp"></a></div>



<a name="562760519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562760519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562760519">(Dec 09 2025 at 18:07)</a>:</h4>
<p>that all looks reasonable to me yeah <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="562764885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562764885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562764885">(Dec 09 2025 at 18:25)</a>:</h4>
<p>Ok, I think I really do need some broad guidance for the text parser. At the moment the accepted formats are:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"foo"</span><span class="w"> </span><span class="s">"bar"</span><span class="w"> </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"foo"</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="s">"bar"</span><span class="w"> </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="s">"baz"</span><span class="w"> </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"foo"</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="s">"bar"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="s">"baz"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span>
</code></pre></div>



<a name="562765316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562765316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562765316">(Dec 09 2025 at 18:27)</a>:</h4>
<p>When it comes to <code>impl Parse for Imports</code>, I really hardly know where to begin. I have to first distinguish between the single-item format and the compact formats, but then also if I don't see a type in the first item, I need to start buffering up names until the very end where we expect to see a type before the closing parentheses.</p>



<a name="562766132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562766132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562766132">(Dec 09 2025 at 18:30)</a>:</h4>
<p>Roughly that sounds about right to me, the results need to be buffered up no matter what as they're getting inserted into the AST. I can see how the parsing of the first item will be a bit wonky though, I think that you'll need to basically parse a full <code>item</code> before you go down one of the 3 parsing paths and then handle the first thing that was parsed a bit specially</p>



<a name="562766380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562766380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562766380">(Dec 09 2025 at 18:31)</a>:</h4>
<p>So for example in <code>Parse&lt;'a&gt; for Import&lt;'a&gt;</code> before parsing <code>field</code> you could peek to see if there's a string or a parenthesis, and that'll disambiguate "single" vs "compact", and if it's a paren you'd then parse <code>(item ...)</code> in a loop. That'd then get joined together into a similar enum that wasmparser has</p>



<a name="562766457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562766457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562766457">(Dec 09 2025 at 18:32)</a>:</h4>
<p>Sure, seems reasonable</p>



<a name="562766491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562766491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562766491">(Dec 09 2025 at 18:32)</a>:</h4>
<p>How do I peek for a paren? I assume <code>peek::&lt;something&gt;</code></p>



<a name="562766557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562766557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562766557">(Dec 09 2025 at 18:32)</a>:</h4>
<p><code>parser.peek::&lt;LParen&gt;()?</code></p>



<a name="562767093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767093">(Dec 09 2025 at 18:34)</a>:</h4>
<p>And for parsing items, should I just make a type that has <code>Option&lt;ItemSig&gt;</code> or something?</p>



<a name="562767369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767369">(Dec 09 2025 at 18:35)</a>:</h4>
<p>hm, so before I answer that, question for you, where does the <code>$foo</code> go in the <code>(item ...)</code> form?</p>



<a name="562767484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767484">(Dec 09 2025 at 18:35)</a>:</h4>
<p>e.g. <code>(import "foo" "bar" (global $foo i32))</code> is the "single" form</p>



<a name="562767501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767501">(Dec 09 2025 at 18:35)</a>:</h4>
<p>It doesn't</p>



<a name="562767565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767565">(Dec 09 2025 at 18:35)</a>:</h4>
<p>I originally thought it could go in the (item) but Rossberg said no</p>



<a name="562767656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767656">(Dec 09 2025 at 18:36)</a>:</h4>
<p>if you use this syntax you just don't get to use identifiers</p>



<a name="562767689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767689">(Dec 09 2025 at 18:36)</a>:</h4>
<p><em>shrug</em></p>



<a name="562767730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767730">(Dec 09 2025 at 18:36)</a>:</h4>
<p>I'm not thrilled about it but it might make for a good stage 4 bikeshed</p>



<a name="562767908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562767908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562767908">(Dec 09 2025 at 18:36)</a>:</h4>
<p>I think you'll skip <code>ItemSig</code> and use <code>ItemKind</code> directly in that case, since the sig is about containing an identifier</p>



<a name="562768018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562768018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562768018">(Dec 09 2025 at 18:37)</a>:</h4>
<p>so you'll want an enum of <code>Single(ItemSig), Compact1(Vec&lt;&amp;'a str, ItemKind&gt;), Compact2(ItemKind, Vec&lt;&amp;'a str&gt;)</code></p>



<a name="562768022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562768022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562768022">(Dec 09 2025 at 18:37)</a>:</h4>
<p>ish</p>



<a name="562768102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562768102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562768102">(Dec 09 2025 at 18:37)</a>:</h4>
<p><code>Single</code> would probably also have <code>&amp;'a str</code> for the field</p>



<a name="562768268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562768268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562768268">(Dec 09 2025 at 18:38)</a>:</h4>
<p>this'll cascade through the text resolver where you'll need to account for the compact forms introducing multiple items in the sense of adding to index spaces, but they'll all use <code>None</code> for their <code>$foo</code> name</p>



<a name="562769031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562769031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562769031">(Dec 09 2025 at 18:41)</a>:</h4>
<p>How do I conditionally parse either an (item "foo") or an ItemSig though?</p>



<a name="562769167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562769167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562769167">(Dec 09 2025 at 18:42)</a>:</h4>
<p>Hm ok actually, let me revise. You probably want to reuse <code>ItemSig</code> since it has the nitty-gritty of parsing types. You'll want to verify after-the-fact though that <code>id</code> is <code>None</code>.</p>
<p>Also, one change you'll need to make (or file an issue for) is that <code>wasmprinter</code> will need special logic to not print <code>$foo</code> names and instead print <code>(@name ...)</code> annotations</p>



<a name="562769267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562769267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562769267">(Dec 09 2025 at 18:42)</a>:</h4>
<p>For <code>(item ...)</code> vs <code>ItemSig</code>, you can use <code>parser.peek2::&lt;kw::item&gt;()?</code></p>



<a name="562769289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562769289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562769289">(Dec 09 2025 at 18:42)</a>:</h4>
<p>and if that's <code>false</code> you do an <code>ItemSig</code></p>



<a name="562770307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562770307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562770307">(Dec 09 2025 at 18:47)</a>:</h4>
<blockquote>
<p><code>wasmprinter</code> will need special logic to not print <code>$foo</code> names and instead print <code>(@name ...)</code> annotations</p>
</blockquote>
<p>I'm not following, what will the output need to look like?</p>



<a name="562770785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562770785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562770785">(Dec 09 2025 at 18:49)</a>:</h4>
<p>to clarify, I'm imagining a <code>name</code> section in a binary which indeed has a name for a compact-imported-thing and ideally <code>wasmprinter</code> would still reflect that somehow so the <code>name</code> section could get faithfully represented. In lieu of <code>$foo</code> the other option is <code>(@name "...")</code> so what I'd naviely expect is <code>(item "foo" (@name "bar"))</code></p>
<p>Although this could also be an open issue and for now names on the items could just get dropped</p>



<a name="562770879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562770879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562770879">(Dec 09 2025 at 18:49)</a>:</h4>
<p>I see, I think I will have to open an issue about that</p>



<a name="562770897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562770897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562770897">(Dec 09 2025 at 18:49)</a>:</h4>
<p>it's probably best to just drop names yeah and file an issue</p>



<a name="562776097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562776097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562776097">(Dec 09 2025 at 19:12)</a>:</h4>
<p>What is this text "resolver" thing?</p>



<a name="562779855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562779855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562779855">(Dec 09 2025 at 19:30)</a>:</h4>
<p>That'll be in <a href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wast/src/core/resolve">this folder</a> (<code>crates/wast/src/core/resolve/*.rs</code>) which figures out indices for <code>$foo</code> and such</p>
<p>You'll end up needing to modify <a href="https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/crates/wast/src/core/resolve/names.rs#L88-L96">this for example</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wast/src/core/resolve" style="background-image: url(&quot;https://uploads.zulipusercontent.net/abc4bf081f2addc6a0b08cf31cc211aaefa0dae5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323533346538666536613037353965643865323462626564646564613537323738633732346536636661636639323161626231636566613833323734643465322f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wast/src/core/resolve" title="wasm-tools/crates/wast/src/core/resolve at main · bytecodealliance/wasm-tools">wasm-tools/crates/wast/src/core/resolve at main · bytecodealliance/wasm-tools</a></div><div class="message_embed_description"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/crates/wast/src/core/resolve/names.rs#L88-L96" style="background-image: url(&quot;https://uploads.zulipusercontent.net/abc4bf081f2addc6a0b08cf31cc211aaefa0dae5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323533346538666536613037353965643865323462626564646564613537323738633732346536636661636639323161626231636566613833323734643465322f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/crates/wast/src/core/resolve/names.rs#L88-L96" title="wasm-tools/crates/wast/src/core/resolve/names.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools">wasm-tools/crates/wast/src/core/resolve/names.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div>



<a name="562993522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562993522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562993522">(Dec 10 2025 at 16:09)</a>:</h4>
<p>Thanks for the continued help here...for the <code>iter_item_sigs_mut</code>, would you recommend implementing it similarly to how you did the iterator for the wasmparser types?</p>



<a name="562994113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562994113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562994113">(Dec 10 2025 at 16:11)</a>:</h4>
<p>idiomatically, yeah that's what I'd recommend, but code-ease-wise it's probably easier to do something like <code>fn try_for_each_sig_mut(&amp;mut self, f: impl FnMut(&amp;mut ItemSig&lt;'a&gt;) -&gt; Result&lt;()&gt;) -&gt; Result&lt;()&gt; { ... }</code></p>



<a name="562994171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562994171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562994171">(Dec 10 2025 at 16:12)</a>:</h4>
<p>whichever you feel most comfortable with I think is reasonable</p>



<a name="562995102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562995102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562995102">(Dec 10 2025 at 16:15)</a>:</h4>
<p>To be honest I'm not really sure how to structure either one. Is this thing going to take mutable ownership of the <code>Imports</code> object? Or does it need to clone something? (Surely it can't do that if it needs to mutate things)</p>



<a name="562995765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562995765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562995765">(Dec 10 2025 at 16:18)</a>:</h4>
<p>yeah no cloning here, and the method would likely be <code>&amp;mut self</code> on <code>Imports</code> yeah</p>



<a name="562995854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562995854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562995854">(Dec 10 2025 at 16:18)</a>:</h4>
<p>I'm just wondering how that works if I need to return some kind of MutItemSigsIterator</p>



<a name="562995927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562995927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562995927">(Dec 10 2025 at 16:18)</a>:</h4>
<p>the easiest actually is probably <code>fn sigs_mut(&amp;mut self) -&gt; Vec&lt;&amp;mut ItemSig&lt;'a&gt;&gt;</code></p>



<a name="562996003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996003">(Dec 10 2025 at 16:19)</a>:</h4>
<p>and if we want to speed it up we can deal with that later (and it might well never be necessary)</p>



<a name="562996028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996028">(Dec 10 2025 at 16:19)</a>:</h4>
<p>hm that is appealing</p>



<a name="562996039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996039">(Dec 10 2025 at 16:19)</a>:</h4>
<p>I'll give that a try</p>



<a name="562996374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996374">(Dec 10 2025 at 16:20)</a>:</h4>
<p>one part about that to be aware of is that it's not suitable for "iterate over all import items introduced" because for the type-mentioned-once-names-mentioned-many-times compact form there's just one <code>ItemSig</code> and you can't push that onto a vector multiple times</p>



<a name="562996489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996489">(Dec 10 2025 at 16:21)</a>:</h4>
<p>ah right</p>



<a name="562996536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996536">(Dec 10 2025 at 16:21)</a>:</h4>
<p>well now I'm trying to think how that even works with the resolver or whatever</p>



<a name="562996686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996686">(Dec 10 2025 at 16:22)</a>:</h4>
<p>when I implemented this in spidermonkey I didn't actually have all the imports share a type, I would just go back and parse the common type bytes over and over again</p>



<a name="562996730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996730">(Dec 10 2025 at 16:22)</a>:</h4>
<p>seemingly that is not how it would work here</p>



<a name="562996836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996836">(Dec 10 2025 at 16:22)</a>:</h4>
<p>yeah for the text format at least I think we'll want to maintain the original AST to faithfully translate it to binary</p>



<a name="562996893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996893">(Dec 10 2025 at 16:23)</a>:</h4>
<p>for the resolver I think you'll want a plain old <code>match</code> on the imports and handle each case differently</p>



<a name="562996998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/562996998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#562996998">(Dec 10 2025 at 16:23)</a>:</h4>
<p>but my hope is that many other locations, like "expansion" can be "just gimme the sigs" since they don't care about indices and it's more about AST structure there</p>



<a name="563002222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563002222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563002222">(Dec 10 2025 at 16:46)</a>:</h4>
<p>More Rust noob questions: is it fundamentally wrong for me to iterate over &amp;Import when I am synthesizing these Import objects on the fly? <br>
<a href="/user_uploads/15107/uypOzGX9oq9V7skjaDhwnLdz/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/uypOzGX9oq9V7skjaDhwnLdz/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="904x470" src="/user_uploads/thumbnail/15107/uypOzGX9oq9V7skjaDhwnLdz/image.png/840x560.webp"></a></div>



<a name="563002677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563002677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563002677">(Dec 10 2025 at 16:48)</a>:</h4>
<p>if I change the iterator implementation back to this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Imports</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Import</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">IntoIter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>then that fixes the errors shown there, but then various uses of said iterator no longer seem to work well<br>
<a href="/user_uploads/15107/bMoiq1IJ9b4Ve28fo8JaC7sG/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/bMoiq1IJ9b4Ve28fo8JaC7sG/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="1108x305" src="/user_uploads/thumbnail/15107/bMoiq1IJ9b4Ve28fo8JaC7sG/image.png/840x560.webp"></a></div>



<a name="563003391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563003391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563003391">(Dec 10 2025 at 16:51)</a>:</h4>
<p>Of course, even this doesn't work because that would mean returning <code>Vec&lt;Import&lt;'a&gt;&gt;</code>, not <code>Vec&lt;&amp;Import&lt;'a&gt;&gt;</code> <span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span></p>



<a name="563003407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563003407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563003407">(Dec 10 2025 at 16:51)</a>:</h4>
<p><a href="/user_uploads/15107/6Z4zTYz64QrEtx5csB80k8ja/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/6Z4zTYz64QrEtx5csB80k8ja/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="872x308" src="/user_uploads/thumbnail/15107/6Z4zTYz64QrEtx5csB80k8ja/image.png/840x560.webp"></a></div>



<a name="563004980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563004980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563004980">(Dec 10 2025 at 16:57)</a>:</h4>
<p>ugh! and doing all that doesn't work because we push the names into other data structures<br>
<a href="/user_uploads/15107/JLxP7FsIqiX6qqj5_k8v-IGs/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/JLxP7FsIqiX6qqj5_k8v-IGs/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="745x335" src="/user_uploads/thumbnail/15107/JLxP7FsIqiX6qqj5_k8v-IGs/image.png/840x560.webp"></a></div>



<a name="563006914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563006914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563006914">(Dec 10 2025 at 17:05)</a>:</h4>
<p>I think I need to step back and figure out the right shape for all this</p>



<a name="563007080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563007080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563007080">(Dec 10 2025 at 17:06)</a>:</h4>
<p>Like what types should we even have in the text AST? Should I even have a unified Import type any more when that literally doesn’t appear in many places?</p>



<a name="563012402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012402">(Dec 10 2025 at 17:31)</a>:</h4>
<p>Hm ok yeah I agree you probably don't want <code>&amp;Import</code> or <code>Import</code> here since that doesn't exist for the compact forms. Some options I can think of are:</p>
<ul>
<li>Work with <code>&amp;ItemSig</code> primarily which does exist in the compact forms</li>
<li>"Expand", at parse time, the compact forms but retain metadata for during emission "hey compress this range of imports this way"</li>
</ul>



<a name="563012582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012582">(Dec 10 2025 at 17:32)</a>:</h4>
<p>The former sounds better if I can swing it</p>



<a name="563012591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012591">(Dec 10 2025 at 17:32)</a>:</h4>
<p>I guess that's all I can think of heh</p>



<a name="563012612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012612">(Dec 10 2025 at 17:32)</a>:</h4>
<p>and sigs_mut does seem to be good in several places</p>



<a name="563012653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012653">(Dec 10 2025 at 17:32)</a>:</h4>
<p>nice yeah</p>



<a name="563012697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012697">(Dec 10 2025 at 17:33)</a>:</h4>
<p>things like wast/src/somponent/binary.rs though I dunno</p>



<a name="563012839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012839">(Dec 10 2025 at 17:33)</a>:</h4>
<p>that might be a case where I should just have a big match on the text AST</p>



<a name="563012952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563012952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563012952">(Dec 10 2025 at 17:34)</a>:</h4>
<p>one option here, since this is semi-similar to resolve, is to have something like <code>fn ids(&amp;self) -&gt; Vec&lt;...&gt;</code></p>



<a name="563013041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013041">(Dec 10 2025 at 17:34)</a>:</h4>
<p>where that expands to a vec-the-length-of-items-introduced and that has the <code>m.id</code> and such, which would all be <code>None</code> for compact imports but <code>Some</code> for the single import case</p>



<a name="563013094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013094">(Dec 10 2025 at 17:34)</a>:</h4>
<p>that way the binary and resolve pass would do something like <code>for (id, name) in import.ids() { ... }</code></p>



<a name="563013385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013385">(Dec 10 2025 at 17:36)</a>:</h4>
<p>maybe something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Imports</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">all</span><span class="o">&lt;'</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Id</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">NameAnnotationThing</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="n">ItemSig</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>



<a name="563013454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013454">(Dec 10 2025 at 17:36)</a>:</h4>
<p>just so I'm clear, the resolve pass resolves identifiers to indices, and the binary pass converts the text AST to binary?</p>



<a name="563013556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013556">(Dec 10 2025 at 17:37)</a>:</h4>
<p>right yeah, although the binary pass is also dealing with indices sort of -- it has to build up the <code>name</code> section and it additionally does a thing with dwarf where it needs to know the number of imported functions</p>



<a name="563013862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013862">(Dec 10 2025 at 17:39)</a>:</h4>
<p>I think I'll start with some matches and see where that takes me</p>



<a name="563013949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563013949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563013949">(Dec 10 2025 at 17:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation/near/563013385">said</a>:</p>
<blockquote>
<p>maybe something like:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Imports</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">all</span><span class="o">&lt;'</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Id</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">NameAnnotationThing</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">b</span><span class="w"> </span><span class="n">ItemSig</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>
<p>This could be reasonable but I just feel like it's surely going to need the name info in the mix somewhere and who even knows</p>



<a name="563015540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563015540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563015540">(Dec 10 2025 at 17:48)</a>:</h4>
<p>sounds reasonable to me yeah</p>



<a name="563025687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563025687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563025687">(Dec 10 2025 at 18:44)</a>:</h4>
<p>Surely this is not what you have to do just to check if you have a feature?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">single_item_name</span><span class="p">,</span>
<span class="w">            </span><span class="n">discriminator</span><span class="p">,</span>
<span class="w">            </span><span class="cp">#[cfg(feature = </span><span class="s">"features"</span><span class="cp">)]</span>
<span class="w">            </span><span class="n">reader</span><span class="p">.</span><span class="n">features</span><span class="p">().</span><span class="n">compact_imports</span><span class="p">(),</span>
<span class="w">            </span><span class="cp">#[cfg(not(feature = </span><span class="s">"features"</span><span class="cp">))]</span>
<span class="w">            </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</code></pre></div>



<a name="563025747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563025747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563025747">(Dec 10 2025 at 18:44)</a>:</h4>
<p>But when I run <code>cargo check --no-default-features</code>, <code>reader.features()</code> doesn't exist</p>



<a name="563032028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563032028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563032028">(Dec 10 2025 at 19:17)</a>:</h4>
<p>you'll want to use <code>reader.compact_imports()</code>, there's some subtle handling there but the per-feature-methods are reexported on the <code>BinaryReader</code> itself</p>



<a name="563032142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563032142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563032142">(Dec 10 2025 at 19:18)</a>:</h4>
<p>ah I see</p>



<a name="563036635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563036635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563036635">(Dec 10 2025 at 19:45)</a>:</h4>
<p>What is the strategy for features in the text parser? Is there one?</p>



<a name="563037637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563037637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563037637">(Dec 10 2025 at 19:52)</a>:</h4>
<p>none, it just accepts everything and produces what it's given</p>



<a name="563038871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563038871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563038871">(Dec 10 2025 at 20:01)</a>:</h4>
<p>how in the world do I see where this is coming from? it seems like the text parse actually worked, but now I have a mystery error with no backtrace, and <code>--verbose</code> does absolutely nothing</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wat</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wasm</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">dev</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.06</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wat</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x3f</span><span class="p">)</span>
</code></pre></div>



<a name="563039442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563039442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563039442">(Dec 10 2025 at 20:05)</a>:</h4>
<p>huh that's odd!</p>



<a name="563039592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563039592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563039592">(Dec 10 2025 at 20:06)</a>:</h4>
<p>the source for that command is <a href="https://github.com/bytecodealliance/wasm-tools/blob/main/src/bin/wasm-tools/parse.rs#L48-L49">here</a> and you might need to add some printfs around there</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/blob/main/src/bin/wasm-tools/parse.rs#L48-L49" style="background-image: url(&quot;https://uploads.zulipusercontent.net/cd4f74c1855b2e7d087282d8609e2d0e38a4373d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366336383464363636356162306132633161346664396466386266333466393363353039303432346565396636363536366663623363383033376666613831662f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/blob/main/src/bin/wasm-tools/parse.rs#L48-L49" title="wasm-tools/src/bin/wasm-tools/parse.rs at main · bytecodealliance/wasm-tools">wasm-tools/src/bin/wasm-tools/parse.rs at main · bytecodealliance/wasm-tools</a></div><div class="message_embed_description"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div>



<a name="563039639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563039639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563039639">(Dec 10 2025 at 20:06)</a>:</h4>
<p>that looks like a wasmparser-style error but I'm not entirely sure where wasmparser would be activated in the text-to-binary transform...</p>



<a name="563040044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563040044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563040044">(Dec 10 2025 at 20:09)</a>:</h4>
<p>there's no way I can, like, use a real debugger?</p>



<a name="563040061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563040061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563040061">(Dec 10 2025 at 20:09)</a>:</h4>
<p>the surface area of wasm-tools is enormous</p>



<a name="563040410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563040410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563040410">(Dec 10 2025 at 20:11)</a>:</h4>
<p>oh sure you can use gdb and set breakpoints and such too</p>



<a name="563040472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563040472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563040472">(Dec 10 2025 at 20:12)</a>:</h4>
<p>the usual rust debugging instructions for vs code seemingly don't work at all, so that's nice</p>



<a name="563040476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563040476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563040476">(Dec 10 2025 at 20:12)</a>:</h4>
<p>back to printfs for me</p>



<a name="563040875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563040875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563040875">(Dec 10 2025 at 20:14)</a>:</h4>
<p>surely you are not just putting printfs everywhere whenever you see a bug like this? surely you have some kind of stack trace at least?</p>



<a name="563041646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563041646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563041646">(Dec 10 2025 at 20:19)</a>:</h4>
<p>depends on the error, most errors I personally debug have a pretty clear source. I'm not sure where this is coming from so I'd resort to printfs for this since I don't know off the top of my head where it's coming from</p>



<a name="563041928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563041928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563041928">(Dec 10 2025 at 20:21)</a>:</h4>
<p>oh...it's doing weird things because for some reason <code>wasm-tools parse</code> will run the resulting wasm through the binary parser without features enabled</p>



<a name="563041964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563041964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563041964">(Dec 10 2025 at 20:22)</a>:</h4>
<p>why in the world? can I <em>not</em> do that please?</p>



<a name="563041997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563041997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563041997">(Dec 10 2025 at 20:22)</a>:</h4>
<p>or can I turn features on somehow?</p>



<a name="563042093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563042093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563042093">(Dec 10 2025 at 20:22)</a>:</h4>
<p>the <code>parse</code> command doesn't seem to accept features in any way I can tell</p>



<a name="563042711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563042711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563042711">(Dec 10 2025 at 20:27)</a>:</h4>
<p>do you have the line the error is being generated from?</p>



<a name="563042807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563042807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563042807">(Dec 10 2025 at 20:27)</a>:</h4>
<p>I think it's literally just that the new compact import encoding, produced by the new text format, is being parsed as if it was not the compact import encoding, and doing Mysterious Things (reading too far in the resulting binary)</p>



<a name="563042813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563042813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563042813">(Dec 10 2025 at 20:27)</a>:</h4>
<p>which seems baffling</p>



<a name="563042851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563042851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563042851">(Dec 10 2025 at 20:28)</a>:</h4>
<p>I just want it to produce the binary, not produce the binary and then explode because it produced a binary with new features</p>



<a name="563042949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563042949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563042949">(Dec 10 2025 at 20:28)</a>:</h4>
<p>this is why I was asking about features in the text format...it would be ok if the text parsing failed on the new syntax, or if the text parsing succeeded but it _didn't_ do this broken validation step, but it seems we have the worst of both worlds and I'm confused</p>



<a name="563043500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563043500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563043500">(Dec 10 2025 at 20:32)</a>:</h4>
<p>Do you have a branch/repro I can poke at? I can try to help hunt this down and see if this is uncovering a preexisting bug in wasm-tools or something that can be improved</p>



<a name="563043532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563043532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563043532">(Dec 10 2025 at 20:32)</a>:</h4>
<p>I'll push what I have + a test file</p>



<a name="563046325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563046325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563046325">(Dec 10 2025 at 20:41)</a>:</h4>
<p>looks like you want to comment out <a href="https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/src/lib.rs#L222">this line</a> and running <code>dump</code> on the produced <code>*.wasm</code> yields:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="mh">0x0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">61</span><span class="w"> </span><span class="mi">73</span><span class="w"> </span><span class="mi">6</span><span class="n">d</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">Module</span><span class="p">)</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span>
<span class="w">  </span><span class="mh">0x8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">09</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">section</span>
<span class="w">  </span><span class="mh">0xa</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">02</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">count</span>
<span class="o">---</span><span class="w"> </span><span class="n">rec</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">implicit</span><span class="p">)</span><span class="w"> </span><span class="o">---</span>
<span class="w">  </span><span class="mh">0xb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">7</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="k">type</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">SubType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">is_final</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span><span class="w"> </span><span class="n">supertype_idx</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">composite_type</span><span class="p">:</span><span class="w"> </span><span class="nc">CompositeType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">inner</span><span class="p">:</span><span class="w"> </span><span class="nc">Func</span><span class="p">(</span><span class="n">FuncType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">I32</span><span class="p">],</span><span class="w"> </span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="n">shared</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">descriptor_idx</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">describes_idx</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="o">---</span><span class="w"> </span><span class="n">rec</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">implicit</span><span class="p">)</span><span class="w"> </span><span class="o">---</span>
<span class="w">  </span><span class="mh">0xf</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">7</span><span class="n">e</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="k">type</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SubType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">is_final</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span><span class="w"> </span><span class="n">supertype_idx</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">composite_type</span><span class="p">:</span><span class="w"> </span><span class="nc">CompositeType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">inner</span><span class="p">:</span><span class="w"> </span><span class="nc">Func</span><span class="p">(</span><span class="n">FuncType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">I64</span><span class="p">],</span><span class="w"> </span><span class="n">results</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="n">shared</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span><span class="w"> </span><span class="n">descriptor_idx</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">describes_idx</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="mh">0x13</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">section</span>
<span class="w"> </span><span class="mh">0x15</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">04</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">count</span>
<span class="w"> </span><span class="mh">0x16</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="p">[</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">Import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">module</span><span class="p">:</span><span class="w"> </span><span class="s">"foo"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"bar"</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">Func</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="mi">61</span><span class="w"> </span><span class="mi">72</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span>
<span class="w"> </span><span class="mh">0x20</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="p">[</span><span class="n">func</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">Import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">module</span><span class="p">:</span><span class="w"> </span><span class="s">"foo"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"baz"</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">Func</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="mi">61</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span>
<span class="o">---</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="p">(</span><span class="n">common</span><span class="w"> </span><span class="n">module</span><span class="p">)</span><span class="w"> </span><span class="o">---</span>
<span class="w"> </span><span class="mh">0x2a</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="p">:</span><span class="w"> </span><span class="s">"foo"</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">7</span><span class="n">f</span><span class="w"> </span><span class="mi">02</span>
<span class="w"> </span><span class="mh">0x31</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="mi">65</span><span class="w"> </span><span class="mi">65</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="p">[</span><span class="n">func</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">ImportItemCompact</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"beep"</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">Func</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">01</span>
<span class="w"> </span><span class="mh">0x38</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="p">[</span><span class="n">func</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="n">ImportItemCompact</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"boop"</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">Func</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">01</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unexpected</span><span class="w"> </span><span class="n">end</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x3f</span><span class="p">)</span>
</code></pre></div>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/src/lib.rs#L222" style="background-image: url(&quot;https://uploads.zulipusercontent.net/cd4f74c1855b2e7d087282d8609e2d0e38a4373d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366336383464363636356162306132633161346664396466386266333466393363353039303432346565396636363536366663623363383033376666613831662f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/blob/6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366/src/lib.rs#L222" title="wasm-tools/src/lib.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools">wasm-tools/src/lib.rs at 6325cc4a73eca6b9bd9c71d4a2c4e9b4a7c8b366 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - bytecodealliance/wasm-tools</div></div></div>



<a name="563051454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/563051454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#563051454">(Dec 10 2025 at 20:56)</a>:</h4>
<p>ah, it was actually an incorrect count in the import section <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="566586440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/566586440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#566586440">(Jan 06 2026 at 17:07)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> Is there a timeline for the next release? I'm hoping to present the proposal in CG next week and would like to have our SpiderMonkey implementation landed by then.</p>



<a name="566594552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/566594552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#566594552">(Jan 06 2026 at 17:56)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasm-tools?tab=readme-ov-file#versioning-and-releases">No release cadence</a>, just done on an as-needed basis</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools?tab=readme-ov-file#versioning-and-releases" style="background-image: url(&quot;https://uploads.zulipusercontent.net/982b2134c6db38343de9fa2d9b70273095c70a32/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613365373765373765353763366637326435353934653437323232333430613561346565643963346631326161363134396261353533623936323538656265632f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools?tab=readme-ov-file#versioning-and-releases" title="GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules">GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules</a></div><div class="message_embed_description"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules</div></div></div>



<a name="566594584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/566594584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#566594584">(Jan 06 2026 at 17:56)</a>:</h4>
<p>I'll try to get around to pushing the buttons today</p>



<a name="566594598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/566594598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#566594598">(Jan 06 2026 at 17:56)</a>:</h4>
<p>Thanks!</p>



<a name="566610893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/511605-wasm-tools/topic/Compact%20import%20section%20proposal%20implementation/near/566610893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/511605-wasm-tools/topic/Compact.20import.20section.20proposal.20implementation.html#566610893">(Jan 06 2026 at 19:45)</a>:</h4>
<p>ok a <a href="https://github.com/bytecodealliance/wasm-tools/releases/tag/v1.244.0">new release has been made</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/releases/tag/v1.244.0" style="background-image: url(&quot;https://uploads.zulipusercontent.net/cee547e40375669b5b4c785c350df5e96a503c13/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343434643235626663623761306330313034623938306661616430353231333330396635316134633435366533613539376234363862303835623565623962322f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f72656c65617365732f7461672f76312e3234342e30&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/releases/tag/v1.244.0" title="Release v1.244.0 · bytecodealliance/wasm-tools">Release v1.244.0 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">What's Changed

Remove backpressure.set by @alexcrichton in #2397
Improve error message for missing wasi-sdk by @alexcrichton in #2400
Increase MSRV to 1.81.0 by @alexcrichton in #2402
Make wasm-wa...</div></div></div>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>