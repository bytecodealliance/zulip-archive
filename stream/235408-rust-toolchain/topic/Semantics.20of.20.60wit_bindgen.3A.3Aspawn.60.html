<html>
<head><meta charset="utf-8"><title>Semantics of `wit_bindgen::spawn` · rust-toolchain · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/index.html">rust-toolchain</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html">Semantics of `wit_bindgen::spawn`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="544556324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544556324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544556324">(Oct 13 2025 at 13:40)</a>:</h4>
<p><a href="https://docs.rs/wit-bindgen/0.46.0/wit_bindgen/fn.spawn.html">https://docs.rs/wit-bindgen/0.46.0/wit_bindgen/fn.spawn.html</a></p>
<blockquote>
<p>Defer the specified future to be run after the current async-lifted export task has returned a value.</p>
</blockquote>
<p>IIUC this means that the spawning task will deadlock if it waits on something that the spawned task will do, right? That makes sense to me but I wonder if we should name this something other than <code>spawn</code> since you can't use it for things that you would naturally use thread or tokio <code>spawn</code> for. How about <code>defer</code>?</p>



<a name="544557401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544557401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544557401">(Oct 13 2025 at 13:44)</a>:</h4>
<p>Relatedly, would it make sense to include a basic <code>wit_bindgen::join(fut_a, fut_b)</code>? You can always pull in e.g. <code>futures-lite</code> but this seems fundamental enough that it might be worth including anyway.</p>



<a name="544566446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544566446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544566446">(Oct 13 2025 at 14:23)</a>:</h4>
<p>The wording here isn't quite right, your situation wouldn't deadlock because it actually progresses both tasks concurrently - needs a doc update</p>



<a name="544566538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544566538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544566538">(Oct 13 2025 at 14:23)</a>:</h4>
<p>And yeah having some simple future combinators seems reasonable to me</p>



<a name="544566948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544566948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544566948">(Oct 13 2025 at 14:25)</a>:</h4>
<p>Did this change since 0.46?</p>



<a name="544567059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544567059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544567059">(Oct 13 2025 at 14:26)</a>:</h4>
<p>I blamed a deadlock on this, just curious if I was mistaken.</p>



<a name="544569440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544569440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544569440">(Oct 13 2025 at 14:37)</a>:</h4>
<p>nah it's always been the case that spawned tasks progress in parallel with the main task</p>



<a name="544589654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544589654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544589654">(Oct 13 2025 at 16:30)</a>:</h4>
<p>fun fact: futures-lite doesnt even include join :(</p>



<a name="544589702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544589702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544589702">(Oct 13 2025 at 16:30)</a>:</h4>
<p>It calls it <code>zip</code> <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="544589842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544589842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544589842">(Oct 13 2025 at 16:31)</a>:</h4>
<p>whaaaaaaa</p>



<a name="544589855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Semantics%20of%20%60wit_bindgen%3A%3Aspawn%60/near/544589855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Semantics.20of.20.60wit_bindgen.3A.3Aspawn.60.html#544589855">(Oct 13 2025 at 16:31)</a>:</h4>
<p>god dammit why did they do that</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>