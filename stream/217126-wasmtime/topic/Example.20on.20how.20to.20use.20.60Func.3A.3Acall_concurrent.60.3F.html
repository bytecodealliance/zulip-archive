<html>
<head><meta charset="utf-8"><title>Example on how to use `Func::call_concurrent`? · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html">Example on how to use `Func::call_concurrent`?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="566850482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/566850482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#566850482">(Jan 08 2026 at 01:06)</a>:</h4>
<p>Hi everyone. I've updated wasmtime from v27 to v40 aiming to call component functions concurrently (as part of the same Store instance, with dynamically linked components). e.g. say I have WASI CLI A and WASI CLI B and want to run both components concurrently that share the same store and can also communicate between each other.</p>
<p>I'm trying to implement <a href="https://docs.rs/wasmtime/latest/wasmtime/component/struct.Func.html#method.call_concurrent"><code>Func::call_concurrent</code></a> -- does anyone know if there are any examples for this? I'm not sure if it's possible to do what I'm thinking, perhaps I'd need multiple Stores and to manage the data replication from the host?</p>



<a name="566968487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/566968487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#566968487">(Jan 08 2026 at 15:21)</a>:</h4>
<p>Most examples at this time will be throughout Wasmtime's test suite, we don't have dedicated examples for this just yet.</p>
<p>You'll be able to use one store and you'll be using <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.StoreContextMut.html#method.run_concurrent"><code>run_concurrent</code></a> to get an <code>Accessor</code> which from there you can call <code>call_concurrent</code></p>



<a name="567049639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567049639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567049639">(Jan 08 2026 at 23:28)</a>:</h4>
<p>I see. That sounds good, thanks!</p>



<a name="567360344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567360344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567360344">(Jan 11 2026 at 02:23)</a>:</h4>
<p>I've tried a few different things so far but I only see the components running serially rather than concurrently. It just picks one of 2 components and runs that indefinitely. </p>
<p>Here's the example component. I'm running two instances of this to test concurrency.<br>
<a href="/user_uploads/15107/b4NJL3XfDrZnzDtrW3qpFfTU/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/b4NJL3XfDrZnzDtrW3qpFfTU/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="814x673" src="/user_uploads/thumbnail/15107/b4NJL3XfDrZnzDtrW3qpFfTU/image.png/840x560.webp"></a></div><p>So I'd expect to see 2 different program numbers appearing in stdout every second. But only one component is running.</p>
<p><a href="/user_uploads/15107/xYThBB2xSMU9th7lCzubswig/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/xYThBB2xSMU9th7lCzubswig/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="297x267" src="/user_uploads/thumbnail/15107/xYThBB2xSMU9th7lCzubswig/image.png/840x560.webp"></a></div><p>I've tried different ways to join the tasks, for example like below taken from wasmtime tests.</p>
<p><a href="/user_uploads/15107/bKKfXq2M16erh3B36RcdNosI/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/bKKfXq2M16erh3B36RcdNosI/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="1083x494" src="/user_uploads/thumbnail/15107/bKKfXq2M16erh3B36RcdNosI/image.png/840x560.webp"></a></div><p>Do I have the wrong idea here, Is it not possible to run 2 CLI programs in WASI concurrently? or am I just doing it wrong?</p>



<a name="567420149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567420149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567420149">(Jan 11 2026 at 22:31)</a>:</h4>
<p>You're running into <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.StoreContextMut.html#store-blocking-behavior">this clause of the documentation</a> which is that using <code>tokio</code> in the guest induces "store blocking behavior" which means concurrency doesn't work inside of <code>run_concurrent</code></p>



<a name="567420168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567420168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567420168">(Jan 11 2026 at 22:31)</a>:</h4>
<p>Unfortunately there's no great solution for that at this time, it's one that we need to work on within Wasmtime itself</p>



<a name="567421286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567421286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567421286">(Jan 11 2026 at 22:49)</a>:</h4>
<p>Oh ok. Thanks for letting me know! Looks like the fix is planned to be included with wasip3, is that right? I'd be happy to help with implementing this.</p>



<a name="567589552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567589552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567589552">(Jan 12 2026 at 16:50)</a>:</h4>
<p>Hey just wanted to note <span class="user-mention" data-user-id="755747">@Lorenzo</span> , a doc comment would probably be appreciated if you were willing to contribute one in the meantime! </p>
<p>If you went to the rust docs and would have benefitted from seeing a guide to how to use <code>call_concurrent</code> maybe some docs near there would be useful?</p>



<a name="567663803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567663803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo Fontoura <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567663803">(Jan 13 2026 at 00:05)</a>:</h4>
<p>Opened here <a href="https://github.com/bytecodealliance/wasmtime/pull/12330">https://github.com/bytecodealliance/wasmtime/pull/12330</a> :)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/12330" style="background-image: url(&quot;https://uploads.zulipusercontent.net/082eb6d34f2a77893f6c7498622332a47b55ef3e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653834626539353130346334346333386330303831313433346263326635396239303137343933336563616134613064386330303132653261326635363034382f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3132333330&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/12330" title="Update Func &amp; TypedFunc's doc comments to explain  Accessor and Store::run_concurrent by rellfy · Pull Request #12330 · bytecodealliance/wasmtime">Update Func &amp; TypedFunc's doc comments to explain  Accessor and Store::run_concurrent by rellfy · Pull Request #12330 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">We read every piece of feedback, and take your input very seriously.</div></div></div>



<a name="567849051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Example%20on%20how%20to%20use%20%60Func%3A%3Acall_concurrent%60%3F/near/567849051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Example.20on.20how.20to.20use.20.60Func.3A.3Acall_concurrent.60.3F.html#567849051">(Jan 13 2026 at 19:59)</a>:</h4>
<p>Amazing job <span class="user-mention" data-user-id="755747">@Lorenzo Fontoura</span>!</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>