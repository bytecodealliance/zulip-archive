<html>
<head><meta charset="utf-8"><title>wasmtime serve instance reuse CLI options · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html">wasmtime serve instance reuse CLI options</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="544212021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544212021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544212021">(Oct 10 2025 at 16:45)</a>:</h4>
<p>I'm adding WASIp3 instance reuse options to the <code>wasmtime serve</code> CLI as part of <a href="https://github.com/bytecodealliance/wasmtime/pull/11807">https://github.com/bytecodealliance/wasmtime/pull/11807</a>, including:</p>
<ul>
<li>max number of requests to handle using a single instance</li>
<li>max number of concurrent requests to handle using a single instance</li>
<li>how long an instance can sit idle before we drop it</li>
</ul>
<p>Any opinions about where these should go in the CLI, e.g. under <code>-W</code>, <code>-S</code>, or at the top level?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/11807" style="background-image: url(&quot;https://uploads.zulipusercontent.net/32df4809a633a395f861b14edc44d7acb57dc60e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353731653939303666393832613862303633663164336333373135626161333564343363303963306231303538663535396663353562663039393663636631302f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3131383037&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/11807" title="support WASIp3 instance reuse in `wasmtime serve` by dicej · Pull Request #11807 · bytecodealliance/wasmtime">support WASIp3 instance reuse in `wasmtime serve` by dicej · Pull Request #11807 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">This is a draft implementation of WASIp3 instance reuse.  Previously, we used one store and one instance per request for both p2 and p3 handlers, discarding the store and instance immediately after...</div></div></div>



<a name="544214668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544214668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544214668">(Oct 10 2025 at 17:04)</a>:</h4>
<p>I dont think these options belong under -W (wasm features)</p>



<a name="544214735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544214735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544214735">(Oct 10 2025 at 17:04)</a>:</h4>
<p>putting them under -S is really down to whether theres a possible interpretation of them in <code>wasmtime run</code> or <code>wasmtime wizer</code> etc which I expect the answer is no</p>



<a name="544214763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544214763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544214763">(Oct 10 2025 at 17:04)</a>:</h4>
<p>I agree, although currently setting a timeout requires <code>-Wtimeout=N</code> which surprised me a little.</p>



<a name="544214808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544214808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544214808">(Oct 10 2025 at 17:05)</a>:</h4>
<p>oh, huh, yeah i wouldnt have expected time out to be under -W either!</p>



<a name="544215130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544215130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544215130">(Oct 10 2025 at 17:07)</a>:</h4>
<p>i wouldnt complain if there was a top level --timeout= for wasmtime serve that was an alias for -Wtimeout=, just for the sake of discoverability....</p>



<a name="544215295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544215295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544215295">(Oct 10 2025 at 17:08)</a>:</h4>
<p>but thats an aside. i guess id like to see these as top level <code>wasmtime serve</code> options, and the max requests to handle using a single instance, and how long an instance can sit idle, could be reused for p2 as well</p>



<a name="544215388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544215388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544215388">(Oct 10 2025 at 17:08)</a>:</h4>
<p>thats a long standing request for wasmtime cli to support, and of course more and more (by which i mean the two private ones im responsible for) embeddings are making instance reuse a tunable knob these days</p>



<a name="544215415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544215415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544215415">(Oct 10 2025 at 17:08)</a>:</h4>
<p>Yeah, adding support for (non-concurrent) reuse for p2 isn't a priority for me right now, but definitely makes sense</p>



<a name="544215509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544215509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544215509">(Oct 10 2025 at 17:09)</a>:</h4>
<p>well once you have the options in there ill add the p2 reuse implementation</p>



<a name="544216776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544216776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544216776">(Oct 10 2025 at 17:17)</a>:</h4>
<p>The intention for <code>-W</code> was "things affecting wasm runtime semantics" which is why timeouts/features are there as well as things like determinism/nan canonicalization/etc</p>



<a name="544216893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544216893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544216893">(Oct 10 2025 at 17:18)</a>:</h4>
<p>The downside of <code>-S</code> or <code>-W</code> or such is that they show up on all commands while only being relevant to <code>serve</code>, so I'd lean towards what Pat is thinking as well with top-level commands</p>



<a name="544216927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544216927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544216927">(Oct 10 2025 at 17:19)</a>:</h4>
<p>we could perhaps entertain a <code>-P</code> or <code>--proxy</code> for <code>wasmtime-serve</code> specific options</p>



<a name="544216954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/wasmtime%20serve%20instance%20reuse%20CLI%20options/near/544216954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/wasmtime.20serve.20instance.20reuse.20CLI.20options.html#544216954">(Oct 10 2025 at 17:19)</a>:</h4>
<p>but if the man page for <code>wasmtime serve</code> is long that's also not the end of the world</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>