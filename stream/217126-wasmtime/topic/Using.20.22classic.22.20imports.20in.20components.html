<html>
<head><meta charset="utf-8"><title>Using &quot;classic&quot; imports in components · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Using.20.22classic.22.20imports.20in.20components.html">Using &quot;classic&quot; imports in components</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="541649851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Using%20%22classic%22%20imports%20in%20components/near/541649851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antoine Lavandier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Using.20.22classic.22.20imports.20in.20components.html#541649851">(Sep 26 2025 at 11:56)</a>:</h4>
<p>I'm using <code>no-std</code> and the component model and right now <code>component-model-async</code> requires std but the <code>async</code> feature doesn't. Also <code>Component::LinkerInstance::func_wrap_async</code> only requires the <code>async</code>feature. So my idea to put some async functionality was to: </p>
<ul>
<li>In my component, on top of the stuff generated by <code>wit_bindgen::generate</code>  add an <code>unsafe extern "C" {}</code> block with the async functions</li>
<li>On the host side, use <code>linker.root().func_wrap_async</code> to provide the function. <br>
The first point fails at the componentization step.  Is this way doomed ? Is there a better way to do this ?</li>
</ul>



<a name="541735163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Using%20%22classic%22%20imports%20in%20components/near/541735163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Using.20.22classic.22.20imports.20in.20components.html#541735163">(Sep 26 2025 at 19:45)</a>:</h4>
<p>Can you describe more what you're trying to do? Without an error message or a reproduction it's tough to reach a conclusion such as "yeah this isn't supported" vs "oh just tweak this that's a minor configuration error" or anything inbetween</p>



<a name="541965382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Using%20%22classic%22%20imports%20in%20components/near/541965382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antoine Lavandier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Using.20.22classic.22.20imports.20in.20components.html#541965382">(Sep 29 2025 at 07:54)</a>:</h4>
<p>Basically, I was trying to turn this kind of (rust) file into a component: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// imports</span>
<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="p">(</span><span class="s">"world"</span><span class="p">);</span>

<span class="c1">// implement Guest Trait etc...</span>

<span class="cp">#[link(wasm_import_module = </span><span class="s">"foo"</span><span class="cp">)]</span>
<span class="k">unsafe</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">fn</span><span class="w"> </span><span class="nf">bar</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>The reason why I'm trying to do this is to manually bind "[foo]bar" using <code>component::Linker::func_wrap_aysnc</code> to circumvent using the <code>component-model-async</code> feature. </p>
<p>In any case, compiling such a file to Wasm works but running <code>wasm-tools component new</code> fails with </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">::</span><span class="n">bar</span><span class="err">`</span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="err">`</span>
</code></pre></div>



<a name="542003663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Using%20%22classic%22%20imports%20in%20components/near/542003663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Using.20.22classic.22.20imports.20in.20components.html#542003663">(Sep 29 2025 at 10:52)</a>:</h4>
<p>The component model doesn't support importing/exporting core wasm functions: you have to wrap the function in a component export instead.</p>
<p>I'm not sure I entirely follow what you're trying to do wrt async, but note that you can in principle generate C bindings for your interface and then implement them in largely the same way you're trying to use core wasm functions here</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>