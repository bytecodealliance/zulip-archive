<html>
<head><meta charset="utf-8"><title>Understanding `Host` traits when linking imports · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Understanding.20.60Host.60.20traits.20when.20linking.20imports.html">Understanding `Host` traits when linking imports</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="539356517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Understanding%20%60Host%60%20traits%20when%20linking%20imports/near/539356517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan H <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Understanding.20.60Host.60.20traits.20when.20linking.20imports.html#539356517">(Sep 13 2025 at 19:40)</a>:</h4>
<p>I am struggling to understand the <code>Host</code> trait requirements when using <code>wasmtime::component::bindgen!</code> and linking wasm component imports.</p>
<p>I have a world which imports <code>wasi:io</code> so that I can use <code>input-stream</code> for communicating with the component. <code>input-stream</code> requires <code>wasi:io/poll</code>, <code>wasi:io/streams</code>, and <code>wasi:io/error</code>. I've included the <code>.wit</code> files for those in my <code>wit</code> folder. Everything works well until I try to add my imports to the linker with <code>World::add_to_linker</code>.</p>
<p>When I call <code>add_to_linker</code>, I receive errors like <code>the trait bound </code>MyState: wasmtime_wasi::p2::bindings::io::error::Host<code> is not satisfied</code>. I have figured out a work around that requires a few things that seem odd based on the examples and documentation I've read. The work around involves:</p>
<ol>
<li>Defining <code>WorldImports</code> for <code>ResourceTable</code></li>
<li>Returning a <code>&amp;mut</code> to the <code>ResourceTable</code> of <code>MyState</code> in the closure passed to the <code>add_to_linker</code> call</li>
<li>Using <code>with</code> in the <code>bindgen!</code> call and providing import paths for <code>wasi:io/poll</code>, <code>wasi:io/streams</code>, and <code>wasi:io/error</code></li>
<li>Allowing shadowing in the linker with <code>linker.allow_shadowing(true)</code></li>
</ol>
<p>My questions are:</p>
<ol>
<li>Why do I have to <code>impl WorldImports</code> on <code>ResourceTable</code> rather than <code>MyState</code> like I see in other examples? And why do I have to return a <code>&amp;mut</code> to the <code>ResourceTable</code> in my <code>add_to_linker</code> closure rather than a <code>&amp;mut</code> to MyState like I see in other examples?</li>
<li>How can I generate the rust bindings/impls for <code>wasi:io/poll</code>, <code>wasi:io/streams</code>, and <code>wasi:io/error</code> without having them defined twice in the linker? I call <code>wasmtime_wasi::p2::add_to_linker_async(&amp;mut linker)?;</code> to satisfy the wasm interfaces. When coupled with the use of <code>with</code> in <code>bindgen!</code>, it results in them being defined twice. But if I don't use <code>with</code> in <code>bindgen!</code>, I don't get the implementation on the rust side.</li>
</ol>



<a name="539568063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Understanding%20%60Host%60%20traits%20when%20linking%20imports/near/539568063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Understanding.20.60Host.60.20traits.20when.20linking.20imports.html#539568063">(Sep 15 2025 at 14:04)</a>:</h4>
<p>Hello! I think you're running into a similar issue as this thread -- <a class="message-link" href="/#narrow/channel/217126-wasmtime/topic/WorldType.3A.3Aadd_to_linker.20including.20WASI.20imports/near/538455001">#wasmtime &gt; WorldType::add_to_linker including WASI imports @ 💬</a>  -- where you have WIT bits but you kind of want to skip them in the generated <code>add_to_linker</code>. Right now that's not implemented but having such an implementation seems reasonable to me.</p>



<a name="541106344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Understanding%20%60Host%60%20traits%20when%20linking%20imports/near/541106344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan H <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Understanding.20.60Host.60.20traits.20when.20linking.20imports.html#541106344">(Sep 23 2025 at 21:50)</a>:</h4>
<p>Okay. Any tips for understanding what the Host impls are actually doing? I can kind of understand the guest side, but figuring out what the Store and Linker are actually doing in order to satisfy lifetime and trait requirements is overwhelming me. I’d like to get to a point where I can implement my own stream to pass into a guest instead of using <code>DuplexStream</code> from <code>tokio</code> if that helps narrow the scope at all.</p>



<a name="541109043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Understanding%20%60Host%60%20traits%20when%20linking%20imports/near/541109043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Understanding.20.60Host.60.20traits.20when.20linking.20imports.html#541109043">(Sep 23 2025 at 22:11)</a>:</h4>
<p>my suggestion, as the author of <code>wasmtime-wasi-io</code>, is to read the source of that crate and then see if you can use it for your purposes</p>



<a name="541109306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Understanding%20%60Host%60%20traits%20when%20linking%20imports/near/541109306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Understanding.20.60Host.60.20traits.20when.20linking.20imports.html#541109306">(Sep 23 2025 at 22:13)</a>:</h4>
<p><code>AsyncReadStream</code> and <code>AsyncWriteStream</code> from <a href="https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/pipe/index.html">https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/p2/pipe/index.html</a> may also be useful <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/p2/pipe.rs">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/p2/pipe.rs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/p2/pipe.rs" style="background-image: url(&quot;https://uploads.zulipusercontent.net/166ddc3b8b844a4c6fd715eda31e3729c8ef204d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636532623139646235313766373336366164646337313466396335653338373437636537643865396162376166383062643131326664656465303337353033332f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi/src/p2/pipe.rs" title="wasmtime/crates/wasi/src/p2/pipe.rs at main · bytecodealliance/wasmtime">wasmtime/crates/wasi/src/p2/pipe.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>