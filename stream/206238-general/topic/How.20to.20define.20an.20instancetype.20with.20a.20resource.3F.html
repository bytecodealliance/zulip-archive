<html>
<head><meta charset="utf-8"><title>How to define an instancetype with a resource? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/How.20to.20define.20an.20instancetype.20with.20a.20resource.3F.html">How to define an instancetype with a resource?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="562562857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/How%20to%20define%20an%20instancetype%20with%20a%20resource%3F/near/562562857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/How.20to.20define.20an.20instancetype.20with.20a.20resource.3F.html#562562857">(Dec 08 2025 at 21:39)</a>:</h4>
<p>How do I generate a instance type definition that includes a resource?</p>
<p>I have a wit interface like:</p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>    interface df-interface {
        resource data-frame;
        fromcsv: func(path: string) -&gt; data-frame;
        show: func(frame: data-frame) -&gt; s64;
    }
</code></pre></div>
<p>My compiler generates an instance type like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span>
<span class="w">               </span><span class="p">(</span><span class="n">instance</span>
<span class="w">                 </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">resource</span><span class="w"> </span><span class="p">(</span><span class="n">rep</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="s">"DataFrame"</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">eq</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">2</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="s">"path"</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="s">"fromcsv"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">3</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">resource</span><span class="w"> </span><span class="p">(</span><span class="n">rep</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">4</span><span class="p">;)</span><span class="w"> </span><span class="s">"DataFrame"</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">eq</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">5</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="s">"frame"</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="n">s64</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="s">"show"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">5</span><span class="p">)))</span>
<span class="w">               </span><span class="p">)</span>
<span class="w">             </span><span class="p">)</span>
</code></pre></div>
<p>The idea is that I can then import an instance of that type. However the wasmparser validation reports that resources can only be defined in concrete components (i.e. not from within the instance type definition)</p>
<p>I don't see another way to define the instance type while defining the resource outside of it. </p>
<p>Do I need to define these functions as methods on the dataframe resource? I plan to have many _constructors_ of a data-frame resource i.e. fromjson etc. So I decided it best to define functions instead.</p>



<a name="562563216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/How%20to%20define%20an%20instancetype%20with%20a%20resource%3F/near/562563216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/How.20to.20define.20an.20instancetype.20with.20a.20resource.3F.html#562563216">(Dec 08 2025 at 21:41)</a>:</h4>
<p>For this you can use <code>wasm-tools component wit -t</code> which encodes a <code>*.wit</code> package in wasm. For example with this input:</p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>package a:b;

interface df-interface {
  resource data-frame;
  fromcsv: func(path: string) -&gt; data-frame;
  show: func(frame: data-frame) -&gt; s64;
}
</code></pre></div>
<p>it outputs:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">-</span><span class="n">t</span>
<span class="p">(</span><span class="n">component</span>
<span class="w">  </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span>
<span class="w">    </span><span class="p">(</span><span class="n">component</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span>
<span class="w">        </span><span class="p">(</span><span class="n">instance</span>
<span class="w">          </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="s">"data-frame"</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">sub</span><span class="w"> </span><span class="n">resource</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">own</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">2</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="s">"path"</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="s">"fromcsv"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">3</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="s">"frame"</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="n">s64</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="s">"show"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="s">"a:b/df-interface"</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="s">"df-interface"</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="o">@</span><span class="n">custom</span><span class="w"> </span><span class="s">"package-docs"</span><span class="w"> </span><span class="s">"</span><span class="se">\0</span><span class="s">1{}"</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="o">@</span><span class="n">producers</span>
<span class="w">    </span><span class="p">(</span><span class="n">processed</span><span class="o">-</span><span class="n">by</span><span class="w"> </span><span class="s">"wit-component"</span><span class="w"> </span><span class="s">"0.243.0"</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>



<a name="562579039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/How%20to%20define%20an%20instancetype%20with%20a%20resource%3F/near/562579039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/How.20to.20define.20an.20instancetype.20with.20a.20resource.3F.html#562579039">(Dec 09 2025 at 00:06)</a>:</h4>
<p>This worked, thanks for the help and direction to answer similar questions in the future. <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>