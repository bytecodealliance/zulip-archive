<html>
<head><meta charset="utf-8"><title>Understanding rec groups · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html">Understanding rec groups</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="555695355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/555695355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#555695355">(Nov 14 2025 at 23:47)</a>:</h4>
<p>I have a component that has two core modules where one depends on the other. The dependent module also imports a function from the outer component via canon lower.</p>
<p>Here is my simplified reproducing WAT</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">component</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"f"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="s">"s"</span><span class="w"> </span><span class="n">string</span><span class="p">)))</span>

<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">rec</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$s</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="kt">i8</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$s</span><span class="p">))))</span>
<span class="w">  </span><span class="p">)</span>

<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="w"> </span><span class="p">(</span><span class="n">canon</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="p">)</span><span class="w"> </span><span class="n">gc</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="p">)))</span>

<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="cp">$m</span>
<span class="w">    </span><span class="p">(</span><span class="n">rec</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$s</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="kt">i8</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$s</span><span class="p">))))</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty2</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="k">struct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$s</span><span class="p">))))</span>
<span class="w">    </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"a"</span><span class="w"> </span><span class="s">"b"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"f"</span><span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fc</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fc</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="k">struct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$s</span><span class="p">))</span>
<span class="w">      </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="n">call</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="k">return</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>

<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="cp">$i</span><span class="w"> </span><span class="p">(</span><span class="n">instantiate</span><span class="w"> </span><span class="cp">$m</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="s">"a"</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"b"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="p">))))))</span>

<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="cp">$n</span>
<span class="w">    </span><span class="p">(</span><span class="n">rec</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$s</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="kt">i8</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="k">struct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$s</span><span class="p">))))</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"f"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="p">)))</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">(</span><span class="n">instantiate</span><span class="w"> </span><span class="cp">$n</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="cp">$i</span><span class="p">))))</span>
<span class="p">)</span>
</code></pre></div>
<p>When I run this WAT I get the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">gc</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">function</span><span class="o">-</span><span class="n">references</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">gc</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wat</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">WebAssembly</span><span class="w"> </span><span class="n">module</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">type</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">f</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">instantiation</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="err">`</span><span class="n">c</span><span class="err">`</span>
<span class="w">    </span><span class="n">expected</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="k">struct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="mi">3</span><span class="p">))))</span>
<span class="w">    </span><span class="n">found</span><span class="p">:</span><span class="w">    </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="k">struct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="mi">0</span><span class="p">))))</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0xe2</span><span class="p">)</span>
</code></pre></div>
<p>Notice the dependent module is a small wrapper around the function that simply drops the (ref struct) arg and calls the inner function. The function body is not important, its real purpose has been simplified away. However this wrapping seems to trigger this issue. Without this slight change to the function signature the parent module can be instantiated successfully. </p>
<p>If I remove the <code>(rec ...)</code> groupings entirely it also works.</p>
<p>Somehow a combination of rec groups, nested modules, and changing the function signature breaks this case. Any ideas? I am working to get some features of cm-gc working in wasmtime and ran into this issue.</p>



<a name="555696158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/555696158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#555696158">(Nov 14 2025 at 23:57)</a>:</h4>
<p>I believe what's happening here is that the rec group in the component and in module <code>$m</code> are the same, but the rec group in module <code>$n</code> is different (e.g. the addition of <code>(ref struct)</code>). That makes the type <code>$s</code> different across rec groups despite it being structurally the same</p>



<a name="555696195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/555696195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#555696195">(Nov 14 2025 at 23:58)</a>:</h4>
<p>or at least that's my understanding of rec groups, which is that an <code>(array i8)</code> type defined inside and outside a rec group are different</p>



<a name="555696805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/555696805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#555696805">(Nov 15 2025 at 00:04)</a>:</h4>
<p>I had a similar thought. Ok so if I create identical rec groups even if I don't need the extra function type in the parent rec group that should make the array type inside each rec group the same. So its the whole set of types in the rec group that define the structure. I'll try that thanks.</p>



<a name="555697128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/555697128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#555697128">(Nov 15 2025 at 00:07)</a>:</h4>
<p>Nick would know better than I if this is intended behavior of wasm gc (unrelated to component-model-gc), and he should be back next week I think</p>



<a name="557998079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/557998079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#557998079">(Nov 18 2025 at 17:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439345">Nathaniel Cook</span> <a href="#narrow/channel/206238-general/topic/Understanding.20rec.20groups/near/555696805">said</a>:</p>
<blockquote>
<p>So its the whole set of types in the rec group that define the structure.</p>
</blockquote>
<p>This is correct. Rec groups as a whole are structural and deduplicated with one another. Types within the same rec group, however, are not deduplicated, and also the "same" type in two otherwise different rec groups (e.g. have more or less types, have types in a different order, have different sets of types) are also different types. Types are effectively nominal within the context of their rec group.</p>



<a name="558002202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558002202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558002202">(Nov 18 2025 at 17:35)</a>:</h4>
<p>Thanks this help me understand. </p>
<p>Follow up question, as you might remember I am attempting to add cm+gc support to wasmtime. I have a few bits working but ran into an issue regarding rec groups and canon lower. The current implementation expects all types of the core type for lowering to be in the same rec group. Meaning the core type itself and any referenced types must be in the same rec group otherwise wasmtime crashes during compilation. </p>
<p>After understanding rec groups it seems the correct solution is to change the compilation process to allow for the core type to reference types across rec groups so long as they are all in scope. Otherwise it's quite restrictive on compilers generating wasm to know all the ways that types are grouped across compilation units. For example with the string type above we would need to create a different string type for each of the different contexts in which it is used as the core type for lowering and all parts of the generated wasm need to know this grouping. </p>
<p>Does this sound correct, that the core type in lowering contexts should support multiple rec groups?</p>



<a name="558008694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558008694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558008694">(Nov 18 2025 at 18:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439345">Nathaniel Cook</span> <a href="#narrow/channel/206238-general/topic/Understanding.20rec.20groups/near/558002202">said</a>:</p>
<blockquote>
<p>otherwise wasmtime crashes during compilation</p>
</blockquote>
<p>Crashes, panics, or returns a compilation error?</p>
<p><span class="user-mention silent" data-user-id="439345">Nathaniel Cook</span> <a href="#narrow/channel/206238-general/topic/Understanding.20rec.20groups/near/558002202">said</a>:</p>
<blockquote>
<p>The current implementation expects all types of the core type for lowering to be in the same rec group. Meaning the core type itself and any referenced types must be in the same rec group</p>
</blockquote>
<p>Is this in your WIP branch? That is not what is sketched in <a href="https://github.com/WebAssembly/component-model/issues/525">https://github.com/WebAssembly/component-model/issues/525</a> or implemented in <code>wasmparser</code>'s validation, unless I am misunderstanding things.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/issues/525" style="background-image: url(&quot;https://uploads.zulipusercontent.net/eaca9f12dd7d8220e4bc9b476274073385de17ec/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656666323865393831623137616337323363386237363865623035646662316666666464656361393339613032316530636462393137356166613765663937362f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c2f6973737565732f353235&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/issues/525" title="Pre-Proposal: Wasm GC Support in the Canonical ABI · Issue #525 · WebAssembly/component-model">Pre-Proposal: Wasm GC Support in the Canonical ABI · Issue #525 · WebAssembly/component-model</a></div><div class="message_embed_description">Pre-Proposal: Wasm GC Support in the Canonical ABI This issue proposes extensions to the Component Model's Canonical ABI for Wasm GC support and describes some of the motivation for particular choi...</div></div></div>



<a name="558011155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558011155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558011155">(Nov 18 2025 at 18:15)</a>:</h4>
<blockquote>
<blockquote>
<p>otherwise wasmtime crashes during compilation</p>
</blockquote>
</blockquote>
<blockquote>
<p>Crashes, panics, or returns a compilation error?</p>
</blockquote>
<p>Panics indexing into a map of wasmparser type ids to wasmtime types. I believe this is because the map is only populated with types from the  rec group containing the core-type for lowering. </p>
<p>I can reproduce the panic outside of my branch:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">component</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"f"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="s">"s"</span><span class="w"> </span><span class="n">string</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="cp">$s</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="kt">i8</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="cp">$s</span><span class="p">))))</span>
<span class="w">  </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="w"> </span><span class="p">(</span><span class="n">canon</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$f</span><span class="p">)</span><span class="w"> </span><span class="n">gc</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="cp">$ty</span><span class="p">))))</span>
</code></pre></div>
<p>This parses fine but when attempting to execute in wasmtime hits the indexing panic mentioned above. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">gc</span><span class="o">=</span><span class="n">yes</span><span class="p">,</span><span class="n">gc</span><span class="o">=</span><span class="n">yes</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wat</span>
</code></pre></div>



<a name="558011700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558011700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558011700">(Nov 18 2025 at 18:17)</a>:</h4>
<p>If however I place both the array type and the func type into a single rec group it doesn't fail to compile</p>



<a name="558012334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558012334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558012334">(Nov 18 2025 at 18:20)</a>:</h4>
<p>hm yeah I think this is the same issue that <span class="user-mention" data-user-id="254110">@Andrew Brown</span> ran into with <code>spawn_ref</code> and shared-everything-threads. I think we need to refactor the way that the component translation juggles types, but I forget the details</p>



<a name="558014472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558014472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558014472">(Nov 18 2025 at 18:31)</a>:</h4>
<p>Ok glad to know I am on the right track. I might hack something on my WIP branch and see what I come up with. If it proves interesting I'll share it.</p>



<a name="558227001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Understanding%20rec%20groups/near/558227001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nathaniel Cook <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Understanding.20rec.20groups.html#558227001">(Nov 19 2025 at 15:00)</a>:</h4>
<p>I did get a simple fix working in my branch. I just added a pass over the core-type checking for reference types and tracking the unique rec group ids found. Then I explicitly interned those rec groups before interning the rec group containing the core-type itself. This prevents the crash but doesn't seem like a efficient long term solution.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>