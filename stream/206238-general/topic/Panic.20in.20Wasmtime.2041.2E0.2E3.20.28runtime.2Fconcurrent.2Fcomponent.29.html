<html>
<head><meta charset="utf-8"><title>Panic in Wasmtime 41.0.3 (runtime/concurrent/component) · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Panic.20in.20Wasmtime.2041.2E0.2E3.20.28runtime.2Fconcurrent.2Fcomponent.29.html">Panic in Wasmtime 41.0.3 (runtime/concurrent/component)</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="574438798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Panic%20in%20Wasmtime%2041.0.3%20%28runtime/concurrent/component%29/near/574438798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boris <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Panic.20in.20Wasmtime.2041.2E0.2E3.20.28runtime.2Fconcurrent.2Fcomponent.29.html#574438798">(Feb 18 2026 at 06:51)</a>:</h4>
<p>Hi!</p>
<p>After upgrading Wasmtime to v41 (from v34), I started getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">tokio</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">worker</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">41.0.3</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">4384</span><span class="p">:</span><span class="mi">9</span>
<span class="n">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">self</span><span class="p">.</span><span class="n">threads</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span>
</code></pre></div>
<p>Worth noting that I reuse the store for a short period of time (10-20 calls) to reduce the overhead of instantiating components.</p>
<p>What happens:</p>
<ul>
<li>We create an async call future (via <code>TypedFunc::call_async</code>).</li>
<li>The future gets dropped before it’s ever polled.</li>
<li><code>TaskId::host_future_dropped</code> called.</li>
<li>Because the future was never polled, the call parameters were never lowered (<code>already_lowered_parameters == false</code>), or there is no params.</li>
<li><code>Waitable::Guest(self.task).delete_from(...)</code> called and  it asserts that the task has no guest threads (<code>self.threads.is_empty()</code>), and that assertion fails, causing the panic.</li>
</ul>
<p>Reproduce: <a href="https://github.com/bmartynov/wasmtime-threads-assert">https://github.com/bmartynov/wasmtime-threads-assert</a> (cargo run)</p>



<a name="574518029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Panic%20in%20Wasmtime%2041.0.3%20%28runtime/concurrent/component%29/near/574518029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Panic.20in.20Wasmtime.2041.2E0.2E3.20.28runtime.2Fconcurrent.2Fcomponent.29.html#574518029">(Feb 18 2026 at 14:14)</a>:</h4>
<p>Thanks for reporting this!  Have you tried running the same test using the <code>main</code> branch of Wasmtime?  We've been doing a lot of work related to that code recently.</p>



<a name="574518484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Panic%20in%20Wasmtime%2041.0.3%20%28runtime/concurrent/component%29/near/574518484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boris <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Panic.20in.20Wasmtime.2041.2E0.2E3.20.28runtime.2Fconcurrent.2Fcomponent.29.html#574518484">(Feb 18 2026 at 14:15)</a>:</h4>
<p>No, will try soon, thanks.</p>
<p>For now I just disabled <code>component-model-async</code> feature</p>



<a name="574578086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Panic%20in%20Wasmtime%2041.0.3%20%28runtime/concurrent/component%29/near/574578086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boris <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Panic.20in.20Wasmtime.2041.2E0.2E3.20.28runtime.2Fconcurrent.2Fcomponent.29.html#574578086">(Feb 18 2026 at 18:31)</a>:</h4>
<p>It doesn’t reproduce on the main branch(bbfcd588641e7ce0f69b3627d7eed69a57af67cf)</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>