<html>
<head><meta charset="utf-8"><title>Run WASI 0.1 module with jco? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html">Run WASI 0.1 module with jco?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="538643969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538643969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538643969">(Sep 10 2025 at 12:53)</a>:</h4>
<p>I’m really struggling to get a WASI 0.1 module running on the web because the available JS libraries seem like a total disaster. jco seems like by far the more up to date tool, but is there any way to use it with WASI 0.1 instead of 0.2?</p>



<a name="538647198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538647198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538647198">(Sep 10 2025 at 13:07)</a>:</h4>
<p>JCO works with wasm components. wasip1 is based on plain wasm modules, not wasm components.</p>



<a name="538647351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538647351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538647351">(Sep 10 2025 at 13:08)</a>:</h4>
<p>Right but can I wrap the WASI 0.1 module in a component or something?</p>



<a name="538647353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538647353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538647353">(Sep 10 2025 at 13:08)</a>:</h4>
<p>Depending on what you need <a href="https://github.com/bjorn3/browser_wasi_shim/">https://github.com/bjorn3/browser_wasi_shim/</a> may work.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bjorn3/browser_wasi_shim/" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1365f2a84ac7279ec776d1f805220ed2f4ae231e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633933616437366531326461333036333135363636373236353665343239613134393866353565366638373933646363343632313432396638353534633735662f626a6f726e332f62726f777365725f776173695f7368696d&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bjorn3/browser_wasi_shim/" title="GitHub - bjorn3/browser_wasi_shim: A WASI shim for in the browser">GitHub - bjorn3/browser_wasi_shim: A WASI shim for in the browser</a></div><div class="message_embed_description">A WASI shim for in the browser. Contribute to bjorn3/browser_wasi_shim development by creating an account on GitHub.</div></div></div>



<a name="538647698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538647698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538647698">(Sep 10 2025 at 13:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="650637">Ben Visness</span> <a href="#narrow/channel/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F/near/538647351">said</a>:</p>
<blockquote>
<p>Right but can I wrap the WASI 0.1 module in a component or something?</p>
</blockquote>
<p>That would also be an option. You can use <a href="https://github.com/bytecodealliance/wasm-tools">wasm-tools</a> to wrap a wasip1 module with a wasip1 -&gt; wasip2 adapter.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools" style="background-image: url(&quot;https://uploads.zulipusercontent.net/253ae56a6b0e71a7a6c59f456e55173b1088c7df/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653165343132623534303232636237393337623566623035313332316232666334373636633334643732373938656661643638626337383530646336633131622f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools" title="GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules">GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules</a></div><div class="message_embed_description"> CLI and Rust libraries for low-level manipulation of WebAssembly modules  - GitHub - bytecodealliance/wasm-tools: CLI and Rust libraries for low-level manipulation of WebAssembly modules</div></div></div>



<a name="538647806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538647806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538647806">(Sep 10 2025 at 13:10)</a>:</h4>
<p>Does such an adapter already exist in wasm-tools?</p>



<a name="538647958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538647958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538647958">(Sep 10 2025 at 13:10)</a>:</h4>
<p>Is that what that <code>component new</code> command does?</p>



<a name="538648063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538648063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538648063">(Sep 10 2025 at 13:11)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasmtime/releases/tag/v36.0.2">https://github.com/bytecodealliance/wasmtime/releases/tag/v36.0.2</a> has the latest version of the <code>wasi_snapshot_preview1.reactor.wasm</code> adapter.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/releases/tag/v36.0.2" style="background-image: url(&quot;https://uploads.zulipusercontent.net/9259ca8cfc4fb9abbc191b035d3f8f4464ea743a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303864373933373634643134626664363764336439366235646139353939633461313935366335363633316463376439326434666262636632623236626239302f62797465636f6465616c6c69616e63652f7761736d74696d652f72656c65617365732f7461672f7633362e302e32&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/releases/tag/v36.0.2" title="Release v36.0.2: Release Wasmtime 36.0.2 (#11541) · bytecodealliance/wasmtime">Release v36.0.2: Release Wasmtime 36.0.2 (#11541) · bytecodealliance/wasmtime</a></div><div class="message_embed_description">36.0.2
Released 2025-08-26.
Fixed

Wasmtime will no longer panic in the pooling allocator when in near-OOM
conditions related to resetting the linear memory of a slot.
#11510</div></div></div>



<a name="538648202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538648202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538648202">(Sep 10 2025 at 13:11)</a>:</h4>
<p>It is in the wasmtime repo because wasmtime internally uses this adapter (compiled to native code rather than wasm) when running a wasip1 module.</p>



<a name="538648312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538648312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538648312">(Sep 10 2025 at 13:12)</a>:</h4>
<p>Good to know, and promising since I have gotten my module running in wasmtime already</p>



<a name="538648374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538648374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538648374">(Sep 10 2025 at 13:12)</a>:</h4>
<p><code>wasm-tools component new my-core.wasm -o my-component.wasm --adapt wasi_snapshot_preview1.reactor.wasm</code> is the suggested command in the wasm-tools readme.</p>



<a name="538648708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538648708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538648708">(Sep 10 2025 at 13:14)</a>:</h4>
<p>Also you may want to use the <code>.command.wasm</code> rather than <code>.reactor.wasm</code> version if you have a program whose main function should be called at startup rather than a library-like module that exports functions you can call.</p>



<a name="538648788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538648788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538648788">(Sep 10 2025 at 13:14)</a>:</h4>
<p>What’s the difference?</p>



<a name="538650217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538650217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538650217">(Sep 10 2025 at 13:20)</a>:</h4>
<p>command exports a main function and nothing else, reactor may export an optional init function and as many functions as it wants<br>
command is like an executable that reads command line arguments, env and stdin and writes stdout and stderr<br>
reactor is like a dll other programs load to call functions in</p>



<a name="538669852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538669852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538669852">(Sep 10 2025 at 14:40)</a>:</h4>
<p>You'll likely want the "command" adapter which reexports the WASI main function entrypoint as a WASIp2 function. If you use a "reactor" adapter it would require that you have component metadata for some other export. Otherwise while you'll likely get a component out of the process it won't have any exports to call because the reactor doesn't export anything nor does your module which wasn't intended to be a component.</p>
<p>If you're building something that's not something with a main function, however, then creating a component won't work without some sort of integration with WIT or similar. Basically you'll have to describe the exported functions somehow with WIT. That can be done after-the-fact once the core module is built, and it can also be done with wasm-tools, but depends on your use case</p>



<a name="538670425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538670425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538670425">(Sep 10 2025 at 14:42)</a>:</h4>
<p>This does have a main function afaik, so the command approach should be fine</p>



<a name="538670525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538670525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538670525">(Sep 10 2025 at 14:43)</a>:</h4>
<p>But what to make of this...</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">npx</span><span class="w"> </span><span class="n">jco</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">js</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">js</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">adapt</span><span class="w"> </span><span class="n">wasi_snapshot_preview1</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">(</span><span class="n">jco</span><span class="w"> </span><span class="n">componentNew</span><span class="p">)</span><span class="w"> </span><span class="n">ComponentError</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>
<span class="cp">$failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi_snapshot_preview1</span><span class="p">::</span><span class="n">fd_write</span><span class="err">`</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="err">`</span><span class="n">wasi_snapshot_preview1</span><span class="err">`</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">componentNew</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="sd">///home/bvisness/Developer/spidermonkey.dev/_support/iongraph-article/node_modules/@bytecodealliance/jco/obj/wasm-tools.js:4663:11)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">componentNew</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="sd">///home/bvisness/Developer/spidermonkey.dev/_support/iongraph-article/node_modules/@bytecodealliance/jco/src/cmd/wasm-tools.js:100:20)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">file</span><span class="p">:</span><span class="sd">///home/bvisness/Developer/spidermonkey.dev/_support/iongraph-article/node_modules/@bytecodealliance/jco/src/jco.js:467:17</span>
</code></pre></div>



<a name="538671350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538671350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538671350">(Sep 10 2025 at 14:45)</a>:</h4>
<p>That looks like a failure in the CLI invocation to communicate to jco's <code>new</code> subcommand "the <code>wasi_snapshot_preview1</code> adapter is in this wasm file". I'm not familiar with jco's CLI so I can't say for certain what the issue is, but you might want to try to rename that as <code>wasi_snapshot_preview1.wasm</code> and see if that helps. Another option is that if <code>jco new</code>'s syntax is inspired by <code>wasm-tools</code> you can also do <code>--adapt wasi_snapshot_preview1=wasi_snapshot_preview1.command.wasm</code>, although I'm not sure if this is supported in jco</p>



<a name="538671466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538671466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538671466">(Sep 10 2025 at 14:46)</a>:</h4>
<p>basically that looks like a CLI syntax mistake/bug, but I don't know the exact fix myself</p>



<a name="538671571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538671571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538671571">(Sep 10 2025 at 14:46)</a>:</h4>
<blockquote>
<p>you can also do <code>--adapt wasi_snapshot_preview1=wasi_snapshot_preview1.command.wasm</code></p>
</blockquote>
<p>that worked, thank you</p>



<a name="538672517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538672517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538672517">(Sep 10 2025 at 14:50)</a>:</h4>
<p>Where can I find more information about using jco from JS instead of from the command line?</p>



<a name="538672601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538672601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538672601">(Sep 10 2025 at 14:50)</a>:</h4>
<p>Specifically so that I can work it into my build scripts</p>



<a name="538675653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538675653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538675653">(Sep 10 2025 at 15:02)</a>:</h4>
<p><span class="user-mention" data-user-id="598440">@Victor Adossi</span> might be able to help out with that</p>



<a name="538677833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538677833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538677833">(Sep 10 2025 at 15:11)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="650637">@Ben Visness</span> so in general I think where you'll want to start is the jco code base here: </p>
<p>For example if you wanted to investigate how transpile works:<br>
<a href="https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/cmd/transpile.js">https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/cmd/transpile.js</a></p>
<p>In general the API is the surface you can use without the CLI (i.e. directly from JS):<br>
<a href="https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/api.js">https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/api.js</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/cmd/transpile.js" style="background-image: url(&quot;https://uploads.zulipusercontent.net/34c2e55c603bdd9cf61c4efd9413843ac3c6eb06/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636231633163636130393431373239663032376532336333306166623064636264303636663861356635643138643733646537653132326135373739616663362f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/cmd/transpile.js" title="jco/packages/jco/src/cmd/transpile.js at main · bytecodealliance/jco">jco/packages/jco/src/cmd/transpile.js at main · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/api.js" style="background-image: url(&quot;https://uploads.zulipusercontent.net/34c2e55c603bdd9cf61c4efd9413843ac3c6eb06/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636231633163636130393431373239663032376532336333306166623064636264303636663861356635643138643733646537653132326135373739616663362f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/blob/main/packages/jco/src/api.js" title="jco/packages/jco/src/api.js at main · bytecodealliance/jco">jco/packages/jco/src/api.js at main · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="538677977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538677977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538677977">(Sep 10 2025 at 15:12)</a>:</h4>
<p>Unfortunately the browser bindings are still very experimental and not complete, so there's a bunch there but you may very well run into more missing pieces</p>



<a name="538678123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538678123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538678123">(Sep 10 2025 at 15:12)</a>:</h4>
<p>Thanks - I'm using it from Node, not the browser, since I just want to integrate jco into my esbuild config</p>



<a name="538678556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538678556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538678556">(Sep 10 2025 at 15:14)</a>:</h4>
<p>Ah OK, great in that case the support should be much better, and like I said you should be able to use the code in <code>api.js</code></p>



<a name="538679763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538679763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538679763">(Sep 10 2025 at 15:19)</a>:</h4>
<p>What am I to make of all these parameter types? It's hard to tell what type each param actually expects</p>



<a name="538683027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538683027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538683027">(Sep 10 2025 at 15:33)</a>:</h4>
<p>Which part of the API are yout rying to use? Also, do you have the project built locally? <code>obj/wasm-tools.d.ts</code>is actually present and helps decode types and should help</p>



<a name="538683194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538683194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538683194">(Sep 10 2025 at 15:34)</a>:</h4>
<p><code>component new</code> and <code>transpile</code>, I think, but at the moment just <code>component new</code></p>



<a name="538683278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538683278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538683278">(Sep 10 2025 at 15:34)</a>:</h4>
<p>digging around in my local node_modules, I did finally turn this up, which is the thing I actually wanted</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">export</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">componentNew</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span><span class="w"> </span><span class="nc">Uint8Array</span><span class="p">,</span><span class="w"> </span><span class="n">adapters</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="o">&lt;</span><span class="p">[</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">Uint8Array</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">undefined</span><span class="p">):</span><span class="w"> </span><span class="nc">Uint8Array</span><span class="p">;</span>
</code></pre></div>



<a name="538686296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538686296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538686296">(Sep 10 2025 at 15:48)</a>:</h4>
<p>Note that there's also a listing of the API in <a href="https://github.com/bytecodealliance/jco/blob/85f00d6901d2b53894e6820ec290a13cf21026ca/packages/jco/README.md?plain=1#L145">the README</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/blob/85f00d6901d2b53894e6820ec290a13cf21026ca/packages/jco/README.md?plain=1#L145" style="background-image: url(&quot;https://uploads.zulipusercontent.net/34c2e55c603bdd9cf61c4efd9413843ac3c6eb06/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636231633163636130393431373239663032376532336333306166623064636264303636663861356635643138643733646537653132326135373739616663362f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/blob/85f00d6901d2b53894e6820ec290a13cf21026ca/packages/jco/README.md?plain=1#L145" title="jco/packages/jco/README.md at 85f00d6901d2b53894e6820ec290a13cf21026ca · bytecodealliance/jco">jco/packages/jco/README.md at 85f00d6901d2b53894e6820ec290a13cf21026ca · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="538686580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538686580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538686580">(Sep 10 2025 at 15:49)</a>:</h4>
<p>Usage in tests/code can also be useful to look at! </p>
<p>We really should have some better types, but once we switch to TS they should be much better.</p>



<a name="538707434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538707434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538707434">(Sep 10 2025 at 17:41)</a>:</h4>
<p>So, I've gotten as far as this, but how do I actually run the module now?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">instantiate</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WASIShim</span><span class="p">().</span><span class="n">getImportObject</span><span class="p">());</span>
</code></pre></div>



<a name="538707528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538707528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538707528">(Sep 10 2025 at 17:41)</a>:</h4>
<p>I need to pass it command line args and env vars and get stdout, that kind of thing</p>



<a name="538708265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538708265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538708265">(Sep 10 2025 at 17:46)</a>:</h4>
<p>So if you've gotten to that point, <code>component</code> is a module that contains what you component exports, so you should be able to call the relevant imports.</p>
<p>The exports that your component exports should be available on the <code>component</code> object</p>



<a name="538708581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538708581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538708581">(Sep 10 2025 at 17:48)</a>:</h4>
<p>Yes, I realize that, but with wasmtime it can just _run_ it, so what is the equivalent thing I need to do here</p>



<a name="538709035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538709035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538709035">(Sep 10 2025 at 17:51)</a>:</h4>
<p>component.exports.run() is the default main function of a command world, and you provide env, files and cli args via the wasi shim you use</p>



<a name="538709242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538709242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538709242">(Sep 10 2025 at 17:52)</a>:</h4>
<p>(I don't remember if jco calls it <a href="http://exports.run">exports.run</a> or directly .run, I have been working with wasip1 a lot again lately)</p>



<a name="538709309"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538709309" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538709309">(Sep 10 2025 at 17:53)</a>:</h4>
<p>I am using @bytecodealliance/preview2-shim, all I am asking is how to actually do the thing that wasmtime is already doing</p>



<a name="538710171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538710171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538710171">(Sep 10 2025 at 17:57)</a>:</h4>
<p>I'd be happy to follow an example, but I can't find a single example in the jco repo of actually running any kind of wasi component</p>



<a name="538710564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538710564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538710564">(Sep 10 2025 at 17:59)</a>:</h4>
<p>I think right now you need to call these exports in preview2-shim to set things like env vars and commandline args: <a href="https://github.com/bytecodealliance/jco/blob/main/packages/preview2-shim/lib/nodejs/cli.js#L11-L28">https://github.com/bytecodealliance/jco/blob/main/packages/preview2-shim/lib/nodejs/cli.js#L11-L28</a></p>
<p>and then you call the run() export of your module</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/blob/main/packages/preview2-shim/lib/nodejs/cli.js#L11-L28" style="background-image: url(&quot;https://uploads.zulipusercontent.net/6b525900f3aad3e07a270867ca3eed95e6633ce3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623138326336313362303137666666646164613630626563316534656639326232643938623234626630373065336466653062633538626434383535343237342f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/blob/main/packages/preview2-shim/lib/nodejs/cli.js#L11-L28" title="jco/packages/preview2-shim/lib/nodejs/cli.js at main · bytecodealliance/jco">jco/packages/preview2-shim/lib/nodejs/cli.js at main · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="538712609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538712609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538712609">(Sep 10 2025 at 18:11)</a>:</h4>
<p>Why does the result of <code>instantiate</code> wrap up the exports the way it does? <br>
<a href="/user_uploads/15107/sBI6MbBEESKLrAJix7x331fM/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/sBI6MbBEESKLrAJix7x331fM/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="424x108" src="/user_uploads/thumbnail/15107/sBI6MbBEESKLrAJix7x331fM/image.png/840x560.webp"></a></div>



<a name="538712989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538712989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538712989">(Sep 10 2025 at 18:13)</a>:</h4>
<p><a href="https://github.com/WebAssembly/wasi-cli/blob/main/wit/run.wit">https://github.com/WebAssembly/wasi-cli/blob/main/wit/run.wit</a></p>
<p>interface run { run: func() } }</p>
<p>run is actually an interface that defines a single method run on itself</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-cli/blob/main/wit/run.wit" style="background-image: url(&quot;https://uploads.zulipusercontent.net/cd86bb4194a9f40b6f215d00db404f2aee2b30b4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656262613039653636306631643764303839373766386161373738346564356536363236336566666233353634376637643331623234633465316462326633362f576562417373656d626c792f776173692d636c69&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-cli/blob/main/wit/run.wit" title="wasi-cli/wit/run.wit at main · WebAssembly/wasi-cli">wasi-cli/wit/run.wit at main · WebAssembly/wasi-cli</a></div><div class="message_embed_description">Command-Line Interface (CLI) World for WASI. Contribute to WebAssembly/wasi-cli development by creating an account on GitHub.</div></div></div>



<a name="538898209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538898209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538898209">(Sep 11 2025 at 16:07)</a>:</h4>
<p>After much hassle yesterday, I do finally have it up and running. Thanks for all your help.</p>



<a name="538898265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538898265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538898265">(Sep 11 2025 at 16:07)</a>:</h4>
<p>The summary of what I'm now running is almost too shameful to admit</p>



<a name="538898601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538898601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538898601">(Sep 11 2025 at 16:08)</a>:</h4>
<p>I am compiling SpiderMonkey to WASM as a WASI 0.1 module, using wasm-tools to convert it to a WASI 0.2 module using that adapter, then transpiling it to JS with jco, all so that I can JIT JS to arm32 machine code and then run an arm32 emulator to run the code</p>



<a name="538898750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538898750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538898750">(Sep 11 2025 at 16:09)</a>:</h4>
<p>(All so that I can live-demo what the Ion JIT is doing with your JS code.)</p>



<a name="538899179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538899179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538899179">(Sep 11 2025 at 16:11)</a>:</h4>
<p>I gotta say, using the preview2-shim is a pretty miserable experience. Especially the filesystem stuff. Some docs would go a long way, but also, it seems quite rough as an API and I basically had to reverse engineer how it was all supposed to work by rooting around in the source and honestly just guessing sometimes.</p>



<a name="538900239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538900239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538900239">(Sep 11 2025 at 16:17)</a>:</h4>
<p>I also wrote an esbuild plugin along the way to handle the transpiling and stuff. It's too rough around the edges to publish as a library but here's a gist in case it helps anyone else do something similar: <a href="https://gist.github.com/bvisness/66e4b65af09a40b6c3bd4bd316d2d7e4">https://gist.github.com/bvisness/66e4b65af09a40b6c3bd4bd316d2d7e4</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/bvisness/66e4b65af09a40b6c3bd4bd316d2d7e4" style="background-image: url(&quot;https://uploads.zulipusercontent.net/91f9baed8f4fc08c462d1a4de5a8c23942d45e97/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f6173736574732f676973742d6f672d696d6167652d3534666437646330373133652e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/bvisness/66e4b65af09a40b6c3bd4bd316d2d7e4" title="An esbuild plugin to get WASI 0.1 modules running in the browser.">An esbuild plugin to get WASI 0.1 modules running in the browser.</a></div><div class="message_embed_description">An esbuild plugin to get WASI 0.1 modules running in the browser. - esbuild-wasi.mjs</div></div></div>



<a name="538900493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538900493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538900493">(Sep 11 2025 at 16:18)</a>:</h4>
<p>One last random thing: I'm getting duplicate object key warnings because of this:<br>
<a href="/user_uploads/15107/QS-l2rtXIEfugL4VqiN5hBfO/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/QS-l2rtXIEfugL4VqiN5hBfO/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="491x199" src="/user_uploads/thumbnail/15107/QS-l2rtXIEfugL4VqiN5hBfO/image.png/840x560.webp"></a></div>



<a name="538910708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538910708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538910708">(Sep 11 2025 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="650637">Ben Visness</span> <a href="#narrow/channel/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F/near/538898209">said</a>:</p>
<blockquote>
<p>After much hassle yesterday, I do finally have it up and running. Thanks for all your help.</p>
</blockquote>
<p>Thanks to <span class="user-mention" data-user-id="550770">@Ramon Klass</span> for doing a great job answering questions!</p>



<a name="538920734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538920734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538920734">(Sep 11 2025 at 18:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="650637">Ben Visness</span> <a href="#narrow/channel/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F/near/538900493">said</a>:</p>
<blockquote>
<p>One last random thing: I'm getting duplicate object key warnings because of this:</p>
</blockquote>
<p>Ah, thank you for pointing that out, that definitely shouldn't be there, new Jco version should be out soon with that fix</p>



<a name="538921077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921077">(Sep 11 2025 at 18:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="650637">Ben Visness</span> <a href="#narrow/channel/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F/near/538899179">said</a>:</p>
<blockquote>
<p>I gotta say, using the preview2-shim is a pretty miserable experience. Especially the filesystem stuff. Some docs would go a long way, but also, it seems quite rough as an API and I basically had to reverse engineer how it was all supposed to work by rooting around in the source and honestly just guessing sometimes.</p>
</blockquote>
<p>Would really appreciate any PRs you want to make against the documentation, but where did you look first? Did you look at the Jco books or the examples? Which resource let you down the most/where should we add the docs first?</p>
<p>Does <a href="https://bytecodealliance.github.io/jco/manual-wasm-instantiation-with-wasi-overrides.html#manual-instantiation-of-a-transpiled-component-with-custom-overrides">this page in the Jco book</a> need an update that would have helped you do filesystem stuff much easier?</p>



<a name="538921372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921372">(Sep 11 2025 at 18:32)</a>:</h4>
<p>I tried the jco book and various readmes but they all stop documenting things after instantiation</p>



<a name="538921458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921458">(Sep 11 2025 at 18:32)</a>:</h4>
<p>It’s all “TODO: add code to utilize the component”</p>



<a name="538921575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921575">(Sep 11 2025 at 18:33)</a>:</h4>
<p>the key thing, I think, is that I don’t actually need to see how to call the WASI exports, what I need is to see how to do _setEnv and so on</p>



<a name="538921599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921599">(Sep 11 2025 at 18:33)</a>:</h4>
<p>which is entirely up to the shim afaik</p>



<a name="538921629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921629">(Sep 11 2025 at 18:34)</a>:</h4>
<p>AH! OK thank you for making that clear</p>



<a name="538921650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921650">(Sep 11 2025 at 18:34)</a>:</h4>
<p>Yeah we definitely need more work on the book -- would you mind creating an issue against Jco?</p>



<a name="538921806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921806">(Sep 11 2025 at 18:35)</a>:</h4>
<p>Well tbh I think this stuff should be in the shim readme, if documented at all? The filesystem stuff is really nasty.</p>



<a name="538921828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921828">(Sep 11 2025 at 18:35)</a>:</h4>
<p>And the shim readme is what shows up on NPM.</p>



<a name="538921896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921896">(Sep 11 2025 at 18:35)</a>:</h4>
<p>If you could be incredibly liberal (no frustration is too small), this is something we can actually get to and fix/make better.</p>
<p>The context here is that there are actually ~2+ starting points for Jco/JS component work -- there's the <a href="https://component-model.bytecodealliance.org/language-support/javascript.html">component book</a> (it stops short of async instantiation after transpile) and the Jco book, and clearly the latter is the right place but doesn't have enough detail</p>



<a name="538921927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921927">(Sep 11 2025 at 18:36)</a>:</h4>
<p>I can open an issue regardless</p>



<a name="538921937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921937">(Sep 11 2025 at 18:36)</a>:</h4>
<p>This is the filesystem stuff I'm talking about<br>
<a href="/user_uploads/15107/B1xnGtCxBq5yfBLQk4HXaFco/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/B1xnGtCxBq5yfBLQk4HXaFco/image.png" title="image.png"><img data-original-content-type="image/png" data-original-dimensions="548x146" src="/user_uploads/thumbnail/15107/B1xnGtCxBq5yfBLQk4HXaFco/image.png/840x560.webp"></a></div>



<a name="538921944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921944">(Sep 11 2025 at 18:36)</a>:</h4>
<p>Ah, so that sounds like a second issue</p>



<a name="538921994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921994">(Sep 11 2025 at 18:36)</a>:</h4>
<p>Feel free to make them distinct issues if you want, instantiation broadly being better documented, and the Preview2 README pointing to the documentation (and containing more examples)</p>



<a name="538921999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538921999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538921999">(Sep 11 2025 at 18:36)</a>:</h4>
<p>I had to basically reverse engineer what the internal data format was for files</p>



<a name="538922053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922053">(Sep 11 2025 at 18:37)</a>:</h4>
<p>So this... I would have expected to be provided via the types, are they not showing up properly?</p>



<a name="538922130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922130">(Sep 11 2025 at 18:37)</a>:</h4>
<p>is this a third issue? IIRC I get completion locally when using the exports of <code>preview2-shim</code> but if that's not working then there is clearly an issue</p>



<a name="538922208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922208">(Sep 11 2025 at 18:38)</a>:</h4>
<p>I am actually not using TypeScript for this at the moment</p>



<a name="538922230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922230">(Sep 11 2025 at 18:38)</a>:</h4>
<p>So perhaps that would have showed me</p>



<a name="538922308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922308">(Sep 11 2025 at 18:39)</a>:</h4>
<p>That said, I don't see TypeScript types for _setEnv and friends? But maybe I'm looking in the wrong place</p>



<a name="538922316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922316">(Sep 11 2025 at 18:39)</a>:</h4>
<p>AHHHH yes, unfortunately that's the problem, all of the types are specified that way... OK, but we can at least improve this with JSDoc</p>



<a name="538922464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922464">(Sep 11 2025 at 18:40)</a>:</h4>
<p>like, I can find <code>@bytecodealliance/preview2-shim/lib/browser/filesystem.js</code>, which has the <code>_setFileData</code> function, but unless I'm missing something, I don't see any TypeScript definitions for <code>_setFileData</code></p>



<a name="538922480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922480">(Sep 11 2025 at 18:40)</a>:</h4>
<p>Ah also a problem -- the types for setEnv are missing -- there's no JSdoc on that</p>



<a name="538922761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922761">(Sep 11 2025 at 18:41)</a>:</h4>
<p>Yeah at this point not even sure if the "add jsdoc everywhere" should be lumped into the problems with preview2 issue, but either way, that's probably the quickest way to fix the huge DX hole</p>



<a name="538922798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922798">(Sep 11 2025 at 18:41)</a>:</h4>
<p>and like I'm sure it's because it's specific to the browser implementation of the shim, but really it's kind of gross on its own that I have to import and use browser-specific things instead of having a unified API that I could use in any environment</p>



<a name="538922965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922965">(Sep 11 2025 at 18:43)</a>:</h4>
<p>and if I understand correctly, the things I need (env vars, cmd args, files) are entirely outside of the WASI component and are implemented in some specific way on the host - that is, in this case, by the shim</p>



<a name="538922972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922972">(Sep 11 2025 at 18:43)</a>:</h4>
<p>yeah an isomorphic API would be ideal, <em>but</em> the browser implementation is very experimental (read incomplete)</p>



<a name="538922993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538922993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538922993">(Sep 11 2025 at 18:43)</a>:</h4>
<p>Which is why they haven't been merged IIRC</p>



<a name="538923142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538923142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538923142">(Sep 11 2025 at 18:43)</a>:</h4>
<p>So the thing is that the instantiation is <em>also</em> JS so there's some overlap there, but in general yes, the p2 implementation is "host code"</p>



<a name="538923286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538923286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538923286">(Sep 11 2025 at 18:44)</a>:</h4>
<p>sure, but part of it is satisfying the semantics of the WASI interface (glue), and part of it is actually <em>acting as the host</em>, right?</p>



<a name="538923302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538923302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538923302">(Sep 11 2025 at 18:44)</a>:</h4>
<p>and it's the latter that is platform-specific and undocumented and untyped</p>



<a name="538923474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538923474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538923474">(Sep 11 2025 at 18:46)</a>:</h4>
<p>If I'm understanding you correctly it's both that are platform specific -- because what is available/usable from Node differs from the browser environment</p>



<a name="538923633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538923633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538923633">(Sep 11 2025 at 18:47)</a>:</h4>
<p><em>and</em> there is the configuration of the host which <em>should</em> be less platform specific, but it depends completely on your implementation</p>



<a name="538923740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538923740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538923740">(Sep 11 2025 at 18:48)</a>:</h4>
<p>Like for example TextEncoder is obviously available in both environments so there's nothing inherently platform specific about your screenshot above, though it's part of the configuration for "acting as the host"</p>



<a name="538931925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538931925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Victor Adossi <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538931925">(Sep 11 2025 at 19:39)</a>:</h4>
<p>OK new version of jco is out that should fix that bindgen issue: </p>
<p><a href="https://www.npmjs.com/package/@bytecodealliance/jco/v/1.15.0">https://www.npmjs.com/package/@bytecodealliance/jco/v/1.15.0</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://www.npmjs.com/package/@bytecodealliance/jco/v/1.15.0" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1f95ebb8bfed4d27a76408b23d90d6ad57189dbd/68747470733a2f2f7374617469632d70726f64756374696f6e2e6e706d6a732e636f6d2f33333865343930356132363834636139366530386337373830666336383431322e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://www.npmjs.com/package/@bytecodealliance/jco/v/1.15.0" title="@bytecodealliance/jco">@bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript tooling for working with WebAssembly Components. Latest version: 1.15.0, last published: 6 minutes ago. Start using @bytecodealliance/jco in your project by running `npm i @bytecodealliance/jco`. There are 10 other projects in the npm registry using @bytecodealliance/jco.</div></div></div>



<a name="538932227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538932227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Visness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538932227">(Sep 11 2025 at 19:41)</a>:</h4>
<p>Thanks!</p>



<a name="538945322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538945322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milan (rajsite) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538945322">(Sep 11 2025 at 21:28)</a>:</h4>
<p>It doesn't address the API concerns (and don't think it's trying to) but I have found the  WASI p2 browser shim made by <span class="user-mention" data-user-id="684890">@Catherine (whitequark)</span> easier to extend / hack on:<br>
<a href="https://github.com/YoWASP/runtime-js/blob/develop/lib/api.js#L42">https://github.com/YoWASP/runtime-js/blob/develop/lib/api.js#L42</a><br>
<a href="https://github.com/YoWASP/runtime-js/blob/develop/lib/wasi-virt.js">https://github.com/YoWASP/runtime-js/blob/develop/lib/wasi-virt.js</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/YoWASP/runtime-js/blob/develop/lib/api.js#L42" style="background-image: url(&quot;https://uploads.zulipusercontent.net/e98a8df538595de44bdc482abb583e600884415c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373230653135326439653532663032663331313633303136343661613465303935393734343130386161633639613038633861313138306361333464313239302f596f574153502f72756e74696d652d6a73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/YoWASP/runtime-js/blob/develop/lib/api.js#L42" title="runtime-js/lib/api.js at develop · YoWASP/runtime-js">runtime-js/lib/api.js at develop · YoWASP/runtime-js</a></div><div class="message_embed_description">Common runtime for YoWASP packages deployed to NPM, interfacing with Node.js and the browser - YoWASP/runtime-js</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/YoWASP/runtime-js/blob/develop/lib/wasi-virt.js" style="background-image: url(&quot;https://uploads.zulipusercontent.net/e98a8df538595de44bdc482abb583e600884415c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373230653135326439653532663032663331313633303136343661613465303935393734343130386161633639613038633861313138306361333464313239302f596f574153502f72756e74696d652d6a73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/YoWASP/runtime-js/blob/develop/lib/wasi-virt.js" title="runtime-js/lib/wasi-virt.js at develop · YoWASP/runtime-js">runtime-js/lib/wasi-virt.js at develop · YoWASP/runtime-js</a></div><div class="message_embed_description">Common runtime for YoWASP packages deployed to NPM, interfacing with Node.js and the browser - YoWASP/runtime-js</div></div></div>



<a name="538951899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/538951899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Catherine (whitequark) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#538951899">(Sep 11 2025 at 22:35)</a>:</h4>
<p>o/ Happy to answer questions!</p>
<p>And yeah, I found the "official" shim kind of burdensome to work with, and it didn't support my use case (virtual FS) to start with.</p>



<a name="539879495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Run%20WASI%200.1%20module%20with%20jco%3F/near/539879495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bakkot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Run.20WASI.200.2E1.20module.20with.20jco.3F.html#539879495">(Sep 16 2025 at 19:27)</a>:</h4>
<p>For just the basic "get a WASI 0.1 module running on the web", I have found <a href="https://github.com/taybenlor/runno">https://github.com/taybenlor/runno</a> to be useful; there's a demo at <a href="https://runno.dev/wasi/">https://runno.dev/wasi/</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/taybenlor/runno" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1cc1be439a99dfe304240a8b5133d1eb77b54b8b/68747470733a2f2f7265706f7369746f72792d696d616765732e67697468756275736572636f6e74656e742e636f6d2f3337343131363636342f34316233353834342d656133362d343961642d613562352d366161353965613064666566&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/taybenlor/runno" title="GitHub - taybenlor/runno: Sandboxed runtime for programming languages and WASI binaries. Works in the browser or on your server.">GitHub - taybenlor/runno: Sandboxed runtime for programming languages and WASI binaries. Works in the browser or on your server.</a></div><div class="message_embed_description">Sandboxed runtime for programming languages and WASI binaries. Works in the browser or on your server. - taybenlor/runno</div></div></div>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>