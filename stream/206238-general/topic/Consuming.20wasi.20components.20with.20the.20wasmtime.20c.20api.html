<html>
<head><meta charset="utf-8"><title>Consuming wasi components with the wasmtime c api · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Consuming.20wasi.20components.20with.20the.20wasmtime.20c.20api.html">Consuming wasi components with the wasmtime c api</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="539152168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Consuming%20wasi%20components%20with%20the%20wasmtime%20c%20api/near/539152168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Consuming.20wasi.20components.20with.20the.20wasmtime.20c.20api.html#539152168">(Sep 12 2025 at 19:37)</a>:</h4>
<p>Hi!</p>
<p>Like the title says, I'm trying to run a wasi component in a host program by using the wasmtime c-API.  I created a component following the example in the component book:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">docs</span><span class="p">:</span><span class="nc">adder</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">;</span>

<span class="n">interface</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">add</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">world</span><span class="w"> </span><span class="n">adder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">add</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>And I'm trying to access the add function with the following code but it fails.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// Finding the add interface</span>
<span class="n">wasmtime_component_export_index_t</span><span class="w"> </span><span class="o">*</span><span class="n">interface_export</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime_component_instance_get_export_index</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">nullptr</span><span class="p">,</span><span class="w"> </span><span class="s">"add"</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">interface_export</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LOGE</span><span class="p">(</span><span class="s">"Failed to find interface export 'add'"</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The documentation for the c-api only shows how to load and run a module. Does anyone know where I can find info on how to load a component's world, interface, functions, etc...?</p>



<a name="539155469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Consuming%20wasi%20components%20with%20the%20wasmtime%20c%20api/near/539155469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Consuming.20wasi.20components.20with.20the.20wasmtime.20c.20api.html#539155469">(Sep 12 2025 at 20:04)</a>:</h4>
<p>you'll need to lookup the instance named <code>docs:adder/add@0.1.0</code> and then lookup the <code>add</code> function from that instance</p>



<a name="539260342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Consuming%20wasi%20components%20with%20the%20wasmtime%20c%20api/near/539260342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Consuming.20wasi.20components.20with.20the.20wasmtime.20c.20api.html#539260342">(Sep 13 2025 at 10:27)</a>:</h4>
<p>That didn't work neither. I tried to create a simple rust host that would run the same component based on <a href="https://docs.wasmtime.dev/examples-rust-wasip2.html">this example</a> but I get the same error "Cannot get <code>docs:adder@0.1.0</code> interface" from this : </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">interface_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span>
<span class="w">        </span><span class="p">.</span><span class="n">get_export_index</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="s">"docs:adder/add@0.1.0"</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Cannot get `docs:adder/add@0.1.0` interface"</span><span class="p">);</span>
</code></pre></div>
<p>I tried with "adder" and "add", but that didn't work neither.<br>
When looking at <a href="https://docs.rs/wasmtime/latest/wasmtime/component/bindgen_examples/_0_hello_world/index.html">this example</a> instead, I see the snippet uses <code>bindgen</code>. Are component makers supposed to bundle their wit files with the wasm file so host applications can read them?</p>



<a name="539567273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Consuming%20wasi%20components%20with%20the%20wasmtime%20c%20api/near/539567273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Consuming.20wasi.20components.20with.20the.20wasmtime.20c.20api.html#539567273">(Sep 15 2025 at 14:01)</a>:</h4>
<p>Could you share a reproduction of this? </p>
<blockquote>
<p>Are component makers supposed to bundle their wit files with the wasm file so host applications can read them?</p>
</blockquote>
<p>A WIT can be inferred from a wasm, so no, that's not required. The host would typically be originally built with a WIT, however, but that would be independent from wasms loaded at runtime.</p>



<a name="539616415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Consuming%20wasi%20components%20with%20the%20wasmtime%20c%20api/near/539616415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Consuming.20wasi.20components.20with.20the.20wasmtime.20c.20api.html#539616415">(Sep 15 2025 at 17:38)</a>:</h4>
<p>Right, that's actually what I ended up doing. My host library defines the wit and the wasi component implements it. Thanks!</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>