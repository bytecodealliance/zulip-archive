<html>
<head><meta charset="utf-8"><title>Traits for adding host function interfaces · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Traits.20for.20adding.20host.20function.20interfaces.html">Traits for adding host function interfaces</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="573559308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Traits%20for%20adding%20host%20function%20interfaces/near/573559308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lachlan Gunn <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Traits.20for.20adding.20host.20function.20interfaces.html#573559308">(Feb 12 2026 at 15:57)</a>:</h4>
<p>I'm involved in a project where we are building a bunch of different host interfaces that will ultimately all need to be linked into to a single Wasmtime runtime.  An idea that I've been toying with is to come up with a single trait that each crate will implement for its host interfaces, so that we can compose them all together without having to manually define views into the <code>Store&lt;T&gt;</code>'s <code>T</code>.</p>
<p>I've been experimenting with a macro that lets you encapsulate all the additions to the runtime in a common trait implementation on the host interface's state to go in the <code>Store</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[derive(Default)]</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">CounterState</span><span class="p">(</span><span class="kt">i64</span><span class="p">);</span>
<span class="k">impl</span><span class="w"> </span><span class="n">HostInterface</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CounterState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">link</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">HostInterfaceStateView</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">linker</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">Linker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Add host functions to the linker</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[derive(Default)]</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">StaticState</span><span class="p">(</span><span class="kt">i64</span><span class="p">);</span>
<span class="k">impl</span><span class="w"> </span><span class="n">HostInterface</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">StaticState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">link</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">HostInterfaceStateView</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">linker</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">Linker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Add host functions to the linker</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Then you can compose them together:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_extensions</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">MiniState</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">CounterState</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">wasmtime_extensions</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">State</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">MiniState</span><span class="p">,</span>
<span class="w">        </span><span class="n">StaticState</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>but also add them (edit: all at once) to a <code>Linker</code> with a single static method:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="nc">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Default</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="n">State</span><span class="p">::</span><span class="n">link</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">);</span>
</code></pre></div>
<p>But before I go down the rabbit-hole of solving some of its limitations (mainly dealing with configuration) and learning to tidy it up into a proc macro that can be <code>#[derive]</code>ed, is there something out there like this already that I've somehow missed, that would allow these host interfaces to be encapsulated and then aggregated together in a more-or-less tidy way in the same way that <code>wasmtime-wasi</code> does?</p>



<a name="573574979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Traits%20for%20adding%20host%20function%20interfaces/near/573574979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lachlan Gunn <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Traits.20for.20adding.20host.20function.20interfaces.html#573574979">(Feb 12 2026 at 17:01)</a>:</h4>
<p>Or is this something that might be better done using <code>bindgen!</code> directly?</p>



<a name="573604360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Traits%20for%20adding%20host%20function%20interfaces/near/573604360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Traits.20for.20adding.20host.20function.20interfaces.html#573604360">(Feb 12 2026 at 19:35)</a>:</h4>
<p>One piece of inspiration I might recommend here is <a href="https://github.com/spinframework/spin/tree/main/crates/factors">Spin <code>Factor</code>s</a> which while I haven't heavily used them myself I feel have done a really good job of enabling separate crates to build various implementations to get relatively easily woven in at the end</p>



<a name="573672055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Traits%20for%20adding%20host%20function%20interfaces/near/573672055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lachlan Gunn <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Traits.20for.20adding.20host.20function.20interfaces.html#573672055">(Feb 13 2026 at 06:16)</a>:</h4>
<p>Thanks! I'll take a look</p>



<a name="573688521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Traits%20for%20adding%20host%20function%20interfaces/near/573688521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lachlan Gunn <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Traits.20for.20adding.20host.20function.20interfaces.html#573688521">(Feb 13 2026 at 08:28)</a>:</h4>
<p>This looks great. Sadly it comes with a little bit of baggage from Spin that prevents it from being used as-is, but as you say, it looks like great inspiration, and I'm glad to have some confirmation that it's not a completely terrible idea. I had that doubt in my mind of _this seems obvious enough that if it were a good idea, then it would probably have been built into Wasmtime or some associated crate already_.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>