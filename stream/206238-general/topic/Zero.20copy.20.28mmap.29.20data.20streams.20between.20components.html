<html>
<head><meta charset="utf-8"><title>Zero copy (mmap) data streams between components · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html">Zero copy (mmap) data streams between components</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="534820137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534820137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534820137">(Aug 17 2025 at 12:16)</a>:</h4>
<p>Starting from my AUTOSAR experiments I finally have a <a href="https://github.com/cpetig/wasm-shm-test/tree/main?tab=readme-ov-file#publisher-subscriber">webassembly prototype</a> for zero copy publisher subscriber. It uses WASI 0.3 streams to broadcast host side shared memory buffers (a resource) from one publisher to two subscribers. The components pre-allocate linear memory (size calculated by the host to enable page aligned padding) for memory mapping the data into their linear address space.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cpetig/wasm-shm-test/tree/main?tab=readme-ov-file#publisher-subscriber" style="background-image: url(&quot;https://uploads.zulipusercontent.net/59e87176d79600b471e6ad9481720e6c4588ba53/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353836626638313030393261643262373565303665353839393136643734383030386137633039623565643064316666393462653633313239396331323062372f6370657469672f7761736d2d73686d2d74657374&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cpetig/wasm-shm-test/tree/main?tab=readme-ov-file#publisher-subscriber" title="GitHub - cpetig/wasm-shm-test: Prototype for zero-copy shared memory inter-component exchange">GitHub - cpetig/wasm-shm-test: Prototype for zero-copy shared memory inter-component exchange</a></div><div class="message_embed_description">Prototype for zero-copy shared memory inter-component exchange - cpetig/wasm-shm-test</div></div></div>



<a name="534820166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534820166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534820166">(Aug 17 2025 at 12:17)</a>:</h4>
<p>The buffer API could be implemented with copying without the guests noticing, also several efficient zero-copy mappings to MPU only embedded are possible. The host can optimize the implementation to avoid attachment during run-time without affecting the ownership logic, this of course assumes a well-behaved publisher; subscribers remain untrusted. Adding a subscriber only requires creating another <code>stream&lt;memory-block&gt;</code> on the sender side (and writing four bytes to it per published data). So the overhead per subscriber is minimal.</p>
<p>In a point to point communication the subscriber receives ownership of resources sent by the publisher.<br>
For shared buffers the writer passes the ownership to the buffer, subscribers won't touch it (can only read-only borrow access), the writer destructs the previous objects when the buffer is re-attached for overwriting.</p>
<p>Note: I abuse dummy resource handles to represent linear addresses, as these scale to 64 bit on native.</p>



<a name="534820299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534820299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534820299">(Aug 17 2025 at 12:19)</a>:</h4>
<p>The idea is to extend this prototype towards a <a href="https://github.com/WebAssembly/component-model/issues/369">caller provided buffer</a> prototype of the component model.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/issues/369" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a7bea3d9280656742d69c7a5cbaeeb8bb216490a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306362666463316666633733643961396337623836646231643339323738333961646636643431646566653830393866326437316334613137346630316237382f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c2f6973737565732f333639&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/issues/369" title="Caller provided buffers question · Issue #369 · WebAssembly/component-model">Caller provided buffers question · Issue #369 · WebAssembly/component-model</a></div><div class="message_embed_description">Last week, an idea was presented by which callers could prevent unnecessary intermediate copies using the syntax: read: func(length: u64) -&gt; result&lt;list&lt;u8; ..length&gt;,error-code&gt;; Is there any prov...</div></div></div>



<a name="534828656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534828656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534828656">(Aug 17 2025 at 15:02)</a>:</h4>
<p>one thing to consider is that wasm is not only 32-bit, so the size should be 64-bit where 32-bit components require the size to be small enough to fit</p>



<a name="534829171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534829171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534829171">(Aug 17 2025 at 15:13)</a>:</h4>
<p>I would vote for resource handles (id not rep) to become 64 bit on wasm64, just for consistency. But this has not yet been specified.</p>
<p>In my case I use WIT to describe future built-in functions, so this isn't a shortcoming of the technology but rather a temporary workaround.</p>



<a name="534829242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534829242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534829242">(Aug 17 2025 at 15:14)</a>:</h4>
<p>Sorry, I misread your post. For a single shared memory block 4GB sounds plenty to me, even in the context of machine vision or learning.</p>



<a name="534829332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534829332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christof Petig <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534829332">(Aug 17 2025 at 15:16)</a>:</h4>
<p>Sadly up to now there is no pointer sized data type in the component model, this is why I use resource handles which have this property in symmetric ABI.</p>



<a name="534829418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534829418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534829418">(Aug 17 2025 at 15:18)</a>:</h4>
<p>well, I'd expect 3D medical images could easily be &gt;4GB if you have a 32-bit color at each voxel and have &gt; 1024x1024x1024 resolution</p>



<a name="534829528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534829528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534829528">(Aug 17 2025 at 15:20)</a>:</h4>
<p>there's probably lots of other things where an item can reasonably be more than 4GB, and having a 64-bit size isn't much burden on 32-bit instances</p>



<a name="534829619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Zero%20copy%20%28mmap%29%20data%20streams%20between%20components/near/534829619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Zero.20copy.20.28mmap.29.20data.20streams.20between.20components.html#534829619">(Aug 17 2025 at 15:23)</a>:</h4>
<p>plus, in 10-20yr, 4GB will probably be pitifully small</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>