<html>
<head><meta charset="utf-8"><title>Using an interface with wasm-tools component embed · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html">Using an interface with wasm-tools component embed</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="534724131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724131">(Aug 15 2025 at 23:36)</a>:</h4>
<p>I have the following in calculator.wat:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"add"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="kt">f32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">f32</span><span class="p">)</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="kt">f32</span><span class="p">.</span><span class="n">add</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>and the following in calculator.wit:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">example</span><span class="p">:</span><span class="nc">component</span><span class="p">;</span>

<span class="n">interface</span><span class="w"> </span><span class="n">calculator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">add</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">f32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">f32</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">world</span><span class="w"> </span><span class="n">calculator</span><span class="o">-</span><span class="n">world</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">calculator</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>and I get this error when trying to create a wrapping component via <code>wasm-tools</code> commands:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wat2wasm</span><span class="w"> </span><span class="n">calculator</span><span class="p">.</span><span class="n">wat</span><span class="w"> </span><span class="o">--</span><span class="n">output</span><span class="o">=-</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">\</span>
<span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">embed</span><span class="w"> </span><span class="n">calculator</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">\</span>
<span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">calculator</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="err">`</span><span class="n">example</span><span class="p">:</span><span class="nc">component</span><span class="o">/</span><span class="n">calculator</span><span class="err">`</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="n">add</span><span class="err">`</span>
</code></pre></div>
<p>It works fine if either the world exports the function directly (no interface) OR if I <code>export "example:component/calculator#add"</code> in the wat file. Simply adding the interface (<code>export calculator#add</code>) in the wat file does not work either, but I don't want the core module to have awareness of the WIT that will be wrapping it as a component anyways. I was hoping functions would map even through an interface as long as there were no ambiguities in function name. So, I thought I would check here in case this has been discussed. I don't see anything directly related to this in what I've searched so far.</p>



<a name="534724227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724227">(Aug 15 2025 at 23:38)</a>:</h4>
<blockquote>
<p>I don't want the core module to have awareness of the WIT</p>
</blockquote>
<p>More-or-less, this isn't supported. What you're describing is a viable use case and you can build it out manually, but when using standard tools you'll need to match standard naming conventions</p>



<a name="534724248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724248">(Aug 15 2025 at 23:38)</a>:</h4>
<p>put another way, the component model supports what you want to do, but the tooling does not</p>



<a name="534724385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724385">(Aug 15 2025 at 23:41)</a>:</h4>
<p>in theory this wouldn't be too hard to support though, you'd want a mapping specified to <code>wasm-tools component new</code> saying "hey when you look for <code>example:component/calculator#add</code> use <code>add</code> instead</p>



<a name="534724464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724464">(Aug 15 2025 at 23:44)</a>:</h4>
<p>Thanks for the quick reply! Sounds like I should create a pre-processing tool that also consults the WIT and simply updates the exports in the core module and call that before <code>embed</code>. Ah, or (reading your follow-up as I type), it would be nicer on the inbound side as mapping rules for expanding the simple function export.</p>



<a name="534724787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724787">(Aug 15 2025 at 23:52)</a>:</h4>
<p>I think this should be relatively straightforward to implement in <code>wasm-tools component new</code> (the <code>wit-component</code> crate in the wasm-tools repo), but doing a preprocessing step would also work</p>



<a name="534724975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Using%20an%20interface%20with%20wasm-tools%20component%20embed/near/534724975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Using.20an.20interface.20with.20wasm-tools.20component.20embed.html#534724975">(Aug 15 2025 at 23:56)</a>:</h4>
<p>I will create a preprocessing tool, but will also explore what's involved to implement it in <code>wasm-tools</code>, possibly leading to a PR if you do think it would be a welcome addition.</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>