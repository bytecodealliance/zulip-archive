<html>
<head><meta charset="utf-8"><title>Overflow flag is not used for branches? · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Overflow.20flag.20is.20not.20used.20for.20branches.3F.html">Overflow flag is not used for branches?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="553870163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Overflow%20flag%20is%20not%20used%20for%20branches%3F/near/553870163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adel Prokurov <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Overflow.20flag.20is.20not.20used.20for.20branches.3F.html#553870163">(Nov 05 2025 at 14:24)</a>:</h4>
<p>Hello! I found out that <code>jo</code> is not emitted on X86 for overflowing ops:</p>
<div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="w">    </span><span class="err">415</span><span class="nl">c:</span><span class="w">   </span><span class="nf">f7</span><span class="w"> </span><span class="no">ef</span><span class="w">                   </span><span class="no">imul</span><span class="w">   </span><span class="nv">%edi</span>
<span class="w">    </span><span class="err">415</span><span class="nl">e:</span><span class="w">   </span><span class="err">49</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">fc</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rdi</span><span class="p">,</span><span class="nv">%r12</span>
<span class="w">    </span><span class="err">4161:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="no">c1</span><span class="w">                </span><span class="no">seto</span><span class="w">   </span><span class="nv">%cl</span>
<span class="w">    </span><span class="err">4164:</span><span class="w">   </span><span class="err">84</span><span class="w"> </span><span class="nf">c9</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%cl</span><span class="p">,</span><span class="nv">%cl</span>
<span class="w">    </span><span class="err">4166:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="no">jne</span><span class="w">    </span><span class="mi">4381</span><span class="w"> </span><span class="err">&lt;</span><span class="no">fn0</span><span class="p">:</span><span class="no">fac</span><span class="p">:(</span><span class="no">main</span><span class="p">)</span><span class="no">_fac</span><span class="err">+</span><span class="mi">0x391</span><span class="err">&gt;</span>
</code></pre></div>
<p>It's emitted from this code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">ovf</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssa</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">ins</span><span class="p">().</span><span class="n">smul_overflow</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span><span class="p">);</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">succ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssa</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">create_block</span><span class="p">();</span>
<span class="w">            </span><span class="n">ssa</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">append_block_param</span><span class="p">(</span><span class="n">succ</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">::</span><span class="n">I32</span><span class="p">);</span>
<span class="w">            </span><span class="n">ssa</span><span class="p">.</span><span class="n">builder</span>
<span class="w">                </span><span class="p">.</span><span class="n">ins</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">brif</span><span class="p">(</span><span class="n">ovf</span><span class="p">,</span><span class="w"> </span><span class="n">slow</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[],</span><span class="w"> </span><span class="n">succ</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">BlockArg</span><span class="p">::</span><span class="n">Value</span><span class="p">(</span><span class="n">result</span><span class="p">)]);</span>
<span class="w">            </span><span class="n">ssa</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">switch_to_block</span><span class="p">(</span><span class="n">succ</span><span class="p">);</span>
<span class="w">            </span><span class="n">ssa</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">block_params</span><span class="p">(</span><span class="n">succ</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>



<a name="553878748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Overflow%20flag%20is%20not%20used%20for%20branches%3F/near/553878748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Overflow.20flag.20is.20not.20used.20for.20branches.3F.html#553878748">(Nov 05 2025 at 14:57)</a>:</h4>
<p>Yes this is known to have suboptimal codegen at this time, so this is not unexpected at least. That being said it's something that we'd like to improve nonetheless!</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>