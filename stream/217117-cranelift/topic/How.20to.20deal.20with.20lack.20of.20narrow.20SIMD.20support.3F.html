<html>
<head><meta charset="utf-8"><title>How to deal with lack of narrow SIMD support? · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/How.20to.20deal.20with.20lack.20of.20narrow.20SIMD.20support.3F.html">How to deal with lack of narrow SIMD support?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="566005656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/How%20to%20deal%20with%20lack%20of%20narrow%20SIMD%20support%3F/near/566005656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> vx <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/How.20to.20deal.20with.20lack.20of.20narrow.20SIMD.20support.3F.html#566005656">(Jan 01 2026 at 23:39)</a>:</h4>
<p>Hi! I've recently hit some unimplemented SIMD operations, such as <code>fmul</code> with <code>f32x2</code> on x64 (<code>should be implemented in ISLE</code>), and I'm wondering how exactly I should deal with it. </p>
<p>I thought about extending my value to a <code>f32x4</code>, but I don't see any instruction that would allow me to easily do that except, maybe, <code>insertlane</code> and <code>extractlane</code>, but I'm worried this would hurt codegen &amp; performance. Is this really the way to go about it?</p>
<p>I've also considered implementing these lowerings, but I've never contributed to cranelift and don't know how much work that would be. If this is an approachable issue, I'd happily contribute.</p>



<a name="566074818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/How%20to%20deal%20with%20lack%20of%20narrow%20SIMD%20support%3F/near/566074818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/How.20to.20deal.20with.20lack.20of.20narrow.20SIMD.20support.3F.html#566074818">(Jan 02 2026 at 16:13)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="996593">@vx</span> -- those are indeed the two general approaches (widen to 128 bit or fill out the 64-bit lowerings in Cranelift). The former is probably actually pretty reasonable performance-wise as long as you can keep data in registers most of the time -- the widening/narrowing will happen whenever you store/load from your native narrow-vector format only, and the nature of SIMD is that all lanes go independently at the same time so the extra lanes can just be "don't care" bits and won't slow things down.</p>
<p>Ideally we'd also fill out narrow-SIMD lowerings, but that's a big project. IIRC the 64-bit SIMD stuff was originally put in place for aarch64 because it supports these variants, but other ISAs may not, so we effectively need the equivalent of widening/narrowing at the instruction selection level (at least where interfacing with memory via loads/stores) anyway.</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>