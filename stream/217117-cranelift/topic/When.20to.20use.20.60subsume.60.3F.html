<html>
<head><meta charset="utf-8"><title>When to use `subsume`? · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/When.20to.20use.20.60subsume.60.3F.html">When to use `subsume`?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="558886508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/When%20to%20use%20%60subsume%60%3F/near/558886508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/When.20to.20use.20.60subsume.60.3F.html#558886508">(Nov 23 2025 at 11:05)</a>:</h4>
<p>Hi, reading <a href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md">https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md</a>,</p>
<p>I find it a little challenging to decide whether I should use <code>subsume</code> or not,<br>
and I think it would be a good idea to clarify more on using <code>subsume</code>s.</p>
<p>It only says to use <code>subsume</code> when the rule discards values on LHS, and not to use it when it only discards constants. However, there are rules contradictory to the principle:</p>
<p>these rules only discard constants but use <code>subsume</code>:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16">https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16</a></p>
<p>these rules use <code>subsume</code> does not discard any value on LHS:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39">https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39</a></p>
<p>Thanks for reading!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4176f6de7ac20f6e6830f90d3f2ad197998dafea/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376336643565376435343430623533363230343364353462346437313432623931616633393463623338336464316333373838636439303661346136643466322f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/README.md" title="wasmtime/cranelift/codegen/src/opts/README.md at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime">wasmtime/cranelift/codegen/src/opts/README.md at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4176f6de7ac20f6e6830f90d3f2ad197998dafea/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376336643565376435343430623533363230343364353462346437313432623931616633393463623338336464316333373838636439303661346136643466322f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L7-L16" title="wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime">wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4176f6de7ac20f6e6830f90d3f2ad197998dafea/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376336643565376435343430623533363230343364353462346437313432623931616633393463623338336464316333373838636439303661346136643466322f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/68a6afd4f925724fd359c13a27fac5a6163d12f4/cranelift/codegen/src/opts/arithmetic.isle#L34-L39" title="wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime">wasmtime/cranelift/codegen/src/opts/arithmetic.isle at 68a6afd4f925724fd359c13a27fac5a6163d12f4 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<a name="558917478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/When%20to%20use%20%60subsume%60%3F/near/558917478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/When.20to.20use.20.60subsume.60.3F.html#558917478">(Nov 23 2025 at 19:39)</a>:</h4>
<p>We have the "available locations" analysis now that makes rule 2 unnecessary there -- I should update that README, sorry!</p>



<a name="558917536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/When%20to%20use%20%60subsume%60%3F/near/558917536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/When.20to.20use.20.60subsume.60.3F.html#558917536">(Nov 23 2025 at 19:39)</a>:</h4>
<p>In general, subsume is quite important for compilation performance (I have some data showing this I'll present at some point) but use of it is not necessary semantically. You can think of it as "I am so sure that this rewrite makes things better that you should always take it and discard the original"</p>



<a name="558917594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/When%20to%20use%20%60subsume%60%3F/near/558917594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/When.20to.20use.20.60subsume.60.3F.html#558917594">(Nov 23 2025 at 19:40)</a>:</h4>
<p>so for example, with constant propagation we use it because it's always better to replace a dynamic ALU operation with a literal constant</p>



<a name="558960046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/When%20to%20use%20%60subsume%60%3F/near/558960046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/When.20to.20use.20.60subsume.60.3F.html#558960046">(Nov 24 2025 at 06:31)</a>:</h4>
<p>thanks!</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>