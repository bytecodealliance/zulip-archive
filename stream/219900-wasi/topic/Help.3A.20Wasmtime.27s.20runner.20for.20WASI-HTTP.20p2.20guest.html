<html>
<head><meta charset="utf-8"><title>Help: Wasmtime&#x27;s runner for WASI-HTTP p2 guest · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html">Help: Wasmtime&#x27;s runner for WASI-HTTP p2 guest</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="526609626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526609626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Suszynski <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526609626">(Jul 01 2025 at 13:33)</a>:</h4>
<p>Hi there. I'm trying to develop a PoC of having the Wasmtime-based runner to execute wasi-http p2 guest. For the guest, I tried doing a similar thing that Dan did here: <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a>, but instead of generating all the bindings from WIT files, I tried using <a href="https://crates.io/crates/wasi/0.14.2+wasi-0.2.4">wasi 0.14 crate</a>.</p>
<p>Here you could see my code:</p>
<ul>
<li><a href="https://github.com/cardil/knative-serving-wasm/tree/ae6e3570e0b1c48e1c58364450d786ec273d5ace/runner">runner</a></li>
<li><a href="https://github.com/cardil/knative-serving-wasm/tree/main/examples/modules/reverse-text">guest</a></li>
</ul>
<p>While trying to execute the runner, I get:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Error: component imports instance `wasi:cli/environment@0.2.4`, but a matching implementation was not found in the linker

Caused by:
    0: instance export `get-environment` has the wrong type
    1: function implementation is missing
</code></pre></div>
<p>Does this could be done, in a way I'm trying? Can someone help with this?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/sunfishcode/hello-wasi-http" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b3998da333b4ce3d93e37dc657bc7e855119ef83/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653330626432636631633564656434313937386336326233663238633833343436623434383338333334373239636536366338646364333439656139666238352f73756e66697368636f64652f68656c6c6f2d776173692d68747470&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/sunfishcode/hello-wasi-http" title="GitHub - sunfishcode/hello-wasi-http">GitHub - sunfishcode/hello-wasi-http</a></div><div class="message_embed_description">Contribute to sunfishcode/hello-wasi-http development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/cardil/knative-serving-wasm/tree/ae6e3570e0b1c48e1c58364450d786ec273d5ace/runner" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b764290558f94f331a36b7857cd12d5f17517780/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323031306539353433303532313333616236643431623337643938666139346666396365363938623236313464316466316534613136653730333764303831662f63617264696c2f6b6e61746976652d73657276696e672d7761736d&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cardil/knative-serving-wasm/tree/ae6e3570e0b1c48e1c58364450d786ec273d5ace/runner" title="knative-serving-wasm/runner at ae6e3570e0b1c48e1c58364450d786ec273d5ace · cardil/knative-serving-wasm">knative-serving-wasm/runner at ae6e3570e0b1c48e1c58364450d786ec273d5ace · cardil/knative-serving-wasm</a></div><div class="message_embed_description">A WASM (wasi) runner for Knative. Contribute to cardil/knative-serving-wasm development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/cardil/knative-serving-wasm/tree/main/examples/modules/reverse-text" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b764290558f94f331a36b7857cd12d5f17517780/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323031306539353433303532313333616236643431623337643938666139346666396365363938623236313464316466316534613136653730333764303831662f63617264696c2f6b6e61746976652d73657276696e672d7761736d&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cardil/knative-serving-wasm/tree/main/examples/modules/reverse-text" title="knative-serving-wasm/examples/modules/reverse-text at main · cardil/knative-serving-wasm">knative-serving-wasm/examples/modules/reverse-text at main · cardil/knative-serving-wasm</a></div><div class="message_embed_description">A WASM (wasi) runner for Knative. Contribute to cardil/knative-serving-wasm development by creating an account on GitHub.</div></div></div>



<a name="526615478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526615478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526615478">(Jul 01 2025 at 13:59)</a>:</h4>
<p>You will likely need to call <code>wasmtime_wasi::p2::add_to_linker_async</code> on the linker too. Your wasm component depends on the wasi-cli interfaces like all components compiled for the wasm32-wasip2 rustc target.</p>



<a name="526615533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526615533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526615533">(Jul 01 2025 at 14:00)</a>:</h4>
<p>You are linking <code>wasmtime_wasi_http</code> into your host but that doesn't include all of the interfaces needed by Rust <code>wasi</code> targets. You would either need your guest to target <code>wasm32-unknown-unknown</code> or ... do what bjorn3 just said <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="526630422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526630422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Suszynski <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526630422">(Jul 01 2025 at 15:07)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> I'm building the guest like this: <a href="https://github.com/cardil/knative-serving-wasm/blob/ae6e3570e0b1c48e1c58364450d786ec273d5ace/build/tasks/build.go#L24-L25">build/tasks/build.go#L24-L25</a>, so using the <code>wasm32-wasip2</code> target. So, I thought it would have those interfaces.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cardil/knative-serving-wasm/blob/ae6e3570e0b1c48e1c58364450d786ec273d5ace/build/tasks/build.go#L24-L25" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b764290558f94f331a36b7857cd12d5f17517780/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323031306539353433303532313333616236643431623337643938666139346666396365363938623236313464316466316534613136653730333764303831662f63617264696c2f6b6e61746976652d73657276696e672d7761736d&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cardil/knative-serving-wasm/blob/ae6e3570e0b1c48e1c58364450d786ec273d5ace/build/tasks/build.go#L24-L25" title="knative-serving-wasm/build/tasks/build.go at ae6e3570e0b1c48e1c58364450d786ec273d5ace · cardil/knative-serving-wasm">knative-serving-wasm/build/tasks/build.go at ae6e3570e0b1c48e1c58364450d786ec273d5ace · cardil/knative-serving-wasm</a></div><div class="message_embed_description">A WASM (wasi) runner for Knative. Contribute to cardil/knative-serving-wasm development by creating an account on GitHub.</div></div></div>



<a name="526642749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526642749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526642749">(Jul 01 2025 at 16:13)</a>:</h4>
<p>Yes, by targetting <code>wasm32-wasip2</code> your guest is implicitly importing a bunch of <code>wasi</code> interfaces that aren't currently provided by your host, which currently only implements the <code>wasi:http/proxy</code> world by <a href="https://github.com/cardil/knative-serving-wasm/blob/ae6e3570e0b1c48e1c58364450d786ec273d5ace/runner/src/main.rs#L33">linking with wasmtime_wasi_http</a>.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cardil/knative-serving-wasm/blob/ae6e3570e0b1c48e1c58364450d786ec273d5ace/runner/src/main.rs#L33" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b764290558f94f331a36b7857cd12d5f17517780/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323031306539353433303532313333616236643431623337643938666139346666396365363938623236313464316466316534613136653730333764303831662f63617264696c2f6b6e61746976652d73657276696e672d7761736d&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cardil/knative-serving-wasm/blob/ae6e3570e0b1c48e1c58364450d786ec273d5ace/runner/src/main.rs#L33" title="knative-serving-wasm/runner/src/main.rs at ae6e3570e0b1c48e1c58364450d786ec273d5ace · cardil/knative-serving-wasm">knative-serving-wasm/runner/src/main.rs at ae6e3570e0b1c48e1c58364450d786ec273d5ace · cardil/knative-serving-wasm</a></div><div class="message_embed_description">A WASM (wasi) runner for Knative. Contribute to cardil/knative-serving-wasm development by creating an account on GitHub.</div></div></div>



<a name="526643190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526643190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526643190">(Jul 01 2025 at 16:16)</a>:</h4>
<p>I haven't worked on this for the latest versions of wasmtime but I think you would need to switch to instead use these two functions:</p>
<ul>
<li><a href="https://docs.rs/wasmtime-wasi/34.0.1/wasmtime_wasi/p2/fn.add_to_linker_async.html">https://docs.rs/wasmtime-wasi/34.0.1/wasmtime_wasi/p2/fn.add_to_linker_async.html</a> </li>
<li><a href="https://docs.rs/wasmtime-wasi-http/34.0.1/wasmtime_wasi_http/fn.add_only_http_to_linker_async.html">https://docs.rs/wasmtime-wasi-http/34.0.1/wasmtime_wasi_http/fn.add_only_http_to_linker_async.html</a></li>
</ul>



<a name="526658560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526658560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Suszynski <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526658560">(Jul 01 2025 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> Yes, it works!! Thanks a lot! You can see the change here: <a href="https://github.com/cardil/knative-serving-wasm/pull/4">https://github.com/cardil/knative-serving-wasm/pull/4</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cardil/knative-serving-wasm/pull/4" style="background-image: url(&quot;https://uploads.zulipusercontent.net/558b059c31a5893edca6dbe48bdca846e1446858/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303537333762346634346530373362343230383532306661363339383738396362633735333534383934616338373431353137643063336234356464373533372f63617264696c2f6b6e61746976652d73657276696e672d7761736d2f70756c6c2f34&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cardil/knative-serving-wasm/pull/4" title=":lady_beetle: Runner works by cardil · Pull Request #4 · cardil/knative-serving-wasm">:lady_beetle: Runner works by cardil · Pull Request #4 · cardil/knative-serving-wasm</a></div><div class="message_embed_description">🥳 🍾 The runner works as expected:
$ http :8000 text==&#39;Hola!&#39;
HTTP/1.1 200 OK
date: Tue, 01 Jul 2025 17:44:50 GMT
transfer-encoding: chunked

!aloH

Runner process:
$ cargo run --color=alway...</div></div></div>



<a name="526660379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526660379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Suszynski <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526660379">(Jul 01 2025 at 18:09)</a>:</h4>
<p>The <code>wasmtime_wasi_http</code> crate, shows in the usage example - <a href="https://docs.rs/wasmtime-wasi-http/34.0.1/wasmtime_wasi_http/index.html">https://docs.rs/wasmtime-wasi-http/34.0.1/wasmtime_wasi_http/index.html</a> to just use:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_wasi_http</span><span class="p">::</span><span class="n">add_to_linker_async</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
<p>But that does not work either. I wonder if the doc is wrong on this? Probably yes, as the tests are using this working tandem (I should have been looking at the tests, they never lie!):</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/c953cc8fd16df3ff73853101402f343436ab4cef/crates/wasi-http/tests/all/p2/async_.rs#L15-L16">https://github.com/bytecodealliance/wasmtime/blob/c953cc8fd16df3ff73853101402f343436ab4cef/crates/wasi-http/tests/all/p2/async_.rs#L15-L16</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/c953cc8fd16df3ff73853101402f343436ab4cef/crates/wasi-http/tests/all/p2/async_.rs#L15-L16" style="background-image: url(&quot;https://uploads.zulipusercontent.net/3eb4a50b6cd0aecc78f967d2646d4ba7cfc50443/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f666437336330373564383834626666386139383362373766373865643965356531386339363733663362396231336232626334323639306662373662333663312f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/c953cc8fd16df3ff73853101402f343436ab4cef/crates/wasi-http/tests/all/p2/async_.rs#L15-L16" title="wasmtime/crates/wasi-http/tests/all/p2/async_.rs at c953cc8fd16df3ff73853101402f343436ab4cef · bytecodealliance/wasmtime">wasmtime/crates/wasi-http/tests/all/p2/async_.rs at c953cc8fd16df3ff73853101402f343436ab4cef · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<a name="526660567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526660567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Suszynski <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526660567">(Jul 01 2025 at 18:10)</a>:</h4>
<p>Once again, thanks for your help, folks! I appreciate it very much!</p>



<a name="526661261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526661261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526661261">(Jul 01 2025 at 18:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="933910">Chris Suszynski</span> <a href="#narrow/channel/219900-wasi/topic/Help.3A.20Wasmtime's.20runner.20for.20WASI-HTTP.20p2.20guest/near/526660379">said</a>:</p>
<blockquote>
<p>The <code>wasmtime_wasi_http</code> crate, shows in the usage example - <a href="https://docs.rs/wasmtime-wasi-http/34.0.1/wasmtime_wasi_http/index.html">https://docs.rs/wasmtime-wasi-http/34.0.1/wasmtime_wasi_http/index.html</a> to just use:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_wasi_http</span><span class="p">::</span><span class="n">add_to_linker_async</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
<p>But that does not work either. I wonder if the doc is wrong on this? Probably yes, as the tests are using this working tandem (I should have been looking at the tests, they never lie!):</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/c953cc8fd16df3ff73853101402f343436ab4cef/crates/wasi-http/tests/all/p2/async_.rs#L15-L16">https://github.com/bytecodealliance/wasmtime/blob/c953cc8fd16df3ff73853101402f343436ab4cef/crates/wasi-http/tests/all/p2/async_.rs#L15-L16</a></p>
</blockquote>
<p>file a repro if you have a moment against the docs! that should ALWAYS work. :-)</p>



<a name="526662350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526662350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526662350">(Jul 01 2025 at 18:24)</a>:</h4>
<p>ill fix the docs rn</p>



<a name="526662352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526662352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526662352">(Jul 01 2025 at 18:24)</a>:</h4>
<p>thank you for catching our error</p>



<a name="526662728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526662728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526662728">(Jul 01 2025 at 18:27)</a>:</h4>
<p>unfortunately that doc is no_run, because it starts a server that never gets any requests and never dies, so it would just spin forever</p>



<a name="526662759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526662759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526662759">(Jul 01 2025 at 18:27)</a>:</h4>
<p>otherwise cargo doc would have caught this bug</p>



<a name="526662790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526662790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526662790">(Jul 01 2025 at 18:27)</a>:</h4>
<p>im not brave enough to fix the no_running-ness right now. we regret the error.</p>



<a name="526663075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526663075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526663075">(Jul 01 2025 at 18:29)</a>:</h4>
<p>Is the example actually <em>wrong</em>? It might be confusing that your guest can't target <code>wasm32-wasip2</code> but it would work fine for a guest that just uses <code>proxy</code> right? Or am I missing something...?</p>



<a name="526663752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526663752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526663752">(Jul 01 2025 at 18:35)</a>:</h4>
<p>its just missing the add_to_linker for the wasmtime-wasi parts</p>



<a name="526663830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526663830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526663830">(Jul 01 2025 at 18:35)</a>:</h4>
<p>which are required, even in <code>proxy</code>, for the io package, stdio from cli, and others</p>



<a name="526664061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664061">(Jul 01 2025 at 18:37)</a>:</h4>
<p>I'm pretty sure <code>wasmtime_wasi_http::add_to_linker_async</code> does add those, which is what differentiates it from <code>add_only_http_to_linker_async</code></p>



<a name="526664211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664211">(Jul 01 2025 at 18:38)</a>:</h4>
<p>Either way it seems reasonable for the example to link the rest of wasi just to avoid this kind of confusion.</p>



<a name="526664268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664268">(Jul 01 2025 at 18:39)</a>:</h4>
<p>oh, you know what, you're right.</p>



<a name="526664315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664315">(Jul 01 2025 at 18:39)</a>:</h4>
<p>but, unfortunately, its very hard to actually target the proxy world, virtually all guests end up being proxy + cli imports</p>



<a name="526664359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664359">(Jul 01 2025 at 18:39)</a>:</h4>
<p>the <code>wasmtime server -Scli</code> set</p>



<a name="526664453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664453">(Jul 01 2025 at 18:40)</a>:</h4>
<p>Spin always links both so I'm not going to argue there. <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="526664480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664480">(Jul 01 2025 at 18:40)</a>:</h4>
<p>once we have 0.3 we can finally solve that problem in wasm with wasi-virt, but we gave up on it in 0.2 because too much pain for too little gain</p>



<a name="526664694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526664694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526664694">(Jul 01 2025 at 18:42)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/11171">https://github.com/bytecodealliance/wasmtime/pull/11171</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/11171" style="background-image: url(&quot;https://uploads.zulipusercontent.net/e2a0b12b7707471a31093f964e45d21e657c0253/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f663666343734303337376330323438666533353366316661626561623639323032323932336633323032373261323834303731306533363063353038373337612f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3131313731&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/11171" title="Cargo doc fixes by pchickey · Pull Request #11171 · bytecodealliance/wasmtime">Cargo doc fixes by pchickey · Pull Request #11171 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">wasmtime-wasi-http: fix docs missing wasmtime_wasi::p2::add_to_linker. This creates the equivelant of wasmtime serve -Scli, which is what most guests end up needing. reported in https://bytecodeall...</div></div></div>



<a name="526666764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Help%3A%20Wasmtime%27s%20runner%20for%20WASI-HTTP%20p2%20guest/near/526666764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Suszynski <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Help.3A.20Wasmtime.27s.20runner.20for.20WASI-HTTP.20p2.20guest.html#526666764">(Jul 01 2025 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="253992">@Pat Hickey</span> <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>