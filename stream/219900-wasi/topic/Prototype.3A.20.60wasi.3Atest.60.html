<html>
<head><meta charset="utf-8"><title>Prototype: `wasi:test` · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html">Prototype: `wasi:test`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="544827031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/544827031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#544827031">(Oct 14 2025 at 19:59)</a>:</h4>
<p>I've put together a prototype <code>wasi:test</code> interface and examples: <a href="https://github.com/lann/wasi-test">https://github.com/lann/wasi-test</a></p>
<p>tl;dr:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">this_test_always_fails</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">TestContext</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;'</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="s">"failed as expected"</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">wasi_test</span><span class="p">::</span><span class="n">suite</span><span class="o">!</span><span class="p">(</span><span class="n">this_test_always_fails</span><span class="p">);</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>wac<span class="w"> </span>--plug<span class="w"> </span>example-tests.wasm<span class="w"> </span>wasi-test-runner-cli.wasm<span class="w"> </span>-o<span class="w"> </span>runnable-tests.wasm
<span class="gp">$ </span>wasmtime<span class="w"> </span>run<span class="w"> </span>-Wcomponent-model-async<span class="w"> </span>runnable-tests.wasm
<span class="go">Test this-test-always-fails...FAIL ("failed as expected")</span>
</code></pre></div>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/lann/wasi-test" style="background-image: url(&quot;https://uploads.zulipusercontent.net/708c1a71ac099eca47192657007110fb98656ee3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f663736373861386438613939383936656665376165326536666263333366363038386237623666336634356264333230653864633931333166643738356664332f6c616e6e2f776173692d74657374&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/lann/wasi-test" title="GitHub - lann/wasi-test">GitHub - lann/wasi-test</a></div><div class="message_embed_description">Contribute to lann/wasi-test development by creating an account on GitHub.</div></div></div>



<a name="546252923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546252923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546252923">(Oct 21 2025 at 14:30)</a>:</h4>
<p>Oh this is neat! For the Rust HTTP sample we never got around to answering how to test it</p>



<a name="546253127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546253127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546253127">(Oct 21 2025 at 14:31)</a>:</h4>
<p>Something like this seems like it might help? - though I assume that does require answering the <code>wasi:http</code> composition question first</p>



<a name="546266696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546266696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546266696">(Oct 21 2025 at 15:26)</a>:</h4>
<blockquote>
<p>the <code>wasi:http</code> composition question</p>
</blockquote>
<p>Which composition question? <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="546754043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546754043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546754043">(Oct 23 2025 at 19:23)</a>:</h4>
<p>I think what I meant was: how can we test a WASI http server from WASI itself? Presumably the right way we'd want to solve that is by linking the http server into our test component, and triggering calls to the server component from there.</p>



<a name="546754205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546754205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546754205">(Oct 23 2025 at 19:24)</a>:</h4>
<p>What we're doing now in e.g. wstd to test networking things is to spin up a Wasmtime instance in Rust and use that to instrument test programs externally.</p>



<a name="546754559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546754559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546754559">(Oct 23 2025 at 19:26)</a>:</h4>
<p>Presumably if we had an <code>WASI::http/server</code>, we should be able to link that against <code>WASI::http/middleware</code> somehow, and us that to drive the tests?</p>



<a name="546754634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546754634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546754634">(Oct 23 2025 at 19:27)</a>:</h4>
<p>But maybe I'm thinking about this wrong heh</p>



<a name="546757089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546757089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546757089">(Oct 23 2025 at 19:42)</a>:</h4>
<p>By "WASI http server" do you mean like <code>wasmtime serve</code> or do you mean a component exporting a wasi:http handler?</p>



<a name="546878287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546878287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546878287">(Oct 24 2025 at 11:57)</a>:</h4>
<p>I meant the latter</p>



<a name="546881260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546881260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546881260">(Oct 24 2025 at 12:12)</a>:</h4>
<p>In that case wasi:test should work. The test(s) would import the handler and call into it. You'd probably want a test implementation of wasi:http to ease testing any actual application logic.</p>



<a name="546888170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546888170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546888170">(Oct 24 2025 at 12:45)</a>:</h4>
<p>Added a composition diagram to the <a href="https://github.com/lann/wasi-test/blob/main/README.md">readme</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/lann/wasi-test/blob/main/README.md" style="background-image: url(&quot;https://uploads.zulipusercontent.net/df0022281c825bc29dd38b4158b3761d617d7d77/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373234613266363238353461373737336534353666303262626635316433653434326237386430626133393536393165336132613939626461303332366233622f6c616e6e2f776173692d74657374&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/lann/wasi-test/blob/main/README.md" title="wasi-test/README.md at main · lann/wasi-test">wasi-test/README.md at main · lann/wasi-test</a></div><div class="message_embed_description">Contribute to lann/wasi-test development by creating an account on GitHub.</div></div></div>



<a name="546902219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546902219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546902219">(Oct 24 2025 at 13:49)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> the SVG isn't loading for me; maybe a broken link?</p>



<a name="546902346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546902346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yosh Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546902346">(Oct 24 2025 at 13:49)</a>:</h4>
<p>Clicking through does show it tho; e.g. <a href="https://github.com/lann/wasi-test/blob/main/composition.svg">https://github.com/lann/wasi-test/blob/main/composition.svg</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/lann/wasi-test/blob/main/composition.svg" style="background-image: url(&quot;https://uploads.zulipusercontent.net/69cd52bc32ea9b41a234789d2cd609ef1b174f7d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633265386236626132626662363066646133616264306438316533383230393631316432333766653535303636356439316361623862363033613862306264372f6c616e6e2f776173692d74657374&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/lann/wasi-test/blob/main/composition.svg" title="wasi-test/composition.svg at main · lann/wasi-test">wasi-test/composition.svg at main · lann/wasi-test</a></div><div class="message_embed_description">Contribute to lann/wasi-test development by creating an account on GitHub.</div></div></div>



<a name="546903837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546903837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546903837">(Oct 24 2025 at 13:56)</a>:</h4>
<p>One thing to clarify there wrt your question: the "Test Runner" interfaces don't matter for the thing being tested; the CLI test runner could run tests that target an HTTP handler, for instance.</p>



<a name="546905628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Prototype%3A%20%60wasi%3Atest%60/near/546905628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Prototype.3A.20.60wasi.3Atest.60.html#546905628">(Oct 24 2025 at 14:03)</a>:</h4>
<p>Also - and maybe this is getting closer to answering your question - a more complete diagram for testing an HTTP handler would involve something providing <code>wasi:http</code> imports to both the "Tests Component" and the "Component Under Test". That <em>could</em> just be the host but for application testing you'd probably prefer an entirely separate guest implementation, both for reproducibility and to enable fancy test functionality (mocking, request/response recording, etc).</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>