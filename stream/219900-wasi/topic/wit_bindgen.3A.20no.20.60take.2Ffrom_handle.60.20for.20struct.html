<html>
<head><meta charset="utf-8"><title>wit_bindgen: no `take/from_handle` for struct · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html">wit_bindgen: no `take/from_handle` for struct</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="542363910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wit_bindgen%3A%20no%20%60take/from_handle%60%20for%20struct/near/542363910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html#542363910">(Sep 30 2025 at 20:41)</a>:</h4>
<p>Forgive me if there's something simple I've missed, but does anything stand out as incorrect with this <code>wit_bindgen::generate!</code> use here?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"plugin"</span><span class="p">,</span>
<span class="w">    </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">"wasi:http/types@0.3.0-rc-2025-09-16"</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime_wasi_http</span><span class="p">::</span><span class="n">p3</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">types</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="k">async</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">generate_all</span>
<span class="p">});</span>
</code></pre></div>
<p>Leads to the following compiler error (for [<code>take_handle</code>,<code>from_handle</code>] X [<code>wasmtime_wasi_http::p3::Request</code>,<code>wasmtime_wasi_http::p3::Response</code>]):</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>error<span class="o">[</span>E0599<span class="o">]</span>:<span class="w"> </span>no<span class="w"> </span><span class="k">function</span><span class="w"> </span>or<span class="w"> </span>associated<span class="w"> </span>item<span class="w"> </span>named<span class="w"> </span><span class="sb">`</span>from_handle<span class="sb">`</span><span class="w"> </span>found<span class="w"> </span><span class="k">for</span><span class="w"> </span>struct<span class="w"> </span><span class="sb">`</span>wasmtime_wasi_http::p3::Request<span class="sb">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>scope
<span class="w">  </span>--&gt;<span class="w"> </span>src/apps/mitmproxy-rs/src/plugins/mod.rs:25:1
<span class="w">   </span><span class="p">|</span>
<span class="m">25</span><span class="w"> </span><span class="p">|</span><span class="w">   </span>wit_bindgen::generate!<span class="o">({</span>
<span class="w">   </span><span class="p">|</span><span class="w">  </span>_^
<span class="m">26</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>world:<span class="w"> </span><span class="s2">"plugin"</span>,
<span class="m">27</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>with:<span class="w"> </span><span class="o">{</span>
<span class="m">28</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">         </span><span class="s2">"wasi:http/types@0.3.0-rc-2025-09-16"</span>:<span class="w"> </span>wasmtime_wasi_http::p3::bindings::http::types,
...<span class="w">  </span><span class="p">|</span>
<span class="m">31</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>generate_all
<span class="m">32</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">})</span><span class="p">;</span>
<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>__^<span class="w"> </span><span class="k">function</span><span class="w"> </span>or<span class="w"> </span>associated<span class="w"> </span>item<span class="w"> </span>not<span class="w"> </span>found<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>wasmtime_wasi_http::p3::Request<span class="sb">`</span>
<span class="w">   </span><span class="p">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span>note:<span class="w"> </span>this<span class="w"> </span>error<span class="w"> </span>originates<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>macro<span class="w"> </span><span class="sb">`</span>wit_bindgen::generate<span class="sb">`</span><span class="w"> </span><span class="o">(</span><span class="k">in</span><span class="w"> </span>Nightly<span class="w"> </span>builds,<span class="w"> </span>run<span class="w"> </span>with<span class="w"> </span>-Z<span class="w"> </span>macro-backtrace<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>info<span class="o">)</span>
</code></pre></div>
<p>Enabled features + wit_bindgen version (in case it matters)</p>
<div class="codehilite" data-code-language="cargo.toml"><pre><span></span><code>// ...
wasmtime = { path = "../wasmtime/crates/wasmtime", features = ["component-model-async"] }
wasmtime-wasi = { path = "../wasmtime/crates/wasi", features = ["p3"] }
wasmtime-wasi-http = { path = "../wasmtime/crates/wasi-http", features = ["p3"] }
wit-bindgen = { version = "0.46.0" }
</code></pre></div>
<p>WIT snippet (in case it matters):</p>
<div class="codehilite" data-code-language="world.wit"><pre><span></span><code>world plugin {
    use wasi:http/types@0.3.0-rc-2025-09-16.{request, response};
    // ...

    variant event-data {
        request(request),
        response(response),
    }
}
</code></pre></div>



<a name="542368238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wit_bindgen%3A%20no%20%60take/from_handle%60%20for%20struct/near/542368238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html#542368238">(Sep 30 2025 at 21:09)</a>:</h4>
<p>Using <code>wasmtime::component::bindgen</code> instead seems to compile:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"plugin"</span><span class="p">,</span>
<span class="w">    </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">"wasi:http/types@0.3.0-rc-2025-09-16"</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime_wasi_http</span><span class="p">::</span><span class="n">p3</span><span class="p">::</span><span class="n">bindings</span><span class="p">::</span><span class="n">http</span><span class="p">::</span><span class="n">types</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>
<p>Whatever the distinction between the two that I'd missed ends up being <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="542372334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wit_bindgen%3A%20no%20%60take/from_handle%60%20for%20struct/near/542372334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html#542372334">(Sep 30 2025 at 21:42)</a>:</h4>
<p>wit-bindgen is for generating the guest part, so what is inside the .wasm file, while wasmtime::component::bindgen generates the host part, the thing you run on your machine to load and run these comonent wasm files</p>



<a name="542372422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wit_bindgen%3A%20no%20%60take/from_handle%60%20for%20struct/near/542372422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html#542372422">(Sep 30 2025 at 21:43)</a>:</h4>
<p>so wit-bindgen code needs some wasm32-* target to compile</p>



<a name="542507135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wit_bindgen%3A%20no%20%60take/from_handle%60%20for%20struct/near/542507135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html#542507135">(Oct 01 2025 at 14:14)</a>:</h4>
<p>Yeah this is a mismatch where you're pointing <code>wit-bindgen</code>-the-crate at <code>wasmtime::component::bindgen!</code>-generated bindings which is a host/guest mismatch</p>



<a name="542562254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wit_bindgen%3A%20no%20%60take/from_handle%60%20for%20struct/near/542562254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wit_bindgen.3A.20no.20.60take.2Ffrom_handle.60.20for.20struct.html#542562254">(Oct 01 2025 at 18:50)</a>:</h4>
<p><span aria-label="man facepalming" class="emoji emoji-1f926-200d-2642" role="img" title="man facepalming">:man_facepalming:</span> think my brain completely glossed over the difference in <a href="https://component-model.bytecodealliance.org/language-support/rust.html#implementing-and-exporting-a-resource-implementation-in-a-host">https://component-model.bytecodealliance.org/language-support/rust.html#implementing-and-exporting-a-resource-implementation-in-a-host</a> </p>
<p>thanks for the explanation</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>