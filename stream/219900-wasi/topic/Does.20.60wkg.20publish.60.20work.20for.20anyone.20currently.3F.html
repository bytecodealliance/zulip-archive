<html>
<head><meta charset="utf-8"><title>Does `wkg publish` work for anyone currently? · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html">Does `wkg publish` work for anyone currently?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="553215593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/553215593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#553215593">(Nov 02 2025 at 05:34)</a>:</h4>
<p>Following along the docs for publish WIT (<a href="https://component-model.bytecodealliance.org/composing-and-distributing/distributing.html#distributing-wit-and-components-by-package-name-with-wkg-publish">https://component-model.bytecodealliance.org/composing-and-distributing/distributing.html#distributing-wit-and-components-by-package-name-with-wkg-publish</a> ) and ran into the following:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wkg<span class="w"> </span>publish<span class="w"> </span>witmproxy<span class="se">\:</span>plugin@0.0.1.wasm
Error:<span class="w"> </span>registry<span class="w"> </span>error:<span class="w"> </span>Authentication<span class="w"> </span>failure:<span class="w"> </span><span class="o">{</span><span class="s2">"errors"</span>:<span class="o">[{</span><span class="s2">"code"</span>:<span class="s2">"DENIED"</span>,<span class="s2">"message"</span>:<span class="s2">"requested access to the resource is denied"</span><span class="o">}]}</span>


Caused<span class="w"> </span>by:
<span class="w">    </span>Authentication<span class="w"> </span>failure:<span class="w"> </span><span class="o">{</span><span class="s2">"errors"</span>:<span class="o">[{</span><span class="s2">"code"</span>:<span class="s2">"DENIED"</span>,<span class="s2">"message"</span>:<span class="s2">"requested access to the resource is denied"</span><span class="o">}]}</span>
</code></pre></div>
<p>Which after cloning <code>wasm-pkg-tools</code> and poking around, seems to be due to a call to <code>docker_credential::get_credential</code> failing, claiming I have no credentials configured (which is quietly eaten, and anonymous auth is used instead):</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="m">2025</span>-11-02T05:03:05.532227Z<span class="w">  </span>DEBUG<span class="w"> </span>wasm_pkg_client::oci:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>look<span class="w"> </span>up<span class="w"> </span>OCI<span class="w"> </span>credentials:<span class="w"> </span>User<span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>credential<span class="w"> </span>configured
</code></pre></div>
<p>This seems to be a mistake (as I do have a credential provided by <code>docker login</code>), and it seems that the code which prepends <code>https://</code> to <code>self.oci_registry</code> (<a href="https://github.com/bytecodealliance/wasm-pkg-tools/blob/5b80fab1dfb0767f8c7ec12875ea797966a80261/crates/wasm-pkg-client/src/oci/mod.rs#L115">https://github.com/bytecodealliance/wasm-pkg-tools/blob/5b80fab1dfb0767f8c7ec12875ea797966a80261/crates/wasm-pkg-client/src/oci/mod.rs#L115</a>)  causes the failure, at least for my current version of docker (client v28.1.1, api1.48), as the auth information is stored under the "<a href="http://ghcr.io">ghcr.io</a>" key in my .docker/config.json sans protocol.</p>
<p>Removing the <code>format!()</code> call fixes the issue and allows me to publish successfully.</p>
<p>I'd assume that this is working for others, so I guess I'm curious as what's different in my environment or usage, or whether this is an actual bug.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-pkg-tools/blob/5b80fab1dfb0767f8c7ec12875ea797966a80261/crates/wasm-pkg-client/src/oci/mod.rs#L115" style="background-image: url(&quot;https://uploads.zulipusercontent.net/54abc646fde8a2a84b9a4cf88ac51439f98017c9/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333961326137663338346537633337393333663666646365656530626162343631313465386263363162383537623437613933356263396361306435626436312f62797465636f6465616c6c69616e63652f7761736d2d706b672d746f6f6c73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-pkg-tools/blob/5b80fab1dfb0767f8c7ec12875ea797966a80261/crates/wasm-pkg-client/src/oci/mod.rs#L115" title="wasm-pkg-tools/crates/wasm-pkg-client/src/oci/mod.rs at 5b80fab1dfb0767f8c7ec12875ea797966a80261 · bytecodealliance/wasm-pkg-tools">wasm-pkg-tools/crates/wasm-pkg-client/src/oci/mod.rs at 5b80fab1dfb0767f8c7ec12875ea797966a80261 · bytecodealliance/wasm-pkg-tools</a></div><div class="message_embed_description">Contribute to bytecodealliance/wasm-pkg-tools development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="http://ghcr.io" style="background-image: url(&quot;https://uploads.zulipusercontent.net/85b74d88509069a19ac3877d9205a3f6d7fe5ca9/68747470733a2f2f696d616765732e6374666173736574732e6e65742f3861657670687667657774382f363367486e64756b3146614a66646a63503967474b652f33623761393633343832336535343935376538383561323562306535656263312f66656174757265732d616374696f6e732d736f6369616c2e6a7067&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="http://ghcr.io" title="GitHub Actions">GitHub Actions</a></div><div class="message_embed_description">Easily build, package, release, update, and deploy your project in any language—on GitHub or any external system—without having to run code yourself.</div></div></div>



<a name="553241107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/553241107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#553241107">(Nov 02 2025 at 12:13)</a>:</h4>
<p>There is indeed an issue with the upstream <code>docker-credential</code> crate but the fix is slightly less straightforward. This pr should work around the problem but needs further testing: <a href="https://github.com/bytecodealliance/wasm-pkg-tools/pull/176">https://github.com/bytecodealliance/wasm-pkg-tools/pull/176</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-pkg-tools/pull/176" style="background-image: url(&quot;https://uploads.zulipusercontent.net/da746641f7a74073d4555c433ce5a2f6f0bcb91f/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f346561393434363933666562636263353536373338616438353062396131663332666134313864636663326135666434643234383433323031393536336265622f62797465636f6465616c6c69616e63652f7761736d2d706b672d746f6f6c732f70756c6c2f313736&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-pkg-tools/pull/176" title="Use registry host rather than URL for creds lookup by itowlson · Pull Request #176 · bytecodealliance/wasm-pkg-tools">Use registry host rather than URL for creds lookup by itowlson · Pull Request #176 · bytecodealliance/wasm-pkg-tools</a></div><div class="message_embed_description">There is an issue in GitHub actions where wkg publish fails with code DENIED even after a successful docker login.
The reason appears to be that wkg asks docker-credential to look up credentials fo...</div></div></div>



<a name="553264829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/553264829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#553264829">(Nov 02 2025 at 18:33)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> thanks for the link! Is there any strong belief that this PR would cause any issues, given that it still falls back to the old behavior (I guess there could be an issue introduced with the precedence now preferring credentials in <code>.docker/config.json</code> over native credential helpers)? It doesn't seem ideal to worry about the unknown potential issues this might cause at the cost of further prolonging the verified current one.</p>



<a name="553265006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/553265006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#553265006">(Nov 02 2025 at 18:35)</a>:</h4>
<p>Well to be clear the existing code is currently working in some configurations so there is a real risk of regression, though I agree it isn't obviously likely.</p>



<a name="553265992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/553265992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#553265992">(Nov 02 2025 at 18:52)</a>:</h4>
<p>Yeah, it should work as is for anyone with a <code>credsStore</code> configured (any other reasons aren't immediately apparent to me), but I guess it's difficult for me to imagine a reason trying both (and switching the PR to prefer the credential helper case which uses the <code>hier-part</code> for matching the server to be first) wouldn't work (and improve the situation for people with similar environments as I and the others), or I would be inclined to try it out and leverage any ensuing people complaining as data for why it didn't <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> (but I can understand why as a maintainer that might not be appealing)</p>



<a name="553268401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/553268401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#553268401">(Nov 02 2025 at 19:33)</a>:</h4>
<p>Err, correction, I didn't yet realize there's a distinction between a cred store and cred helper, so was wrong about the current precedence.</p>



<a name="554788154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/554788154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#554788154">(Nov 10 2025 at 20:44)</a>:</h4>
<p>I was finally able to reproduce a working configuration in a test environment to confirm no regression. <code>wkg</code> 0.13 was just released with the above fix.</p>



<a name="558296662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Does%20%60wkg%20publish%60%20work%20for%20anyone%20currently%3F/near/558296662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theodore Brockman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Does.20.60wkg.20publish.60.20work.20for.20anyone.20currently.3F.html#558296662">(Nov 19 2025 at 20:30)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> thanks for merging the fix, finally got back around to what I was doing here (setting up a GitHub Action to publish WIT changes), and can confirm that it now works as expected!</p>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>