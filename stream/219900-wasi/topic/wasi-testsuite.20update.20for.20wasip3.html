<html>
<head><meta charset="utf-8"><title>wasi-testsuite update for wasip3 · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html">wasi-testsuite update for wasip3</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="534430075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534430075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534430075">(Aug 14 2025 at 08:09)</a>:</h4>
<p>Hello all, I am working on creating a test suite for wasip3.  My near-term goal is to reach <code>wasi-http</code>, without sockets.  The longer-term goal is a conformance test that will allow an implementation of wasi to be evaluated as actually implementing wasip3.</p>
<p>I will be primarily testing wasmtime but also jco on top of node.</p>
<p>On a suggestion from <span class="user-mention" data-user-id="421591">@Bailey Hayes</span> I am looking at using <a href="https://github.com/WebAssembly/wasi-testsuite">wasi-testsuite</a> as a base.  I will post into this topic as I go, and will probably also poke people for questions :)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1300fb483476ef3ebf77219f77973d063d1c0a60/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333836383833336431396265386531303139633264623530393266333336366232643838373665656432346536386235303064376438383865366466373762652f576562417373656d626c792f776173692d746573747375697465&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite" title="GitHub - WebAssembly/wasi-testsuite: WASI Testsuite">GitHub - WebAssembly/wasi-testsuite: WASI Testsuite</a></div><div class="message_embed_description">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div>



<a name="534431228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534431228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534431228">(Aug 14 2025 at 08:16)</a>:</h4>
<p>So, where I'm at:</p>
<ul>
<li>Checked out wasi-testsuite</li>
<li>Ran the test harness; "success" but only because there are only test case source files and not the compiled artifacts, and I don't want to use prebuilt binaries because I want to precisely know the source that they correspond to</li>
<li>Built a fresh wasmtime</li>
<li>Built a fresh wasi-sdk</li>
<li>Regenerated the rust and C test cases, using the newly built toolchains</li>
<li>Ran the test harness; there are failures!</li>
</ul>
<p>Now, these are wasip1 tests, and there's no real sense in putting effort into them, but I wonder if there isn't something to be done here; like, <a href="https://github.com/WebAssembly/wasi-testsuite/blob/main/tests/c/testsuite/fopen-with-no-access.c">fopen-with-no-access</a> asserts that <code>errno</code> is <code>ENOTCAPABLE</code>, which I gather is a very wasmtime-of-a-particular-epoch thing, and that <code>ENOTCAPABLE</code> isn't really a thing any more.  Changing to <code>ENOENT</code> is more correct abstractly and allows the test to pass.  This isn't limited to the C test suite, there are similar errors in the rust test suite.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/blob/main/tests/c/testsuite/fopen-with-no-access.c" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1300fb483476ef3ebf77219f77973d063d1c0a60/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333836383833336431396265386531303139633264623530393266333336366232643838373665656432346536386235303064376438383865366466373762652f576562417373656d626c792f776173692d746573747375697465&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/blob/main/tests/c/testsuite/fopen-with-no-access.c" title="wasi-testsuite/tests/c/testsuite/fopen-with-no-access.c at main · WebAssembly/wasi-testsuite">wasi-testsuite/tests/c/testsuite/fopen-with-no-access.c at main · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div>



<a name="534431798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534431798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534431798">(Aug 14 2025 at 08:20)</a>:</h4>
<p>Going to tag in people that may be interested in the conversation; feel free to unset notifications: <span class="user-mention" data-user-id="610987">@Oscar Spencer</span> <span class="user-mention" data-user-id="509936">@Joel Dice</span> <span class="user-mention" data-user-id="234973">@Till Schneidereit</span> <span class="user-mention" data-user-id="253994">@Alex Crichton</span> <span class="user-mention" data-user-id="253992">@Pat Hickey</span> <span class="user-mention" data-user-id="938242">@Tim Chevalier</span></p>



<a name="534431972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534431972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534431972">(Aug 14 2025 at 08:21)</a>:</h4>
<p>also <span class="user-mention" data-user-id="253998">@Luke Wagner</span></p>



<a name="534433204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534433204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534433204">(Aug 14 2025 at 08:29)</a>:</h4>
<p>I think what I will do is, for the C tests, the source will remain the same for wasip3.  i will add additional accepted errnos, and the test will remain valid for previous versions of wasi.  then i will move the rust tests to a separate wasip1 subdir, because they all use the wasip1 toolchain.  then i will add a wasip3 subdir to the rusts tests and start porting simple tests there, before moving on to more interesting inter-component interactions.</p>



<a name="534468232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534468232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534468232">(Aug 14 2025 at 12:01)</a>:</h4>
<p><span class="user-mention" data-user-id="396878">@Andy Wingo</span> please tag me as well as you go.....</p>



<a name="534500010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534500010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534500010">(Aug 14 2025 at 14:53)</a>:</h4>
<p>ENOTCAPABLE is a wasi preview 1 thing, which had a capability system called "rights" inherited from cloudabi that we decided to get rid of, not a wasmtime of era thing, but no matter. but yes, a fundamental problem here is that the tests were written in the preview 1 era and not updated since.</p>



<a name="534500137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534500137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534500137">(Aug 14 2025 at 14:54)</a>:</h4>
<p>I agree with your approach to add more accepted errnos.</p>



<a name="534500448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534500448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534500448">(Aug 14 2025 at 14:55)</a>:</h4>
<p>in general I was never all that happy with how the wasmtime wasi testsuite tests for behaviors that were pretty dependent on the host operating system shook out. e.g. theres flags to tell the test harness that this host doesnt support hardlinks, this host doesnt support removing nonempty dirs, things like that... basically the "is this windows or not" bit</p>



<a name="534500685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534500685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534500685">(Aug 14 2025 at 14:56)</a>:</h4>
<p>so, after poking at it, i changed the <a href="http://build.sh">build.sh</a> for the c tests to be a build.py, and then i compile the generic c tests for wasm32-wasip{1,2,3} in separate directories.  (wasip3 currently uses the wasip2 target triple.)  there is also something to bring in version-specific tests.  but to land that i am first going to update the wasi-sdk from 17 to 27, see if tests are green, move around the dirs so i can have version-specific tests, etc</p>



<a name="534500831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534500831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534500831">(Aug 14 2025 at 14:57)</a>:</h4>
<p>i will stack some PRs.  i am part of the wasm org i think so i may have some permissions there but who is the wasi-testsuite maintainer?  i.e. who can lgtm?</p>



<a name="534501472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501472">(Aug 14 2025 at 15:00)</a>:</h4>
<p>also, who uses the daily test results?</p>



<a name="534501497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501497">(Aug 14 2025 at 15:00)</a>:</h4>
<p>but, in practice, filesystem behaviors on windows vs elsewhere is the least interesting problem in all of wasi - ive yet to find anyone who cares who isnt just trying to tell their boss every single tests passes, or fuzz for differences between runtimes, neither of which are very interesting things to care about. we made some severe and sometimes regrettable compromises as dan and I banged my way through creating and updating the test suite for wasmtimes needs, and this is a fine time for a reckoning of "we really dont care about minutiae of file link behaviors" when in practice several prominent runtimes that claim to "support wasi" have had filesystem sandbox escapes for many many years and have no real interest in fixing it properly</p>



<a name="534501737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501737">(Aug 14 2025 at 15:01)</a>:</h4>
<p>wow :)</p>



<a name="534501827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501827">(Aug 14 2025 at 15:01)</a>:</h4>
<p>i think historically marcin was the person to take the wasmtime wasi test suite and move it upstream into the webassembly org repos. I am happy to be your reviewer for things</p>



<a name="534501861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501861">(Aug 14 2025 at 15:01)</a>:</h4>
<p>daily test results? first im aware they exist tbh</p>



<a name="534501950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501950">(Aug 14 2025 at 15:02)</a>:</h4>
<p>there is a github action or workflow or whatever to run tests nightly and commit the results to a git branch</p>



<a name="534501985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534501985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534501985">(Aug 14 2025 at 15:02)</a>:</h4>
<p><a href="https://github.com/WebAssembly/wasi-testsuite/tree/prod/daily-test-results">https://github.com/WebAssembly/wasi-testsuite/tree/prod/daily-test-results</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/tree/prod/daily-test-results" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1300fb483476ef3ebf77219f77973d063d1c0a60/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333836383833336431396265386531303139633264623530393266333336366232643838373665656432346536386235303064376438383865366466373762652f576562417373656d626c792f776173692d746573747375697465&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/tree/prod/daily-test-results" title="GitHub - WebAssembly/wasi-testsuite at prod/daily-test-results">GitHub - WebAssembly/wasi-testsuite at prod/daily-test-results</a></div><div class="message_embed_description">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div>



<a name="534502059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534502059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534502059">(Aug 14 2025 at 15:02)</a>:</h4>
<p>huh. how about that</p>



<a name="534502086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534502086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534502086">(Aug 14 2025 at 15:02)</a>:</h4>
<p>i suppose lets pull up the git blame on the action and then ask them</p>



<a name="534502145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534502145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534502145">(Aug 14 2025 at 15:03)</a>:</h4>
<p>i'll cc them on the pr</p>



<a name="534506386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534506386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534506386">(Aug 14 2025 at 15:24)</a>:</h4>
<p><a href="https://github.com/WebAssembly/wasi-testsuite/issues/109">https://github.com/WebAssembly/wasi-testsuite/issues/109</a> for an overview issue</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/109" style="background-image: url(&quot;https://uploads.zulipusercontent.net/408ba73873c6c7580ddfd30540e73867010b6e9b/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373265396137333662643437393931393337333363643062313137363261643266363737613562376635623430346335393363633163336166616663316336652f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313039&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/109" title="Update wasi-testsuite to support testing newer versions of WASI · Issue #109 · WebAssembly/wasi-testsuite">Update wasi-testsuite to support testing newer versions of WASI · Issue #109 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Hello wasi-testsuite hackers, I would like to update wasi-testsuite to support newer versions of WASI. The idea would be that the scope of wasi-testsuite should be to test the versions of WASI that...</div></div></div>



<a name="534621813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534621813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534621813">(Aug 15 2025 at 09:05)</a>:</h4>
<p>a small but gnarly issue for <span class="user-mention" data-user-id="253992">@Pat Hickey</span> and <span class="user-mention" data-user-id="253994">@Alex Crichton</span>, <a href="https://github.com/WebAssembly/wasi-testsuite/issues/111">https://github.com/WebAssembly/wasi-testsuite/issues/111</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/111" style="background-image: url(&quot;https://uploads.zulipusercontent.net/14712613886f6e90772aa8de7d57cce8100d95c3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396564653662306133653135656662393862626139393930636533373330633931343339316561633335366263613437373039656130316661623466303830662f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313131&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/111" title="Update pwrite expected behavior for files opened in append mode · Issue #111 · WebAssembly/wasi-testsuite">Update pwrite expected behavior for files opened in append mode · Issue #111 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">In #95, a test was added that pwrite implements POSIX semantics (https://pubs.opengroup.org/onlinepubs/9699919799/functions/write.html). Note that Linux deviates from POSIX, ignoring the "offset" a...</div></div></div>



<a name="534621990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534621990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534621990">(Aug 15 2025 at 09:06)</a>:</h4>
<p>that IS a sticky wicket</p>



<a name="534643923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534643923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534643923">(Aug 15 2025 at 12:24)</a>:</h4>
<p>the toolchain to create components is very funny.  one would hope that that component creation sediments down into the linker at some point</p>



<a name="534644741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534644741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534644741">(Aug 15 2025 at 12:30)</a>:</h4>
<p>Like this? <a href="https://github.com/bytecodealliance/wasm-component-ld/">https://github.com/bytecodealliance/wasm-component-ld/</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-component-ld/" style="background-image: url(&quot;https://uploads.zulipusercontent.net/be51f36ceb81ccfdbebe6cce62157d21da24bd2a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333365333463313061393761306636633432366361373362366266363538616333656336633962333339333635376537643332643662366230323366633366622f62797465636f6465616c6c69616e63652f7761736d2d636f6d706f6e656e742d6c64&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-component-ld/" title="GitHub - bytecodealliance/wasm-component-ld: Command line linker for creating WebAssembly components">GitHub - bytecodealliance/wasm-component-ld: Command line linker for creating WebAssembly components</a></div><div class="message_embed_description">Command line linker for creating WebAssembly components - bytecodealliance/wasm-component-ld</div></div></div>



<a name="534644833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534644833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534644833">(Aug 15 2025 at 12:31)</a>:</h4>
<p>ooh neat, i did not know that one :)</p>



<a name="534644893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534644893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534644893">(Aug 15 2025 at 12:31)</a>:</h4>
<p>/me comes from the web-targetting side of wasm, not much component model stuff there</p>



<a name="534645037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534645037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534645037">(Aug 15 2025 at 12:33)</a>:</h4>
<p>Like this? <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span> <a href="https://github.com/bytecodealliance/jco/tree/main/packages/jco-transpile">https://github.com/bytecodealliance/jco/tree/main/packages/jco-transpile</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/tree/main/packages/jco-transpile" style="background-image: url(&quot;https://uploads.zulipusercontent.net/9a3096f3f2ad3f42e1f696d51d4fb460080d006c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613933666634643766646536623037313738343964366139663834383164636331383439666264623635663433353162656633363935663737366635646330332f62797465636f6465616c6c69616e63652f6a636f&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/tree/main/packages/jco-transpile" title="jco/packages/jco-transpile at main · bytecodealliance/jco">jco/packages/jco-transpile at main · bytecodealliance/jco</a></div><div class="message_embed_description">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>



<a name="534645080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534645080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534645080">(Aug 15 2025 at 12:33)</a>:</h4>
<p>i know of jco!  :)</p>



<a name="534645760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534645760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534645760">(Aug 15 2025 at 12:37)</a>:</h4>
<p>I can't disagree that it's "not much" from the outside, but it sure feels like a lot from the inside!</p>



<a name="534646134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534646134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534646134">(Aug 15 2025 at 12:40)</a>:</h4>
<p><span class="user-mention" data-user-id="396878">@Andy Wingo</span> gets to re-prove his chops..... :-P</p>



<a name="534646248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534646248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534646248">(Aug 15 2025 at 12:41)</a>:</h4>
<p>ahaha this is an opportunity to be a complete idiot for a while, i am also doing my first rust in anger</p>



<a name="534646425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534646425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534646425">(Aug 15 2025 at 12:42)</a>:</h4>
<p>oh the Rust in anger part never leaves. &lt;insert Bruce Banner I'm always angry that's my secret here /&gt;</p>



<a name="534646495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534646495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534646495">(Aug 15 2025 at 12:43)</a>:</h4>
<p>enjoy your idiocy; we're super grateful for your help here.....</p>



<a name="534646646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534646646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534646646">(Aug 15 2025 at 12:44)</a>:</h4>
<p>i'm happy to be here with yall!</p>



<a name="534666103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534666103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534666103">(Aug 15 2025 at 14:51)</a>:</h4>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasm-component-ld/">https://github.com/bytecodealliance/wasm-component-ld/</a></p>
</blockquote>
<p>Ah yeah this should be the default linker for <code>wasm32-wasip2</code> (and a hypothetical <code>wasm32-wasip3</code> future target). I'll note though that <code>wasm-component-ld</code> is a glorified wrapper around <code>wasm-ld</code> (the Real Wasm Linker) and <code>wit-component</code> which produces a component from a core module.</p>
<p>The executable should be bundled with wasi-sdk and unused on <code>wasm32-wasip1</code> but used by default on <code>wasm32-wasip2</code></p>



<a name="534666548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534666548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534666548">(Aug 15 2025 at 14:55)</a>:</h4>
<p>ah i didn't realize wasm-component-ld was already in the sdk, neat.  i think i was looking on <a href="https://github.com/bytecodealliance/wit-bindgen?tab=readme-ov-file#guest-cc">https://github.com/bytecodealliance/wit-bindgen?tab=readme-ov-file#guest-cc</a> which is probably out of date</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen?tab=readme-ov-file#guest-cc" style="background-image: url(&quot;https://uploads.zulipusercontent.net/50cd0505ad3a8575e79246c21a37b2737823449e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396633643162306531386134363863376234383163343734366363616634323461333366353336613261393134626430613836376139316365353664373734362f62797465636f6465616c6c69616e63652f7769742d62696e6467656e&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen?tab=readme-ov-file#guest-cc" title="GitHub - bytecodealliance/wit-bindgen: A language binding generator for WebAssembly interface types">GitHub - bytecodealliance/wit-bindgen: A language binding generator for WebAssembly interface types</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - bytecodealliance/wit-bindgen</div></div></div>



<a name="534666887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534666887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534666887">(Aug 15 2025 at 14:57)</a>:</h4>
<p>Ah yes sorry those docs are out of date</p>



<a name="534666907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534666907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534666907">(Aug 15 2025 at 14:57)</a>:</h4>
<p>nowadays with <code>wasm32-wasip2</code> no further steps are needed after clang</p>



<a name="534666960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534666960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534666960">(Aug 15 2025 at 14:57)</a>:</h4>
<p>does one still need -mexec-model=reactor ?</p>



<a name="534667008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534667008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534667008">(Aug 15 2025 at 14:58)</a>:</h4>
<p>to avoid an <code>int main</code> entrypoint, yes</p>



<a name="534962770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534962770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534962770">(Aug 18 2025 at 14:23)</a>:</h4>
<p>current status, working on getting some rust-based wasip3 components into wasi-testsuite.  needed to brush up on the rust components toolchain; close to done.  hopefully i can send some prs tomorrow.</p>



<a name="534963568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534963568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534963568">(Aug 18 2025 at 14:26)</a>:</h4>
<p>actually, talking through this a bit -- so wasi-http depends on wasi-clocks.  i will probably first try to test wasi-clocks.  what is the deal with the clocks-timezone feature, will that be part of wasip3 ?</p>



<a name="534964248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534964248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534964248">(Aug 18 2025 at 14:30)</a>:</h4>
<p>and then, for testing clocks: there is no guarantee that the clock under test corresponds to the real time.  (and in some ways it would be nice in a test if the clock could tick as fast as possible; i guess i will punt on that.)  anyway as regards wasmtime, will one monotonic-clock second be equal to a real second when i run tests?</p>



<a name="534964644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534964644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534964644">(Aug 18 2025 at 14:32)</a>:</h4>
<p>and are there wasmtime tests for wasi-clocks?  i was looking but haven't seen them so far</p>



<a name="534966375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534966375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534966375">(Aug 18 2025 at 14:41)</a>:</h4>
<p>wasmtime-wasi's host API allows you to override the default clock implementations for the wall clock and monotonic clock, which we test <a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasi/tests/all/p2/api.rs#L45-L89">here</a> and <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/api_time.rs">here</a>.  There's also a very simple test for the default implementations <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/cli_default_clocks.rs">here</a>, but it doesn't assert anything very interesting at the moment.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasi/tests/all/p2/api.rs#L45-L89" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a28726a497f8f3b35bc5ff403b06cbbc12a90445/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363637366633386538643738363064646465636166346638353562356361363338386336316265336231316134656366316135643630663535666138373862372f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/1292237f809c20d7587bf6471e51fd5edf913ca9/crates/wasi/tests/all/p2/api.rs#L45-L89" title="wasmtime/crates/wasi/tests/all/p2/api.rs at 1292237f809c20d7587bf6471e51fd5edf913ca9 · bytecodealliance/wasmtime">wasmtime/crates/wasi/tests/all/p2/api.rs at 1292237f809c20d7587bf6471e51fd5edf913ca9 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/api_time.rs" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a28726a497f8f3b35bc5ff403b06cbbc12a90445/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363637366633386538643738363064646465636166346638353562356361363338386336316265336231316134656366316135643630663535666138373862372f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/api_time.rs" title="wasmtime/crates/test-programs/src/bin/api_time.rs at main · bytecodealliance/wasmtime">wasmtime/crates/test-programs/src/bin/api_time.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/cli_default_clocks.rs" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a28726a497f8f3b35bc5ff403b06cbbc12a90445/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363637366633386538643738363064646465636166346638353562356361363338386336316265336231316134656366316135643630663535666138373862372f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/cli_default_clocks.rs" title="wasmtime/crates/test-programs/src/bin/cli_default_clocks.rs at main · bytecodealliance/wasmtime">wasmtime/crates/test-programs/src/bin/cli_default_clocks.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<a name="534966452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534966452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534966452">(Aug 18 2025 at 14:42)</a>:</h4>
<p>praise be, thank you!</p>



<a name="534967104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534967104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534967104">(Aug 18 2025 at 14:45)</a>:</h4>
<p>Regarding the timezone feature: looks like it's still an <code>unstable</code> feature in 0.3.0: <a href="https://github.com/WebAssembly/wasi-clocks/blob/main/wit-0.3.0-draft/timezone.wit">https://github.com/WebAssembly/wasi-clocks/blob/main/wit-0.3.0-draft/timezone.wit</a>.  It <em>could</em> be stabilized as part of 0.3.0 or even before that in a 0.2.x release, but I don't know if anyone's working on that.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-clocks/blob/main/wit-0.3.0-draft/timezone.wit" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b6f0d4d736207bb2e4ef409fcac8e74430b40247/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f346666336162383865346164343634316164633136373537383361396533636131313138353033383962626238333961643730383264633637643937323162612f576562417373656d626c792f776173692d636c6f636b73&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-clocks/blob/main/wit-0.3.0-draft/timezone.wit" title="wasi-clocks/wit-0.3.0-draft/timezone.wit at main · WebAssembly/wasi-clocks">wasi-clocks/wit-0.3.0-draft/timezone.wit at main · WebAssembly/wasi-clocks</a></div><div class="message_embed_description">Clocks API for WASI. Contribute to WebAssembly/wasi-clocks development by creating an account on GitHub.</div></div></div>



<a name="534967297"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/534967297" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#534967297">(Aug 18 2025 at 14:46)</a>:</h4>
<p>In any case, I don't think we need to include it as part of the <code>wasi-http</code>-centric testing.</p>



<a name="535013092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535013092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bailey Hayes <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535013092">(Aug 18 2025 at 19:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/534963568">said</a>:</p>
<blockquote>
<p>actually, talking through this a bit -- so wasi-http depends on wasi-clocks.  i will probably first try to test wasi-clocks.  what is the deal with the clocks-timezone feature, will that be part of wasip3 ?</p>
</blockquote>
<p>It is very likely that timezones will be stabilized by p3. Chatter here about steps needed before stabilization: <a href="https://github.com/WebAssembly/wasi-clocks/pull/79">https://github.com/WebAssembly/wasi-clocks/pull/79</a> <span class="user-mention" data-user-id="555446">@Colin D Murphy</span> is working on updating impls and tests</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-clocks/pull/79" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b9f4fbb958fd1711b936cbdf5fea75faa317dd26/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613231356262343838343933633162386136643765353735386565316461333733326330636534333934393639633630626261386136306431633236646631382f576562417373656d626c792f776173692d636c6f636b732f70756c6c2f3739&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-clocks/pull/79" title="Avoid nonstandard use of names for types in wit-0.3.0-draft by bakkot · Pull Request #79 · WebAssembly/wasi-clocks">Avoid nonstandard use of names for types in wit-0.3.0-draft by bakkot · Pull Request #79 · WebAssembly/wasi-clocks</a></div><div class="message_embed_description">This is the renaming part of #71 by @ptomato applied to the new wit-0.3.0-draft directory. (Edit: as well as some other changes prompted by discussion below.)
As discussed in #69 (comment), the use...</div></div></div>



<a name="535063972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535063972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535063972">(Aug 19 2025 at 06:43)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="555446">@Colin D Murphy</span> !!!</p>



<a name="535121370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535121370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535121370">(Aug 19 2025 at 12:49)</a>:</h4>
<p>i have stupid questions</p>



<a name="535121446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535121446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535121446">(Aug 19 2025 at 12:49)</a>:</h4>
<ol>
<li>what is the benefit of allowing cargo to build component-using code for the native target (not wasm32-wasip2)?  it's obvious when it happens, i think anyway, but it's a weird outcome</li>
</ol>



<a name="535121933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535121933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535121933">(Aug 19 2025 at 12:51)</a>:</h4>
<ol start="2">
<li>is it at all sensible to want to avoid cargo-component ?  with wit-bindgen's inline WIT facility, i don't need to pre-build bindings, and i can have the WIT right next to the code i am testing.  but perhaps cargo-component does some unavoidable wasm-tools magic</li>
</ol>



<a name="535124712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535124712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535124712">(Aug 19 2025 at 13:04)</a>:</h4>
<ol start="3">
<li>i realize this is the topic of the channel and project but what is the story for "cargo test" of wasm components written in rust?  i suppose specifically for integration tests.  i don't see anything in cargo to let you "wrap" binaries in some kind of runner script; it is probably there but i just haven't found it yet</li>
</ol>



<a name="535126247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535126247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535126247">(Aug 19 2025 at 13:13)</a>:</h4>
<p>regarding (2), it would seem that building cdylibs with --target=wasm32-wasip2 makes components just fine, so no need for cargo-component.</p>



<a name="535126523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535126523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535126523">(Aug 19 2025 at 13:14)</a>:</h4>
<ol start="4">
<li>how should wasi-testsuite import wasi packages, e.g. wasi:clocks?  git submodule?  or does wit-bindgen have an appropriate search path that for some reason i haven't populated yet</li>
</ol>



<a name="535126622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535126622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535126622">(Aug 19 2025 at 13:15)</a>:</h4>
<p><span class="user-mention" data-user-id="396878">@Andy Wingo</span> you can definitely get by without <code>cargo component</code>, yes. Either by just using the p2 target, or even by targeting p1 and then using a combo of <code>wasm-tools component embed</code> and <code>wasm-tools component new</code></p>



<a name="535126952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535126952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535126952">(Aug 19 2025 at 13:16)</a>:</h4>
<p>oh, and regarding (1), there are tools that don't yet support components. An example we're heavily reliant on with StarlingMonkey is <a href="https://github.com/bytecodealliance/wizer">wizer</a>. For those cases, targeting p1, running the additional tools, then componentizing is the way to go</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wizer" style="background-image: url(&quot;https://uploads.zulipusercontent.net/6a0bf1876368842f202fe86bce70bb8af9024c57/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656534343962353863643038396532633935666533383037313734653937636234303766373435636464633364663466393734636163383431343366386234662f62797465636f6465616c6c69616e63652f77697a6572&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wizer" title="GitHub - bytecodealliance/wizer: The WebAssembly Pre-Initializer">GitHub - bytecodealliance/wizer: The WebAssembly Pre-Initializer</a></div><div class="message_embed_description">The WebAssembly Pre-Initializer. Contribute to bytecodealliance/wizer development by creating an account on GitHub.</div></div></div>



<a name="535128213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535128213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535128213">(Aug 19 2025 at 13:23)</a>:</h4>
<p>understood regarding -wasip1 but my comment was more about, say, x86_64-linux; weird that wit-bindgen's macros work on that target :)</p>



<a name="535128480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535128480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535128480">(Aug 19 2025 at 13:24)</a>:</h4>
<p>I think at least one of the reasons is being able to run e.g. <code>cargo check</code> or <code>cargo clippy</code> without having to specify a target.</p>



<a name="535128538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535128538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535128538">(Aug 19 2025 at 13:25)</a>:</h4>
<p>ah, I see! You're right that currently there are few uses for this. But not none! <span class="user-mention" data-user-id="590366">@Christof Petig</span> has done a lot of work on making WIT work as an IDL for native code, for example</p>



<a name="535128759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535128759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535128759">(Aug 19 2025 at 13:26)</a>:</h4>
<p>regarding (3), I think this should work?</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nv">CARGO_TARGET_WASM32_WASIP2_RUNNER</span><span class="o">=</span><span class="s2">"wasmtime [cli args as needed]"</span><span class="w"> </span>cargo<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
<p>I haven't tested this in a while myself though, so needs some experimentation for sure</p>



<a name="535128836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535128836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535128836">(Aug 19 2025 at 13:26)</a>:</h4>
<p>ooh neat</p>



<a name="535128881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535128881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535128881">(Aug 19 2025 at 13:26)</a>:</h4>
<p>You can also put this ^ in <code>.cargo/config.toml</code></p>



<a name="535129050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535129050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535129050">(Aug 19 2025 at 13:27)</a>:</h4>
<p>Here's one from something I wrote recently (freshly tested!)</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[build]</span>
<span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wasm32-wasip2"</span>
<span class="k">[target.wasm32-wasip2]</span>
<span class="n">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wasmtime run -D address-map"</span>
<span class="k">[env]</span>
<span class="n">WASMTIME_BACKTRACE_DETAILS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span>
</code></pre></div>



<a name="535129159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535129159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535129159">(Aug 19 2025 at 13:28)</a>:</h4>
<p>thanks!</p>



<a name="535130119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130119">(Aug 19 2025 at 13:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535126523">said</a>:</p>
<blockquote>
<ol start="4">
<li>how should wasi-testsuite import wasi packages, e.g. wasi:clocks?  git submodule?  or does wit-bindgen have an appropriate search path that for some reason i haven't populated yet</li>
</ol>
</blockquote>
<p>ok what about this one :)</p>



<a name="535130192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130192">(Aug 19 2025 at 13:33)</a>:</h4>
<p>what are you all doing in your wasip3-using packages</p>



<a name="535130437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130437">(Aug 19 2025 at 13:34)</a>:</h4>
<p>I think <a href="https://crates.io/crates/wkg">wkg</a> is the way to go for that?</p>



<a name="535130559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130559">(Aug 19 2025 at 13:35)</a>:</h4>
<p>ahahaha i keep learning about new parts of the toolchain</p>



<a name="535130571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130571">(Aug 19 2025 at 13:35)</a>:</h4>
<p>thanks!!</p>



<a name="535130825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130825">(Aug 19 2025 at 13:36)</a>:</h4>
<p>which is obviously entirely on you, and not due to any properties of this ecosystem <span aria-label="halo" class="emoji emoji-1f607" role="img" title="halo">:halo:</span></p>



<a name="535130885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535130885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535130885">(Aug 19 2025 at 13:36)</a>:</h4>
<p>wellllllll a little of column a, a little of column b ;)</p>



<a name="535131014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535131014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535131014">(Aug 19 2025 at 13:37)</a>:</h4>
<p>okay, I'll accept that: it's probably 10:90 instead of 0:100</p>



<a name="535131088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535131088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535131088">(Aug 19 2025 at 13:37)</a>:</h4>
<p>The <code>wkg</code> UX is somewhat under-baked; if you want a full dependency tree you'll need a particular incantation combined with <code>wasm-tools</code></p>



<a name="535131677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535131677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535131677">(Aug 19 2025 at 13:40)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> do you think we can share that incantation, or is that still a well guarded trade secret?</p>



<a name="535132134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535132134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535132134">(Aug 19 2025 at 13:42)</a>:</h4>
<p>Working on it <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="535133562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535133562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535133562">(Aug 19 2025 at 13:48)</a>:</h4>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp"># </span>This<span class="w"> </span>will<span class="w"> </span>fetch<span class="w"> </span>the<span class="w"> </span>latest<span class="w"> </span>version<span class="w"> </span>w/o<span class="w"> </span>deps<span class="w"> </span>by<span class="w"> </span>default
<span class="gp">$ </span>wkg<span class="w"> </span>get<span class="w"> </span>wasi:http
<span class="go">No version specified; fetching version list...</span>
<span class="go">Getting wasi:http@0.3.0-rc-2025-08-15...</span>
<span class="go">Wrote './wasi_http@0.3.0-rc-2025-08-15.wit'</span>

<span class="gp"># </span>Deps<span class="w"> </span>are<span class="w"> </span>included<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>binary<span class="w"> </span>encoding...
<span class="gp">$ </span>wkg<span class="w"> </span>get<span class="w"> </span>wasi:http@0.3.0-rc-2025-08-15<span class="w"> </span>-o<span class="w"> </span>wasi-http.wasm
<span class="go">Getting wasi:http@0.3.0-rc-2025-08-15...</span>
<span class="go">Wrote 'wasi-http.wasm'</span>

<span class="gp"># </span>...which<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>turned<span class="w"> </span>into<span class="w"> </span>a<span class="w"> </span><span class="nb">source</span><span class="w"> </span>tree<span class="w"> </span>with<span class="w"> </span>wasm-tools
<span class="gp">$ </span>wasm-tools<span class="w"> </span>component<span class="w"> </span>wit<span class="w"> </span>wasi-http.wasm<span class="w"> </span>--out-dir<span class="w"> </span>wit
<span class="go">Writing: wit/deps/clocks.wit</span>
<span class="go">Writing: wit/deps/random.wit</span>
<span class="go">Writing: wit/deps/cli.wit</span>
<span class="go">Writing: wit/http.wit</span>
</code></pre></div>



<a name="535133801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535133801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535133801">(Aug 19 2025 at 13:49)</a>:</h4>
<p>(<code>wkg get</code> should learn <code>--out-dir</code>)</p>



<a name="535135895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535135895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535135895">(Aug 19 2025 at 13:58)</a>:</h4>
<p>am a little surprised there isn't a <code>stream&lt;u8&gt;</code> to <code>future&lt;wasi:http/headers&gt;</code> method somewhere in wasi:http</p>



<a name="535135920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535135920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535135920">(Aug 19 2025 at 13:58)</a>:</h4>
<p>one less thing to test :)</p>



<a name="535136225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535136225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535136225">(Aug 19 2025 at 14:00)</a>:</h4>
<p>Could you say more about what that method would do? <code>wasi:http</code> tries to abstract over protocol details</p>



<a name="535136657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535136657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535136657">(Aug 19 2025 at 14:02)</a>:</h4>
<p>afaics something outside <code>wasi:http</code> has to turn the byte stream into http headers.  i.e. you provide the headers as structured data when making a request or response</p>



<a name="535136781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535136781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535136781">(Aug 19 2025 at 14:02)</a>:</h4>
<p>so you couldn't hook a wasi:http/handler right up to a socket, you need to write a little parser.  fair enough, and it matches how some embedders will want to use it</p>



<a name="535136824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535136824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535136824">(Aug 19 2025 at 14:02)</a>:</h4>
<p>could be i'm holding the thing wrong tho</p>



<a name="535136857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535136857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535136857">(Aug 19 2025 at 14:03)</a>:</h4>
<p>Yeah, correct. In practice so far its mostly "whatever <code>hyper</code> does".</p>



<a name="535137290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535137290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535137290">(Aug 19 2025 at 14:04)</a>:</h4>
<p>The rough idea has been that <code>wasi:http</code> only deals with things that are in the <a href="https://httpwg.org/http-core/draft-ietf-httpbis-semantics-latest.html">HTTP Semantics spec</a>, not anything specific to HTTP/1.1,2,3+</p>



<a name="535137506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535137506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535137506">(Aug 19 2025 at 14:05)</a>:</h4>
<p>ah yes, makes sense.  i admit i have only ever implemented http/1.1</p>



<a name="535137704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535137704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535137704">(Aug 19 2025 at 14:06)</a>:</h4>
<p>In that case I'd highly recommend staring at this specific section: <a href="http://httpwg.org/http-core/draft-ietf-httpbis-semantics-latest.html#field.host">httpwg.org/http-core/draft-ietf-httpbis-semantics-latest.html#field.host</a></p>



<a name="535141388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535141388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535141388">(Aug 19 2025 at 14:24)</a>:</h4>
<p>so, i am poking in a little playground repository.  i have inline wit in my src/lib.rs:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:playground;</span>

<span class="s">  world the-world {</span>
<span class="s">            import wasi:http/handler;</span>
<span class="s">            //...</span>
<span class="s">  }"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="o">=</span><span class="s">"wit"</span><span class="p">});</span>

<span class="c1">// ...</span>
</code></pre></div>
<p>I have imported wasi:http into <code>wit/http.wit</code> as above:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Writing</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">clocks</span><span class="p">.</span><span class="n">wit</span>
<span class="n">Writing</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">random</span><span class="p">.</span><span class="n">wit</span>
<span class="n">Writing</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">cli</span><span class="p">.</span><span class="n">wit</span>
<span class="n">Writing</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">wit</span>
</code></pre></div>
<p>Firstly it would seem that it's necessary to set <code>path</code> in the bindgen options, otherwise cargo / wit-bindgen don't search anywhere, despite the wit-bindgen docs saying there is a default path.</p>
<p>Secondly, the import fails in a funny way:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">package</span><span class="w"> </span><span class="o">'</span><span class="na">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">'</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="p">.</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="n">packages</span><span class="p">:</span>
<span class="w">           </span><span class="nc">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="w">           </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="w">           </span><span class="n">wasi</span><span class="p">:</span><span class="nc">random</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="w">           </span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="w">           </span><span class="n">test</span><span class="p">:</span><span class="nc">playground</span>

<span class="w">            </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">macro</span><span class="o">-</span><span class="n">input</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">20</span>
<span class="w">             </span><span class="o">|</span>
<span class="w">           </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">handler</span><span class="p">;</span>
<span class="w">             </span><span class="o">|</span><span class="w">                    </span><span class="o">^--------</span>
<span class="w">  </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">1</span>
</code></pre></div>
<p>I.e. you can see that it found wasi:http@0.3.0-rc-2025-08-15, and doesn't think that fulfills <code>wasi:http</code>.  is wit-bindgen helpfully preventing me from using a prerelease wasip3 ?</p>



<a name="535142242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535142242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535142242">(Aug 19 2025 at 14:28)</a>:</h4>
<p>I think you need the version in the <code>import</code></p>



<a name="535142331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535142331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535142331">(Aug 19 2025 at 14:28)</a>:</h4>
<p>yeah, <code>import wasi:http/handler@0.3.0-rc...;</code></p>



<a name="535142467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535142467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535142467">(Aug 19 2025 at 14:29)</a>:</h4>
<blockquote>
<p>despite the wit-bindgen docs saying there is a default path</p>
</blockquote>
<p>This confuses me, your syntax of <code>path = "wit"</code> should have failed since it should be <code>path: "wit"</code>, but also <code>"wit"</code> should be the default search location (relative to the crate root)</p>



<a name="535142634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535142634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535142634">(Aug 19 2025 at 14:30)</a>:</h4>
<p>ah, i had put the version after the handler, and didn't parse the error message correctly</p>



<a name="535142918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535142918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535142918">(Aug 19 2025 at 14:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535142467">said</a>:</p>
<blockquote>
<blockquote>
<p>despite the wit-bindgen docs saying there is a default path</p>
</blockquote>
<p>This confuses me, your syntax of <code>path = "wit"</code> should have failed since it should be <code>path: "wit"</code>, but also <code>"wit"</code> should be the default search location (relative to the crate root)</p>
</blockquote>
<p>sorry, that was a retype bug: i had <code>path: "wit"</code>.  but without <code>path: "wit"</code>, at least with this inline wit, cargo does not look in the <code>wit/</code> directory</p>



<a name="535143009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535143009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535143009">(Aug 19 2025 at 14:31)</a>:</h4>
<p>do you have a repo/branch I could repro on?</p>



<a name="535143059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535143059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535143059">(Aug 19 2025 at 14:32)</a>:</h4>
<p>(bug hunting adventure for me)</p>



<a name="535143133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535143133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535143133">(Aug 19 2025 at 14:32)</a>:</h4>
<p>sure i can throw it up somewhere</p>



<a name="535143773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535143773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535143773">(Aug 19 2025 at 14:35)</a>:</h4>
<p><a href="https://wingolog.org/priv/playground.tar.gz">https://wingolog.org/priv/playground.tar.gz</a>, extracts to playground/, repro with <code>cargo build --target=wasm32-wasip2</code></p>



<a name="535144513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535144513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535144513">(Aug 19 2025 at 14:38)</a>:</h4>
<p>aha ok <code>inline</code> disables the default <code>path</code> as otherwise if you used <code>inline</code> you'd have to ensure a <code>wit</code> directory exists -- either should update the documentation or keep the default <code>wit</code> path but don't require it to exist when <code>inline</code> is specified and <code>path</code> isn't specified</p>



<a name="535144785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535144785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535144785">(Aug 19 2025 at 14:40)</a>:</h4>
<p>to be fair, who knows if <code>inline</code> will get much real use; but it seems nice for testing</p>



<a name="535144872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535144872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535144872">(Aug 19 2025 at 14:40)</a>:</h4>
<p>that's the reason for existence though, it's used all the time in testing wit-bindgen itself and a few places throughout wasmtime too</p>



<a name="535144903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535144903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535144903">(Aug 19 2025 at 14:40)</a>:</h4>
<p>basically it's too-damn-useful heh</p>



<a name="535147495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535147495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535147495">(Aug 19 2025 at 14:53)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wit-bindgen/pull/1356">https://github.com/bytecodealliance/wit-bindgen/pull/1356</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/pull/1356" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0eab2b97af468ede5b4cedabf72a151598c1018e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363330323364353333626436653931363036643336303066333034343964313334383932666533623733653064306665383036613266656664363636643833302f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f70756c6c2f31333536&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/pull/1356" title="Parse `wit` folder in `generate!` with `inline` by alexcrichton · Pull Request #1356 · bytecodealliance/wit-bindgen">Parse `wit` folder in `generate!` with `inline` by alexcrichton · Pull Request #1356 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">This commit updates handling of the inline attribute in the generate! macro of the Rust bindings generator. Previously if inline was specified it would by default lookup nothing on the filesystem u...</div></div></div>



<a name="535147747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535147747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535147747">(Aug 19 2025 at 14:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="234973">Till Schneidereit</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535128538">said</a>:</p>
<blockquote>
<p>ah, I see! You're right that currently there are few uses for this. But not none! <span class="user-mention silent" data-user-id="590366">Christof Petig</span> has done a lot of work on making WIT work as an IDL for native code, for example</p>
</blockquote>
<p>FWIW, there is experimental work at my megacorp doing something like this as well....</p>



<a name="535170311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535170311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535170311">(Aug 19 2025 at 16:57)</a>:</h4>
<p><a class="message-link" href="/#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535135895">#wasi &gt; wasi-testsuite update for wasip3 @ 💬</a> re turning raw streams into wasi-http, our hope is that for users who want to do that, there can be a component that provides that as library code. no need for the embedder to support it</p>



<a name="535170363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535170363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535170363">(Aug 19 2025 at 16:58)</a>:</h4>
<p>the component could be implemented internally with hyper, or with whatever other http implementation is suitable</p>



<a name="535170827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535170827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535170827">(Aug 19 2025 at 17:01)</a>:</h4>
<p>It would be great to have a stable reference implementation for conformance testing</p>



<a name="535260492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535260492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535260492">(Aug 20 2025 at 08:10)</a>:</h4>
<p>so, we are testing wasi implementations more than the component model itself, so i think many tests can be made just with a single component implementing wasi:cli/run.  and i guess i should be able to make <code>run()</code> async</p>



<a name="535260730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535260730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535260730">(Aug 20 2025 at 08:11)</a>:</h4>
<p>just as an ongoing log, a minimal test looks like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:playground;</span>

<span class="s">  world the-world {</span>
<span class="s">            include wasi:cli/command@0.3.0-rc-2025-08-15;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit"</span><span class="p">,</span><span class="w"> </span><span class="n">generate_all</span><span class="p">});</span>

<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">monotonic_clock</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Test</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">run</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monotonic_clock</span><span class="p">::</span><span class="n">now</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monotonic_clock</span><span class="p">::</span><span class="n">now</span><span class="p">();</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Test</span><span class="p">);</span>
</code></pre></div>



<a name="535260959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535260959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535260959">(Aug 20 2025 at 08:12)</a>:</h4>
<p>then you have to compile wasmtime via <code>cargo build --features component-model-async</code>, otherwise the wit linker won't find wasip3 interfaces; and then you have to run wasmtime with <code>-Sp3=y</code> to enable wasip3 at run-time</p>



<a name="535261082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535261082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535261082">(Aug 20 2025 at 08:13)</a>:</h4>
<p>this test fails as written, i had reversed end and start, just to see what would happen</p>



<a name="535261157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535261157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535261157">(Aug 20 2025 at 08:13)</a>:</h4>
<p>now that i can build components and run them, i will start adding some to wasi-testsuite</p>



<a name="535262571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535262571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535262571">(Aug 20 2025 at 08:21)</a>:</h4>
<p>also, a note, i am not sure how to use wkg to import a number of different packages; if you import <code>wasi:http</code>as in <a class="message-link" href="/#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535133562">#wasi &gt; wasi-testsuite update for wasip3 @ 💬</a>, it will residualize some parts of <code>wasi:clocks</code> in <code>wit/deps/clocks.wit</code>; then if you import <code>wasi:cli</code>, it will residualize a different set of <code>wasi:clocks</code> into <code>wit/deps/clocks.wit</code></p>



<a name="535262751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535262751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535262751">(Aug 20 2025 at 08:22)</a>:</h4>
<p>in this current case i solved the issue by just importing wasi:cli, but that won't work once i start testing wasi:http</p>



<a name="535263430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535263430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535263430">(Aug 20 2025 at 08:26)</a>:</h4>
<p>i suppose some of this weirdness is that i compiled a cdylib component; perhaps there are some ergonomic niceties for compiling implementations of <code>wasi:cli/run</code> if you make binary targets instead of libraries</p>



<a name="535267147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535267147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535267147">(Aug 20 2025 at 08:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535262571">said</a>:</p>
<blockquote>
<p>also, a note, i am not sure how to use wkg to import a number of different packages; if you import <code>wasi:http</code>as in <a class="message-link" href="/#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535133562">#wasi &gt; wasi-testsuite update for wasip3 @ 💬</a>, it will residualize some parts of <code>wasi:clocks</code> in <code>wit/deps/clocks.wit</code>; then if you import <code>wasi:cli</code>, it will residualize a different set of <code>wasi:clocks</code> into <code>wit/deps/clocks.wit</code></p>
</blockquote>
<p>this is probably an issue to file on wkg....</p>



<a name="535269230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535269230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milan (rajsite) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535269230">(Aug 20 2025 at 09:00)</a>:</h4>
<p>I've been using <code>wkg fetch</code> against a dummy package / world which seems to fetch all wit dependencies of the world to write to disk. Not sure how that compares to the <code>wkg get &lt;interface&gt; -o &lt;dummy&gt;.wasm</code> + <code>wasm-tools component wit &lt;dummy&gt;.wasm</code> workflow.</p>



<a name="535299952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535299952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535299952">(Aug 20 2025 at 12:11)</a>:</h4>
<p>If you manage your world in a <code>wit/*.wit</code> file then <code>wkg wit fetch</code> will indeed fetch and write deps appropriately.</p>



<a name="535315785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535315785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535315785">(Aug 20 2025 at 13:35)</a>:</h4>
<p>tx milan &amp; lann.  for testing, where each test can define its own world inline, it would be nice to be able to fetch "all of wasi:clocks, all of wasi:sockets, ..." etc.  even, all of wasip3, or wasi 1.0, ...<br>
as it is with a dummy package, it seems i need to include each world in wasi:clocks by name</p>



<a name="535323508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535323508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535323508">(Aug 20 2025 at 14:12)</a>:</h4>
<p>You could have a wit file that imports the root interfaces you need just for the purposes of fetching dependencies. I _think_ <code>inline</code> would still pick up <code>wit/deps/</code> in that scenario but I can never remember the exact behaviors there</p>



<a name="535324449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535324449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535324449">(Aug 20 2025 at 14:17)</a>:</h4>
<p>it would seem that this is enough to get all of wasi:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">world</span><span class="w"> </span><span class="n">wasip3</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">command</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">proxy</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">random</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">sockets</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>



<a name="535329122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535329122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535329122">(Aug 20 2025 at 14:37)</a>:</h4>
<p>can just include <code>http/proxy</code>, it pulls in <code>http/imports</code> (as <code>cli/command</code> imports <code>cli/imports</code>)</p>



<a name="535332432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535332432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535332432">(Aug 20 2025 at 14:53)</a>:</h4>
<p>anyway, more toolchain weirdness:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">mkdir</span><span class="w"> </span><span class="n">wasi</span><span class="o">-</span><span class="n">test</span>
<span class="n">cd</span><span class="w"> </span><span class="n">wasi</span><span class="o">-</span><span class="n">test</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">init</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span>
</code></pre></div>
<p>ok, make a dummy wit file and fetch the wits:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">mkdir</span><span class="w"> </span><span class="n">wit</span>
<span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">/</span><span class="n">wasip3</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span>
<span class="n">package</span><span class="w"> </span><span class="n">test</span><span class="p">:</span><span class="nc">dummy</span><span class="p">;</span>
<span class="n">world</span><span class="w"> </span><span class="n">wasip3</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">command</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">proxy</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">random</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="n">include</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">sockets</span><span class="o">/</span><span class="n">imports</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EOF</span>
<span class="n">wkg</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">fetch</span>
</code></pre></div>
<p>It takes a little time but does make some wit files:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">wit</span>
<span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">wasip3</span><span class="p">.</span><span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sockets</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sockets</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">random</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">random</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">clocks</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">clocks</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">filesystem</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">filesystem</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span>
<span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span>
</code></pre></div>
<p>Now make src/main.rs:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:clocks/imports@0.3.0-rc-2025-08-15;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit"</span><span class="p">,</span><span class="w"> </span><span class="n">generate_all</span><span class="p">});</span>

<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">monotonic_clock</span><span class="p">;</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monotonic_clock</span><span class="p">::</span><span class="n">now</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monotonic_clock</span><span class="p">::</span><span class="n">now</span><span class="p">();</span>
<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Try to build:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span>
</code></pre></div>
<p>Failures in wit-bindgen:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">parsing</span><span class="w"> </span><span class="n">WIT</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">[</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wingo</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">wit</span><span class="p">]</span>

<span class="w">       </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">         </span><span class="nc">interface</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">package</span>
<span class="w">            </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wingo</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span><span class="p">:</span><span class="mi">157</span><span class="p">:</span><span class="mi">22</span>
<span class="w">             </span><span class="o">|</span>
<span class="w">         </span><span class="mi">157</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">timezone</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">             </span><span class="o">|</span><span class="w">                      </span><span class="o">^-------</span>
<span class="o">..</span><span class="p">.</span>
</code></pre></div>
<p>Which is weird because timezones are behind an unstable feature?  OK, add <code>features: ["clocks-timezone"]</code> to the <code>generate!</code> invocation:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:clocks/imports@0.3.0-rc-2025-08-15;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit"</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">"clocks-timezone"</span><span class="p">],</span><span class="w"> </span><span class="n">generate_all</span><span class="p">});</span>
</code></pre></div>
<p>Another weird wit-bindgen error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">multiple</span><span class="w"> </span><span class="n">packages</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">world</span><span class="p">,</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span>
</code></pre></div>
<p>Which, fair, there are other packages in <code>wit/</code>, but I gave it inline WIT, it should know to choose that world.  Once you do this, it works:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:clocks/imports@0.3.0-rc-2025-08-15;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit"</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">"clocks-timezone"</span><span class="p">],</span><span class="w"> </span><span class="n">world</span><span class="p">:</span><span class="w"> </span><span class="s">"test:test/test"</span><span class="p">,</span><span class="w"> </span><span class="n">generate_all</span><span class="p">});</span>
</code></pre></div>
<p>And with that, it's the shortest sync test I can make.  The resulting component still imports some wasip2 interfaces, so this is not a pure wasip3 test:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">playground</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span><span class="p">:</span><span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">monotonic</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">run</span><span class="o">@</span><span class="mf">0.2.3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>But, fair enough, there isn't even a <code>wasm32-wasip3</code> target for rustc yet.</p>



<a name="535332534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535332534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535332534">(Aug 20 2025 at 14:53)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="253994">@Alex Crichton</span> for some of the wit-bindgen oddness</p>



<a name="535333186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535333186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535333186">(Aug 20 2025 at 14:56)</a>:</h4>
<blockquote>
<p>interface not found in package</p>
</blockquote>
<p>We've had a lot of historical weirdness around <code>include</code> and feature-gated interfaces so this might be a legitimate bug there. If you avoid <code>include</code>-ing the <code>imports</code> interface and <code>import</code> the relevant ones directly I think it might work?</p>
<blockquote>
<p><code>multiple packages have a world, must specify which to use</code></p>
</blockquote>
<p>I think that may be due to my fix yesterday where with <code>path</code> plus <code>inline</code> it's thinking that there's two "root packages" to choose worlds from, I'll double check the behavior.</p>
<blockquote>
<p>The resulting component still imports some wasip2 interfaces, so this is not a pure wasip3 test:</p>
</blockquote>
<p>That's expected yeah, you're running into Rust's usage of WASIp1 in the standard library which gets adapted to WASIp2 through the adapter baked into wasm-component-ld</p>



<a name="535334435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535334435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535334435">(Aug 20 2025 at 15:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535333186">said</a>:</p>
<blockquote>
<blockquote>
<p>interface not found in package</p>
</blockquote>
<p>We've had a lot of historical weirdness around <code>include</code> and feature-gated interfaces so this might be a legitimate bug there. If you avoid <code>include</code>-ing the <code>imports</code> interface and <code>import</code> the relevant ones directly I think it might work?</p>
</blockquote>
<p>Seems to not work; if after fetching I remove the <code>wasip3.wit</code> and change the inline wit to <code>import wasi:clocks/monotonic-clock@0.3.0-rc-2025-08-15;</code> instead of including, I still get the same error, which actually originates inside the wkg-imported package:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">         </span><span class="n">interface</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">package</span>
<span class="w">            </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wingo</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">wit</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="o">/</span><span class="n">package</span><span class="p">.</span><span class="n">wit</span><span class="p">:</span><span class="mi">157</span><span class="p">:</span><span class="mi">22</span>
<span class="w">             </span><span class="o">|</span>
<span class="w">         </span><span class="mi">157</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">timezone</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">;</span>
</code></pre></div>



<a name="535334651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535334651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535334651">(Aug 20 2025 at 15:03)</a>:</h4>
<p>hm there may be other packages doing <code>include wasi:clocks/imports</code> maybe, I'll try to dig in in a bit (I need to learn <code>wkg</code> myself...)</p>



<a name="535334959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535334959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535334959">(Aug 20 2025 at 15:05)</a>:</h4>
<p><a href="https://github.com/WebAssembly/wasi-cli/blob/965cbde225ac2d8bd5e3a5aa976c2840242d7b8d/wit-0.3.0-draft/imports.wit#L6">https://github.com/WebAssembly/wasi-cli/blob/965cbde225ac2d8bd5e3a5aa976c2840242d7b8d/wit-0.3.0-draft/imports.wit#L6</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-cli/blob/965cbde225ac2d8bd5e3a5aa976c2840242d7b8d/wit-0.3.0-draft/imports.wit#L6" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1d61750de8695e311ee7c390f3e5f69d3c91a64d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336435343937623830323761663932383135333836613765616161613462623761616265323737306138343566326137643738386639663666303165346330662f576562417373656d626c792f776173692d636c69&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-cli/blob/965cbde225ac2d8bd5e3a5aa976c2840242d7b8d/wit-0.3.0-draft/imports.wit#L6" title="wasi-cli/wit-0.3.0-draft/imports.wit at 965cbde225ac2d8bd5e3a5aa976c2840242d7b8d · WebAssembly/wasi-cli">wasi-cli/wit-0.3.0-draft/imports.wit at 965cbde225ac2d8bd5e3a5aa976c2840242d7b8d · WebAssembly/wasi-cli</a></div><div class="message_embed_description">Command-Line Interface (CLI) World for WASI. Contribute to WebAssembly/wasi-cli development by creating an account on GitHub.</div></div></div>



<a name="535335755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535335755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535335755">(Aug 20 2025 at 15:08)</a>:</h4>
<p>(i wasn't sure if wkg would mangle the wit to either fabricate or elide the "include", but in this case it does seem to preserve the <code>include</code>)</p>



<a name="535337186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535337186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535337186">(Aug 20 2025 at 15:14)</a>:</h4>
<p>yeah I'll need to double-check how unstable things all work here, what you're doing <em>should</em> work but unstable features have been a thorn in our side for quite awhile</p>



<a name="535337300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535337300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535337300">(Aug 20 2025 at 15:14)</a>:</h4>
<p>it is not a blocker for me, i just wanted to write it down so i won't forget :)</p>



<a name="535337352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535337352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535337352">(Aug 20 2025 at 15:15)</a>:</h4>
<p>indeed, and thanks!</p>



<a name="535337376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535337376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535337376">(Aug 20 2025 at 15:15)</a>:</h4>
<p>thank you!</p>



<a name="535337824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535337824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535337824">(Aug 20 2025 at 15:17)</a>:</h4>
<p>otherwise today i talked a bit with <span class="user-mention" data-user-id="513417">@Marcin Kolny</span> regarding wasi-testsuite organization, we seem to be on the same page regarding making wasi-testsuite useful for wasip3 and the broad lines of how to get there.  will have some prs up tomorrow.</p>



<a name="535338516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535338516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535338516">(Aug 20 2025 at 15:20)</a>:</h4>
<p>avoiding the need to specify <code>world:"..."</code> when you've also specified <code>inline</code> should be fixed in <a href="https://github.com/bytecodealliance/wit-bindgen/pull/1358">https://github.com/bytecodealliance/wit-bindgen/pull/1358</a></p>



<a name="535339402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339402">(Aug 20 2025 at 15:23)</a>:</h4>
<p>stupid question: would <code>async fn main()</code> make sense in wasip3, for binary targets?  (of course it doesn't work.  but it seems like it would be nice)</p>



<a name="535339532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339532">(Aug 20 2025 at 15:24)</a>:</h4>
<p>it would, yeah, but probably won't get native language support for awhile</p>



<a name="535339575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339575">(Aug 20 2025 at 15:24)</a>:</h4>
<p>i guess this would involve more work on the rustc toolchain, whereas building cdylibs can be a library thing</p>



<a name="535339580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339580">(Aug 20 2025 at 15:24)</a>:</h4>
<p>what we could get working though is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[wit_bindgen::main]</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<a name="535339664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339664">(Aug 20 2025 at 15:25)</a>:</h4>
<p>which is similar to <code>#[tokio::main]</code> used in a number of locations</p>



<a name="535339697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339697">(Aug 20 2025 at 15:25)</a>:</h4>
<p>ah interesting</p>



<a name="535339859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535339859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535339859">(Aug 20 2025 at 15:26)</a>:</h4>
<p>Presumably you'd still have to build that as <code>cdylib</code>?</p>



<a name="535340110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535340110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535340110">(Aug 20 2025 at 15:27)</a>:</h4>
<p>would you?  binary targets seem to produce working components without any special annotation in the Cargo.toml</p>



<a name="535340179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535340179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535340179">(Aug 20 2025 at 15:27)</a>:</h4>
<p>technically you wouldn't have to, but you likely would yeah</p>



<a name="535340211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535340211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535340211">(Aug 20 2025 at 15:27)</a>:</h4>
<p>(which makes my idea probably not work)</p>



<a name="535340305"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535340305" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535340305">(Aug 20 2025 at 15:27)</a>:</h4>
<p>it'd produce a workable component but it'd be "async stackful" in a sense instead of "async callback"</p>



<a name="535340375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535340375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535340375">(Aug 20 2025 at 15:28)</a>:</h4>
<p>/me nod</p>



<a name="535340873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535340873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535340873">(Aug 20 2025 at 15:30)</a>:</h4>
<p>In case it's not obvious, you can certainly export an async <code>wasi:cli/run#run</code> function using wit-bindgen today with a bit of boilerplate, e.g. <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_cli.rs">https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_cli.rs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_cli.rs" style="background-image: url(&quot;https://uploads.zulipusercontent.net/c7cbb978183f7d18139d97e7df7478b8842f698c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653034376332626636363032393837326362323265346635623636326662303064626366613836366131336236666430303830633333346434646532653637342f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_cli.rs" title="wasmtime/crates/test-programs/src/bin/p3_cli.rs at main · bytecodealliance/wasmtime">wasmtime/crates/test-programs/src/bin/p3_cli.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<a name="535341349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535341349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535341349">(Aug 20 2025 at 15:32)</a>:</h4>
<p>ok the other unstable-related issue is confirmed and minimized as:</p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>package a:b1;

world the-world {
  include a:b2/the-world;
}

package a:b2 {
  world the-world {
    @unstable(feature = disabled)
    import a:b3/thing;
  }
}

package a:b3 {
  @unstable(feature = disabled)
  interface thing {}
}
</code></pre></div>
<p>(that fails as input to <code>wasm-tools component wit</code>)</p>



<a name="535341519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535341519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535341519">(Aug 20 2025 at 15:34)</a>:</h4>
<p>Would it be possible to have a </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[wit_bindgen::test]</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_xxx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>?</p>



<a name="535342027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535342027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535342027">(Aug 20 2025 at 15:36)</a>:</h4>
<p>yeah we could probably get that working</p>



<a name="535348620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535348620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535348620">(Aug 20 2025 at 16:09)</a>:</h4>
<p>(filed a bug <a href="https://github.com/bytecodealliance/wasm-tools/issues/2285">here</a>)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/issues/2285" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4fe766b5d613f8ea2f808fbf91d1cb0225312230/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383335313636303930306362643663643364663534356233653164363036386264396431616633366437633437313731356634373566393164663233316539392f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f6973737565732f32323835&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/issues/2285" title="Failure to process unstable interface through `include` · Issue #2285 · bytecodealliance/wasm-tools">Failure to process unstable interface through `include` · Issue #2285 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">This input: package a:b1; world the-world { include a:b2/the-world; } package a:b2 { world the-world { @unstable(feature = disabled) import a:b3/thing; } } package a:b3 { @unstable(feature = disabl...</div></div></div>



<a name="535512928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535512928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535512928">(Aug 21 2025 at 14:09)</a>:</h4>
<p>so, wasi-testsuite and wasmtime: there are some tests that fail on rust for <code>--target=wasm32-wasip1</code>.  i triaged here: <a href="https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3210744361">https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3210744361</a>.  if there is a kind soul who is able to triage, that would be helpful</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3210744361" style="background-image: url(&quot;https://uploads.zulipusercontent.net/9a4d6d9def2f67139ef91e3ceb1f51f171054a0a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343938343734316663343135383637613865316263356662346663366338616566396131633236366238646439333939303936633531653766356665626536392f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313031&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3210744361" title="Tests failing on Wasmtime · Issue #101 · WebAssembly/wasi-testsuite">Tests failing on Wasmtime · Issue #101 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">The "Daily runtime validation" workflow shows 9 failures on Wasmtime, which matches the behavior I see when running the tests locally. Is this a problem with the testsuite or with Wasmtime?</div></div></div>



<a name="535517941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535517941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535517941">(Aug 21 2025 at 14:32)</a>:</h4>
<p>daily status: spent some time prepping wasi-testsuite for wasip3 tests: <a href="https://github.com/WebAssembly/wasi-testsuite/issues/109#issuecomment-3210363725">https://github.com/WebAssembly/wasi-testsuite/issues/109#issuecomment-3210363725</a>.  following up on marcin's review comments.<br>
in the process i triaged the wasip1 tests mentioned in <a class="message-link" href="/#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/535512928">#wasi &gt; wasi-testsuite update for wasip3 @ 💬</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/109#issuecomment-3210363725" style="background-image: url(&quot;https://uploads.zulipusercontent.net/6b57f23af9ea229fc3526deec4119bbc3b7e0b82/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f393831346538323261346639363239623938373338323562616466373166653666383335656361363534343333623235313531333135613731333264316336342f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313039&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/109#issuecomment-3210363725" title="Update wasi-testsuite to support testing newer versions of WASI · Issue #109 · WebAssembly/wasi-testsuite">Update wasi-testsuite to support testing newer versions of WASI · Issue #109 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Hello wasi-testsuite hackers, I would like to update wasi-testsuite to support newer versions of WASI. The idea would be that the scope of wasi-testsuite should be to test the versions of WASI that...</div></div></div>



<a name="535520545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535520545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535520545">(Aug 21 2025 at 14:45)</a>:</h4>
<p>so, it was a day of plumbing.  but, fine, hopefully tomorrow i add the wasip3 things</p>



<a name="535634613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535634613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535634613">(Aug 22 2025 at 08:02)</a>:</h4>
<p><a href="https://github.com/WebAssembly/wasi-testsuite/issues/117">https://github.com/WebAssembly/wasi-testsuite/issues/117</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/117" style="background-image: url(&quot;https://uploads.zulipusercontent.net/7b00b6212298c47821f69e0d606d4a4b4b4a078d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633132346331396335393533616631663262343365666638646233323366386135346535613431333833326436363761613036373765383563663237666136612f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313137&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/117" title="RFC: Remove tests of WASI preview 1 rights API as required · Issue #117 · WebAssembly/wasi-testsuite">RFC: Remove tests of WASI preview 1 rights API as required · Issue #117 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Summary I propose that if there are failing tests related to the WASI preview 1 rights API, that we modify or delete those tests to remove those assertions. Problem Wasmtime fails some tests curren...</div></div></div>



<a name="535663821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535663821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535663821">(Aug 22 2025 at 11:30)</a>:</h4>
<p>so, is wasi-testsuite the right place for wasip3 tests?</p>



<a name="535663907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535663907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535663907">(Aug 22 2025 at 11:31)</a>:</h4>
<p>i want to focus on wasip3 tests and there has probably too much "making space for wasip3" so far</p>



<a name="535664086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535664086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535664086">(Aug 22 2025 at 11:32)</a>:</h4>
<p>I think it might be okay to focus on wasip3 for expedience's sake for now, but long-term, it definitely is the right place, yes: once published, p3 will be the latest version of WASI, which should be reflected in the standard's test suite <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="535664455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535664455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535664455">(Aug 22 2025 at 11:35)</a>:</h4>
<p>ok.  i will just keep piling up the prs, hopefully one day things will go faster</p>



<a name="535664748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535664748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marcin Kolny <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535664748">(Aug 22 2025 at 11:37)</a>:</h4>
<p>I think some refactoring is required at the beginning as wasi-testsuite wasn't designed initially for multiple wasi versions. Once we'll go through that phase, further development should be easier.</p>



<a name="535668595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/535668595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#535668595">(Aug 22 2025 at 12:01)</a>:</h4>
<p>wasip1 tests found a nice wasmtime bug: <a href="https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3214123363">https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3214123363</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3214123363" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1b42b8c52eeb887103ba23df0fee30c680d214a2/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363230313363663533616331636533666334323835663162653361643133313762353364333763656632393736386162643562343631376564333235646539302f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313031&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/101#issuecomment-3214123363" title="Tests failing on Wasmtime · Issue #101 · WebAssembly/wasi-testsuite">Tests failing on Wasmtime · Issue #101 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">The "Daily runtime validation" workflow shows 9 failures on Wasmtime, which matches the behavior I see when running the tests locally. Is this a problem with the testsuite or with Wasmtime?</div></div></div>



<a name="536011902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536011902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536011902">(Aug 25 2025 at 12:12)</a>:</h4>
<p>hmm, i am a bit perplexed.  consider this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:test;</span>

<span class="s">  world test {</span>
<span class="s">      include wasi:clocks/imports@0.3.0-rc-2025-08-15;</span>
<span class="s">      include wasi:cli/command@0.3.0-rc-2025-08-15;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Work around https://github.com/bytecodealliance/wasm-tools/issues/2285.</span>
<span class="w">    </span><span class="n">features</span><span class="p">:[</span><span class="s">"clocks-timezone"</span><span class="p">],</span>
<span class="w">    </span><span class="k">async</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s">"wasi:cli/run@0.3.0-rc-2025-08-15#run"</span><span class="p">,</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="n">generate_all</span>
<span class="p">});</span>

<span class="k">use</span><span class="w"> </span><span class="n">wasi</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">monotonic_clock</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Component</span><span class="p">;</span>
<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Component</span><span class="p">);</span>

<span class="k">impl</span><span class="w"> </span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">run</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">monotonic_clock</span><span class="p">::</span><span class="n">wait_for</span><span class="p">(</span><span class="mi">50_000</span><span class="k">u64</span><span class="p">).</span><span class="k">await</span><span class="p">;</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>placed in <code>src/bin/minimal.rs</code>, there are the needed wit files in <code>wit/</code>.   Build via <code>cargo build --target=wasm32-wasip2 --release --bin minimal</code>, with wit-bindgen from git.  It has an error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">dev</span><span class="o">-</span><span class="n">env</span><span class="p">]</span><span class="w"> </span><span class="n">wingo</span><span class="o">@</span><span class="n">beastie</span><span class="w"> </span><span class="o">~/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">testsuite</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">minimal</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wingo</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasip3</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">testsuite</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">ld</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w">  </span><span class="s">"wasm-component-ld"</span><span class="w"> </span><span class="s">"-flavor"</span><span class="w"> </span><span class="s">"wasm"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"[async-lift]wasi:cli/run@0.3.0-rc-2025-08-15#run"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"[callback][async-lift]wasi:cli/run@0.3.0-rc-2025-08-15#run"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"__main_void"</span><span class="w"> </span><span class="s">"--export"</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="s">"-z"</span><span class="w"> </span><span class="s">"stack-size=1048576"</span><span class="w"> </span><span class="s">"--stack-first"</span><span class="w"> </span><span class="s">"--allow-undefined"</span><span class="w"> </span><span class="s">"--no-demangle"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained/crt1-command.o"</span><span class="w"> </span><span class="s">"&lt;2 object files omitted&gt;"</span><span class="w"> </span><span class="s">"/home/wingo/src/wasip3/wasi-testsuite/tests/rust/wasm32-wasip3/target/wasm32-wasip2/release/deps/{libwit_bindgen-d3f7658c15e3bc1f.rlib,libwit_bindgen_rt-e215225e28d37754.rlib,libfutures-1e3aa9526458c95b.rlib,libfutures_executor-4c14e82b92128eea.rlib,libfutures_util-d4d1ebf3054ace8e.rlib,libmemchr-2857ac1428ecf686.rlib,libfutures_io-bd6f5f056e177761.rlib,libslab-b3944246b67457c3.rlib,libfutures_channel-af04b86abb9667b5.rlib,libpin_project_lite-38e8286ac72dc06c.rlib,libfutures_sink-87533dcfb4185e08.rlib,libfutures_task-4934eebbf3d64f90.rlib,libpin_utils-1407d4781aab0b76.rlib,libfutures_core-c2a2480a6530cd71.rlib,libbitflags-77083259b2ec5fc4.rlib}.rlib"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/{libstd-*,libpanic_abort-*,libwasi-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,libcfg_if-*,liblibc-*}.rlib"</span><span class="w"> </span><span class="s">"-l"</span><span class="w"> </span><span class="s">"c"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/{librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/wingo/src/wasip3/wasi-testsuite/tests/rust/wasm32-wasip3/target/wasm32-wasip2/release/build/wit-bindgen-rt-f69b726d7f89fc43/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"&lt;sysroot&gt;/lib/rustlib/wasm32-wasip2/lib/self-contained"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/wingo/src/wasip3/wasi-testsuite/tests/rust/wasm32-wasip3/target/wasm32-wasip2/release/deps/minimal-83a77969722bd283.wasm"</span><span class="w"> </span><span class="s">"--gc-sections"</span><span class="w"> </span><span class="s">"-O3"</span><span class="w"> </span><span class="s">"--strip-debug"</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">some</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">.</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">verbose</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">component</span>

<span class="w">          </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">              </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>
<span class="w">              </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span>
<span class="w">              </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">monotonic</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="p">::[</span><span class="k">async</span><span class="o">-</span><span class="n">lower</span><span class="p">][</span><span class="k">async</span><span class="p">]</span><span class="n">wait</span><span class="o">-</span><span class="k">for</span><span class="err">`</span>
<span class="w">              </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">monotonic</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="err">`</span>
<span class="w">              </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="nc">type</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="k">async</span><span class="p">]</span><span class="n">wait</span><span class="o">-</span><span class="k">for</span><span class="err">`</span><span class="p">:</span><span class="w"> </span><span class="nc">expected</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="n">I32</span><span class="p">,</span><span class="w"> </span><span class="n">I32</span><span class="p">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">I32</span><span class="p">]</span><span class="err">`</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="err">`</span><span class="p">[</span><span class="n">I64</span><span class="p">]</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">I32</span><span class="p">]</span><span class="err">`</span>
</code></pre></div>
<p>If i switch to simple assertions about <code>monotonic_clock::now()</code>, that works, so it's not a linking error for sync bindings.  In what is probably a second problem, the resulting file fails to run:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="s">"$HOME/src/wasip3/wasmtime/target/release/wasmtime"</span><span class="w"> </span><span class="o">-</span><span class="n">Sp3</span><span class="o">=</span><span class="n">y</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip2</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">minimal</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">WebAssembly</span><span class="w"> </span><span class="n">module</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="err">`</span><span class="n">task</span><span class="p">.</span><span class="k">return</span><span class="err">`</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x17b99</span><span class="p">)</span>
</code></pre></div>
<p>Which is odd because I built wasmtime with <code>--features component-model-async</code>.  I will try building this as a cdylib instead, perhaps that will help.</p>



<a name="536014298"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536014298" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536014298">(Aug 25 2025 at 12:24)</a>:</h4>
<p>right, I get the same result for a minimal cdylib:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">;</span>

<span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">inline</span><span class="p">:</span><span class="w"> </span><span class="nc">r</span><span class="s">"</span>
<span class="s">  package test:playground;</span>

<span class="s">  world the-world {</span>
<span class="s">            include wasi:cli/command@0.3.0-rc-2025-08-15;</span>
<span class="s">  }</span>
<span class="s">"</span><span class="p">,</span>
<span class="w">    </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"wit"</span><span class="p">,</span>
<span class="w">    </span><span class="k">async</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s">"wasi:cli/run@0.3.0-rc-2025-08-15#run"</span><span class="p">,</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="n">generate_all</span>
<span class="p">});</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Test</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">exports</span><span class="p">::</span><span class="n">wasi</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">run</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Test</span><span class="p">);</span>
</code></pre></div>



<a name="536014990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536014990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536014990">(Aug 25 2025 at 12:28)</a>:</h4>
<blockquote>
<p><code>task.return requires the component model async feature</code></p>
</blockquote>
<p>I believe this requires <code>wasmtime -W component-model-async</code> (runtime feature gate too)</p>



<a name="536017211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017211">(Aug 25 2025 at 12:42)</a>:</h4>
<p>oh funny, i didn't think to look there, like "wasm" was a lower-level thing than wasi / component-model.  thanks!</p>



<a name="536017478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017478">(Aug 25 2025 at 12:43)</a>:</h4>
<p>Yeah we aren't generally very precise in distinguishing these things but technically component model is a wasm proposal while wasi is its own separate (dependent) spec</p>



<a name="536017606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017606">(Aug 25 2025 at 12:44)</a>:</h4>
<p>since they are developed in parallel it is convenient to do lockstep-ish releases and they both end up in the "p3" bucket</p>



<a name="536017739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017739">(Aug 25 2025 at 12:45)</a>:</h4>
<p>what do i need to enable to fix <code>invalid leading byte (0x25) for canonical function (at offset 0x16a4a)</code> ?</p>



<a name="536017810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017810">(Aug 25 2025 at 12:45)</a>:</h4>
<p>i had tried <code>all-proposals=y</code> in addition to <code>component-model-async=y</code> but that wasn't the trick</p>



<a name="536017826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017826">(Aug 25 2025 at 12:46)</a>:</h4>
<p>Ah I just encountered that one. I believe that is caused by a mismatched wasm-component-ld version</p>



<a name="536017857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017857">(Aug 25 2025 at 12:46)</a>:</h4>
<p>I fixed it by switching to a recent rust nightly</p>



<a name="536017861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536017861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536017861">(Aug 25 2025 at 12:46)</a>:</h4>
<p>oh :)</p>



<a name="536018049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018049">(Aug 25 2025 at 12:47)</a>:</h4>
<p>wouldn't that be something in wasi-sdk?</p>



<a name="536018389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018389">(Aug 25 2025 at 12:49)</a>:</h4>
<p>ah perhaps i wasn't running my cargo builds in an environment that had my fresh wasi-sdk</p>



<a name="536018473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018473">(Aug 25 2025 at 12:49)</a>:</h4>
<p>wasi-sdk shouldn't have anything to do with binary encoding</p>



<a name="536018518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018518">(Aug 25 2025 at 12:49)</a>:</h4>
<p>well wasm-component-ld is there</p>



<a name="536018630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018630">(Aug 25 2025 at 12:50)</a>:</h4>
<p>but maybe wasi-sdk is only for c?</p>



<a name="536018679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018679">(Aug 25 2025 at 12:50)</a>:</h4>
<p>weird stuff</p>



<a name="536018893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018893">(Aug 25 2025 at 12:51)</a>:</h4>
<p>ah wasi-sdk might include wasm-component-ld to make sure you get a compatible version</p>



<a name="536018986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536018986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536018986">(Aug 25 2025 at 12:52)</a>:</h4>
<p>wasi-sdk can be used by any guest language that can do C ffi in wasm</p>



<a name="536019229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536019229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536019229">(Aug 25 2025 at 12:53)</a>:</h4>
<p>its basically wasi-libc plus a compatible toolchain</p>



<a name="536019428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536019428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536019428">(Aug 25 2025 at 12:54)</a>:</h4>
<p>well many thanks lann, after rustupping to a nightly, things are working now</p>



<a name="536019908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536019908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536019908">(Aug 25 2025 at 12:57)</a>:</h4>
<p>nice, all problems fixed.  ready to make tests, finally ;)</p>



<a name="536038345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536038345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536038345">(Aug 25 2025 at 14:30)</a>:</h4>
<p>a first async test at <a href="https://github.com/WebAssembly/wasi-testsuite/pull/120">https://github.com/WebAssembly/wasi-testsuite/pull/120</a>, grumble about github and stacked pr's tho</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/120" style="background-image: url(&quot;https://uploads.zulipusercontent.net/705800c05c18715b46d87d70f22a420ecf540aad/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f326131366533303137353233313162383036373866343636656336316536626233356463333437343835333362663363323832333530656536303433613763352f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313230&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/120" title="First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite">First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Depends on #114.  Adds wasm32-wasip3 Rust test directory, with a first Rust-based test.  Test runner not yet updated; requires passing Wcomponent-model-async=y -Sp3=y to wasmtime.  Building the was...</div></div></div>



<a name="536777620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536777620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536777620">(Aug 29 2025 at 12:27)</a>:</h4>
<p>/me files a spicy bug <a href="https://github.com/WebAssembly/wasi-http/issues/179">https://github.com/WebAssembly/wasi-http/issues/179</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-http/issues/179" style="background-image: url(&quot;https://uploads.zulipusercontent.net/65b9d985a3836c5291033bfe85173c09c63c9cb5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623338636231666366653862363864333761363363306666333436656164366164303866323731356232646639623731343439363835653062396538333638622f576562417373656d626c792f776173692d68747470&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-http/issues/179" title="WebAssembly/wasi-http">WebAssembly/wasi-http</a></div><div class="message_embed_description">Contribute to WebAssembly/wasi-http development by creating an account on GitHub.</div></div></div>



<a name="536780018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536780018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536780018">(Aug 29 2025 at 12:40)</a>:</h4>
<p>just as a summary of where i'm at:</p>
<ul>
<li><a href="https://github.com/WebAssembly/wasi-testsuite/pull/122">https://github.com/WebAssembly/wasi-testsuite/pull/122</a> needs merging, it should fix the workflow that runs on merge-to-main that populates the <code>prod/testsuite-base</code> branch with prebuilt tests</li>
<li><a href="https://github.com/WebAssembly/wasi-testsuite/pull/120">https://github.com/WebAssembly/wasi-testsuite/pull/120</a> is next, it makes the dir for wasip3 rust tests and adds tests for <code>clocks:monotonic-clock</code></li>
<li><a href="https://github.com/WebAssembly/wasi-testsuite/pull/123">https://github.com/WebAssembly/wasi-testsuite/pull/123</a> is next, it tests <code>clocks:wall-clock</code> (though there is very little that one can assert there), and it adds a test with 20 outstanding <code>monotonic-clock#wait-until</code> invocations, asserting that they complete in order with regards to each other and to the clock</li>
<li>currently working on http tests.  not going to test time-zone for the time being, as there is little to test, and it is not yet part of wasip3</li>
</ul>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/122" style="background-image: url(&quot;https://uploads.zulipusercontent.net/8336e3cce02893e016ccbfa05326c13d2e6001c9/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363232366339303531313833636331633964346331363235326639666436636138333336326537346136303464663365326232333633633037343166383731622f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313232&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/122" title="Fix the git shenanigans to merge in main to prod/testsuite-base by wingo · Pull Request #122 · WebAssembly/wasi-testsuite">Fix the git shenanigans to merge in main to prod/testsuite-base by wingo · Pull Request #122 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Apologies for the clownshoes, ptal @loganek !</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/120" style="background-image: url(&quot;https://uploads.zulipusercontent.net/035ae236719180f552cbe2d5d55c165d18403d34/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356534623937653163653463633766643931323636646432363435396236393334346531333839303130656661653132366138626433653734663164346135622f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313230&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/120" title="First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite">First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Depends on #114.  Adds wasm32-wasip3 Rust test directory, with a first Rust-based test.  Test runner not yet updated; requires passing Wcomponent-model-async=y -Sp3=y to wasmtime.  Building the was...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/123" style="background-image: url(&quot;https://uploads.zulipusercontent.net/97ec091b3fddcff631773f7ad62de5b0801ba8ca/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f326537616136343161623338386537613634633162326161376139616437363336343031613736646637666465643537366333383438306262663366353266642f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313233&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/123" title="Add tests for wasip3 wall_clock and for multiple outstanding wait_for invocations by wingo · Pull Request #123 · WebAssembly/wasi-testsuite">Add tests for wasip3 wall_clock and for multiple outstanding wait_for invocations by wingo · Pull Request #123 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Stacked on #120.</div></div></div>



<a name="536831704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/536831704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#536831704">(Aug 29 2025 at 17:15)</a>:</h4>
<p>thanks for lots of great work and great questions, andy!</p>



<a name="537800672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/537800672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#537800672">(Sep 05 2025 at 06:21)</a>:</h4>
<p>good morning :)  i would like to merge <a href="https://github.com/WebAssembly/wasi-testsuite/pull/120">https://github.com/WebAssembly/wasi-testsuite/pull/120</a> today</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/120" style="background-image: url(&quot;https://uploads.zulipusercontent.net/035ae236719180f552cbe2d5d55c165d18403d34/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356534623937653163653463633766643931323636646432363435396236393334346531333839303130656661653132366138626433653734663164346135622f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313230&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/120" title="First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite">First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Depends on #114.  Adds wasm32-wasip3 Rust test directory, with a first Rust-based test.  Test runner not yet updated; requires passing Wcomponent-model-async=y -Sp3=y to wasmtime.  Building the was...</div></div></div>



<a name="537800721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/537800721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#537800721">(Sep 05 2025 at 06:22)</a>:</h4>
<p>how should i proceed here <span class="user-mention" data-user-id="513417">@Marcin Kolny</span> ?</p>



<a name="538213876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538213876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538213876">(Sep 08 2025 at 12:37)</a>:</h4>
<p>status: i have a 60%-done test for <code>wasi:filesystem</code>, but am not posting a pr yet because i am waiting on <a href="https://github.com/WebAssembly/wasi-testsuite/pull/120">https://github.com/WebAssembly/wasi-testsuite/pull/120</a>; otherwise there is nowhere to put it</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/120" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0629b0281e5676f1eecf496e25426b9cba875081/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366538383537303765623238323862316564346266653933616439346666333461623437326263613163643964633436376435623263353930653637343637342f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313230&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/120" title="First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite">First wasip3 test by wingo · Pull Request #120 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Depends on #114.  Adds wasm32-wasip3 Rust test directory, with a first Rust-based test.  Test runner not yet updated; requires passing Wcomponent-model-async=y -Sp3=y to wasmtime.  Building the was...</div></div></div>



<a name="538460836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538460836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538460836">(Sep 09 2025 at 15:06)</a>:</h4>
<p>current status: slogging away at <a href="https://github.com/WebAssembly/wasi-testsuite/pull/130/files">https://github.com/WebAssembly/wasi-testsuite/pull/130/files</a>.  i have done almost everything that doesn't require streams.  starting streams now; found a fun wasmtime bug: <a href="https://github.com/bytecodealliance/wasmtime/issues/11652">https://github.com/bytecodealliance/wasmtime/issues/11652</a>.  will continue tomorrow</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/130/files" style="background-image: url(&quot;https://uploads.zulipusercontent.net/55070b6e630dcd45f2cd4d3959a1b359a5428dbe/68747470733a2f2f617661746172732e67697468756275736572636f6e74656e742e636f6d2f752f313734353930333f733d34303026763d34&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/130/files" title="Add tests for wasi:filesystem@0.3.0-rc-2025-08-15 by wingo · Pull Request #130 · WebAssembly/wasi-testsuite">Add tests for wasi:filesystem@0.3.0-rc-2025-08-15 by wingo · Pull Request #130 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/11652" style="background-image: url(&quot;https://uploads.zulipusercontent.net/13e8946c7eaf45f4c58d19609666656c8e452efe/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303263666137613233336237313738613262303832313564626363326438623031326533626166633763333261396366616563353735336433643434343066652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131363532&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/11652" title="iloop when readdir on dir containing symlink · Issue #11652 · bytecodealliance/wasmtime">iloop when readdir on dir containing symlink · Issue #11652 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Test case use std::process; extern crate wit_bindgen; wit_bindgen::generate!({ inline: r" package test:test; world test { include wasi:filesystem/imports@0.3.0-rc-2025-08-15; include wasi:cli/comma...</div></div></div>



<a name="538524783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538524783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538524783">(Sep 09 2025 at 20:13)</a>:</h4>
<p>As a status update on the wasmtime side of things, Andy now <code>wasi:http</code> bits are all landed in Wasmtime so the <code>dev</code> release should be suitable for testing all of WASIp3</p>



<a name="538790458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538790458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538790458">(Sep 11 2025 at 07:43)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> no idea how, but the stream/future host API refactor (<a href="https://github.com/bytecodealliance/wasmtime/pull/11515">https://github.com/bytecodealliance/wasmtime/pull/11515</a>) fixed my iloop in readdir (<a href="https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3278931677">https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3278931677</a>).  Weird!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/11515" style="background-image: url(&quot;https://uploads.zulipusercontent.net/39bf14796e2581e91b6f99e6829661e2e679df69/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f346535643034383738636138626537653733303965626166613838393935316136356435303361343430393237333435386439623139666532613463376162332f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f3131353135&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/11515" title="Revamp component model stream/future host API (again) by dicej · Pull Request #11515 · bytecodealliance/wasmtime">Revamp component model stream/future host API (again) by dicej · Pull Request #11515 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">This changes the host APIs for dealing with futures and streams from a &quot;rendezvous&quot;-style API to a callback-oriented one.
Previously you would create e.g. a StreamReader/StreamWriter pair...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3278931677" style="background-image: url(&quot;https://uploads.zulipusercontent.net/c443beed7525aef0c727d010156ffa5103de86fd/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f626233623064633839386632323136333931316337636232316563336233396130353934386239333834623332393830643265663837643535376332383534362f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131363532&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/11652#issuecomment-3278931677" title="iloop when readdir on dir containing symlink · Issue #11652 · bytecodealliance/wasmtime">iloop when readdir on dir containing symlink · Issue #11652 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Test case use std::process; extern crate wit_bindgen; wit_bindgen::generate!({ inline: r" package test:test; world test { include wasi:filesystem/imports@0.3.0-rc-2025-08-15; include wasi:cli/comma...</div></div></div>



<a name="538834782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538834782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538834782">(Sep 11 2025 at 11:38)</a>:</h4>
<p>hoo, read-from-stream's prototype is weird</p>



<a name="538835110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538835110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538835110">(Sep 11 2025 at 11:40)</a>:</h4>
<p>i guess it is to be expected that this hangs:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">future</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fd</span><span class="p">.</span><span class="n">read_via_stream</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">future</span><span class="p">.</span><span class="k">await</span>
</code></pre></div>



<a name="538838471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538838471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538838471">(Sep 11 2025 at 11:58)</a>:</h4>
<p>I have had the same confusion recently. I think in general we expect to read the stream until it's dropped, then poll the future.</p>



<a name="538838602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538838602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538838602">(Sep 11 2025 at 11:58)</a>:</h4>
<p>(or do both concurrently)</p>



<a name="538841909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538841909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538841909">(Sep 11 2025 at 12:12)</a>:</h4>
<p>one of the weird things is that it's tricky to test that <code>read-via-stream(u64::MAX)</code> fails, because if you drop the stream immediately, the future doesn't necessarily resolve to an error</p>



<a name="538842603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538842603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538842603">(Sep 11 2025 at 12:15)</a>:</h4>
<p>do zero-length reads still allow the stream to start?</p>



<a name="538843892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538843892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538843892">(Sep 11 2025 at 12:22)</a>:</h4>
<p>it seems not</p>



<a name="538851791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538851791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538851791">(Sep 11 2025 at 12:58)</a>:</h4>
<p>I think they're supposed to, or at least <em>were</em> supposed to in some design iteration</p>



<a name="538853368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538853368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538853368">(Sep 11 2025 at 13:04)</a>:</h4>
<p>The doc comment in wasmtime <code>main</code> right now says that a zero length read will only return <code>pending</code> if it "expects" that a non-zero-length read would also return <code>pending</code>.</p>



<a name="538853645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538853645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538853645">(Sep 11 2025 at 13:06)</a>:</h4>
<p>That's for host streams in general; the filesystem impl might not be up-to-date with that interpretation</p>



<a name="538858656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538858656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538858656">(Sep 11 2025 at 13:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/538790458">said</a>:</p>
<blockquote>
<p>no idea how, but the stream/future host API refactor (<a href="https://github.com/bytecodealliance/wasmtime/pull/11515">https://github.com/bytecodealliance/wasmtime/pull/11515</a>) fixed my iloop in readdir</p>
</blockquote>
<p>That's not totally surprising; that refactor was primarily motivated by the need for finer-grained, more predictable, control of streams and futures in <code>wasmtime-wasi[-http]</code>, and it also forced us to think more precisely about how we wanted them to behave.</p>



<a name="538876532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/538876532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#538876532">(Sep 11 2025 at 14:35)</a>:</h4>
<p>Zero-length reads/writes are a bit weird because they're used for readiness checks where possible, but a 1-byte read at <code>u64::MAX - 1</code> should deterministically fail</p>



<a name="539008777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539008777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539008777">(Sep 12 2025 at 08:24)</a>:</h4>
<p>AbiBuffer is odd: its <a href="https://docs.rs/wit-bindgen/0.46.0/wit_bindgen/struct.AbiBuffer.html#method.remaining">remaining()</a> method would seem to duplicate <code>StreamResult::Complete</code>.  as a user you get both values.  i get the reason but it's weird</p>



<a name="539014707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539014707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539014707">(Sep 12 2025 at 08:57)</a>:</h4>
<p>and my goodness, writing to a stream is gnarly</p>



<a name="539014969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539014969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539014969">(Sep 12 2025 at 08:58)</a>:</h4>
<p>so.  component-model-knowers.  i initially wrote this to test <code>write-via-stream</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">pwrite</span><span class="p">(</span><span class="n">fd</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wit_stream</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fd</span><span class="p">.</span><span class="n">write_via_stream</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">written</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buf</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">to_vec</span><span class="p">()).</span><span class="k">await</span><span class="p">;</span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">StreamResult</span><span class="p">::</span><span class="n">Complete</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="fm">assert!</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">written</span><span class="p">);</span>
<span class="w">                </span><span class="n">written</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">                </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">remaining</span><span class="p">(),</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">written</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="n">remaining</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">write_buf</span><span class="p">(</span><span class="n">buf</span><span class="p">).</span><span class="k">await</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">StreamResult</span><span class="p">::</span><span class="n">Dropped</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"receiver dropped the stream?"</span><span class="p">);</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">StreamResult</span><span class="p">::</span><span class="n">Cancelled</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="n">remaining</span><span class="p">(),</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">written</span><span class="p">);</span>
<span class="w">    </span><span class="nb">drop</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">success</span><span class="p">.</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">written</span><span class="p">),</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="539015416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539015416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539015416">(Sep 12 2025 at 09:00)</a>:</h4>
<p>could be buggy, excuse my bad rust form, etc; anyway, when running this, wasmtime deadlocks.  helpfully it detects the deadlock; but it is not clear to me why it should deadlock at all.  i wrote this from the spec and docs, but now looking at wasmtime tests it would seem that it wants me to wait in parallel on the individual stream writes, at the same time as i wait on the write-via-stream results: <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_file_write.rs#L45">https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_file_write.rs#L45</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_file_write.rs#L45" style="background-image: url(&quot;https://uploads.zulipusercontent.net/fc97dbb158f474c38c754194422763a3f9464bfb/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306566633730396664393666626263393139323435326562366331663534333261353161306239656138373436366636633030343061363033356263303332302f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/src/bin/p3_file_write.rs#L45" title="wasmtime/crates/test-programs/src/bin/p3_file_write.rs at main · bytecodealliance/wasmtime">wasmtime/crates/test-programs/src/bin/p3_file_write.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<a name="539015662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539015662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539015662">(Sep 12 2025 at 09:02)</a>:</h4>
<p>but why is this?  if there is an error, why wouldn't the receiving end cancel the stream and cause the future to complete with a failure?</p>



<a name="539016158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539016158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539016158">(Sep 12 2025 at 09:05)</a>:</h4>
<p>the deadlock occurs at the <code>tx.write(data.to_vec()).await</code> line</p>



<a name="539019415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539019415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539019415">(Sep 12 2025 at 09:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="480579">Lann Martin</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/538838471">said</a>:</p>
<blockquote>
<p>I have had the same confusion recently. I think in general we expect to read the stream until it's dropped, then poll the future.</p>
</blockquote>
<p>this is what I was expecting for the write case, then: write the stream until complete or cancelled, then poll the future.  is it necessarily not that way?</p>



<a name="539055693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539055693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539055693">(Sep 12 2025 at 12:43)</a>:</h4>
<p>Just to clarify terminology, <code>completed</code> and <code>cancelled</code> are the two stream results that - maybe confusingly - don't terminate the stream. Otherwise yes, my expectation is that you write to the stream until you either get a <code>dropped</code> result (typically because of a write error) or you drop it yourself (because you are done), then await the future.</p>



<a name="539070018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539070018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539070018">(Sep 12 2025 at 13:47)</a>:</h4>
<p>hoo, i did not realize that <code>cancelled</code> doesn't terminate the stream</p>



<a name="539070154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539070154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539070154">(Sep 12 2025 at 13:48)</a>:</h4>
<p>yeah it is just cancelling the one active operation on the stream</p>



<a name="539072104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539072104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539072104">(Sep 12 2025 at 13:56)</a>:</h4>
<p>Take this with a grain of salt until Joel/Alex/Luke can confirm but I believe the state diagram is basically this: <a href="https://gist.github.com/lann/d8dbc6feaf36eb70a17e9506e3c06597">https://gist.github.com/lann/d8dbc6feaf36eb70a17e9506e3c06597</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/lann/d8dbc6feaf36eb70a17e9506e3c06597" style="background-image: url(&quot;https://uploads.zulipusercontent.net/91f9baed8f4fc08c462d1a4de5a8c23942d45e97/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f6173736574732f676973742d6f672d696d6167652d3534666437646330373133652e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/lann/d8dbc6feaf36eb70a17e9506e3c06597" title="write-stream.mmd">write-stream.mmd</a></div><div class="message_embed_description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="539072162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539072162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539072162">(Sep 12 2025 at 13:56)</a>:</h4>
<p><span class="user-mention" data-user-id="396878">@Andy Wingo</span> I'm not sure what's causing the deadlock.  Would you mind providing instructions for reproducing the issue, e.g. a complete Rust file I can run using <code>wasmtime run</code>?  BTW, you could use <code>StreamWriter::write_all</code> and avoid the loop.</p>



<a name="539073081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539073081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539073081">(Sep 12 2025 at 14:01)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> your diagram looks roughly accurate, but note that the read and write ends of a stream are dropped separately, so a stream could be in one of three states: where neither end is dropped, the write end is dropped, or the read end is dropped.  And when both ends are dropped it ceases to exist entirely.</p>



<a name="539073226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539073226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539073226">(Sep 12 2025 at 14:01)</a>:</h4>
<p>Yeah I should clarify that I was only trying to represent the writer's perspective there.</p>



<a name="539084110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539084110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539084110">(Sep 12 2025 at 14:50)</a>:</h4>
<blockquote>
<p>as a user you get both values. i get the reason but it's weird</p>
</blockquote>
<p>This is trying to expose what the component model is giving us in that the return code of an async operation indicates how many items were transferred and the end-result status of the operation. In many cases dropped == 0 items taken for example but that's not guaranteed.</p>
<blockquote>
<p>and my goodness, writing to a stream is gnarly</p>
</blockquote>
<p>IMO I'd view this operation as a kernel-like operation. Managing epoll and/or trying to use io-uring would also be quite gnarly and I wouldn't expect those to be simple. I'd think of raw CM streams similarly.</p>
<p>I've tried to add a few helper methods like <code>write_all</code> and such and if you end up having other common operations it's fine to add more helper methods too.</p>
<blockquote>
<p>when running this, wasmtime deadlocks</p>
</blockquote>
<p>This is a subtle difference between Rust &amp; JS, calling <code>fd.write_via_stream(rx, offset)</code> doesn't actually do anything. You have to actually poll the future, which in this example only happens at the end of the function during <code>success.await</code>, for anything to happen. The reason your example deadlocks is that functionally what's happening is you created a stream and then wrote to it, but nothing is reading from it because the host API hasn't actually been called yet.</p>
<p>In the test in Rust you'll find usage of a <code>futures::join!</code> macro which is the current solution for this. It represents "do these two things at the same time" which is what you want here, one end calls <code>success.await</code> and the other ened does the writing.</p>



<a name="539084359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539084359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539084359">(Sep 12 2025 at 14:51)</a>:</h4>
<blockquote>
<p>Joel/Alex/Luke can confirm but I believe the state diagram is basically this: <a href="https://gist.github.com/lann/d8dbc6feaf36eb70a17e9506e3c06597">https://gist.github.com/lann/d8dbc6feaf36eb70a17e9506e3c06597</a></p>
</blockquote>
<p>FWIW that looks right to me</p>



<a name="539085166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539085166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539085166">(Sep 12 2025 at 14:52)</a>:</h4>
<p>Yeah to your point above, in that state diagram all of the <code>result</code>s are implicitly from polling something.</p>



<a name="539488729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539488729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539488729">(Sep 15 2025 at 08:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539084110">said</a>:</p>
<blockquote>
<blockquote>
<p>as a user you get both values. i get the reason but it's weird</p>
</blockquote>
<p>This is trying to expose what the component model is giving us in that the return code of an async operation indicates how many items were transferred and the end-result status of the operation. In many cases dropped == 0 items taken for example but that's not guaranteed.</p>
</blockquote>
<p>So let's say you have a stream, you have a vector of <em>total-count</em> items to write the stream, and the receiver consumes those items in a number of batches.</p>
<p>My question: from the transmitter's perspective (i.e., when it is active and not suspended), could we calculate the AbiBuffer's <code>remaining()</code> as the <em>total-count</em> minus the sum of the previously-received <code>StreamResult::Complete(n)</code> values?  That is what I meant by duplication.  But you seem to be suggesting that no, if the stream result is <code>Dropped</code>, that the previous write may have only been partially consumed, and that the <code>remaining()</code> is the real source of truth?  I would have expected a <code>Complete(n)</code> for the partial write, then a <code>Dropped</code>.</p>
<blockquote>
<blockquote>
<p>and my goodness, writing to a stream is gnarly</p>
</blockquote>
<p>IMO I'd view this operation as a kernel-like operation. Managing epoll and/or trying to use io-uring would also be quite gnarly and I wouldn't expect those to be simple. I'd think of raw CM streams similarly.</p>
<p>I've tried to add a few helper methods like <code>write_all</code> and such and if you end up having other common operations it's fine to add more helper methods too.</p>
</blockquote>
<p>I would certainly recommend the <code>write_all</code> methods to others, but I am just trying to get a feel for how things can break when there are drops and cancels and so on :)</p>
<blockquote>
<blockquote>
<p>when running this, wasmtime deadlocks</p>
</blockquote>
<p>This is a subtle difference between Rust &amp; JS, calling <code>fd.write_via_stream(rx, offset)</code> doesn't actually do anything. You have to actually poll the future, which in this example only happens at the end of the function during <code>success.await</code>, for anything to happen.</p>
</blockquote>
<p>This is indeed subtle, thank you for the hint!  This entirely explains it.  I had no idea about this aspect of Rust, the systems I have worked with all begin execution of the subtask immediately and only suspend if necessary.  Thanks again for the generous close read.</p>



<a name="539488964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539488964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539488964">(Sep 15 2025 at 08:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539072162">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> I'm not sure what's causing the deadlock.  Would you mind providing instructions for reproducing the issue, e.g. a complete Rust file I can run using <code>wasmtime run</code>?  BTW, you could use <code>StreamWriter::write_all</code> and avoid the loop.</p>
</blockquote>
<p>I had just finished preparing the example when Alex corrected my misunderstanding, no need now.  Thank you though.</p>



<a name="539500350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539500350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539500350">(Sep 15 2025 at 09:06)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> question, how do you know that in Rust, <code>fd.read_via_stream</code> won't have to poll the future before the sender will be active?</p>



<a name="539500672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539500672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539500672">(Sep 15 2025 at 09:07)</a>:</h4>
<p>i assume that the whole pre-poll sendable Future thing is a rust-only concern: it would seem that on a component-model async ABI level, calling an async import actually starts the task (as in JS, C#, etc)</p>



<a name="539527683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539527683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539527683">(Sep 15 2025 at 11:15)</a>:</h4>
<p>Should you be interested, I think <a href="https://aturon.github.io/blog/2016/09/07/futures-design/">this classic blog post</a> by Aaron Turon still gives a pretty good explanation for the design of Rust Futures</p>



<a name="539549168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539549168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539549168">(Sep 15 2025 at 12:53)</a>:</h4>
<p>i also enjoyed the blandy/orendorff/tindall chapter on asyncs</p>



<a name="539554553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539554553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539554553">(Sep 15 2025 at 13:11)</a>:</h4>
<p>finishing filesystem tests.  i am mostly assuming i can read my own writes, that writes to a descriptor within a component are immediately visible to reads within that component without sync, both for data and stat().size</p>



<a name="539554796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539554796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539554796">(Sep 15 2025 at 13:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539500672">said</a>:</p>
<blockquote>
<p>i assume that the whole pre-poll sendable Future thing is a rust-only concern: it would seem that on a component-model async ABI level, calling an async import actually starts the task (as in JS, C#, etc)</p>
</blockquote>
<p>I think this is understood but just to be completely clear: in your example the import isn't called until the Rust Future is polled. If you are more familiar with JS you can think of Rust async functions as generators.</p>



<a name="539554837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539554837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539554837">(Sep 15 2025 at 13:13)</a>:</h4>
<p>i know that wasi isn't much able to specify this but maybe tests can nudge implementations in the right direction, i.e. that adding buffering on the host side is a bad thing</p>



<a name="539555055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539555055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539555055">(Sep 15 2025 at 13:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="480579">Lann Martin</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539554796">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539500672">said</a>:</p>
<blockquote>
<p>i assume that the whole pre-poll sendable Future thing is a rust-only concern: it would seem that on a component-model async ABI level, calling an async import actually starts the task (as in JS, C#, etc)</p>
</blockquote>
<p>I think this is understood but just to be completely clear: in your example the import isn't called until the Rust Future is polled. If you are more familiar with JS you can think of Rust async functions as generators.</p>
</blockquote>
<p>i did not understand this before but after alex's comment i do now!</p>



<a name="539555225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539555225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539555225">(Sep 15 2025 at 13:15)</a>:</h4>
<p>(don't js generators actually get to run a bit immediately?  i can't remember, and i implemented them in spidermonkey and v8.. ;)</p>



<a name="539555307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539555307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539555307">(Sep 15 2025 at 13:15)</a>:</h4>
<p>They do not (I had to verify in the console <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>)</p>



<a name="539555424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539555424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539555424">(Sep 15 2025 at 13:15)</a>:</h4>
<p>live and learn (and forget, and learn...) :)</p>



<a name="539555782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539555782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539555782">(Sep 15 2025 at 13:17)</a>:</h4>
<p>I guess more to your question of whether its a "rust-only concern", that depends on whether any other languages <em>also</em> treat async functions as generators. I think Python might (edit: it does)? But if you are just asking about the ABI, yes once the async call reaches the ABI the task starts immediately.</p>



<a name="539556456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539556456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539556456">(Sep 15 2025 at 13:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539554553">said</a>:</p>
<blockquote>
<p>finishing filesystem tests. i am mostly assuming i can read my own writes, that writes to a descriptor within a component are immediately visible to reads within that component without sync, both for data and stat().size<br>
i know that wasi isn't much able to specify this but maybe tests can nudge implementations in the right direction, i.e. that adding buffering on the host side is a bad thing</p>
</blockquote>
<p>My non-authoritative take would be that for a single descriptor yes you should be able to read your own writes.</p>



<a name="539556716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539556716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539556716">(Sep 15 2025 at 13:21)</a>:</h4>
<p>(feedback welcome re the sync/buffering thing)</p>



<a name="539569951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539569951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539569951">(Sep 15 2025 at 14:11)</a>:</h4>
<blockquote>
<p>So let's say you have a stream, you have a vector of <em>total-count</em> items to write the stream, and the receiver consumes those items in a number of batches.</p>
</blockquote>
<p>I'm not entirely sure how to respond to your question here in that I'm not totally sure I understand it. That being said I'm going to make a statement here which you may already be aware of but in case you weren't it might reframe your questions here: if a writer writes 10 items, and a reader then reads 4 items, the writer will receive a notification that 4 items were read. The writer doesn't, for example, say blocked until all 10 items are read. </p>
<p>There's room in the CM spec to allow the reader to keep reading before a notification is delivered (e.g. you read one-item-at-a-time in a loop and we batch all the notifications for the writer) but that's not implemented in Wasmtime right now.</p>
<blockquote>
<p>if the stream result is <code>Dropped</code>, that the previous write may have only been partially consumed, and that the <code>remaining()</code> is the real source of truth?</p>
</blockquote>
<p>This is indeed a possibility, yeah. Although reading over the APIs again it's a bug that <code>Dropped</code> doesn't have a <code>usize</code> payload on it, that definitely should.</p>
<p>With that combo of words, does that answer your original question? I fear it may not... Let me know though!</p>



<a name="539570528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539570528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539570528">(Sep 15 2025 at 14:13)</a>:</h4>
<blockquote>
<p>how do you know that in Rust, <code>fd.read_via_stream</code> won't have to poll the future before the sender will be active?</p>
</blockquote>
<p>Can confirm others' answers here, it's purely a Rust thing. When you do <code>foo()</code> where it was defined as <code>async fn foo() { println!("hi") }</code> that does nothing and prints nothing. All it does is construct a future on the stack that, when polled, will actually print. Once we hit the CM, however, then everything happens in the background similar to JS/etc and pollling in Rust need not happen other than to actually acquire the result of the operation when it's done.</p>



<a name="539570777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539570777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539570777">(Sep 15 2025 at 14:14)</a>:</h4>
<p>also I totally empathize with you implementing JS generators, my friend and I wrote a JIT for lua in college and I don't actually know anything about writing lua</p>



<a name="539571306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539571306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539571306">(Sep 15 2025 at 14:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539569951">said</a>:</p>
<blockquote>
<p>There's room in the CM spec to allow the reader to keep reading before a notification is delivered (e.g. you read one-item-at-a-time in a loop and we batch all the notifications for the writer) but that's not implemented in Wasmtime right now.</p>
</blockquote>
<p>I believe it <em>is</em> implemented, per <a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/162">https://github.com/bytecodealliance/wasip3-prototyping/issues/162</a> and <a href="https://github.com/bytecodealliance/wasip3-prototyping/pull/168">https://github.com/bytecodealliance/wasip3-prototyping/pull/168</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasip3-prototyping/issues/162" style="background-image: url(&quot;https://uploads.zulipusercontent.net/b6e5824b69c64a27e99e5a6ce8395edd19649f7a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336661313338386237633331636634336663646133633537333563643735643531336565643566623232383565326538383666643135353530613861353666342f62797465636f6465616c6c69616e63652f7761736970332d70726f746f747970696e672f6973737565732f313632&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasip3-prototyping/issues/162" title="Multiple writes into the same buffer · Issue #162 · bytecodealliance/wasip3-prototyping">Multiple writes into the same buffer · Issue #162 · bytecodealliance/wasip3-prototyping</a></div><div class="message_embed_description">As currently specified, if one component does a stream.read and another component does a stream.write that doesn't completely fill the stream.read's buffer, until the STREAM_READ event is delivered...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasip3-prototyping/pull/168" style="background-image: url(&quot;https://uploads.zulipusercontent.net/3ebc727d670b18cfea11af27d74f3ea5617a39ab/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336238383162623661313761396337623435643139333334623939303262393762343030383734343930623665643963656131396632636561366464396366302f62797465636f6465616c6c69616e63652f7761736970332d70726f746f747970696e672f70756c6c2f313638&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasip3-prototyping/pull/168" title="fix various behavior mismatches relative to the spec by dicej · Pull Request #168 · bytecodealliance/wasip3-prototyping">fix various behavior mismatches relative to the spec by dicej · Pull Request #168 · bytecodealliance/wasip3-prototyping</a></div><div class="message_embed_description">Plus docs, comments, and minor code cleanup.</div></div></div>



<a name="539571443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539571443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539571443">(Sep 15 2025 at 14:16)</a>:</h4>
<p>oh nice!</p>



<a name="539571512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539571512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539571512">(Sep 15 2025 at 14:16)</a>:</h4>
<p>I thought that was just some hypothetical future thing we would do at some point</p>



<a name="539571681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539571681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539571681">(Sep 15 2025 at 14:17)</a>:</h4>
<p>I think the hypothetical future thing is to allow you to start multiple reads or writes on the same stream without waiting for previous ones to complete, which is different.</p>



<a name="539572067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539572067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539572067">(Sep 15 2025 at 14:18)</a>:</h4>
<p>i.e. you can start a new read for a write you already read from, but only after you get notification that the previous read completed</p>



<a name="539572219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539572219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539572219">(Sep 15 2025 at 14:19)</a>:</h4>
<p>(and assuming the writer hasn't received their notification yet, at which point the reader will need to wait for a new write)</p>



<a name="539572941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539572941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539572941">(Sep 15 2025 at 14:21)</a>:</h4>
<p>Regarding what <span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539569951">said</a>, I think I was missing that <code>Dropped</code> logically has a <code>usize</code> associated with it:</p>
<blockquote>
<blockquote>
<p>if the stream result is <code>Dropped</code>, that the previous write may have only been partially consumed, and that the <code>remaining()</code> is the real source of truth?</p>
</blockquote>
<p>This is indeed a possibility, yeah. Although reading over the APIs again it's a bug that <code>Dropped</code> doesn't have a <code>usize</code> payload on it, that definitely should.</p>
</blockquote>



<a name="539572986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539572986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539572986">(Sep 15 2025 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/channel/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3/near/539570528">said</a>:</p>
<blockquote>
<p>Once we hit the CM, however, then everything happens in the background similar to JS/etc and pollling in Rust need not happen other than to actually acquire the result of the operation when it's done.</p>
</blockquote>
<p>To clarify, though: it's all still cooperative, so if the caller goes into an infinite loop without yielding, the callee will not have a chance to make progress.  I.e. "in the background" means, "when nothing else is monopolizing the single thread of control".</p>



<a name="539573385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539573385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539573385">(Sep 15 2025 at 14:23)</a>:</h4>
<p>is the cooperative nature observable?  can progress be made on a cross-component async call in another thread, invisible to other components?</p>



<a name="539573501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539573501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539573501">(Sep 15 2025 at 14:24)</a>:</h4>
<p>observable, yes, cross-thread, no</p>



<a name="539573702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539573702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539573702">(Sep 15 2025 at 14:24)</a>:</h4>
<p>ack</p>



<a name="539724891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539724891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539724891">(Sep 16 2025 at 09:41)</a>:</h4>
<p>ok!  added my filesystem tests, i think especially as regards the actual streaming i/o there can be more tests, but at least all the api is covered.  a bunch of similar draft pr's up at <a href="https://github.com/WebAssembly/wasi-testsuite/pulls">https://github.com/WebAssembly/wasi-testsuite/pulls</a>, but only one marked as ready, so that changes from that review can be replicated in the others: <a href="https://github.com/WebAssembly/wasi-testsuite/pull/131">https://github.com/WebAssembly/wasi-testsuite/pull/131</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pulls" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a449d1f170540e1b7f6b5621d2cc5e7cb1d3dbda/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323333363132353030386639653937326664653837393865343736626433373833646636386631323131636131626165363937313132326133363264396362302f576562417373656d626c792f776173692d746573747375697465&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pulls" title="Pull requests · WebAssembly/wasi-testsuite">Pull requests · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/131" style="background-image: url(&quot;https://uploads.zulipusercontent.net/19e3b6b876e247cd26ce045dbcf8a2d278abcc4e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333236653437373038336330383234346139346134326462373935386232626134323132653438396333356165663133386361323330646439396365373663322f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313331&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/131" title="wasi:filesystem@0.3.0-rc-2025-08-15: Add tests for flags/type APIs by wingo · Pull Request #131 · WebAssembly/wasi-testsuite">wasi:filesystem@0.3.0-rc-2025-08-15: Add tests for flags/type APIs by wingo · Pull Request #131 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">We read every piece of feedback, and take your input very seriously.</div></div></div>



<a name="539725039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539725039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539725039">(Sep 16 2025 at 09:42)</a>:</h4>
<p>the tests get compiled nightly but are not run yet.  now that wasi-testsuite actually has wasip3 tests, i need to wire up that bit of the CI.</p>



<a name="539725096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/539725096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#539725096">(Sep 16 2025 at 09:42)</a>:</h4>
<p>will see what i can do with http, now that it's in.</p>



<a name="540821727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/540821727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#540821727">(Sep 22 2025 at 14:36)</a>:</h4>
<p>review welcome on the <code>wasi:filesystem</code> tests: <a href="https://github.com/WebAssembly/wasi-testsuite/pulls">https://github.com/WebAssembly/wasi-testsuite/pulls</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pulls" style="background-image: url(&quot;https://uploads.zulipusercontent.net/6c671bc33c34b8cb7c002f873cb0048d782f83a7/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f326435623061313338333839373636663832306335656132393165336335393536393936656533616634326638303735356432393538386635643932303938322f576562417373656d626c792f776173692d746573747375697465&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pulls" title="Pull requests · WebAssembly/wasi-testsuite">Pull requests · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">WASI Testsuite. Contribute to WebAssembly/wasi-testsuite development by creating an account on GitHub.</div></div></div>



<a name="541251934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/541251934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#541251934">(Sep 24 2025 at 15:00)</a>:</h4>
<p>OK, quick status: the wasi-testsuite runner tests multiple runtimes at once and skips e.g. WASIp3 tests on a runtime that just does WASIp1.  Working on filing off some sharp edges.  Tomorrow I will add a jco adapter.  There are tests basically only for wasi:clocks and wasi:filesystem currently, and most of the filesystem ones are out for review still; I have held off on http until <a href="https://github.com/bytecodealliance/wasmtime/issues/11736">https://github.com/bytecodealliance/wasmtime/issues/11736</a> is fixed.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/11736" style="background-image: url(&quot;https://uploads.zulipusercontent.net/82f017e03c6718278f2e7b072608d45ee5181bff/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363964363634643563303531393165313637656432663730636535616338386433396166313765633232636163353637646337633039643538313663656265302f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f3131373336&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/11736" title="Add WASIp3 HTTP to `wasmtime run` · Issue #11736 · bytecodealliance/wasmtime">Add WASIp3 HTTP to `wasmtime run` · Issue #11736 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Hello, Running wasmtime run on a component that uses wasi:http fails: [dev-env] wingo@beastie ~/src/wasip3/wasi-testsuite/tests/rust/wasm32-wasip3$ ~/src/wasip3/wasmtime/target/release/wasmtime -Wc...</div></div></div>



<a name="541252040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/541252040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#541252040">(Sep 24 2025 at 15:01)</a>:</h4>
<p>but generally speaking see <a href="https://github.com/WebAssembly/wasi-testsuite/pull/162">https://github.com/WebAssembly/wasi-testsuite/pull/162</a> for an idea of status</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/162" style="background-image: url(&quot;https://uploads.zulipusercontent.net/55c3172d7ac23a7cd8847333e60cf79848f53504/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383537323131323935336533616437666264353134626639313530313233613464386165323137666565373463613038626233393032653731336234303735352f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313632&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/162" title="Skip tests that runtimes don't support by wingo · Pull Request #162 · WebAssembly/wasi-testsuite">Skip tests that runtimes don't support by wingo · Pull Request #162 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Refactor to make runtime adapters declare the WASI versions they support, and for test suites to declare the WASI version they are.  By default, skip tests whose WASI version is not supported by th...</div></div></div>



<a name="562474600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562474600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562474600">(Dec 08 2025 at 14:04)</a>:</h4>
<p>i regret to inform everyone that i am back on my BS!</p>
<p>so, question,,, i am looking at <a href="https://github.com/WebAssembly/wasi-testsuite/issues/186">https://github.com/WebAssembly/wasi-testsuite/issues/186</a>.  if, with wit-bindgen, I do:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wit_future</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="nb">None</span><span class="p">));</span>
<span class="w">    </span><span class="nb">drop</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
<span class="w">    </span><span class="nb">drop</span><span class="p">(</span><span class="n">rx</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>then I get a panic when dropping <code>tx</code>, because it goes to write and there's no task on the other side to take the value.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/issues/186" style="background-image: url(&quot;https://uploads.zulipusercontent.net/bfc4f72f4337b6bf83dcf36563cd1a6601a94070/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f666433663634643837343838393163346663306430343462653264343930303439353939386630333666346534373963613038343163393064353733613766662f576562417373656d626c792f776173692d7465737473756974652f6973737565732f313836&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/issues/186" title="http-response wasip3 test fails after toolchain, wit-bindgen, wasmtime update · Issue #186 · WebAssembly/wasi-testsuite">http-response wasip3 test fails after toolchain, wit-bindgen, wasmtime update · Issue #186 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">This was working before when run on wasmtime / ubuntu but not any more. Noting it here. wasmtime -Wcomponent-model-async -Sp3,http tests/rust/testsuite/wasm32-wasip3/http-response.wasm thread 'main...</div></div></div>



<a name="562474670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562474670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562474670">(Dec 08 2025 at 14:04)</a>:</h4>
<p>what changed between wit-bindgen 0.44 (or so) and 0.48 to make this an error?</p>



<a name="562476998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562476998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562476998">(Dec 08 2025 at 14:14)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> and <span class="user-mention" data-user-id="253994">@Alex Crichton</span> are all but certainly the best people to answer this</p>



<a name="562478805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562478805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562478805">(Dec 08 2025 at 14:22)</a>:</h4>
<p>the concrete use case is creating a http response object without writing any trailers.  the test uses <code>let (_, rx) = wit_future::new(|| Ok(None))</code> for that purpose</p>



<a name="562479288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562479288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562479288">(Dec 08 2025 at 14:24)</a>:</h4>
<p>Hm yeah that shouldn't panic, that sounds like a bug</p>



<a name="562479620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562479620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562479620">(Dec 08 2025 at 14:25)</a>:</h4>
<p>neat</p>



<a name="562479974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562479974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562479974">(Dec 08 2025 at 14:27)</a>:</h4>
<p>Locally that doesn't panic for me, and running the test in the issue yields:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">response</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span><span class="p">::</span><span class="n">unwrap_err</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Ok</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="p">()</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>which wasmtime version should I be using to repro?</p>



<a name="562480072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480072">(Dec 08 2025 at 14:27)</a>:</h4>
<p>er, as in, locally I edited a wit-bindgen test to create a future and drop the ends and it didn't panic</p>



<a name="562480156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480156">(Dec 08 2025 at 14:27)</a>:</h4>
<p>on the CI we are using the wasmtime <code>dev</code> release.  i get the same thing for wasmtime from git (built today)</p>



<a name="562480321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480321">(Dec 08 2025 at 14:28)</a>:</h4>
<p>we had a bit of a mess updating toolchain and various deps: <a href="https://github.com/WebAssembly/wasi-testsuite/pull/185">https://github.com/WebAssembly/wasi-testsuite/pull/185</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-testsuite/pull/185" style="background-image: url(&quot;https://uploads.zulipusercontent.net/34e104e11c72961fc3c9a87c86fbe6ae13fc0922/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633336396334306339616537646134353630393430313839343335623933636632363365346134363434623762646262616436383631356431386462343232392f576562417373656d626c792f776173692d7465737473756974652f70756c6c2f313835&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-testsuite/pull/185" title="wasip3 rust tests: Pin wit-bindgen to a released version by wingo · Pull Request #185 · WebAssembly/wasi-testsuite">wasip3 rust tests: Pin wit-bindgen to a released version by wingo · Pull Request #185 · WebAssembly/wasi-testsuite</a></div><div class="message_embed_description">Before, we needed git.  But now we need a released version because git produces errors like "[async method]descriptor.write-via-stream is not in kebab case (at offset 0x27).</div></div></div>



<a name="562480628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480628">(Dec 08 2025 at 14:29)</a>:</h4>
<p>Should I be able to repro by checking out <code>prod/testsuite-base</code>?</p>



<a name="562480699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480699">(Dec 08 2025 at 14:29)</a>:</h4>
<p>(I can't repro with <code>main</code> wasmtime on <code>prod/testsuite-base</code>)</p>



<a name="562480728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480728">(Dec 08 2025 at 14:29)</a>:</h4>
<p>i think so, yes; lemme try</p>



<a name="562480755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480755">(Dec 08 2025 at 14:29)</a>:</h4>
<p>or, rather, I get the <code>unwrap_err</code> issue from above</p>



<a name="562480919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562480919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562480919">(Dec 08 2025 at 14:30)</a>:</h4>
<p>I'm on <code>a61233b4927818cd96a6830c97338e71205299e6</code> for <code>prod/testsuite-base</code> and I get:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="o">../</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Wcomponent</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="k">async</span><span class="w"> </span><span class="o">-</span><span class="n">Sp3</span><span class="p">,</span><span class="n">http</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">testsuite</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">response</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">response</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span><span class="p">::</span><span class="n">unwrap_err</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Ok</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="p">()</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">tests</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">testsuite</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasip3</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">response</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="o">..</span><span class="p">.</span>
</code></pre></div>



<a name="562481465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562481465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562481465">(Dec 08 2025 at 14:32)</a>:</h4>
<p>yes i get the same for the prod/testsuite-base binaries.  weird, I will look into things.</p>



<a name="562481687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562481687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562481687">(Dec 08 2025 at 14:33)</a>:</h4>
<p>whereas if i build the wasm files locally i get the abort that CI sees.  somethign is off, i will look into it</p>



<a name="562497443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562497443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562497443">(Dec 08 2025 at 15:31)</a>:</h4>
<p>the github action that uploaded prebuilt tests to prod/testsuite-base was broken <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="562497942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562497942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562497942">(Dec 08 2025 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> if you try again from <code>prod/testsuite-base</code> i think you will get the error i was seeing</p>



<a name="562498887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562498887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562498887">(Dec 08 2025 at 15:36)</a>:</h4>
<p>possible differences between the setup on ci and yours:</p>
<ul>
<li>ci uses wasm32-wasip2 from rustup to compile wasip3, not the tier3 wasm32-wasip3 target</li>
<li>ci uses wit-bindgen 0.48.1, not 0.49 / git</li>
</ul>



<a name="562499822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562499822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562499822">(Dec 08 2025 at 15:40)</a>:</h4>
<p>lookin</p>



<a name="562500931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562500931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562500931">(Dec 08 2025 at 15:44)</a>:</h4>
<p>hm ok so the basic issue here is that this is happening in a non-async context and there's a bad error message/handling on wit-bindgen's part</p>



<a name="562501277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562501277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562501277">(Dec 08 2025 at 15:45)</a>:</h4>
<p>with <code>async fn main() { ... }</code> for example I don't believe this'd cause issues</p>



<a name="562501509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562501509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562501509">(Dec 08 2025 at 15:46)</a>:</h4>
<p>you are thinking that it should not be possible to make a http response object in a sync context?</p>



<a name="562501629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562501629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562501629">(Dec 08 2025 at 15:47)</a>:</h4>
<p>well, I'm not going that far yet, just saying what's going on so far</p>



<a name="562501931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562501931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562501931">(Dec 08 2025 at 15:48)</a>:</h4>
<p>sure.  i have no opinion fwiw.  also does <code>async fn main()</code> work these days?  or is it <code>async fn run()</code> on the guest impl</p>



<a name="562502021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502021">(Dec 08 2025 at 15:48)</a>:</h4>
<p>it'd be <code>async fn run</code> yeah</p>



<a name="562502060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502060">(Dec 08 2025 at 15:48)</a>:</h4>
<p>cool</p>



<a name="562502127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502127">(Dec 08 2025 at 15:48)</a>:</h4>
<p>how exactly async gets hooked up at <code>main</code> at the toolchain level is a bit of an open question</p>



<a name="562502173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502173">(Dec 08 2025 at 15:48)</a>:</h4>
<p>/me nod</p>



<a name="562502213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502213">(Dec 08 2025 at 15:49)</a>:</h4>
<p>to the extent that wasi-testsuite is testing wasi, not toolchains, I'd recommend switching tests to using explicit exports where possible</p>



<a name="562502247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502247">(Dec 08 2025 at 15:49)</a>:</h4>
<p>I recently did that for wit-bindgen's own test suite too</p>



<a name="562502979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562502979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562502979">(Dec 08 2025 at 15:52)</a>:</h4>
<p>hmm!  i wonder, there is a case for not testing component-model async things though -- the low-level details of how to manage futures and streams, i mean, as these are component-model concerns; i.e. we would ideally use whatever lowest level of abstractions map streams into a language which is a little above the canonical abi</p>



<a name="562503046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562503046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562503046">(Dec 08 2025 at 15:52)</a>:</h4>
<p>but, perhaps you are right.  i will look into what you did for wit-bindgen</p>



<a name="562503267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562503267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562503267">(Dec 08 2025 at 15:54)</a>:</h4>
<p>in this specific instance i am ok with the answer being "it is only sensible to use this interface from within a rust async context, when using rust", fwiw</p>



<a name="562503799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562503799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562503799">(Dec 08 2025 at 15:56)</a>:</h4>
<p>I think we'll still want a better answer here longer-term for Rust itself, but yeah for wasi-testsuite I think that's a reasonable rule of thumb</p>



<a name="562504267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-testsuite%20update%20for%20wasip3/near/562504267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-testsuite.20update.20for.20wasip3.html#562504267">(Dec 08 2025 at 15:59)</a>:</h4>
<p>I opened <a href="https://github.com/bytecodealliance/wit-bindgen/issues/1456">https://github.com/bytecodealliance/wit-bindgen/issues/1456</a> for this</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/issues/1456" style="background-image: url(&quot;https://uploads.zulipusercontent.net/eb869286c9979b2b7da3e049c0754bab3dac5341/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356133373831626533316361326361336634303264663163316265613963366235653566383236346164353464613664643061393632383863383266353038652f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f6973737565732f31343536&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/issues/1456" title="rust: Panic dropping a future outside of an async context · Issue #1456 · bytecodealliance/wit-bindgen">rust: Panic dropping a future outside of an async context · Issue #1456 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">Code such as this: fn main() { let (tx, rx) = wit_future::new(|| Ok(None)); drop(tx); drop(rx); } will currently fail with: thread 'main' (1) panicked at /home/runner/.cargo/registry/src/index.crat...</div></div></div>



<hr><p>Last updated: Feb 22 2026 at 11:05 UTC</p>
</html>