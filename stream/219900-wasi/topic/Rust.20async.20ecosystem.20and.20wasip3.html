<html>
<head><meta charset="utf-8"><title>Rust async ecosystem and wasip3 · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html">Rust async ecosystem and wasip3</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="546275937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546275937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nicola Krumschmidt <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546275937">(Oct 21 2025 at 16:07)</a>:</h4>
<p>With WASI 0.3 on the horizon, I'm curious about its future support within the Rust async ecosystem, particularly with regard to its compatibility with tokio. I have a potential use case involving streaming results asynchronously from the guest to the host. Once tokio supports the <code>wasip3</code> target, will I be able to use any crate that provides asynchronous functionality and relies on tokio (e.g., tokio-postgres) in the guest? Or will each crate have to add support for <code>wasip3</code> individually?</p>



<a name="546277223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546277223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ludea <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546277223">(Oct 21 2025 at 16:13)</a>:</h4>
<p>There is <a href="https://github.com/tokio-rs/tokio/pull/6893">https://github.com/tokio-rs/tokio/pull/6893</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/tokio-rs/tokio/pull/6893" style="background-image: url(&quot;https://uploads.zulipusercontent.net/82292d050e10f944cecc19d5ce529e94303f74f1/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636563383833316432323461623435373632333661326538373165333032663830376531326232633966336238346365363463326564376366303865383931342f746f6b696f2d72732f746f6b696f2f70756c6c2f36383933&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/tokio-rs/tokio/pull/6893" title="add wasm32-wasip2 support by dicej · Pull Request #6893 · tokio-rs/tokio">add wasm32-wasip2 support by dicej · Pull Request #6893 · tokio-rs/tokio</a></div><div class="message_embed_description">Motivation

This adds support for the new wasm32-wasip2 target platform, which includes more extensive support for sockets than wasm32-wasip1 (formerly known as wasm32-wasi).
Solution

The bulk of ...</div></div></div>



<a name="546278898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546278898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ludea <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546278898">(Oct 21 2025 at 16:22)</a>:</h4>
<p>You can use <a href="https://github.com/bytecodealliance/wstd">https://github.com/bytecodealliance/wstd</a> instead</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wstd" style="background-image: url(&quot;https://uploads.zulipusercontent.net/48656314f330103a5b76ab9a96b37e012de998cf/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f393863343465343230303134636438303262326230646233633136656235613239313137633161383964636164356632313438313831303564663935363062622f62797465636f6465616c6c69616e63652f77737464&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wstd" title="GitHub - bytecodealliance/wstd: A WebAssembly-native Rust stdlib">GitHub - bytecodealliance/wstd: A WebAssembly-native Rust stdlib</a></div><div class="message_embed_description">A WebAssembly-native Rust stdlib. Contribute to bytecodealliance/wstd development by creating an account on GitHub.</div></div></div>



<a name="546278928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546278928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546278928">(Oct 21 2025 at 16:22)</a>:</h4>
<blockquote>
<p>Once tokio supports the <code>wasip3</code> target, will I be able to use any crate that provides asynchronous functionality and relies on tokio (e.g., tokio-postgres) in the guest?</p>
</blockquote>
<p>There won't be a universal answer here. Some crates will work immediately, some will work eventually, and some (hopefully very few!) will likely never work.</p>



<a name="546280257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546280257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546280257">(Oct 21 2025 at 16:27)</a>:</h4>
<blockquote>
<p>Or will each crate have to add support for <code>wasip3</code> individually?</p>
</blockquote>
<p>This shouldn't be necessary, though a few common dependencies like <code>hyper</code> may need individual work toward support to enable dependent crates.</p>



<a name="546291793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546291793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nicola Krumschmidt <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546291793">(Oct 21 2025 at 17:26)</a>:</h4>
<p>Thanks! All of that makes sense so far. There is one thing I'm wondering about, though. If I understand correctly, to call an async function that transitively calls a function from tokio, the call must happen in a tokio runtime context. However, if the function is called from an exported guest function, the runtime runs inside the host, so there is no runtime that the guest is aware of.</p>



<a name="546292242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546292242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546292242">(Oct 21 2025 at 17:28)</a>:</h4>
<p>you'll never see that sort of connection between guest and host.</p>



<a name="546292422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546292422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546292422">(Oct 21 2025 at 17:29)</a>:</h4>
<p>running tokio inside the guest means that the guest tokio will use wasip3 as its syscall layer. it won't (can't, and shouldn't) know anything about the host environment it is running inside, just that the environment provides wasip3</p>



<a name="546292907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546292907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546292907">(Oct 21 2025 at 17:31)</a>:</h4>
<p>so, the guest tokio (linked to by any libraries using tokio inside the guest) will have to satisfy all of its needs from the external world (connecting, accepting, sending and recieving data on sockets, opening files, timers, etc) via wasip3. if the host happens to use a tokio for implementing wasip3, thats an implementation detail out on the host where the host tokio will be making linux (or mac or etc) syscalls to implement its functionality. but the two will always be in totally separate memory spaces, symbols from one tokio wont ever resolve to the other</p>



<a name="546298670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546298670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nicola Krumschmidt <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546298670">(Oct 21 2025 at 18:01)</a>:</h4>
<p>But if you just call a tokio function from an exported guest function, there would be no tokio runtime running inside the guest, would there? If I called a tokio function outside of the tokio runtime context today, it will panic, but when the same function is called from a guest that is compiled to <code>wasip3</code>, it should still work.</p>



<a name="546299222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546299222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546299222">(Oct 21 2025 at 18:04)</a>:</h4>
<p>That's right yeah, the guest would be responsible for setting up and managing the tokio runtime within itself and calls to its exports. This might be via a wasi-specific API in tokio or something like that</p>



<a name="546326541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546326541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nicola Krumschmidt <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546326541">(Oct 21 2025 at 20:56)</a>:</h4>
<p>Ah, I see. Thanks! So, calling an async function alone won't suffice. Has anyone experimented with what that might look like in terms of implementation in tokio? I'm very interested to see how it will work.</p>



<a name="546331560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546331560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546331560">(Oct 21 2025 at 21:34)</a>:</h4>
<p>there have been experiments porting tokio to wasip2, but none yet to wasip3</p>



<a name="546331747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546331747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546331747">(Oct 21 2025 at 21:36)</a>:</h4>
<p>wstd is a much smaller runtime than tokio that works for wasip2 today <a href="https://github.com/bytecodealliance/wstd">https://github.com/bytecodealliance/wstd</a>. it will be ported to wasip3 in the future</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wstd" style="background-image: url(&quot;https://uploads.zulipusercontent.net/48656314f330103a5b76ab9a96b37e012de998cf/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f393863343465343230303134636438303262326230646233633136656235613239313137633161383964636164356632313438313831303564663935363062622f62797465636f6465616c6c69616e63652f77737464&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wstd" title="GitHub - bytecodealliance/wstd: A WebAssembly-native Rust stdlib">GitHub - bytecodealliance/wstd: A WebAssembly-native Rust stdlib</a></div><div class="message_embed_description">A WebAssembly-native Rust stdlib. Contribute to bytecodealliance/wstd development by creating an account on GitHub.</div></div></div>



<a name="546331858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546331858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546331858">(Oct 21 2025 at 21:36)</a>:</h4>
<p>its worth considering what, exactly, you need from tokio. If you are just using tokio::net, tokio::time, tokio::task::spwan, that stuff works great with wstd today (though under a different crate name)</p>



<a name="546332094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546332094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546332094">(Oct 21 2025 at 21:39)</a>:</h4>
<p>if you are trying to use e.g. tokio-native-tls that uses the (linux, macos, windows) native tls - that wont work today, that doesnt (yet) exist for wasi. (there is a wasi-tls proposal in progress and will eventaully be possible)</p>



<a name="546332471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Rust%20async%20ecosystem%20and%20wasip3/near/546332471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Rust.20async.20ecosystem.20and.20wasip3.html#546332471">(Oct 21 2025 at 21:42)</a>:</h4>
<p>if you are using features of tokio's multi-threaded executor (e.g. spawn_blocking) those wont work on wasip3 either, because those require threads, and wasip3 will not have threads at launch (they will come later, and they will initially be cooperative threads, not preemptive). (and its sort of a traditional-os-ism to need blocking syscalls, which along with long-running cpu-bound computations is why spawn_blocking exists, in wasip3 all syscalls can be made async, but thats neither here nor there)</p>



<hr><p>Last updated: Oct 25 2025 at 23:03 UTC</p>
</html>